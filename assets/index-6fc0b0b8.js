(function(){const tt=document.createElement("link").relList;if(tt&&tt.supports&&tt.supports("modulepreload"))return;for(const yt of document.querySelectorAll('link[rel="modulepreload"]'))b(yt);new MutationObserver(yt=>{for(const Et of yt)if(Et.type==="childList")for(const kt of Et.addedNodes)kt.tagName==="LINK"&&kt.rel==="modulepreload"&&b(kt)}).observe(document,{childList:!0,subtree:!0});function ot(yt){const Et={};return yt.integrity&&(Et.integrity=yt.integrity),yt.referrerpolicy&&(Et.referrerPolicy=yt.referrerpolicy),yt.crossorigin==="use-credentials"?Et.credentials="include":yt.crossorigin==="anonymous"?Et.credentials="omit":Et.credentials="same-origin",Et}function b(yt){if(yt.ep)return;yt.ep=!0;const Et=ot(yt);fetch(yt.href,Et)}})();var jsxRuntimeExports={},jsxRuntime={get exports(){return jsxRuntimeExports},set exports(j){jsxRuntimeExports=j}},reactJsxRuntime_production_min={},reactExports={},react={get exports(){return reactExports},set exports(j){reactExports=j}},react_production_min={};/**
 * @license React
 * react.production.min.js
 *
 * Copyright (c) Facebook, Inc. and its affiliates.
 *
 * This source code is licensed under the MIT license found in the
 * LICENSE file in the root directory of this source tree.
 */var l$1=Symbol.for("react.element"),n$1=Symbol.for("react.portal"),p$2=Symbol.for("react.fragment"),q$1=Symbol.for("react.strict_mode"),r=Symbol.for("react.profiler"),t=Symbol.for("react.provider"),u=Symbol.for("react.context"),v$1=Symbol.for("react.forward_ref"),w=Symbol.for("react.suspense"),x=Symbol.for("react.memo"),y=Symbol.for("react.lazy"),z$1=Symbol.iterator;function A$1(j){return j===null||typeof j!="object"?null:(j=z$1&&j[z$1]||j["@@iterator"],typeof j=="function"?j:null)}var B$1={isMounted:function(){return!1},enqueueForceUpdate:function(){},enqueueReplaceState:function(){},enqueueSetState:function(){}},C$1=Object.assign,D$1={};function E$1(j,tt,ot){this.props=j,this.context=tt,this.refs=D$1,this.updater=ot||B$1}E$1.prototype.isReactComponent={};E$1.prototype.setState=function(j,tt){if(typeof j!="object"&&typeof j!="function"&&j!=null)throw Error("setState(...): takes an object of state variables to update or a function which returns an object of state variables.");this.updater.enqueueSetState(this,j,tt,"setState")};E$1.prototype.forceUpdate=function(j){this.updater.enqueueForceUpdate(this,j,"forceUpdate")};function F(){}F.prototype=E$1.prototype;function G$1(j,tt,ot){this.props=j,this.context=tt,this.refs=D$1,this.updater=ot||B$1}var H$1=G$1.prototype=new F;H$1.constructor=G$1;C$1(H$1,E$1.prototype);H$1.isPureReactComponent=!0;var I$1=Array.isArray,J=Object.prototype.hasOwnProperty,K$1={current:null},L$1={key:!0,ref:!0,__self:!0,__source:!0};function M$1(j,tt,ot){var b,yt={},Et=null,kt=null;if(tt!=null)for(b in tt.ref!==void 0&&(kt=tt.ref),tt.key!==void 0&&(Et=""+tt.key),tt)J.call(tt,b)&&!L$1.hasOwnProperty(b)&&(yt[b]=tt[b]);var Gt=arguments.length-2;if(Gt===1)yt.children=ot;else if(1<Gt){for(var Vt=Array(Gt),an=0;an<Gt;an++)Vt[an]=arguments[an+2];yt.children=Vt}if(j&&j.defaultProps)for(b in Gt=j.defaultProps,Gt)yt[b]===void 0&&(yt[b]=Gt[b]);return{$$typeof:l$1,type:j,key:Et,ref:kt,props:yt,_owner:K$1.current}}function N$1(j,tt){return{$$typeof:l$1,type:j.type,key:tt,ref:j.ref,props:j.props,_owner:j._owner}}function O$1(j){return typeof j=="object"&&j!==null&&j.$$typeof===l$1}function escape$1(j){var tt={"=":"=0",":":"=2"};return"$"+j.replace(/[=:]/g,function(ot){return tt[ot]})}var P$1=/\/+/g;function Q$1(j,tt){return typeof j=="object"&&j!==null&&j.key!=null?escape$1(""+j.key):tt.toString(36)}function R$1(j,tt,ot,b,yt){var Et=typeof j;(Et==="undefined"||Et==="boolean")&&(j=null);var kt=!1;if(j===null)kt=!0;else switch(Et){case"string":case"number":kt=!0;break;case"object":switch(j.$$typeof){case l$1:case n$1:kt=!0}}if(kt)return kt=j,yt=yt(kt),j=b===""?"."+Q$1(kt,0):b,I$1(yt)?(ot="",j!=null&&(ot=j.replace(P$1,"$&/")+"/"),R$1(yt,tt,ot,"",function(an){return an})):yt!=null&&(O$1(yt)&&(yt=N$1(yt,ot+(!yt.key||kt&&kt.key===yt.key?"":(""+yt.key).replace(P$1,"$&/")+"/")+j)),tt.push(yt)),1;if(kt=0,b=b===""?".":b+":",I$1(j))for(var Gt=0;Gt<j.length;Gt++){Et=j[Gt];var Vt=b+Q$1(Et,Gt);kt+=R$1(Et,tt,ot,Vt,yt)}else if(Vt=A$1(j),typeof Vt=="function")for(j=Vt.call(j),Gt=0;!(Et=j.next()).done;)Et=Et.value,Vt=b+Q$1(Et,Gt++),kt+=R$1(Et,tt,ot,Vt,yt);else if(Et==="object")throw tt=String(j),Error("Objects are not valid as a React child (found: "+(tt==="[object Object]"?"object with keys {"+Object.keys(j).join(", ")+"}":tt)+"). If you meant to render a collection of children, use an array instead.");return kt}function S$1(j,tt,ot){if(j==null)return j;var b=[],yt=0;return R$1(j,b,"","",function(Et){return tt.call(ot,Et,yt++)}),b}function T$1(j){if(j._status===-1){var tt=j._result;tt=tt(),tt.then(function(ot){(j._status===0||j._status===-1)&&(j._status=1,j._result=ot)},function(ot){(j._status===0||j._status===-1)&&(j._status=2,j._result=ot)}),j._status===-1&&(j._status=0,j._result=tt)}if(j._status===1)return j._result.default;throw j._result}var U$1={current:null},V$1={transition:null},W$1={ReactCurrentDispatcher:U$1,ReactCurrentBatchConfig:V$1,ReactCurrentOwner:K$1};react_production_min.Children={map:S$1,forEach:function(j,tt,ot){S$1(j,function(){tt.apply(this,arguments)},ot)},count:function(j){var tt=0;return S$1(j,function(){tt++}),tt},toArray:function(j){return S$1(j,function(tt){return tt})||[]},only:function(j){if(!O$1(j))throw Error("React.Children.only expected to receive a single React element child.");return j}};react_production_min.Component=E$1;react_production_min.Fragment=p$2;react_production_min.Profiler=r;react_production_min.PureComponent=G$1;react_production_min.StrictMode=q$1;react_production_min.Suspense=w;react_production_min.__SECRET_INTERNALS_DO_NOT_USE_OR_YOU_WILL_BE_FIRED=W$1;react_production_min.cloneElement=function(j,tt,ot){if(j==null)throw Error("React.cloneElement(...): The argument must be a React element, but you passed "+j+".");var b=C$1({},j.props),yt=j.key,Et=j.ref,kt=j._owner;if(tt!=null){if(tt.ref!==void 0&&(Et=tt.ref,kt=K$1.current),tt.key!==void 0&&(yt=""+tt.key),j.type&&j.type.defaultProps)var Gt=j.type.defaultProps;for(Vt in tt)J.call(tt,Vt)&&!L$1.hasOwnProperty(Vt)&&(b[Vt]=tt[Vt]===void 0&&Gt!==void 0?Gt[Vt]:tt[Vt])}var Vt=arguments.length-2;if(Vt===1)b.children=ot;else if(1<Vt){Gt=Array(Vt);for(var an=0;an<Vt;an++)Gt[an]=arguments[an+2];b.children=Gt}return{$$typeof:l$1,type:j.type,key:yt,ref:Et,props:b,_owner:kt}};react_production_min.createContext=function(j){return j={$$typeof:u,_currentValue:j,_currentValue2:j,_threadCount:0,Provider:null,Consumer:null,_defaultValue:null,_globalName:null},j.Provider={$$typeof:t,_context:j},j.Consumer=j};react_production_min.createElement=M$1;react_production_min.createFactory=function(j){var tt=M$1.bind(null,j);return tt.type=j,tt};react_production_min.createRef=function(){return{current:null}};react_production_min.forwardRef=function(j){return{$$typeof:v$1,render:j}};react_production_min.isValidElement=O$1;react_production_min.lazy=function(j){return{$$typeof:y,_payload:{_status:-1,_result:j},_init:T$1}};react_production_min.memo=function(j,tt){return{$$typeof:x,type:j,compare:tt===void 0?null:tt}};react_production_min.startTransition=function(j){var tt=V$1.transition;V$1.transition={};try{j()}finally{V$1.transition=tt}};react_production_min.unstable_act=function(){throw Error("act(...) is not supported in production builds of React.")};react_production_min.useCallback=function(j,tt){return U$1.current.useCallback(j,tt)};react_production_min.useContext=function(j){return U$1.current.useContext(j)};react_production_min.useDebugValue=function(){};react_production_min.useDeferredValue=function(j){return U$1.current.useDeferredValue(j)};react_production_min.useEffect=function(j,tt){return U$1.current.useEffect(j,tt)};react_production_min.useId=function(){return U$1.current.useId()};react_production_min.useImperativeHandle=function(j,tt,ot){return U$1.current.useImperativeHandle(j,tt,ot)};react_production_min.useInsertionEffect=function(j,tt){return U$1.current.useInsertionEffect(j,tt)};react_production_min.useLayoutEffect=function(j,tt){return U$1.current.useLayoutEffect(j,tt)};react_production_min.useMemo=function(j,tt){return U$1.current.useMemo(j,tt)};react_production_min.useReducer=function(j,tt,ot){return U$1.current.useReducer(j,tt,ot)};react_production_min.useRef=function(j){return U$1.current.useRef(j)};react_production_min.useState=function(j){return U$1.current.useState(j)};react_production_min.useSyncExternalStore=function(j,tt,ot){return U$1.current.useSyncExternalStore(j,tt,ot)};react_production_min.useTransition=function(){return U$1.current.useTransition()};react_production_min.version="18.2.0";(function(j){j.exports=react_production_min})(react);/**
 * @license React
 * react-jsx-runtime.production.min.js
 *
 * Copyright (c) Facebook, Inc. and its affiliates.
 *
 * This source code is licensed under the MIT license found in the
 * LICENSE file in the root directory of this source tree.
 */var f=reactExports,k=Symbol.for("react.element"),l=Symbol.for("react.fragment"),m$1=Object.prototype.hasOwnProperty,n=f.__SECRET_INTERNALS_DO_NOT_USE_OR_YOU_WILL_BE_FIRED.ReactCurrentOwner,p$1={key:!0,ref:!0,__self:!0,__source:!0};function q(j,tt,ot){var b,yt={},Et=null,kt=null;ot!==void 0&&(Et=""+ot),tt.key!==void 0&&(Et=""+tt.key),tt.ref!==void 0&&(kt=tt.ref);for(b in tt)m$1.call(tt,b)&&!p$1.hasOwnProperty(b)&&(yt[b]=tt[b]);if(j&&j.defaultProps)for(b in tt=j.defaultProps,tt)yt[b]===void 0&&(yt[b]=tt[b]);return{$$typeof:k,type:j,key:Et,ref:kt,props:yt,_owner:n.current}}reactJsxRuntime_production_min.Fragment=l;reactJsxRuntime_production_min.jsx=q;reactJsxRuntime_production_min.jsxs=q;(function(j){j.exports=reactJsxRuntime_production_min})(jsxRuntime);const jsx=jsxRuntimeExports.jsx,jsxs=jsxRuntimeExports.jsxs;var reactDomExports={},reactDom={get exports(){return reactDomExports},set exports(j){reactDomExports=j}},reactDom_production_min={},schedulerExports={},scheduler={get exports(){return schedulerExports},set exports(j){schedulerExports=j}},scheduler_production_min={};/**
 * @license React
 * scheduler.production.min.js
 *
 * Copyright (c) Facebook, Inc. and its affiliates.
 *
 * This source code is licensed under the MIT license found in the
 * LICENSE file in the root directory of this source tree.
 */(function(j){function tt(Xn,ir){var zn=Xn.length;Xn.push(ir);e:for(;0<zn;){var nr=zn-1>>>1,$n=Xn[nr];if(0<yt($n,ir))Xn[nr]=ir,Xn[zn]=$n,zn=nr;else break e}}function ot(Xn){return Xn.length===0?null:Xn[0]}function b(Xn){if(Xn.length===0)return null;var ir=Xn[0],zn=Xn.pop();if(zn!==ir){Xn[0]=zn;e:for(var nr=0,$n=Xn.length,Er=$n>>>1;nr<Er;){var Yn=2*(nr+1)-1,Kt=Xn[Yn],rn=Yn+1,jn=Xn[rn];if(0>yt(Kt,zn))rn<$n&&0>yt(jn,Kt)?(Xn[nr]=jn,Xn[rn]=zn,nr=rn):(Xn[nr]=Kt,Xn[Yn]=zn,nr=Yn);else if(rn<$n&&0>yt(jn,zn))Xn[nr]=jn,Xn[rn]=zn,nr=rn;else break e}}return ir}function yt(Xn,ir){var zn=Xn.sortIndex-ir.sortIndex;return zn!==0?zn:Xn.id-ir.id}if(typeof performance=="object"&&typeof performance.now=="function"){var Et=performance;j.unstable_now=function(){return Et.now()}}else{var kt=Date,Gt=kt.now();j.unstable_now=function(){return kt.now()-Gt}}var Vt=[],an=[],Pn=1,gn=null,dn=3,wn=!1,_n=!1,$t=!1,bn=typeof setTimeout=="function"?setTimeout:null,Ut=typeof clearTimeout=="function"?clearTimeout:null,jt=typeof setImmediate<"u"?setImmediate:null;typeof navigator<"u"&&navigator.scheduling!==void 0&&navigator.scheduling.isInputPending!==void 0&&navigator.scheduling.isInputPending.bind(navigator.scheduling);function Yt(Xn){for(var ir=ot(an);ir!==null;){if(ir.callback===null)b(an);else if(ir.startTime<=Xn)b(an),ir.sortIndex=ir.expirationTime,tt(Vt,ir);else break;ir=ot(an)}}function Bn(Xn){if($t=!1,Yt(Xn),!_n)if(ot(Vt)!==null)_n=!0,yr(un);else{var ir=ot(an);ir!==null&&Hr(Bn,ir.startTime-Xn)}}function un(Xn,ir){_n=!1,$t&&($t=!1,Ut(Wt),Wt=-1),wn=!0;var zn=dn;try{for(Yt(ir),gn=ot(Vt);gn!==null&&(!(gn.expirationTime>ir)||Xn&&!pn());){var nr=gn.callback;if(typeof nr=="function"){gn.callback=null,dn=gn.priorityLevel;var $n=nr(gn.expirationTime<=ir);ir=j.unstable_now(),typeof $n=="function"?gn.callback=$n:gn===ot(Vt)&&b(Vt),Yt(ir)}else b(Vt);gn=ot(Vt)}if(gn!==null)var Er=!0;else{var Yn=ot(an);Yn!==null&&Hr(Bn,Yn.startTime-ir),Er=!1}return Er}finally{gn=null,dn=zn,wn=!1}}var Cn=!1,Qt=null,Wt=-1,Zt=5,En=-1;function pn(){return!(j.unstable_now()-En<Zt)}function er(){if(Qt!==null){var Xn=j.unstable_now();En=Xn;var ir=!0;try{ir=Qt(!0,Xn)}finally{ir?Ir():(Cn=!1,Qt=null)}}else Cn=!1}var Ir;if(typeof jt=="function")Ir=function(){jt(er)};else if(typeof MessageChannel<"u"){var Dr=new MessageChannel,Vr=Dr.port2;Dr.port1.onmessage=er,Ir=function(){Vr.postMessage(null)}}else Ir=function(){bn(er,0)};function yr(Xn){Qt=Xn,Cn||(Cn=!0,Ir())}function Hr(Xn,ir){Wt=bn(function(){Xn(j.unstable_now())},ir)}j.unstable_IdlePriority=5,j.unstable_ImmediatePriority=1,j.unstable_LowPriority=4,j.unstable_NormalPriority=3,j.unstable_Profiling=null,j.unstable_UserBlockingPriority=2,j.unstable_cancelCallback=function(Xn){Xn.callback=null},j.unstable_continueExecution=function(){_n||wn||(_n=!0,yr(un))},j.unstable_forceFrameRate=function(Xn){0>Xn||125<Xn?console.error("forceFrameRate takes a positive int between 0 and 125, forcing frame rates higher than 125 fps is not supported"):Zt=0<Xn?Math.floor(1e3/Xn):5},j.unstable_getCurrentPriorityLevel=function(){return dn},j.unstable_getFirstCallbackNode=function(){return ot(Vt)},j.unstable_next=function(Xn){switch(dn){case 1:case 2:case 3:var ir=3;break;default:ir=dn}var zn=dn;dn=ir;try{return Xn()}finally{dn=zn}},j.unstable_pauseExecution=function(){},j.unstable_requestPaint=function(){},j.unstable_runWithPriority=function(Xn,ir){switch(Xn){case 1:case 2:case 3:case 4:case 5:break;default:Xn=3}var zn=dn;dn=Xn;try{return ir()}finally{dn=zn}},j.unstable_scheduleCallback=function(Xn,ir,zn){var nr=j.unstable_now();switch(typeof zn=="object"&&zn!==null?(zn=zn.delay,zn=typeof zn=="number"&&0<zn?nr+zn:nr):zn=nr,Xn){case 1:var $n=-1;break;case 2:$n=250;break;case 5:$n=1073741823;break;case 4:$n=1e4;break;default:$n=5e3}return $n=zn+$n,Xn={id:Pn++,callback:ir,priorityLevel:Xn,startTime:zn,expirationTime:$n,sortIndex:-1},zn>nr?(Xn.sortIndex=zn,tt(an,Xn),ot(Vt)===null&&Xn===ot(an)&&($t?(Ut(Wt),Wt=-1):$t=!0,Hr(Bn,zn-nr))):(Xn.sortIndex=$n,tt(Vt,Xn),_n||wn||(_n=!0,yr(un))),Xn},j.unstable_shouldYield=pn,j.unstable_wrapCallback=function(Xn){var ir=dn;return function(){var zn=dn;dn=ir;try{return Xn.apply(this,arguments)}finally{dn=zn}}}})(scheduler_production_min);(function(j){j.exports=scheduler_production_min})(scheduler);/**
 * @license React
 * react-dom.production.min.js
 *
 * Copyright (c) Facebook, Inc. and its affiliates.
 *
 * This source code is licensed under the MIT license found in the
 * LICENSE file in the root directory of this source tree.
 */var aa=reactExports,ca=schedulerExports;function p(j){for(var tt="https://reactjs.org/docs/error-decoder.html?invariant="+j,ot=1;ot<arguments.length;ot++)tt+="&args[]="+encodeURIComponent(arguments[ot]);return"Minified React error #"+j+"; visit "+tt+" for the full message or use the non-minified dev environment for full errors and additional helpful warnings."}var da=new Set,ea={};function fa(j,tt){ha(j,tt),ha(j+"Capture",tt)}function ha(j,tt){for(ea[j]=tt,j=0;j<tt.length;j++)da.add(tt[j])}var ia=!(typeof window>"u"||typeof window.document>"u"||typeof window.document.createElement>"u"),ja=Object.prototype.hasOwnProperty,ka=/^[:A-Z_a-z\u00C0-\u00D6\u00D8-\u00F6\u00F8-\u02FF\u0370-\u037D\u037F-\u1FFF\u200C-\u200D\u2070-\u218F\u2C00-\u2FEF\u3001-\uD7FF\uF900-\uFDCF\uFDF0-\uFFFD][:A-Z_a-z\u00C0-\u00D6\u00D8-\u00F6\u00F8-\u02FF\u0370-\u037D\u037F-\u1FFF\u200C-\u200D\u2070-\u218F\u2C00-\u2FEF\u3001-\uD7FF\uF900-\uFDCF\uFDF0-\uFFFD\-.0-9\u00B7\u0300-\u036F\u203F-\u2040]*$/,la={},ma={};function oa(j){return ja.call(ma,j)?!0:ja.call(la,j)?!1:ka.test(j)?ma[j]=!0:(la[j]=!0,!1)}function pa(j,tt,ot,b){if(ot!==null&&ot.type===0)return!1;switch(typeof tt){case"function":case"symbol":return!0;case"boolean":return b?!1:ot!==null?!ot.acceptsBooleans:(j=j.toLowerCase().slice(0,5),j!=="data-"&&j!=="aria-");default:return!1}}function qa(j,tt,ot,b){if(tt===null||typeof tt>"u"||pa(j,tt,ot,b))return!0;if(b)return!1;if(ot!==null)switch(ot.type){case 3:return!tt;case 4:return tt===!1;case 5:return isNaN(tt);case 6:return isNaN(tt)||1>tt}return!1}function v(j,tt,ot,b,yt,Et,kt){this.acceptsBooleans=tt===2||tt===3||tt===4,this.attributeName=b,this.attributeNamespace=yt,this.mustUseProperty=ot,this.propertyName=j,this.type=tt,this.sanitizeURL=Et,this.removeEmptyString=kt}var z={};"children dangerouslySetInnerHTML defaultValue defaultChecked innerHTML suppressContentEditableWarning suppressHydrationWarning style".split(" ").forEach(function(j){z[j]=new v(j,0,!1,j,null,!1,!1)});[["acceptCharset","accept-charset"],["className","class"],["htmlFor","for"],["httpEquiv","http-equiv"]].forEach(function(j){var tt=j[0];z[tt]=new v(tt,1,!1,j[1],null,!1,!1)});["contentEditable","draggable","spellCheck","value"].forEach(function(j){z[j]=new v(j,2,!1,j.toLowerCase(),null,!1,!1)});["autoReverse","externalResourcesRequired","focusable","preserveAlpha"].forEach(function(j){z[j]=new v(j,2,!1,j,null,!1,!1)});"allowFullScreen async autoFocus autoPlay controls default defer disabled disablePictureInPicture disableRemotePlayback formNoValidate hidden loop noModule noValidate open playsInline readOnly required reversed scoped seamless itemScope".split(" ").forEach(function(j){z[j]=new v(j,3,!1,j.toLowerCase(),null,!1,!1)});["checked","multiple","muted","selected"].forEach(function(j){z[j]=new v(j,3,!0,j,null,!1,!1)});["capture","download"].forEach(function(j){z[j]=new v(j,4,!1,j,null,!1,!1)});["cols","rows","size","span"].forEach(function(j){z[j]=new v(j,6,!1,j,null,!1,!1)});["rowSpan","start"].forEach(function(j){z[j]=new v(j,5,!1,j.toLowerCase(),null,!1,!1)});var ra=/[\-:]([a-z])/g;function sa(j){return j[1].toUpperCase()}"accent-height alignment-baseline arabic-form baseline-shift cap-height clip-path clip-rule color-interpolation color-interpolation-filters color-profile color-rendering dominant-baseline enable-background fill-opacity fill-rule flood-color flood-opacity font-family font-size font-size-adjust font-stretch font-style font-variant font-weight glyph-name glyph-orientation-horizontal glyph-orientation-vertical horiz-adv-x horiz-origin-x image-rendering letter-spacing lighting-color marker-end marker-mid marker-start overline-position overline-thickness paint-order panose-1 pointer-events rendering-intent shape-rendering stop-color stop-opacity strikethrough-position strikethrough-thickness stroke-dasharray stroke-dashoffset stroke-linecap stroke-linejoin stroke-miterlimit stroke-opacity stroke-width text-anchor text-decoration text-rendering underline-position underline-thickness unicode-bidi unicode-range units-per-em v-alphabetic v-hanging v-ideographic v-mathematical vector-effect vert-adv-y vert-origin-x vert-origin-y word-spacing writing-mode xmlns:xlink x-height".split(" ").forEach(function(j){var tt=j.replace(ra,sa);z[tt]=new v(tt,1,!1,j,null,!1,!1)});"xlink:actuate xlink:arcrole xlink:role xlink:show xlink:title xlink:type".split(" ").forEach(function(j){var tt=j.replace(ra,sa);z[tt]=new v(tt,1,!1,j,"http://www.w3.org/1999/xlink",!1,!1)});["xml:base","xml:lang","xml:space"].forEach(function(j){var tt=j.replace(ra,sa);z[tt]=new v(tt,1,!1,j,"http://www.w3.org/XML/1998/namespace",!1,!1)});["tabIndex","crossOrigin"].forEach(function(j){z[j]=new v(j,1,!1,j.toLowerCase(),null,!1,!1)});z.xlinkHref=new v("xlinkHref",1,!1,"xlink:href","http://www.w3.org/1999/xlink",!0,!1);["src","href","action","formAction"].forEach(function(j){z[j]=new v(j,1,!1,j.toLowerCase(),null,!0,!0)});function ta(j,tt,ot,b){var yt=z.hasOwnProperty(tt)?z[tt]:null;(yt!==null?yt.type!==0:b||!(2<tt.length)||tt[0]!=="o"&&tt[0]!=="O"||tt[1]!=="n"&&tt[1]!=="N")&&(qa(tt,ot,yt,b)&&(ot=null),b||yt===null?oa(tt)&&(ot===null?j.removeAttribute(tt):j.setAttribute(tt,""+ot)):yt.mustUseProperty?j[yt.propertyName]=ot===null?yt.type===3?!1:"":ot:(tt=yt.attributeName,b=yt.attributeNamespace,ot===null?j.removeAttribute(tt):(yt=yt.type,ot=yt===3||yt===4&&ot===!0?"":""+ot,b?j.setAttributeNS(b,tt,ot):j.setAttribute(tt,ot))))}var ua=aa.__SECRET_INTERNALS_DO_NOT_USE_OR_YOU_WILL_BE_FIRED,va=Symbol.for("react.element"),wa=Symbol.for("react.portal"),ya=Symbol.for("react.fragment"),za=Symbol.for("react.strict_mode"),Aa=Symbol.for("react.profiler"),Ba=Symbol.for("react.provider"),Ca=Symbol.for("react.context"),Da=Symbol.for("react.forward_ref"),Ea=Symbol.for("react.suspense"),Fa=Symbol.for("react.suspense_list"),Ga=Symbol.for("react.memo"),Ha=Symbol.for("react.lazy"),Ia=Symbol.for("react.offscreen"),Ja=Symbol.iterator;function Ka(j){return j===null||typeof j!="object"?null:(j=Ja&&j[Ja]||j["@@iterator"],typeof j=="function"?j:null)}var A=Object.assign,La;function Ma(j){if(La===void 0)try{throw Error()}catch(ot){var tt=ot.stack.trim().match(/\n( *(at )?)/);La=tt&&tt[1]||""}return`
`+La+j}var Na=!1;function Oa(j,tt){if(!j||Na)return"";Na=!0;var ot=Error.prepareStackTrace;Error.prepareStackTrace=void 0;try{if(tt)if(tt=function(){throw Error()},Object.defineProperty(tt.prototype,"props",{set:function(){throw Error()}}),typeof Reflect=="object"&&Reflect.construct){try{Reflect.construct(tt,[])}catch(an){var b=an}Reflect.construct(j,[],tt)}else{try{tt.call()}catch(an){b=an}j.call(tt.prototype)}else{try{throw Error()}catch(an){b=an}j()}}catch(an){if(an&&b&&typeof an.stack=="string"){for(var yt=an.stack.split(`
`),Et=b.stack.split(`
`),kt=yt.length-1,Gt=Et.length-1;1<=kt&&0<=Gt&&yt[kt]!==Et[Gt];)Gt--;for(;1<=kt&&0<=Gt;kt--,Gt--)if(yt[kt]!==Et[Gt]){if(kt!==1||Gt!==1)do if(kt--,Gt--,0>Gt||yt[kt]!==Et[Gt]){var Vt=`
`+yt[kt].replace(" at new "," at ");return j.displayName&&Vt.includes("<anonymous>")&&(Vt=Vt.replace("<anonymous>",j.displayName)),Vt}while(1<=kt&&0<=Gt);break}}}finally{Na=!1,Error.prepareStackTrace=ot}return(j=j?j.displayName||j.name:"")?Ma(j):""}function Pa(j){switch(j.tag){case 5:return Ma(j.type);case 16:return Ma("Lazy");case 13:return Ma("Suspense");case 19:return Ma("SuspenseList");case 0:case 2:case 15:return j=Oa(j.type,!1),j;case 11:return j=Oa(j.type.render,!1),j;case 1:return j=Oa(j.type,!0),j;default:return""}}function Qa(j){if(j==null)return null;if(typeof j=="function")return j.displayName||j.name||null;if(typeof j=="string")return j;switch(j){case ya:return"Fragment";case wa:return"Portal";case Aa:return"Profiler";case za:return"StrictMode";case Ea:return"Suspense";case Fa:return"SuspenseList"}if(typeof j=="object")switch(j.$$typeof){case Ca:return(j.displayName||"Context")+".Consumer";case Ba:return(j._context.displayName||"Context")+".Provider";case Da:var tt=j.render;return j=j.displayName,j||(j=tt.displayName||tt.name||"",j=j!==""?"ForwardRef("+j+")":"ForwardRef"),j;case Ga:return tt=j.displayName||null,tt!==null?tt:Qa(j.type)||"Memo";case Ha:tt=j._payload,j=j._init;try{return Qa(j(tt))}catch{}}return null}function Ra(j){var tt=j.type;switch(j.tag){case 24:return"Cache";case 9:return(tt.displayName||"Context")+".Consumer";case 10:return(tt._context.displayName||"Context")+".Provider";case 18:return"DehydratedFragment";case 11:return j=tt.render,j=j.displayName||j.name||"",tt.displayName||(j!==""?"ForwardRef("+j+")":"ForwardRef");case 7:return"Fragment";case 5:return tt;case 4:return"Portal";case 3:return"Root";case 6:return"Text";case 16:return Qa(tt);case 8:return tt===za?"StrictMode":"Mode";case 22:return"Offscreen";case 12:return"Profiler";case 21:return"Scope";case 13:return"Suspense";case 19:return"SuspenseList";case 25:return"TracingMarker";case 1:case 0:case 17:case 2:case 14:case 15:if(typeof tt=="function")return tt.displayName||tt.name||null;if(typeof tt=="string")return tt}return null}function Sa(j){switch(typeof j){case"boolean":case"number":case"string":case"undefined":return j;case"object":return j;default:return""}}function Ta(j){var tt=j.type;return(j=j.nodeName)&&j.toLowerCase()==="input"&&(tt==="checkbox"||tt==="radio")}function Ua(j){var tt=Ta(j)?"checked":"value",ot=Object.getOwnPropertyDescriptor(j.constructor.prototype,tt),b=""+j[tt];if(!j.hasOwnProperty(tt)&&typeof ot<"u"&&typeof ot.get=="function"&&typeof ot.set=="function"){var yt=ot.get,Et=ot.set;return Object.defineProperty(j,tt,{configurable:!0,get:function(){return yt.call(this)},set:function(kt){b=""+kt,Et.call(this,kt)}}),Object.defineProperty(j,tt,{enumerable:ot.enumerable}),{getValue:function(){return b},setValue:function(kt){b=""+kt},stopTracking:function(){j._valueTracker=null,delete j[tt]}}}}function Va(j){j._valueTracker||(j._valueTracker=Ua(j))}function Wa(j){if(!j)return!1;var tt=j._valueTracker;if(!tt)return!0;var ot=tt.getValue(),b="";return j&&(b=Ta(j)?j.checked?"true":"false":j.value),j=b,j!==ot?(tt.setValue(j),!0):!1}function Xa(j){if(j=j||(typeof document<"u"?document:void 0),typeof j>"u")return null;try{return j.activeElement||j.body}catch{return j.body}}function Ya(j,tt){var ot=tt.checked;return A({},tt,{defaultChecked:void 0,defaultValue:void 0,value:void 0,checked:ot??j._wrapperState.initialChecked})}function Za(j,tt){var ot=tt.defaultValue==null?"":tt.defaultValue,b=tt.checked!=null?tt.checked:tt.defaultChecked;ot=Sa(tt.value!=null?tt.value:ot),j._wrapperState={initialChecked:b,initialValue:ot,controlled:tt.type==="checkbox"||tt.type==="radio"?tt.checked!=null:tt.value!=null}}function ab(j,tt){tt=tt.checked,tt!=null&&ta(j,"checked",tt,!1)}function bb(j,tt){ab(j,tt);var ot=Sa(tt.value),b=tt.type;if(ot!=null)b==="number"?(ot===0&&j.value===""||j.value!=ot)&&(j.value=""+ot):j.value!==""+ot&&(j.value=""+ot);else if(b==="submit"||b==="reset"){j.removeAttribute("value");return}tt.hasOwnProperty("value")?cb(j,tt.type,ot):tt.hasOwnProperty("defaultValue")&&cb(j,tt.type,Sa(tt.defaultValue)),tt.checked==null&&tt.defaultChecked!=null&&(j.defaultChecked=!!tt.defaultChecked)}function db(j,tt,ot){if(tt.hasOwnProperty("value")||tt.hasOwnProperty("defaultValue")){var b=tt.type;if(!(b!=="submit"&&b!=="reset"||tt.value!==void 0&&tt.value!==null))return;tt=""+j._wrapperState.initialValue,ot||tt===j.value||(j.value=tt),j.defaultValue=tt}ot=j.name,ot!==""&&(j.name=""),j.defaultChecked=!!j._wrapperState.initialChecked,ot!==""&&(j.name=ot)}function cb(j,tt,ot){(tt!=="number"||Xa(j.ownerDocument)!==j)&&(ot==null?j.defaultValue=""+j._wrapperState.initialValue:j.defaultValue!==""+ot&&(j.defaultValue=""+ot))}var eb=Array.isArray;function fb(j,tt,ot,b){if(j=j.options,tt){tt={};for(var yt=0;yt<ot.length;yt++)tt["$"+ot[yt]]=!0;for(ot=0;ot<j.length;ot++)yt=tt.hasOwnProperty("$"+j[ot].value),j[ot].selected!==yt&&(j[ot].selected=yt),yt&&b&&(j[ot].defaultSelected=!0)}else{for(ot=""+Sa(ot),tt=null,yt=0;yt<j.length;yt++){if(j[yt].value===ot){j[yt].selected=!0,b&&(j[yt].defaultSelected=!0);return}tt!==null||j[yt].disabled||(tt=j[yt])}tt!==null&&(tt.selected=!0)}}function gb(j,tt){if(tt.dangerouslySetInnerHTML!=null)throw Error(p(91));return A({},tt,{value:void 0,defaultValue:void 0,children:""+j._wrapperState.initialValue})}function hb(j,tt){var ot=tt.value;if(ot==null){if(ot=tt.children,tt=tt.defaultValue,ot!=null){if(tt!=null)throw Error(p(92));if(eb(ot)){if(1<ot.length)throw Error(p(93));ot=ot[0]}tt=ot}tt==null&&(tt=""),ot=tt}j._wrapperState={initialValue:Sa(ot)}}function ib(j,tt){var ot=Sa(tt.value),b=Sa(tt.defaultValue);ot!=null&&(ot=""+ot,ot!==j.value&&(j.value=ot),tt.defaultValue==null&&j.defaultValue!==ot&&(j.defaultValue=ot)),b!=null&&(j.defaultValue=""+b)}function jb(j){var tt=j.textContent;tt===j._wrapperState.initialValue&&tt!==""&&tt!==null&&(j.value=tt)}function kb(j){switch(j){case"svg":return"http://www.w3.org/2000/svg";case"math":return"http://www.w3.org/1998/Math/MathML";default:return"http://www.w3.org/1999/xhtml"}}function lb(j,tt){return j==null||j==="http://www.w3.org/1999/xhtml"?kb(tt):j==="http://www.w3.org/2000/svg"&&tt==="foreignObject"?"http://www.w3.org/1999/xhtml":j}var mb,nb=function(j){return typeof MSApp<"u"&&MSApp.execUnsafeLocalFunction?function(tt,ot,b,yt){MSApp.execUnsafeLocalFunction(function(){return j(tt,ot,b,yt)})}:j}(function(j,tt){if(j.namespaceURI!=="http://www.w3.org/2000/svg"||"innerHTML"in j)j.innerHTML=tt;else{for(mb=mb||document.createElement("div"),mb.innerHTML="<svg>"+tt.valueOf().toString()+"</svg>",tt=mb.firstChild;j.firstChild;)j.removeChild(j.firstChild);for(;tt.firstChild;)j.appendChild(tt.firstChild)}});function ob(j,tt){if(tt){var ot=j.firstChild;if(ot&&ot===j.lastChild&&ot.nodeType===3){ot.nodeValue=tt;return}}j.textContent=tt}var pb={animationIterationCount:!0,aspectRatio:!0,borderImageOutset:!0,borderImageSlice:!0,borderImageWidth:!0,boxFlex:!0,boxFlexGroup:!0,boxOrdinalGroup:!0,columnCount:!0,columns:!0,flex:!0,flexGrow:!0,flexPositive:!0,flexShrink:!0,flexNegative:!0,flexOrder:!0,gridArea:!0,gridRow:!0,gridRowEnd:!0,gridRowSpan:!0,gridRowStart:!0,gridColumn:!0,gridColumnEnd:!0,gridColumnSpan:!0,gridColumnStart:!0,fontWeight:!0,lineClamp:!0,lineHeight:!0,opacity:!0,order:!0,orphans:!0,tabSize:!0,widows:!0,zIndex:!0,zoom:!0,fillOpacity:!0,floodOpacity:!0,stopOpacity:!0,strokeDasharray:!0,strokeDashoffset:!0,strokeMiterlimit:!0,strokeOpacity:!0,strokeWidth:!0},qb=["Webkit","ms","Moz","O"];Object.keys(pb).forEach(function(j){qb.forEach(function(tt){tt=tt+j.charAt(0).toUpperCase()+j.substring(1),pb[tt]=pb[j]})});function rb(j,tt,ot){return tt==null||typeof tt=="boolean"||tt===""?"":ot||typeof tt!="number"||tt===0||pb.hasOwnProperty(j)&&pb[j]?(""+tt).trim():tt+"px"}function sb(j,tt){j=j.style;for(var ot in tt)if(tt.hasOwnProperty(ot)){var b=ot.indexOf("--")===0,yt=rb(ot,tt[ot],b);ot==="float"&&(ot="cssFloat"),b?j.setProperty(ot,yt):j[ot]=yt}}var tb=A({menuitem:!0},{area:!0,base:!0,br:!0,col:!0,embed:!0,hr:!0,img:!0,input:!0,keygen:!0,link:!0,meta:!0,param:!0,source:!0,track:!0,wbr:!0});function ub(j,tt){if(tt){if(tb[j]&&(tt.children!=null||tt.dangerouslySetInnerHTML!=null))throw Error(p(137,j));if(tt.dangerouslySetInnerHTML!=null){if(tt.children!=null)throw Error(p(60));if(typeof tt.dangerouslySetInnerHTML!="object"||!("__html"in tt.dangerouslySetInnerHTML))throw Error(p(61))}if(tt.style!=null&&typeof tt.style!="object")throw Error(p(62))}}function vb(j,tt){if(j.indexOf("-")===-1)return typeof tt.is=="string";switch(j){case"annotation-xml":case"color-profile":case"font-face":case"font-face-src":case"font-face-uri":case"font-face-format":case"font-face-name":case"missing-glyph":return!1;default:return!0}}var wb=null;function xb(j){return j=j.target||j.srcElement||window,j.correspondingUseElement&&(j=j.correspondingUseElement),j.nodeType===3?j.parentNode:j}var yb=null,zb=null,Ab=null;function Bb(j){if(j=Cb(j)){if(typeof yb!="function")throw Error(p(280));var tt=j.stateNode;tt&&(tt=Db(tt),yb(j.stateNode,j.type,tt))}}function Eb(j){zb?Ab?Ab.push(j):Ab=[j]:zb=j}function Fb(){if(zb){var j=zb,tt=Ab;if(Ab=zb=null,Bb(j),tt)for(j=0;j<tt.length;j++)Bb(tt[j])}}function Gb(j,tt){return j(tt)}function Hb(){}var Ib=!1;function Jb(j,tt,ot){if(Ib)return j(tt,ot);Ib=!0;try{return Gb(j,tt,ot)}finally{Ib=!1,(zb!==null||Ab!==null)&&(Hb(),Fb())}}function Kb(j,tt){var ot=j.stateNode;if(ot===null)return null;var b=Db(ot);if(b===null)return null;ot=b[tt];e:switch(tt){case"onClick":case"onClickCapture":case"onDoubleClick":case"onDoubleClickCapture":case"onMouseDown":case"onMouseDownCapture":case"onMouseMove":case"onMouseMoveCapture":case"onMouseUp":case"onMouseUpCapture":case"onMouseEnter":(b=!b.disabled)||(j=j.type,b=!(j==="button"||j==="input"||j==="select"||j==="textarea")),j=!b;break e;default:j=!1}if(j)return null;if(ot&&typeof ot!="function")throw Error(p(231,tt,typeof ot));return ot}var Lb=!1;if(ia)try{var Mb={};Object.defineProperty(Mb,"passive",{get:function(){Lb=!0}}),window.addEventListener("test",Mb,Mb),window.removeEventListener("test",Mb,Mb)}catch{Lb=!1}function Nb(j,tt,ot,b,yt,Et,kt,Gt,Vt){var an=Array.prototype.slice.call(arguments,3);try{tt.apply(ot,an)}catch(Pn){this.onError(Pn)}}var Ob=!1,Pb=null,Qb=!1,Rb=null,Sb={onError:function(j){Ob=!0,Pb=j}};function Tb(j,tt,ot,b,yt,Et,kt,Gt,Vt){Ob=!1,Pb=null,Nb.apply(Sb,arguments)}function Ub(j,tt,ot,b,yt,Et,kt,Gt,Vt){if(Tb.apply(this,arguments),Ob){if(Ob){var an=Pb;Ob=!1,Pb=null}else throw Error(p(198));Qb||(Qb=!0,Rb=an)}}function Vb(j){var tt=j,ot=j;if(j.alternate)for(;tt.return;)tt=tt.return;else{j=tt;do tt=j,tt.flags&4098&&(ot=tt.return),j=tt.return;while(j)}return tt.tag===3?ot:null}function Wb(j){if(j.tag===13){var tt=j.memoizedState;if(tt===null&&(j=j.alternate,j!==null&&(tt=j.memoizedState)),tt!==null)return tt.dehydrated}return null}function Xb(j){if(Vb(j)!==j)throw Error(p(188))}function Yb(j){var tt=j.alternate;if(!tt){if(tt=Vb(j),tt===null)throw Error(p(188));return tt!==j?null:j}for(var ot=j,b=tt;;){var yt=ot.return;if(yt===null)break;var Et=yt.alternate;if(Et===null){if(b=yt.return,b!==null){ot=b;continue}break}if(yt.child===Et.child){for(Et=yt.child;Et;){if(Et===ot)return Xb(yt),j;if(Et===b)return Xb(yt),tt;Et=Et.sibling}throw Error(p(188))}if(ot.return!==b.return)ot=yt,b=Et;else{for(var kt=!1,Gt=yt.child;Gt;){if(Gt===ot){kt=!0,ot=yt,b=Et;break}if(Gt===b){kt=!0,b=yt,ot=Et;break}Gt=Gt.sibling}if(!kt){for(Gt=Et.child;Gt;){if(Gt===ot){kt=!0,ot=Et,b=yt;break}if(Gt===b){kt=!0,b=Et,ot=yt;break}Gt=Gt.sibling}if(!kt)throw Error(p(189))}}if(ot.alternate!==b)throw Error(p(190))}if(ot.tag!==3)throw Error(p(188));return ot.stateNode.current===ot?j:tt}function Zb(j){return j=Yb(j),j!==null?$b(j):null}function $b(j){if(j.tag===5||j.tag===6)return j;for(j=j.child;j!==null;){var tt=$b(j);if(tt!==null)return tt;j=j.sibling}return null}var ac=ca.unstable_scheduleCallback,bc=ca.unstable_cancelCallback,cc=ca.unstable_shouldYield,dc=ca.unstable_requestPaint,B=ca.unstable_now,ec=ca.unstable_getCurrentPriorityLevel,fc=ca.unstable_ImmediatePriority,gc=ca.unstable_UserBlockingPriority,hc=ca.unstable_NormalPriority,ic=ca.unstable_LowPriority,jc=ca.unstable_IdlePriority,kc=null,lc=null;function mc(j){if(lc&&typeof lc.onCommitFiberRoot=="function")try{lc.onCommitFiberRoot(kc,j,void 0,(j.current.flags&128)===128)}catch{}}var oc=Math.clz32?Math.clz32:nc,pc=Math.log,qc=Math.LN2;function nc(j){return j>>>=0,j===0?32:31-(pc(j)/qc|0)|0}var rc=64,sc=4194304;function tc(j){switch(j&-j){case 1:return 1;case 2:return 2;case 4:return 4;case 8:return 8;case 16:return 16;case 32:return 32;case 64:case 128:case 256:case 512:case 1024:case 2048:case 4096:case 8192:case 16384:case 32768:case 65536:case 131072:case 262144:case 524288:case 1048576:case 2097152:return j&4194240;case 4194304:case 8388608:case 16777216:case 33554432:case 67108864:return j&130023424;case 134217728:return 134217728;case 268435456:return 268435456;case 536870912:return 536870912;case 1073741824:return 1073741824;default:return j}}function uc(j,tt){var ot=j.pendingLanes;if(ot===0)return 0;var b=0,yt=j.suspendedLanes,Et=j.pingedLanes,kt=ot&268435455;if(kt!==0){var Gt=kt&~yt;Gt!==0?b=tc(Gt):(Et&=kt,Et!==0&&(b=tc(Et)))}else kt=ot&~yt,kt!==0?b=tc(kt):Et!==0&&(b=tc(Et));if(b===0)return 0;if(tt!==0&&tt!==b&&!(tt&yt)&&(yt=b&-b,Et=tt&-tt,yt>=Et||yt===16&&(Et&4194240)!==0))return tt;if(b&4&&(b|=ot&16),tt=j.entangledLanes,tt!==0)for(j=j.entanglements,tt&=b;0<tt;)ot=31-oc(tt),yt=1<<ot,b|=j[ot],tt&=~yt;return b}function vc(j,tt){switch(j){case 1:case 2:case 4:return tt+250;case 8:case 16:case 32:case 64:case 128:case 256:case 512:case 1024:case 2048:case 4096:case 8192:case 16384:case 32768:case 65536:case 131072:case 262144:case 524288:case 1048576:case 2097152:return tt+5e3;case 4194304:case 8388608:case 16777216:case 33554432:case 67108864:return-1;case 134217728:case 268435456:case 536870912:case 1073741824:return-1;default:return-1}}function wc(j,tt){for(var ot=j.suspendedLanes,b=j.pingedLanes,yt=j.expirationTimes,Et=j.pendingLanes;0<Et;){var kt=31-oc(Et),Gt=1<<kt,Vt=yt[kt];Vt===-1?(!(Gt&ot)||Gt&b)&&(yt[kt]=vc(Gt,tt)):Vt<=tt&&(j.expiredLanes|=Gt),Et&=~Gt}}function xc(j){return j=j.pendingLanes&-1073741825,j!==0?j:j&1073741824?1073741824:0}function yc(){var j=rc;return rc<<=1,!(rc&4194240)&&(rc=64),j}function zc(j){for(var tt=[],ot=0;31>ot;ot++)tt.push(j);return tt}function Ac(j,tt,ot){j.pendingLanes|=tt,tt!==536870912&&(j.suspendedLanes=0,j.pingedLanes=0),j=j.eventTimes,tt=31-oc(tt),j[tt]=ot}function Bc(j,tt){var ot=j.pendingLanes&~tt;j.pendingLanes=tt,j.suspendedLanes=0,j.pingedLanes=0,j.expiredLanes&=tt,j.mutableReadLanes&=tt,j.entangledLanes&=tt,tt=j.entanglements;var b=j.eventTimes;for(j=j.expirationTimes;0<ot;){var yt=31-oc(ot),Et=1<<yt;tt[yt]=0,b[yt]=-1,j[yt]=-1,ot&=~Et}}function Cc(j,tt){var ot=j.entangledLanes|=tt;for(j=j.entanglements;ot;){var b=31-oc(ot),yt=1<<b;yt&tt|j[b]&tt&&(j[b]|=tt),ot&=~yt}}var C=0;function Dc(j){return j&=-j,1<j?4<j?j&268435455?16:536870912:4:1}var Ec,Fc,Gc,Hc,Ic,Jc=!1,Kc=[],Lc=null,Mc=null,Nc=null,Oc=new Map,Pc=new Map,Qc=[],Rc="mousedown mouseup touchcancel touchend touchstart auxclick dblclick pointercancel pointerdown pointerup dragend dragstart drop compositionend compositionstart keydown keypress keyup input textInput copy cut paste click change contextmenu reset submit".split(" ");function Sc(j,tt){switch(j){case"focusin":case"focusout":Lc=null;break;case"dragenter":case"dragleave":Mc=null;break;case"mouseover":case"mouseout":Nc=null;break;case"pointerover":case"pointerout":Oc.delete(tt.pointerId);break;case"gotpointercapture":case"lostpointercapture":Pc.delete(tt.pointerId)}}function Tc(j,tt,ot,b,yt,Et){return j===null||j.nativeEvent!==Et?(j={blockedOn:tt,domEventName:ot,eventSystemFlags:b,nativeEvent:Et,targetContainers:[yt]},tt!==null&&(tt=Cb(tt),tt!==null&&Fc(tt)),j):(j.eventSystemFlags|=b,tt=j.targetContainers,yt!==null&&tt.indexOf(yt)===-1&&tt.push(yt),j)}function Uc(j,tt,ot,b,yt){switch(tt){case"focusin":return Lc=Tc(Lc,j,tt,ot,b,yt),!0;case"dragenter":return Mc=Tc(Mc,j,tt,ot,b,yt),!0;case"mouseover":return Nc=Tc(Nc,j,tt,ot,b,yt),!0;case"pointerover":var Et=yt.pointerId;return Oc.set(Et,Tc(Oc.get(Et)||null,j,tt,ot,b,yt)),!0;case"gotpointercapture":return Et=yt.pointerId,Pc.set(Et,Tc(Pc.get(Et)||null,j,tt,ot,b,yt)),!0}return!1}function Vc(j){var tt=Wc(j.target);if(tt!==null){var ot=Vb(tt);if(ot!==null){if(tt=ot.tag,tt===13){if(tt=Wb(ot),tt!==null){j.blockedOn=tt,Ic(j.priority,function(){Gc(ot)});return}}else if(tt===3&&ot.stateNode.current.memoizedState.isDehydrated){j.blockedOn=ot.tag===3?ot.stateNode.containerInfo:null;return}}}j.blockedOn=null}function Xc(j){if(j.blockedOn!==null)return!1;for(var tt=j.targetContainers;0<tt.length;){var ot=Yc(j.domEventName,j.eventSystemFlags,tt[0],j.nativeEvent);if(ot===null){ot=j.nativeEvent;var b=new ot.constructor(ot.type,ot);wb=b,ot.target.dispatchEvent(b),wb=null}else return tt=Cb(ot),tt!==null&&Fc(tt),j.blockedOn=ot,!1;tt.shift()}return!0}function Zc(j,tt,ot){Xc(j)&&ot.delete(tt)}function $c(){Jc=!1,Lc!==null&&Xc(Lc)&&(Lc=null),Mc!==null&&Xc(Mc)&&(Mc=null),Nc!==null&&Xc(Nc)&&(Nc=null),Oc.forEach(Zc),Pc.forEach(Zc)}function ad(j,tt){j.blockedOn===tt&&(j.blockedOn=null,Jc||(Jc=!0,ca.unstable_scheduleCallback(ca.unstable_NormalPriority,$c)))}function bd(j){function tt(yt){return ad(yt,j)}if(0<Kc.length){ad(Kc[0],j);for(var ot=1;ot<Kc.length;ot++){var b=Kc[ot];b.blockedOn===j&&(b.blockedOn=null)}}for(Lc!==null&&ad(Lc,j),Mc!==null&&ad(Mc,j),Nc!==null&&ad(Nc,j),Oc.forEach(tt),Pc.forEach(tt),ot=0;ot<Qc.length;ot++)b=Qc[ot],b.blockedOn===j&&(b.blockedOn=null);for(;0<Qc.length&&(ot=Qc[0],ot.blockedOn===null);)Vc(ot),ot.blockedOn===null&&Qc.shift()}var cd=ua.ReactCurrentBatchConfig,dd=!0;function ed(j,tt,ot,b){var yt=C,Et=cd.transition;cd.transition=null;try{C=1,fd(j,tt,ot,b)}finally{C=yt,cd.transition=Et}}function gd(j,tt,ot,b){var yt=C,Et=cd.transition;cd.transition=null;try{C=4,fd(j,tt,ot,b)}finally{C=yt,cd.transition=Et}}function fd(j,tt,ot,b){if(dd){var yt=Yc(j,tt,ot,b);if(yt===null)hd(j,tt,b,id,ot),Sc(j,b);else if(Uc(yt,j,tt,ot,b))b.stopPropagation();else if(Sc(j,b),tt&4&&-1<Rc.indexOf(j)){for(;yt!==null;){var Et=Cb(yt);if(Et!==null&&Ec(Et),Et=Yc(j,tt,ot,b),Et===null&&hd(j,tt,b,id,ot),Et===yt)break;yt=Et}yt!==null&&b.stopPropagation()}else hd(j,tt,b,null,ot)}}var id=null;function Yc(j,tt,ot,b){if(id=null,j=xb(b),j=Wc(j),j!==null)if(tt=Vb(j),tt===null)j=null;else if(ot=tt.tag,ot===13){if(j=Wb(tt),j!==null)return j;j=null}else if(ot===3){if(tt.stateNode.current.memoizedState.isDehydrated)return tt.tag===3?tt.stateNode.containerInfo:null;j=null}else tt!==j&&(j=null);return id=j,null}function jd(j){switch(j){case"cancel":case"click":case"close":case"contextmenu":case"copy":case"cut":case"auxclick":case"dblclick":case"dragend":case"dragstart":case"drop":case"focusin":case"focusout":case"input":case"invalid":case"keydown":case"keypress":case"keyup":case"mousedown":case"mouseup":case"paste":case"pause":case"play":case"pointercancel":case"pointerdown":case"pointerup":case"ratechange":case"reset":case"resize":case"seeked":case"submit":case"touchcancel":case"touchend":case"touchstart":case"volumechange":case"change":case"selectionchange":case"textInput":case"compositionstart":case"compositionend":case"compositionupdate":case"beforeblur":case"afterblur":case"beforeinput":case"blur":case"fullscreenchange":case"focus":case"hashchange":case"popstate":case"select":case"selectstart":return 1;case"drag":case"dragenter":case"dragexit":case"dragleave":case"dragover":case"mousemove":case"mouseout":case"mouseover":case"pointermove":case"pointerout":case"pointerover":case"scroll":case"toggle":case"touchmove":case"wheel":case"mouseenter":case"mouseleave":case"pointerenter":case"pointerleave":return 4;case"message":switch(ec()){case fc:return 1;case gc:return 4;case hc:case ic:return 16;case jc:return 536870912;default:return 16}default:return 16}}var kd=null,ld=null,md=null;function nd(){if(md)return md;var j,tt=ld,ot=tt.length,b,yt="value"in kd?kd.value:kd.textContent,Et=yt.length;for(j=0;j<ot&&tt[j]===yt[j];j++);var kt=ot-j;for(b=1;b<=kt&&tt[ot-b]===yt[Et-b];b++);return md=yt.slice(j,1<b?1-b:void 0)}function od(j){var tt=j.keyCode;return"charCode"in j?(j=j.charCode,j===0&&tt===13&&(j=13)):j=tt,j===10&&(j=13),32<=j||j===13?j:0}function pd(){return!0}function qd(){return!1}function rd(j){function tt(ot,b,yt,Et,kt){this._reactName=ot,this._targetInst=yt,this.type=b,this.nativeEvent=Et,this.target=kt,this.currentTarget=null;for(var Gt in j)j.hasOwnProperty(Gt)&&(ot=j[Gt],this[Gt]=ot?ot(Et):Et[Gt]);return this.isDefaultPrevented=(Et.defaultPrevented!=null?Et.defaultPrevented:Et.returnValue===!1)?pd:qd,this.isPropagationStopped=qd,this}return A(tt.prototype,{preventDefault:function(){this.defaultPrevented=!0;var ot=this.nativeEvent;ot&&(ot.preventDefault?ot.preventDefault():typeof ot.returnValue!="unknown"&&(ot.returnValue=!1),this.isDefaultPrevented=pd)},stopPropagation:function(){var ot=this.nativeEvent;ot&&(ot.stopPropagation?ot.stopPropagation():typeof ot.cancelBubble!="unknown"&&(ot.cancelBubble=!0),this.isPropagationStopped=pd)},persist:function(){},isPersistent:pd}),tt}var sd={eventPhase:0,bubbles:0,cancelable:0,timeStamp:function(j){return j.timeStamp||Date.now()},defaultPrevented:0,isTrusted:0},td=rd(sd),ud=A({},sd,{view:0,detail:0}),vd=rd(ud),wd,xd,yd,Ad=A({},ud,{screenX:0,screenY:0,clientX:0,clientY:0,pageX:0,pageY:0,ctrlKey:0,shiftKey:0,altKey:0,metaKey:0,getModifierState:zd,button:0,buttons:0,relatedTarget:function(j){return j.relatedTarget===void 0?j.fromElement===j.srcElement?j.toElement:j.fromElement:j.relatedTarget},movementX:function(j){return"movementX"in j?j.movementX:(j!==yd&&(yd&&j.type==="mousemove"?(wd=j.screenX-yd.screenX,xd=j.screenY-yd.screenY):xd=wd=0,yd=j),wd)},movementY:function(j){return"movementY"in j?j.movementY:xd}}),Bd=rd(Ad),Cd=A({},Ad,{dataTransfer:0}),Dd=rd(Cd),Ed=A({},ud,{relatedTarget:0}),Fd=rd(Ed),Gd=A({},sd,{animationName:0,elapsedTime:0,pseudoElement:0}),Hd=rd(Gd),Id=A({},sd,{clipboardData:function(j){return"clipboardData"in j?j.clipboardData:window.clipboardData}}),Jd=rd(Id),Kd=A({},sd,{data:0}),Ld=rd(Kd),Md={Esc:"Escape",Spacebar:" ",Left:"ArrowLeft",Up:"ArrowUp",Right:"ArrowRight",Down:"ArrowDown",Del:"Delete",Win:"OS",Menu:"ContextMenu",Apps:"ContextMenu",Scroll:"ScrollLock",MozPrintableKey:"Unidentified"},Nd={8:"Backspace",9:"Tab",12:"Clear",13:"Enter",16:"Shift",17:"Control",18:"Alt",19:"Pause",20:"CapsLock",27:"Escape",32:" ",33:"PageUp",34:"PageDown",35:"End",36:"Home",37:"ArrowLeft",38:"ArrowUp",39:"ArrowRight",40:"ArrowDown",45:"Insert",46:"Delete",112:"F1",113:"F2",114:"F3",115:"F4",116:"F5",117:"F6",118:"F7",119:"F8",120:"F9",121:"F10",122:"F11",123:"F12",144:"NumLock",145:"ScrollLock",224:"Meta"},Od={Alt:"altKey",Control:"ctrlKey",Meta:"metaKey",Shift:"shiftKey"};function Pd(j){var tt=this.nativeEvent;return tt.getModifierState?tt.getModifierState(j):(j=Od[j])?!!tt[j]:!1}function zd(){return Pd}var Qd=A({},ud,{key:function(j){if(j.key){var tt=Md[j.key]||j.key;if(tt!=="Unidentified")return tt}return j.type==="keypress"?(j=od(j),j===13?"Enter":String.fromCharCode(j)):j.type==="keydown"||j.type==="keyup"?Nd[j.keyCode]||"Unidentified":""},code:0,location:0,ctrlKey:0,shiftKey:0,altKey:0,metaKey:0,repeat:0,locale:0,getModifierState:zd,charCode:function(j){return j.type==="keypress"?od(j):0},keyCode:function(j){return j.type==="keydown"||j.type==="keyup"?j.keyCode:0},which:function(j){return j.type==="keypress"?od(j):j.type==="keydown"||j.type==="keyup"?j.keyCode:0}}),Rd=rd(Qd),Sd=A({},Ad,{pointerId:0,width:0,height:0,pressure:0,tangentialPressure:0,tiltX:0,tiltY:0,twist:0,pointerType:0,isPrimary:0}),Td=rd(Sd),Ud=A({},ud,{touches:0,targetTouches:0,changedTouches:0,altKey:0,metaKey:0,ctrlKey:0,shiftKey:0,getModifierState:zd}),Vd=rd(Ud),Wd=A({},sd,{propertyName:0,elapsedTime:0,pseudoElement:0}),Xd=rd(Wd),Yd=A({},Ad,{deltaX:function(j){return"deltaX"in j?j.deltaX:"wheelDeltaX"in j?-j.wheelDeltaX:0},deltaY:function(j){return"deltaY"in j?j.deltaY:"wheelDeltaY"in j?-j.wheelDeltaY:"wheelDelta"in j?-j.wheelDelta:0},deltaZ:0,deltaMode:0}),Zd=rd(Yd),$d=[9,13,27,32],ae=ia&&"CompositionEvent"in window,be=null;ia&&"documentMode"in document&&(be=document.documentMode);var ce=ia&&"TextEvent"in window&&!be,de=ia&&(!ae||be&&8<be&&11>=be),ee=String.fromCharCode(32),fe=!1;function ge(j,tt){switch(j){case"keyup":return $d.indexOf(tt.keyCode)!==-1;case"keydown":return tt.keyCode!==229;case"keypress":case"mousedown":case"focusout":return!0;default:return!1}}function he(j){return j=j.detail,typeof j=="object"&&"data"in j?j.data:null}var ie=!1;function je(j,tt){switch(j){case"compositionend":return he(tt);case"keypress":return tt.which!==32?null:(fe=!0,ee);case"textInput":return j=tt.data,j===ee&&fe?null:j;default:return null}}function ke(j,tt){if(ie)return j==="compositionend"||!ae&&ge(j,tt)?(j=nd(),md=ld=kd=null,ie=!1,j):null;switch(j){case"paste":return null;case"keypress":if(!(tt.ctrlKey||tt.altKey||tt.metaKey)||tt.ctrlKey&&tt.altKey){if(tt.char&&1<tt.char.length)return tt.char;if(tt.which)return String.fromCharCode(tt.which)}return null;case"compositionend":return de&&tt.locale!=="ko"?null:tt.data;default:return null}}var le={color:!0,date:!0,datetime:!0,"datetime-local":!0,email:!0,month:!0,number:!0,password:!0,range:!0,search:!0,tel:!0,text:!0,time:!0,url:!0,week:!0};function me(j){var tt=j&&j.nodeName&&j.nodeName.toLowerCase();return tt==="input"?!!le[j.type]:tt==="textarea"}function ne(j,tt,ot,b){Eb(b),tt=oe(tt,"onChange"),0<tt.length&&(ot=new td("onChange","change",null,ot,b),j.push({event:ot,listeners:tt}))}var pe=null,qe=null;function re(j){se(j,0)}function te(j){var tt=ue(j);if(Wa(tt))return j}function ve(j,tt){if(j==="change")return tt}var we=!1;if(ia){var xe;if(ia){var ye="oninput"in document;if(!ye){var ze=document.createElement("div");ze.setAttribute("oninput","return;"),ye=typeof ze.oninput=="function"}xe=ye}else xe=!1;we=xe&&(!document.documentMode||9<document.documentMode)}function Ae(){pe&&(pe.detachEvent("onpropertychange",Be),qe=pe=null)}function Be(j){if(j.propertyName==="value"&&te(qe)){var tt=[];ne(tt,qe,j,xb(j)),Jb(re,tt)}}function Ce(j,tt,ot){j==="focusin"?(Ae(),pe=tt,qe=ot,pe.attachEvent("onpropertychange",Be)):j==="focusout"&&Ae()}function De(j){if(j==="selectionchange"||j==="keyup"||j==="keydown")return te(qe)}function Ee(j,tt){if(j==="click")return te(tt)}function Fe(j,tt){if(j==="input"||j==="change")return te(tt)}function Ge(j,tt){return j===tt&&(j!==0||1/j===1/tt)||j!==j&&tt!==tt}var He=typeof Object.is=="function"?Object.is:Ge;function Ie(j,tt){if(He(j,tt))return!0;if(typeof j!="object"||j===null||typeof tt!="object"||tt===null)return!1;var ot=Object.keys(j),b=Object.keys(tt);if(ot.length!==b.length)return!1;for(b=0;b<ot.length;b++){var yt=ot[b];if(!ja.call(tt,yt)||!He(j[yt],tt[yt]))return!1}return!0}function Je(j){for(;j&&j.firstChild;)j=j.firstChild;return j}function Ke(j,tt){var ot=Je(j);j=0;for(var b;ot;){if(ot.nodeType===3){if(b=j+ot.textContent.length,j<=tt&&b>=tt)return{node:ot,offset:tt-j};j=b}e:{for(;ot;){if(ot.nextSibling){ot=ot.nextSibling;break e}ot=ot.parentNode}ot=void 0}ot=Je(ot)}}function Le(j,tt){return j&&tt?j===tt?!0:j&&j.nodeType===3?!1:tt&&tt.nodeType===3?Le(j,tt.parentNode):"contains"in j?j.contains(tt):j.compareDocumentPosition?!!(j.compareDocumentPosition(tt)&16):!1:!1}function Me(){for(var j=window,tt=Xa();tt instanceof j.HTMLIFrameElement;){try{var ot=typeof tt.contentWindow.location.href=="string"}catch{ot=!1}if(ot)j=tt.contentWindow;else break;tt=Xa(j.document)}return tt}function Ne(j){var tt=j&&j.nodeName&&j.nodeName.toLowerCase();return tt&&(tt==="input"&&(j.type==="text"||j.type==="search"||j.type==="tel"||j.type==="url"||j.type==="password")||tt==="textarea"||j.contentEditable==="true")}function Oe(j){var tt=Me(),ot=j.focusedElem,b=j.selectionRange;if(tt!==ot&&ot&&ot.ownerDocument&&Le(ot.ownerDocument.documentElement,ot)){if(b!==null&&Ne(ot)){if(tt=b.start,j=b.end,j===void 0&&(j=tt),"selectionStart"in ot)ot.selectionStart=tt,ot.selectionEnd=Math.min(j,ot.value.length);else if(j=(tt=ot.ownerDocument||document)&&tt.defaultView||window,j.getSelection){j=j.getSelection();var yt=ot.textContent.length,Et=Math.min(b.start,yt);b=b.end===void 0?Et:Math.min(b.end,yt),!j.extend&&Et>b&&(yt=b,b=Et,Et=yt),yt=Ke(ot,Et);var kt=Ke(ot,b);yt&&kt&&(j.rangeCount!==1||j.anchorNode!==yt.node||j.anchorOffset!==yt.offset||j.focusNode!==kt.node||j.focusOffset!==kt.offset)&&(tt=tt.createRange(),tt.setStart(yt.node,yt.offset),j.removeAllRanges(),Et>b?(j.addRange(tt),j.extend(kt.node,kt.offset)):(tt.setEnd(kt.node,kt.offset),j.addRange(tt)))}}for(tt=[],j=ot;j=j.parentNode;)j.nodeType===1&&tt.push({element:j,left:j.scrollLeft,top:j.scrollTop});for(typeof ot.focus=="function"&&ot.focus(),ot=0;ot<tt.length;ot++)j=tt[ot],j.element.scrollLeft=j.left,j.element.scrollTop=j.top}}var Pe=ia&&"documentMode"in document&&11>=document.documentMode,Qe=null,Re=null,Se=null,Te=!1;function Ue(j,tt,ot){var b=ot.window===ot?ot.document:ot.nodeType===9?ot:ot.ownerDocument;Te||Qe==null||Qe!==Xa(b)||(b=Qe,"selectionStart"in b&&Ne(b)?b={start:b.selectionStart,end:b.selectionEnd}:(b=(b.ownerDocument&&b.ownerDocument.defaultView||window).getSelection(),b={anchorNode:b.anchorNode,anchorOffset:b.anchorOffset,focusNode:b.focusNode,focusOffset:b.focusOffset}),Se&&Ie(Se,b)||(Se=b,b=oe(Re,"onSelect"),0<b.length&&(tt=new td("onSelect","select",null,tt,ot),j.push({event:tt,listeners:b}),tt.target=Qe)))}function Ve(j,tt){var ot={};return ot[j.toLowerCase()]=tt.toLowerCase(),ot["Webkit"+j]="webkit"+tt,ot["Moz"+j]="moz"+tt,ot}var We={animationend:Ve("Animation","AnimationEnd"),animationiteration:Ve("Animation","AnimationIteration"),animationstart:Ve("Animation","AnimationStart"),transitionend:Ve("Transition","TransitionEnd")},Xe={},Ye={};ia&&(Ye=document.createElement("div").style,"AnimationEvent"in window||(delete We.animationend.animation,delete We.animationiteration.animation,delete We.animationstart.animation),"TransitionEvent"in window||delete We.transitionend.transition);function Ze(j){if(Xe[j])return Xe[j];if(!We[j])return j;var tt=We[j],ot;for(ot in tt)if(tt.hasOwnProperty(ot)&&ot in Ye)return Xe[j]=tt[ot];return j}var $e=Ze("animationend"),af=Ze("animationiteration"),bf=Ze("animationstart"),cf=Ze("transitionend"),df=new Map,ef="abort auxClick cancel canPlay canPlayThrough click close contextMenu copy cut drag dragEnd dragEnter dragExit dragLeave dragOver dragStart drop durationChange emptied encrypted ended error gotPointerCapture input invalid keyDown keyPress keyUp load loadedData loadedMetadata loadStart lostPointerCapture mouseDown mouseMove mouseOut mouseOver mouseUp paste pause play playing pointerCancel pointerDown pointerMove pointerOut pointerOver pointerUp progress rateChange reset resize seeked seeking stalled submit suspend timeUpdate touchCancel touchEnd touchStart volumeChange scroll toggle touchMove waiting wheel".split(" ");function ff(j,tt){df.set(j,tt),fa(tt,[j])}for(var gf=0;gf<ef.length;gf++){var hf=ef[gf],jf=hf.toLowerCase(),kf=hf[0].toUpperCase()+hf.slice(1);ff(jf,"on"+kf)}ff($e,"onAnimationEnd");ff(af,"onAnimationIteration");ff(bf,"onAnimationStart");ff("dblclick","onDoubleClick");ff("focusin","onFocus");ff("focusout","onBlur");ff(cf,"onTransitionEnd");ha("onMouseEnter",["mouseout","mouseover"]);ha("onMouseLeave",["mouseout","mouseover"]);ha("onPointerEnter",["pointerout","pointerover"]);ha("onPointerLeave",["pointerout","pointerover"]);fa("onChange","change click focusin focusout input keydown keyup selectionchange".split(" "));fa("onSelect","focusout contextmenu dragend focusin keydown keyup mousedown mouseup selectionchange".split(" "));fa("onBeforeInput",["compositionend","keypress","textInput","paste"]);fa("onCompositionEnd","compositionend focusout keydown keypress keyup mousedown".split(" "));fa("onCompositionStart","compositionstart focusout keydown keypress keyup mousedown".split(" "));fa("onCompositionUpdate","compositionupdate focusout keydown keypress keyup mousedown".split(" "));var lf="abort canplay canplaythrough durationchange emptied encrypted ended error loadeddata loadedmetadata loadstart pause play playing progress ratechange resize seeked seeking stalled suspend timeupdate volumechange waiting".split(" "),mf=new Set("cancel close invalid load scroll toggle".split(" ").concat(lf));function nf(j,tt,ot){var b=j.type||"unknown-event";j.currentTarget=ot,Ub(b,tt,void 0,j),j.currentTarget=null}function se(j,tt){tt=(tt&4)!==0;for(var ot=0;ot<j.length;ot++){var b=j[ot],yt=b.event;b=b.listeners;e:{var Et=void 0;if(tt)for(var kt=b.length-1;0<=kt;kt--){var Gt=b[kt],Vt=Gt.instance,an=Gt.currentTarget;if(Gt=Gt.listener,Vt!==Et&&yt.isPropagationStopped())break e;nf(yt,Gt,an),Et=Vt}else for(kt=0;kt<b.length;kt++){if(Gt=b[kt],Vt=Gt.instance,an=Gt.currentTarget,Gt=Gt.listener,Vt!==Et&&yt.isPropagationStopped())break e;nf(yt,Gt,an),Et=Vt}}}if(Qb)throw j=Rb,Qb=!1,Rb=null,j}function D(j,tt){var ot=tt[of];ot===void 0&&(ot=tt[of]=new Set);var b=j+"__bubble";ot.has(b)||(pf(tt,j,2,!1),ot.add(b))}function qf(j,tt,ot){var b=0;tt&&(b|=4),pf(ot,j,b,tt)}var rf="_reactListening"+Math.random().toString(36).slice(2);function sf(j){if(!j[rf]){j[rf]=!0,da.forEach(function(ot){ot!=="selectionchange"&&(mf.has(ot)||qf(ot,!1,j),qf(ot,!0,j))});var tt=j.nodeType===9?j:j.ownerDocument;tt===null||tt[rf]||(tt[rf]=!0,qf("selectionchange",!1,tt))}}function pf(j,tt,ot,b){switch(jd(tt)){case 1:var yt=ed;break;case 4:yt=gd;break;default:yt=fd}ot=yt.bind(null,tt,ot,j),yt=void 0,!Lb||tt!=="touchstart"&&tt!=="touchmove"&&tt!=="wheel"||(yt=!0),b?yt!==void 0?j.addEventListener(tt,ot,{capture:!0,passive:yt}):j.addEventListener(tt,ot,!0):yt!==void 0?j.addEventListener(tt,ot,{passive:yt}):j.addEventListener(tt,ot,!1)}function hd(j,tt,ot,b,yt){var Et=b;if(!(tt&1)&&!(tt&2)&&b!==null)e:for(;;){if(b===null)return;var kt=b.tag;if(kt===3||kt===4){var Gt=b.stateNode.containerInfo;if(Gt===yt||Gt.nodeType===8&&Gt.parentNode===yt)break;if(kt===4)for(kt=b.return;kt!==null;){var Vt=kt.tag;if((Vt===3||Vt===4)&&(Vt=kt.stateNode.containerInfo,Vt===yt||Vt.nodeType===8&&Vt.parentNode===yt))return;kt=kt.return}for(;Gt!==null;){if(kt=Wc(Gt),kt===null)return;if(Vt=kt.tag,Vt===5||Vt===6){b=Et=kt;continue e}Gt=Gt.parentNode}}b=b.return}Jb(function(){var an=Et,Pn=xb(ot),gn=[];e:{var dn=df.get(j);if(dn!==void 0){var wn=td,_n=j;switch(j){case"keypress":if(od(ot)===0)break e;case"keydown":case"keyup":wn=Rd;break;case"focusin":_n="focus",wn=Fd;break;case"focusout":_n="blur",wn=Fd;break;case"beforeblur":case"afterblur":wn=Fd;break;case"click":if(ot.button===2)break e;case"auxclick":case"dblclick":case"mousedown":case"mousemove":case"mouseup":case"mouseout":case"mouseover":case"contextmenu":wn=Bd;break;case"drag":case"dragend":case"dragenter":case"dragexit":case"dragleave":case"dragover":case"dragstart":case"drop":wn=Dd;break;case"touchcancel":case"touchend":case"touchmove":case"touchstart":wn=Vd;break;case $e:case af:case bf:wn=Hd;break;case cf:wn=Xd;break;case"scroll":wn=vd;break;case"wheel":wn=Zd;break;case"copy":case"cut":case"paste":wn=Jd;break;case"gotpointercapture":case"lostpointercapture":case"pointercancel":case"pointerdown":case"pointermove":case"pointerout":case"pointerover":case"pointerup":wn=Td}var $t=(tt&4)!==0,bn=!$t&&j==="scroll",Ut=$t?dn!==null?dn+"Capture":null:dn;$t=[];for(var jt=an,Yt;jt!==null;){Yt=jt;var Bn=Yt.stateNode;if(Yt.tag===5&&Bn!==null&&(Yt=Bn,Ut!==null&&(Bn=Kb(jt,Ut),Bn!=null&&$t.push(tf(jt,Bn,Yt)))),bn)break;jt=jt.return}0<$t.length&&(dn=new wn(dn,_n,null,ot,Pn),gn.push({event:dn,listeners:$t}))}}if(!(tt&7)){e:{if(dn=j==="mouseover"||j==="pointerover",wn=j==="mouseout"||j==="pointerout",dn&&ot!==wb&&(_n=ot.relatedTarget||ot.fromElement)&&(Wc(_n)||_n[uf]))break e;if((wn||dn)&&(dn=Pn.window===Pn?Pn:(dn=Pn.ownerDocument)?dn.defaultView||dn.parentWindow:window,wn?(_n=ot.relatedTarget||ot.toElement,wn=an,_n=_n?Wc(_n):null,_n!==null&&(bn=Vb(_n),_n!==bn||_n.tag!==5&&_n.tag!==6)&&(_n=null)):(wn=null,_n=an),wn!==_n)){if($t=Bd,Bn="onMouseLeave",Ut="onMouseEnter",jt="mouse",(j==="pointerout"||j==="pointerover")&&($t=Td,Bn="onPointerLeave",Ut="onPointerEnter",jt="pointer"),bn=wn==null?dn:ue(wn),Yt=_n==null?dn:ue(_n),dn=new $t(Bn,jt+"leave",wn,ot,Pn),dn.target=bn,dn.relatedTarget=Yt,Bn=null,Wc(Pn)===an&&($t=new $t(Ut,jt+"enter",_n,ot,Pn),$t.target=Yt,$t.relatedTarget=bn,Bn=$t),bn=Bn,wn&&_n)t:{for($t=wn,Ut=_n,jt=0,Yt=$t;Yt;Yt=vf(Yt))jt++;for(Yt=0,Bn=Ut;Bn;Bn=vf(Bn))Yt++;for(;0<jt-Yt;)$t=vf($t),jt--;for(;0<Yt-jt;)Ut=vf(Ut),Yt--;for(;jt--;){if($t===Ut||Ut!==null&&$t===Ut.alternate)break t;$t=vf($t),Ut=vf(Ut)}$t=null}else $t=null;wn!==null&&wf(gn,dn,wn,$t,!1),_n!==null&&bn!==null&&wf(gn,bn,_n,$t,!0)}}e:{if(dn=an?ue(an):window,wn=dn.nodeName&&dn.nodeName.toLowerCase(),wn==="select"||wn==="input"&&dn.type==="file")var un=ve;else if(me(dn))if(we)un=Fe;else{un=De;var Cn=Ce}else(wn=dn.nodeName)&&wn.toLowerCase()==="input"&&(dn.type==="checkbox"||dn.type==="radio")&&(un=Ee);if(un&&(un=un(j,an))){ne(gn,un,ot,Pn);break e}Cn&&Cn(j,dn,an),j==="focusout"&&(Cn=dn._wrapperState)&&Cn.controlled&&dn.type==="number"&&cb(dn,"number",dn.value)}switch(Cn=an?ue(an):window,j){case"focusin":(me(Cn)||Cn.contentEditable==="true")&&(Qe=Cn,Re=an,Se=null);break;case"focusout":Se=Re=Qe=null;break;case"mousedown":Te=!0;break;case"contextmenu":case"mouseup":case"dragend":Te=!1,Ue(gn,ot,Pn);break;case"selectionchange":if(Pe)break;case"keydown":case"keyup":Ue(gn,ot,Pn)}var Qt;if(ae)e:{switch(j){case"compositionstart":var Wt="onCompositionStart";break e;case"compositionend":Wt="onCompositionEnd";break e;case"compositionupdate":Wt="onCompositionUpdate";break e}Wt=void 0}else ie?ge(j,ot)&&(Wt="onCompositionEnd"):j==="keydown"&&ot.keyCode===229&&(Wt="onCompositionStart");Wt&&(de&&ot.locale!=="ko"&&(ie||Wt!=="onCompositionStart"?Wt==="onCompositionEnd"&&ie&&(Qt=nd()):(kd=Pn,ld="value"in kd?kd.value:kd.textContent,ie=!0)),Cn=oe(an,Wt),0<Cn.length&&(Wt=new Ld(Wt,j,null,ot,Pn),gn.push({event:Wt,listeners:Cn}),Qt?Wt.data=Qt:(Qt=he(ot),Qt!==null&&(Wt.data=Qt)))),(Qt=ce?je(j,ot):ke(j,ot))&&(an=oe(an,"onBeforeInput"),0<an.length&&(Pn=new Ld("onBeforeInput","beforeinput",null,ot,Pn),gn.push({event:Pn,listeners:an}),Pn.data=Qt))}se(gn,tt)})}function tf(j,tt,ot){return{instance:j,listener:tt,currentTarget:ot}}function oe(j,tt){for(var ot=tt+"Capture",b=[];j!==null;){var yt=j,Et=yt.stateNode;yt.tag===5&&Et!==null&&(yt=Et,Et=Kb(j,ot),Et!=null&&b.unshift(tf(j,Et,yt)),Et=Kb(j,tt),Et!=null&&b.push(tf(j,Et,yt))),j=j.return}return b}function vf(j){if(j===null)return null;do j=j.return;while(j&&j.tag!==5);return j||null}function wf(j,tt,ot,b,yt){for(var Et=tt._reactName,kt=[];ot!==null&&ot!==b;){var Gt=ot,Vt=Gt.alternate,an=Gt.stateNode;if(Vt!==null&&Vt===b)break;Gt.tag===5&&an!==null&&(Gt=an,yt?(Vt=Kb(ot,Et),Vt!=null&&kt.unshift(tf(ot,Vt,Gt))):yt||(Vt=Kb(ot,Et),Vt!=null&&kt.push(tf(ot,Vt,Gt)))),ot=ot.return}kt.length!==0&&j.push({event:tt,listeners:kt})}var xf=/\r\n?/g,yf=/\u0000|\uFFFD/g;function zf(j){return(typeof j=="string"?j:""+j).replace(xf,`
`).replace(yf,"")}function Af(j,tt,ot){if(tt=zf(tt),zf(j)!==tt&&ot)throw Error(p(425))}function Bf(){}var Cf=null,Df=null;function Ef(j,tt){return j==="textarea"||j==="noscript"||typeof tt.children=="string"||typeof tt.children=="number"||typeof tt.dangerouslySetInnerHTML=="object"&&tt.dangerouslySetInnerHTML!==null&&tt.dangerouslySetInnerHTML.__html!=null}var Ff=typeof setTimeout=="function"?setTimeout:void 0,Gf=typeof clearTimeout=="function"?clearTimeout:void 0,Hf=typeof Promise=="function"?Promise:void 0,Jf=typeof queueMicrotask=="function"?queueMicrotask:typeof Hf<"u"?function(j){return Hf.resolve(null).then(j).catch(If)}:Ff;function If(j){setTimeout(function(){throw j})}function Kf(j,tt){var ot=tt,b=0;do{var yt=ot.nextSibling;if(j.removeChild(ot),yt&&yt.nodeType===8)if(ot=yt.data,ot==="/$"){if(b===0){j.removeChild(yt),bd(tt);return}b--}else ot!=="$"&&ot!=="$?"&&ot!=="$!"||b++;ot=yt}while(ot);bd(tt)}function Lf(j){for(;j!=null;j=j.nextSibling){var tt=j.nodeType;if(tt===1||tt===3)break;if(tt===8){if(tt=j.data,tt==="$"||tt==="$!"||tt==="$?")break;if(tt==="/$")return null}}return j}function Mf(j){j=j.previousSibling;for(var tt=0;j;){if(j.nodeType===8){var ot=j.data;if(ot==="$"||ot==="$!"||ot==="$?"){if(tt===0)return j;tt--}else ot==="/$"&&tt++}j=j.previousSibling}return null}var Nf=Math.random().toString(36).slice(2),Of="__reactFiber$"+Nf,Pf="__reactProps$"+Nf,uf="__reactContainer$"+Nf,of="__reactEvents$"+Nf,Qf="__reactListeners$"+Nf,Rf="__reactHandles$"+Nf;function Wc(j){var tt=j[Of];if(tt)return tt;for(var ot=j.parentNode;ot;){if(tt=ot[uf]||ot[Of]){if(ot=tt.alternate,tt.child!==null||ot!==null&&ot.child!==null)for(j=Mf(j);j!==null;){if(ot=j[Of])return ot;j=Mf(j)}return tt}j=ot,ot=j.parentNode}return null}function Cb(j){return j=j[Of]||j[uf],!j||j.tag!==5&&j.tag!==6&&j.tag!==13&&j.tag!==3?null:j}function ue(j){if(j.tag===5||j.tag===6)return j.stateNode;throw Error(p(33))}function Db(j){return j[Pf]||null}var Sf=[],Tf=-1;function Uf(j){return{current:j}}function E(j){0>Tf||(j.current=Sf[Tf],Sf[Tf]=null,Tf--)}function G(j,tt){Tf++,Sf[Tf]=j.current,j.current=tt}var Vf={},H=Uf(Vf),Wf=Uf(!1),Xf=Vf;function Yf(j,tt){var ot=j.type.contextTypes;if(!ot)return Vf;var b=j.stateNode;if(b&&b.__reactInternalMemoizedUnmaskedChildContext===tt)return b.__reactInternalMemoizedMaskedChildContext;var yt={},Et;for(Et in ot)yt[Et]=tt[Et];return b&&(j=j.stateNode,j.__reactInternalMemoizedUnmaskedChildContext=tt,j.__reactInternalMemoizedMaskedChildContext=yt),yt}function Zf(j){return j=j.childContextTypes,j!=null}function $f(){E(Wf),E(H)}function ag(j,tt,ot){if(H.current!==Vf)throw Error(p(168));G(H,tt),G(Wf,ot)}function bg(j,tt,ot){var b=j.stateNode;if(tt=tt.childContextTypes,typeof b.getChildContext!="function")return ot;b=b.getChildContext();for(var yt in b)if(!(yt in tt))throw Error(p(108,Ra(j)||"Unknown",yt));return A({},ot,b)}function cg(j){return j=(j=j.stateNode)&&j.__reactInternalMemoizedMergedChildContext||Vf,Xf=H.current,G(H,j),G(Wf,Wf.current),!0}function dg(j,tt,ot){var b=j.stateNode;if(!b)throw Error(p(169));ot?(j=bg(j,tt,Xf),b.__reactInternalMemoizedMergedChildContext=j,E(Wf),E(H),G(H,j)):E(Wf),G(Wf,ot)}var eg=null,fg=!1,gg=!1;function hg(j){eg===null?eg=[j]:eg.push(j)}function ig(j){fg=!0,hg(j)}function jg(){if(!gg&&eg!==null){gg=!0;var j=0,tt=C;try{var ot=eg;for(C=1;j<ot.length;j++){var b=ot[j];do b=b(!0);while(b!==null)}eg=null,fg=!1}catch(yt){throw eg!==null&&(eg=eg.slice(j+1)),ac(fc,jg),yt}finally{C=tt,gg=!1}}return null}var kg=[],lg=0,mg=null,ng=0,og=[],pg=0,qg=null,rg=1,sg="";function tg(j,tt){kg[lg++]=ng,kg[lg++]=mg,mg=j,ng=tt}function ug(j,tt,ot){og[pg++]=rg,og[pg++]=sg,og[pg++]=qg,qg=j;var b=rg;j=sg;var yt=32-oc(b)-1;b&=~(1<<yt),ot+=1;var Et=32-oc(tt)+yt;if(30<Et){var kt=yt-yt%5;Et=(b&(1<<kt)-1).toString(32),b>>=kt,yt-=kt,rg=1<<32-oc(tt)+yt|ot<<yt|b,sg=Et+j}else rg=1<<Et|ot<<yt|b,sg=j}function vg(j){j.return!==null&&(tg(j,1),ug(j,1,0))}function wg(j){for(;j===mg;)mg=kg[--lg],kg[lg]=null,ng=kg[--lg],kg[lg]=null;for(;j===qg;)qg=og[--pg],og[pg]=null,sg=og[--pg],og[pg]=null,rg=og[--pg],og[pg]=null}var xg=null,yg=null,I=!1,zg=null;function Ag(j,tt){var ot=Bg(5,null,null,0);ot.elementType="DELETED",ot.stateNode=tt,ot.return=j,tt=j.deletions,tt===null?(j.deletions=[ot],j.flags|=16):tt.push(ot)}function Cg(j,tt){switch(j.tag){case 5:var ot=j.type;return tt=tt.nodeType!==1||ot.toLowerCase()!==tt.nodeName.toLowerCase()?null:tt,tt!==null?(j.stateNode=tt,xg=j,yg=Lf(tt.firstChild),!0):!1;case 6:return tt=j.pendingProps===""||tt.nodeType!==3?null:tt,tt!==null?(j.stateNode=tt,xg=j,yg=null,!0):!1;case 13:return tt=tt.nodeType!==8?null:tt,tt!==null?(ot=qg!==null?{id:rg,overflow:sg}:null,j.memoizedState={dehydrated:tt,treeContext:ot,retryLane:1073741824},ot=Bg(18,null,null,0),ot.stateNode=tt,ot.return=j,j.child=ot,xg=j,yg=null,!0):!1;default:return!1}}function Dg(j){return(j.mode&1)!==0&&(j.flags&128)===0}function Eg(j){if(I){var tt=yg;if(tt){var ot=tt;if(!Cg(j,tt)){if(Dg(j))throw Error(p(418));tt=Lf(ot.nextSibling);var b=xg;tt&&Cg(j,tt)?Ag(b,ot):(j.flags=j.flags&-4097|2,I=!1,xg=j)}}else{if(Dg(j))throw Error(p(418));j.flags=j.flags&-4097|2,I=!1,xg=j}}}function Fg(j){for(j=j.return;j!==null&&j.tag!==5&&j.tag!==3&&j.tag!==13;)j=j.return;xg=j}function Gg(j){if(j!==xg)return!1;if(!I)return Fg(j),I=!0,!1;var tt;if((tt=j.tag!==3)&&!(tt=j.tag!==5)&&(tt=j.type,tt=tt!=="head"&&tt!=="body"&&!Ef(j.type,j.memoizedProps)),tt&&(tt=yg)){if(Dg(j))throw Hg(),Error(p(418));for(;tt;)Ag(j,tt),tt=Lf(tt.nextSibling)}if(Fg(j),j.tag===13){if(j=j.memoizedState,j=j!==null?j.dehydrated:null,!j)throw Error(p(317));e:{for(j=j.nextSibling,tt=0;j;){if(j.nodeType===8){var ot=j.data;if(ot==="/$"){if(tt===0){yg=Lf(j.nextSibling);break e}tt--}else ot!=="$"&&ot!=="$!"&&ot!=="$?"||tt++}j=j.nextSibling}yg=null}}else yg=xg?Lf(j.stateNode.nextSibling):null;return!0}function Hg(){for(var j=yg;j;)j=Lf(j.nextSibling)}function Ig(){yg=xg=null,I=!1}function Jg(j){zg===null?zg=[j]:zg.push(j)}var Kg=ua.ReactCurrentBatchConfig;function Lg(j,tt){if(j&&j.defaultProps){tt=A({},tt),j=j.defaultProps;for(var ot in j)tt[ot]===void 0&&(tt[ot]=j[ot]);return tt}return tt}var Mg=Uf(null),Ng=null,Og=null,Pg=null;function Qg(){Pg=Og=Ng=null}function Rg(j){var tt=Mg.current;E(Mg),j._currentValue=tt}function Sg(j,tt,ot){for(;j!==null;){var b=j.alternate;if((j.childLanes&tt)!==tt?(j.childLanes|=tt,b!==null&&(b.childLanes|=tt)):b!==null&&(b.childLanes&tt)!==tt&&(b.childLanes|=tt),j===ot)break;j=j.return}}function Tg(j,tt){Ng=j,Pg=Og=null,j=j.dependencies,j!==null&&j.firstContext!==null&&(j.lanes&tt&&(Ug=!0),j.firstContext=null)}function Vg(j){var tt=j._currentValue;if(Pg!==j)if(j={context:j,memoizedValue:tt,next:null},Og===null){if(Ng===null)throw Error(p(308));Og=j,Ng.dependencies={lanes:0,firstContext:j}}else Og=Og.next=j;return tt}var Wg=null;function Xg(j){Wg===null?Wg=[j]:Wg.push(j)}function Yg(j,tt,ot,b){var yt=tt.interleaved;return yt===null?(ot.next=ot,Xg(tt)):(ot.next=yt.next,yt.next=ot),tt.interleaved=ot,Zg(j,b)}function Zg(j,tt){j.lanes|=tt;var ot=j.alternate;for(ot!==null&&(ot.lanes|=tt),ot=j,j=j.return;j!==null;)j.childLanes|=tt,ot=j.alternate,ot!==null&&(ot.childLanes|=tt),ot=j,j=j.return;return ot.tag===3?ot.stateNode:null}var $g=!1;function ah(j){j.updateQueue={baseState:j.memoizedState,firstBaseUpdate:null,lastBaseUpdate:null,shared:{pending:null,interleaved:null,lanes:0},effects:null}}function bh(j,tt){j=j.updateQueue,tt.updateQueue===j&&(tt.updateQueue={baseState:j.baseState,firstBaseUpdate:j.firstBaseUpdate,lastBaseUpdate:j.lastBaseUpdate,shared:j.shared,effects:j.effects})}function ch(j,tt){return{eventTime:j,lane:tt,tag:0,payload:null,callback:null,next:null}}function dh(j,tt,ot){var b=j.updateQueue;if(b===null)return null;if(b=b.shared,K&2){var yt=b.pending;return yt===null?tt.next=tt:(tt.next=yt.next,yt.next=tt),b.pending=tt,Zg(j,ot)}return yt=b.interleaved,yt===null?(tt.next=tt,Xg(b)):(tt.next=yt.next,yt.next=tt),b.interleaved=tt,Zg(j,ot)}function eh(j,tt,ot){if(tt=tt.updateQueue,tt!==null&&(tt=tt.shared,(ot&4194240)!==0)){var b=tt.lanes;b&=j.pendingLanes,ot|=b,tt.lanes=ot,Cc(j,ot)}}function fh(j,tt){var ot=j.updateQueue,b=j.alternate;if(b!==null&&(b=b.updateQueue,ot===b)){var yt=null,Et=null;if(ot=ot.firstBaseUpdate,ot!==null){do{var kt={eventTime:ot.eventTime,lane:ot.lane,tag:ot.tag,payload:ot.payload,callback:ot.callback,next:null};Et===null?yt=Et=kt:Et=Et.next=kt,ot=ot.next}while(ot!==null);Et===null?yt=Et=tt:Et=Et.next=tt}else yt=Et=tt;ot={baseState:b.baseState,firstBaseUpdate:yt,lastBaseUpdate:Et,shared:b.shared,effects:b.effects},j.updateQueue=ot;return}j=ot.lastBaseUpdate,j===null?ot.firstBaseUpdate=tt:j.next=tt,ot.lastBaseUpdate=tt}function gh(j,tt,ot,b){var yt=j.updateQueue;$g=!1;var Et=yt.firstBaseUpdate,kt=yt.lastBaseUpdate,Gt=yt.shared.pending;if(Gt!==null){yt.shared.pending=null;var Vt=Gt,an=Vt.next;Vt.next=null,kt===null?Et=an:kt.next=an,kt=Vt;var Pn=j.alternate;Pn!==null&&(Pn=Pn.updateQueue,Gt=Pn.lastBaseUpdate,Gt!==kt&&(Gt===null?Pn.firstBaseUpdate=an:Gt.next=an,Pn.lastBaseUpdate=Vt))}if(Et!==null){var gn=yt.baseState;kt=0,Pn=an=Vt=null,Gt=Et;do{var dn=Gt.lane,wn=Gt.eventTime;if((b&dn)===dn){Pn!==null&&(Pn=Pn.next={eventTime:wn,lane:0,tag:Gt.tag,payload:Gt.payload,callback:Gt.callback,next:null});e:{var _n=j,$t=Gt;switch(dn=tt,wn=ot,$t.tag){case 1:if(_n=$t.payload,typeof _n=="function"){gn=_n.call(wn,gn,dn);break e}gn=_n;break e;case 3:_n.flags=_n.flags&-65537|128;case 0:if(_n=$t.payload,dn=typeof _n=="function"?_n.call(wn,gn,dn):_n,dn==null)break e;gn=A({},gn,dn);break e;case 2:$g=!0}}Gt.callback!==null&&Gt.lane!==0&&(j.flags|=64,dn=yt.effects,dn===null?yt.effects=[Gt]:dn.push(Gt))}else wn={eventTime:wn,lane:dn,tag:Gt.tag,payload:Gt.payload,callback:Gt.callback,next:null},Pn===null?(an=Pn=wn,Vt=gn):Pn=Pn.next=wn,kt|=dn;if(Gt=Gt.next,Gt===null){if(Gt=yt.shared.pending,Gt===null)break;dn=Gt,Gt=dn.next,dn.next=null,yt.lastBaseUpdate=dn,yt.shared.pending=null}}while(1);if(Pn===null&&(Vt=gn),yt.baseState=Vt,yt.firstBaseUpdate=an,yt.lastBaseUpdate=Pn,tt=yt.shared.interleaved,tt!==null){yt=tt;do kt|=yt.lane,yt=yt.next;while(yt!==tt)}else Et===null&&(yt.shared.lanes=0);hh|=kt,j.lanes=kt,j.memoizedState=gn}}function ih(j,tt,ot){if(j=tt.effects,tt.effects=null,j!==null)for(tt=0;tt<j.length;tt++){var b=j[tt],yt=b.callback;if(yt!==null){if(b.callback=null,b=ot,typeof yt!="function")throw Error(p(191,yt));yt.call(b)}}}var jh=new aa.Component().refs;function kh(j,tt,ot,b){tt=j.memoizedState,ot=ot(b,tt),ot=ot==null?tt:A({},tt,ot),j.memoizedState=ot,j.lanes===0&&(j.updateQueue.baseState=ot)}var nh={isMounted:function(j){return(j=j._reactInternals)?Vb(j)===j:!1},enqueueSetState:function(j,tt,ot){j=j._reactInternals;var b=L(),yt=lh(j),Et=ch(b,yt);Et.payload=tt,ot!=null&&(Et.callback=ot),tt=dh(j,Et,yt),tt!==null&&(mh(tt,j,yt,b),eh(tt,j,yt))},enqueueReplaceState:function(j,tt,ot){j=j._reactInternals;var b=L(),yt=lh(j),Et=ch(b,yt);Et.tag=1,Et.payload=tt,ot!=null&&(Et.callback=ot),tt=dh(j,Et,yt),tt!==null&&(mh(tt,j,yt,b),eh(tt,j,yt))},enqueueForceUpdate:function(j,tt){j=j._reactInternals;var ot=L(),b=lh(j),yt=ch(ot,b);yt.tag=2,tt!=null&&(yt.callback=tt),tt=dh(j,yt,b),tt!==null&&(mh(tt,j,b,ot),eh(tt,j,b))}};function oh(j,tt,ot,b,yt,Et,kt){return j=j.stateNode,typeof j.shouldComponentUpdate=="function"?j.shouldComponentUpdate(b,Et,kt):tt.prototype&&tt.prototype.isPureReactComponent?!Ie(ot,b)||!Ie(yt,Et):!0}function ph(j,tt,ot){var b=!1,yt=Vf,Et=tt.contextType;return typeof Et=="object"&&Et!==null?Et=Vg(Et):(yt=Zf(tt)?Xf:H.current,b=tt.contextTypes,Et=(b=b!=null)?Yf(j,yt):Vf),tt=new tt(ot,Et),j.memoizedState=tt.state!==null&&tt.state!==void 0?tt.state:null,tt.updater=nh,j.stateNode=tt,tt._reactInternals=j,b&&(j=j.stateNode,j.__reactInternalMemoizedUnmaskedChildContext=yt,j.__reactInternalMemoizedMaskedChildContext=Et),tt}function qh(j,tt,ot,b){j=tt.state,typeof tt.componentWillReceiveProps=="function"&&tt.componentWillReceiveProps(ot,b),typeof tt.UNSAFE_componentWillReceiveProps=="function"&&tt.UNSAFE_componentWillReceiveProps(ot,b),tt.state!==j&&nh.enqueueReplaceState(tt,tt.state,null)}function rh(j,tt,ot,b){var yt=j.stateNode;yt.props=ot,yt.state=j.memoizedState,yt.refs=jh,ah(j);var Et=tt.contextType;typeof Et=="object"&&Et!==null?yt.context=Vg(Et):(Et=Zf(tt)?Xf:H.current,yt.context=Yf(j,Et)),yt.state=j.memoizedState,Et=tt.getDerivedStateFromProps,typeof Et=="function"&&(kh(j,tt,Et,ot),yt.state=j.memoizedState),typeof tt.getDerivedStateFromProps=="function"||typeof yt.getSnapshotBeforeUpdate=="function"||typeof yt.UNSAFE_componentWillMount!="function"&&typeof yt.componentWillMount!="function"||(tt=yt.state,typeof yt.componentWillMount=="function"&&yt.componentWillMount(),typeof yt.UNSAFE_componentWillMount=="function"&&yt.UNSAFE_componentWillMount(),tt!==yt.state&&nh.enqueueReplaceState(yt,yt.state,null),gh(j,ot,yt,b),yt.state=j.memoizedState),typeof yt.componentDidMount=="function"&&(j.flags|=4194308)}function sh(j,tt,ot){if(j=ot.ref,j!==null&&typeof j!="function"&&typeof j!="object"){if(ot._owner){if(ot=ot._owner,ot){if(ot.tag!==1)throw Error(p(309));var b=ot.stateNode}if(!b)throw Error(p(147,j));var yt=b,Et=""+j;return tt!==null&&tt.ref!==null&&typeof tt.ref=="function"&&tt.ref._stringRef===Et?tt.ref:(tt=function(kt){var Gt=yt.refs;Gt===jh&&(Gt=yt.refs={}),kt===null?delete Gt[Et]:Gt[Et]=kt},tt._stringRef=Et,tt)}if(typeof j!="string")throw Error(p(284));if(!ot._owner)throw Error(p(290,j))}return j}function th(j,tt){throw j=Object.prototype.toString.call(tt),Error(p(31,j==="[object Object]"?"object with keys {"+Object.keys(tt).join(", ")+"}":j))}function uh(j){var tt=j._init;return tt(j._payload)}function vh(j){function tt(Ut,jt){if(j){var Yt=Ut.deletions;Yt===null?(Ut.deletions=[jt],Ut.flags|=16):Yt.push(jt)}}function ot(Ut,jt){if(!j)return null;for(;jt!==null;)tt(Ut,jt),jt=jt.sibling;return null}function b(Ut,jt){for(Ut=new Map;jt!==null;)jt.key!==null?Ut.set(jt.key,jt):Ut.set(jt.index,jt),jt=jt.sibling;return Ut}function yt(Ut,jt){return Ut=wh(Ut,jt),Ut.index=0,Ut.sibling=null,Ut}function Et(Ut,jt,Yt){return Ut.index=Yt,j?(Yt=Ut.alternate,Yt!==null?(Yt=Yt.index,Yt<jt?(Ut.flags|=2,jt):Yt):(Ut.flags|=2,jt)):(Ut.flags|=1048576,jt)}function kt(Ut){return j&&Ut.alternate===null&&(Ut.flags|=2),Ut}function Gt(Ut,jt,Yt,Bn){return jt===null||jt.tag!==6?(jt=xh(Yt,Ut.mode,Bn),jt.return=Ut,jt):(jt=yt(jt,Yt),jt.return=Ut,jt)}function Vt(Ut,jt,Yt,Bn){var un=Yt.type;return un===ya?Pn(Ut,jt,Yt.props.children,Bn,Yt.key):jt!==null&&(jt.elementType===un||typeof un=="object"&&un!==null&&un.$$typeof===Ha&&uh(un)===jt.type)?(Bn=yt(jt,Yt.props),Bn.ref=sh(Ut,jt,Yt),Bn.return=Ut,Bn):(Bn=yh(Yt.type,Yt.key,Yt.props,null,Ut.mode,Bn),Bn.ref=sh(Ut,jt,Yt),Bn.return=Ut,Bn)}function an(Ut,jt,Yt,Bn){return jt===null||jt.tag!==4||jt.stateNode.containerInfo!==Yt.containerInfo||jt.stateNode.implementation!==Yt.implementation?(jt=zh(Yt,Ut.mode,Bn),jt.return=Ut,jt):(jt=yt(jt,Yt.children||[]),jt.return=Ut,jt)}function Pn(Ut,jt,Yt,Bn,un){return jt===null||jt.tag!==7?(jt=Ah(Yt,Ut.mode,Bn,un),jt.return=Ut,jt):(jt=yt(jt,Yt),jt.return=Ut,jt)}function gn(Ut,jt,Yt){if(typeof jt=="string"&&jt!==""||typeof jt=="number")return jt=xh(""+jt,Ut.mode,Yt),jt.return=Ut,jt;if(typeof jt=="object"&&jt!==null){switch(jt.$$typeof){case va:return Yt=yh(jt.type,jt.key,jt.props,null,Ut.mode,Yt),Yt.ref=sh(Ut,null,jt),Yt.return=Ut,Yt;case wa:return jt=zh(jt,Ut.mode,Yt),jt.return=Ut,jt;case Ha:var Bn=jt._init;return gn(Ut,Bn(jt._payload),Yt)}if(eb(jt)||Ka(jt))return jt=Ah(jt,Ut.mode,Yt,null),jt.return=Ut,jt;th(Ut,jt)}return null}function dn(Ut,jt,Yt,Bn){var un=jt!==null?jt.key:null;if(typeof Yt=="string"&&Yt!==""||typeof Yt=="number")return un!==null?null:Gt(Ut,jt,""+Yt,Bn);if(typeof Yt=="object"&&Yt!==null){switch(Yt.$$typeof){case va:return Yt.key===un?Vt(Ut,jt,Yt,Bn):null;case wa:return Yt.key===un?an(Ut,jt,Yt,Bn):null;case Ha:return un=Yt._init,dn(Ut,jt,un(Yt._payload),Bn)}if(eb(Yt)||Ka(Yt))return un!==null?null:Pn(Ut,jt,Yt,Bn,null);th(Ut,Yt)}return null}function wn(Ut,jt,Yt,Bn,un){if(typeof Bn=="string"&&Bn!==""||typeof Bn=="number")return Ut=Ut.get(Yt)||null,Gt(jt,Ut,""+Bn,un);if(typeof Bn=="object"&&Bn!==null){switch(Bn.$$typeof){case va:return Ut=Ut.get(Bn.key===null?Yt:Bn.key)||null,Vt(jt,Ut,Bn,un);case wa:return Ut=Ut.get(Bn.key===null?Yt:Bn.key)||null,an(jt,Ut,Bn,un);case Ha:var Cn=Bn._init;return wn(Ut,jt,Yt,Cn(Bn._payload),un)}if(eb(Bn)||Ka(Bn))return Ut=Ut.get(Yt)||null,Pn(jt,Ut,Bn,un,null);th(jt,Bn)}return null}function _n(Ut,jt,Yt,Bn){for(var un=null,Cn=null,Qt=jt,Wt=jt=0,Zt=null;Qt!==null&&Wt<Yt.length;Wt++){Qt.index>Wt?(Zt=Qt,Qt=null):Zt=Qt.sibling;var En=dn(Ut,Qt,Yt[Wt],Bn);if(En===null){Qt===null&&(Qt=Zt);break}j&&Qt&&En.alternate===null&&tt(Ut,Qt),jt=Et(En,jt,Wt),Cn===null?un=En:Cn.sibling=En,Cn=En,Qt=Zt}if(Wt===Yt.length)return ot(Ut,Qt),I&&tg(Ut,Wt),un;if(Qt===null){for(;Wt<Yt.length;Wt++)Qt=gn(Ut,Yt[Wt],Bn),Qt!==null&&(jt=Et(Qt,jt,Wt),Cn===null?un=Qt:Cn.sibling=Qt,Cn=Qt);return I&&tg(Ut,Wt),un}for(Qt=b(Ut,Qt);Wt<Yt.length;Wt++)Zt=wn(Qt,Ut,Wt,Yt[Wt],Bn),Zt!==null&&(j&&Zt.alternate!==null&&Qt.delete(Zt.key===null?Wt:Zt.key),jt=Et(Zt,jt,Wt),Cn===null?un=Zt:Cn.sibling=Zt,Cn=Zt);return j&&Qt.forEach(function(pn){return tt(Ut,pn)}),I&&tg(Ut,Wt),un}function $t(Ut,jt,Yt,Bn){var un=Ka(Yt);if(typeof un!="function")throw Error(p(150));if(Yt=un.call(Yt),Yt==null)throw Error(p(151));for(var Cn=un=null,Qt=jt,Wt=jt=0,Zt=null,En=Yt.next();Qt!==null&&!En.done;Wt++,En=Yt.next()){Qt.index>Wt?(Zt=Qt,Qt=null):Zt=Qt.sibling;var pn=dn(Ut,Qt,En.value,Bn);if(pn===null){Qt===null&&(Qt=Zt);break}j&&Qt&&pn.alternate===null&&tt(Ut,Qt),jt=Et(pn,jt,Wt),Cn===null?un=pn:Cn.sibling=pn,Cn=pn,Qt=Zt}if(En.done)return ot(Ut,Qt),I&&tg(Ut,Wt),un;if(Qt===null){for(;!En.done;Wt++,En=Yt.next())En=gn(Ut,En.value,Bn),En!==null&&(jt=Et(En,jt,Wt),Cn===null?un=En:Cn.sibling=En,Cn=En);return I&&tg(Ut,Wt),un}for(Qt=b(Ut,Qt);!En.done;Wt++,En=Yt.next())En=wn(Qt,Ut,Wt,En.value,Bn),En!==null&&(j&&En.alternate!==null&&Qt.delete(En.key===null?Wt:En.key),jt=Et(En,jt,Wt),Cn===null?un=En:Cn.sibling=En,Cn=En);return j&&Qt.forEach(function(er){return tt(Ut,er)}),I&&tg(Ut,Wt),un}function bn(Ut,jt,Yt,Bn){if(typeof Yt=="object"&&Yt!==null&&Yt.type===ya&&Yt.key===null&&(Yt=Yt.props.children),typeof Yt=="object"&&Yt!==null){switch(Yt.$$typeof){case va:e:{for(var un=Yt.key,Cn=jt;Cn!==null;){if(Cn.key===un){if(un=Yt.type,un===ya){if(Cn.tag===7){ot(Ut,Cn.sibling),jt=yt(Cn,Yt.props.children),jt.return=Ut,Ut=jt;break e}}else if(Cn.elementType===un||typeof un=="object"&&un!==null&&un.$$typeof===Ha&&uh(un)===Cn.type){ot(Ut,Cn.sibling),jt=yt(Cn,Yt.props),jt.ref=sh(Ut,Cn,Yt),jt.return=Ut,Ut=jt;break e}ot(Ut,Cn);break}else tt(Ut,Cn);Cn=Cn.sibling}Yt.type===ya?(jt=Ah(Yt.props.children,Ut.mode,Bn,Yt.key),jt.return=Ut,Ut=jt):(Bn=yh(Yt.type,Yt.key,Yt.props,null,Ut.mode,Bn),Bn.ref=sh(Ut,jt,Yt),Bn.return=Ut,Ut=Bn)}return kt(Ut);case wa:e:{for(Cn=Yt.key;jt!==null;){if(jt.key===Cn)if(jt.tag===4&&jt.stateNode.containerInfo===Yt.containerInfo&&jt.stateNode.implementation===Yt.implementation){ot(Ut,jt.sibling),jt=yt(jt,Yt.children||[]),jt.return=Ut,Ut=jt;break e}else{ot(Ut,jt);break}else tt(Ut,jt);jt=jt.sibling}jt=zh(Yt,Ut.mode,Bn),jt.return=Ut,Ut=jt}return kt(Ut);case Ha:return Cn=Yt._init,bn(Ut,jt,Cn(Yt._payload),Bn)}if(eb(Yt))return _n(Ut,jt,Yt,Bn);if(Ka(Yt))return $t(Ut,jt,Yt,Bn);th(Ut,Yt)}return typeof Yt=="string"&&Yt!==""||typeof Yt=="number"?(Yt=""+Yt,jt!==null&&jt.tag===6?(ot(Ut,jt.sibling),jt=yt(jt,Yt),jt.return=Ut,Ut=jt):(ot(Ut,jt),jt=xh(Yt,Ut.mode,Bn),jt.return=Ut,Ut=jt),kt(Ut)):ot(Ut,jt)}return bn}var Bh=vh(!0),Ch=vh(!1),Dh={},Eh=Uf(Dh),Fh=Uf(Dh),Gh=Uf(Dh);function Hh(j){if(j===Dh)throw Error(p(174));return j}function Ih(j,tt){switch(G(Gh,tt),G(Fh,j),G(Eh,Dh),j=tt.nodeType,j){case 9:case 11:tt=(tt=tt.documentElement)?tt.namespaceURI:lb(null,"");break;default:j=j===8?tt.parentNode:tt,tt=j.namespaceURI||null,j=j.tagName,tt=lb(tt,j)}E(Eh),G(Eh,tt)}function Jh(){E(Eh),E(Fh),E(Gh)}function Kh(j){Hh(Gh.current);var tt=Hh(Eh.current),ot=lb(tt,j.type);tt!==ot&&(G(Fh,j),G(Eh,ot))}function Lh(j){Fh.current===j&&(E(Eh),E(Fh))}var M=Uf(0);function Mh(j){for(var tt=j;tt!==null;){if(tt.tag===13){var ot=tt.memoizedState;if(ot!==null&&(ot=ot.dehydrated,ot===null||ot.data==="$?"||ot.data==="$!"))return tt}else if(tt.tag===19&&tt.memoizedProps.revealOrder!==void 0){if(tt.flags&128)return tt}else if(tt.child!==null){tt.child.return=tt,tt=tt.child;continue}if(tt===j)break;for(;tt.sibling===null;){if(tt.return===null||tt.return===j)return null;tt=tt.return}tt.sibling.return=tt.return,tt=tt.sibling}return null}var Nh=[];function Oh(){for(var j=0;j<Nh.length;j++)Nh[j]._workInProgressVersionPrimary=null;Nh.length=0}var Ph=ua.ReactCurrentDispatcher,Qh=ua.ReactCurrentBatchConfig,Rh=0,N=null,O=null,P=null,Sh=!1,Th=!1,Uh=0,Vh=0;function Q(){throw Error(p(321))}function Wh(j,tt){if(tt===null)return!1;for(var ot=0;ot<tt.length&&ot<j.length;ot++)if(!He(j[ot],tt[ot]))return!1;return!0}function Xh(j,tt,ot,b,yt,Et){if(Rh=Et,N=tt,tt.memoizedState=null,tt.updateQueue=null,tt.lanes=0,Ph.current=j===null||j.memoizedState===null?Yh:Zh,j=ot(b,yt),Th){Et=0;do{if(Th=!1,Uh=0,25<=Et)throw Error(p(301));Et+=1,P=O=null,tt.updateQueue=null,Ph.current=$h,j=ot(b,yt)}while(Th)}if(Ph.current=ai,tt=O!==null&&O.next!==null,Rh=0,P=O=N=null,Sh=!1,tt)throw Error(p(300));return j}function bi(){var j=Uh!==0;return Uh=0,j}function ci(){var j={memoizedState:null,baseState:null,baseQueue:null,queue:null,next:null};return P===null?N.memoizedState=P=j:P=P.next=j,P}function di(){if(O===null){var j=N.alternate;j=j!==null?j.memoizedState:null}else j=O.next;var tt=P===null?N.memoizedState:P.next;if(tt!==null)P=tt,O=j;else{if(j===null)throw Error(p(310));O=j,j={memoizedState:O.memoizedState,baseState:O.baseState,baseQueue:O.baseQueue,queue:O.queue,next:null},P===null?N.memoizedState=P=j:P=P.next=j}return P}function ei(j,tt){return typeof tt=="function"?tt(j):tt}function fi(j){var tt=di(),ot=tt.queue;if(ot===null)throw Error(p(311));ot.lastRenderedReducer=j;var b=O,yt=b.baseQueue,Et=ot.pending;if(Et!==null){if(yt!==null){var kt=yt.next;yt.next=Et.next,Et.next=kt}b.baseQueue=yt=Et,ot.pending=null}if(yt!==null){Et=yt.next,b=b.baseState;var Gt=kt=null,Vt=null,an=Et;do{var Pn=an.lane;if((Rh&Pn)===Pn)Vt!==null&&(Vt=Vt.next={lane:0,action:an.action,hasEagerState:an.hasEagerState,eagerState:an.eagerState,next:null}),b=an.hasEagerState?an.eagerState:j(b,an.action);else{var gn={lane:Pn,action:an.action,hasEagerState:an.hasEagerState,eagerState:an.eagerState,next:null};Vt===null?(Gt=Vt=gn,kt=b):Vt=Vt.next=gn,N.lanes|=Pn,hh|=Pn}an=an.next}while(an!==null&&an!==Et);Vt===null?kt=b:Vt.next=Gt,He(b,tt.memoizedState)||(Ug=!0),tt.memoizedState=b,tt.baseState=kt,tt.baseQueue=Vt,ot.lastRenderedState=b}if(j=ot.interleaved,j!==null){yt=j;do Et=yt.lane,N.lanes|=Et,hh|=Et,yt=yt.next;while(yt!==j)}else yt===null&&(ot.lanes=0);return[tt.memoizedState,ot.dispatch]}function gi(j){var tt=di(),ot=tt.queue;if(ot===null)throw Error(p(311));ot.lastRenderedReducer=j;var b=ot.dispatch,yt=ot.pending,Et=tt.memoizedState;if(yt!==null){ot.pending=null;var kt=yt=yt.next;do Et=j(Et,kt.action),kt=kt.next;while(kt!==yt);He(Et,tt.memoizedState)||(Ug=!0),tt.memoizedState=Et,tt.baseQueue===null&&(tt.baseState=Et),ot.lastRenderedState=Et}return[Et,b]}function hi(){}function ii(j,tt){var ot=N,b=di(),yt=tt(),Et=!He(b.memoizedState,yt);if(Et&&(b.memoizedState=yt,Ug=!0),b=b.queue,ji(ki.bind(null,ot,b,j),[j]),b.getSnapshot!==tt||Et||P!==null&&P.memoizedState.tag&1){if(ot.flags|=2048,li(9,mi.bind(null,ot,b,yt,tt),void 0,null),R===null)throw Error(p(349));Rh&30||ni(ot,tt,yt)}return yt}function ni(j,tt,ot){j.flags|=16384,j={getSnapshot:tt,value:ot},tt=N.updateQueue,tt===null?(tt={lastEffect:null,stores:null},N.updateQueue=tt,tt.stores=[j]):(ot=tt.stores,ot===null?tt.stores=[j]:ot.push(j))}function mi(j,tt,ot,b){tt.value=ot,tt.getSnapshot=b,oi(tt)&&pi(j)}function ki(j,tt,ot){return ot(function(){oi(tt)&&pi(j)})}function oi(j){var tt=j.getSnapshot;j=j.value;try{var ot=tt();return!He(j,ot)}catch{return!0}}function pi(j){var tt=Zg(j,1);tt!==null&&mh(tt,j,1,-1)}function qi(j){var tt=ci();return typeof j=="function"&&(j=j()),tt.memoizedState=tt.baseState=j,j={pending:null,interleaved:null,lanes:0,dispatch:null,lastRenderedReducer:ei,lastRenderedState:j},tt.queue=j,j=j.dispatch=ri.bind(null,N,j),[tt.memoizedState,j]}function li(j,tt,ot,b){return j={tag:j,create:tt,destroy:ot,deps:b,next:null},tt=N.updateQueue,tt===null?(tt={lastEffect:null,stores:null},N.updateQueue=tt,tt.lastEffect=j.next=j):(ot=tt.lastEffect,ot===null?tt.lastEffect=j.next=j:(b=ot.next,ot.next=j,j.next=b,tt.lastEffect=j)),j}function si(){return di().memoizedState}function ti(j,tt,ot,b){var yt=ci();N.flags|=j,yt.memoizedState=li(1|tt,ot,void 0,b===void 0?null:b)}function ui(j,tt,ot,b){var yt=di();b=b===void 0?null:b;var Et=void 0;if(O!==null){var kt=O.memoizedState;if(Et=kt.destroy,b!==null&&Wh(b,kt.deps)){yt.memoizedState=li(tt,ot,Et,b);return}}N.flags|=j,yt.memoizedState=li(1|tt,ot,Et,b)}function vi(j,tt){return ti(8390656,8,j,tt)}function ji(j,tt){return ui(2048,8,j,tt)}function wi(j,tt){return ui(4,2,j,tt)}function xi(j,tt){return ui(4,4,j,tt)}function yi(j,tt){if(typeof tt=="function")return j=j(),tt(j),function(){tt(null)};if(tt!=null)return j=j(),tt.current=j,function(){tt.current=null}}function zi(j,tt,ot){return ot=ot!=null?ot.concat([j]):null,ui(4,4,yi.bind(null,tt,j),ot)}function Ai(){}function Bi(j,tt){var ot=di();tt=tt===void 0?null:tt;var b=ot.memoizedState;return b!==null&&tt!==null&&Wh(tt,b[1])?b[0]:(ot.memoizedState=[j,tt],j)}function Ci(j,tt){var ot=di();tt=tt===void 0?null:tt;var b=ot.memoizedState;return b!==null&&tt!==null&&Wh(tt,b[1])?b[0]:(j=j(),ot.memoizedState=[j,tt],j)}function Di(j,tt,ot){return Rh&21?(He(ot,tt)||(ot=yc(),N.lanes|=ot,hh|=ot,j.baseState=!0),tt):(j.baseState&&(j.baseState=!1,Ug=!0),j.memoizedState=ot)}function Ei(j,tt){var ot=C;C=ot!==0&&4>ot?ot:4,j(!0);var b=Qh.transition;Qh.transition={};try{j(!1),tt()}finally{C=ot,Qh.transition=b}}function Fi(){return di().memoizedState}function Gi(j,tt,ot){var b=lh(j);if(ot={lane:b,action:ot,hasEagerState:!1,eagerState:null,next:null},Hi(j))Ii(tt,ot);else if(ot=Yg(j,tt,ot,b),ot!==null){var yt=L();mh(ot,j,b,yt),Ji(ot,tt,b)}}function ri(j,tt,ot){var b=lh(j),yt={lane:b,action:ot,hasEagerState:!1,eagerState:null,next:null};if(Hi(j))Ii(tt,yt);else{var Et=j.alternate;if(j.lanes===0&&(Et===null||Et.lanes===0)&&(Et=tt.lastRenderedReducer,Et!==null))try{var kt=tt.lastRenderedState,Gt=Et(kt,ot);if(yt.hasEagerState=!0,yt.eagerState=Gt,He(Gt,kt)){var Vt=tt.interleaved;Vt===null?(yt.next=yt,Xg(tt)):(yt.next=Vt.next,Vt.next=yt),tt.interleaved=yt;return}}catch{}finally{}ot=Yg(j,tt,yt,b),ot!==null&&(yt=L(),mh(ot,j,b,yt),Ji(ot,tt,b))}}function Hi(j){var tt=j.alternate;return j===N||tt!==null&&tt===N}function Ii(j,tt){Th=Sh=!0;var ot=j.pending;ot===null?tt.next=tt:(tt.next=ot.next,ot.next=tt),j.pending=tt}function Ji(j,tt,ot){if(ot&4194240){var b=tt.lanes;b&=j.pendingLanes,ot|=b,tt.lanes=ot,Cc(j,ot)}}var ai={readContext:Vg,useCallback:Q,useContext:Q,useEffect:Q,useImperativeHandle:Q,useInsertionEffect:Q,useLayoutEffect:Q,useMemo:Q,useReducer:Q,useRef:Q,useState:Q,useDebugValue:Q,useDeferredValue:Q,useTransition:Q,useMutableSource:Q,useSyncExternalStore:Q,useId:Q,unstable_isNewReconciler:!1},Yh={readContext:Vg,useCallback:function(j,tt){return ci().memoizedState=[j,tt===void 0?null:tt],j},useContext:Vg,useEffect:vi,useImperativeHandle:function(j,tt,ot){return ot=ot!=null?ot.concat([j]):null,ti(4194308,4,yi.bind(null,tt,j),ot)},useLayoutEffect:function(j,tt){return ti(4194308,4,j,tt)},useInsertionEffect:function(j,tt){return ti(4,2,j,tt)},useMemo:function(j,tt){var ot=ci();return tt=tt===void 0?null:tt,j=j(),ot.memoizedState=[j,tt],j},useReducer:function(j,tt,ot){var b=ci();return tt=ot!==void 0?ot(tt):tt,b.memoizedState=b.baseState=tt,j={pending:null,interleaved:null,lanes:0,dispatch:null,lastRenderedReducer:j,lastRenderedState:tt},b.queue=j,j=j.dispatch=Gi.bind(null,N,j),[b.memoizedState,j]},useRef:function(j){var tt=ci();return j={current:j},tt.memoizedState=j},useState:qi,useDebugValue:Ai,useDeferredValue:function(j){return ci().memoizedState=j},useTransition:function(){var j=qi(!1),tt=j[0];return j=Ei.bind(null,j[1]),ci().memoizedState=j,[tt,j]},useMutableSource:function(){},useSyncExternalStore:function(j,tt,ot){var b=N,yt=ci();if(I){if(ot===void 0)throw Error(p(407));ot=ot()}else{if(ot=tt(),R===null)throw Error(p(349));Rh&30||ni(b,tt,ot)}yt.memoizedState=ot;var Et={value:ot,getSnapshot:tt};return yt.queue=Et,vi(ki.bind(null,b,Et,j),[j]),b.flags|=2048,li(9,mi.bind(null,b,Et,ot,tt),void 0,null),ot},useId:function(){var j=ci(),tt=R.identifierPrefix;if(I){var ot=sg,b=rg;ot=(b&~(1<<32-oc(b)-1)).toString(32)+ot,tt=":"+tt+"R"+ot,ot=Uh++,0<ot&&(tt+="H"+ot.toString(32)),tt+=":"}else ot=Vh++,tt=":"+tt+"r"+ot.toString(32)+":";return j.memoizedState=tt},unstable_isNewReconciler:!1},Zh={readContext:Vg,useCallback:Bi,useContext:Vg,useEffect:ji,useImperativeHandle:zi,useInsertionEffect:wi,useLayoutEffect:xi,useMemo:Ci,useReducer:fi,useRef:si,useState:function(){return fi(ei)},useDebugValue:Ai,useDeferredValue:function(j){var tt=di();return Di(tt,O.memoizedState,j)},useTransition:function(){var j=fi(ei)[0],tt=di().memoizedState;return[j,tt]},useMutableSource:hi,useSyncExternalStore:ii,useId:Fi,unstable_isNewReconciler:!1},$h={readContext:Vg,useCallback:Bi,useContext:Vg,useEffect:ji,useImperativeHandle:zi,useInsertionEffect:wi,useLayoutEffect:xi,useMemo:Ci,useReducer:gi,useRef:si,useState:function(){return gi(ei)},useDebugValue:Ai,useDeferredValue:function(j){var tt=di();return O===null?tt.memoizedState=j:Di(tt,O.memoizedState,j)},useTransition:function(){var j=gi(ei)[0],tt=di().memoizedState;return[j,tt]},useMutableSource:hi,useSyncExternalStore:ii,useId:Fi,unstable_isNewReconciler:!1};function Ki(j,tt){try{var ot="",b=tt;do ot+=Pa(b),b=b.return;while(b);var yt=ot}catch(Et){yt=`
Error generating stack: `+Et.message+`
`+Et.stack}return{value:j,source:tt,stack:yt,digest:null}}function Li(j,tt,ot){return{value:j,source:null,stack:ot??null,digest:tt??null}}function Mi(j,tt){try{console.error(tt.value)}catch(ot){setTimeout(function(){throw ot})}}var Ni=typeof WeakMap=="function"?WeakMap:Map;function Oi(j,tt,ot){ot=ch(-1,ot),ot.tag=3,ot.payload={element:null};var b=tt.value;return ot.callback=function(){Pi||(Pi=!0,Qi=b),Mi(j,tt)},ot}function Ri(j,tt,ot){ot=ch(-1,ot),ot.tag=3;var b=j.type.getDerivedStateFromError;if(typeof b=="function"){var yt=tt.value;ot.payload=function(){return b(yt)},ot.callback=function(){Mi(j,tt)}}var Et=j.stateNode;return Et!==null&&typeof Et.componentDidCatch=="function"&&(ot.callback=function(){Mi(j,tt),typeof b!="function"&&(Si===null?Si=new Set([this]):Si.add(this));var kt=tt.stack;this.componentDidCatch(tt.value,{componentStack:kt!==null?kt:""})}),ot}function Ti(j,tt,ot){var b=j.pingCache;if(b===null){b=j.pingCache=new Ni;var yt=new Set;b.set(tt,yt)}else yt=b.get(tt),yt===void 0&&(yt=new Set,b.set(tt,yt));yt.has(ot)||(yt.add(ot),j=Ui.bind(null,j,tt,ot),tt.then(j,j))}function Vi(j){do{var tt;if((tt=j.tag===13)&&(tt=j.memoizedState,tt=tt!==null?tt.dehydrated!==null:!0),tt)return j;j=j.return}while(j!==null);return null}function Wi(j,tt,ot,b,yt){return j.mode&1?(j.flags|=65536,j.lanes=yt,j):(j===tt?j.flags|=65536:(j.flags|=128,ot.flags|=131072,ot.flags&=-52805,ot.tag===1&&(ot.alternate===null?ot.tag=17:(tt=ch(-1,1),tt.tag=2,dh(ot,tt,1))),ot.lanes|=1),j)}var Xi=ua.ReactCurrentOwner,Ug=!1;function Yi(j,tt,ot,b){tt.child=j===null?Ch(tt,null,ot,b):Bh(tt,j.child,ot,b)}function Zi(j,tt,ot,b,yt){ot=ot.render;var Et=tt.ref;return Tg(tt,yt),b=Xh(j,tt,ot,b,Et,yt),ot=bi(),j!==null&&!Ug?(tt.updateQueue=j.updateQueue,tt.flags&=-2053,j.lanes&=~yt,$i(j,tt,yt)):(I&&ot&&vg(tt),tt.flags|=1,Yi(j,tt,b,yt),tt.child)}function aj(j,tt,ot,b,yt){if(j===null){var Et=ot.type;return typeof Et=="function"&&!bj(Et)&&Et.defaultProps===void 0&&ot.compare===null&&ot.defaultProps===void 0?(tt.tag=15,tt.type=Et,cj(j,tt,Et,b,yt)):(j=yh(ot.type,null,b,tt,tt.mode,yt),j.ref=tt.ref,j.return=tt,tt.child=j)}if(Et=j.child,!(j.lanes&yt)){var kt=Et.memoizedProps;if(ot=ot.compare,ot=ot!==null?ot:Ie,ot(kt,b)&&j.ref===tt.ref)return $i(j,tt,yt)}return tt.flags|=1,j=wh(Et,b),j.ref=tt.ref,j.return=tt,tt.child=j}function cj(j,tt,ot,b,yt){if(j!==null){var Et=j.memoizedProps;if(Ie(Et,b)&&j.ref===tt.ref)if(Ug=!1,tt.pendingProps=b=Et,(j.lanes&yt)!==0)j.flags&131072&&(Ug=!0);else return tt.lanes=j.lanes,$i(j,tt,yt)}return dj(j,tt,ot,b,yt)}function ej(j,tt,ot){var b=tt.pendingProps,yt=b.children,Et=j!==null?j.memoizedState:null;if(b.mode==="hidden")if(!(tt.mode&1))tt.memoizedState={baseLanes:0,cachePool:null,transitions:null},G(fj,gj),gj|=ot;else{if(!(ot&1073741824))return j=Et!==null?Et.baseLanes|ot:ot,tt.lanes=tt.childLanes=1073741824,tt.memoizedState={baseLanes:j,cachePool:null,transitions:null},tt.updateQueue=null,G(fj,gj),gj|=j,null;tt.memoizedState={baseLanes:0,cachePool:null,transitions:null},b=Et!==null?Et.baseLanes:ot,G(fj,gj),gj|=b}else Et!==null?(b=Et.baseLanes|ot,tt.memoizedState=null):b=ot,G(fj,gj),gj|=b;return Yi(j,tt,yt,ot),tt.child}function hj(j,tt){var ot=tt.ref;(j===null&&ot!==null||j!==null&&j.ref!==ot)&&(tt.flags|=512,tt.flags|=2097152)}function dj(j,tt,ot,b,yt){var Et=Zf(ot)?Xf:H.current;return Et=Yf(tt,Et),Tg(tt,yt),ot=Xh(j,tt,ot,b,Et,yt),b=bi(),j!==null&&!Ug?(tt.updateQueue=j.updateQueue,tt.flags&=-2053,j.lanes&=~yt,$i(j,tt,yt)):(I&&b&&vg(tt),tt.flags|=1,Yi(j,tt,ot,yt),tt.child)}function ij(j,tt,ot,b,yt){if(Zf(ot)){var Et=!0;cg(tt)}else Et=!1;if(Tg(tt,yt),tt.stateNode===null)jj(j,tt),ph(tt,ot,b),rh(tt,ot,b,yt),b=!0;else if(j===null){var kt=tt.stateNode,Gt=tt.memoizedProps;kt.props=Gt;var Vt=kt.context,an=ot.contextType;typeof an=="object"&&an!==null?an=Vg(an):(an=Zf(ot)?Xf:H.current,an=Yf(tt,an));var Pn=ot.getDerivedStateFromProps,gn=typeof Pn=="function"||typeof kt.getSnapshotBeforeUpdate=="function";gn||typeof kt.UNSAFE_componentWillReceiveProps!="function"&&typeof kt.componentWillReceiveProps!="function"||(Gt!==b||Vt!==an)&&qh(tt,kt,b,an),$g=!1;var dn=tt.memoizedState;kt.state=dn,gh(tt,b,kt,yt),Vt=tt.memoizedState,Gt!==b||dn!==Vt||Wf.current||$g?(typeof Pn=="function"&&(kh(tt,ot,Pn,b),Vt=tt.memoizedState),(Gt=$g||oh(tt,ot,Gt,b,dn,Vt,an))?(gn||typeof kt.UNSAFE_componentWillMount!="function"&&typeof kt.componentWillMount!="function"||(typeof kt.componentWillMount=="function"&&kt.componentWillMount(),typeof kt.UNSAFE_componentWillMount=="function"&&kt.UNSAFE_componentWillMount()),typeof kt.componentDidMount=="function"&&(tt.flags|=4194308)):(typeof kt.componentDidMount=="function"&&(tt.flags|=4194308),tt.memoizedProps=b,tt.memoizedState=Vt),kt.props=b,kt.state=Vt,kt.context=an,b=Gt):(typeof kt.componentDidMount=="function"&&(tt.flags|=4194308),b=!1)}else{kt=tt.stateNode,bh(j,tt),Gt=tt.memoizedProps,an=tt.type===tt.elementType?Gt:Lg(tt.type,Gt),kt.props=an,gn=tt.pendingProps,dn=kt.context,Vt=ot.contextType,typeof Vt=="object"&&Vt!==null?Vt=Vg(Vt):(Vt=Zf(ot)?Xf:H.current,Vt=Yf(tt,Vt));var wn=ot.getDerivedStateFromProps;(Pn=typeof wn=="function"||typeof kt.getSnapshotBeforeUpdate=="function")||typeof kt.UNSAFE_componentWillReceiveProps!="function"&&typeof kt.componentWillReceiveProps!="function"||(Gt!==gn||dn!==Vt)&&qh(tt,kt,b,Vt),$g=!1,dn=tt.memoizedState,kt.state=dn,gh(tt,b,kt,yt);var _n=tt.memoizedState;Gt!==gn||dn!==_n||Wf.current||$g?(typeof wn=="function"&&(kh(tt,ot,wn,b),_n=tt.memoizedState),(an=$g||oh(tt,ot,an,b,dn,_n,Vt)||!1)?(Pn||typeof kt.UNSAFE_componentWillUpdate!="function"&&typeof kt.componentWillUpdate!="function"||(typeof kt.componentWillUpdate=="function"&&kt.componentWillUpdate(b,_n,Vt),typeof kt.UNSAFE_componentWillUpdate=="function"&&kt.UNSAFE_componentWillUpdate(b,_n,Vt)),typeof kt.componentDidUpdate=="function"&&(tt.flags|=4),typeof kt.getSnapshotBeforeUpdate=="function"&&(tt.flags|=1024)):(typeof kt.componentDidUpdate!="function"||Gt===j.memoizedProps&&dn===j.memoizedState||(tt.flags|=4),typeof kt.getSnapshotBeforeUpdate!="function"||Gt===j.memoizedProps&&dn===j.memoizedState||(tt.flags|=1024),tt.memoizedProps=b,tt.memoizedState=_n),kt.props=b,kt.state=_n,kt.context=Vt,b=an):(typeof kt.componentDidUpdate!="function"||Gt===j.memoizedProps&&dn===j.memoizedState||(tt.flags|=4),typeof kt.getSnapshotBeforeUpdate!="function"||Gt===j.memoizedProps&&dn===j.memoizedState||(tt.flags|=1024),b=!1)}return kj(j,tt,ot,b,Et,yt)}function kj(j,tt,ot,b,yt,Et){hj(j,tt);var kt=(tt.flags&128)!==0;if(!b&&!kt)return yt&&dg(tt,ot,!1),$i(j,tt,Et);b=tt.stateNode,Xi.current=tt;var Gt=kt&&typeof ot.getDerivedStateFromError!="function"?null:b.render();return tt.flags|=1,j!==null&&kt?(tt.child=Bh(tt,j.child,null,Et),tt.child=Bh(tt,null,Gt,Et)):Yi(j,tt,Gt,Et),tt.memoizedState=b.state,yt&&dg(tt,ot,!0),tt.child}function lj(j){var tt=j.stateNode;tt.pendingContext?ag(j,tt.pendingContext,tt.pendingContext!==tt.context):tt.context&&ag(j,tt.context,!1),Ih(j,tt.containerInfo)}function mj(j,tt,ot,b,yt){return Ig(),Jg(yt),tt.flags|=256,Yi(j,tt,ot,b),tt.child}var nj={dehydrated:null,treeContext:null,retryLane:0};function oj(j){return{baseLanes:j,cachePool:null,transitions:null}}function pj(j,tt,ot){var b=tt.pendingProps,yt=M.current,Et=!1,kt=(tt.flags&128)!==0,Gt;if((Gt=kt)||(Gt=j!==null&&j.memoizedState===null?!1:(yt&2)!==0),Gt?(Et=!0,tt.flags&=-129):(j===null||j.memoizedState!==null)&&(yt|=1),G(M,yt&1),j===null)return Eg(tt),j=tt.memoizedState,j!==null&&(j=j.dehydrated,j!==null)?(tt.mode&1?j.data==="$!"?tt.lanes=8:tt.lanes=1073741824:tt.lanes=1,null):(kt=b.children,j=b.fallback,Et?(b=tt.mode,Et=tt.child,kt={mode:"hidden",children:kt},!(b&1)&&Et!==null?(Et.childLanes=0,Et.pendingProps=kt):Et=qj(kt,b,0,null),j=Ah(j,b,ot,null),Et.return=tt,j.return=tt,Et.sibling=j,tt.child=Et,tt.child.memoizedState=oj(ot),tt.memoizedState=nj,j):rj(tt,kt));if(yt=j.memoizedState,yt!==null&&(Gt=yt.dehydrated,Gt!==null))return sj(j,tt,kt,b,Gt,yt,ot);if(Et){Et=b.fallback,kt=tt.mode,yt=j.child,Gt=yt.sibling;var Vt={mode:"hidden",children:b.children};return!(kt&1)&&tt.child!==yt?(b=tt.child,b.childLanes=0,b.pendingProps=Vt,tt.deletions=null):(b=wh(yt,Vt),b.subtreeFlags=yt.subtreeFlags&14680064),Gt!==null?Et=wh(Gt,Et):(Et=Ah(Et,kt,ot,null),Et.flags|=2),Et.return=tt,b.return=tt,b.sibling=Et,tt.child=b,b=Et,Et=tt.child,kt=j.child.memoizedState,kt=kt===null?oj(ot):{baseLanes:kt.baseLanes|ot,cachePool:null,transitions:kt.transitions},Et.memoizedState=kt,Et.childLanes=j.childLanes&~ot,tt.memoizedState=nj,b}return Et=j.child,j=Et.sibling,b=wh(Et,{mode:"visible",children:b.children}),!(tt.mode&1)&&(b.lanes=ot),b.return=tt,b.sibling=null,j!==null&&(ot=tt.deletions,ot===null?(tt.deletions=[j],tt.flags|=16):ot.push(j)),tt.child=b,tt.memoizedState=null,b}function rj(j,tt){return tt=qj({mode:"visible",children:tt},j.mode,0,null),tt.return=j,j.child=tt}function tj(j,tt,ot,b){return b!==null&&Jg(b),Bh(tt,j.child,null,ot),j=rj(tt,tt.pendingProps.children),j.flags|=2,tt.memoizedState=null,j}function sj(j,tt,ot,b,yt,Et,kt){if(ot)return tt.flags&256?(tt.flags&=-257,b=Li(Error(p(422))),tj(j,tt,kt,b)):tt.memoizedState!==null?(tt.child=j.child,tt.flags|=128,null):(Et=b.fallback,yt=tt.mode,b=qj({mode:"visible",children:b.children},yt,0,null),Et=Ah(Et,yt,kt,null),Et.flags|=2,b.return=tt,Et.return=tt,b.sibling=Et,tt.child=b,tt.mode&1&&Bh(tt,j.child,null,kt),tt.child.memoizedState=oj(kt),tt.memoizedState=nj,Et);if(!(tt.mode&1))return tj(j,tt,kt,null);if(yt.data==="$!"){if(b=yt.nextSibling&&yt.nextSibling.dataset,b)var Gt=b.dgst;return b=Gt,Et=Error(p(419)),b=Li(Et,b,void 0),tj(j,tt,kt,b)}if(Gt=(kt&j.childLanes)!==0,Ug||Gt){if(b=R,b!==null){switch(kt&-kt){case 4:yt=2;break;case 16:yt=8;break;case 64:case 128:case 256:case 512:case 1024:case 2048:case 4096:case 8192:case 16384:case 32768:case 65536:case 131072:case 262144:case 524288:case 1048576:case 2097152:case 4194304:case 8388608:case 16777216:case 33554432:case 67108864:yt=32;break;case 536870912:yt=268435456;break;default:yt=0}yt=yt&(b.suspendedLanes|kt)?0:yt,yt!==0&&yt!==Et.retryLane&&(Et.retryLane=yt,Zg(j,yt),mh(b,j,yt,-1))}return uj(),b=Li(Error(p(421))),tj(j,tt,kt,b)}return yt.data==="$?"?(tt.flags|=128,tt.child=j.child,tt=vj.bind(null,j),yt._reactRetry=tt,null):(j=Et.treeContext,yg=Lf(yt.nextSibling),xg=tt,I=!0,zg=null,j!==null&&(og[pg++]=rg,og[pg++]=sg,og[pg++]=qg,rg=j.id,sg=j.overflow,qg=tt),tt=rj(tt,b.children),tt.flags|=4096,tt)}function wj(j,tt,ot){j.lanes|=tt;var b=j.alternate;b!==null&&(b.lanes|=tt),Sg(j.return,tt,ot)}function xj(j,tt,ot,b,yt){var Et=j.memoizedState;Et===null?j.memoizedState={isBackwards:tt,rendering:null,renderingStartTime:0,last:b,tail:ot,tailMode:yt}:(Et.isBackwards=tt,Et.rendering=null,Et.renderingStartTime=0,Et.last=b,Et.tail=ot,Et.tailMode=yt)}function yj(j,tt,ot){var b=tt.pendingProps,yt=b.revealOrder,Et=b.tail;if(Yi(j,tt,b.children,ot),b=M.current,b&2)b=b&1|2,tt.flags|=128;else{if(j!==null&&j.flags&128)e:for(j=tt.child;j!==null;){if(j.tag===13)j.memoizedState!==null&&wj(j,ot,tt);else if(j.tag===19)wj(j,ot,tt);else if(j.child!==null){j.child.return=j,j=j.child;continue}if(j===tt)break e;for(;j.sibling===null;){if(j.return===null||j.return===tt)break e;j=j.return}j.sibling.return=j.return,j=j.sibling}b&=1}if(G(M,b),!(tt.mode&1))tt.memoizedState=null;else switch(yt){case"forwards":for(ot=tt.child,yt=null;ot!==null;)j=ot.alternate,j!==null&&Mh(j)===null&&(yt=ot),ot=ot.sibling;ot=yt,ot===null?(yt=tt.child,tt.child=null):(yt=ot.sibling,ot.sibling=null),xj(tt,!1,yt,ot,Et);break;case"backwards":for(ot=null,yt=tt.child,tt.child=null;yt!==null;){if(j=yt.alternate,j!==null&&Mh(j)===null){tt.child=yt;break}j=yt.sibling,yt.sibling=ot,ot=yt,yt=j}xj(tt,!0,ot,null,Et);break;case"together":xj(tt,!1,null,null,void 0);break;default:tt.memoizedState=null}return tt.child}function jj(j,tt){!(tt.mode&1)&&j!==null&&(j.alternate=null,tt.alternate=null,tt.flags|=2)}function $i(j,tt,ot){if(j!==null&&(tt.dependencies=j.dependencies),hh|=tt.lanes,!(ot&tt.childLanes))return null;if(j!==null&&tt.child!==j.child)throw Error(p(153));if(tt.child!==null){for(j=tt.child,ot=wh(j,j.pendingProps),tt.child=ot,ot.return=tt;j.sibling!==null;)j=j.sibling,ot=ot.sibling=wh(j,j.pendingProps),ot.return=tt;ot.sibling=null}return tt.child}function zj(j,tt,ot){switch(tt.tag){case 3:lj(tt),Ig();break;case 5:Kh(tt);break;case 1:Zf(tt.type)&&cg(tt);break;case 4:Ih(tt,tt.stateNode.containerInfo);break;case 10:var b=tt.type._context,yt=tt.memoizedProps.value;G(Mg,b._currentValue),b._currentValue=yt;break;case 13:if(b=tt.memoizedState,b!==null)return b.dehydrated!==null?(G(M,M.current&1),tt.flags|=128,null):ot&tt.child.childLanes?pj(j,tt,ot):(G(M,M.current&1),j=$i(j,tt,ot),j!==null?j.sibling:null);G(M,M.current&1);break;case 19:if(b=(ot&tt.childLanes)!==0,j.flags&128){if(b)return yj(j,tt,ot);tt.flags|=128}if(yt=tt.memoizedState,yt!==null&&(yt.rendering=null,yt.tail=null,yt.lastEffect=null),G(M,M.current),b)break;return null;case 22:case 23:return tt.lanes=0,ej(j,tt,ot)}return $i(j,tt,ot)}var Aj,Bj,Cj,Dj;Aj=function(j,tt){for(var ot=tt.child;ot!==null;){if(ot.tag===5||ot.tag===6)j.appendChild(ot.stateNode);else if(ot.tag!==4&&ot.child!==null){ot.child.return=ot,ot=ot.child;continue}if(ot===tt)break;for(;ot.sibling===null;){if(ot.return===null||ot.return===tt)return;ot=ot.return}ot.sibling.return=ot.return,ot=ot.sibling}};Bj=function(){};Cj=function(j,tt,ot,b){var yt=j.memoizedProps;if(yt!==b){j=tt.stateNode,Hh(Eh.current);var Et=null;switch(ot){case"input":yt=Ya(j,yt),b=Ya(j,b),Et=[];break;case"select":yt=A({},yt,{value:void 0}),b=A({},b,{value:void 0}),Et=[];break;case"textarea":yt=gb(j,yt),b=gb(j,b),Et=[];break;default:typeof yt.onClick!="function"&&typeof b.onClick=="function"&&(j.onclick=Bf)}ub(ot,b);var kt;ot=null;for(an in yt)if(!b.hasOwnProperty(an)&&yt.hasOwnProperty(an)&&yt[an]!=null)if(an==="style"){var Gt=yt[an];for(kt in Gt)Gt.hasOwnProperty(kt)&&(ot||(ot={}),ot[kt]="")}else an!=="dangerouslySetInnerHTML"&&an!=="children"&&an!=="suppressContentEditableWarning"&&an!=="suppressHydrationWarning"&&an!=="autoFocus"&&(ea.hasOwnProperty(an)?Et||(Et=[]):(Et=Et||[]).push(an,null));for(an in b){var Vt=b[an];if(Gt=yt!=null?yt[an]:void 0,b.hasOwnProperty(an)&&Vt!==Gt&&(Vt!=null||Gt!=null))if(an==="style")if(Gt){for(kt in Gt)!Gt.hasOwnProperty(kt)||Vt&&Vt.hasOwnProperty(kt)||(ot||(ot={}),ot[kt]="");for(kt in Vt)Vt.hasOwnProperty(kt)&&Gt[kt]!==Vt[kt]&&(ot||(ot={}),ot[kt]=Vt[kt])}else ot||(Et||(Et=[]),Et.push(an,ot)),ot=Vt;else an==="dangerouslySetInnerHTML"?(Vt=Vt?Vt.__html:void 0,Gt=Gt?Gt.__html:void 0,Vt!=null&&Gt!==Vt&&(Et=Et||[]).push(an,Vt)):an==="children"?typeof Vt!="string"&&typeof Vt!="number"||(Et=Et||[]).push(an,""+Vt):an!=="suppressContentEditableWarning"&&an!=="suppressHydrationWarning"&&(ea.hasOwnProperty(an)?(Vt!=null&&an==="onScroll"&&D("scroll",j),Et||Gt===Vt||(Et=[])):(Et=Et||[]).push(an,Vt))}ot&&(Et=Et||[]).push("style",ot);var an=Et;(tt.updateQueue=an)&&(tt.flags|=4)}};Dj=function(j,tt,ot,b){ot!==b&&(tt.flags|=4)};function Ej(j,tt){if(!I)switch(j.tailMode){case"hidden":tt=j.tail;for(var ot=null;tt!==null;)tt.alternate!==null&&(ot=tt),tt=tt.sibling;ot===null?j.tail=null:ot.sibling=null;break;case"collapsed":ot=j.tail;for(var b=null;ot!==null;)ot.alternate!==null&&(b=ot),ot=ot.sibling;b===null?tt||j.tail===null?j.tail=null:j.tail.sibling=null:b.sibling=null}}function S(j){var tt=j.alternate!==null&&j.alternate.child===j.child,ot=0,b=0;if(tt)for(var yt=j.child;yt!==null;)ot|=yt.lanes|yt.childLanes,b|=yt.subtreeFlags&14680064,b|=yt.flags&14680064,yt.return=j,yt=yt.sibling;else for(yt=j.child;yt!==null;)ot|=yt.lanes|yt.childLanes,b|=yt.subtreeFlags,b|=yt.flags,yt.return=j,yt=yt.sibling;return j.subtreeFlags|=b,j.childLanes=ot,tt}function Fj(j,tt,ot){var b=tt.pendingProps;switch(wg(tt),tt.tag){case 2:case 16:case 15:case 0:case 11:case 7:case 8:case 12:case 9:case 14:return S(tt),null;case 1:return Zf(tt.type)&&$f(),S(tt),null;case 3:return b=tt.stateNode,Jh(),E(Wf),E(H),Oh(),b.pendingContext&&(b.context=b.pendingContext,b.pendingContext=null),(j===null||j.child===null)&&(Gg(tt)?tt.flags|=4:j===null||j.memoizedState.isDehydrated&&!(tt.flags&256)||(tt.flags|=1024,zg!==null&&(Gj(zg),zg=null))),Bj(j,tt),S(tt),null;case 5:Lh(tt);var yt=Hh(Gh.current);if(ot=tt.type,j!==null&&tt.stateNode!=null)Cj(j,tt,ot,b,yt),j.ref!==tt.ref&&(tt.flags|=512,tt.flags|=2097152);else{if(!b){if(tt.stateNode===null)throw Error(p(166));return S(tt),null}if(j=Hh(Eh.current),Gg(tt)){b=tt.stateNode,ot=tt.type;var Et=tt.memoizedProps;switch(b[Of]=tt,b[Pf]=Et,j=(tt.mode&1)!==0,ot){case"dialog":D("cancel",b),D("close",b);break;case"iframe":case"object":case"embed":D("load",b);break;case"video":case"audio":for(yt=0;yt<lf.length;yt++)D(lf[yt],b);break;case"source":D("error",b);break;case"img":case"image":case"link":D("error",b),D("load",b);break;case"details":D("toggle",b);break;case"input":Za(b,Et),D("invalid",b);break;case"select":b._wrapperState={wasMultiple:!!Et.multiple},D("invalid",b);break;case"textarea":hb(b,Et),D("invalid",b)}ub(ot,Et),yt=null;for(var kt in Et)if(Et.hasOwnProperty(kt)){var Gt=Et[kt];kt==="children"?typeof Gt=="string"?b.textContent!==Gt&&(Et.suppressHydrationWarning!==!0&&Af(b.textContent,Gt,j),yt=["children",Gt]):typeof Gt=="number"&&b.textContent!==""+Gt&&(Et.suppressHydrationWarning!==!0&&Af(b.textContent,Gt,j),yt=["children",""+Gt]):ea.hasOwnProperty(kt)&&Gt!=null&&kt==="onScroll"&&D("scroll",b)}switch(ot){case"input":Va(b),db(b,Et,!0);break;case"textarea":Va(b),jb(b);break;case"select":case"option":break;default:typeof Et.onClick=="function"&&(b.onclick=Bf)}b=yt,tt.updateQueue=b,b!==null&&(tt.flags|=4)}else{kt=yt.nodeType===9?yt:yt.ownerDocument,j==="http://www.w3.org/1999/xhtml"&&(j=kb(ot)),j==="http://www.w3.org/1999/xhtml"?ot==="script"?(j=kt.createElement("div"),j.innerHTML="<script><\/script>",j=j.removeChild(j.firstChild)):typeof b.is=="string"?j=kt.createElement(ot,{is:b.is}):(j=kt.createElement(ot),ot==="select"&&(kt=j,b.multiple?kt.multiple=!0:b.size&&(kt.size=b.size))):j=kt.createElementNS(j,ot),j[Of]=tt,j[Pf]=b,Aj(j,tt,!1,!1),tt.stateNode=j;e:{switch(kt=vb(ot,b),ot){case"dialog":D("cancel",j),D("close",j),yt=b;break;case"iframe":case"object":case"embed":D("load",j),yt=b;break;case"video":case"audio":for(yt=0;yt<lf.length;yt++)D(lf[yt],j);yt=b;break;case"source":D("error",j),yt=b;break;case"img":case"image":case"link":D("error",j),D("load",j),yt=b;break;case"details":D("toggle",j),yt=b;break;case"input":Za(j,b),yt=Ya(j,b),D("invalid",j);break;case"option":yt=b;break;case"select":j._wrapperState={wasMultiple:!!b.multiple},yt=A({},b,{value:void 0}),D("invalid",j);break;case"textarea":hb(j,b),yt=gb(j,b),D("invalid",j);break;default:yt=b}ub(ot,yt),Gt=yt;for(Et in Gt)if(Gt.hasOwnProperty(Et)){var Vt=Gt[Et];Et==="style"?sb(j,Vt):Et==="dangerouslySetInnerHTML"?(Vt=Vt?Vt.__html:void 0,Vt!=null&&nb(j,Vt)):Et==="children"?typeof Vt=="string"?(ot!=="textarea"||Vt!=="")&&ob(j,Vt):typeof Vt=="number"&&ob(j,""+Vt):Et!=="suppressContentEditableWarning"&&Et!=="suppressHydrationWarning"&&Et!=="autoFocus"&&(ea.hasOwnProperty(Et)?Vt!=null&&Et==="onScroll"&&D("scroll",j):Vt!=null&&ta(j,Et,Vt,kt))}switch(ot){case"input":Va(j),db(j,b,!1);break;case"textarea":Va(j),jb(j);break;case"option":b.value!=null&&j.setAttribute("value",""+Sa(b.value));break;case"select":j.multiple=!!b.multiple,Et=b.value,Et!=null?fb(j,!!b.multiple,Et,!1):b.defaultValue!=null&&fb(j,!!b.multiple,b.defaultValue,!0);break;default:typeof yt.onClick=="function"&&(j.onclick=Bf)}switch(ot){case"button":case"input":case"select":case"textarea":b=!!b.autoFocus;break e;case"img":b=!0;break e;default:b=!1}}b&&(tt.flags|=4)}tt.ref!==null&&(tt.flags|=512,tt.flags|=2097152)}return S(tt),null;case 6:if(j&&tt.stateNode!=null)Dj(j,tt,j.memoizedProps,b);else{if(typeof b!="string"&&tt.stateNode===null)throw Error(p(166));if(ot=Hh(Gh.current),Hh(Eh.current),Gg(tt)){if(b=tt.stateNode,ot=tt.memoizedProps,b[Of]=tt,(Et=b.nodeValue!==ot)&&(j=xg,j!==null))switch(j.tag){case 3:Af(b.nodeValue,ot,(j.mode&1)!==0);break;case 5:j.memoizedProps.suppressHydrationWarning!==!0&&Af(b.nodeValue,ot,(j.mode&1)!==0)}Et&&(tt.flags|=4)}else b=(ot.nodeType===9?ot:ot.ownerDocument).createTextNode(b),b[Of]=tt,tt.stateNode=b}return S(tt),null;case 13:if(E(M),b=tt.memoizedState,j===null||j.memoizedState!==null&&j.memoizedState.dehydrated!==null){if(I&&yg!==null&&tt.mode&1&&!(tt.flags&128))Hg(),Ig(),tt.flags|=98560,Et=!1;else if(Et=Gg(tt),b!==null&&b.dehydrated!==null){if(j===null){if(!Et)throw Error(p(318));if(Et=tt.memoizedState,Et=Et!==null?Et.dehydrated:null,!Et)throw Error(p(317));Et[Of]=tt}else Ig(),!(tt.flags&128)&&(tt.memoizedState=null),tt.flags|=4;S(tt),Et=!1}else zg!==null&&(Gj(zg),zg=null),Et=!0;if(!Et)return tt.flags&65536?tt:null}return tt.flags&128?(tt.lanes=ot,tt):(b=b!==null,b!==(j!==null&&j.memoizedState!==null)&&b&&(tt.child.flags|=8192,tt.mode&1&&(j===null||M.current&1?T===0&&(T=3):uj())),tt.updateQueue!==null&&(tt.flags|=4),S(tt),null);case 4:return Jh(),Bj(j,tt),j===null&&sf(tt.stateNode.containerInfo),S(tt),null;case 10:return Rg(tt.type._context),S(tt),null;case 17:return Zf(tt.type)&&$f(),S(tt),null;case 19:if(E(M),Et=tt.memoizedState,Et===null)return S(tt),null;if(b=(tt.flags&128)!==0,kt=Et.rendering,kt===null)if(b)Ej(Et,!1);else{if(T!==0||j!==null&&j.flags&128)for(j=tt.child;j!==null;){if(kt=Mh(j),kt!==null){for(tt.flags|=128,Ej(Et,!1),b=kt.updateQueue,b!==null&&(tt.updateQueue=b,tt.flags|=4),tt.subtreeFlags=0,b=ot,ot=tt.child;ot!==null;)Et=ot,j=b,Et.flags&=14680066,kt=Et.alternate,kt===null?(Et.childLanes=0,Et.lanes=j,Et.child=null,Et.subtreeFlags=0,Et.memoizedProps=null,Et.memoizedState=null,Et.updateQueue=null,Et.dependencies=null,Et.stateNode=null):(Et.childLanes=kt.childLanes,Et.lanes=kt.lanes,Et.child=kt.child,Et.subtreeFlags=0,Et.deletions=null,Et.memoizedProps=kt.memoizedProps,Et.memoizedState=kt.memoizedState,Et.updateQueue=kt.updateQueue,Et.type=kt.type,j=kt.dependencies,Et.dependencies=j===null?null:{lanes:j.lanes,firstContext:j.firstContext}),ot=ot.sibling;return G(M,M.current&1|2),tt.child}j=j.sibling}Et.tail!==null&&B()>Hj&&(tt.flags|=128,b=!0,Ej(Et,!1),tt.lanes=4194304)}else{if(!b)if(j=Mh(kt),j!==null){if(tt.flags|=128,b=!0,ot=j.updateQueue,ot!==null&&(tt.updateQueue=ot,tt.flags|=4),Ej(Et,!0),Et.tail===null&&Et.tailMode==="hidden"&&!kt.alternate&&!I)return S(tt),null}else 2*B()-Et.renderingStartTime>Hj&&ot!==1073741824&&(tt.flags|=128,b=!0,Ej(Et,!1),tt.lanes=4194304);Et.isBackwards?(kt.sibling=tt.child,tt.child=kt):(ot=Et.last,ot!==null?ot.sibling=kt:tt.child=kt,Et.last=kt)}return Et.tail!==null?(tt=Et.tail,Et.rendering=tt,Et.tail=tt.sibling,Et.renderingStartTime=B(),tt.sibling=null,ot=M.current,G(M,b?ot&1|2:ot&1),tt):(S(tt),null);case 22:case 23:return Ij(),b=tt.memoizedState!==null,j!==null&&j.memoizedState!==null!==b&&(tt.flags|=8192),b&&tt.mode&1?gj&1073741824&&(S(tt),tt.subtreeFlags&6&&(tt.flags|=8192)):S(tt),null;case 24:return null;case 25:return null}throw Error(p(156,tt.tag))}function Jj(j,tt){switch(wg(tt),tt.tag){case 1:return Zf(tt.type)&&$f(),j=tt.flags,j&65536?(tt.flags=j&-65537|128,tt):null;case 3:return Jh(),E(Wf),E(H),Oh(),j=tt.flags,j&65536&&!(j&128)?(tt.flags=j&-65537|128,tt):null;case 5:return Lh(tt),null;case 13:if(E(M),j=tt.memoizedState,j!==null&&j.dehydrated!==null){if(tt.alternate===null)throw Error(p(340));Ig()}return j=tt.flags,j&65536?(tt.flags=j&-65537|128,tt):null;case 19:return E(M),null;case 4:return Jh(),null;case 10:return Rg(tt.type._context),null;case 22:case 23:return Ij(),null;case 24:return null;default:return null}}var Kj=!1,U=!1,Lj=typeof WeakSet=="function"?WeakSet:Set,V=null;function Mj(j,tt){var ot=j.ref;if(ot!==null)if(typeof ot=="function")try{ot(null)}catch(b){W(j,tt,b)}else ot.current=null}function Nj(j,tt,ot){try{ot()}catch(b){W(j,tt,b)}}var Oj=!1;function Pj(j,tt){if(Cf=dd,j=Me(),Ne(j)){if("selectionStart"in j)var ot={start:j.selectionStart,end:j.selectionEnd};else e:{ot=(ot=j.ownerDocument)&&ot.defaultView||window;var b=ot.getSelection&&ot.getSelection();if(b&&b.rangeCount!==0){ot=b.anchorNode;var yt=b.anchorOffset,Et=b.focusNode;b=b.focusOffset;try{ot.nodeType,Et.nodeType}catch{ot=null;break e}var kt=0,Gt=-1,Vt=-1,an=0,Pn=0,gn=j,dn=null;t:for(;;){for(var wn;gn!==ot||yt!==0&&gn.nodeType!==3||(Gt=kt+yt),gn!==Et||b!==0&&gn.nodeType!==3||(Vt=kt+b),gn.nodeType===3&&(kt+=gn.nodeValue.length),(wn=gn.firstChild)!==null;)dn=gn,gn=wn;for(;;){if(gn===j)break t;if(dn===ot&&++an===yt&&(Gt=kt),dn===Et&&++Pn===b&&(Vt=kt),(wn=gn.nextSibling)!==null)break;gn=dn,dn=gn.parentNode}gn=wn}ot=Gt===-1||Vt===-1?null:{start:Gt,end:Vt}}else ot=null}ot=ot||{start:0,end:0}}else ot=null;for(Df={focusedElem:j,selectionRange:ot},dd=!1,V=tt;V!==null;)if(tt=V,j=tt.child,(tt.subtreeFlags&1028)!==0&&j!==null)j.return=tt,V=j;else for(;V!==null;){tt=V;try{var _n=tt.alternate;if(tt.flags&1024)switch(tt.tag){case 0:case 11:case 15:break;case 1:if(_n!==null){var $t=_n.memoizedProps,bn=_n.memoizedState,Ut=tt.stateNode,jt=Ut.getSnapshotBeforeUpdate(tt.elementType===tt.type?$t:Lg(tt.type,$t),bn);Ut.__reactInternalSnapshotBeforeUpdate=jt}break;case 3:var Yt=tt.stateNode.containerInfo;Yt.nodeType===1?Yt.textContent="":Yt.nodeType===9&&Yt.documentElement&&Yt.removeChild(Yt.documentElement);break;case 5:case 6:case 4:case 17:break;default:throw Error(p(163))}}catch(Bn){W(tt,tt.return,Bn)}if(j=tt.sibling,j!==null){j.return=tt.return,V=j;break}V=tt.return}return _n=Oj,Oj=!1,_n}function Qj(j,tt,ot){var b=tt.updateQueue;if(b=b!==null?b.lastEffect:null,b!==null){var yt=b=b.next;do{if((yt.tag&j)===j){var Et=yt.destroy;yt.destroy=void 0,Et!==void 0&&Nj(tt,ot,Et)}yt=yt.next}while(yt!==b)}}function Rj(j,tt){if(tt=tt.updateQueue,tt=tt!==null?tt.lastEffect:null,tt!==null){var ot=tt=tt.next;do{if((ot.tag&j)===j){var b=ot.create;ot.destroy=b()}ot=ot.next}while(ot!==tt)}}function Sj(j){var tt=j.ref;if(tt!==null){var ot=j.stateNode;switch(j.tag){case 5:j=ot;break;default:j=ot}typeof tt=="function"?tt(j):tt.current=j}}function Tj(j){var tt=j.alternate;tt!==null&&(j.alternate=null,Tj(tt)),j.child=null,j.deletions=null,j.sibling=null,j.tag===5&&(tt=j.stateNode,tt!==null&&(delete tt[Of],delete tt[Pf],delete tt[of],delete tt[Qf],delete tt[Rf])),j.stateNode=null,j.return=null,j.dependencies=null,j.memoizedProps=null,j.memoizedState=null,j.pendingProps=null,j.stateNode=null,j.updateQueue=null}function Uj(j){return j.tag===5||j.tag===3||j.tag===4}function Vj(j){e:for(;;){for(;j.sibling===null;){if(j.return===null||Uj(j.return))return null;j=j.return}for(j.sibling.return=j.return,j=j.sibling;j.tag!==5&&j.tag!==6&&j.tag!==18;){if(j.flags&2||j.child===null||j.tag===4)continue e;j.child.return=j,j=j.child}if(!(j.flags&2))return j.stateNode}}function Wj(j,tt,ot){var b=j.tag;if(b===5||b===6)j=j.stateNode,tt?ot.nodeType===8?ot.parentNode.insertBefore(j,tt):ot.insertBefore(j,tt):(ot.nodeType===8?(tt=ot.parentNode,tt.insertBefore(j,ot)):(tt=ot,tt.appendChild(j)),ot=ot._reactRootContainer,ot!=null||tt.onclick!==null||(tt.onclick=Bf));else if(b!==4&&(j=j.child,j!==null))for(Wj(j,tt,ot),j=j.sibling;j!==null;)Wj(j,tt,ot),j=j.sibling}function Xj(j,tt,ot){var b=j.tag;if(b===5||b===6)j=j.stateNode,tt?ot.insertBefore(j,tt):ot.appendChild(j);else if(b!==4&&(j=j.child,j!==null))for(Xj(j,tt,ot),j=j.sibling;j!==null;)Xj(j,tt,ot),j=j.sibling}var X=null,Yj=!1;function Zj(j,tt,ot){for(ot=ot.child;ot!==null;)ak(j,tt,ot),ot=ot.sibling}function ak(j,tt,ot){if(lc&&typeof lc.onCommitFiberUnmount=="function")try{lc.onCommitFiberUnmount(kc,ot)}catch{}switch(ot.tag){case 5:U||Mj(ot,tt);case 6:var b=X,yt=Yj;X=null,Zj(j,tt,ot),X=b,Yj=yt,X!==null&&(Yj?(j=X,ot=ot.stateNode,j.nodeType===8?j.parentNode.removeChild(ot):j.removeChild(ot)):X.removeChild(ot.stateNode));break;case 18:X!==null&&(Yj?(j=X,ot=ot.stateNode,j.nodeType===8?Kf(j.parentNode,ot):j.nodeType===1&&Kf(j,ot),bd(j)):Kf(X,ot.stateNode));break;case 4:b=X,yt=Yj,X=ot.stateNode.containerInfo,Yj=!0,Zj(j,tt,ot),X=b,Yj=yt;break;case 0:case 11:case 14:case 15:if(!U&&(b=ot.updateQueue,b!==null&&(b=b.lastEffect,b!==null))){yt=b=b.next;do{var Et=yt,kt=Et.destroy;Et=Et.tag,kt!==void 0&&(Et&2||Et&4)&&Nj(ot,tt,kt),yt=yt.next}while(yt!==b)}Zj(j,tt,ot);break;case 1:if(!U&&(Mj(ot,tt),b=ot.stateNode,typeof b.componentWillUnmount=="function"))try{b.props=ot.memoizedProps,b.state=ot.memoizedState,b.componentWillUnmount()}catch(Gt){W(ot,tt,Gt)}Zj(j,tt,ot);break;case 21:Zj(j,tt,ot);break;case 22:ot.mode&1?(U=(b=U)||ot.memoizedState!==null,Zj(j,tt,ot),U=b):Zj(j,tt,ot);break;default:Zj(j,tt,ot)}}function bk(j){var tt=j.updateQueue;if(tt!==null){j.updateQueue=null;var ot=j.stateNode;ot===null&&(ot=j.stateNode=new Lj),tt.forEach(function(b){var yt=ck.bind(null,j,b);ot.has(b)||(ot.add(b),b.then(yt,yt))})}}function dk(j,tt){var ot=tt.deletions;if(ot!==null)for(var b=0;b<ot.length;b++){var yt=ot[b];try{var Et=j,kt=tt,Gt=kt;e:for(;Gt!==null;){switch(Gt.tag){case 5:X=Gt.stateNode,Yj=!1;break e;case 3:X=Gt.stateNode.containerInfo,Yj=!0;break e;case 4:X=Gt.stateNode.containerInfo,Yj=!0;break e}Gt=Gt.return}if(X===null)throw Error(p(160));ak(Et,kt,yt),X=null,Yj=!1;var Vt=yt.alternate;Vt!==null&&(Vt.return=null),yt.return=null}catch(an){W(yt,tt,an)}}if(tt.subtreeFlags&12854)for(tt=tt.child;tt!==null;)ek(tt,j),tt=tt.sibling}function ek(j,tt){var ot=j.alternate,b=j.flags;switch(j.tag){case 0:case 11:case 14:case 15:if(dk(tt,j),fk(j),b&4){try{Qj(3,j,j.return),Rj(3,j)}catch($t){W(j,j.return,$t)}try{Qj(5,j,j.return)}catch($t){W(j,j.return,$t)}}break;case 1:dk(tt,j),fk(j),b&512&&ot!==null&&Mj(ot,ot.return);break;case 5:if(dk(tt,j),fk(j),b&512&&ot!==null&&Mj(ot,ot.return),j.flags&32){var yt=j.stateNode;try{ob(yt,"")}catch($t){W(j,j.return,$t)}}if(b&4&&(yt=j.stateNode,yt!=null)){var Et=j.memoizedProps,kt=ot!==null?ot.memoizedProps:Et,Gt=j.type,Vt=j.updateQueue;if(j.updateQueue=null,Vt!==null)try{Gt==="input"&&Et.type==="radio"&&Et.name!=null&&ab(yt,Et),vb(Gt,kt);var an=vb(Gt,Et);for(kt=0;kt<Vt.length;kt+=2){var Pn=Vt[kt],gn=Vt[kt+1];Pn==="style"?sb(yt,gn):Pn==="dangerouslySetInnerHTML"?nb(yt,gn):Pn==="children"?ob(yt,gn):ta(yt,Pn,gn,an)}switch(Gt){case"input":bb(yt,Et);break;case"textarea":ib(yt,Et);break;case"select":var dn=yt._wrapperState.wasMultiple;yt._wrapperState.wasMultiple=!!Et.multiple;var wn=Et.value;wn!=null?fb(yt,!!Et.multiple,wn,!1):dn!==!!Et.multiple&&(Et.defaultValue!=null?fb(yt,!!Et.multiple,Et.defaultValue,!0):fb(yt,!!Et.multiple,Et.multiple?[]:"",!1))}yt[Pf]=Et}catch($t){W(j,j.return,$t)}}break;case 6:if(dk(tt,j),fk(j),b&4){if(j.stateNode===null)throw Error(p(162));yt=j.stateNode,Et=j.memoizedProps;try{yt.nodeValue=Et}catch($t){W(j,j.return,$t)}}break;case 3:if(dk(tt,j),fk(j),b&4&&ot!==null&&ot.memoizedState.isDehydrated)try{bd(tt.containerInfo)}catch($t){W(j,j.return,$t)}break;case 4:dk(tt,j),fk(j);break;case 13:dk(tt,j),fk(j),yt=j.child,yt.flags&8192&&(Et=yt.memoizedState!==null,yt.stateNode.isHidden=Et,!Et||yt.alternate!==null&&yt.alternate.memoizedState!==null||(gk=B())),b&4&&bk(j);break;case 22:if(Pn=ot!==null&&ot.memoizedState!==null,j.mode&1?(U=(an=U)||Pn,dk(tt,j),U=an):dk(tt,j),fk(j),b&8192){if(an=j.memoizedState!==null,(j.stateNode.isHidden=an)&&!Pn&&j.mode&1)for(V=j,Pn=j.child;Pn!==null;){for(gn=V=Pn;V!==null;){switch(dn=V,wn=dn.child,dn.tag){case 0:case 11:case 14:case 15:Qj(4,dn,dn.return);break;case 1:Mj(dn,dn.return);var _n=dn.stateNode;if(typeof _n.componentWillUnmount=="function"){b=dn,ot=dn.return;try{tt=b,_n.props=tt.memoizedProps,_n.state=tt.memoizedState,_n.componentWillUnmount()}catch($t){W(b,ot,$t)}}break;case 5:Mj(dn,dn.return);break;case 22:if(dn.memoizedState!==null){hk(gn);continue}}wn!==null?(wn.return=dn,V=wn):hk(gn)}Pn=Pn.sibling}e:for(Pn=null,gn=j;;){if(gn.tag===5){if(Pn===null){Pn=gn;try{yt=gn.stateNode,an?(Et=yt.style,typeof Et.setProperty=="function"?Et.setProperty("display","none","important"):Et.display="none"):(Gt=gn.stateNode,Vt=gn.memoizedProps.style,kt=Vt!=null&&Vt.hasOwnProperty("display")?Vt.display:null,Gt.style.display=rb("display",kt))}catch($t){W(j,j.return,$t)}}}else if(gn.tag===6){if(Pn===null)try{gn.stateNode.nodeValue=an?"":gn.memoizedProps}catch($t){W(j,j.return,$t)}}else if((gn.tag!==22&&gn.tag!==23||gn.memoizedState===null||gn===j)&&gn.child!==null){gn.child.return=gn,gn=gn.child;continue}if(gn===j)break e;for(;gn.sibling===null;){if(gn.return===null||gn.return===j)break e;Pn===gn&&(Pn=null),gn=gn.return}Pn===gn&&(Pn=null),gn.sibling.return=gn.return,gn=gn.sibling}}break;case 19:dk(tt,j),fk(j),b&4&&bk(j);break;case 21:break;default:dk(tt,j),fk(j)}}function fk(j){var tt=j.flags;if(tt&2){try{e:{for(var ot=j.return;ot!==null;){if(Uj(ot)){var b=ot;break e}ot=ot.return}throw Error(p(160))}switch(b.tag){case 5:var yt=b.stateNode;b.flags&32&&(ob(yt,""),b.flags&=-33);var Et=Vj(j);Xj(j,Et,yt);break;case 3:case 4:var kt=b.stateNode.containerInfo,Gt=Vj(j);Wj(j,Gt,kt);break;default:throw Error(p(161))}}catch(Vt){W(j,j.return,Vt)}j.flags&=-3}tt&4096&&(j.flags&=-4097)}function ik(j,tt,ot){V=j,jk(j)}function jk(j,tt,ot){for(var b=(j.mode&1)!==0;V!==null;){var yt=V,Et=yt.child;if(yt.tag===22&&b){var kt=yt.memoizedState!==null||Kj;if(!kt){var Gt=yt.alternate,Vt=Gt!==null&&Gt.memoizedState!==null||U;Gt=Kj;var an=U;if(Kj=kt,(U=Vt)&&!an)for(V=yt;V!==null;)kt=V,Vt=kt.child,kt.tag===22&&kt.memoizedState!==null?kk(yt):Vt!==null?(Vt.return=kt,V=Vt):kk(yt);for(;Et!==null;)V=Et,jk(Et),Et=Et.sibling;V=yt,Kj=Gt,U=an}lk(j)}else yt.subtreeFlags&8772&&Et!==null?(Et.return=yt,V=Et):lk(j)}}function lk(j){for(;V!==null;){var tt=V;if(tt.flags&8772){var ot=tt.alternate;try{if(tt.flags&8772)switch(tt.tag){case 0:case 11:case 15:U||Rj(5,tt);break;case 1:var b=tt.stateNode;if(tt.flags&4&&!U)if(ot===null)b.componentDidMount();else{var yt=tt.elementType===tt.type?ot.memoizedProps:Lg(tt.type,ot.memoizedProps);b.componentDidUpdate(yt,ot.memoizedState,b.__reactInternalSnapshotBeforeUpdate)}var Et=tt.updateQueue;Et!==null&&ih(tt,Et,b);break;case 3:var kt=tt.updateQueue;if(kt!==null){if(ot=null,tt.child!==null)switch(tt.child.tag){case 5:ot=tt.child.stateNode;break;case 1:ot=tt.child.stateNode}ih(tt,kt,ot)}break;case 5:var Gt=tt.stateNode;if(ot===null&&tt.flags&4){ot=Gt;var Vt=tt.memoizedProps;switch(tt.type){case"button":case"input":case"select":case"textarea":Vt.autoFocus&&ot.focus();break;case"img":Vt.src&&(ot.src=Vt.src)}}break;case 6:break;case 4:break;case 12:break;case 13:if(tt.memoizedState===null){var an=tt.alternate;if(an!==null){var Pn=an.memoizedState;if(Pn!==null){var gn=Pn.dehydrated;gn!==null&&bd(gn)}}}break;case 19:case 17:case 21:case 22:case 23:case 25:break;default:throw Error(p(163))}U||tt.flags&512&&Sj(tt)}catch(dn){W(tt,tt.return,dn)}}if(tt===j){V=null;break}if(ot=tt.sibling,ot!==null){ot.return=tt.return,V=ot;break}V=tt.return}}function hk(j){for(;V!==null;){var tt=V;if(tt===j){V=null;break}var ot=tt.sibling;if(ot!==null){ot.return=tt.return,V=ot;break}V=tt.return}}function kk(j){for(;V!==null;){var tt=V;try{switch(tt.tag){case 0:case 11:case 15:var ot=tt.return;try{Rj(4,tt)}catch(Vt){W(tt,ot,Vt)}break;case 1:var b=tt.stateNode;if(typeof b.componentDidMount=="function"){var yt=tt.return;try{b.componentDidMount()}catch(Vt){W(tt,yt,Vt)}}var Et=tt.return;try{Sj(tt)}catch(Vt){W(tt,Et,Vt)}break;case 5:var kt=tt.return;try{Sj(tt)}catch(Vt){W(tt,kt,Vt)}}}catch(Vt){W(tt,tt.return,Vt)}if(tt===j){V=null;break}var Gt=tt.sibling;if(Gt!==null){Gt.return=tt.return,V=Gt;break}V=tt.return}}var mk=Math.ceil,nk=ua.ReactCurrentDispatcher,ok=ua.ReactCurrentOwner,pk=ua.ReactCurrentBatchConfig,K=0,R=null,Y=null,Z=0,gj=0,fj=Uf(0),T=0,qk=null,hh=0,rk=0,sk=0,tk=null,uk=null,gk=0,Hj=1/0,vk=null,Pi=!1,Qi=null,Si=null,wk=!1,xk=null,yk=0,zk=0,Ak=null,Bk=-1,Ck=0;function L(){return K&6?B():Bk!==-1?Bk:Bk=B()}function lh(j){return j.mode&1?K&2&&Z!==0?Z&-Z:Kg.transition!==null?(Ck===0&&(Ck=yc()),Ck):(j=C,j!==0||(j=window.event,j=j===void 0?16:jd(j.type)),j):1}function mh(j,tt,ot,b){if(50<zk)throw zk=0,Ak=null,Error(p(185));Ac(j,ot,b),(!(K&2)||j!==R)&&(j===R&&(!(K&2)&&(rk|=ot),T===4&&Dk(j,Z)),Ek(j,b),ot===1&&K===0&&!(tt.mode&1)&&(Hj=B()+500,fg&&jg()))}function Ek(j,tt){var ot=j.callbackNode;wc(j,tt);var b=uc(j,j===R?Z:0);if(b===0)ot!==null&&bc(ot),j.callbackNode=null,j.callbackPriority=0;else if(tt=b&-b,j.callbackPriority!==tt){if(ot!=null&&bc(ot),tt===1)j.tag===0?ig(Fk.bind(null,j)):hg(Fk.bind(null,j)),Jf(function(){!(K&6)&&jg()}),ot=null;else{switch(Dc(b)){case 1:ot=fc;break;case 4:ot=gc;break;case 16:ot=hc;break;case 536870912:ot=jc;break;default:ot=hc}ot=Gk(ot,Hk.bind(null,j))}j.callbackPriority=tt,j.callbackNode=ot}}function Hk(j,tt){if(Bk=-1,Ck=0,K&6)throw Error(p(327));var ot=j.callbackNode;if(Ik()&&j.callbackNode!==ot)return null;var b=uc(j,j===R?Z:0);if(b===0)return null;if(b&30||b&j.expiredLanes||tt)tt=Jk(j,b);else{tt=b;var yt=K;K|=2;var Et=Kk();(R!==j||Z!==tt)&&(vk=null,Hj=B()+500,Lk(j,tt));do try{Mk();break}catch(Gt){Nk(j,Gt)}while(1);Qg(),nk.current=Et,K=yt,Y!==null?tt=0:(R=null,Z=0,tt=T)}if(tt!==0){if(tt===2&&(yt=xc(j),yt!==0&&(b=yt,tt=Ok(j,yt))),tt===1)throw ot=qk,Lk(j,0),Dk(j,b),Ek(j,B()),ot;if(tt===6)Dk(j,b);else{if(yt=j.current.alternate,!(b&30)&&!Pk(yt)&&(tt=Jk(j,b),tt===2&&(Et=xc(j),Et!==0&&(b=Et,tt=Ok(j,Et))),tt===1))throw ot=qk,Lk(j,0),Dk(j,b),Ek(j,B()),ot;switch(j.finishedWork=yt,j.finishedLanes=b,tt){case 0:case 1:throw Error(p(345));case 2:Qk(j,uk,vk);break;case 3:if(Dk(j,b),(b&130023424)===b&&(tt=gk+500-B(),10<tt)){if(uc(j,0)!==0)break;if(yt=j.suspendedLanes,(yt&b)!==b){L(),j.pingedLanes|=j.suspendedLanes&yt;break}j.timeoutHandle=Ff(Qk.bind(null,j,uk,vk),tt);break}Qk(j,uk,vk);break;case 4:if(Dk(j,b),(b&4194240)===b)break;for(tt=j.eventTimes,yt=-1;0<b;){var kt=31-oc(b);Et=1<<kt,kt=tt[kt],kt>yt&&(yt=kt),b&=~Et}if(b=yt,b=B()-b,b=(120>b?120:480>b?480:1080>b?1080:1920>b?1920:3e3>b?3e3:4320>b?4320:1960*mk(b/1960))-b,10<b){j.timeoutHandle=Ff(Qk.bind(null,j,uk,vk),b);break}Qk(j,uk,vk);break;case 5:Qk(j,uk,vk);break;default:throw Error(p(329))}}}return Ek(j,B()),j.callbackNode===ot?Hk.bind(null,j):null}function Ok(j,tt){var ot=tk;return j.current.memoizedState.isDehydrated&&(Lk(j,tt).flags|=256),j=Jk(j,tt),j!==2&&(tt=uk,uk=ot,tt!==null&&Gj(tt)),j}function Gj(j){uk===null?uk=j:uk.push.apply(uk,j)}function Pk(j){for(var tt=j;;){if(tt.flags&16384){var ot=tt.updateQueue;if(ot!==null&&(ot=ot.stores,ot!==null))for(var b=0;b<ot.length;b++){var yt=ot[b],Et=yt.getSnapshot;yt=yt.value;try{if(!He(Et(),yt))return!1}catch{return!1}}}if(ot=tt.child,tt.subtreeFlags&16384&&ot!==null)ot.return=tt,tt=ot;else{if(tt===j)break;for(;tt.sibling===null;){if(tt.return===null||tt.return===j)return!0;tt=tt.return}tt.sibling.return=tt.return,tt=tt.sibling}}return!0}function Dk(j,tt){for(tt&=~sk,tt&=~rk,j.suspendedLanes|=tt,j.pingedLanes&=~tt,j=j.expirationTimes;0<tt;){var ot=31-oc(tt),b=1<<ot;j[ot]=-1,tt&=~b}}function Fk(j){if(K&6)throw Error(p(327));Ik();var tt=uc(j,0);if(!(tt&1))return Ek(j,B()),null;var ot=Jk(j,tt);if(j.tag!==0&&ot===2){var b=xc(j);b!==0&&(tt=b,ot=Ok(j,b))}if(ot===1)throw ot=qk,Lk(j,0),Dk(j,tt),Ek(j,B()),ot;if(ot===6)throw Error(p(345));return j.finishedWork=j.current.alternate,j.finishedLanes=tt,Qk(j,uk,vk),Ek(j,B()),null}function Rk(j,tt){var ot=K;K|=1;try{return j(tt)}finally{K=ot,K===0&&(Hj=B()+500,fg&&jg())}}function Sk(j){xk!==null&&xk.tag===0&&!(K&6)&&Ik();var tt=K;K|=1;var ot=pk.transition,b=C;try{if(pk.transition=null,C=1,j)return j()}finally{C=b,pk.transition=ot,K=tt,!(K&6)&&jg()}}function Ij(){gj=fj.current,E(fj)}function Lk(j,tt){j.finishedWork=null,j.finishedLanes=0;var ot=j.timeoutHandle;if(ot!==-1&&(j.timeoutHandle=-1,Gf(ot)),Y!==null)for(ot=Y.return;ot!==null;){var b=ot;switch(wg(b),b.tag){case 1:b=b.type.childContextTypes,b!=null&&$f();break;case 3:Jh(),E(Wf),E(H),Oh();break;case 5:Lh(b);break;case 4:Jh();break;case 13:E(M);break;case 19:E(M);break;case 10:Rg(b.type._context);break;case 22:case 23:Ij()}ot=ot.return}if(R=j,Y=j=wh(j.current,null),Z=gj=tt,T=0,qk=null,sk=rk=hh=0,uk=tk=null,Wg!==null){for(tt=0;tt<Wg.length;tt++)if(ot=Wg[tt],b=ot.interleaved,b!==null){ot.interleaved=null;var yt=b.next,Et=ot.pending;if(Et!==null){var kt=Et.next;Et.next=yt,b.next=kt}ot.pending=b}Wg=null}return j}function Nk(j,tt){do{var ot=Y;try{if(Qg(),Ph.current=ai,Sh){for(var b=N.memoizedState;b!==null;){var yt=b.queue;yt!==null&&(yt.pending=null),b=b.next}Sh=!1}if(Rh=0,P=O=N=null,Th=!1,Uh=0,ok.current=null,ot===null||ot.return===null){T=1,qk=tt,Y=null;break}e:{var Et=j,kt=ot.return,Gt=ot,Vt=tt;if(tt=Z,Gt.flags|=32768,Vt!==null&&typeof Vt=="object"&&typeof Vt.then=="function"){var an=Vt,Pn=Gt,gn=Pn.tag;if(!(Pn.mode&1)&&(gn===0||gn===11||gn===15)){var dn=Pn.alternate;dn?(Pn.updateQueue=dn.updateQueue,Pn.memoizedState=dn.memoizedState,Pn.lanes=dn.lanes):(Pn.updateQueue=null,Pn.memoizedState=null)}var wn=Vi(kt);if(wn!==null){wn.flags&=-257,Wi(wn,kt,Gt,Et,tt),wn.mode&1&&Ti(Et,an,tt),tt=wn,Vt=an;var _n=tt.updateQueue;if(_n===null){var $t=new Set;$t.add(Vt),tt.updateQueue=$t}else _n.add(Vt);break e}else{if(!(tt&1)){Ti(Et,an,tt),uj();break e}Vt=Error(p(426))}}else if(I&&Gt.mode&1){var bn=Vi(kt);if(bn!==null){!(bn.flags&65536)&&(bn.flags|=256),Wi(bn,kt,Gt,Et,tt),Jg(Ki(Vt,Gt));break e}}Et=Vt=Ki(Vt,Gt),T!==4&&(T=2),tk===null?tk=[Et]:tk.push(Et),Et=kt;do{switch(Et.tag){case 3:Et.flags|=65536,tt&=-tt,Et.lanes|=tt;var Ut=Oi(Et,Vt,tt);fh(Et,Ut);break e;case 1:Gt=Vt;var jt=Et.type,Yt=Et.stateNode;if(!(Et.flags&128)&&(typeof jt.getDerivedStateFromError=="function"||Yt!==null&&typeof Yt.componentDidCatch=="function"&&(Si===null||!Si.has(Yt)))){Et.flags|=65536,tt&=-tt,Et.lanes|=tt;var Bn=Ri(Et,Gt,tt);fh(Et,Bn);break e}}Et=Et.return}while(Et!==null)}Tk(ot)}catch(un){tt=un,Y===ot&&ot!==null&&(Y=ot=ot.return);continue}break}while(1)}function Kk(){var j=nk.current;return nk.current=ai,j===null?ai:j}function uj(){(T===0||T===3||T===2)&&(T=4),R===null||!(hh&268435455)&&!(rk&268435455)||Dk(R,Z)}function Jk(j,tt){var ot=K;K|=2;var b=Kk();(R!==j||Z!==tt)&&(vk=null,Lk(j,tt));do try{Uk();break}catch(yt){Nk(j,yt)}while(1);if(Qg(),K=ot,nk.current=b,Y!==null)throw Error(p(261));return R=null,Z=0,T}function Uk(){for(;Y!==null;)Vk(Y)}function Mk(){for(;Y!==null&&!cc();)Vk(Y)}function Vk(j){var tt=Wk(j.alternate,j,gj);j.memoizedProps=j.pendingProps,tt===null?Tk(j):Y=tt,ok.current=null}function Tk(j){var tt=j;do{var ot=tt.alternate;if(j=tt.return,tt.flags&32768){if(ot=Jj(ot,tt),ot!==null){ot.flags&=32767,Y=ot;return}if(j!==null)j.flags|=32768,j.subtreeFlags=0,j.deletions=null;else{T=6,Y=null;return}}else if(ot=Fj(ot,tt,gj),ot!==null){Y=ot;return}if(tt=tt.sibling,tt!==null){Y=tt;return}Y=tt=j}while(tt!==null);T===0&&(T=5)}function Qk(j,tt,ot){var b=C,yt=pk.transition;try{pk.transition=null,C=1,Xk(j,tt,ot,b)}finally{pk.transition=yt,C=b}return null}function Xk(j,tt,ot,b){do Ik();while(xk!==null);if(K&6)throw Error(p(327));ot=j.finishedWork;var yt=j.finishedLanes;if(ot===null)return null;if(j.finishedWork=null,j.finishedLanes=0,ot===j.current)throw Error(p(177));j.callbackNode=null,j.callbackPriority=0;var Et=ot.lanes|ot.childLanes;if(Bc(j,Et),j===R&&(Y=R=null,Z=0),!(ot.subtreeFlags&2064)&&!(ot.flags&2064)||wk||(wk=!0,Gk(hc,function(){return Ik(),null})),Et=(ot.flags&15990)!==0,ot.subtreeFlags&15990||Et){Et=pk.transition,pk.transition=null;var kt=C;C=1;var Gt=K;K|=4,ok.current=null,Pj(j,ot),ek(ot,j),Oe(Df),dd=!!Cf,Df=Cf=null,j.current=ot,ik(ot),dc(),K=Gt,C=kt,pk.transition=Et}else j.current=ot;if(wk&&(wk=!1,xk=j,yk=yt),Et=j.pendingLanes,Et===0&&(Si=null),mc(ot.stateNode),Ek(j,B()),tt!==null)for(b=j.onRecoverableError,ot=0;ot<tt.length;ot++)yt=tt[ot],b(yt.value,{componentStack:yt.stack,digest:yt.digest});if(Pi)throw Pi=!1,j=Qi,Qi=null,j;return yk&1&&j.tag!==0&&Ik(),Et=j.pendingLanes,Et&1?j===Ak?zk++:(zk=0,Ak=j):zk=0,jg(),null}function Ik(){if(xk!==null){var j=Dc(yk),tt=pk.transition,ot=C;try{if(pk.transition=null,C=16>j?16:j,xk===null)var b=!1;else{if(j=xk,xk=null,yk=0,K&6)throw Error(p(331));var yt=K;for(K|=4,V=j.current;V!==null;){var Et=V,kt=Et.child;if(V.flags&16){var Gt=Et.deletions;if(Gt!==null){for(var Vt=0;Vt<Gt.length;Vt++){var an=Gt[Vt];for(V=an;V!==null;){var Pn=V;switch(Pn.tag){case 0:case 11:case 15:Qj(8,Pn,Et)}var gn=Pn.child;if(gn!==null)gn.return=Pn,V=gn;else for(;V!==null;){Pn=V;var dn=Pn.sibling,wn=Pn.return;if(Tj(Pn),Pn===an){V=null;break}if(dn!==null){dn.return=wn,V=dn;break}V=wn}}}var _n=Et.alternate;if(_n!==null){var $t=_n.child;if($t!==null){_n.child=null;do{var bn=$t.sibling;$t.sibling=null,$t=bn}while($t!==null)}}V=Et}}if(Et.subtreeFlags&2064&&kt!==null)kt.return=Et,V=kt;else e:for(;V!==null;){if(Et=V,Et.flags&2048)switch(Et.tag){case 0:case 11:case 15:Qj(9,Et,Et.return)}var Ut=Et.sibling;if(Ut!==null){Ut.return=Et.return,V=Ut;break e}V=Et.return}}var jt=j.current;for(V=jt;V!==null;){kt=V;var Yt=kt.child;if(kt.subtreeFlags&2064&&Yt!==null)Yt.return=kt,V=Yt;else e:for(kt=jt;V!==null;){if(Gt=V,Gt.flags&2048)try{switch(Gt.tag){case 0:case 11:case 15:Rj(9,Gt)}}catch(un){W(Gt,Gt.return,un)}if(Gt===kt){V=null;break e}var Bn=Gt.sibling;if(Bn!==null){Bn.return=Gt.return,V=Bn;break e}V=Gt.return}}if(K=yt,jg(),lc&&typeof lc.onPostCommitFiberRoot=="function")try{lc.onPostCommitFiberRoot(kc,j)}catch{}b=!0}return b}finally{C=ot,pk.transition=tt}}return!1}function Yk(j,tt,ot){tt=Ki(ot,tt),tt=Oi(j,tt,1),j=dh(j,tt,1),tt=L(),j!==null&&(Ac(j,1,tt),Ek(j,tt))}function W(j,tt,ot){if(j.tag===3)Yk(j,j,ot);else for(;tt!==null;){if(tt.tag===3){Yk(tt,j,ot);break}else if(tt.tag===1){var b=tt.stateNode;if(typeof tt.type.getDerivedStateFromError=="function"||typeof b.componentDidCatch=="function"&&(Si===null||!Si.has(b))){j=Ki(ot,j),j=Ri(tt,j,1),tt=dh(tt,j,1),j=L(),tt!==null&&(Ac(tt,1,j),Ek(tt,j));break}}tt=tt.return}}function Ui(j,tt,ot){var b=j.pingCache;b!==null&&b.delete(tt),tt=L(),j.pingedLanes|=j.suspendedLanes&ot,R===j&&(Z&ot)===ot&&(T===4||T===3&&(Z&130023424)===Z&&500>B()-gk?Lk(j,0):sk|=ot),Ek(j,tt)}function Zk(j,tt){tt===0&&(j.mode&1?(tt=sc,sc<<=1,!(sc&130023424)&&(sc=4194304)):tt=1);var ot=L();j=Zg(j,tt),j!==null&&(Ac(j,tt,ot),Ek(j,ot))}function vj(j){var tt=j.memoizedState,ot=0;tt!==null&&(ot=tt.retryLane),Zk(j,ot)}function ck(j,tt){var ot=0;switch(j.tag){case 13:var b=j.stateNode,yt=j.memoizedState;yt!==null&&(ot=yt.retryLane);break;case 19:b=j.stateNode;break;default:throw Error(p(314))}b!==null&&b.delete(tt),Zk(j,ot)}var Wk;Wk=function(j,tt,ot){if(j!==null)if(j.memoizedProps!==tt.pendingProps||Wf.current)Ug=!0;else{if(!(j.lanes&ot)&&!(tt.flags&128))return Ug=!1,zj(j,tt,ot);Ug=!!(j.flags&131072)}else Ug=!1,I&&tt.flags&1048576&&ug(tt,ng,tt.index);switch(tt.lanes=0,tt.tag){case 2:var b=tt.type;jj(j,tt),j=tt.pendingProps;var yt=Yf(tt,H.current);Tg(tt,ot),yt=Xh(null,tt,b,j,yt,ot);var Et=bi();return tt.flags|=1,typeof yt=="object"&&yt!==null&&typeof yt.render=="function"&&yt.$$typeof===void 0?(tt.tag=1,tt.memoizedState=null,tt.updateQueue=null,Zf(b)?(Et=!0,cg(tt)):Et=!1,tt.memoizedState=yt.state!==null&&yt.state!==void 0?yt.state:null,ah(tt),yt.updater=nh,tt.stateNode=yt,yt._reactInternals=tt,rh(tt,b,j,ot),tt=kj(null,tt,b,!0,Et,ot)):(tt.tag=0,I&&Et&&vg(tt),Yi(null,tt,yt,ot),tt=tt.child),tt;case 16:b=tt.elementType;e:{switch(jj(j,tt),j=tt.pendingProps,yt=b._init,b=yt(b._payload),tt.type=b,yt=tt.tag=$k(b),j=Lg(b,j),yt){case 0:tt=dj(null,tt,b,j,ot);break e;case 1:tt=ij(null,tt,b,j,ot);break e;case 11:tt=Zi(null,tt,b,j,ot);break e;case 14:tt=aj(null,tt,b,Lg(b.type,j),ot);break e}throw Error(p(306,b,""))}return tt;case 0:return b=tt.type,yt=tt.pendingProps,yt=tt.elementType===b?yt:Lg(b,yt),dj(j,tt,b,yt,ot);case 1:return b=tt.type,yt=tt.pendingProps,yt=tt.elementType===b?yt:Lg(b,yt),ij(j,tt,b,yt,ot);case 3:e:{if(lj(tt),j===null)throw Error(p(387));b=tt.pendingProps,Et=tt.memoizedState,yt=Et.element,bh(j,tt),gh(tt,b,null,ot);var kt=tt.memoizedState;if(b=kt.element,Et.isDehydrated)if(Et={element:b,isDehydrated:!1,cache:kt.cache,pendingSuspenseBoundaries:kt.pendingSuspenseBoundaries,transitions:kt.transitions},tt.updateQueue.baseState=Et,tt.memoizedState=Et,tt.flags&256){yt=Ki(Error(p(423)),tt),tt=mj(j,tt,b,ot,yt);break e}else if(b!==yt){yt=Ki(Error(p(424)),tt),tt=mj(j,tt,b,ot,yt);break e}else for(yg=Lf(tt.stateNode.containerInfo.firstChild),xg=tt,I=!0,zg=null,ot=Ch(tt,null,b,ot),tt.child=ot;ot;)ot.flags=ot.flags&-3|4096,ot=ot.sibling;else{if(Ig(),b===yt){tt=$i(j,tt,ot);break e}Yi(j,tt,b,ot)}tt=tt.child}return tt;case 5:return Kh(tt),j===null&&Eg(tt),b=tt.type,yt=tt.pendingProps,Et=j!==null?j.memoizedProps:null,kt=yt.children,Ef(b,yt)?kt=null:Et!==null&&Ef(b,Et)&&(tt.flags|=32),hj(j,tt),Yi(j,tt,kt,ot),tt.child;case 6:return j===null&&Eg(tt),null;case 13:return pj(j,tt,ot);case 4:return Ih(tt,tt.stateNode.containerInfo),b=tt.pendingProps,j===null?tt.child=Bh(tt,null,b,ot):Yi(j,tt,b,ot),tt.child;case 11:return b=tt.type,yt=tt.pendingProps,yt=tt.elementType===b?yt:Lg(b,yt),Zi(j,tt,b,yt,ot);case 7:return Yi(j,tt,tt.pendingProps,ot),tt.child;case 8:return Yi(j,tt,tt.pendingProps.children,ot),tt.child;case 12:return Yi(j,tt,tt.pendingProps.children,ot),tt.child;case 10:e:{if(b=tt.type._context,yt=tt.pendingProps,Et=tt.memoizedProps,kt=yt.value,G(Mg,b._currentValue),b._currentValue=kt,Et!==null)if(He(Et.value,kt)){if(Et.children===yt.children&&!Wf.current){tt=$i(j,tt,ot);break e}}else for(Et=tt.child,Et!==null&&(Et.return=tt);Et!==null;){var Gt=Et.dependencies;if(Gt!==null){kt=Et.child;for(var Vt=Gt.firstContext;Vt!==null;){if(Vt.context===b){if(Et.tag===1){Vt=ch(-1,ot&-ot),Vt.tag=2;var an=Et.updateQueue;if(an!==null){an=an.shared;var Pn=an.pending;Pn===null?Vt.next=Vt:(Vt.next=Pn.next,Pn.next=Vt),an.pending=Vt}}Et.lanes|=ot,Vt=Et.alternate,Vt!==null&&(Vt.lanes|=ot),Sg(Et.return,ot,tt),Gt.lanes|=ot;break}Vt=Vt.next}}else if(Et.tag===10)kt=Et.type===tt.type?null:Et.child;else if(Et.tag===18){if(kt=Et.return,kt===null)throw Error(p(341));kt.lanes|=ot,Gt=kt.alternate,Gt!==null&&(Gt.lanes|=ot),Sg(kt,ot,tt),kt=Et.sibling}else kt=Et.child;if(kt!==null)kt.return=Et;else for(kt=Et;kt!==null;){if(kt===tt){kt=null;break}if(Et=kt.sibling,Et!==null){Et.return=kt.return,kt=Et;break}kt=kt.return}Et=kt}Yi(j,tt,yt.children,ot),tt=tt.child}return tt;case 9:return yt=tt.type,b=tt.pendingProps.children,Tg(tt,ot),yt=Vg(yt),b=b(yt),tt.flags|=1,Yi(j,tt,b,ot),tt.child;case 14:return b=tt.type,yt=Lg(b,tt.pendingProps),yt=Lg(b.type,yt),aj(j,tt,b,yt,ot);case 15:return cj(j,tt,tt.type,tt.pendingProps,ot);case 17:return b=tt.type,yt=tt.pendingProps,yt=tt.elementType===b?yt:Lg(b,yt),jj(j,tt),tt.tag=1,Zf(b)?(j=!0,cg(tt)):j=!1,Tg(tt,ot),ph(tt,b,yt),rh(tt,b,yt,ot),kj(null,tt,b,!0,j,ot);case 19:return yj(j,tt,ot);case 22:return ej(j,tt,ot)}throw Error(p(156,tt.tag))};function Gk(j,tt){return ac(j,tt)}function al(j,tt,ot,b){this.tag=j,this.key=ot,this.sibling=this.child=this.return=this.stateNode=this.type=this.elementType=null,this.index=0,this.ref=null,this.pendingProps=tt,this.dependencies=this.memoizedState=this.updateQueue=this.memoizedProps=null,this.mode=b,this.subtreeFlags=this.flags=0,this.deletions=null,this.childLanes=this.lanes=0,this.alternate=null}function Bg(j,tt,ot,b){return new al(j,tt,ot,b)}function bj(j){return j=j.prototype,!(!j||!j.isReactComponent)}function $k(j){if(typeof j=="function")return bj(j)?1:0;if(j!=null){if(j=j.$$typeof,j===Da)return 11;if(j===Ga)return 14}return 2}function wh(j,tt){var ot=j.alternate;return ot===null?(ot=Bg(j.tag,tt,j.key,j.mode),ot.elementType=j.elementType,ot.type=j.type,ot.stateNode=j.stateNode,ot.alternate=j,j.alternate=ot):(ot.pendingProps=tt,ot.type=j.type,ot.flags=0,ot.subtreeFlags=0,ot.deletions=null),ot.flags=j.flags&14680064,ot.childLanes=j.childLanes,ot.lanes=j.lanes,ot.child=j.child,ot.memoizedProps=j.memoizedProps,ot.memoizedState=j.memoizedState,ot.updateQueue=j.updateQueue,tt=j.dependencies,ot.dependencies=tt===null?null:{lanes:tt.lanes,firstContext:tt.firstContext},ot.sibling=j.sibling,ot.index=j.index,ot.ref=j.ref,ot}function yh(j,tt,ot,b,yt,Et){var kt=2;if(b=j,typeof j=="function")bj(j)&&(kt=1);else if(typeof j=="string")kt=5;else e:switch(j){case ya:return Ah(ot.children,yt,Et,tt);case za:kt=8,yt|=8;break;case Aa:return j=Bg(12,ot,tt,yt|2),j.elementType=Aa,j.lanes=Et,j;case Ea:return j=Bg(13,ot,tt,yt),j.elementType=Ea,j.lanes=Et,j;case Fa:return j=Bg(19,ot,tt,yt),j.elementType=Fa,j.lanes=Et,j;case Ia:return qj(ot,yt,Et,tt);default:if(typeof j=="object"&&j!==null)switch(j.$$typeof){case Ba:kt=10;break e;case Ca:kt=9;break e;case Da:kt=11;break e;case Ga:kt=14;break e;case Ha:kt=16,b=null;break e}throw Error(p(130,j==null?j:typeof j,""))}return tt=Bg(kt,ot,tt,yt),tt.elementType=j,tt.type=b,tt.lanes=Et,tt}function Ah(j,tt,ot,b){return j=Bg(7,j,b,tt),j.lanes=ot,j}function qj(j,tt,ot,b){return j=Bg(22,j,b,tt),j.elementType=Ia,j.lanes=ot,j.stateNode={isHidden:!1},j}function xh(j,tt,ot){return j=Bg(6,j,null,tt),j.lanes=ot,j}function zh(j,tt,ot){return tt=Bg(4,j.children!==null?j.children:[],j.key,tt),tt.lanes=ot,tt.stateNode={containerInfo:j.containerInfo,pendingChildren:null,implementation:j.implementation},tt}function bl(j,tt,ot,b,yt){this.tag=tt,this.containerInfo=j,this.finishedWork=this.pingCache=this.current=this.pendingChildren=null,this.timeoutHandle=-1,this.callbackNode=this.pendingContext=this.context=null,this.callbackPriority=0,this.eventTimes=zc(0),this.expirationTimes=zc(-1),this.entangledLanes=this.finishedLanes=this.mutableReadLanes=this.expiredLanes=this.pingedLanes=this.suspendedLanes=this.pendingLanes=0,this.entanglements=zc(0),this.identifierPrefix=b,this.onRecoverableError=yt,this.mutableSourceEagerHydrationData=null}function cl(j,tt,ot,b,yt,Et,kt,Gt,Vt){return j=new bl(j,tt,ot,Gt,Vt),tt===1?(tt=1,Et===!0&&(tt|=8)):tt=0,Et=Bg(3,null,null,tt),j.current=Et,Et.stateNode=j,Et.memoizedState={element:b,isDehydrated:ot,cache:null,transitions:null,pendingSuspenseBoundaries:null},ah(Et),j}function dl(j,tt,ot){var b=3<arguments.length&&arguments[3]!==void 0?arguments[3]:null;return{$$typeof:wa,key:b==null?null:""+b,children:j,containerInfo:tt,implementation:ot}}function el(j){if(!j)return Vf;j=j._reactInternals;e:{if(Vb(j)!==j||j.tag!==1)throw Error(p(170));var tt=j;do{switch(tt.tag){case 3:tt=tt.stateNode.context;break e;case 1:if(Zf(tt.type)){tt=tt.stateNode.__reactInternalMemoizedMergedChildContext;break e}}tt=tt.return}while(tt!==null);throw Error(p(171))}if(j.tag===1){var ot=j.type;if(Zf(ot))return bg(j,ot,tt)}return tt}function fl(j,tt,ot,b,yt,Et,kt,Gt,Vt){return j=cl(ot,b,!0,j,yt,Et,kt,Gt,Vt),j.context=el(null),ot=j.current,b=L(),yt=lh(ot),Et=ch(b,yt),Et.callback=tt??null,dh(ot,Et,yt),j.current.lanes=yt,Ac(j,yt,b),Ek(j,b),j}function gl(j,tt,ot,b){var yt=tt.current,Et=L(),kt=lh(yt);return ot=el(ot),tt.context===null?tt.context=ot:tt.pendingContext=ot,tt=ch(Et,kt),tt.payload={element:j},b=b===void 0?null:b,b!==null&&(tt.callback=b),j=dh(yt,tt,kt),j!==null&&(mh(j,yt,kt,Et),eh(j,yt,kt)),kt}function hl(j){if(j=j.current,!j.child)return null;switch(j.child.tag){case 5:return j.child.stateNode;default:return j.child.stateNode}}function il(j,tt){if(j=j.memoizedState,j!==null&&j.dehydrated!==null){var ot=j.retryLane;j.retryLane=ot!==0&&ot<tt?ot:tt}}function jl(j,tt){il(j,tt),(j=j.alternate)&&il(j,tt)}function kl(){return null}var ll=typeof reportError=="function"?reportError:function(j){console.error(j)};function ml(j){this._internalRoot=j}nl.prototype.render=ml.prototype.render=function(j){var tt=this._internalRoot;if(tt===null)throw Error(p(409));gl(j,tt,null,null)};nl.prototype.unmount=ml.prototype.unmount=function(){var j=this._internalRoot;if(j!==null){this._internalRoot=null;var tt=j.containerInfo;Sk(function(){gl(null,j,null,null)}),tt[uf]=null}};function nl(j){this._internalRoot=j}nl.prototype.unstable_scheduleHydration=function(j){if(j){var tt=Hc();j={blockedOn:null,target:j,priority:tt};for(var ot=0;ot<Qc.length&&tt!==0&&tt<Qc[ot].priority;ot++);Qc.splice(ot,0,j),ot===0&&Vc(j)}};function ol(j){return!(!j||j.nodeType!==1&&j.nodeType!==9&&j.nodeType!==11)}function pl(j){return!(!j||j.nodeType!==1&&j.nodeType!==9&&j.nodeType!==11&&(j.nodeType!==8||j.nodeValue!==" react-mount-point-unstable "))}function ql(){}function rl(j,tt,ot,b,yt){if(yt){if(typeof b=="function"){var Et=b;b=function(){var an=hl(kt);Et.call(an)}}var kt=fl(tt,b,j,0,null,!1,!1,"",ql);return j._reactRootContainer=kt,j[uf]=kt.current,sf(j.nodeType===8?j.parentNode:j),Sk(),kt}for(;yt=j.lastChild;)j.removeChild(yt);if(typeof b=="function"){var Gt=b;b=function(){var an=hl(Vt);Gt.call(an)}}var Vt=cl(j,0,!1,null,null,!1,!1,"",ql);return j._reactRootContainer=Vt,j[uf]=Vt.current,sf(j.nodeType===8?j.parentNode:j),Sk(function(){gl(tt,Vt,ot,b)}),Vt}function sl(j,tt,ot,b,yt){var Et=ot._reactRootContainer;if(Et){var kt=Et;if(typeof yt=="function"){var Gt=yt;yt=function(){var Vt=hl(kt);Gt.call(Vt)}}gl(tt,kt,j,yt)}else kt=rl(ot,tt,j,yt,b);return hl(kt)}Ec=function(j){switch(j.tag){case 3:var tt=j.stateNode;if(tt.current.memoizedState.isDehydrated){var ot=tc(tt.pendingLanes);ot!==0&&(Cc(tt,ot|1),Ek(tt,B()),!(K&6)&&(Hj=B()+500,jg()))}break;case 13:Sk(function(){var b=Zg(j,1);if(b!==null){var yt=L();mh(b,j,1,yt)}}),jl(j,1)}};Fc=function(j){if(j.tag===13){var tt=Zg(j,134217728);if(tt!==null){var ot=L();mh(tt,j,134217728,ot)}jl(j,134217728)}};Gc=function(j){if(j.tag===13){var tt=lh(j),ot=Zg(j,tt);if(ot!==null){var b=L();mh(ot,j,tt,b)}jl(j,tt)}};Hc=function(){return C};Ic=function(j,tt){var ot=C;try{return C=j,tt()}finally{C=ot}};yb=function(j,tt,ot){switch(tt){case"input":if(bb(j,ot),tt=ot.name,ot.type==="radio"&&tt!=null){for(ot=j;ot.parentNode;)ot=ot.parentNode;for(ot=ot.querySelectorAll("input[name="+JSON.stringify(""+tt)+'][type="radio"]'),tt=0;tt<ot.length;tt++){var b=ot[tt];if(b!==j&&b.form===j.form){var yt=Db(b);if(!yt)throw Error(p(90));Wa(b),bb(b,yt)}}}break;case"textarea":ib(j,ot);break;case"select":tt=ot.value,tt!=null&&fb(j,!!ot.multiple,tt,!1)}};Gb=Rk;Hb=Sk;var tl={usingClientEntryPoint:!1,Events:[Cb,ue,Db,Eb,Fb,Rk]},ul={findFiberByHostInstance:Wc,bundleType:0,version:"18.2.0",rendererPackageName:"react-dom"},vl={bundleType:ul.bundleType,version:ul.version,rendererPackageName:ul.rendererPackageName,rendererConfig:ul.rendererConfig,overrideHookState:null,overrideHookStateDeletePath:null,overrideHookStateRenamePath:null,overrideProps:null,overridePropsDeletePath:null,overridePropsRenamePath:null,setErrorHandler:null,setSuspenseHandler:null,scheduleUpdate:null,currentDispatcherRef:ua.ReactCurrentDispatcher,findHostInstanceByFiber:function(j){return j=Zb(j),j===null?null:j.stateNode},findFiberByHostInstance:ul.findFiberByHostInstance||kl,findHostInstancesForRefresh:null,scheduleRefresh:null,scheduleRoot:null,setRefreshHandler:null,getCurrentFiber:null,reconcilerVersion:"18.2.0-next-9e3b772b8-20220608"};if(typeof __REACT_DEVTOOLS_GLOBAL_HOOK__<"u"){var wl=__REACT_DEVTOOLS_GLOBAL_HOOK__;if(!wl.isDisabled&&wl.supportsFiber)try{kc=wl.inject(vl),lc=wl}catch{}}reactDom_production_min.__SECRET_INTERNALS_DO_NOT_USE_OR_YOU_WILL_BE_FIRED=tl;reactDom_production_min.createPortal=function(j,tt){var ot=2<arguments.length&&arguments[2]!==void 0?arguments[2]:null;if(!ol(tt))throw Error(p(200));return dl(j,tt,null,ot)};reactDom_production_min.createRoot=function(j,tt){if(!ol(j))throw Error(p(299));var ot=!1,b="",yt=ll;return tt!=null&&(tt.unstable_strictMode===!0&&(ot=!0),tt.identifierPrefix!==void 0&&(b=tt.identifierPrefix),tt.onRecoverableError!==void 0&&(yt=tt.onRecoverableError)),tt=cl(j,1,!1,null,null,ot,!1,b,yt),j[uf]=tt.current,sf(j.nodeType===8?j.parentNode:j),new ml(tt)};reactDom_production_min.findDOMNode=function(j){if(j==null)return null;if(j.nodeType===1)return j;var tt=j._reactInternals;if(tt===void 0)throw typeof j.render=="function"?Error(p(188)):(j=Object.keys(j).join(","),Error(p(268,j)));return j=Zb(tt),j=j===null?null:j.stateNode,j};reactDom_production_min.flushSync=function(j){return Sk(j)};reactDom_production_min.hydrate=function(j,tt,ot){if(!pl(tt))throw Error(p(200));return sl(null,j,tt,!0,ot)};reactDom_production_min.hydrateRoot=function(j,tt,ot){if(!ol(j))throw Error(p(405));var b=ot!=null&&ot.hydratedSources||null,yt=!1,Et="",kt=ll;if(ot!=null&&(ot.unstable_strictMode===!0&&(yt=!0),ot.identifierPrefix!==void 0&&(Et=ot.identifierPrefix),ot.onRecoverableError!==void 0&&(kt=ot.onRecoverableError)),tt=fl(tt,null,j,1,ot??null,yt,!1,Et,kt),j[uf]=tt.current,sf(j),b)for(j=0;j<b.length;j++)ot=b[j],yt=ot._getVersion,yt=yt(ot._source),tt.mutableSourceEagerHydrationData==null?tt.mutableSourceEagerHydrationData=[ot,yt]:tt.mutableSourceEagerHydrationData.push(ot,yt);return new nl(tt)};reactDom_production_min.render=function(j,tt,ot){if(!pl(tt))throw Error(p(200));return sl(null,j,tt,!1,ot)};reactDom_production_min.unmountComponentAtNode=function(j){if(!pl(j))throw Error(p(40));return j._reactRootContainer?(Sk(function(){sl(null,null,j,!1,function(){j._reactRootContainer=null,j[uf]=null})}),!0):!1};reactDom_production_min.unstable_batchedUpdates=Rk;reactDom_production_min.unstable_renderSubtreeIntoContainer=function(j,tt,ot,b){if(!pl(ot))throw Error(p(200));if(j==null||j._reactInternals===void 0)throw Error(p(38));return sl(j,tt,ot,!1,b)};reactDom_production_min.version="18.2.0-next-9e3b772b8-20220608";(function(j){function tt(){if(!(typeof __REACT_DEVTOOLS_GLOBAL_HOOK__>"u"||typeof __REACT_DEVTOOLS_GLOBAL_HOOK__.checkDCE!="function"))try{__REACT_DEVTOOLS_GLOBAL_HOOK__.checkDCE(tt)}catch(ot){console.error(ot)}}tt(),j.exports=reactDom_production_min})(reactDom);var createRoot,m=reactDomExports;createRoot=m.createRoot,m.hydrateRoot;const App$1="";/*! For license information please see bundle.m.js.LICENSE.txt */var __webpackgi_modules__={44:function(j,tt,ot){var b=ot(352),yt=ot.n(b)()(function(Et){return Et[1]});yt.push([j.id,"#assetManagerLoadingBar{z-index:400;position:absolute;top:0;left:0;right:0;width:100%;background-color:transparent;height:auto}#assetManagerLoadingBarContent{color:#fff;position:absolute;left:0;right:0;margin:auto;transition:width .5s;background-color:#222222aa;text-align:center;font-size:.5rem;line-height:.6rem;height:.6rem;border-radius:0 0 .125rem .125rem;border-bottom:#999 1px solid}.processState{font-weight:bold}",""]),tt.Z=yt},798:function(j,tt,ot){var b=ot(352),yt=ot.n(b)()(function(Et){return Et[1]});yt.push([j.id,"#assetManagerPopup{z-index:300;position:absolute;bottom:2rem;right:2rem;-webkit-backdrop-filter:blur(16px);backdrop-filter:blur(16px);color:#fff;background-blend-mode:luminosity;background-color:#28223CAA;padding:1.5rem;font-size:1rem;width:-webkit-max-content;width:-moz-max-content;width:max-content;max-width:80vw;max-height:80vh;overflow-y:scroll;border-radius:.5rem;height:-webkit-max-content;height:-moz-max-content;height:max-content}#assetManagerPopupClose{position:absolute;top:0;right:0;padding:.5rem;cursor:pointer}#assetManagerPopupContent{padding-top:.5rem}.processState{font-weight:bold}",""]),tt.Z=yt},898:function(j,tt,ot){var b=ot(352),yt=ot.n(b)()(function(Et){return Et[1]});yt.push([j.id,':root{--tp-blade-unit-size: 24px;--tp-element-border-radius: 0.25rem;--tp-base-background-color: #28223C;--tp-base-shadow-color: hsla(0, 0%, 0%, 0.2);--tp-button-background-color: hsla(230, 10%, 80%, 1.00);--tp-button-background-color-active: hsla(230, 10%, 95%, 1.00);--tp-button-background-color-focus: hsla(230, 10%, 90%, 1.00);--tp-button-background-color-hover: hsla(230, 10%, 85%, 1.00);--tp-button-foreground-color: hsla(230, 20%, 11%, 1.00);--tp-container-background-color: hsla(230, 25%, 16%, 0.65);--tp-container-background-color-active: hsla(230, 25%, 31%, 0.65);--tp-container-background-color-focus: hsla(230, 25%, 26%, 0.65);--tp-container-background-color-hover: hsla(230, 25%, 21%, 0.65);--tp-container-foreground-color: hsl(240, 10%, 92%);--tp-groove-foreground-color: hsla(230, 20%, 8%, 1.00);--tp-input-background-color: hsla(230, 20%, 8%, 1.00);--tp-input-background-color-active: hsla(230, 28%, 23%, 1.00);--tp-input-background-color-focus: hsla(230, 28%, 18%, 1.00);--tp-input-background-color-hover: hsla(230, 20%, 13%, 1.00);--tp-input-foreground-color: hsla(230, 10%, 80%, 1.00);--tp-monitor-background-color: hsla(230, 20%, 8%, 1.00);--tp-monitor-foreground-color: hsla(230, 12%, 48%, 1.00);--tp-label-foreground-color: #E4E2ED;--tp-font-family: "Inter"}.tp-fldv{margin-top:.25rem;margin-bottom:.25rem;background-blend-mode:luminosity;position:relative}.tp-fldv .tp-fldv{margin-top:.5rem;margin-bottom:.5rem}.tp-fldv .tp-brkv{background-color:rgba(32,32,50,.85)}.tp-fldv .tp-fldv .tp-brkv{background-color:rgba(32,32,50,.25) !important}.tp-fldv-expanded>.tp-fldv_b{background-color:rgba(32,32,50,.8) !important}.tp-fldv_b{height:calc(var(--bld-us)*1.5 + 4px) !important;font-size:.85rem !important}.tp-fldv_b+.tp-brkv .tp-fldv_b{height:calc(var(--bld-us)*1.1 + 4px) !important;font-size:.65rem !important}.tp-lblv_l{font-size:.7rem !important;font-weight:400 !important;flex-grow:1 !important;flex-basis:20% !important}.tp-lblv_v{flex-grow:1 !important;flex-basis:50% !important}.tp-txtv_i{font-size:.7rem !important;font-weight:400 !important}.tp-fldv_t{font-weight:400 !important;padding-left:1.5rem !important}.tp-fldv_m{right:auto !important;left:.75rem;opacity:1 !important}.pluginOptionsButton{position:absolute;right:0;top:.75rem;padding-left:.5rem;padding-right:.5rem;height:-webkit-min-content;height:-moz-min-content;height:min-content;background:transparent;color:#eee;border:none}',""]),tt.Z=yt},513:function(j,tt,ot){var b=ot(352),yt=ot.n(b)()(function(Et){return Et[1]});yt.push([j.id,".wwise-perspective{perspective:1000px;position:fixed;left:0;top:0;width:100vw;height:100vh}.wwise-wrapper{position:fixed;width:0;height:0;font-weight:400}.wwise-wrapper.v-center{top:50%}.wwise-wrapper.h-center{left:50%}.wwise-wrapper.left{left:0}.wwise-wrapper.right{right:0}.wwise-wrapper.top{top:0}.wwise-wrapper.bottom{bottom:0}.wwise *.preset{color:#fafafa}.wwise *.preset.ok{background:rgba(45,193,80,.95)}.wwise *.preset.error{background:rgba(190,17,51,.95)}.wwise *.preset.info{background:rgba(40,34,60,.95)}.wwise *.preset.caution{background:rgba(239,128,0,.95)}.wwise-no-scroll{position:relative;overflow:hidden}.wwise-overlay{position:fixed;left:0;top:0;width:100vw;height:100vh;background:rgba(50,50,50,.5)}.wwise{position:absolute;left:0;top:0;display:flex;flex-direction:column;border-radius:5px;box-shadow:1px 1px 10px rgba(150,150,150,.5);box-sizing:border-box}.wwise.no-radius{border-radius:0}.wwise *{box-sizing:border-box}.wwise .clear{clear:both}.wwise>.content{padding:0;margin:0;flex-grow:1;border-radius:0 0 4px 4px;background:#fff;color:#333;box-shadow:0 1px 3px rgba(200,200,200,.5) inset}.wwise>.content.no-topbar{border-radius:4px;box-shadow:none}.wwise.no-radius>.content,.wwise.no-radius>.content.no-topbar{border-radius:0}.wwise .modal>.main{width:90vw;max-width:400px;border-radius:4px 4px 0 0;text-align:center;padding-bottom:10px;color:#fff}.wwise .modal>.main .icon{display:block;margin:0 auto;fill:#fff;width:100px}.wwise .modal>.main .title{font-size:30px}.wwise .modal>.main .text{margin:10px 0;font-weight:300;font-size:16px}.wwise .modal>.main.no-op{border-radius:4px}.wwise .modal>.main.ok{background:#2dc150}.wwise .modal>.main.error{background:#be1133}.wwise .modal>.main.info{background:#28223c}.wwise .modal>.main.caution{background:#ef8000}.wwise .modal>.operation .button-wrapper{text-align:center;margin:30px 0 20px 0}.wwise .modal>.operation .button{display:inline-block;line-height:18px;padding:8px 10px;margin:0 15px;line-height:18px;width:100px;border-radius:4px;border:1px solid #eee;box-shadow:1px 1px 3px rgba(220,220,220,.8);color:#555;transition:all ease .2s}.wwise .modal>.operation .button:hover{background:#f5f5f5;cursor:pointer}.wwise .modal>.operation .button.main{color:#fff}.wwise .modal>.operation.ok .main{background:#2dc150}.wwise .modal>.operation.ok .main:hover{background:#23983f}.wwise .modal>.operation.error .main{background:#be1133}.wwise .modal>.operation.error .main:hover{background:#8f0d26}.wwise .modal>.operation.info .main{background:#28223c}.wwise .modal>.operation.info .main:hover{background:#12101b}.wwise .modal>.operation.caution .main{background:#ef8000}.wwise .modal>.operation.caution .main:hover{background:#bc6500}.wwise .input-wrapper{margin:15px auto -15px auto}.wwise .input-wrapper .input{display:block;margin:0 auto;width:95%;max-width:300px;outline:none;border:none;background:#f3f3f3;padding:15px;font-size:16px;border-radius:5px}.wwise .input-wrapper .error{width:95%;text-align:center;margin-top:10px;color:red}div:has(>.wwise-wrapper){position:absolute !important}.wwise-wrapper{position:absolute !important}.wwise .modal>.main{padding-top:10px}",""]),tt.Z=yt},476:function(j){var tt;tt=function(){return function(ot){var b={};function yt(Et){if(b[Et])return b[Et].exports;var kt=b[Et]={i:Et,l:!1,exports:{}};return ot[Et].call(kt.exports,kt,kt.exports,yt),kt.l=!0,kt.exports}return yt.m=ot,yt.c=b,yt.i=function(Et){return Et},yt.d=function(Et,kt,Gt){yt.o(Et,kt)||Object.defineProperty(Et,kt,{configurable:!1,enumerable:!0,get:Gt})},yt.n=function(Et){var kt=Et&&Et.__esModule?function(){return Et.default}:function(){return Et};return yt.d(kt,"a",kt),kt},yt.o=function(Et,kt){return Object.prototype.hasOwnProperty.call(Et,kt)},yt.p="",yt(yt.s=5)}([function(ot,b,yt){Object.defineProperty(b,"__esModule",{value:!0});var Et={convertToObject:function(kt){var Gt=kt.substring(kt.indexOf("{")+1).trim().slice(0,-1),Vt={};return Gt.split(";").map(function(an){if(an=an.trim()){var Pn=an.split(":");Vt[Pn[0].trim()]=Pn[1].trim()}}),Vt},getFromSheets:function(kt){var Gt=document.styleSheets;for(var Vt in Gt){var an=null;try{an=Gt[Vt].rules||Gt[Vt].cssRules}catch{}if(an){for(var Pn in an)if(an[Pn].selectorText&&an[Pn].selectorText.split(",").indexOf(kt)!=-1)return an[Pn].cssText?Et.convertToObject(an[Pn].cssText):Et.convertToObject(an[Pn].style.cssText)}}return{}},getPropertyDefault:function(kt){return kt=="timing-function"?"ease":kt=="iteration-count"?1:kt=="direction"?"normal":kt=="fill-mode"?"none":null}};b.default=Et},function(ot,b,yt){Object.defineProperty(b,"__esModule",{value:!0});var Et={generateId:function(){for(var kt="",Gt="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789",Vt=0;Vt<8;++Vt)kt+=Gt.charAt(Math.floor(Math.random()*Gt.length));return kt},frameToString:function(kt){var Gt="";for(var Vt in kt)Gt+=Vt+":"+kt[Vt]+";";return Gt},convertTimeToMs:function(kt){if(!kt)return 0;if(typeof kt=="number")return kt;var Gt=parseFloat(kt);return kt.indexOf("ms")!=-1?Gt:1e3*Gt},prefixes:["","-webkit-","-moz-","-o-"]};b.default=Et},function(ot,b,yt){Object.defineProperty(b,"__esModule",{value:!0});var Et,kt=(Et=yt(0))&&Et.__esModule?Et:{default:Et};b.default=function Gt(Vt,an){if(function(dn,wn){if(!(dn instanceof wn))throw new TypeError("Cannot call a class as a function")}(this,Gt),this.styles=typeof Vt=="string"?kt.default.getFromSheets(Vt):Vt,typeof an=="string"){var Pn=kt.default.getFromSheets(an);for(var gn in this.options={},Pn)this.options[gn.replace("animation-","")]=Pn[gn]}else this.options=typeof an=="number"?{duration:an}:an}},function(ot,b,yt){Object.defineProperty(b,"__esModule",{value:!0});var Et=function(){function gn(dn,wn){for(var _n=0;_n<wn.length;_n++){var $t=wn[_n];$t.enumerable=$t.enumerable||!1,$t.configurable=!0,"value"in $t&&($t.writable=!0),Object.defineProperty(dn,$t.key,$t)}}return function(dn,wn,_n){return wn&&gn(dn.prototype,wn),_n&&gn(dn,_n),dn}}(),kt=an(yt(4)),Gt=an(yt(1)),Vt=an(yt(0));function an(gn){return gn&&gn.__esModule?gn:{default:gn}}var Pn=function(){function gn(dn,wn,_n,$t){if(function(jt,Yt){if(!(jt instanceof Yt))throw new TypeError("Cannot call a class as a function")}(this,gn),dn.constructor===Array?this.doms=dn:this.doms=[dn],wn.constructor===Array?this.frames=wn:this.frames=[wn],this.options={startFrom:0,pauseAt:[],prefix:!1,count:1,clear:!0,applyOnEnd:!1,instant:!1},_n!=null&&_n!=null)if(typeof _n=="boolean")this.options.instant=_n;else if(typeof _n=="number")this.options.count=_n,typeof $t=="boolean"&&(this.options.instant=$t);else for(var bn in _n)bn=="pauseAt"&&_n.pauseAt.constructor!==Array?this.options[bn]=[_n[bn]]:this.options[bn]=_n[bn];for(var Ut in this.promiseSupported=typeof Promise<"u"&&Promise.toString().indexOf("[native code]")!==-1,this.countRemainder=[],this.animations=[],this.styleDoms=[],this.superSets=[],this.eventHandler=[],this.options.prefix?this.prefixes=Gt.default.prefixes:this.prefixes=[""],dn)this.countRemainder[Ut]=this.options.count-1;this.options.instant&&this.play()}return Et(gn,[{key:"play",value:function(){var dn=this;for(var wn in this.clear(),this.promiseSupported&&(this.promise=new Promise(function($t){dn.promiseResolve=$t})),this.doms){var _n=this.makeAnimation(this.doms[wn]);this.animations[wn]=_n.names,this.styleDoms[wn]=_n.styleDom,this.superSets[wn]=this.makeSuperSet(this.doms[wn],this.animations[wn]),this.playAnimation(this.doms[wn],this.superSets[wn]),this.eventHandler[wn]=this.handleAnimationEnd.bind(this,wn),this.doms[wn].addEventListener("animationend",this.eventHandler[wn])}if(this.promiseSupported)return this.promise}},{key:"clear",value:function(dn){if(!dn){for(var wn in this.doms)this.clear(wn);return this.animationEnded=0,this.promise=void 0,void(this.promiseResolve=void 0)}var _n=this.styleDoms[dn];for(var $t in _n&&_n.parentNode&&_n.parentNode.removeChild(_n),this.superSets[dn])for(var bn in this.prefixes)this.doms[dn].style[this.prefixes[bn]+"animation-"+$t]=null;for(var Ut in this.prefixes)this.doms[dn].style[this.prefixes[Ut]+"animation-play-state"]=null;this.doms[dn].removeEventListener("animationend",this.eventHandler[dn]),this.countRemainder[dn]=this.options.count-1}},{key:"replay",value:function(dn){var wn=this.doms[dn],_n=wn.cloneNode(!0);wn.parentNode.replaceChild(_n,wn),this.doms[dn].removeEventListener("animationend",this.eventHandler[dn]),this.doms[dn]=_n,this.doms[dn].addEventListener("animationend",this.eventHandler[dn])}},{key:"pause",value:function(){for(var dn in this.doms)this.pauseDom(this.doms[dn])}},{key:"resume",value:function(){for(var dn in this.doms)this.resumeDom(this.doms[dn])}},{key:"getPromise",value:function(){return this.promise}},{key:"handleAnimationEnd",value:function(dn,wn){var _n=wn.animationName,$t=_n.substring(_n.lastIndexOf("-")+1);this.options.pauseAt.includes(parseInt($t))&&this.pauseDom(this.doms[dn]),$t==this.frames.length&&(this.countRemainder[dn]==-1?this.replay(dn):this.countRemainder[dn]>0?(this.countRemainder[dn]--,this.replay(dn)):(this.options.applyOnEnd&&this.applyOnEnd(dn),this.animationEnded++,this.animationEnded==this.doms.length&&(this.promiseSupported&&this.promiseResolve(),this.options.clear&&this.clear())))}},{key:"pauseDom",value:function(dn){for(var wn in this.prefixes)dn.style[this.prefixes[wn]+"animation-play-state"]="paused"}},{key:"resumeDom",value:function(dn){for(var wn in this.prefixes)dn.style[this.prefixes[wn]+"animation-play-state"]="running"}},{key:"applyOnEnd",value:function(dn){var wn=this.newFrames[this.frames.length];for(var _n in wn)this.doms[dn].style[_n]=wn[_n]}},{key:"makeAnimation",value:function(dn){var wn={},_n=[],$t={};for(var bn in this.frames)for(var Ut in _n.push(this.frames[bn].styles),_n[bn])$t[Ut]=!0;var jt=window.getComputedStyle(dn);for(var Yt in $t)wn[Yt]=jt[Yt];_n.unshift(wn);for(var Bn=[_n[0]],un=1;un<_n.length;++un){var Cn=JSON.parse(JSON.stringify(Bn[un-1]));for(var Qt in _n[un])Cn[Qt]=_n[un][Qt];Bn.push(Cn)}return this.newFrames=Bn,kt.default.make(Bn,this.prefixes)}},{key:"makeSuperSet",value:function(dn,wn){var _n=0,$t={};for(var bn in this.frames)for(var Ut in this.frames[bn].options)$t[Ut]="";$t.name="",$t.duration="",$t.delay="";for(var jt=0;jt<this.frames.length;++jt){if(jt)for(var Yt in $t)$t[Yt]+=",";var Bn=Gt.default.convertTimeToMs(this.frames[jt].options.duration),un=Gt.default.convertTimeToMs(this.frames[jt].options.delay);for(var Cn in jt<this.options.startFrom&&(Bn=0,un=0),$t.name+=wn[jt],$t.duration+=Bn+"ms",$t.delay+=_n+un+"ms",$t)Cn!="name"&&Cn!="duration"&&Cn!="delay"&&($t[Cn]+=this.frames[jt].options[Cn]?this.frames[jt].options[Cn]:Vt.default.getPropertyDefault(Cn));var Qt=this.frames[jt].options["iteration-count"];_n+=Bn*parseInt(Qt||1)+un}return $t}},{key:"playAnimation",value:function(dn,wn){for(var _n in wn)for(var $t in this.prefixes)dn.style[this.prefixes[$t]+"animation-"+_n]=wn[_n];this.options.pauseAt.includes(0)&&this.pauseDom(dn)}}]),gn}();b.default=Pn},function(ot,b,yt){Object.defineProperty(b,"__esModule",{value:!0});var Et,kt=(Et=yt(1))&&Et.__esModule?Et:{default:Et},Gt={make:function(Vt,an){for(var Pn=[],gn="",dn="atr-"+kt.default.generateId(),wn=document.createElement("style"),_n=0;_n<Vt.length-1;++_n)Pn.push(dn+"-"+(_n+1)),gn+=Gt.makeFromTwoFrames(Vt[_n],Vt[_n+1],Pn[_n],an);return wn.innerHTML=gn,wn.class="foo",document.getElementsByTagName("head")[0].appendChild(wn),{names:Pn,styleDom:wn}},makeFromTwoFrames:function(Vt,an,Pn,gn){var dn="";for(var wn in gn)dn+="@"+gn[wn]+"keyframes "+Pn+" {",dn+="0%",dn+="{"+kt.default.frameToString(Vt)+"}",dn+="100%",dn+="{"+kt.default.frameToString(an)+"}",dn+="}";return dn}};b.default=Gt},function(ot,b,yt){Object.defineProperty(b,"__esModule",{value:!0}),b.Queue=b.Frame=void 0;var Et=Gt(yt(2)),kt=Gt(yt(3));function Gt(Vt){return Vt&&Vt.__esModule?Vt:{default:Vt}}b.Frame=Et.default,b.Queue=kt.default}])},j.exports=tt()},352:function(j){j.exports=function(tt){var ot=[];return ot.toString=function(){return this.map(function(b){var yt=tt(b);return b[2]?"@media ".concat(b[2]," {").concat(yt,"}"):yt}).join("")},ot.i=function(b,yt,Et){typeof b=="string"&&(b=[[null,b,""]]);var kt={};if(Et)for(var Gt=0;Gt<this.length;Gt++){var Vt=this[Gt][0];Vt!=null&&(kt[Vt]=!0)}for(var an=0;an<b.length;an++){var Pn=[].concat(b[an]);Et&&kt[Pn[0]]||(yt&&(Pn[2]?Pn[2]="".concat(yt," and ").concat(Pn[2]):Pn[2]=yt),ot.push(Pn))}},ot}},388:function(j){j.exports=function tt(ot,b,yt){function Et(Vt,an){if(!b[Vt]){if(!ot[Vt]){if(kt)return kt(Vt,!0);throw new Error("Cannot find module '"+Vt+"'")}var Pn=b[Vt]={exports:{}};ot[Vt][0].call(Pn.exports,function(gn){return Et(ot[Vt][1][gn]||gn)},Pn,Pn.exports,tt,ot,b,yt)}return b[Vt].exports}for(var kt=void 0,Gt=0;Gt<yt.length;Gt++)Et(yt[Gt]);return Et}({1:[function(tt,ot,b){(function(yt,Et,kt,Gt,Vt,an,Pn,gn,dn){var wn=tt("crypto");function _n(un,Cn){return function(Qt,Wt){var Zt;if((Zt=Wt.algorithm!=="passthrough"?wn.createHash(Wt.algorithm):new Bn).write===void 0&&(Zt.write=Zt.update,Zt.end=Zt.update),Yt(Wt,Zt).dispatch(Qt),Zt.update||Zt.end(""),Zt.digest)return Zt.digest(Wt.encoding==="buffer"?void 0:Wt.encoding);var En=Zt.read();return Wt.encoding!=="buffer"?En.toString(Wt.encoding):En}(un,Cn=Ut(un,Cn))}(b=ot.exports=_n).sha1=function(un){return _n(un)},b.keys=function(un){return _n(un,{excludeValues:!0,algorithm:"sha1",encoding:"hex"})},b.MD5=function(un){return _n(un,{algorithm:"md5",encoding:"hex"})},b.keysMD5=function(un){return _n(un,{algorithm:"md5",encoding:"hex",excludeValues:!0})};var $t=wn.getHashes?wn.getHashes().slice():["sha1","md5"];$t.push("passthrough");var bn=["buffer","hex","binary","base64"];function Ut(un,Cn){Cn=Cn||{};var Qt={};if(Qt.algorithm=Cn.algorithm||"sha1",Qt.encoding=Cn.encoding||"hex",Qt.excludeValues=!!Cn.excludeValues,Qt.algorithm=Qt.algorithm.toLowerCase(),Qt.encoding=Qt.encoding.toLowerCase(),Qt.ignoreUnknown=Cn.ignoreUnknown===!0,Qt.respectType=Cn.respectType!==!1,Qt.respectFunctionNames=Cn.respectFunctionNames!==!1,Qt.respectFunctionProperties=Cn.respectFunctionProperties!==!1,Qt.unorderedArrays=Cn.unorderedArrays===!0,Qt.unorderedSets=Cn.unorderedSets!==!1,Qt.unorderedObjects=Cn.unorderedObjects!==!1,Qt.replacer=Cn.replacer||void 0,Qt.excludeKeys=Cn.excludeKeys||void 0,un===void 0)throw new Error("Object argument required.");for(var Wt=0;Wt<$t.length;++Wt)$t[Wt].toLowerCase()===Qt.algorithm.toLowerCase()&&(Qt.algorithm=$t[Wt]);if($t.indexOf(Qt.algorithm)===-1)throw new Error('Algorithm "'+Qt.algorithm+'"  not supported. supported values: '+$t.join(", "));if(bn.indexOf(Qt.encoding)===-1&&Qt.algorithm!=="passthrough")throw new Error('Encoding "'+Qt.encoding+'"  not supported. supported values: '+bn.join(", "));return Qt}function jt(un){if(typeof un=="function")return/^function\s+\w*\s*\(\s*\)\s*{\s+\[native code\]\s+}$/i.exec(Function.prototype.toString.call(un))!=null}function Yt(un,Cn,Qt){function Wt(Zt){return Cn.update?Cn.update(Zt,"utf8"):Cn.write(Zt,"utf8")}return Qt=Qt||[],{dispatch:function(Zt){return un.replacer&&(Zt=un.replacer(Zt)),this["_"+(Zt===null?"null":typeof Zt)](Zt)},_object:function(Zt){var En,pn=Object.prototype.toString.call(Zt),er=/\[object (.*)\]/i.exec(pn);if(er=(er=er?er[1]:"unknown:["+pn+"]").toLowerCase(),0<=(En=Qt.indexOf(Zt)))return this.dispatch("[CIRCULAR:"+En+"]");if(Qt.push(Zt),kt!==void 0&&kt.isBuffer&&kt.isBuffer(Zt))return Wt("buffer:"),Wt(Zt);if(er==="object"||er==="function"||er==="asyncfunction"){var Ir=Object.keys(Zt);un.unorderedObjects&&(Ir=Ir.sort()),un.respectType===!1||jt(Zt)||Ir.splice(0,0,"prototype","__proto__","constructor"),un.excludeKeys&&(Ir=Ir.filter(function(Vr){return!un.excludeKeys(Vr)})),Wt("object:"+Ir.length+":");var Dr=this;return Ir.forEach(function(Vr){Dr.dispatch(Vr),Wt(":"),un.excludeValues||Dr.dispatch(Zt[Vr]),Wt(",")})}if(!this["_"+er]){if(un.ignoreUnknown)return Wt("["+er+"]");throw new Error('Unknown object type "'+er+'"')}this["_"+er](Zt)},_array:function(Zt,En){En=En!==void 0?En:un.unorderedArrays!==!1;var pn=this;if(Wt("array:"+Zt.length+":"),!En||Zt.length<=1)return Zt.forEach(function(Dr){return pn.dispatch(Dr)});var er=[],Ir=Zt.map(function(Dr){var Vr=new Bn,yr=Qt.slice();return Yt(un,Vr,yr).dispatch(Dr),er=er.concat(yr.slice(Qt.length)),Vr.read().toString()});return Qt=Qt.concat(er),Ir.sort(),this._array(Ir,!1)},_date:function(Zt){return Wt("date:"+Zt.toJSON())},_symbol:function(Zt){return Wt("symbol:"+Zt.toString())},_error:function(Zt){return Wt("error:"+Zt.toString())},_boolean:function(Zt){return Wt("bool:"+Zt.toString())},_string:function(Zt){Wt("string:"+Zt.length+":"),Wt(Zt.toString())},_function:function(Zt){Wt("fn:"),jt(Zt)?this.dispatch("[native]"):this.dispatch(Zt.toString()),un.respectFunctionNames!==!1&&this.dispatch("function-name:"+String(Zt.name)),un.respectFunctionProperties&&this._object(Zt)},_number:function(Zt){return Wt("number:"+Zt.toString())},_xml:function(Zt){return Wt("xml:"+Zt.toString())},_null:function(){return Wt("Null")},_undefined:function(){return Wt("Undefined")},_regexp:function(Zt){return Wt("regex:"+Zt.toString())},_uint8array:function(Zt){return Wt("uint8array:"),this.dispatch(Array.prototype.slice.call(Zt))},_uint8clampedarray:function(Zt){return Wt("uint8clampedarray:"),this.dispatch(Array.prototype.slice.call(Zt))},_int8array:function(Zt){return Wt("uint8array:"),this.dispatch(Array.prototype.slice.call(Zt))},_uint16array:function(Zt){return Wt("uint16array:"),this.dispatch(Array.prototype.slice.call(Zt))},_int16array:function(Zt){return Wt("uint16array:"),this.dispatch(Array.prototype.slice.call(Zt))},_uint32array:function(Zt){return Wt("uint32array:"),this.dispatch(Array.prototype.slice.call(Zt))},_int32array:function(Zt){return Wt("uint32array:"),this.dispatch(Array.prototype.slice.call(Zt))},_float32array:function(Zt){return Wt("float32array:"),this.dispatch(Array.prototype.slice.call(Zt))},_float64array:function(Zt){return Wt("float64array:"),this.dispatch(Array.prototype.slice.call(Zt))},_arraybuffer:function(Zt){return Wt("arraybuffer:"),this.dispatch(new Uint8Array(Zt))},_url:function(Zt){return Wt("url:"+Zt.toString())},_map:function(Zt){Wt("map:");var En=Array.from(Zt);return this._array(En,un.unorderedSets!==!1)},_set:function(Zt){Wt("set:");var En=Array.from(Zt);return this._array(En,un.unorderedSets!==!1)},_file:function(Zt){return Wt("file:"),this.dispatch([Zt.name,Zt.size,Zt.type,Zt.lastModfied])},_blob:function(){if(un.ignoreUnknown)return Wt("[blob]");throw Error(`Hashing Blob objects is currently not supported
(see https://github.com/puleos/object-hash/issues/26)
Use "options.replacer" or "options.ignoreUnknown"
`)},_domwindow:function(){return Wt("domwindow")},_bigint:function(Zt){return Wt("bigint:"+Zt.toString())},_process:function(){return Wt("process")},_timer:function(){return Wt("timer")},_pipe:function(){return Wt("pipe")},_tcp:function(){return Wt("tcp")},_udp:function(){return Wt("udp")},_tty:function(){return Wt("tty")},_statwatcher:function(){return Wt("statwatcher")},_securecontext:function(){return Wt("securecontext")},_connection:function(){return Wt("connection")},_zlib:function(){return Wt("zlib")},_context:function(){return Wt("context")},_nodescript:function(){return Wt("nodescript")},_httpparser:function(){return Wt("httpparser")},_dataview:function(){return Wt("dataview")},_signal:function(){return Wt("signal")},_fsevent:function(){return Wt("fsevent")},_tlswrap:function(){return Wt("tlswrap")}}}function Bn(){return{buf:"",write:function(un){this.buf+=un},end:function(un){this.buf+=un},read:function(){return this.buf}}}b.writeToStream=function(un,Cn,Qt){return Qt===void 0&&(Qt=Cn,Cn={}),Yt(Cn=Ut(un,Cn),Qt).dispatch(un)}}).call(this,tt("lYpoI2"),typeof self<"u"?self:typeof window<"u"?window:{},tt("buffer").Buffer,arguments[3],arguments[4],arguments[5],arguments[6],"/fake_7eac155c.js","/")},{buffer:3,crypto:5,lYpoI2:10}],2:[function(tt,ot,b){(function(yt,Et,kt,Gt,Vt,an,Pn,gn,dn){(function(wn){var _n=typeof Uint8Array<"u"?Uint8Array:Array,$t="+".charCodeAt(0),bn="/".charCodeAt(0),Ut="0".charCodeAt(0),jt="a".charCodeAt(0),Yt="A".charCodeAt(0),Bn="-".charCodeAt(0),un="_".charCodeAt(0);function Cn(Qt){var Wt=Qt.charCodeAt(0);return Wt===$t||Wt===Bn?62:Wt===bn||Wt===un?63:Wt<Ut?-1:Wt<Ut+10?Wt-Ut+26+26:Wt<Yt+26?Wt-Yt:Wt<jt+26?Wt-jt+26:void 0}wn.toByteArray=function(Qt){var Wt,Zt;if(0<Qt.length%4)throw new Error("Invalid string. Length must be a multiple of 4");var En=Qt.length,pn=Qt.charAt(En-2)==="="?2:Qt.charAt(En-1)==="="?1:0,er=new _n(3*Qt.length/4-pn),Ir=0<pn?Qt.length-4:Qt.length,Dr=0;function Vr(yr){er[Dr++]=yr}for(Wt=0;Wt<Ir;Wt+=4,0)Vr((16711680&(Zt=Cn(Qt.charAt(Wt))<<18|Cn(Qt.charAt(Wt+1))<<12|Cn(Qt.charAt(Wt+2))<<6|Cn(Qt.charAt(Wt+3))))>>16),Vr((65280&Zt)>>8),Vr(255&Zt);return pn==2?Vr(255&(Zt=Cn(Qt.charAt(Wt))<<2|Cn(Qt.charAt(Wt+1))>>4)):pn==1&&(Vr((Zt=Cn(Qt.charAt(Wt))<<10|Cn(Qt.charAt(Wt+1))<<4|Cn(Qt.charAt(Wt+2))>>2)>>8&255),Vr(255&Zt)),er},wn.fromByteArray=function(Qt){var Wt,Zt,En,pn,er=Qt.length%3,Ir="";function Dr(Vr){return"ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/".charAt(Vr)}for(Wt=0,En=Qt.length-er;Wt<En;Wt+=3)Ir+=Dr((pn=Zt=(Qt[Wt]<<16)+(Qt[Wt+1]<<8)+Qt[Wt+2])>>18&63)+Dr(pn>>12&63)+Dr(pn>>6&63)+Dr(63&pn);switch(er){case 1:Ir+=Dr((Zt=Qt[Qt.length-1])>>2),Ir+=Dr(Zt<<4&63),Ir+="==";break;case 2:Ir+=Dr((Zt=(Qt[Qt.length-2]<<8)+Qt[Qt.length-1])>>10),Ir+=Dr(Zt>>4&63),Ir+=Dr(Zt<<2&63),Ir+="="}return Ir}})(b===void 0?this.base64js={}:b)}).call(this,tt("lYpoI2"),typeof self<"u"?self:typeof window<"u"?window:{},tt("buffer").Buffer,arguments[3],arguments[4],arguments[5],arguments[6],"/node_modules/gulp-browserify/node_modules/base64-js/lib/b64.js","/node_modules/gulp-browserify/node_modules/base64-js/lib")},{buffer:3,lYpoI2:10}],3:[function(tt,ot,b){(function(yt,Et,$t,Gt,Vt,an,Pn,gn,dn){var wn=tt("base64-js"),_n=tt("ieee754");function $t(Kt,rn,jn){if(!(this instanceof $t))return new $t(Kt,rn,jn);var Ur,kr,zr,Cs,Gs,Ao=typeof Kt;if(rn==="base64"&&Ao=="string")for(Kt=(Ur=Kt).trim?Ur.trim():Ur.replace(/^\s+|\s+$/g,"");Kt.length%4!=0;)Kt+="=";if(Ao=="number")kr=Dr(Kt);else if(Ao=="string")kr=$t.byteLength(Kt,rn);else{if(Ao!="object")throw new Error("First argument needs to be a number, array or string.");kr=Dr(Kt.length)}if($t._useTypedArrays?zr=$t._augment(new Uint8Array(kr)):((zr=this).length=kr,zr._isBuffer=!0),$t._useTypedArrays&&typeof Kt.byteLength=="number")zr._set(Kt);else if(Vr(Gs=Kt)||$t.isBuffer(Gs)||Gs&&typeof Gs=="object"&&typeof Gs.length=="number")for(Cs=0;Cs<kr;Cs++)$t.isBuffer(Kt)?zr[Cs]=Kt.readUInt8(Cs):zr[Cs]=Kt[Cs];else if(Ao=="string")zr.write(Kt,0,rn);else if(Ao=="number"&&!$t._useTypedArrays&&!jn)for(Cs=0;Cs<kr;Cs++)zr[Cs]=0;return zr}function bn(Kt,rn,jn,Ur){Ur||(Yn(typeof jn=="boolean","missing or invalid endian"),Yn(rn!=null,"missing offset"),Yn(rn+1<Kt.length,"Trying to read beyond buffer length"));var kr,zr=Kt.length;if(!(zr<=rn))return jn?(kr=Kt[rn],rn+1<zr&&(kr|=Kt[rn+1]<<8)):(kr=Kt[rn]<<8,rn+1<zr&&(kr|=Kt[rn+1])),kr}function Ut(Kt,rn,jn,Ur){Ur||(Yn(typeof jn=="boolean","missing or invalid endian"),Yn(rn!=null,"missing offset"),Yn(rn+3<Kt.length,"Trying to read beyond buffer length"));var kr,zr=Kt.length;if(!(zr<=rn))return jn?(rn+2<zr&&(kr=Kt[rn+2]<<16),rn+1<zr&&(kr|=Kt[rn+1]<<8),kr|=Kt[rn],rn+3<zr&&(kr+=Kt[rn+3]<<24>>>0)):(rn+1<zr&&(kr=Kt[rn+1]<<16),rn+2<zr&&(kr|=Kt[rn+2]<<8),rn+3<zr&&(kr|=Kt[rn+3]),kr+=Kt[rn]<<24>>>0),kr}function jt(Kt,rn,jn,Ur){if(Ur||(Yn(typeof jn=="boolean","missing or invalid endian"),Yn(rn!=null,"missing offset"),Yn(rn+1<Kt.length,"Trying to read beyond buffer length")),!(Kt.length<=rn)){var kr=bn(Kt,rn,jn,!0);return 32768&kr?-1*(65535-kr+1):kr}}function Yt(Kt,rn,jn,Ur){if(Ur||(Yn(typeof jn=="boolean","missing or invalid endian"),Yn(rn!=null,"missing offset"),Yn(rn+3<Kt.length,"Trying to read beyond buffer length")),!(Kt.length<=rn)){var kr=Ut(Kt,rn,jn,!0);return 2147483648&kr?-1*(4294967295-kr+1):kr}}function Bn(Kt,rn,jn,Ur){return Ur||(Yn(typeof jn=="boolean","missing or invalid endian"),Yn(rn+3<Kt.length,"Trying to read beyond buffer length")),_n.read(Kt,rn,jn,23,4)}function un(Kt,rn,jn,Ur){return Ur||(Yn(typeof jn=="boolean","missing or invalid endian"),Yn(rn+7<Kt.length,"Trying to read beyond buffer length")),_n.read(Kt,rn,jn,52,8)}function Cn(Kt,rn,jn,Ur,kr){kr||(Yn(rn!=null,"missing value"),Yn(typeof Ur=="boolean","missing or invalid endian"),Yn(jn!=null,"missing offset"),Yn(jn+1<Kt.length,"trying to write beyond buffer length"),nr(rn,65535));var zr=Kt.length;if(!(zr<=jn))for(var Cs=0,Gs=Math.min(zr-jn,2);Cs<Gs;Cs++)Kt[jn+Cs]=(rn&255<<8*(Ur?Cs:1-Cs))>>>8*(Ur?Cs:1-Cs)}function Qt(Kt,rn,jn,Ur,kr){kr||(Yn(rn!=null,"missing value"),Yn(typeof Ur=="boolean","missing or invalid endian"),Yn(jn!=null,"missing offset"),Yn(jn+3<Kt.length,"trying to write beyond buffer length"),nr(rn,4294967295));var zr=Kt.length;if(!(zr<=jn))for(var Cs=0,Gs=Math.min(zr-jn,4);Cs<Gs;Cs++)Kt[jn+Cs]=rn>>>8*(Ur?Cs:3-Cs)&255}function Wt(Kt,rn,jn,Ur,kr){kr||(Yn(rn!=null,"missing value"),Yn(typeof Ur=="boolean","missing or invalid endian"),Yn(jn!=null,"missing offset"),Yn(jn+1<Kt.length,"Trying to write beyond buffer length"),$n(rn,32767,-32768)),Kt.length<=jn||Cn(Kt,0<=rn?rn:65535+rn+1,jn,Ur,kr)}function Zt(Kt,rn,jn,Ur,kr){kr||(Yn(rn!=null,"missing value"),Yn(typeof Ur=="boolean","missing or invalid endian"),Yn(jn!=null,"missing offset"),Yn(jn+3<Kt.length,"Trying to write beyond buffer length"),$n(rn,2147483647,-2147483648)),Kt.length<=jn||Qt(Kt,0<=rn?rn:4294967295+rn+1,jn,Ur,kr)}function En(Kt,rn,jn,Ur,kr){kr||(Yn(rn!=null,"missing value"),Yn(typeof Ur=="boolean","missing or invalid endian"),Yn(jn!=null,"missing offset"),Yn(jn+3<Kt.length,"Trying to write beyond buffer length"),Er(rn,34028234663852886e22,-34028234663852886e22)),Kt.length<=jn||_n.write(Kt,rn,jn,Ur,23,4)}function pn(Kt,rn,jn,Ur,kr){kr||(Yn(rn!=null,"missing value"),Yn(typeof Ur=="boolean","missing or invalid endian"),Yn(jn!=null,"missing offset"),Yn(jn+7<Kt.length,"Trying to write beyond buffer length"),Er(rn,17976931348623157e292,-17976931348623157e292)),Kt.length<=jn||_n.write(Kt,rn,jn,Ur,52,8)}b.Buffer=$t,b.SlowBuffer=$t,b.INSPECT_MAX_BYTES=50,$t.poolSize=8192,$t._useTypedArrays=function(){try{var Kt=new ArrayBuffer(0),rn=new Uint8Array(Kt);return rn.foo=function(){return 42},rn.foo()===42&&typeof rn.subarray=="function"}catch{return!1}}(),$t.isEncoding=function(Kt){switch(String(Kt).toLowerCase()){case"hex":case"utf8":case"utf-8":case"ascii":case"binary":case"base64":case"raw":case"ucs2":case"ucs-2":case"utf16le":case"utf-16le":return!0;default:return!1}},$t.isBuffer=function(Kt){return!(Kt==null||!Kt._isBuffer)},$t.byteLength=function(Kt,rn){var jn;switch(Kt+="",rn||"utf8"){case"hex":jn=Kt.length/2;break;case"utf8":case"utf-8":jn=Hr(Kt).length;break;case"ascii":case"binary":case"raw":jn=Kt.length;break;case"base64":jn=Xn(Kt).length;break;case"ucs2":case"ucs-2":case"utf16le":case"utf-16le":jn=2*Kt.length;break;default:throw new Error("Unknown encoding")}return jn},$t.concat=function(Kt,rn){if(Yn(Vr(Kt),`Usage: Buffer.concat(list, [totalLength])
list should be an Array.`),Kt.length===0)return new $t(0);if(Kt.length===1)return Kt[0];if(typeof rn!="number")for(kr=rn=0;kr<Kt.length;kr++)rn+=Kt[kr].length;for(var jn=new $t(rn),Ur=0,kr=0;kr<Kt.length;kr++){var zr=Kt[kr];zr.copy(jn,Ur),Ur+=zr.length}return jn},$t.prototype.write=function(Kt,rn,jn,Ur){var kr;isFinite(rn)?isFinite(jn)||(Ur=jn,jn=void 0):(kr=Ur,Ur=rn,rn=jn,jn=kr),rn=Number(rn)||0;var zr,Cs,Gs,Ao,Ks,Oo,Js,Qo=this.length-rn;switch((!jn||Qo<(jn=Number(jn)))&&(jn=Qo),Ur=String(Ur||"utf8").toLowerCase()){case"hex":zr=function(yo,Vu,fu,$a){fu=Number(fu)||0;var ko=yo.length-fu;(!$a||ko<($a=Number($a)))&&($a=ko);var Hl=Vu.length;Yn(Hl%2==0,"Invalid hex string"),Hl/2<$a&&($a=Hl/2);for(var Io=0;Io<$a;Io++){var Qu=parseInt(Vu.substr(2*Io,2),16);Yn(!isNaN(Qu),"Invalid hex string"),yo[fu+Io]=Qu}return $t._charsWritten=2*Io,Io}(this,Kt,rn,jn);break;case"utf8":case"utf-8":Ks=Kt,Oo=rn,Js=jn,zr=$t._charsWritten=ir(Hr(Ks),this,Oo,Js);break;case"ascii":case"binary":zr=function(yo,Vu,fu,$a){return $t._charsWritten=ir(function(ko){for(var Hl=[],Io=0;Io<ko.length;Io++)Hl.push(255&ko.charCodeAt(Io));return Hl}(Vu),yo,fu,$a)}(this,Kt,rn,jn);break;case"base64":Cs=Kt,Gs=rn,Ao=jn,zr=$t._charsWritten=ir(Xn(Cs),this,Gs,Ao);break;case"ucs2":case"ucs-2":case"utf16le":case"utf-16le":zr=function(yo,Vu,fu,$a){return $t._charsWritten=ir(function(ko){for(var Hl,Io,Qu,Mu=[],Lo=0;Lo<ko.length;Lo++)Io=(Hl=ko.charCodeAt(Lo))>>8,Qu=Hl%256,Mu.push(Qu),Mu.push(Io);return Mu}(Vu),yo,fu,$a)}(this,Kt,rn,jn);break;default:throw new Error("Unknown encoding")}return zr},$t.prototype.toString=function(Kt,rn,jn){var Ur,kr,zr,Cs,Gs=this;if(Kt=String(Kt||"utf8").toLowerCase(),rn=Number(rn)||0,(jn=jn!==void 0?Number(jn):jn=Gs.length)===rn)return"";switch(Kt){case"hex":Ur=function(Ao,Ks,Oo){var Js=Ao.length;(!Ks||Ks<0)&&(Ks=0),(!Oo||Oo<0||Js<Oo)&&(Oo=Js);for(var Qo="",yo=Ks;yo<Oo;yo++)Qo+=yr(Ao[yo]);return Qo}(Gs,rn,jn);break;case"utf8":case"utf-8":Ur=function(Ao,Ks,Oo){var Js="",Qo="";Oo=Math.min(Ao.length,Oo);for(var yo=Ks;yo<Oo;yo++)Ao[yo]<=127?(Js+=zn(Qo)+String.fromCharCode(Ao[yo]),Qo=""):Qo+="%"+Ao[yo].toString(16);return Js+zn(Qo)}(Gs,rn,jn);break;case"ascii":case"binary":Ur=function(Ao,Ks,Oo){var Js="";Oo=Math.min(Ao.length,Oo);for(var Qo=Ks;Qo<Oo;Qo++)Js+=String.fromCharCode(Ao[Qo]);return Js}(Gs,rn,jn);break;case"base64":kr=Gs,Cs=jn,Ur=(zr=rn)===0&&Cs===kr.length?wn.fromByteArray(kr):wn.fromByteArray(kr.slice(zr,Cs));break;case"ucs2":case"ucs-2":case"utf16le":case"utf-16le":Ur=function(Ao,Ks,Oo){for(var Js=Ao.slice(Ks,Oo),Qo="",yo=0;yo<Js.length;yo+=2)Qo+=String.fromCharCode(Js[yo]+256*Js[yo+1]);return Qo}(Gs,rn,jn);break;default:throw new Error("Unknown encoding")}return Ur},$t.prototype.toJSON=function(){return{type:"Buffer",data:Array.prototype.slice.call(this._arr||this,0)}},$t.prototype.copy=function(Kt,rn,jn,Ur){if(jn=jn||0,Ur||Ur===0||(Ur=this.length),rn=rn||0,Ur!==jn&&Kt.length!==0&&this.length!==0){Yn(jn<=Ur,"sourceEnd < sourceStart"),Yn(0<=rn&&rn<Kt.length,"targetStart out of bounds"),Yn(0<=jn&&jn<this.length,"sourceStart out of bounds"),Yn(0<=Ur&&Ur<=this.length,"sourceEnd out of bounds"),Ur>this.length&&(Ur=this.length),Kt.length-rn<Ur-jn&&(Ur=Kt.length-rn+jn);var kr=Ur-jn;if(kr<100||!$t._useTypedArrays)for(var zr=0;zr<kr;zr++)Kt[zr+rn]=this[zr+jn];else Kt._set(this.subarray(jn,jn+kr),rn)}},$t.prototype.slice=function(Kt,rn){var jn=this.length;if(Kt=Ir(Kt,jn,0),rn=Ir(rn,jn,jn),$t._useTypedArrays)return $t._augment(this.subarray(Kt,rn));for(var Ur=rn-Kt,kr=new $t(Ur,void 0,!0),zr=0;zr<Ur;zr++)kr[zr]=this[zr+Kt];return kr},$t.prototype.get=function(Kt){return console.log(".get() is deprecated. Access using array indexes instead."),this.readUInt8(Kt)},$t.prototype.set=function(Kt,rn){return console.log(".set() is deprecated. Access using array indexes instead."),this.writeUInt8(Kt,rn)},$t.prototype.readUInt8=function(Kt,rn){if(rn||(Yn(Kt!=null,"missing offset"),Yn(Kt<this.length,"Trying to read beyond buffer length")),!(Kt>=this.length))return this[Kt]},$t.prototype.readUInt16LE=function(Kt,rn){return bn(this,Kt,!0,rn)},$t.prototype.readUInt16BE=function(Kt,rn){return bn(this,Kt,!1,rn)},$t.prototype.readUInt32LE=function(Kt,rn){return Ut(this,Kt,!0,rn)},$t.prototype.readUInt32BE=function(Kt,rn){return Ut(this,Kt,!1,rn)},$t.prototype.readInt8=function(Kt,rn){if(rn||(Yn(Kt!=null,"missing offset"),Yn(Kt<this.length,"Trying to read beyond buffer length")),!(Kt>=this.length))return 128&this[Kt]?-1*(255-this[Kt]+1):this[Kt]},$t.prototype.readInt16LE=function(Kt,rn){return jt(this,Kt,!0,rn)},$t.prototype.readInt16BE=function(Kt,rn){return jt(this,Kt,!1,rn)},$t.prototype.readInt32LE=function(Kt,rn){return Yt(this,Kt,!0,rn)},$t.prototype.readInt32BE=function(Kt,rn){return Yt(this,Kt,!1,rn)},$t.prototype.readFloatLE=function(Kt,rn){return Bn(this,Kt,!0,rn)},$t.prototype.readFloatBE=function(Kt,rn){return Bn(this,Kt,!1,rn)},$t.prototype.readDoubleLE=function(Kt,rn){return un(this,Kt,!0,rn)},$t.prototype.readDoubleBE=function(Kt,rn){return un(this,Kt,!1,rn)},$t.prototype.writeUInt8=function(Kt,rn,jn){jn||(Yn(Kt!=null,"missing value"),Yn(rn!=null,"missing offset"),Yn(rn<this.length,"trying to write beyond buffer length"),nr(Kt,255)),rn>=this.length||(this[rn]=Kt)},$t.prototype.writeUInt16LE=function(Kt,rn,jn){Cn(this,Kt,rn,!0,jn)},$t.prototype.writeUInt16BE=function(Kt,rn,jn){Cn(this,Kt,rn,!1,jn)},$t.prototype.writeUInt32LE=function(Kt,rn,jn){Qt(this,Kt,rn,!0,jn)},$t.prototype.writeUInt32BE=function(Kt,rn,jn){Qt(this,Kt,rn,!1,jn)},$t.prototype.writeInt8=function(Kt,rn,jn){jn||(Yn(Kt!=null,"missing value"),Yn(rn!=null,"missing offset"),Yn(rn<this.length,"Trying to write beyond buffer length"),$n(Kt,127,-128)),rn>=this.length||(0<=Kt?this.writeUInt8(Kt,rn,jn):this.writeUInt8(255+Kt+1,rn,jn))},$t.prototype.writeInt16LE=function(Kt,rn,jn){Wt(this,Kt,rn,!0,jn)},$t.prototype.writeInt16BE=function(Kt,rn,jn){Wt(this,Kt,rn,!1,jn)},$t.prototype.writeInt32LE=function(Kt,rn,jn){Zt(this,Kt,rn,!0,jn)},$t.prototype.writeInt32BE=function(Kt,rn,jn){Zt(this,Kt,rn,!1,jn)},$t.prototype.writeFloatLE=function(Kt,rn,jn){En(this,Kt,rn,!0,jn)},$t.prototype.writeFloatBE=function(Kt,rn,jn){En(this,Kt,rn,!1,jn)},$t.prototype.writeDoubleLE=function(Kt,rn,jn){pn(this,Kt,rn,!0,jn)},$t.prototype.writeDoubleBE=function(Kt,rn,jn){pn(this,Kt,rn,!1,jn)},$t.prototype.fill=function(Kt,rn,jn){if(Kt=Kt||0,rn=rn||0,jn=jn||this.length,typeof Kt=="string"&&(Kt=Kt.charCodeAt(0)),Yn(typeof Kt=="number"&&!isNaN(Kt),"value is not a number"),Yn(rn<=jn,"end < start"),jn!==rn&&this.length!==0){Yn(0<=rn&&rn<this.length,"start out of bounds"),Yn(0<=jn&&jn<=this.length,"end out of bounds");for(var Ur=rn;Ur<jn;Ur++)this[Ur]=Kt}},$t.prototype.inspect=function(){for(var Kt=[],rn=this.length,jn=0;jn<rn;jn++)if(Kt[jn]=yr(this[jn]),jn===b.INSPECT_MAX_BYTES){Kt[jn+1]="...";break}return"<Buffer "+Kt.join(" ")+">"},$t.prototype.toArrayBuffer=function(){if(typeof Uint8Array>"u")throw new Error("Buffer.toArrayBuffer not supported in this browser");if($t._useTypedArrays)return new $t(this).buffer;for(var Kt=new Uint8Array(this.length),rn=0,jn=Kt.length;rn<jn;rn+=1)Kt[rn]=this[rn];return Kt.buffer};var er=$t.prototype;function Ir(Kt,rn,jn){return typeof Kt!="number"?jn:rn<=(Kt=~~Kt)?rn:0<=Kt||0<=(Kt+=rn)?Kt:0}function Dr(Kt){return(Kt=~~Math.ceil(+Kt))<0?0:Kt}function Vr(Kt){return(Array.isArray||function(rn){return Object.prototype.toString.call(rn)==="[object Array]"})(Kt)}function yr(Kt){return Kt<16?"0"+Kt.toString(16):Kt.toString(16)}function Hr(Kt){for(var rn=[],jn=0;jn<Kt.length;jn++){var Ur=Kt.charCodeAt(jn);if(Ur<=127)rn.push(Kt.charCodeAt(jn));else{var kr=jn;55296<=Ur&&Ur<=57343&&jn++;for(var zr=encodeURIComponent(Kt.slice(kr,jn+1)).substr(1).split("%"),Cs=0;Cs<zr.length;Cs++)rn.push(parseInt(zr[Cs],16))}}return rn}function Xn(Kt){return wn.toByteArray(Kt)}function ir(Kt,rn,jn,Ur){for(var kr=0;kr<Ur&&!(kr+jn>=rn.length||kr>=Kt.length);kr++)rn[kr+jn]=Kt[kr];return kr}function zn(Kt){try{return decodeURIComponent(Kt)}catch{return String.fromCharCode(65533)}}function nr(Kt,rn){Yn(typeof Kt=="number","cannot write a non-number as a number"),Yn(0<=Kt,"specified a negative value for writing an unsigned value"),Yn(Kt<=rn,"value is larger than maximum value for type"),Yn(Math.floor(Kt)===Kt,"value has a fractional component")}function $n(Kt,rn,jn){Yn(typeof Kt=="number","cannot write a non-number as a number"),Yn(Kt<=rn,"value larger than maximum allowed value"),Yn(jn<=Kt,"value smaller than minimum allowed value"),Yn(Math.floor(Kt)===Kt,"value has a fractional component")}function Er(Kt,rn,jn){Yn(typeof Kt=="number","cannot write a non-number as a number"),Yn(Kt<=rn,"value larger than maximum allowed value"),Yn(jn<=Kt,"value smaller than minimum allowed value")}function Yn(Kt,rn){if(!Kt)throw new Error(rn||"Failed assertion")}$t._augment=function(Kt){return Kt._isBuffer=!0,Kt._get=Kt.get,Kt._set=Kt.set,Kt.get=er.get,Kt.set=er.set,Kt.write=er.write,Kt.toString=er.toString,Kt.toLocaleString=er.toString,Kt.toJSON=er.toJSON,Kt.copy=er.copy,Kt.slice=er.slice,Kt.readUInt8=er.readUInt8,Kt.readUInt16LE=er.readUInt16LE,Kt.readUInt16BE=er.readUInt16BE,Kt.readUInt32LE=er.readUInt32LE,Kt.readUInt32BE=er.readUInt32BE,Kt.readInt8=er.readInt8,Kt.readInt16LE=er.readInt16LE,Kt.readInt16BE=er.readInt16BE,Kt.readInt32LE=er.readInt32LE,Kt.readInt32BE=er.readInt32BE,Kt.readFloatLE=er.readFloatLE,Kt.readFloatBE=er.readFloatBE,Kt.readDoubleLE=er.readDoubleLE,Kt.readDoubleBE=er.readDoubleBE,Kt.writeUInt8=er.writeUInt8,Kt.writeUInt16LE=er.writeUInt16LE,Kt.writeUInt16BE=er.writeUInt16BE,Kt.writeUInt32LE=er.writeUInt32LE,Kt.writeUInt32BE=er.writeUInt32BE,Kt.writeInt8=er.writeInt8,Kt.writeInt16LE=er.writeInt16LE,Kt.writeInt16BE=er.writeInt16BE,Kt.writeInt32LE=er.writeInt32LE,Kt.writeInt32BE=er.writeInt32BE,Kt.writeFloatLE=er.writeFloatLE,Kt.writeFloatBE=er.writeFloatBE,Kt.writeDoubleLE=er.writeDoubleLE,Kt.writeDoubleBE=er.writeDoubleBE,Kt.fill=er.fill,Kt.inspect=er.inspect,Kt.toArrayBuffer=er.toArrayBuffer,Kt}}).call(this,tt("lYpoI2"),typeof self<"u"?self:typeof window<"u"?window:{},tt("buffer").Buffer,arguments[3],arguments[4],arguments[5],arguments[6],"/node_modules/gulp-browserify/node_modules/buffer/index.js","/node_modules/gulp-browserify/node_modules/buffer")},{"base64-js":2,buffer:3,ieee754:11,lYpoI2:10}],4:[function(tt,ot,b){(function(yt,Et,kt,Gt,Vt,an,Pn,gn,dn){kt=tt("buffer").Buffer;var wn=new kt(4);wn.fill(0),ot.exports={hash:function(_n,$t,bn,Ut){return kt.isBuffer(_n)||(_n=new kt(_n)),function(jt,Yt,Bn){for(var un=new kt(Yt),Cn=Bn?un.writeInt32BE:un.writeInt32LE,Qt=0;Qt<jt.length;Qt++)Cn.call(un,jt[Qt],4*Qt,!0);return un}($t(function(jt,Yt){var Bn;jt.length%4!=0&&(Bn=jt.length+(4-jt.length%4),jt=kt.concat([jt,wn],Bn));for(var un=[],Cn=Yt?jt.readInt32BE:jt.readInt32LE,Qt=0;Qt<jt.length;Qt+=4)un.push(Cn.call(jt,Qt));return un}(_n,Ut),8*_n.length),bn,Ut)}}}).call(this,tt("lYpoI2"),typeof self<"u"?self:typeof window<"u"?window:{},tt("buffer").Buffer,arguments[3],arguments[4],arguments[5],arguments[6],"/node_modules/gulp-browserify/node_modules/crypto-browserify/helpers.js","/node_modules/gulp-browserify/node_modules/crypto-browserify")},{buffer:3,lYpoI2:10}],5:[function(tt,ot,b){(function(yt,Et,kt,Gt,Vt,an,Pn,gn,dn){kt=tt("buffer").Buffer;var wn=tt("./sha"),_n=tt("./sha256"),$t=tt("./rng"),bn={sha1:wn,sha256:_n,md5:tt("./md5")},Ut=64,jt=new kt(Ut);function Yt(un,Cn){var Qt=bn[un=un||"sha1"],Wt=[];return Qt||Bn("algorithm:",un,"is not yet supported"),{update:function(Zt){return kt.isBuffer(Zt)||(Zt=new kt(Zt)),Wt.push(Zt),Zt.length,this},digest:function(Zt){var En=kt.concat(Wt),pn=Cn?function(er,Ir,Dr){kt.isBuffer(Ir)||(Ir=new kt(Ir)),kt.isBuffer(Dr)||(Dr=new kt(Dr)),Ir.length>Ut?Ir=er(Ir):Ir.length<Ut&&(Ir=kt.concat([Ir,jt],Ut));for(var Vr=new kt(Ut),yr=new kt(Ut),Hr=0;Hr<Ut;Hr++)Vr[Hr]=54^Ir[Hr],yr[Hr]=92^Ir[Hr];var Xn=er(kt.concat([Vr,Dr]));return er(kt.concat([yr,Xn]))}(Qt,Cn,En):Qt(En);return Wt=null,Zt?pn.toString(Zt):pn}}}function Bn(){var un=[].slice.call(arguments).join(" ");throw new Error([un,"we accept pull requests","http://github.com/dominictarr/crypto-browserify"].join(`
`))}jt.fill(0),b.createHash=function(un){return Yt(un)},b.createHmac=Yt,b.randomBytes=function(un,Cn){if(!Cn||!Cn.call)return new kt($t(un));try{Cn.call(this,void 0,new kt($t(un)))}catch(Qt){Cn(Qt)}},function(un,Cn){for(var Qt in un)Cn(un[Qt])}(["createCredentials","createCipher","createCipheriv","createDecipher","createDecipheriv","createSign","createVerify","createDiffieHellman","pbkdf2"],function(un){b[un]=function(){Bn("sorry,",un,"is not implemented yet")}})}).call(this,tt("lYpoI2"),typeof self<"u"?self:typeof window<"u"?window:{},tt("buffer").Buffer,arguments[3],arguments[4],arguments[5],arguments[6],"/node_modules/gulp-browserify/node_modules/crypto-browserify/index.js","/node_modules/gulp-browserify/node_modules/crypto-browserify")},{"./md5":6,"./rng":7,"./sha":8,"./sha256":9,buffer:3,lYpoI2:10}],6:[function(tt,ot,b){(function(yt,Et,kt,Gt,Vt,an,Pn,gn,dn){var wn=tt("./helpers");function _n(un,Cn){un[Cn>>5]|=128<<Cn%32,un[14+(Cn+64>>>9<<4)]=Cn;for(var Qt=1732584193,Wt=-271733879,Zt=-1732584194,En=271733878,pn=0;pn<un.length;pn+=16){var er=Qt,Ir=Wt,Dr=Zt,Vr=En;Qt=bn(Qt,Wt,Zt,En,un[pn+0],7,-680876936),En=bn(En,Qt,Wt,Zt,un[pn+1],12,-389564586),Zt=bn(Zt,En,Qt,Wt,un[pn+2],17,606105819),Wt=bn(Wt,Zt,En,Qt,un[pn+3],22,-1044525330),Qt=bn(Qt,Wt,Zt,En,un[pn+4],7,-176418897),En=bn(En,Qt,Wt,Zt,un[pn+5],12,1200080426),Zt=bn(Zt,En,Qt,Wt,un[pn+6],17,-1473231341),Wt=bn(Wt,Zt,En,Qt,un[pn+7],22,-45705983),Qt=bn(Qt,Wt,Zt,En,un[pn+8],7,1770035416),En=bn(En,Qt,Wt,Zt,un[pn+9],12,-1958414417),Zt=bn(Zt,En,Qt,Wt,un[pn+10],17,-42063),Wt=bn(Wt,Zt,En,Qt,un[pn+11],22,-1990404162),Qt=bn(Qt,Wt,Zt,En,un[pn+12],7,1804603682),En=bn(En,Qt,Wt,Zt,un[pn+13],12,-40341101),Zt=bn(Zt,En,Qt,Wt,un[pn+14],17,-1502002290),Qt=Ut(Qt,Wt=bn(Wt,Zt,En,Qt,un[pn+15],22,1236535329),Zt,En,un[pn+1],5,-165796510),En=Ut(En,Qt,Wt,Zt,un[pn+6],9,-1069501632),Zt=Ut(Zt,En,Qt,Wt,un[pn+11],14,643717713),Wt=Ut(Wt,Zt,En,Qt,un[pn+0],20,-373897302),Qt=Ut(Qt,Wt,Zt,En,un[pn+5],5,-701558691),En=Ut(En,Qt,Wt,Zt,un[pn+10],9,38016083),Zt=Ut(Zt,En,Qt,Wt,un[pn+15],14,-660478335),Wt=Ut(Wt,Zt,En,Qt,un[pn+4],20,-405537848),Qt=Ut(Qt,Wt,Zt,En,un[pn+9],5,568446438),En=Ut(En,Qt,Wt,Zt,un[pn+14],9,-1019803690),Zt=Ut(Zt,En,Qt,Wt,un[pn+3],14,-187363961),Wt=Ut(Wt,Zt,En,Qt,un[pn+8],20,1163531501),Qt=Ut(Qt,Wt,Zt,En,un[pn+13],5,-1444681467),En=Ut(En,Qt,Wt,Zt,un[pn+2],9,-51403784),Zt=Ut(Zt,En,Qt,Wt,un[pn+7],14,1735328473),Qt=jt(Qt,Wt=Ut(Wt,Zt,En,Qt,un[pn+12],20,-1926607734),Zt,En,un[pn+5],4,-378558),En=jt(En,Qt,Wt,Zt,un[pn+8],11,-2022574463),Zt=jt(Zt,En,Qt,Wt,un[pn+11],16,1839030562),Wt=jt(Wt,Zt,En,Qt,un[pn+14],23,-35309556),Qt=jt(Qt,Wt,Zt,En,un[pn+1],4,-1530992060),En=jt(En,Qt,Wt,Zt,un[pn+4],11,1272893353),Zt=jt(Zt,En,Qt,Wt,un[pn+7],16,-155497632),Wt=jt(Wt,Zt,En,Qt,un[pn+10],23,-1094730640),Qt=jt(Qt,Wt,Zt,En,un[pn+13],4,681279174),En=jt(En,Qt,Wt,Zt,un[pn+0],11,-358537222),Zt=jt(Zt,En,Qt,Wt,un[pn+3],16,-722521979),Wt=jt(Wt,Zt,En,Qt,un[pn+6],23,76029189),Qt=jt(Qt,Wt,Zt,En,un[pn+9],4,-640364487),En=jt(En,Qt,Wt,Zt,un[pn+12],11,-421815835),Zt=jt(Zt,En,Qt,Wt,un[pn+15],16,530742520),Qt=Yt(Qt,Wt=jt(Wt,Zt,En,Qt,un[pn+2],23,-995338651),Zt,En,un[pn+0],6,-198630844),En=Yt(En,Qt,Wt,Zt,un[pn+7],10,1126891415),Zt=Yt(Zt,En,Qt,Wt,un[pn+14],15,-1416354905),Wt=Yt(Wt,Zt,En,Qt,un[pn+5],21,-57434055),Qt=Yt(Qt,Wt,Zt,En,un[pn+12],6,1700485571),En=Yt(En,Qt,Wt,Zt,un[pn+3],10,-1894986606),Zt=Yt(Zt,En,Qt,Wt,un[pn+10],15,-1051523),Wt=Yt(Wt,Zt,En,Qt,un[pn+1],21,-2054922799),Qt=Yt(Qt,Wt,Zt,En,un[pn+8],6,1873313359),En=Yt(En,Qt,Wt,Zt,un[pn+15],10,-30611744),Zt=Yt(Zt,En,Qt,Wt,un[pn+6],15,-1560198380),Wt=Yt(Wt,Zt,En,Qt,un[pn+13],21,1309151649),Qt=Yt(Qt,Wt,Zt,En,un[pn+4],6,-145523070),En=Yt(En,Qt,Wt,Zt,un[pn+11],10,-1120210379),Zt=Yt(Zt,En,Qt,Wt,un[pn+2],15,718787259),Wt=Yt(Wt,Zt,En,Qt,un[pn+9],21,-343485551),Qt=Bn(Qt,er),Wt=Bn(Wt,Ir),Zt=Bn(Zt,Dr),En=Bn(En,Vr)}return Array(Qt,Wt,Zt,En)}function $t(un,Cn,Qt,Wt,Zt,En){return Bn((pn=Bn(Bn(Cn,un),Bn(Wt,En)))<<(er=Zt)|pn>>>32-er,Qt);var pn,er}function bn(un,Cn,Qt,Wt,Zt,En,pn){return $t(Cn&Qt|~Cn&Wt,un,Cn,Zt,En,pn)}function Ut(un,Cn,Qt,Wt,Zt,En,pn){return $t(Cn&Wt|Qt&~Wt,un,Cn,Zt,En,pn)}function jt(un,Cn,Qt,Wt,Zt,En,pn){return $t(Cn^Qt^Wt,un,Cn,Zt,En,pn)}function Yt(un,Cn,Qt,Wt,Zt,En,pn){return $t(Qt^(Cn|~Wt),un,Cn,Zt,En,pn)}function Bn(un,Cn){var Qt=(65535&un)+(65535&Cn);return(un>>16)+(Cn>>16)+(Qt>>16)<<16|65535&Qt}ot.exports=function(un){return wn.hash(un,_n,16)}}).call(this,tt("lYpoI2"),typeof self<"u"?self:typeof window<"u"?window:{},tt("buffer").Buffer,arguments[3],arguments[4],arguments[5],arguments[6],"/node_modules/gulp-browserify/node_modules/crypto-browserify/md5.js","/node_modules/gulp-browserify/node_modules/crypto-browserify")},{"./helpers":4,buffer:3,lYpoI2:10}],7:[function(tt,ot,b){(function(yt,Et,kt,Gt,Vt,an,Pn,gn,dn){var wn;wn=function(_n){for(var $t,bn=new Array(_n),Ut=0;Ut<_n;Ut++)!(3&Ut)&&($t=4294967296*Math.random()),bn[Ut]=$t>>>((3&Ut)<<3)&255;return bn},ot.exports=wn}).call(this,tt("lYpoI2"),typeof self<"u"?self:typeof window<"u"?window:{},tt("buffer").Buffer,arguments[3],arguments[4],arguments[5],arguments[6],"/node_modules/gulp-browserify/node_modules/crypto-browserify/rng.js","/node_modules/gulp-browserify/node_modules/crypto-browserify")},{buffer:3,lYpoI2:10}],8:[function(tt,ot,b){(function(yt,Et,kt,Gt,Vt,an,Pn,gn,dn){var wn=tt("./helpers");function _n(Ut,jt){Ut[jt>>5]|=128<<24-jt%32,Ut[15+(jt+64>>9<<4)]=jt;for(var Yt,Bn,un,Cn,Qt,Wt=Array(80),Zt=1732584193,En=-271733879,pn=-1732584194,er=271733878,Ir=-1009589776,Dr=0;Dr<Ut.length;Dr+=16){for(var Vr=Zt,yr=En,Hr=pn,Xn=er,ir=Ir,zn=0;zn<80;zn++){Wt[zn]=zn<16?Ut[Dr+zn]:bn(Wt[zn-3]^Wt[zn-8]^Wt[zn-14]^Wt[zn-16],1);var nr=$t($t(bn(Zt,5),(un=En,Cn=pn,Qt=er,(Bn=zn)<20?un&Cn|~un&Qt:!(Bn<40)&&Bn<60?un&Cn|un&Qt|Cn&Qt:un^Cn^Qt)),$t($t(Ir,Wt[zn]),(Yt=zn)<20?1518500249:Yt<40?1859775393:Yt<60?-1894007588:-899497514));Ir=er,er=pn,pn=bn(En,30),En=Zt,Zt=nr}Zt=$t(Zt,Vr),En=$t(En,yr),pn=$t(pn,Hr),er=$t(er,Xn),Ir=$t(Ir,ir)}return Array(Zt,En,pn,er,Ir)}function $t(Ut,jt){var Yt=(65535&Ut)+(65535&jt);return(Ut>>16)+(jt>>16)+(Yt>>16)<<16|65535&Yt}function bn(Ut,jt){return Ut<<jt|Ut>>>32-jt}ot.exports=function(Ut){return wn.hash(Ut,_n,20,!0)}}).call(this,tt("lYpoI2"),typeof self<"u"?self:typeof window<"u"?window:{},tt("buffer").Buffer,arguments[3],arguments[4],arguments[5],arguments[6],"/node_modules/gulp-browserify/node_modules/crypto-browserify/sha.js","/node_modules/gulp-browserify/node_modules/crypto-browserify")},{"./helpers":4,buffer:3,lYpoI2:10}],9:[function(tt,ot,b){(function(yt,Et,kt,Gt,Vt,an,Pn,gn,dn){function wn(Ut,jt){var Yt=(65535&Ut)+(65535&jt);return(Ut>>16)+(jt>>16)+(Yt>>16)<<16|65535&Yt}function _n(Ut,jt){return Ut>>>jt|Ut<<32-jt}function $t(Ut,jt){var Yt,Bn,un,Cn,Qt,Wt,Zt,En,pn,er,Ir=new Array(1116352408,1899447441,3049323471,3921009573,961987163,1508970993,2453635748,2870763221,3624381080,310598401,607225278,1426881987,1925078388,2162078206,2614888103,3248222580,3835390401,4022224774,264347078,604807628,770255983,1249150122,1555081692,1996064986,2554220882,2821834349,2952996808,3210313671,3336571891,3584528711,113926993,338241895,666307205,773529912,1294757372,1396182291,1695183700,1986661051,2177026350,2456956037,2730485921,2820302411,3259730800,3345764771,3516065817,3600352804,4094571909,275423344,430227734,506948616,659060556,883997877,958139571,1322822218,1537002063,1747873779,1955562222,2024104815,2227730452,2361852424,2428436474,2756734187,3204031479,3329325298),Dr=new Array(1779033703,3144134277,1013904242,2773480762,1359893119,2600822924,528734635,1541459225),Vr=new Array(64);Ut[jt>>5]|=128<<24-jt%32,Ut[15+(jt+64>>9<<4)]=jt;for(var yr,Hr,Xn,ir,zn,nr,$n,Er,Yn=0;Yn<Ut.length;Yn+=16){Yt=Dr[0],Bn=Dr[1],un=Dr[2],Cn=Dr[3],Qt=Dr[4],Wt=Dr[5],Zt=Dr[6],En=Dr[7];for(var Kt=0;Kt<64;Kt++)Vr[Kt]=Kt<16?Ut[Kt+Yn]:wn(wn(wn(_n(Er=Vr[Kt-2],17)^_n(Er,19)^Er>>>10,Vr[Kt-7]),_n($n=Vr[Kt-15],7)^_n($n,18)^$n>>>3),Vr[Kt-16]),pn=wn(wn(wn(wn(En,_n(nr=Qt,6)^_n(nr,11)^_n(nr,25)),(zn=Qt)&Wt^~zn&Zt),Ir[Kt]),Vr[Kt]),er=wn(_n(ir=Yt,2)^_n(ir,13)^_n(ir,22),(yr=Yt)&(Hr=Bn)^yr&(Xn=un)^Hr&Xn),En=Zt,Zt=Wt,Wt=Qt,Qt=wn(Cn,pn),Cn=un,un=Bn,Bn=Yt,Yt=wn(pn,er);Dr[0]=wn(Yt,Dr[0]),Dr[1]=wn(Bn,Dr[1]),Dr[2]=wn(un,Dr[2]),Dr[3]=wn(Cn,Dr[3]),Dr[4]=wn(Qt,Dr[4]),Dr[5]=wn(Wt,Dr[5]),Dr[6]=wn(Zt,Dr[6]),Dr[7]=wn(En,Dr[7])}return Dr}var bn=tt("./helpers");ot.exports=function(Ut){return bn.hash(Ut,$t,32,!0)}}).call(this,tt("lYpoI2"),typeof self<"u"?self:typeof window<"u"?window:{},tt("buffer").Buffer,arguments[3],arguments[4],arguments[5],arguments[6],"/node_modules/gulp-browserify/node_modules/crypto-browserify/sha256.js","/node_modules/gulp-browserify/node_modules/crypto-browserify")},{"./helpers":4,buffer:3,lYpoI2:10}],10:[function(tt,ot,b){(function(yt,Et,kt,Gt,Vt,an,Pn,gn,dn){function wn(){}(yt=ot.exports={}).nextTick=function(){var _n=typeof window<"u"&&window.setImmediate,$t=typeof window<"u"&&window.postMessage&&window.addEventListener;if(_n)return function(Ut){return window.setImmediate(Ut)};if($t){var bn=[];return window.addEventListener("message",function(Ut){var jt=Ut.source;jt!==window&&jt!==null||Ut.data!=="process-tick"||(Ut.stopPropagation(),0<bn.length&&bn.shift()())},!0),function(Ut){bn.push(Ut),window.postMessage("process-tick","*")}}return function(Ut){setTimeout(Ut,0)}}(),yt.title="browser",yt.browser=!0,yt.env={},yt.argv=[],yt.on=wn,yt.addListener=wn,yt.once=wn,yt.off=wn,yt.removeListener=wn,yt.removeAllListeners=wn,yt.emit=wn,yt.binding=function(_n){throw new Error("process.binding is not supported")},yt.cwd=function(){return"/"},yt.chdir=function(_n){throw new Error("process.chdir is not supported")}}).call(this,tt("lYpoI2"),typeof self<"u"?self:typeof window<"u"?window:{},tt("buffer").Buffer,arguments[3],arguments[4],arguments[5],arguments[6],"/node_modules/gulp-browserify/node_modules/process/browser.js","/node_modules/gulp-browserify/node_modules/process")},{buffer:3,lYpoI2:10}],11:[function(tt,ot,b){(function(yt,Et,kt,Gt,Vt,an,Pn,gn,dn){b.read=function(wn,_n,$t,bn,Ut){var jt,Yt,Bn=8*Ut-bn-1,un=(1<<Bn)-1,Cn=un>>1,Qt=-7,Wt=$t?Ut-1:0,Zt=$t?-1:1,En=wn[_n+Wt];for(Wt+=Zt,jt=En&(1<<-Qt)-1,En>>=-Qt,Qt+=Bn;0<Qt;jt=256*jt+wn[_n+Wt],Wt+=Zt,Qt-=8);for(Yt=jt&(1<<-Qt)-1,jt>>=-Qt,Qt+=bn;0<Qt;Yt=256*Yt+wn[_n+Wt],Wt+=Zt,Qt-=8);if(jt===0)jt=1-Cn;else{if(jt===un)return Yt?NaN:1/0*(En?-1:1);Yt+=Math.pow(2,bn),jt-=Cn}return(En?-1:1)*Yt*Math.pow(2,jt-bn)},b.write=function(wn,_n,$t,bn,Ut,jt){var Yt,Bn,un,Cn=8*jt-Ut-1,Qt=(1<<Cn)-1,Wt=Qt>>1,Zt=Ut===23?Math.pow(2,-24)-Math.pow(2,-77):0,En=bn?0:jt-1,pn=bn?1:-1,er=_n<0||_n===0&&1/_n<0?1:0;for(_n=Math.abs(_n),isNaN(_n)||_n===1/0?(Bn=isNaN(_n)?1:0,Yt=Qt):(Yt=Math.floor(Math.log(_n)/Math.LN2),_n*(un=Math.pow(2,-Yt))<1&&(Yt--,un*=2),2<=(_n+=1<=Yt+Wt?Zt/un:Zt*Math.pow(2,1-Wt))*un&&(Yt++,un/=2),Qt<=Yt+Wt?(Bn=0,Yt=Qt):1<=Yt+Wt?(Bn=(_n*un-1)*Math.pow(2,Ut),Yt+=Wt):(Bn=_n*Math.pow(2,Wt-1)*Math.pow(2,Ut),Yt=0));8<=Ut;wn[$t+En]=255&Bn,En+=pn,Bn/=256,Ut-=8);for(Yt=Yt<<Ut|Bn,Cn+=Ut;0<Cn;wn[$t+En]=255&Yt,En+=pn,Yt/=256,Cn-=8);wn[$t+En-pn]|=128*er}}).call(this,tt("lYpoI2"),typeof self<"u"?self:typeof window<"u"?window:{},tt("buffer").Buffer,arguments[3],arguments[4],arguments[5],arguments[6],"/node_modules/ieee754/index.js","/node_modules/ieee754")},{buffer:3,lYpoI2:10}]},{},[1])(1)},654:function(j){var tt=function(){function ot($t){return Pn($t,gn(an(dn($t.length),$t),1/$t.length))}function b($t){return an(wn($t),$t)}function yt($t,bn){return gn($t,bn?1/($t.length-1):1/$t.length)}function Et($t){var bn=function(jt){var Yt,Bn=Math.pow(2,-52),un=1e-64/Bn,Cn=0,Qt=0,Wt=0,Zt=0,En=0,pn=_n(jt),er=pn.length,Ir=pn[0].length;if(er<Ir)throw"Need more rows than columns";var Dr=new Array(Ir),Vr=new Array(Ir);for(Qt=0;Qt<Ir;Qt++)Dr[Qt]=Vr[Qt]=0;var yr=function Ur(kr,zr,Cs){Cs===void 0&&(Cs=0);var Gs,Ao=kr[Cs],Ks=Array(Ao);if(Cs===kr.length-1){for(Gs=Ao-2;Gs>=0;Gs-=2)Ks[Gs+1]=zr,Ks[Gs]=zr;return Gs===-1&&(Ks[0]=zr),Ks}for(Gs=Ao-1;Gs>=0;Gs--)Ks[Gs]=Ur(kr,zr,Cs+1);return Ks}([Ir,Ir],0);function Hr(Ur,kr){return(Ur=Math.abs(Ur))>(kr=Math.abs(kr))?Ur*Math.sqrt(1+kr*kr/Ur/Ur):kr==0?Ur:kr*Math.sqrt(1+Ur*Ur/kr/kr)}var Xn=0,ir=0,zn=0,nr=0,$n=0,Er=0,Yn=0;for(Qt=0;Qt<Ir;Qt++){for(Dr[Qt]=ir,Yn=0,En=Qt+1,Wt=Qt;Wt<er;Wt++)Yn+=pn[Wt][Qt]*pn[Wt][Qt];if(Yn<=un)ir=0;else for(Xn=pn[Qt][Qt],ir=Math.sqrt(Yn),Xn>=0&&(ir=-ir),zn=Xn*ir-Yn,pn[Qt][Qt]=Xn-ir,Wt=En;Wt<Ir;Wt++){for(Yn=0,Zt=Qt;Zt<er;Zt++)Yn+=pn[Zt][Qt]*pn[Zt][Wt];for(Xn=Yn/zn,Zt=Qt;Zt<er;Zt++)pn[Zt][Wt]+=Xn*pn[Zt][Qt]}for(Vr[Qt]=ir,Yn=0,Wt=En;Wt<Ir;Wt++)Yn+=pn[Qt][Wt]*pn[Qt][Wt];if(Yn<=un)ir=0;else{for(Xn=pn[Qt][Qt+1],ir=Math.sqrt(Yn),Xn>=0&&(ir=-ir),zn=Xn*ir-Yn,pn[Qt][Qt+1]=Xn-ir,Wt=En;Wt<Ir;Wt++)Dr[Wt]=pn[Qt][Wt]/zn;for(Wt=En;Wt<er;Wt++){for(Yn=0,Zt=En;Zt<Ir;Zt++)Yn+=pn[Wt][Zt]*pn[Qt][Zt];for(Zt=En;Zt<Ir;Zt++)pn[Wt][Zt]+=Yn*Dr[Zt]}}($n=Math.abs(Vr[Qt])+Math.abs(Dr[Qt]))>nr&&(nr=$n)}for(Qt=Ir-1;Qt!=-1;Qt+=-1){if(ir!=0){for(zn=ir*pn[Qt][Qt+1],Wt=En;Wt<Ir;Wt++)yr[Wt][Qt]=pn[Qt][Wt]/zn;for(Wt=En;Wt<Ir;Wt++){for(Yn=0,Zt=En;Zt<Ir;Zt++)Yn+=pn[Qt][Zt]*yr[Zt][Wt];for(Zt=En;Zt<Ir;Zt++)yr[Zt][Wt]+=Yn*yr[Zt][Qt]}}for(Wt=En;Wt<Ir;Wt++)yr[Qt][Wt]=0,yr[Wt][Qt]=0;yr[Qt][Qt]=1,ir=Dr[Qt],En=Qt}for(Qt=Ir-1;Qt!=-1;Qt+=-1){for(En=Qt+1,ir=Vr[Qt],Wt=En;Wt<Ir;Wt++)pn[Qt][Wt]=0;if(ir!=0){for(zn=pn[Qt][Qt]*ir,Wt=En;Wt<Ir;Wt++){for(Yn=0,Zt=En;Zt<er;Zt++)Yn+=pn[Zt][Qt]*pn[Zt][Wt];for(Xn=Yn/zn,Zt=Qt;Zt<er;Zt++)pn[Zt][Wt]+=Xn*pn[Zt][Qt]}for(Wt=Qt;Wt<er;Wt++)pn[Wt][Qt]=pn[Wt][Qt]/ir}else for(Wt=Qt;Wt<er;Wt++)pn[Wt][Qt]=0;pn[Qt][Qt]+=1}for(Bn*=nr,Zt=Ir-1;Zt!=-1;Zt+=-1)for(var Kt=0;Kt<50;Kt++){var rn=!1;for(En=Zt;En!=-1;En+=-1){if(Math.abs(Dr[En])<=Bn){rn=!0;break}if(Math.abs(Vr[En-1])<=Bn)break}if(!rn){Cn=0,Yn=1;var jn=En-1;for(Qt=En;Qt<Zt+1&&(Xn=Yn*Dr[Qt],Dr[Qt]=Cn*Dr[Qt],!(Math.abs(Xn)<=Bn));Qt++)for(zn=Hr(Xn,ir=Vr[Qt]),Vr[Qt]=zn,Cn=ir/zn,Yn=-Xn/zn,Wt=0;Wt<er;Wt++)$n=pn[Wt][jn],Er=pn[Wt][Qt],pn[Wt][jn]=$n*Cn+Er*Yn,pn[Wt][Qt]=-$n*Yn+Er*Cn}if(Er=Vr[Zt],En==Zt){if(Er<0)for(Vr[Zt]=-Er,Wt=0;Wt<Ir;Wt++)yr[Wt][Zt]=-yr[Wt][Zt];break}if(Kt>=49)throw"Error: no convergence.";for(nr=Vr[En],ir=Hr(Xn=((($n=Vr[Zt-1])-Er)*($n+Er)+((ir=Dr[Zt-1])-(zn=Dr[Zt]))*(ir+zn))/(2*zn*$n),1),Xn=Xn<0?((nr-Er)*(nr+Er)+zn*($n/(Xn-ir)-zn))/nr:((nr-Er)*(nr+Er)+zn*($n/(Xn+ir)-zn))/nr,Cn=1,Yn=1,Qt=En+1;Qt<Zt+1;Qt++){for(ir=Dr[Qt],$n=Vr[Qt],zn=Yn*ir,ir*=Cn,Er=Hr(Xn,zn),Dr[Qt-1]=Er,Xn=nr*(Cn=Xn/Er)+ir*(Yn=zn/Er),ir=-nr*Yn+ir*Cn,zn=$n*Yn,$n*=Cn,Wt=0;Wt<Ir;Wt++)nr=yr[Wt][Qt-1],Er=yr[Wt][Qt],yr[Wt][Qt-1]=nr*Cn+Er*Yn,yr[Wt][Qt]=-nr*Yn+Er*Cn;for(Er=Hr(Xn,zn),Vr[Qt-1]=Er,Xn=(Cn=Xn/Er)*ir+(Yn=zn/Er)*$n,nr=-Yn*ir+Cn*$n,Wt=0;Wt<er;Wt++)$n=pn[Wt][Qt-1],Er=pn[Wt][Qt],pn[Wt][Qt-1]=$n*Cn+Er*Yn,pn[Wt][Qt]=-$n*Yn+Er*Cn}Dr[En]=0,Dr[Zt]=Xn,Vr[Zt]=nr}for(Qt=0;Qt<Vr.length;Qt++)Vr[Qt]<Bn&&(Vr[Qt]=0);for(Qt=0;Qt<Ir;Qt++)for(Wt=Qt-1;Wt>=0;Wt--)if(Vr[Wt]<Vr[Qt]){for(Cn=Vr[Wt],Vr[Wt]=Vr[Qt],Vr[Qt]=Cn,Zt=0;Zt<pn.length;Zt++)Yt=pn[Zt][Qt],pn[Zt][Qt]=pn[Zt][Wt],pn[Zt][Wt]=Yt;for(Zt=0;Zt<yr.length;Zt++)Yt=yr[Zt][Qt],yr[Zt][Qt]=yr[Zt][Wt],yr[Zt][Wt]=Yt;Qt=Wt}return{U:pn,S:Vr,V:yr}}($t);console.log(bn);var Ut=bn.U;return bn.S.map(function(jt,Yt){var Bn={};return Bn.eigenvalue=jt,Bn.vector=Ut.map(function(un,Cn){return-1*un[Yt]}),Bn})}function kt($t,...bn){var Ut=bn.map(function(Bn){return Bn.vector}),jt=an(Ut,wn(ot($t))),Yt=gn(an(dn($t.length),$t),-1/$t.length);return{adjustedData:jt,formattedAdjustedData:Vt(jt,2),avgData:Yt,selectedVectors:Ut}}function Gt($t){return Et(yt(b(ot($t)),!1))}function Vt($t,bn){var Ut=Math.pow(10,bn||2);return $t.map(function(jt,Yt){return jt.map(function(Bn){return Math.round(Bn*Ut)/Ut})})}function an($t,bn){if(!($t[0]&&bn[0]&&$t.length&&bn.length))throw new Error("Both A and B should be matrices");if(bn.length!==$t[0].length)throw new Error("Columns in A should be the same as the number of rows in B");for(var Ut=[],jt=0;jt<$t.length;jt++){Ut[jt]=[];for(var Yt=0;Yt<bn[0].length;Yt++)for(var Bn=0;Bn<$t[0].length;Bn++)Ut[jt][Yt]=Ut[jt][Yt]?Ut[jt][Yt]+$t[jt][Bn]*bn[Bn][Yt]:$t[jt][Bn]*bn[Bn][Yt]}return Ut}function Pn($t,bn){if($t.length!==bn.length||$t[0].length!==bn[0].length)throw new Error("Both A and B should have the same dimensions");for(var Ut=[],jt=0;jt<$t.length;jt++){Ut[jt]=[];for(var Yt=0;Yt<bn[0].length;Yt++)Ut[jt][Yt]=$t[jt][Yt]-bn[jt][Yt]}return Ut}function gn($t,bn){for(var Ut=[],jt=0;jt<$t.length;jt++){Ut[jt]=[];for(var Yt=0;Yt<$t[0].length;Yt++)Ut[jt][Yt]=$t[jt][Yt]*bn}return Ut}function dn($t){for(var bn=[],Ut=0;Ut<$t;Ut++){bn[Ut]=[];for(var jt=0;jt<$t;jt++)bn[Ut][jt]=1}return bn}function wn($t){return _n($t)[0].map(function(bn,Ut){return $t.map(function(jt){return jt[Ut]})})}function _n($t){var bn=JSON.stringify($t);return JSON.parse(bn)}return{computeDeviationScores:b,computeDeviationMatrix:ot,computeSVD:Et,computePercentageExplained:function($t,...bn){var Ut=$t.map(function(jt){return jt.eigenvalue}).reduce(function(jt,Yt){return jt+Yt});return bn.map(function(jt){return jt.eigenvalue}).reduce(function(jt,Yt){return jt+Yt})/Ut},computeOriginalData:function($t,bn,Ut){var jt=Pn(wn(an(wn(bn),$t)),Ut);return{originalData:jt,formattedOriginalData:Vt(jt,2)}},computeVarianceCovariance:yt,computeAdjustedData:kt,getEigenVectors:Gt,analyseTopResult:function($t){var bn=Gt($t).sort(function(Ut,jt){return jt.eigenvalue-Ut.eigenvalue});return console.log("Sorted Vectors",bn),kt($t,bn[0].vector)},transpose:wn,multiply:an,clone:_n,scale:gn}}();j.exports=tt},701:function(j){var tt=[];function ot(Et){for(var kt=-1,Gt=0;Gt<tt.length;Gt++)if(tt[Gt].identifier===Et){kt=Gt;break}return kt}function b(Et,kt){for(var Gt={},Vt=[],an=0;an<Et.length;an++){var Pn=Et[an],gn=kt.base?Pn[0]+kt.base:Pn[0],dn=Gt[gn]||0,wn="".concat(gn," ").concat(dn);Gt[gn]=dn+1;var _n=ot(wn),$t={css:Pn[1],media:Pn[2],sourceMap:Pn[3],supports:Pn[4],layer:Pn[5]};if(_n!==-1)tt[_n].references++,tt[_n].updater($t);else{var bn=yt($t,kt);kt.byIndex=an,tt.splice(an,0,{identifier:wn,updater:bn,references:1})}Vt.push(wn)}return Vt}function yt(Et,kt){var Gt=kt.domAPI(kt);return Gt.update(Et),function(Vt){if(Vt){if(Vt.css===Et.css&&Vt.media===Et.media&&Vt.sourceMap===Et.sourceMap&&Vt.supports===Et.supports&&Vt.layer===Et.layer)return;Gt.update(Et=Vt)}else Gt.remove()}}j.exports=function(Et,kt){var Gt=b(Et=Et||[],kt=kt||{});return function(Vt){Vt=Vt||[];for(var an=0;an<Gt.length;an++){var Pn=ot(Gt[an]);tt[Pn].references--}for(var gn=b(Vt,kt),dn=0;dn<Gt.length;dn++){var wn=ot(Gt[dn]);tt[wn].references===0&&(tt[wn].updater(),tt.splice(wn,1))}Gt=gn}}},182:function(j){j.exports=function(tt){var ot=document.createElement("style");return tt.setAttributes(ot,tt.attributes),tt.insert(ot,tt.options),ot}},850:function(j,tt,ot){j.exports=function(b){var yt=ot.nc;yt&&b.setAttribute("nonce",yt)}},236:function(j){j.exports=function(tt){var ot=tt.insertStyleElement(tt);return{update:function(b){(function(yt,Et,kt){var Gt="";kt.supports&&(Gt+="@supports (".concat(kt.supports,") {")),kt.media&&(Gt+="@media ".concat(kt.media," {"));var Vt=kt.layer!==void 0;Vt&&(Gt+="@layer".concat(kt.layer.length>0?" ".concat(kt.layer):""," {")),Gt+=kt.css,Vt&&(Gt+="}"),kt.media&&(Gt+="}"),kt.supports&&(Gt+="}");var an=kt.sourceMap;an&&typeof btoa<"u"&&(Gt+=`
/`,Gt+="*# sourceMappingURL=data:application/json;base64,".concat(btoa(unescape(encodeURIComponent(JSON.stringify(an))))," *"),Gt+="/"),Et.styleTagTransform(Gt,yt,Et.options)})(ot,tt,b)},remove:function(){(function(b){if(b.parentNode===null)return!1;b.parentNode.removeChild(b)})(ot)}}}},213:function(j){j.exports=function(tt,ot){if(ot.styleSheet)ot.styleSheet.cssText=tt;else{for(;ot.firstChild;)ot.removeChild(ot.firstChild);ot.appendChild(document.createTextNode(tt))}}},1:function(j){j.exports=function(){var tt={820:function(Et,kt,Gt){var Vt=Gt(537),an=Gt.n(Vt),Pn=Gt(645),gn=Gt.n(Pn)()(an());gn.push([Et.id,`.treejs {
  -webkit-box-sizing: border-box;
          box-sizing: border-box;
  font-size: 14px;
  margin-left: -18px;
  -webkit-user-select: none;
     -moz-user-select: none;
      -ms-user-select: none;
          user-select: none;
}
.treejs *:after,
.treejs *:before {
  -webkit-box-sizing: border-box;
          box-sizing: border-box;
}
.treejs > .treejs-node {
  padding-left: 0;
}
.treejs .treejs-nodes {
  list-style: none;
  padding-left: 18px;
  margin: 0;
  overflow: hidden;
  -webkit-transition: height 150ms ease-out, opacity 150ms ease-out;
  -o-transition: height 150ms ease-out, opacity 150ms ease-out;
  transition: height 150ms ease-out, opacity 150ms ease-out;
}
.treejs .treejs-node {
  cursor: pointer;
  overflow: hidden;
}
.treejs .treejs-node.treejs-placeholder {
  padding-left: 18px;
}
.treejs .treejs-switcher {
  display: inline-block;
  vertical-align: middle;
  width: 20px;
  height: 20px;
  cursor: pointer;
  position: relative;
  -webkit-transition: -webkit-transform 150ms ease-out;
  transition: -webkit-transform 150ms ease-out;
  -o-transition: transform 150ms ease-out;
  transition: transform 150ms ease-out;
  transition: transform 150ms ease-out, -webkit-transform 150ms ease-out;
}
.treejs .treejs-switcher:before {
  position: absolute;
  top: 8px;
  left: 6px;
  display: block;
  content: ' ';
  border: 4px solid transparent;
  border-top: 4px solid rgba(245, 245, 245, 0.7);
  -webkit-transition: border-color 150ms;
  -o-transition: border-color 150ms;
  transition: border-color 150ms;
}
.treejs .treejs-switcher:hover:before {
  border-top: 4px solid rgba(245, 245, 245, 0.96);
}
.treejs .treejs-node__close > .treejs-switcher {
  -webkit-transform: rotate(-90deg);
      -ms-transform: rotate(-90deg);
          transform: rotate(-90deg);
}
.treejs .treejs-node__close > .treejs-nodes {
  height: 0;
}
.treejs .treejs-checkbox {
  display: inline-block;
  vertical-align: middle;
  width: 20px;
  height: 20px;
  cursor: pointer;
  position: relative;
}
.treejs .treejs-checkbox:before {
  -webkit-transition: all 0.3s;
  -o-transition: all 0.3s;
  transition: all 0.3s;
  cursor: pointer;
  position: absolute;
  top: 2px;
  content: ' ';
  display: block;
  width: 16px;
  height: 16px;
  border: 1px solid #d9d9d9;
  border-radius: 2px;
}
.treejs .treejs-checkbox:hover:before {
  -webkit-box-shadow: 0 0 2px 1px #1890ff;
          box-shadow: 0 0 2px 1px #1890ff;
}
.treejs .treejs-node__checked > .treejs-checkbox:before {
  background-color: #1890ff;
  border-color: #1890ff;
}
.treejs .treejs-node__checked > .treejs-checkbox:after {
  position: absolute;
  content: ' ';
  display: block;
  top: 4px;
  left: 5px;
  width: 5px;
  height: 9px;
  border: 2px solid #fff;
  border-top: none;
  border-left: none;
  -webkit-transform: rotate(45deg);
      -ms-transform: rotate(45deg);
          transform: rotate(45deg);
}
.treejs .treejs-node__halfchecked > .treejs-checkbox:before {
  background-color: #1890ff;
  border-color: #1890ff;
}
.treejs .treejs-node__halfchecked > .treejs-checkbox:after {
  position: absolute;
  content: ' ';
  display: block;
  top: 9px;
  left: 3px;
  width: 10px;
  height: 2px;
  background-color: #fff;
}
.treejs .treejs-node__disabled {
  cursor: not-allowed;
  color: rgba(255, 255, 255, 0.25);
}
.treejs .treejs-node__disabled .treejs-checkbox {
  cursor: not-allowed;
}
.treejs .treejs-node__disabled .treejs-checkbox:before {
  cursor: not-allowed;
  border-color: #d9d9d9 !important;
  background-color: #f5f5f5 !important;
}
.treejs .treejs-node__disabled .treejs-checkbox:hover:before {
  -webkit-box-shadow: none !important;
          box-shadow: none !important;
}
.treejs .treejs-node__disabled .treejs-node__checked > .treejs-checkbox:after {
  border-color: #d9d9d9;
}
.treejs .treejs-node__disabled .treejs-node__halfchecked > .treejs-checkbox:after {
  background-color: #d9d9d9;
}
.treejs .treejs-node__disabled.treejs-node__checked > .treejs-checkbox:after {
  border-color: #d9d9d9;
}
.treejs .treejs-node__disabled.treejs-node__halfchecked > .treejs-checkbox:after {
  background-color: #d9d9d9;
}
.treejs .treejs-label {
  vertical-align: middle;
}
`,"",{version:3,sources:["webpack://./src/index.less"],names:[],mappings:"AAKA;EACE,8BAAA;UAAA,sBAAA;EACA,eAAA;EACA,kBAAA;EACA,yBAAA;KAAA,sBAAA;MAAA,qBAAA;UAAA,iBAAA;AAJF;AAAA;;EAQI,8BAAA;UAAA,sBAAA;AAJJ;AAOE;EACE,eAAA;AALJ;AAPA;EAgBI,gBAAA;EACA,kBAAA;EACA,SAAA;EACA,gBAAA;EACA,iEAAA;EAAA,4DAAA;EAAA,yDAAA;AANJ;AAdA;EAwBI,eAAA;EACA,gBAAA;AAPJ;AASI;EACE,kBAAA;AAPN;AArBA;EAiCI,qBAAA;EACA,sBAAA;EACA,WAAA;EACA,YAAA;EACA,eAAA;EACA,kBAAA;EACA,oDAAA;EAAA,4CAAA;EAAA,uCAAA;EAAA,oCAAA;EAAA,sEAAA;AATJ;AAWI;EACE,kBAAA;EACA,QAAA;EACA,SAAA;EACA,cAAA;EACA,YAAA;EACA,6BAAA;EACA,8CAAA;EACA,sCAAA;EAAA,iCAAA;EAAA,8BAAA;AATN;AAWI;EACE,+CAAA;AATN;AA3CA;EAwDI,iCAAA;MAAA,6BAAA;UAAA,yBAAA;AAVJ;AA9CA;EA2DI,SAAA;AAVJ;AAjDA;EA+DI,qBAAA;EACA,sBAAA;EACA,WAAA;EACA,YAAA;EACA,eAAA;EACA,kBAAA;AAXJ;AAaI;EACE,4BAAA;EAAA,uBAAA;EAAA,oBAAA;EACA,eAAA;EACA,kBAAA;EACA,QAAA;EACA,YAAA;EACA,cAAA;EACA,WAAA;EACA,YAAA;EACA,yBAAA;EACA,kBAAA;AAXN;AAaI;EACE,uCAAA;UAAA,+BAAA;AAXN;AAgBM;EACE,yBAAA;EACA,qBAAA;AAdR;AAgBM;EACE,kBAAA;EACA,YAAA;EACA,cAAA;EACA,QAAA;EACA,SAAA;EACA,UAAA;EACA,WAAA;EACA,sBAAA;EACA,gBAAA;EACA,iBAAA;EACA,gCAAA;MAAA,4BAAA;UAAA,wBAAA;AAdR;AAoBM;EACE,yBAAA;EACA,qBAAA;AAlBR;AAoBM;EACE,kBAAA;EACA,YAAA;EACA,cAAA;EACA,QAAA;EACA,SAAA;EACA,WAAA;EACA,WAAA;EACA,sBAAA;AAlBR;AAvGA;EA+HI,mBAAA;EACA,gCAAA;AArBJ;AA3GA;EAkIM,mBAAA;AApBN;AAqBM;EACE,mBAAA;EACA,gCAAA;EACA,oCAAA;AAnBR;AAqBM;EACE,mCAAA;UAAA,2BAAA;AAnBR;AAwBQ;EACE,qBAAA;AAtBV;AA4BQ;EACE,yBAAA;AA1BV;AAiCM;EACE,qBAAA;AA/BR;AAqCM;EACE,yBAAA;AAnCR;AAlIA;EA2KI,sBAAA;AAtCJ",sourcesContent:[`@color-disable: #d4d4d4;
@bgcolor-disable: #f5f5f5;
@greyborder: #d9d9d9;
@bluebg: #1890ff;

.treejs {
  box-sizing: border-box;
  font-size: 14px;
  margin-left: -18px;
  user-select: none;

  *:after,
  *:before {
    box-sizing: border-box;
  }

  & > .treejs-node {
    padding-left: 0;
  }

  .treejs-nodes {
    list-style: none;
    padding-left: 18px;
    margin: 0; //  for default ul...
    overflow: hidden;
    transition: height 150ms ease-out, opacity 150ms ease-out;
  }

  .treejs-node {
    cursor: pointer;
    overflow: hidden;

    &.treejs-placeholder {
      padding-left: 18px;
    }
  }

  .treejs-switcher {
    display: inline-block;
    vertical-align: middle;
    width: 20px;
    height: 20px;
    cursor: pointer;
    position: relative;
    transition: transform 150ms ease-out;

    &:before {
      position: absolute;
      top: 8px;
      left: 6px;
      display: block;
      content: ' ';
      border: 4px solid transparent;
      border-top: 4px solid rgba(245, 245, 245, 0.7);
      transition: border-color 150ms;
    }
    &:hover:before {
      border-top: 4px solid rgba(245, 245, 245, 0.96);
    }
  }
  .treejs-node__close > .treejs-switcher {
    transform: rotate(-90deg);
  }
  .treejs-node__close > .treejs-nodes {
    height: 0;
  }

  .treejs-checkbox {
    display: inline-block;
    vertical-align: middle;
    width: 20px;
    height: 20px;
    cursor: pointer;
    position: relative;

    &:before {
      transition: all 0.3s;
      cursor: pointer;
      position: absolute;
      top: 2px;
      content: ' ';
      display: block;
      width: 16px;
      height: 16px;
      border: 1px solid @greyborder;
      border-radius: 2px;
    }
    &:hover:before {
      box-shadow: 0 0 2px 1px @bluebg;
    }
  }
  .treejs-node__checked {
    & > .treejs-checkbox {
      &:before {
        background-color: @bluebg;
        border-color: @bluebg;
      }
      &:after {
        position: absolute;
        content: ' ';
        display: block;
        top: 4px;
        left: 5px;
        width: 5px;
        height: 9px;
        border: 2px solid #fff;
        border-top: none;
        border-left: none;
        transform: rotate(45deg);
      }
    }
  }
  .treejs-node__halfchecked {
    & > .treejs-checkbox {
      &:before {
        background-color: @bluebg;
        border-color: @bluebg;
      }
      &:after {
        position: absolute;
        content: ' ';
        display: block;
        top: 9px;
        left: 3px;
        width: 10px;
        height: 2px;
        background-color: #fff;
      }
    }
  }

  .treejs-node__disabled {
    cursor: not-allowed;
    color: rgba(255, 255, 255, 0.25);
    .treejs-checkbox {
      cursor: not-allowed;
      &:before {
        cursor: not-allowed;
        border-color: @greyborder !important;
        background-color: @bgcolor-disable !important;
      }
      &:hover:before {
        box-shadow: none !important;
      }
    }
    .treejs-node__checked {
      & > .treejs-checkbox {
        &:after {
          border-color: @greyborder;
        }
      }
    }
    .treejs-node__halfchecked {
      & > .treejs-checkbox {
        &:after {
          background-color: @greyborder;
        }
      }
    }
  }
  .treejs-node__disabled.treejs-node__checked {
    & > .treejs-checkbox {
      &:after {
        border-color: @greyborder;
      }
    }
  }
  .treejs-node__disabled.treejs-node__halfchecked {
    & > .treejs-checkbox {
      &:after {
        background-color: @greyborder;
      }
    }
  }

  .treejs-label {
    vertical-align: middle;
  }
}
`],sourceRoot:""}]),kt.Z=gn},645:function(Et){Et.exports=function(kt){var Gt=[];return Gt.toString=function(){return this.map(function(Vt){var an="",Pn=Vt[5]!==void 0;return Vt[4]&&(an+="@supports (".concat(Vt[4],") {")),Vt[2]&&(an+="@media ".concat(Vt[2]," {")),Pn&&(an+="@layer".concat(Vt[5].length>0?" ".concat(Vt[5]):""," {")),an+=kt(Vt),Pn&&(an+="}"),Vt[2]&&(an+="}"),Vt[4]&&(an+="}"),an}).join("")},Gt.i=function(Vt,an,Pn,gn,dn){typeof Vt=="string"&&(Vt=[[null,Vt,void 0]]);var wn={};if(Pn)for(var _n=0;_n<this.length;_n++){var $t=this[_n][0];$t!=null&&(wn[$t]=!0)}for(var bn=0;bn<Vt.length;bn++){var Ut=[].concat(Vt[bn]);Pn&&wn[Ut[0]]||(dn!==void 0&&(Ut[5]===void 0||(Ut[1]="@layer".concat(Ut[5].length>0?" ".concat(Ut[5]):""," {").concat(Ut[1],"}")),Ut[5]=dn),an&&(Ut[2]&&(Ut[1]="@media ".concat(Ut[2]," {").concat(Ut[1],"}")),Ut[2]=an),gn&&(Ut[4]?(Ut[1]="@supports (".concat(Ut[4],") {").concat(Ut[1],"}"),Ut[4]=gn):Ut[4]="".concat(gn)),Gt.push(Ut))}},Gt}},537:function(Et){Et.exports=function(kt){var Gt=kt[1],Vt=kt[3];if(!Vt)return Gt;if(typeof btoa=="function"){var an=btoa(unescape(encodeURIComponent(JSON.stringify(Vt)))),Pn="sourceMappingURL=data:application/json;charset=utf-8;base64,".concat(an),gn="/*# ".concat(Pn," */"),dn=Vt.sources.map(function(wn){return"/*# sourceURL=".concat(Vt.sourceRoot||"").concat(wn," */")});return[Gt].concat(dn).concat([gn]).join(`
`)}return[Gt].join(`
`)}},379:function(Et){var kt=[];function Gt(Pn){for(var gn=-1,dn=0;dn<kt.length;dn++)if(kt[dn].identifier===Pn){gn=dn;break}return gn}function Vt(Pn,gn){for(var dn={},wn=[],_n=0;_n<Pn.length;_n++){var $t=Pn[_n],bn=gn.base?$t[0]+gn.base:$t[0],Ut=dn[bn]||0,jt="".concat(bn," ").concat(Ut);dn[bn]=Ut+1;var Yt=Gt(jt),Bn={css:$t[1],media:$t[2],sourceMap:$t[3],supports:$t[4],layer:$t[5]};if(Yt!==-1)kt[Yt].references++,kt[Yt].updater(Bn);else{var un=an(Bn,gn);gn.byIndex=_n,kt.splice(_n,0,{identifier:jt,updater:un,references:1})}wn.push(jt)}return wn}function an(Pn,gn){var dn=gn.domAPI(gn);return dn.update(Pn),function(wn){if(wn){if(wn.css===Pn.css&&wn.media===Pn.media&&wn.sourceMap===Pn.sourceMap&&wn.supports===Pn.supports&&wn.layer===Pn.layer)return;dn.update(Pn=wn)}else dn.remove()}}Et.exports=function(Pn,gn){var dn=Vt(Pn=Pn||[],gn=gn||{});return function(wn){wn=wn||[];for(var _n=0;_n<dn.length;_n++){var $t=Gt(dn[_n]);kt[$t].references--}for(var bn=Vt(wn,gn),Ut=0;Ut<dn.length;Ut++){var jt=Gt(dn[Ut]);kt[jt].references===0&&(kt[jt].updater(),kt.splice(jt,1))}dn=bn}}},216:function(Et){Et.exports=function(kt){var Gt=document.createElement("style");return kt.setAttributes(Gt,kt.attributes),kt.insert(Gt,kt.options),Gt}},636:function(Et,kt,Gt){Et.exports=function(Vt){var an=Gt.nc;an&&Vt.setAttribute("nonce",an)}},795:function(Et){Et.exports=function(kt){var Gt=kt.insertStyleElement(kt);return{update:function(Vt){(function(an,Pn,gn){var dn="";gn.supports&&(dn+="@supports (".concat(gn.supports,") {")),gn.media&&(dn+="@media ".concat(gn.media," {"));var wn=gn.layer!==void 0;wn&&(dn+="@layer".concat(gn.layer.length>0?" ".concat(gn.layer):""," {")),dn+=gn.css,wn&&(dn+="}"),gn.media&&(dn+="}"),gn.supports&&(dn+="}");var _n=gn.sourceMap;_n&&typeof btoa<"u"&&(dn+=`
/`,dn+="*# sourceMappingURL=data:application/json;base64,".concat(btoa(unescape(encodeURIComponent(JSON.stringify(_n))))," *"),dn+="/"),Pn.styleTagTransform(dn,an,Pn.options)})(Gt,kt,Vt)},remove:function(){(function(Vt){if(Vt.parentNode===null)return!1;Vt.parentNode.removeChild(Vt)})(Gt)}}}},589:function(Et){Et.exports=function(kt,Gt){if(Gt.styleSheet)Gt.styleSheet.cssText=kt;else{for(;Gt.firstChild;)Gt.removeChild(Gt.firstChild);Gt.appendChild(document.createTextNode(kt))}}}},ot={};function b(Et){var kt=ot[Et];if(kt!==void 0)return kt.exports;var Gt=ot[Et]={id:Et,exports:{}};return tt[Et](Gt,Gt.exports,b),Gt.exports}b.n=function(Et){var kt=Et&&Et.__esModule?function(){return Et.default}:function(){return Et};return b.d(kt,{a:kt}),kt},b.d=function(Et,kt){for(var Gt in kt)b.o(kt,Gt)&&!b.o(Et,Gt)&&Object.defineProperty(Et,Gt,{enumerable:!0,get:kt[Gt]})},b.o=function(Et,kt){return Object.prototype.hasOwnProperty.call(Et,kt)},b.nc=void 0;var yt={};return function(){b.d(yt,{default:function(){return Vr}});var Et=b(379),kt=b.n(Et),Gt=b(795),Vt=b.n(Gt),an=b(636),Pn=b.n(an),gn=b(216),dn=b.n(gn),wn=b(589),_n=b.n(wn),$t=b(820),bn={};$t.Z&&$t.Z.locals&&(bn.locals=$t.Z.locals);var Ut,jt=0,Yt={};Yt.styleTagTransform=_n(),Yt.setAttributes=Pn(),Yt.insert=function(yr,Hr){(Hr.target||document.head).appendChild(yr)},Yt.domAPI=Vt(),Yt.insertStyleElement=dn(),bn.use=function(yr){return Yt.options=yr||{},jt++||(Ut=kt()($t.Z,Yt)),bn},bn.unuse=function(){jt>0&&!--jt&&(Ut(),Ut=null)};var Bn=bn;function un(yr,Hr){return function(Xn){if(Array.isArray(Xn))return Xn}(yr)||function(Xn,ir){var zn=Xn==null?null:typeof Symbol<"u"&&Xn[Symbol.iterator]||Xn["@@iterator"];if(zn!=null){var nr,$n,Er=[],Yn=!0,Kt=!1;try{for(zn=zn.call(Xn);!(Yn=(nr=zn.next()).done)&&(Er.push(nr.value),!ir||Er.length!==ir);Yn=!0);}catch(rn){Kt=!0,$n=rn}finally{try{Yn||zn.return==null||zn.return()}finally{if(Kt)throw $n}}return Er}}(yr,Hr)||function(Xn,ir){if(Xn){if(typeof Xn=="string")return Cn(Xn,ir);var zn=Object.prototype.toString.call(Xn).slice(8,-1);return zn==="Object"&&Xn.constructor&&(zn=Xn.constructor.name),zn==="Map"||zn==="Set"?Array.from(Xn):zn==="Arguments"||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(zn)?Cn(Xn,ir):void 0}}(yr,Hr)||function(){throw new TypeError(`Invalid attempt to destructure non-iterable instance.
In order to be iterable, non-array objects must have a [Symbol.iterator]() method.`)}()}function Cn(yr,Hr){(Hr==null||Hr>yr.length)&&(Hr=yr.length);for(var Xn=0,ir=new Array(Hr);Xn<Hr;Xn++)ir[Xn]=yr[Xn];return ir}function Qt(yr,Hr){var Xn=Object.keys(yr);if(Object.getOwnPropertySymbols){var ir=Object.getOwnPropertySymbols(yr);Hr&&(ir=ir.filter(function(zn){return Object.getOwnPropertyDescriptor(yr,zn).enumerable})),Xn.push.apply(Xn,ir)}return Xn}function Wt(yr){for(var Hr=1;Hr<arguments.length;Hr++){var Xn=arguments[Hr]!=null?arguments[Hr]:{};Hr%2?Qt(Object(Xn),!0).forEach(function(ir){Zt(yr,ir,Xn[ir])}):Object.getOwnPropertyDescriptors?Object.defineProperties(yr,Object.getOwnPropertyDescriptors(Xn)):Qt(Object(Xn)).forEach(function(ir){Object.defineProperty(yr,ir,Object.getOwnPropertyDescriptor(Xn,ir))})}return yr}function Zt(yr,Hr,Xn){return Hr in yr?Object.defineProperty(yr,Hr,{value:Xn,enumerable:!0,configurable:!0,writable:!0}):yr[Hr]=Xn,yr}function En(yr,Hr){for(var Xn=0;Xn<Hr.length;Xn++){var ir=Hr[Xn];ir.enumerable=ir.enumerable||!1,ir.configurable=!0,"value"in ir&&(ir.writable=!0),Object.defineProperty(yr,ir.key,ir)}}function pn(yr){var Hr={};return yr.reduce(function(Xn,ir){return Hr[ir]||(Hr[ir]=!0,Xn.push(ir)),Xn},[])}function er(yr,Hr){requestAnimationFrame(function(){Hr.enter(),requestAnimationFrame(function(){Hr.active(),setTimeout(function(){Hr.leave()},yr)})})}function Ir(yr,Hr){try{var Xn=yr.liElementsById[Hr.parent.id];Xn.classList.contains("treejs-node__close")||Xn.getElementsByClassName("treejs-switcher")[0].click()}catch{return}Object.prototype.hasOwnProperty.call(Hr,"parent")&&Ir(yr,Hr.parent)}function Dr(yr,Hr){var Xn=yr.liElementsById[Hr.id];Xn.classList.contains("treejs-node__close")&&Xn.getElementsByClassName("treejs-switcher")[0].click(),Object.prototype.hasOwnProperty.call(Hr,"children")&&Hr.children.forEach(function(ir){return Dr(yr,ir)})}var Vr=function(){function yr(zn,nr){(function($n,Er){if(!($n instanceof Er))throw new TypeError("Cannot call a class as a function")})(this,yr),Bn.use({target:typeof this.container=="string"?document.querySelector(this.container):this.container}),this.treeNodes=[],this.nodesById={},this.leafNodesById={},this.liElementsById={},this.willUpdateNodesById={},this.container=zn,this.options=Object.assign({values:[],disables:[],loaded:null,closeDepth:null},nr),Object.defineProperties(this,{values:{get:function(){return this.getValues()},set:function($n){this.setValues(pn($n))}},disables:{get:function(){return this.getDisables()},set:function($n){this.setDisables(pn($n))}},selectedNodes:{get:function(){var $n=[],Er=this.nodesById;return Object.keys(Er).forEach(function(Yn){if(Object.prototype.hasOwnProperty.call(Er,Yn)&&(Er[Yn].status===1||Er[Yn].status===2)){var Kt=Wt({},Er[Yn]);delete Kt.parent,delete Kt.children,$n.push(Kt)}}),$n}},disabledNodes:{get:function(){var $n=[],Er=this.nodesById;return Object.keys(Er).forEach(function(Yn){if(Object.prototype.hasOwnProperty.call(Er,Yn)&&Er[Yn].disabled){var Kt=Wt({},Er[Yn]);delete Kt.parent,$n.push(Kt)}}),$n}}}),this.init(this.options.data)}var Hr,Xn,ir;return Hr=yr,ir=[{key:"onSwitcherClick",value:function(zn){var nr=zn.parentNode,$n=nr.lastChild,Er=$n.scrollHeight;nr.classList.contains("treejs-node__close")?er(150,{enter:function(){$n.style.height=0,$n.style.opacity=0},active:function(){$n.style.height="".concat(Er,"px"),$n.style.opacity=1},leave:function(){$n.style.height="",$n.style.opacity="",nr.classList.remove("treejs-node__close")}}):er(150,{enter:function(){$n.style.height="".concat(Er,"px"),$n.style.opacity=1},active:function(){$n.style.height=0,$n.style.opacity=0},leave:function(){$n.style.height="",$n.style.opacity="",nr.classList.add("treejs-node__close")}})}},{key:"parseTreeData",value:function(zn){var nr,$n=(nr=zn,JSON.parse(JSON.stringify(nr))),Er={},Yn={},Kt=[],rn=[];return function jn(Ur,kr){Ur.forEach(function(zr){Er[zr.id]=zr,zr.checked&&Kt.push(zr.id),zr.disabled&&rn.push(zr.id),kr&&(zr.parent=kr),zr.children&&zr.children.length?jn(zr.children,zr):Yn[zr.id]=zr})}($n),{treeNodes:$n,nodesById:Er,leafNodesById:Yn,defaultValues:Kt,defaultDisables:rn}}},{key:"createRootEle",value:function(){var zn=document.createElement("div");return zn.classList.add("treejs"),zn}},{key:"createUlEle",value:function(){var zn=document.createElement("ul");return zn.classList.add("treejs-nodes"),zn}},{key:"createLiEle",value:function(zn,nr){var $n=document.createElement("li");if($n.classList.add("treejs-node"),nr&&$n.classList.add("treejs-node__close"),zn.children&&zn.children.length){var Er=document.createElement("span");Er.classList.add("treejs-switcher"),$n.appendChild(Er)}else $n.classList.add("treejs-placeholder");var Yn=document.createElement("span");Yn.classList.add("treejs-checkbox"),$n.appendChild(Yn);var Kt=document.createElement("span");Kt.classList.add("treejs-label");var rn=document.createTextNode(zn.text);return Kt.appendChild(rn),$n.appendChild(Kt),$n.nodeId=zn.id,$n}}],(Xn=[{key:"init",value:function(zn){var nr=yr.parseTreeData(zn),$n=nr.treeNodes,Er=nr.nodesById,Yn=nr.leafNodesById,Kt=nr.defaultValues,rn=nr.defaultDisables;this.treeNodes=$n,this.nodesById=Er,this.leafNodesById=Yn,this.render(this.treeNodes);var jn=this.options,Ur=jn.values,kr=jn.disables,zr=jn.loaded;Ur&&Ur.length?this.setValues(Ur):Kt&&Kt.length&&this.setValues(Kt),kr&&kr.length?this.setDisables(kr):rn&&rn.length&&this.setDisables(rn),typeof zr=="function"&&zr.call(this)}},{key:"render",value:function(zn){var nr=yr.createRootEle();nr.appendChild(this.buildTree(zn,0)),this.bindEvent(nr);var $n=typeof this.container=="string"?document.querySelector(this.container):this.container;(function(Er){for(;Er.firstChild;)Er.removeChild(Er.firstChild)})($n),$n.appendChild(nr)}},{key:"buildTree",value:function(zn,nr){var $n=this,Er=yr.createUlEle();return zn&&zn.length&&zn.forEach(function(Yn){var Kt=yr.createLiEle(Yn,nr===$n.options.closeDepth-1);$n.liElementsById[Yn.id]=Kt;var rn=null;Yn.children&&Yn.children.length&&(rn=$n.buildTree(Yn.children,nr+1)),rn&&Kt.appendChild(rn),Er.appendChild(Kt)}),Er}},{key:"bindEvent",value:function(zn){var nr=this;zn.addEventListener("click",function($n){var Er=$n.target;Er.nodeName==="SPAN"&&Er.classList.contains("treejs-checkbox")?nr.onItemClick(Er.parentNode.nodeId):Er.nodeName==="SPAN"&&Er.classList.contains("treejs-label")?nr.onItemLabelClick(Er.parentNode.nodeId):Er.nodeName==="LI"&&Er.classList.contains("treejs-node")?nr.onItemClick(Er.nodeId):Er.nodeName==="SPAN"&&Er.classList.contains("treejs-switcher")&&yr.onSwitcherClick(Er)},!1)}},{key:"onItemClick",value:function(zn){var nr=this.nodesById[zn],$n=this.options.onChange;nr.disabled||(this.setValue(zn),this.updateLiElements()),$n&&$n.call(this)}},{key:"onItemLabelClick",value:function(zn){var nr=this.options.onItemLabelClick;nr&&nr.call(this,zn)}},{key:"setValue",value:function(zn){var nr=this.nodesById[zn];if(nr){var $n=nr.status,Er=$n===1||$n===2?0:2;nr.status=Er,this.markWillUpdateNode(nr),this.walkUp(nr,"status"),this.walkDown(nr,"status")}}},{key:"getValues",value:function(){var zn=this,nr=[];return Object.keys(this.leafNodesById).forEach(function($n){Object.prototype.hasOwnProperty.call(zn.leafNodesById,$n)&&(zn.leafNodesById[$n].status!==1&&zn.leafNodesById[$n].status!==2||nr.push($n))}),nr}},{key:"setValues",value:function(zn){var nr=this;this.emptyNodesCheckStatus(),zn.forEach(function(Er){nr.setValue(Er)}),this.updateLiElements();var $n=this.options.onChange;$n&&$n.call(this)}},{key:"setDisable",value:function(zn){var nr=this.nodesById[zn];nr&&(nr.disabled||(nr.disabled=!0,this.markWillUpdateNode(nr),this.walkUp(nr,"disabled"),this.walkDown(nr,"disabled")))}},{key:"getDisables",value:function(){var zn=this,nr=[];return Object.keys(this.leafNodesById).forEach(function($n){Object.prototype.hasOwnProperty.call(zn.leafNodesById,$n)&&zn.leafNodesById[$n].disabled&&nr.push($n)}),nr}},{key:"setDisables",value:function(zn){var nr=this;this.emptyNodesDisable(),zn.forEach(function($n){nr.setDisable($n)}),this.updateLiElements()}},{key:"emptyNodesCheckStatus",value:function(){this.willUpdateNodesById=this.getSelectedNodesById(),Object.values(this.willUpdateNodesById).forEach(function(zn){zn.disabled||(zn.status=0)})}},{key:"emptyNodesDisable",value:function(){this.willUpdateNodesById=this.getDisabledNodesById(),Object.values(this.willUpdateNodesById).forEach(function(zn){zn.disabled=!1})}},{key:"getSelectedNodesById",value:function(){return Object.entries(this.nodesById).reduce(function(zn,nr){var $n=un(nr,2),Er=$n[0],Yn=$n[1];return Yn.status!==1&&Yn.status!==2||(zn[Er]=Yn),zn},{})}},{key:"getDisabledNodesById",value:function(){return Object.entries(this.nodesById).reduce(function(zn,nr){var $n=un(nr,2),Er=$n[0],Yn=$n[1];return Yn.disabled&&(zn[Er]=Yn),zn},{})}},{key:"updateLiElements",value:function(){var zn=this;Object.values(this.willUpdateNodesById).forEach(function(nr){zn.updateLiElement(nr)}),this.willUpdateNodesById={}}},{key:"markWillUpdateNode",value:function(zn){this.willUpdateNodesById[zn.id]=zn}},{key:"walkUp",value:function(zn,nr){var $n=zn.parent;if($n){if(nr==="status"){var Er,Yn=$n.children.reduce(function(rn,jn){return Number.isNaN(jn.status)?rn:rn+jn.status},0);if(Er=Yn?Yn===2*$n.children.length?2:1:0,$n.status===Er)return;$n.status=Er}else{var Kt=$n.children.reduce(function(rn,jn){return rn&&jn.disabled},!0);if($n.disabled===Kt)return;$n.disabled=Kt}this.markWillUpdateNode($n),this.walkUp($n,nr)}}},{key:"walkDown",value:function(zn,nr){var $n=this;zn.children&&zn.children.length&&zn.children.forEach(function(Er){nr==="status"&&Er.disabled||(Er[nr]=zn[nr],$n.markWillUpdateNode(Er),$n.walkDown(Er,nr))})}},{key:"updateLiElement",value:function(zn){var nr=this.liElementsById[zn.id].classList;switch(zn.status){case 0:nr.remove("treejs-node__halfchecked","treejs-node__checked");break;case 1:nr.remove("treejs-node__checked"),nr.add("treejs-node__halfchecked");break;case 2:nr.remove("treejs-node__halfchecked"),nr.add("treejs-node__checked")}switch(zn.disabled){case!0:nr.contains("treejs-node__disabled")||nr.add("treejs-node__disabled");break;case!1:nr.contains("treejs-node__disabled")&&nr.remove("treejs-node__disabled")}}},{key:"collapseAll",value:function(){var zn=this;Object.keys(this.leafNodesById).forEach(function(nr){var $n=zn.leafNodesById[nr];Ir(zn,$n)})}},{key:"expandAll",value:function(){Dr(this,this.treeNodes[0])}}])&&En(Hr.prototype,Xn),ir&&En(Hr,ir),Object.defineProperty(Hr,"prototype",{writable:!1}),yr}()}(),yt.default}()},819:function(j,tt){(function(ot){const b="tp";function yt(bn){return Ut=>jt=>{if(!Ut&&jt===void 0)return{succeeded:!1,value:void 0};if(Ut&&jt===void 0)return{succeeded:!0,value:void 0};const Yt=bn(jt);return Yt!==void 0?{succeeded:!0,value:Yt}:{succeeded:!1,value:void 0}}}function Et(bn){return{custom:Ut=>yt(Ut)(bn),boolean:yt(Ut=>typeof Ut=="boolean"?Ut:void 0)(bn),number:yt(Ut=>typeof Ut=="number"?Ut:void 0)(bn),string:yt(Ut=>typeof Ut=="string"?Ut:void 0)(bn),function:yt(Ut=>typeof Ut=="function"?Ut:void 0)(bn),constant:Ut=>yt(jt=>jt===Ut?Ut:void 0)(bn),raw:yt(Ut=>Ut)(bn),object:Ut=>yt(jt=>{if((Yt=jt)!==null&&typeof Yt=="object")return function(Bn,un){return Object.keys(un).reduce((Cn,Qt)=>{if(Cn===void 0)return;const Wt=(0,un[Qt])(Bn[Qt]);return Wt.succeeded?Object.assign(Object.assign({},Cn),{[Qt]:Wt.value}):void 0},{})}(jt,Ut);var Yt})(bn),array:Ut=>yt(jt=>{if(Array.isArray(jt))return Yt=Ut,jt.reduce((Bn,un)=>{if(Bn===void 0)return;const Cn=Yt(un);return Cn.succeeded&&Cn.value!==void 0?[...Bn,Cn.value]:void 0},[]);var Yt})(bn)}}const kt={optional:Et(!0),required:Et(!1)};function Gt(bn,Ut,jt,Yt){return new(jt||(jt=Promise))(function(Bn,un){function Cn(Zt){try{Wt(Yt.next(Zt))}catch(En){un(En)}}function Qt(Zt){try{Wt(Yt.throw(Zt))}catch(En){un(En)}}function Wt(Zt){var En;Zt.done?Bn(Zt.value):(En=Zt.value,En instanceof jt?En:new jt(function(pn){pn(En)})).then(Cn,Qt)}Wt((Yt=Yt.apply(bn,Ut||[])).next())})}function Vt(bn){return Gt(this,void 0,void 0,function*(){const Ut=new Image;return Ut.crossOrigin="anonymous",new Promise((jt,Yt)=>{Ut.src=bn,Ut.onload=()=>{jt(Ut)},Ut.onerror=Yt})})}const an=(Pn="img",(bn,Ut)=>[b,"-",Pn,"v",bn?`_${bn}`:"",Ut?`-${Ut}`:""].join(""));var Pn;class gn{constructor(Ut,jt){this.element=Ut.createElement("div"),this.element.classList.add(an()),jt.viewProps.bindClassModifiers(this.element),this.input=Ut.createElement("input"),this.input.classList.add(an("input")),this.input.setAttribute("type","file"),this.input.setAttribute("accept",jt.extensions.join(",")),this.image_=Ut.createElement("img"),this.image_.classList.add(an("image")),this.image_.classList.add(an(`image_${jt.imageFit}`)),this.image_.crossOrigin="anonymous",this.image_.onclick=Yt=>{jt.clickCallback?jt.clickCallback(Yt,this.input):this.input.click()},this.element.classList.add(an("area_root")),this.element.appendChild(this.image_),this.element.appendChild(this.input)}changeImage(Ut){this.image_.src=Ut}changeDraggingState(Ut){const jt=this.element;Ut?jt==null||jt.classList.add(an("area_dragging")):jt==null||jt.classList.remove(an("area_dragging"))}}let dn=null;class wn{constructor(Ut,jt){this.value=jt.value,this.viewProps=jt.viewProps,this.view=new gn(Ut,{viewProps:this.viewProps,extensions:jt.extensions,imageFit:jt.imageFit,clickCallback:jt.clickCallback}),this.onFile=this.onFile.bind(this),this.onDrop=this.onDrop.bind(this),this.onDragOver=this.onDragOver.bind(this),this.onDragLeave=this.onDragLeave.bind(this),this.view.input.addEventListener("change",this.onFile),this.view.element.addEventListener("drop",this.onDrop),this.view.element.addEventListener("dragover",this.onDragOver),this.view.element.addEventListener("dragleave",this.onDragLeave),this.viewProps.handleDispose(()=>{this.view.input.removeEventListener("change",this.onFile),this.view.input.removeEventListener("drop",this.onDrop),this.view.input.removeEventListener("dragover",this.onDragOver),this.view.input.removeEventListener("dragleave",this.onDragLeave)}),this.value.emitter.on("change",this.handleValueChange.bind(this)),this.handleValueChange()}onFile(Ut){const jt=(Ut==null?void 0:Ut.target).files;if(!jt||!jt.length)return;const Yt=jt[0];this.setValue(Yt)}onDrop(Ut){return Gt(this,void 0,void 0,function*(){Ut.preventDefault();try{const{dataTransfer:jt}=Ut,Yt=jt==null?void 0:jt.files[0];if(Yt)this.setValue(Yt);else{const Bn=jt==null?void 0:jt.getData("url");if(!Bn)throw new Error("No url");this.setValue(Bn)}}catch(jt){console.error("Could not parse the dropped image",jt)}finally{this.view.changeDraggingState(!1)}})}onDragOver(Ut){Ut.preventDefault(),this.view.changeDraggingState(!0)}onDragLeave(){this.view.changeDraggingState(!1)}handleImage(Ut){return Gt(this,void 0,void 0,function*(){Ut instanceof HTMLImageElement?this.updateImage(Ut.src):typeof Ut!="string"&&Ut?yield this.setValue(Ut):(Ut!=="placeholder"&&Ut||(Ut=(yield this.handlePlaceholderImage()).src),this.updateImage(Ut))})}updateImage(Ut){this.view.changeImage(Ut)}setValue(Ut){return Gt(this,void 0,void 0,function*(){if(Ut instanceof HTMLImageElement)this.value.setRawValue(Ut);else if(Ut instanceof File){const jt=URL.createObjectURL(Ut)+"#"+Ut.name;Ut.src=jt;const Yt=yield Vt(jt).catch(()=>{});this.value.setRawValue(Yt||Ut)}else Ut?this.value.setRawValue(yield Vt(Ut)):this.value.setRawValue(yield this.handlePlaceholderImage())})}handleValueChange(){this.handleImage(this.value.rawValue)}handlePlaceholderImage(){return Gt(this,void 0,void 0,function*(){return dn||(dn=yield function(){const Ut=document.createElement("canvas");Ut.width=320,Ut.height=50;const jt=Ut.getContext("2d");return jt.fillStyle="#00000004",jt.fillRect(0,0,Ut.width,Ut.height),jt.fillStyle="#eee",jt.font='1.25rem "Roboto Mono", "Source Code Pro", Menlo, Courier, monospace',jt.textAlign="center",jt.textBaseline="middle",jt.fillText("No image",.5*Ut.width,.5*Ut.height),new Promise(Yt=>{Ut.toBlob(Bn=>{const un=new Image;un.src=URL.createObjectURL(Bn),un.isPlaceholder=!0,un.onload=()=>{Yt(un)}})})}()),dn})}}const _n=[".jpg",".png",".gif"],$t={id:"input-image",type:"input",css:".tp-imgv{-webkit-appearance:none;-moz-appearance:none;appearance:none;background-color:transparent;border-width:0;font-family:inherit;font-size:inherit;font-weight:inherit;margin:0;outline:none;padding:0}.tp-imgv{background-color:var(--in-bg);border-radius:var(--elm-br);box-sizing:border-box;color:var(--in-fg);font-family:inherit;height:var(--bld-us);line-height:var(--bld-us);min-width:0;width:100%}.tp-imgv:hover{background-color:var(--in-bg-h)}.tp-imgv:focus{background-color:var(--in-bg-f)}.tp-imgv:active{background-color:var(--in-bg-a)}.tp-imgv:disabled{opacity:0.5}:root{--tp-plugin-image-dragging-color: hsla(230, 100%, 66%, 1.00)}.tp-imgv{cursor:pointer;display:inline-flex;height:auto !important;max-height:calc(var(--bld-us) * 3);border-radius:4px;position:relative}.tp-imgv.tp-v-disabled{opacity:0.5}.tp-imgv_input{width:0;height:0;pointer-events:none;visibility:hidden}.tp-imgv_image{width:100%;height:-webkit-max-content;height:-moz-max-content;height:max-content;max-height:calc(var(--bld-us) * 3);border:0}.tp-imgv_image_contain{-o-object-fit:contain;object-fit:contain}.tp-imgv_image_cover{-o-object-fit:cover;object-fit:cover}.tp-imgv_area_root{transition:opacity 0.16s ease-in-out}.tp-imgv_area_dragging{border:2px dashed var(--tp-plugin-image-dragging-color);border-radius:4px;opacity:0.6}",accept(bn,Ut){if(!(bn instanceof HTMLImageElement||typeof bn=="string"))return null;const jt=kt,Yt=function(Bn,un){const Cn=kt.required.object(un)(Bn);return Cn.succeeded?Cn.value:void 0}(Ut,{view:jt.required.constant("input-image"),acceptUrl:jt.optional.boolean,clickCallback:jt.optional.function,imageFit:jt.optional.custom(Bn=>Bn==="contain"||Bn==="cover"?Bn:void 0),extensions:jt.optional.array(jt.required.string)});return Yt?{initialValue:bn,params:Yt}:null},binding:{reader:bn=>Ut=>Ut.src!==void 0?Ut.src===""?"placeholder":Ut.src:Ut,writer:bn=>(Ut,jt)=>{Ut.write(jt)}},controller(bn){var Ut,jt;return new wn(bn.document,{value:bn.value,imageFit:(Ut=bn.params.imageFit)!==null&&Ut!==void 0?Ut:"cover",clickCallback:bn.params.clickCallback,viewProps:bn.viewProps,extensions:(jt=bn.params.extensions)!==null&&jt!==void 0?jt:_n})}};ot.plugin=$t,Object.defineProperty(ot,"__esModule",{value:!0})})(tt)},665:function(j,tt){(function(ot){class b{constructor(st){this.controller_=st}get disabled(){return this.controller_.viewProps.get("disabled")}set disabled(st){this.controller_.viewProps.set("disabled",st)}get hidden(){return this.controller_.viewProps.get("hidden")}set hidden(st){this.controller_.viewProps.set("hidden",st)}dispose(){this.controller_.viewProps.set("disposed",!0)}}class yt{constructor(st){this.target=st}}class Et extends yt{constructor(st,ht,Mt,Ht){super(st),this.value=ht,this.presetKey=Mt,this.last=Ht==null||Ht}}class kt extends yt{constructor(st,ht,Mt){super(st),this.value=ht,this.presetKey=Mt}}class Gt extends yt{constructor(st,ht){super(st),this.expanded=ht}}function Vt(At){return At==null}function an(At,st){if(At.length!==st.length)return!1;for(let ht=0;ht<At.length;ht++)if(At[ht]!==st[ht])return!1;return!0}const Pn={alreadydisposed:()=>"View has been already disposed",invalidparams:At=>`Invalid parameters for '${At.name}'`,nomatchingcontroller:At=>`No matching controller for '${At.key}'`,nomatchingview:At=>`No matching view for '${JSON.stringify(At.params)}'`,notbindable:()=>"Value is not bindable",propertynotfound:At=>`Property '${At.name}' not found`,shouldneverhappen:()=>"This error should never happen"};class gn{constructor(st){var ht;this.message=(ht=Pn[st.type](st.context))!==null&&ht!==void 0?ht:"Unexpected error",this.name=this.constructor.name,this.stack=new Error(this.message).stack,this.type=st.type}static alreadyDisposed(){return new gn({type:"alreadydisposed"})}static notBindable(){return new gn({type:"notbindable"})}static propertyNotFound(st){return new gn({type:"propertynotfound",context:{name:st}})}static shouldNeverHappen(){return new gn({type:"shouldneverhappen"})}}class dn{constructor(st,ht,Mt){this.obj_=st,this.key_=ht,this.presetKey_=Mt??ht}static isBindable(st){return st!==null&&typeof st=="object"}get key(){return this.key_}get presetKey(){return this.presetKey_}read(){return this.obj_[this.key_]}write(st){this.obj_[this.key_]=st}writeProperty(st,ht){const Mt=this.read();if(!dn.isBindable(Mt))throw gn.notBindable();if(!(st in Mt))throw gn.propertyNotFound(st);Mt[st]=ht}}class wn extends b{get label(){return this.controller_.props.get("label")}set label(st){this.controller_.props.set("label",st)}get title(){var st;return(st=this.controller_.valueController.props.get("title"))!==null&&st!==void 0?st:""}set title(st){this.controller_.valueController.props.set("title",st)}on(st,ht){const Mt=ht.bind(this);return this.controller_.valueController.emitter.on(st,()=>{Mt(new yt(this))}),this}}class _n{constructor(){this.observers_={}}on(st,ht){let Mt=this.observers_[st];return Mt||(Mt=this.observers_[st]=[]),Mt.push({handler:ht}),this}off(st,ht){const Mt=this.observers_[st];return Mt&&(this.observers_[st]=Mt.filter(Ht=>Ht.handler!==ht)),this}emit(st,ht){const Mt=this.observers_[st];Mt&&Mt.forEach(Ht=>{Ht.handler(ht)})}}const $t="tp";function bn(At){return(st,ht)=>[$t,"-",At,"v",st?`_${st}`:"",ht?`-${ht}`:""].join("")}function Ut(At){return At.rawValue}function jt(At,st){var ht,Mt;At.emitter.on("change",(ht=Ut,Mt=st,Ht=>Mt(ht(Ht)))),st(At.rawValue)}function Yt(At,st,ht){jt(At.value(st),ht)}function Bn(At,st){return ht=>{(function(Mt,Ht,hn){hn?Mt.classList.add(Ht):Mt.classList.remove(Ht)})(At,st,ht)}}function un(At,st){jt(At,ht=>{st.textContent=ht??""})}const Cn=bn("btn");class Qt{constructor(st,ht){this.element=st.createElement("div"),this.element.classList.add(Cn()),ht.viewProps.bindClassModifiers(this.element);const Mt=st.createElement("button");Mt.classList.add(Cn("b")),ht.viewProps.bindDisabled(Mt),this.element.appendChild(Mt),this.buttonElement=Mt;const Ht=st.createElement("div");Ht.classList.add(Cn("t")),un(ht.props.value("title"),Ht),this.buttonElement.appendChild(Ht)}}class Wt{constructor(st,ht){this.emitter=new _n,this.onClick_=this.onClick_.bind(this),this.props=ht.props,this.viewProps=ht.viewProps,this.view=new Qt(st,{props:this.props,viewProps:this.viewProps}),this.view.buttonElement.addEventListener("click",this.onClick_)}onClick_(){this.emitter.emit("click",{sender:this})}}class Zt{constructor(st,ht){var Mt;this.constraint_=ht==null?void 0:ht.constraint,this.equals_=(Mt=ht==null?void 0:ht.equals)!==null&&Mt!==void 0?Mt:(Ht,hn)=>Ht===hn,this.emitter=new _n,this.rawValue_=st}get constraint(){return this.constraint_}get rawValue(){return this.rawValue_}set rawValue(st){this.setRawValue(st,{forceEmit:!1,last:!0})}setRawValue(st,ht){const Mt=ht??{forceEmit:!1,last:!0},Ht=this.constraint_?this.constraint_.constrain(st):st;(!this.equals_(this.rawValue_,Ht)||Mt.forceEmit)&&(this.emitter.emit("beforechange",{sender:this}),this.rawValue_=Ht,this.emitter.emit("change",{options:Mt,rawValue:Ht,sender:this}))}}class En{constructor(st){this.emitter=new _n,this.value_=st}get rawValue(){return this.value_}set rawValue(st){this.setRawValue(st,{forceEmit:!1,last:!0})}setRawValue(st,ht){const Mt=ht??{forceEmit:!1,last:!0};(this.value_!==st||Mt.forceEmit)&&(this.emitter.emit("beforechange",{sender:this}),this.value_=st,this.emitter.emit("change",{options:Mt,rawValue:this.value_,sender:this}))}}function pn(At,st){const ht=st==null?void 0:st.constraint,Mt=st==null?void 0:st.equals;return ht||Mt?new Zt(At,st):new En(At)}class er{constructor(st){this.emitter=new _n,this.valMap_=st;for(const ht in this.valMap_)this.valMap_[ht].emitter.on("change",()=>{this.emitter.emit("change",{key:ht,sender:this})})}static createCore(st){return Object.keys(st).reduce((ht,Mt)=>Object.assign(ht,{[Mt]:pn(st[Mt])}),{})}static fromObject(st){const ht=this.createCore(st);return new er(ht)}get(st){return this.valMap_[st].rawValue}set(st,ht){this.valMap_[st].rawValue=ht}value(st){return this.valMap_[st]}}function Ir(At){return st=>ht=>{if(!st&&ht===void 0)return{succeeded:!1,value:void 0};if(st&&ht===void 0)return{succeeded:!0,value:void 0};const Mt=At(ht);return Mt!==void 0?{succeeded:!0,value:Mt}:{succeeded:!1,value:void 0}}}function Dr(At){return{custom:st=>Ir(st)(At),boolean:Ir(st=>typeof st=="boolean"?st:void 0)(At),number:Ir(st=>typeof st=="number"?st:void 0)(At),string:Ir(st=>typeof st=="string"?st:void 0)(At),function:Ir(st=>typeof st=="function"?st:void 0)(At),constant:st=>Ir(ht=>ht===st?st:void 0)(At),raw:Ir(st=>st)(At),object:st=>Ir(ht=>{if((Mt=ht)!==null&&typeof Mt=="object")return function(Ht,hn){return Object.keys(hn).reduce((Rn,lr)=>{if(Rn===void 0)return;const Nr=(0,hn[lr])(Ht[lr]);return Nr.succeeded?Object.assign(Object.assign({},Rn),{[lr]:Nr.value}):void 0},{})}(ht,st);var Mt})(At),array:st=>Ir(ht=>{if(Array.isArray(ht))return Mt=st,ht.reduce((Ht,hn)=>{if(Ht===void 0)return;const Rn=Mt(hn);return Rn.succeeded&&Rn.value!==void 0?[...Ht,Rn.value]:void 0},[]);var Mt})(At)}}const Vr={optional:Dr(!0),required:Dr(!1)};function yr(At,st){const ht=Vr.required.object(st)(At);return ht.succeeded?ht.value:void 0}const Hr=bn(""),Xn={veryfirst:"vfst",first:"fst",last:"lst",verylast:"vlst"};class ir{constructor(st){this.parent_=null,this.blade=st.blade,this.view=st.view,this.viewProps=st.viewProps;const ht=this.view.element;this.blade.value("positions").emitter.on("change",()=>{["veryfirst","first","last","verylast"].forEach(Mt=>{ht.classList.remove(Hr(void 0,Xn[Mt]))}),this.blade.get("positions").forEach(Mt=>{ht.classList.add(Hr(void 0,Xn[Mt]))})}),this.viewProps.handleDispose(()=>{(function(Mt){Mt&&Mt.parentElement&&Mt.parentElement.removeChild(Mt)})(ht)})}get parent(){return this.parent_}}const zn="http://www.w3.org/2000/svg";function nr(At){At.offsetHeight}function $n(At){return At.ontouchstart!==void 0}function Er(){return new Function("return this")().document}const Yn={check:'<path d="M2 8l4 4l8 -8"/>',dropdown:'<path d="M5 7h6l-3 3 z"/>',p2dpad:'<path d="M8 4v8"/><path d="M4 8h8"/><circle cx="12" cy="12" r="1.2"/>'};function Kt(At,st){const ht=At.createElementNS(zn,"svg");return ht.innerHTML=Yn[st],ht}function rn(At,st,ht){At.insertBefore(st,At.children[ht])}function jn(At){At.parentElement&&At.parentElement.removeChild(At)}function Ur(At){for(;At.children.length>0;)At.removeChild(At.children[0])}function kr(At){return At.relatedTarget?At.relatedTarget:"explicitOriginalTarget"in At?At.explicitOriginalTarget:null}const zr=bn("lbl");class Cs{constructor(st,ht){this.element=st.createElement("div"),this.element.classList.add(zr()),ht.viewProps.bindClassModifiers(this.element);const Mt=st.createElement("div");Mt.classList.add(zr("l")),Yt(ht.props,"label",hn=>{Vt(hn)?this.element.classList.add(zr(void 0,"nol")):(this.element.classList.remove(zr(void 0,"nol")),function(Rn){for(;Rn.childNodes.length>0;)Rn.removeChild(Rn.childNodes[0])}(Mt),Mt.appendChild(function(Rn,lr){const Nr=Rn.createDocumentFragment();return lr.split(`
`).map(ds=>Rn.createTextNode(ds)).forEach((ds,ws)=>{ws>0&&Nr.appendChild(Rn.createElement("br")),Nr.appendChild(ds)}),Nr}(st,hn)))}),this.element.appendChild(Mt),this.labelElement=Mt;const Ht=st.createElement("div");Ht.classList.add(zr("v")),this.element.appendChild(Ht),this.valueElement=Ht}}class Gs extends ir{constructor(st,ht){const Mt=ht.valueController.viewProps;super(Object.assign(Object.assign({},ht),{view:new Cs(st,{props:ht.props,viewProps:Mt}),viewProps:Mt})),this.props=ht.props,this.valueController=ht.valueController,this.view.valueElement.appendChild(this.valueController.view.element)}}const Ao={id:"button",type:"blade",accept(At){const st=Vr,ht=yr(At,{title:st.required.string,view:st.required.constant("button"),label:st.optional.string});return ht?{params:ht}:null},controller:At=>new Gs(At.document,{blade:At.blade,props:er.fromObject({label:At.params.label}),valueController:new Wt(At.document,{props:er.fromObject({title:At.params.title}),viewProps:At.viewProps})}),api:At=>At.controller instanceof Gs&&At.controller.valueController instanceof Wt?new wn(At.controller):null};class Ks extends ir{constructor(st){super(st),this.value=st.value}}function Oo(){return new er({positions:pn([],{equals:an})})}class Js extends er{constructor(st){super(st)}static create(st){const ht={completed:!0,expanded:st,expandedHeight:null,shouldFixHeight:!1,temporaryExpanded:null},Mt=er.createCore(ht);return new Js(Mt)}get styleExpanded(){var st;return(st=this.get("temporaryExpanded"))!==null&&st!==void 0?st:this.get("expanded")}get styleHeight(){if(!this.styleExpanded)return"0";const st=this.get("expandedHeight");return this.get("shouldFixHeight")&&!Vt(st)?`${st}px`:"auto"}bindExpandedClass(st,ht){const Mt=()=>{this.styleExpanded?st.classList.add(ht):st.classList.remove(ht)};Yt(this,"expanded",Mt),Yt(this,"temporaryExpanded",Mt)}cleanUpTransition(){this.set("shouldFixHeight",!1),this.set("expandedHeight",null),this.set("completed",!0)}}function Qo(At,st){st.style.height=At.styleHeight}function yo(At,st){At.value("expanded").emitter.on("beforechange",()=>{At.set("completed",!1),Vt(At.get("expandedHeight"))&&At.set("expandedHeight",function(ht,Mt){let Ht=0;return function(hn,Rn){const lr=hn.style.transition;hn.style.transition="none",Rn(),hn.style.transition=lr}(Mt,()=>{ht.set("expandedHeight",null),ht.set("temporaryExpanded",!0),nr(Mt),Ht=Mt.clientHeight,ht.set("temporaryExpanded",null),nr(Mt)}),Ht}(At,st)),At.set("shouldFixHeight",!0),nr(st)}),At.emitter.on("change",()=>{Qo(At,st)}),Qo(At,st),st.addEventListener("transitionend",ht=>{ht.propertyName==="height"&&At.cleanUpTransition()})}class Vu extends b{constructor(st,ht){super(st),this.rackApi_=ht}}class fu{constructor(st){this.emitter=new _n,this.items_=[],this.cache_=new Set,this.onSubListAdd_=this.onSubListAdd_.bind(this),this.onSubListRemove_=this.onSubListRemove_.bind(this),this.extract_=st}get items(){return this.items_}allItems(){return Array.from(this.cache_)}find(st){for(const ht of this.allItems())if(st(ht))return ht;return null}includes(st){return this.cache_.has(st)}add(st,ht){if(this.includes(st))throw gn.shouldNeverHappen();const Mt=ht!==void 0?ht:this.items_.length;this.items_.splice(Mt,0,st),this.cache_.add(st);const Ht=this.extract_(st);Ht&&(Ht.emitter.on("add",this.onSubListAdd_),Ht.emitter.on("remove",this.onSubListRemove_),Ht.allItems().forEach(hn=>{this.cache_.add(hn)})),this.emitter.emit("add",{index:Mt,item:st,root:this,target:this})}remove(st){const ht=this.items_.indexOf(st);if(ht<0)return;this.items_.splice(ht,1),this.cache_.delete(st);const Mt=this.extract_(st);Mt&&(Mt.emitter.off("add",this.onSubListAdd_),Mt.emitter.off("remove",this.onSubListRemove_)),this.emitter.emit("remove",{index:ht,item:st,root:this,target:this})}onSubListAdd_(st){this.cache_.add(st.item),this.emitter.emit("add",{index:st.index,item:st.item,root:this,target:st.target})}onSubListRemove_(st){this.cache_.delete(st.item),this.emitter.emit("remove",{index:st.index,item:st.item,root:this,target:st.target})}}class $a extends b{constructor(st){super(st),this.onBindingChange_=this.onBindingChange_.bind(this),this.emitter_=new _n,this.controller_.binding.emitter.on("change",this.onBindingChange_)}get label(){return this.controller_.props.get("label")}set label(st){this.controller_.props.set("label",st)}on(st,ht){const Mt=ht.bind(this);return this.emitter_.on(st,Ht=>{Mt(Ht.event)}),this}refresh(){this.controller_.binding.read()}onBindingChange_(st){const ht=st.sender.target.read();this.emitter_.emit("change",{event:new Et(this,ht,this.controller_.binding.target.presetKey,st.options.last)})}}class ko extends Gs{constructor(st,ht){super(st,ht),this.binding=ht.binding}}class Hl extends b{constructor(st){super(st),this.onBindingUpdate_=this.onBindingUpdate_.bind(this),this.emitter_=new _n,this.controller_.binding.emitter.on("update",this.onBindingUpdate_)}get label(){return this.controller_.props.get("label")}set label(st){this.controller_.props.set("label",st)}on(st,ht){const Mt=ht.bind(this);return this.emitter_.on(st,Ht=>{Mt(Ht.event)}),this}refresh(){this.controller_.binding.read()}onBindingUpdate_(st){const ht=st.sender.target.read();this.emitter_.emit("update",{event:new kt(this,ht,this.controller_.binding.target.presetKey)})}}class Io extends Gs{constructor(st,ht){super(st,ht),this.binding=ht.binding,this.viewProps.bindDisabled(this.binding.ticker),this.viewProps.handleDispose(()=>{this.binding.dispose()})}}function Qu(At){return At instanceof Lp?At.apiSet_:At instanceof Vu?At.rackApi_.apiSet_:null}function Mu(At,st){const ht=At.find(Mt=>Mt.controller_===st);if(!ht)throw gn.shouldNeverHappen();return ht}function Lo(At,st,ht){if(!dn.isBindable(At))throw gn.notBindable();return new dn(At,st,ht)}class Lp extends b{constructor(st,ht){super(st),this.onRackAdd_=this.onRackAdd_.bind(this),this.onRackRemove_=this.onRackRemove_.bind(this),this.onRackInputChange_=this.onRackInputChange_.bind(this),this.onRackMonitorUpdate_=this.onRackMonitorUpdate_.bind(this),this.emitter_=new _n,this.apiSet_=new fu(Qu),this.pool_=ht;const Mt=this.controller_.rack;Mt.emitter.on("add",this.onRackAdd_),Mt.emitter.on("remove",this.onRackRemove_),Mt.emitter.on("inputchange",this.onRackInputChange_),Mt.emitter.on("monitorupdate",this.onRackMonitorUpdate_),Mt.children.forEach(Ht=>{this.setUpApi_(Ht)})}get children(){return this.controller_.rack.children.map(st=>Mu(this.apiSet_,st))}addInput(st,ht,Mt){const Ht=Mt||{},hn=this.controller_.view.element.ownerDocument,Rn=this.pool_.createInput(hn,Lo(st,ht,Ht.presetKey),Ht),lr=new $a(Rn);return this.add(lr,Ht.index)}addMonitor(st,ht,Mt){const Ht=Mt||{},hn=this.controller_.view.element.ownerDocument,Rn=this.pool_.createMonitor(hn,Lo(st,ht),Ht),lr=new Hl(Rn);return this.add(lr,Ht.index)}addFolder(st){return function(ht,Mt){return ht.addBlade(Object.assign(Object.assign({},Mt),{view:"folder"}))}(this,st)}addButton(st){return function(ht,Mt){return ht.addBlade(Object.assign(Object.assign({},Mt),{view:"button"}))}(this,st)}addSeparator(st){return function(ht,Mt){const Ht=Mt||{};return ht.addBlade(Object.assign(Object.assign({},Ht),{view:"separator"}))}(this,st)}addTab(st){return function(ht,Mt){return ht.addBlade(Object.assign(Object.assign({},Mt),{view:"tab"}))}(this,st)}add(st,ht){this.controller_.rack.add(st.controller_,ht);const Mt=this.apiSet_.find(Ht=>Ht.controller_===st.controller_);return Mt&&this.apiSet_.remove(Mt),this.apiSet_.add(st),st}remove(st){this.controller_.rack.remove(st.controller_)}addBlade(st){const ht=this.controller_.view.element.ownerDocument,Mt=this.pool_.createBlade(ht,st),Ht=this.pool_.createBladeApi(Mt);return this.add(Ht,st.index)}on(st,ht){const Mt=ht.bind(this);return this.emitter_.on(st,Ht=>{Mt(Ht.event)}),this}setUpApi_(st){this.apiSet_.find(ht=>ht.controller_===st)||this.apiSet_.add(this.pool_.createBladeApi(st))}onRackAdd_(st){this.setUpApi_(st.bladeController)}onRackRemove_(st){if(st.isRoot){const ht=Mu(this.apiSet_,st.bladeController);this.apiSet_.remove(ht)}}onRackInputChange_(st){const ht=st.bladeController;if(ht instanceof ko){const Mt=Mu(this.apiSet_,ht),Ht=ht.binding;this.emitter_.emit("change",{event:new Et(Mt,Ht.target.read(),Ht.target.presetKey,st.options.last)})}else if(ht instanceof Ks){const Mt=Mu(this.apiSet_,ht);this.emitter_.emit("change",{event:new Et(Mt,ht.value.rawValue,void 0,st.options.last)})}}onRackMonitorUpdate_(st){if(!(st.bladeController instanceof Io))throw gn.shouldNeverHappen();const ht=Mu(this.apiSet_,st.bladeController),Mt=st.bladeController.binding;this.emitter_.emit("update",{event:new kt(ht,Mt.target.read(),Mt.target.presetKey)})}}class na extends Vu{constructor(st,ht){super(st,new Lp(st.rackController,ht)),this.emitter_=new _n,this.controller_.foldable.value("expanded").emitter.on("change",Mt=>{this.emitter_.emit("fold",{event:new Gt(this,Mt.sender.rawValue)})}),this.rackApi_.on("change",Mt=>{this.emitter_.emit("change",{event:Mt})}),this.rackApi_.on("update",Mt=>{this.emitter_.emit("update",{event:Mt})})}get expanded(){return this.controller_.foldable.get("expanded")}set expanded(st){this.controller_.foldable.set("expanded",st)}get title(){return this.controller_.props.get("title")}set title(st){this.controller_.props.set("title",st)}get children(){return this.rackApi_.children}addInput(st,ht,Mt){return this.rackApi_.addInput(st,ht,Mt)}addMonitor(st,ht,Mt){return this.rackApi_.addMonitor(st,ht,Mt)}addFolder(st){return this.rackApi_.addFolder(st)}addButton(st){return this.rackApi_.addButton(st)}addSeparator(st){return this.rackApi_.addSeparator(st)}addTab(st){return this.rackApi_.addTab(st)}add(st,ht){return this.rackApi_.add(st,ht)}remove(st){this.rackApi_.remove(st)}addBlade(st){return this.rackApi_.addBlade(st)}on(st,ht){const Mt=ht.bind(this);return this.emitter_.on(st,Ht=>{Mt(Ht.event)}),this}}class mu extends ir{constructor(st){super({blade:st.blade,view:st.view,viewProps:st.rackController.viewProps}),this.rackController=st.rackController}}class y1{constructor(st,ht){const Mt=bn(ht.viewName);this.element=st.createElement("div"),this.element.classList.add(Mt()),ht.viewProps.bindClassModifiers(this.element)}}function ga(At){return At instanceof km?At.rack:At instanceof mu?At.rackController.rack:null}function Np(At){const st=ga(At);return st?st.bcSet_:null}class xa{constructor(st){var ht;this.onBladePositionsChange_=this.onBladePositionsChange_.bind(this),this.onSetAdd_=this.onSetAdd_.bind(this),this.onSetRemove_=this.onSetRemove_.bind(this),this.onChildDispose_=this.onChildDispose_.bind(this),this.onChildPositionsChange_=this.onChildPositionsChange_.bind(this),this.onChildInputChange_=this.onChildInputChange_.bind(this),this.onChildMonitorUpdate_=this.onChildMonitorUpdate_.bind(this),this.onChildValueChange_=this.onChildValueChange_.bind(this),this.onChildViewPropsChange_=this.onChildViewPropsChange_.bind(this),this.onDescendantLayout_=this.onDescendantLayout_.bind(this),this.onDescendantInputChange_=this.onDescendantInputChange_.bind(this),this.onDescendantMonitorUpdate_=this.onDescendantMonitorUpdate_.bind(this),this.emitter=new _n,this.blade_=st??null,(ht=this.blade_)===null||ht===void 0||ht.value("positions").emitter.on("change",this.onBladePositionsChange_),this.bcSet_=new fu(Np),this.bcSet_.emitter.on("add",this.onSetAdd_),this.bcSet_.emitter.on("remove",this.onSetRemove_)}get children(){return this.bcSet_.items}add(st,ht){st.parent&&st.parent.remove(st),st.parent_=this,this.bcSet_.add(st,ht)}remove(st){st.parent_=null,this.bcSet_.remove(st)}find(st){return this.bcSet_.allItems().filter(ht=>ht instanceof st)}onSetAdd_(st){this.updatePositions_();const ht=st.target===st.root;if(this.emitter.emit("add",{bladeController:st.item,index:st.index,isRoot:ht,sender:this}),!ht)return;const Mt=st.item;if(Mt.viewProps.emitter.on("change",this.onChildViewPropsChange_),Mt.blade.value("positions").emitter.on("change",this.onChildPositionsChange_),Mt.viewProps.handleDispose(this.onChildDispose_),Mt instanceof ko)Mt.binding.emitter.on("change",this.onChildInputChange_);else if(Mt instanceof Io)Mt.binding.emitter.on("update",this.onChildMonitorUpdate_);else if(Mt instanceof Ks)Mt.value.emitter.on("change",this.onChildValueChange_);else{const Ht=ga(Mt);if(Ht){const hn=Ht.emitter;hn.on("layout",this.onDescendantLayout_),hn.on("inputchange",this.onDescendantInputChange_),hn.on("monitorupdate",this.onDescendantMonitorUpdate_)}}}onSetRemove_(st){this.updatePositions_();const ht=st.target===st.root;if(this.emitter.emit("remove",{bladeController:st.item,isRoot:ht,sender:this}),!ht)return;const Mt=st.item;if(Mt instanceof ko)Mt.binding.emitter.off("change",this.onChildInputChange_);else if(Mt instanceof Io)Mt.binding.emitter.off("update",this.onChildMonitorUpdate_);else if(Mt instanceof Ks)Mt.value.emitter.off("change",this.onChildValueChange_);else{const Ht=ga(Mt);if(Ht){const hn=Ht.emitter;hn.off("layout",this.onDescendantLayout_),hn.off("inputchange",this.onDescendantInputChange_),hn.off("monitorupdate",this.onDescendantMonitorUpdate_)}}}updatePositions_(){const st=this.bcSet_.items.filter(Ht=>!Ht.viewProps.get("hidden")),ht=st[0],Mt=st[st.length-1];this.bcSet_.items.forEach(Ht=>{const hn=[];Ht===ht&&(hn.push("first"),this.blade_&&!this.blade_.get("positions").includes("veryfirst")||hn.push("veryfirst")),Ht===Mt&&(hn.push("last"),this.blade_&&!this.blade_.get("positions").includes("verylast")||hn.push("verylast")),Ht.blade.set("positions",hn)})}onChildPositionsChange_(){this.updatePositions_(),this.emitter.emit("layout",{sender:this})}onChildViewPropsChange_(st){this.updatePositions_(),this.emitter.emit("layout",{sender:this})}onChildDispose_(){this.bcSet_.items.filter(st=>st.viewProps.get("disposed")).forEach(st=>{this.bcSet_.remove(st)})}onChildInputChange_(st){const ht=function(Mt,Ht){for(let hn=0;hn<Mt.length;hn++){const Rn=Mt[hn];if(Rn instanceof ko&&Rn.binding===Ht)return Rn}return null}(this.find(ko),st.sender);if(!ht)throw gn.shouldNeverHappen();this.emitter.emit("inputchange",{bladeController:ht,options:st.options,sender:this})}onChildMonitorUpdate_(st){const ht=function(Mt,Ht){for(let hn=0;hn<Mt.length;hn++){const Rn=Mt[hn];if(Rn instanceof Io&&Rn.binding===Ht)return Rn}return null}(this.find(Io),st.sender);if(!ht)throw gn.shouldNeverHappen();this.emitter.emit("monitorupdate",{bladeController:ht,sender:this})}onChildValueChange_(st){const ht=function(Mt,Ht){for(let hn=0;hn<Mt.length;hn++){const Rn=Mt[hn];if(Rn instanceof Ks&&Rn.value===Ht)return Rn}return null}(this.find(Ks),st.sender);if(!ht)throw gn.shouldNeverHappen();this.emitter.emit("inputchange",{bladeController:ht,options:st.options,sender:this})}onDescendantLayout_(st){this.updatePositions_(),this.emitter.emit("layout",{sender:this})}onDescendantInputChange_(st){this.emitter.emit("inputchange",{bladeController:st.bladeController,options:st.options,sender:this})}onDescendantMonitorUpdate_(st){this.emitter.emit("monitorupdate",{bladeController:st.bladeController,sender:this})}onBladePositionsChange_(){this.updatePositions_()}}class km extends ir{constructor(st,ht){super(Object.assign(Object.assign({},ht),{view:new y1(st,{viewName:"brk",viewProps:ht.viewProps})})),this.onRackAdd_=this.onRackAdd_.bind(this),this.onRackRemove_=this.onRackRemove_.bind(this);const Mt=new xa(ht.root?void 0:ht.blade);Mt.emitter.on("add",this.onRackAdd_),Mt.emitter.on("remove",this.onRackRemove_),this.rack=Mt,this.viewProps.handleDispose(()=>{for(let Ht=this.rack.children.length-1;Ht>=0;Ht--)this.rack.children[Ht].viewProps.set("disposed",!0)})}onRackAdd_(st){st.isRoot&&rn(this.view.element,st.bladeController.view.element,st.index)}onRackRemove_(st){st.isRoot&&jn(st.bladeController.view.element)}}const nA=bn("cnt");class mo{constructor(st,ht){this.className_=bn(ht.viewName||"fld"),this.element=st.createElement("div"),this.element.classList.add(this.className_(),nA()),ht.viewProps.bindClassModifiers(this.element),this.foldable_=ht.foldable,this.foldable_.bindExpandedClass(this.element,this.className_(void 0,"expanded")),Yt(this.foldable_,"completed",Bn(this.element,this.className_(void 0,"cpl")));const Mt=st.createElement("button");Mt.classList.add(this.className_("b")),Yt(ht.props,"title",lr=>{Vt(lr)?this.element.classList.add(this.className_(void 0,"not")):this.element.classList.remove(this.className_(void 0,"not"))}),ht.viewProps.bindDisabled(Mt),this.element.appendChild(Mt),this.buttonElement=Mt;const Ht=st.createElement("div");Ht.classList.add(this.className_("t")),un(ht.props.value("title"),Ht),this.buttonElement.appendChild(Ht),this.titleElement=Ht;const hn=st.createElement("div");hn.classList.add(this.className_("m")),this.buttonElement.appendChild(hn);const Rn=ht.containerElement;Rn.classList.add(this.className_("c")),this.element.appendChild(Rn),this.containerElement=Rn}}class Go extends mu{constructor(st,ht){var Mt;const Ht=Js.create((Mt=ht.expanded)===null||Mt===void 0||Mt),hn=new km(st,{blade:ht.blade,root:ht.root,viewProps:ht.viewProps});super(Object.assign(Object.assign({},ht),{rackController:hn,view:new mo(st,{containerElement:hn.view.element,foldable:Ht,props:ht.props,viewName:ht.root?"rot":void 0,viewProps:ht.viewProps})})),this.onTitleClick_=this.onTitleClick_.bind(this),this.props=ht.props,this.foldable=Ht,yo(this.foldable,this.view.containerElement),this.rackController.rack.emitter.on("add",()=>{this.foldable.cleanUpTransition()}),this.rackController.rack.emitter.on("remove",()=>{this.foldable.cleanUpTransition()}),this.view.buttonElement.addEventListener("click",this.onTitleClick_)}get document(){return this.view.element.ownerDocument}onTitleClick_(){this.foldable.set("expanded",!this.foldable.get("expanded"))}}const am={id:"folder",type:"blade",accept(At){const st=Vr,ht=yr(At,{title:st.required.string,view:st.required.constant("folder"),expanded:st.optional.boolean});return ht?{params:ht}:null},controller:At=>new Go(At.document,{blade:At.blade,expanded:At.params.expanded,props:er.fromObject({title:At.params.title}),viewProps:At.viewProps}),api:At=>At.controller instanceof Go?new na(At.controller,At.pool):null};class Gu extends Ks{constructor(st,ht){const Mt=ht.valueController.viewProps;super(Object.assign(Object.assign({},ht),{value:ht.valueController.value,view:new Cs(st,{props:ht.props,viewProps:Mt}),viewProps:Mt})),this.props=ht.props,this.valueController=ht.valueController,this.view.valueElement.appendChild(this.valueController.view.element)}}class Ay extends b{}const J0=bn("spr");class Z0{constructor(st,ht){this.element=st.createElement("div"),this.element.classList.add(J0()),ht.viewProps.bindClassModifiers(this.element);const Mt=st.createElement("hr");Mt.classList.add(J0("r")),this.element.appendChild(Mt)}}class Fn extends ir{constructor(st,ht){super(Object.assign(Object.assign({},ht),{view:new Z0(st,{viewProps:ht.viewProps})}))}}const Wl={id:"separator",type:"blade",accept(At){const st=yr(At,{view:Vr.required.constant("separator")});return st?{params:st}:null},controller:At=>new Fn(At.document,{blade:At.blade,viewProps:At.viewProps}),api:At=>At.controller instanceof Fn?new Ay(At.controller):null},lm=bn("");function Om(At,st){return Bn(At,lm(void 0,st))}class ao extends er{constructor(st){super(st)}static create(st){var ht,Mt;const Ht=st??{},hn={disabled:(ht=Ht.disabled)!==null&&ht!==void 0&&ht,disposed:!1,hidden:(Mt=Ht.hidden)!==null&&Mt!==void 0&&Mt},Rn=er.createCore(hn);return new ao(Rn)}bindClassModifiers(st){Yt(this,"disabled",Om(st,"disabled")),Yt(this,"hidden",Om(st,"hidden"))}bindDisabled(st){Yt(this,"disabled",ht=>{st.disabled=ht})}bindTabIndex(st){Yt(this,"disabled",ht=>{st.tabIndex=ht?-1:0})}handleDispose(st){this.value("disposed").emitter.on("change",ht=>{ht&&st()})}}const to=bn("tbi");class kw{constructor(st,ht){this.element=st.createElement("div"),this.element.classList.add(to()),ht.viewProps.bindClassModifiers(this.element),Yt(ht.props,"selected",hn=>{hn?this.element.classList.add(to(void 0,"sel")):this.element.classList.remove(to(void 0,"sel"))});const Mt=st.createElement("button");Mt.classList.add(to("b")),ht.viewProps.bindDisabled(Mt),this.element.appendChild(Mt),this.buttonElement=Mt;const Ht=st.createElement("div");Ht.classList.add(to("t")),un(ht.props.value("title"),Ht),this.buttonElement.appendChild(Ht),this.titleElement=Ht}}class Ow{constructor(st,ht){this.emitter=new _n,this.onClick_=this.onClick_.bind(this),this.props=ht.props,this.viewProps=ht.viewProps,this.view=new kw(st,{props:ht.props,viewProps:ht.viewProps}),this.view.buttonElement.addEventListener("click",this.onClick_)}onClick_(){this.emitter.emit("click",{sender:this})}}class Hu{constructor(st,ht){this.onItemClick_=this.onItemClick_.bind(this),this.ic_=new Ow(st,{props:ht.itemProps,viewProps:ao.create()}),this.ic_.emitter.on("click",this.onItemClick_),this.cc_=new km(st,{blade:Oo(),viewProps:ao.create()}),this.props=ht.props,Yt(this.props,"selected",Mt=>{this.itemController.props.set("selected",Mt),this.contentController.viewProps.set("hidden",!Mt)})}get itemController(){return this.ic_}get contentController(){return this.cc_}onItemClick_(){this.props.set("selected",!0)}}class Ap{constructor(st,ht){this.controller_=st,this.rackApi_=ht}get title(){var st;return(st=this.controller_.itemController.props.get("title"))!==null&&st!==void 0?st:""}set title(st){this.controller_.itemController.props.set("title",st)}get selected(){return this.controller_.props.get("selected")}set selected(st){this.controller_.props.set("selected",st)}get children(){return this.rackApi_.children}addButton(st){return this.rackApi_.addButton(st)}addFolder(st){return this.rackApi_.addFolder(st)}addSeparator(st){return this.rackApi_.addSeparator(st)}addTab(st){return this.rackApi_.addTab(st)}add(st,ht){this.rackApi_.add(st,ht)}remove(st){this.rackApi_.remove(st)}addInput(st,ht,Mt){return this.rackApi_.addInput(st,ht,Mt)}addMonitor(st,ht,Mt){return this.rackApi_.addMonitor(st,ht,Mt)}addBlade(st){return this.rackApi_.addBlade(st)}}class yy extends Vu{constructor(st,ht){super(st,new Lp(st.rackController,ht)),this.onPageAdd_=this.onPageAdd_.bind(this),this.onPageRemove_=this.onPageRemove_.bind(this),this.emitter_=new _n,this.pageApiMap_=new Map,this.rackApi_.on("change",Mt=>{this.emitter_.emit("change",{event:Mt})}),this.rackApi_.on("update",Mt=>{this.emitter_.emit("update",{event:Mt})}),this.controller_.pageSet.emitter.on("add",this.onPageAdd_),this.controller_.pageSet.emitter.on("remove",this.onPageRemove_),this.controller_.pageSet.items.forEach(Mt=>{this.setUpPageApi_(Mt)})}get pages(){return this.controller_.pageSet.items.map(st=>{const ht=this.pageApiMap_.get(st);if(!ht)throw gn.shouldNeverHappen();return ht})}addPage(st){const ht=this.controller_.view.element.ownerDocument,Mt=new Hu(ht,{itemProps:er.fromObject({selected:!1,title:st.title}),props:er.fromObject({selected:!1})});this.controller_.add(Mt,st.index);const Ht=this.pageApiMap_.get(Mt);if(!Ht)throw gn.shouldNeverHappen();return Ht}removePage(st){this.controller_.remove(st)}on(st,ht){const Mt=ht.bind(this);return this.emitter_.on(st,Ht=>{Mt(Ht.event)}),this}setUpPageApi_(st){const ht=this.rackApi_.apiSet_.find(Ht=>Ht.controller_===st.contentController);if(!ht)throw gn.shouldNeverHappen();const Mt=new Ap(st,ht);this.pageApiMap_.set(st,Mt)}onPageAdd_(st){this.setUpPageApi_(st.item)}onPageRemove_(st){if(!this.pageApiMap_.get(st.item))throw gn.shouldNeverHappen();this.pageApiMap_.delete(st.item)}}const yp=bn("tab");class Av{constructor(st,ht){this.element=st.createElement("div"),this.element.classList.add(yp(),nA()),ht.viewProps.bindClassModifiers(this.element),jt(ht.empty,Bn(this.element,yp(void 0,"nop")));const Mt=st.createElement("div");Mt.classList.add(yp("i")),this.element.appendChild(Mt),this.itemsElement=Mt;const Ht=ht.contentsElement;Ht.classList.add(yp("c")),this.element.appendChild(Ht),this.contentsElement=Ht}}class iA extends mu{constructor(st,ht){const Mt=new km(st,{blade:ht.blade,viewProps:ht.viewProps}),Ht=pn(!0);super({blade:ht.blade,rackController:Mt,view:new Av(st,{contentsElement:Mt.view.element,empty:Ht,viewProps:ht.viewProps})}),this.onPageAdd_=this.onPageAdd_.bind(this),this.onPageRemove_=this.onPageRemove_.bind(this),this.onPageSelectedChange_=this.onPageSelectedChange_.bind(this),this.pageSet_=new fu(()=>null),this.pageSet_.emitter.on("add",this.onPageAdd_),this.pageSet_.emitter.on("remove",this.onPageRemove_),this.empty_=Ht,this.applyPages_()}get pageSet(){return this.pageSet_}add(st,ht){this.pageSet_.add(st,ht??this.pageSet_.items.length)}remove(st){this.pageSet_.remove(this.pageSet_.items[st])}applyPages_(){this.keepSelection_(),this.empty_.rawValue=this.pageSet_.items.length===0}onPageAdd_(st){const ht=st.item;rn(this.view.itemsElement,ht.itemController.view.element,st.index),this.rackController.rack.add(ht.contentController,st.index),ht.props.value("selected").emitter.on("change",this.onPageSelectedChange_),this.applyPages_()}onPageRemove_(st){const ht=st.item;jn(ht.itemController.view.element),this.rackController.rack.remove(ht.contentController),ht.props.value("selected").emitter.off("change",this.onPageSelectedChange_),this.applyPages_()}keepSelection_(){if(this.pageSet_.items.length===0)return;const st=this.pageSet_.items.findIndex(ht=>ht.props.get("selected"));st<0?this.pageSet_.items.forEach((ht,Mt)=>{ht.props.set("selected",Mt===0)}):this.pageSet_.items.forEach((ht,Mt)=>{ht.props.set("selected",Mt===st)})}onPageSelectedChange_(st){if(st.rawValue){const ht=this.pageSet_.items.findIndex(Mt=>Mt.props.value("selected")===st.sender);this.pageSet_.items.forEach((Mt,Ht)=>{Mt.props.set("selected",Ht===ht)})}else this.keepSelection_()}}const np={id:"tab",type:"blade",accept(At){const st=Vr,ht=yr(At,{pages:st.required.array(st.required.object({title:st.required.string})),view:st.required.constant("tab")});return ht&&ht.pages.length!==0?{params:ht}:null},controller(At){const st=new iA(At.document,{blade:At.blade,viewProps:At.viewProps});return At.params.pages.forEach(ht=>{const Mt=new Hu(At.document,{itemProps:er.fromObject({selected:!1,title:ht.title}),props:er.fromObject({selected:!1})});st.add(Mt)}),st},api:At=>At.controller instanceof iA?new yy(At.controller,At.pool):null};class wy{constructor(){this.disabled=!1,this.emitter=new _n}dispose(){}tick(){this.disabled||this.emitter.emit("tick",{sender:this})}}class w1{constructor(st,ht){this.disabled_=!1,this.timerId_=null,this.onTick_=this.onTick_.bind(this),this.doc_=st,this.emitter=new _n,this.interval_=ht,this.setTimer_()}get disabled(){return this.disabled_}set disabled(st){this.disabled_=st,this.disabled_?this.clearTimer_():this.setTimer_()}dispose(){this.clearTimer_()}clearTimer_(){if(this.timerId_===null)return;const st=this.doc_.defaultView;st&&st.clearInterval(this.timerId_),this.timerId_=null}setTimer_(){if(this.clearTimer_(),this.interval_<=0)return;const st=this.doc_.defaultView;st&&(this.timerId_=st.setInterval(this.onTick_,this.interval_))}onTick_(){this.disabled_||this.emitter.emit("tick",{sender:this})}}class yv{constructor(st){this.constraints=st}constrain(st){return this.constraints.reduce((ht,Mt)=>Mt.constrain(ht),st)}}function ip(At,st){if(At instanceof st)return At;if(At instanceof yv){const ht=At.constraints.reduce((Mt,Ht)=>Mt||(Ht instanceof st?Ht:null),null);if(ht)return ht}return null}class wv{constructor(st){this.options=st}constrain(st){const ht=this.options;return ht.length===0||ht.filter(Mt=>Mt.value===st).length>0?st:ht[0].value}}class wo{constructor(st){this.maxValue=st.max,this.minValue=st.min}constrain(st){let ht=st;return Vt(this.minValue)||(ht=Math.max(ht,this.minValue)),Vt(this.maxValue)||(ht=Math.min(ht,this.maxValue)),ht}}class wp{constructor(st){this.step=st}constrain(st){return(st<0?-Math.round(-st/this.step):Math.round(st/this.step))*this.step}}const gu=bn("lst");class $0{constructor(st,ht){this.onValueChange_=this.onValueChange_.bind(this),this.props_=ht.props,this.element=st.createElement("div"),this.element.classList.add(gu()),ht.viewProps.bindClassModifiers(this.element);const Mt=st.createElement("select");Mt.classList.add(gu("s")),Yt(this.props_,"options",hn=>{Ur(Mt),hn.forEach((Rn,lr)=>{const Nr=st.createElement("option");Nr.dataset.index=String(lr),Nr.textContent=Rn.text,Nr.value=String(Rn.value),Mt.appendChild(Nr)})}),ht.viewProps.bindDisabled(Mt),this.element.appendChild(Mt),this.selectElement=Mt;const Ht=st.createElement("div");Ht.classList.add(gu("m")),Ht.appendChild(Kt(st,"dropdown")),this.element.appendChild(Ht),ht.value.emitter.on("change",this.onValueChange_),this.value_=ht.value,this.update_()}update_(){this.selectElement.value=String(this.value_.rawValue)}onValueChange_(){this.update_()}}class eu{constructor(st,ht){this.onSelectChange_=this.onSelectChange_.bind(this),this.props=ht.props,this.value=ht.value,this.viewProps=ht.viewProps,this.view=new $0(st,{props:this.props,value:this.value,viewProps:this.viewProps}),this.view.selectElement.addEventListener("change",this.onSelectChange_)}onSelectChange_(st){const ht=st.currentTarget.selectedOptions.item(0);if(!ht)return;const Mt=Number(ht.dataset.index);this.value.rawValue=this.props.get("options")[Mt].value}}const ts=bn("pop");class r0{constructor(st,ht){this.element=st.createElement("div"),this.element.classList.add(ts()),ht.viewProps.bindClassModifiers(this.element),jt(ht.shows,Bn(this.element,ts(void 0,"v")))}}class ss{constructor(st,ht){this.shows=pn(!1),this.viewProps=ht.viewProps,this.view=new r0(st,{shows:this.shows,viewProps:this.viewProps})}}const Up=bn("txt");class xv{constructor(st,ht){this.onChange_=this.onChange_.bind(this),this.element=st.createElement("div"),this.element.classList.add(Up()),ht.viewProps.bindClassModifiers(this.element),this.props_=ht.props,this.props_.emitter.on("change",this.onChange_);const Mt=st.createElement("input");Mt.classList.add(Up("i")),Mt.type="text",ht.viewProps.bindDisabled(Mt),this.element.appendChild(Mt),this.inputElement=Mt,ht.value.emitter.on("change",this.onChange_),this.value_=ht.value,this.refresh()}refresh(){const st=this.props_.get("formatter");this.inputElement.value=st(this.value_.rawValue)}onChange_(){this.refresh()}}class uo{constructor(st,ht){this.onInputChange_=this.onInputChange_.bind(this),this.parser_=ht.parser,this.props=ht.props,this.value=ht.value,this.viewProps=ht.viewProps,this.view=new xv(st,{props:ht.props,value:this.value,viewProps:this.viewProps}),this.view.inputElement.addEventListener("change",this.onInputChange_)}onInputChange_(st){const ht=st.currentTarget.value,Mt=this.parser_(ht);Vt(Mt)||(this.value.rawValue=Mt),this.view.refresh()}}function qs(At){return At!=="false"&&!!At}function cm(At){return function(st){return String(st)}(At)}class s0{constructor(st){this.text=st}evaluate(){return Number(this.text)}toString(){return this.text}}const bv={"**":(At,st)=>Math.pow(At,st),"*":(At,st)=>At*st,"/":(At,st)=>At/st,"%":(At,st)=>At%st,"+":(At,st)=>At+st,"-":(At,st)=>At-st,"<<":(At,st)=>At<<st,">>":(At,st)=>At>>st,">>>":(At,st)=>At>>>st,"&":(At,st)=>At&st,"^":(At,st)=>At^st,"|":(At,st)=>At|st};class o0{constructor(st,ht,Mt){this.left=ht,this.operator=st,this.right=Mt}evaluate(){const st=bv[this.operator];if(!st)throw new Error(`unexpected binary operator: '${this.operator}`);return st(this.left.evaluate(),this.right.evaluate())}toString(){return["b(",this.left.toString(),this.operator,this.right.toString(),")"].join(" ")}}const Ys={"+":At=>At,"-":At=>-At,"~":At=>~At};class e_{constructor(st,ht){this.operator=st,this.expression=ht}evaluate(){const st=Ys[this.operator];if(!st)throw new Error(`unexpected unary operator: '${this.operator}`);return st(this.expression.evaluate())}toString(){return["u(",this.operator,this.expression.toString(),")"].join(" ")}}function t_(At){return(st,ht)=>{for(let Mt=0;Mt<At.length;Mt++){const Ht=At[Mt](st,ht);if(Ht!=="")return Ht}return""}}function Lm(At,st){var ht;const Mt=At.substr(st).match(/^\s+/);return(ht=Mt&&Mt[0])!==null&&ht!==void 0?ht:""}function Ev(At,st){var ht;const Mt=At.substr(st).match(/^[0-9]+/);return(ht=Mt&&Mt[0])!==null&&ht!==void 0?ht:""}function n_(At,st){const ht=At.substr(st,1);if(st+=1,ht.toLowerCase()!=="e")return"";const Mt=function(Ht,hn){const Rn=Ev(Ht,hn);if(Rn!=="")return Rn;const lr=Ht.substr(hn,1);if(lr!=="-"&&lr!=="+")return"";const Nr=Ev(Ht,hn+=1);return Nr===""?"":lr+Nr}(At,st);return Mt===""?"":ht+Mt}function So(At,st){const ht=At.substr(st,1);if(ht==="0")return ht;const Mt=function(Ht,hn){const Rn=Ht.substr(hn,1);return Rn.match(/^[1-9]$/)?Rn:""}(At,st);return st+=Mt.length,Mt===""?"":Mt+Ev(At,st)}const go=t_([function(At,st){const ht=So(At,st);if(st+=ht.length,ht==="")return"";const Mt=At.substr(st,1);if(st+=Mt.length,Mt!==".")return"";const Ht=Ev(At,st);return ht+Mt+Ht+n_(At,st+=Ht.length)},function(At,st){const ht=At.substr(st,1);if(st+=ht.length,ht!==".")return"";const Mt=Ev(At,st);return st+=Mt.length,Mt===""?"":ht+Mt+n_(At,st)},function(At,st){const ht=So(At,st);return st+=ht.length,ht===""?"":ht+n_(At,st)}]),Sv=t_([function(At,st){const ht=At.substr(st,2);if(st+=ht.length,ht.toLowerCase()!=="0b")return"";const Mt=function(Ht,hn){var Rn;const lr=Ht.substr(hn).match(/^[01]+/);return(Rn=lr&&lr[0])!==null&&Rn!==void 0?Rn:""}(At,st);return Mt===""?"":ht+Mt},function(At,st){const ht=At.substr(st,2);if(st+=ht.length,ht.toLowerCase()!=="0o")return"";const Mt=function(Ht,hn){var Rn;const lr=Ht.substr(hn).match(/^[0-7]+/);return(Rn=lr&&lr[0])!==null&&Rn!==void 0?Rn:""}(At,st);return Mt===""?"":ht+Mt},function(At,st){const ht=At.substr(st,2);if(st+=ht.length,ht.toLowerCase()!=="0x")return"";const Mt=function(Ht,hn){var Rn;const lr=Ht.substr(hn).match(/^[0-9a-f]+/i);return(Rn=lr&&lr[0])!==null&&Rn!==void 0?Rn:""}(At,st);return Mt===""?"":ht+Mt}]),Wu=t_([Sv,go]);function xy(At,st){return function(ht,Mt){const Ht=Wu(ht,Mt);return Mt+=Ht.length,Ht===""?null:{evaluable:new s0(Ht),cursor:Mt}}(At,st)||function(ht,Mt){const Ht=ht.substr(Mt,1);if(Mt+=Ht.length,Ht!=="(")return null;const hn=i_(ht,Mt);if(!hn)return null;Mt=hn.cursor,Mt+=Lm(ht,Mt).length;const Rn=ht.substr(Mt,1);return Mt+=Rn.length,Rn!==")"?null:{evaluable:hn.evaluable,cursor:Mt}}(At,st)}function um(At,st,ht){ht+=Lm(st,ht).length;const Mt=At.filter(Ht=>st.startsWith(Ht,ht))[0];return Mt?(ht+=Mt.length,{cursor:ht+=Lm(st,ht).length,operator:Mt}):null}const a0=[["**"],["*","/","%"],["+","-"],["<<",">>>",">>"],["&"],["^"],["|"]].reduce((At,st)=>function(ht,Mt){return(Ht,hn)=>{const Rn=ht(Ht,hn);if(!Rn)return null;hn=Rn.cursor;let lr=Rn.evaluable;for(;;){const Nr=um(Mt,Ht,hn);if(!Nr)break;hn=Nr.cursor;const ds=ht(Ht,hn);if(!ds)return null;hn=ds.cursor,lr=new o0(Nr.operator,lr,ds.evaluable)}return lr?{cursor:hn,evaluable:lr}:null}}(At,st),function At(st,ht){const Mt=xy(st,ht);if(Mt)return Mt;const Ht=st.substr(ht,1);if(ht+=Ht.length,Ht!=="+"&&Ht!=="-"&&Ht!=="~")return null;const hn=At(st,ht);return hn?{cursor:ht=hn.cursor,evaluable:new e_(Ht,hn.evaluable)}:null});function i_(At,st){return st+=Lm(At,st).length,a0(At,st)}function Do(At){var st;const ht=function(Mt){const Ht=i_(Mt,0);return Ht?Ht.cursor+Lm(Mt,Ht.cursor).length!==Mt.length?null:Ht.evaluable:null}(At);return(st=ht==null?void 0:ht.evaluate())!==null&&st!==void 0?st:null}function xp(At){if(typeof At=="number")return At;if(typeof At=="string"){const st=Do(At);if(!Vt(st))return st}return 0}function Nm(At){return String(At)}function Yl(At){return st=>st.toFixed(Math.max(Math.min(At,20),0))}const rp=Yl(0);function rA(At){return rp(At)+"%"}function r_(At){return String(At)}function Lw(At){return At}function qu(At,st){for(;At.length<st;)At.push(void 0)}function No(At){const st=[];return qu(st,At),pn(st)}function Yu(At){const st=At.indexOf(void 0);return st<0?At:At.slice(0,st)}function Cv({primary:At,secondary:st,forward:ht,backward:Mt}){let Ht=!1;function hn(Rn){Ht||(Ht=!0,Rn(),Ht=!1)}At.emitter.on("change",Rn=>{hn(()=>{st.setRawValue(ht(At,st),Rn.options)})}),st.emitter.on("change",Rn=>{hn(()=>{At.setRawValue(Mt(At,st),Rn.options)}),hn(()=>{st.setRawValue(ht(At,st),Rn.options)})}),hn(()=>{st.setRawValue(ht(At,st),{forceEmit:!1,last:!0})})}function vu(At,st){const ht=At*(st.altKey?.1:1)*(st.shiftKey?10:1);return st.upKey?+ht:st.downKey?-ht:0}function Mv(At){return{altKey:At.altKey,downKey:At.key==="ArrowDown",shiftKey:At.shiftKey,upKey:At.key==="ArrowUp"}}function Nl(At){return{altKey:At.altKey,downKey:At.key==="ArrowLeft",shiftKey:At.shiftKey,upKey:At.key==="ArrowRight"}}function by(At){return function(st){return st==="ArrowUp"||st==="ArrowDown"}(At)||At==="ArrowLeft"||At==="ArrowRight"}function Nw(At,st){const ht=st.ownerDocument.defaultView,Mt=st.getBoundingClientRect();return{x:At.pageX-((ht&&ht.scrollX||0)+Mt.left),y:At.pageY-((ht&&ht.scrollY||0)+Mt.top)}}class tu{constructor(st){this.lastTouch_=null,this.onDocumentMouseMove_=this.onDocumentMouseMove_.bind(this),this.onDocumentMouseUp_=this.onDocumentMouseUp_.bind(this),this.onMouseDown_=this.onMouseDown_.bind(this),this.onTouchEnd_=this.onTouchEnd_.bind(this),this.onTouchMove_=this.onTouchMove_.bind(this),this.onTouchStart_=this.onTouchStart_.bind(this),this.elem_=st,this.emitter=new _n,st.addEventListener("touchstart",this.onTouchStart_,{passive:!1}),st.addEventListener("touchmove",this.onTouchMove_,{passive:!0}),st.addEventListener("touchend",this.onTouchEnd_),st.addEventListener("mousedown",this.onMouseDown_)}computePosition_(st){const ht=this.elem_.getBoundingClientRect();return{bounds:{width:ht.width,height:ht.height},point:st?{x:st.x,y:st.y}:null}}onMouseDown_(st){var ht;st.preventDefault(),(ht=st.currentTarget)===null||ht===void 0||ht.focus();const Mt=this.elem_.ownerDocument;Mt.addEventListener("mousemove",this.onDocumentMouseMove_),Mt.addEventListener("mouseup",this.onDocumentMouseUp_),this.emitter.emit("down",{altKey:st.altKey,data:this.computePosition_(Nw(st,this.elem_)),sender:this,shiftKey:st.shiftKey})}onDocumentMouseMove_(st){this.emitter.emit("move",{altKey:st.altKey,data:this.computePosition_(Nw(st,this.elem_)),sender:this,shiftKey:st.shiftKey})}onDocumentMouseUp_(st){const ht=this.elem_.ownerDocument;ht.removeEventListener("mousemove",this.onDocumentMouseMove_),ht.removeEventListener("mouseup",this.onDocumentMouseUp_),this.emitter.emit("up",{altKey:st.altKey,data:this.computePosition_(Nw(st,this.elem_)),sender:this,shiftKey:st.shiftKey})}onTouchStart_(st){st.preventDefault();const ht=st.targetTouches.item(0),Mt=this.elem_.getBoundingClientRect();this.emitter.emit("down",{altKey:st.altKey,data:this.computePosition_(ht?{x:ht.clientX-Mt.left,y:ht.clientY-Mt.top}:void 0),sender:this,shiftKey:st.shiftKey}),this.lastTouch_=ht}onTouchMove_(st){const ht=st.targetTouches.item(0),Mt=this.elem_.getBoundingClientRect();this.emitter.emit("move",{altKey:st.altKey,data:this.computePosition_(ht?{x:ht.clientX-Mt.left,y:ht.clientY-Mt.top}:void 0),sender:this,shiftKey:st.shiftKey}),this.lastTouch_=ht}onTouchEnd_(st){var ht;const Mt=(ht=st.targetTouches.item(0))!==null&&ht!==void 0?ht:this.lastTouch_,Ht=this.elem_.getBoundingClientRect();this.emitter.emit("up",{altKey:st.altKey,data:this.computePosition_(Mt?{x:Mt.clientX-Ht.left,y:Mt.clientY-Ht.top}:void 0),sender:this,shiftKey:st.shiftKey})}}function vo(At,st,ht,Mt,Ht){return Mt+(At-st)/(ht-st)*(Ht-Mt)}function Uw(At){return String(At.toFixed(10)).split(".")[1].replace(/0+$/,"").length}function Vs(At,st,ht){return Math.min(Math.max(At,st),ht)}function l0(At,st){return(At%st+st)%st}const sp=bn("txt");class s_{constructor(st,ht){this.onChange_=this.onChange_.bind(this),this.props_=ht.props,this.props_.emitter.on("change",this.onChange_),this.element=st.createElement("div"),this.element.classList.add(sp(),sp(void 0,"num")),ht.arrayPosition&&this.element.classList.add(sp(void 0,ht.arrayPosition)),ht.viewProps.bindClassModifiers(this.element);const Mt=st.createElement("input");Mt.classList.add(sp("i")),Mt.type="text",ht.viewProps.bindDisabled(Mt),this.element.appendChild(Mt),this.inputElement=Mt,this.onDraggingChange_=this.onDraggingChange_.bind(this),this.dragging_=ht.dragging,this.dragging_.emitter.on("change",this.onDraggingChange_),this.element.classList.add(sp()),this.inputElement.classList.add(sp("i"));const Ht=st.createElement("div");Ht.classList.add(sp("k")),this.element.appendChild(Ht),this.knobElement=Ht;const hn=st.createElementNS(zn,"svg");hn.classList.add(sp("g")),this.knobElement.appendChild(hn);const Rn=st.createElementNS(zn,"path");Rn.classList.add(sp("gb")),hn.appendChild(Rn),this.guideBodyElem_=Rn;const lr=st.createElementNS(zn,"path");lr.classList.add(sp("gh")),hn.appendChild(lr),this.guideHeadElem_=lr;const Nr=st.createElement("div");Nr.classList.add(bn("tt")()),this.knobElement.appendChild(Nr),this.tooltipElem_=Nr,ht.value.emitter.on("change",this.onChange_),this.value=ht.value,this.refresh()}onDraggingChange_(st){if(st.rawValue===null)return void this.element.classList.remove(sp(void 0,"drg"));this.element.classList.add(sp(void 0,"drg"));const ht=st.rawValue/this.props_.get("draggingScale"),Mt=ht+(ht>0?-1:ht<0?1:0),Ht=Vs(-Mt,-4,4);this.guideHeadElem_.setAttributeNS(null,"d",[`M ${Mt+Ht},0 L${Mt},4 L${Mt+Ht},8`,`M ${ht},-1 L${ht},9`].join(" ")),this.guideBodyElem_.setAttributeNS(null,"d",`M 0,4 L${ht},4`);const hn=this.props_.get("formatter");this.tooltipElem_.textContent=hn(this.value.rawValue),this.tooltipElem_.style.left=`${ht}px`}refresh(){const st=this.props_.get("formatter");this.inputElement.value=st(this.value.rawValue)}onChange_(){this.refresh()}}class Tl{constructor(st,ht){this.originRawValue_=0,this.onInputChange_=this.onInputChange_.bind(this),this.onInputKeyDown_=this.onInputKeyDown_.bind(this),this.onInputKeyUp_=this.onInputKeyUp_.bind(this),this.onPointerDown_=this.onPointerDown_.bind(this),this.onPointerMove_=this.onPointerMove_.bind(this),this.onPointerUp_=this.onPointerUp_.bind(this),this.baseStep_=ht.baseStep,this.parser_=ht.parser,this.props=ht.props,this.value=ht.value,this.viewProps=ht.viewProps,this.dragging_=pn(null),this.view=new s_(st,{arrayPosition:ht.arrayPosition,dragging:this.dragging_,props:this.props,value:this.value,viewProps:this.viewProps}),this.view.inputElement.addEventListener("change",this.onInputChange_),this.view.inputElement.addEventListener("keydown",this.onInputKeyDown_),this.view.inputElement.addEventListener("keyup",this.onInputKeyUp_);const Mt=new tu(this.view.knobElement);Mt.emitter.on("down",this.onPointerDown_),Mt.emitter.on("move",this.onPointerMove_),Mt.emitter.on("up",this.onPointerUp_)}onInputChange_(st){const ht=st.currentTarget.value,Mt=this.parser_(ht);Vt(Mt)||(this.value.rawValue=Mt),this.view.refresh()}onInputKeyDown_(st){const ht=vu(this.baseStep_,Mv(st));ht!==0&&this.value.setRawValue(this.value.rawValue+ht,{forceEmit:!1,last:!1})}onInputKeyUp_(st){vu(this.baseStep_,Mv(st))!==0&&this.value.setRawValue(this.value.rawValue,{forceEmit:!0,last:!0})}onPointerDown_(){this.originRawValue_=this.value.rawValue,this.dragging_.rawValue=0}computeDraggingValue_(st){if(!st.point)return null;const ht=st.point.x-st.bounds.width/2;return this.originRawValue_+ht*this.props.get("draggingScale")}onPointerMove_(st){const ht=this.computeDraggingValue_(st.data);ht!==null&&(this.value.setRawValue(ht,{forceEmit:!1,last:!1}),this.dragging_.rawValue=this.value.rawValue-this.originRawValue_)}onPointerUp_(st){const ht=this.computeDraggingValue_(st.data);ht!==null&&(this.value.setRawValue(ht,{forceEmit:!0,last:!0}),this.dragging_.rawValue=null)}}const o_=bn("sld");class x1{constructor(st,ht){this.onChange_=this.onChange_.bind(this),this.props_=ht.props,this.props_.emitter.on("change",this.onChange_),this.element=st.createElement("div"),this.element.classList.add(o_()),ht.viewProps.bindClassModifiers(this.element);const Mt=st.createElement("div");Mt.classList.add(o_("t")),ht.viewProps.bindTabIndex(Mt),this.element.appendChild(Mt),this.trackElement=Mt;const Ht=st.createElement("div");Ht.classList.add(o_("k")),this.trackElement.appendChild(Ht),this.knobElement=Ht,ht.value.emitter.on("change",this.onChange_),this.value=ht.value,this.update_()}update_(){const st=Vs(vo(this.value.rawValue,this.props_.get("minValue"),this.props_.get("maxValue"),0,100),0,100);this.knobElement.style.width=`${st}%`}onChange_(){this.update_()}}class BS{constructor(st,ht){this.onKeyDown_=this.onKeyDown_.bind(this),this.onKeyUp_=this.onKeyUp_.bind(this),this.onPointerDownOrMove_=this.onPointerDownOrMove_.bind(this),this.onPointerUp_=this.onPointerUp_.bind(this),this.baseStep_=ht.baseStep,this.value=ht.value,this.viewProps=ht.viewProps,this.props=ht.props,this.view=new x1(st,{props:this.props,value:this.value,viewProps:this.viewProps}),this.ptHandler_=new tu(this.view.trackElement),this.ptHandler_.emitter.on("down",this.onPointerDownOrMove_),this.ptHandler_.emitter.on("move",this.onPointerDownOrMove_),this.ptHandler_.emitter.on("up",this.onPointerUp_),this.view.trackElement.addEventListener("keydown",this.onKeyDown_),this.view.trackElement.addEventListener("keyup",this.onKeyUp_)}handlePointerEvent_(st,ht){st.point&&this.value.setRawValue(vo(Vs(st.point.x,0,st.bounds.width),0,st.bounds.width,this.props.get("minValue"),this.props.get("maxValue")),ht)}onPointerDownOrMove_(st){this.handlePointerEvent_(st.data,{forceEmit:!1,last:!1})}onPointerUp_(st){this.handlePointerEvent_(st.data,{forceEmit:!0,last:!0})}onKeyDown_(st){const ht=vu(this.baseStep_,Nl(st));ht!==0&&this.value.setRawValue(this.value.rawValue+ht,{forceEmit:!1,last:!1})}onKeyUp_(st){vu(this.baseStep_,Nl(st))!==0&&this.value.setRawValue(this.value.rawValue,{forceEmit:!0,last:!0})}}const Fp=bn("sldtxt");class Fw{constructor(st,ht){this.element=st.createElement("div"),this.element.classList.add(Fp());const Mt=st.createElement("div");Mt.classList.add(Fp("s")),this.sliderView_=ht.sliderView,Mt.appendChild(this.sliderView_.element),this.element.appendChild(Mt);const Ht=st.createElement("div");Ht.classList.add(Fp("t")),this.textView_=ht.textView,Ht.appendChild(this.textView_.element),this.element.appendChild(Ht)}}class Ho{constructor(st,ht){this.value=ht.value,this.viewProps=ht.viewProps,this.sliderC_=new BS(st,{baseStep:ht.baseStep,props:ht.sliderProps,value:ht.value,viewProps:this.viewProps}),this.textC_=new Tl(st,{baseStep:ht.baseStep,parser:ht.parser,props:ht.textProps,value:ht.value,viewProps:ht.viewProps}),this.view=new Fw(st,{sliderView:this.sliderC_.view,textView:this.textC_.view})}get sliderController(){return this.sliderC_}get textController(){return this.textC_}}function c0(At,st){At.write(st)}function a_(At){const st=Vr;return Array.isArray(At)?st.required.array(st.required.object({text:st.required.string,value:st.required.raw}))(At).value:typeof At=="object"?st.required.raw(At).value:void 0}function Tu(At){if(At==="inline"||At==="popup")return At}function jp(At){const st=Vr;return st.required.object({max:st.optional.number,min:st.optional.number,step:st.optional.number})(At).value}function Iu(At){if(Array.isArray(At))return At;const st=[];return Object.keys(At).forEach(ht=>{st.push({text:ht,value:At[ht]})}),st}function l_(At){return Vt(At)?null:new wv(Iu(At))}function sA(At){const st=At?ip(At,wv):null;return st?st.options:null}function Ey(At,st){const ht=At&&ip(At,wp);return ht?Uw(ht.step):Math.max(Uw(st),2)}function u0(At){const st=function(ht){const Mt=ht?ip(ht,wp):null;return Mt?Mt.step:null}(At);return st??1}function h0(At,st){var ht;const Mt=At&&ip(At,wp),Ht=Math.abs((ht=Mt==null?void 0:Mt.step)!==null&&ht!==void 0?ht:st);return Ht===0?.1:Math.pow(10,Math.floor(Math.log10(Ht))-1)}const Wo=bn("ckb");class b1{constructor(st,ht){this.onValueChange_=this.onValueChange_.bind(this),this.element=st.createElement("div"),this.element.classList.add(Wo()),ht.viewProps.bindClassModifiers(this.element);const Mt=st.createElement("label");Mt.classList.add(Wo("l")),this.element.appendChild(Mt);const Ht=st.createElement("input");Ht.classList.add(Wo("i")),Ht.type="checkbox",Mt.appendChild(Ht),this.inputElement=Ht,ht.viewProps.bindDisabled(this.inputElement);const hn=st.createElement("div");hn.classList.add(Wo("w")),Mt.appendChild(hn);const Rn=Kt(st,"check");hn.appendChild(Rn),ht.value.emitter.on("change",this.onValueChange_),this.value=ht.value,this.update_()}update_(){this.inputElement.checked=this.value.rawValue}onValueChange_(){this.update_()}}class kS{constructor(st,ht){this.onInputChange_=this.onInputChange_.bind(this),this.value=ht.value,this.viewProps=ht.viewProps,this.view=new b1(st,{value:this.value,viewProps:this.viewProps}),this.view.inputElement.addEventListener("change",this.onInputChange_)}onInputChange_(st){const ht=st.currentTarget;this.value.rawValue=ht.checked}}const Sy={id:"input-bool",type:"input",accept:(At,st)=>{if(typeof At!="boolean")return null;const ht=yr(st,{options:Vr.optional.custom(a_)});return ht?{initialValue:At,params:ht}:null},binding:{reader:At=>qs,constraint:At=>function(st){const ht=[],Mt=l_(st.options);return Mt&&ht.push(Mt),new yv(ht)}(At.params),writer:At=>c0},controller:At=>{var st;const ht=At.document,Mt=At.value,Ht=At.constraint;return Ht&&ip(Ht,wv)?new eu(ht,{props:er.fromObject({options:(st=sA(Ht))!==null&&st!==void 0?st:[]}),value:Mt,viewProps:At.viewProps}):new kS(ht,{value:Mt,viewProps:At.viewProps})}},hm=bn("col");class c_{constructor(st,ht){this.element=st.createElement("div"),this.element.classList.add(hm()),ht.foldable.bindExpandedClass(this.element,hm(void 0,"expanded")),Yt(ht.foldable,"completed",Bn(this.element,hm(void 0,"cpl")));const Mt=st.createElement("div");Mt.classList.add(hm("h")),this.element.appendChild(Mt);const Ht=st.createElement("div");Ht.classList.add(hm("s")),Mt.appendChild(Ht),this.swatchElement=Ht;const hn=st.createElement("div");if(hn.classList.add(hm("t")),Mt.appendChild(hn),this.textElement=hn,ht.pickerLayout==="inline"){const Rn=st.createElement("div");Rn.classList.add(hm("p")),this.element.appendChild(Rn),this.pickerElement=Rn}else this.pickerElement=null}}function op(At,st,ht){const Mt=l0(At,360),Ht=Vs(st/100,0,1),hn=Vs(ht/100,0,1),Rn=hn*Ht,lr=Rn*(1-Math.abs(Mt/60%2-1)),Nr=hn-Rn;let ds,ws,fs;return[ds,ws,fs]=Mt>=0&&Mt<60?[Rn,lr,0]:Mt>=60&&Mt<120?[lr,Rn,0]:Mt>=120&&Mt<180?[0,Rn,lr]:Mt>=180&&Mt<240?[0,lr,Rn]:Mt>=240&&Mt<300?[lr,0,Rn]:[Rn,0,lr],[255*(ds+Nr),255*(ws+Nr),255*(fs+Nr)]}function Il(At){return[At[0],At[1],At[2]]}function Cy(At,st){return[At[0],At[1],At[2],st]}const d0={hsl:{hsl:(At,st,ht)=>[At,st,ht],hsv:function(At,st,ht){const Mt=ht+st*(100-Math.abs(2*ht-100))/200;return[At,Mt!==0?st*(100-Math.abs(2*ht-100))/Mt:0,ht+st*(100-Math.abs(2*ht-100))/200]},rgb:function(At,st,ht){const Mt=(At%360+360)%360,Ht=Vs(st/100,0,1),hn=Vs(ht/100,0,1),Rn=(1-Math.abs(2*hn-1))*Ht,lr=Rn*(1-Math.abs(Mt/60%2-1)),Nr=hn-Rn/2;let ds,ws,fs;return[ds,ws,fs]=Mt>=0&&Mt<60?[Rn,lr,0]:Mt>=60&&Mt<120?[lr,Rn,0]:Mt>=120&&Mt<180?[0,Rn,lr]:Mt>=180&&Mt<240?[0,lr,Rn]:Mt>=240&&Mt<300?[lr,0,Rn]:[Rn,0,lr],[255*(ds+Nr),255*(ws+Nr),255*(fs+Nr)]}},hsv:{hsl:function(At,st,ht){const Mt=100-Math.abs(ht*(200-st)/100-100);return[At,Mt!==0?st*ht/Mt:0,ht*(200-st)/200]},hsv:(At,st,ht)=>[At,st,ht],rgb:op},rgb:{hsl:function(At,st,ht){const Mt=Vs(At/255,0,1),Ht=Vs(st/255,0,1),hn=Vs(ht/255,0,1),Rn=Math.max(Mt,Ht,hn),lr=Math.min(Mt,Ht,hn),Nr=Rn-lr;let ds=0,ws=0;const fs=(lr+Rn)/2;return Nr!==0&&(ws=Nr/(1-Math.abs(Rn+lr-1)),ds=Mt===Rn?(Ht-hn)/Nr:Ht===Rn?2+(hn-Mt)/Nr:4+(Mt-Ht)/Nr,ds=ds/6+(ds<0?1:0)),[360*ds,100*ws,100*fs]},hsv:function(At,st,ht){const Mt=Vs(At/255,0,1),Ht=Vs(st/255,0,1),hn=Vs(ht/255,0,1),Rn=Math.max(Mt,Ht,hn),lr=Rn-Math.min(Mt,Ht,hn);let Nr;return Nr=lr===0?0:Rn===Mt?((Ht-hn)/lr%6+6)%6*60:Rn===Ht?60*((hn-Mt)/lr+2):60*((Mt-Ht)/lr+4),[Nr,100*(Rn===0?0:lr/Rn),100*Rn]},rgb:(At,st,ht)=>[At,st,ht]}},oA={hsl:At=>{var st;return[l0(At[0],360),Vs(At[1],0,100),Vs(At[2],0,100),Vs((st=At[3])!==null&&st!==void 0?st:1,0,1)]},hsv:At=>{var st;return[l0(At[0],360),Vs(At[1],0,100),Vs(At[2],0,100),Vs((st=At[3])!==null&&st!==void 0?st:1,0,1)]},rgb:At=>{var st;return[Vs(At[0],0,255),Vs(At[1],0,255),Vs(At[2],0,255),Vs((st=At[3])!==null&&st!==void 0?st:1,0,1)]}};function Es(At,st){return typeof At=="object"&&!Vt(At)&&st in At&&typeof At[st]=="number"}class As{constructor(st,ht){this.mode_=ht,this.comps_=oA[ht](st)}static black(){return new As([0,0,0],"rgb")}static fromObject(st){const ht="a"in st?[st.r,st.g,st.b,st.a]:[st.r,st.g,st.b];return new As(ht,"rgb")}static toRgbaObject(st){return st.toRgbaObject()}static isRgbColorObject(st){return Es(st,"r")&&Es(st,"g")&&Es(st,"b")}static isRgbaColorObject(st){return this.isRgbColorObject(st)&&Es(st,"a")}static isColorObject(st){return this.isRgbColorObject(st)}static equals(st,ht){if(st.mode_!==ht.mode_)return!1;const Mt=st.comps_,Ht=ht.comps_;for(let hn=0;hn<Mt.length;hn++)if(Mt[hn]!==Ht[hn])return!1;return!0}get mode(){return this.mode_}getComponents(st){return Cy((ht=Il(this.comps_),Mt=this.mode_,Ht=st||this.mode_,d0[Mt][Ht](...ht)),this.comps_[3]);var ht,Mt,Ht}toRgbaObject(){const st=this.getComponents("rgb");return{r:st[0],g:st[1],b:st[2],a:st[3]}}}const dm=bn("colp");class aA{constructor(st,ht){this.alphaViews_=null,this.element=st.createElement("div"),this.element.classList.add(dm());const Mt=st.createElement("div");Mt.classList.add(dm("hsv"));const Ht=st.createElement("div");Ht.classList.add(dm("sv")),this.svPaletteView_=ht.svPaletteView,Ht.appendChild(this.svPaletteView_.element),Mt.appendChild(Ht);const hn=st.createElement("div");hn.classList.add(dm("h")),this.hPaletteView_=ht.hPaletteView,hn.appendChild(this.hPaletteView_.element),Mt.appendChild(hn),this.element.appendChild(Mt);const Rn=st.createElement("div");if(Rn.classList.add(dm("rgb")),this.textView_=ht.textView,Rn.appendChild(this.textView_.element),this.element.appendChild(Rn),ht.alphaViews){this.alphaViews_={palette:ht.alphaViews.palette,text:ht.alphaViews.text};const lr=st.createElement("div");lr.classList.add(dm("a"));const Nr=st.createElement("div");Nr.classList.add(dm("ap")),Nr.appendChild(this.alphaViews_.palette.element),lr.appendChild(Nr);const ds=st.createElement("div");ds.classList.add(dm("at")),ds.appendChild(this.alphaViews_.text.element),lr.appendChild(ds),this.element.appendChild(lr)}}get allFocusableElements(){const st=[this.svPaletteView_.element,this.hPaletteView_.element,this.textView_.modeSelectElement,...this.textView_.textViews.map(ht=>ht.inputElement)];return this.alphaViews_&&st.push(this.alphaViews_.palette.element,this.alphaViews_.text.inputElement),st}}function lA(At){const st=Vr;return yr(At,{alpha:st.optional.boolean,expanded:st.optional.boolean,picker:st.optional.custom(Tu)})}function Tv(At){return At?.1:1}function Du(At,st){const ht=At.match(/^(.+)%$/);return Math.min(ht?.01*parseFloat(ht[1])*st:parseFloat(At),st)}const Um={deg:At=>At,grad:At=>360*At/400,rad:At=>360*At/(2*Math.PI),turn:At=>360*At};function Po(At){const st=At.match(/^([0-9.]+?)(deg|grad|rad|turn)$/);if(!st)return parseFloat(At);const ht=parseFloat(st[1]),Mt=st[2];return Um[Mt](ht)}const jw={"func.rgb":At=>{const st=At.match(/^rgb\(\s*([0-9A-Fa-f.]+%?)\s*,\s*([0-9A-Fa-f.]+%?)\s*,\s*([0-9A-Fa-f.]+%?)\s*\)$/);if(!st)return null;const ht=[Du(st[1],255),Du(st[2],255),Du(st[3],255)];return isNaN(ht[0])||isNaN(ht[1])||isNaN(ht[2])?null:new As(ht,"rgb")},"func.rgba":At=>{const st=At.match(/^rgba\(\s*([0-9A-Fa-f.]+%?)\s*,\s*([0-9A-Fa-f.]+%?)\s*,\s*([0-9A-Fa-f.]+%?)\s*,\s*([0-9A-Fa-f.]+%?)\s*\)$/);if(!st)return null;const ht=[Du(st[1],255),Du(st[2],255),Du(st[3],255),Du(st[4],1)];return isNaN(ht[0])||isNaN(ht[1])||isNaN(ht[2])||isNaN(ht[3])?null:new As(ht,"rgb")},"func.hsl":At=>{const st=At.match(/^hsl\(\s*([0-9A-Fa-f.]+(?:deg|grad|rad|turn)?)\s*,\s*([0-9A-Fa-f.]+%?)\s*,\s*([0-9A-Fa-f.]+%?)\s*\)$/);if(!st)return null;const ht=[Po(st[1]),Du(st[2],100),Du(st[3],100)];return isNaN(ht[0])||isNaN(ht[1])||isNaN(ht[2])?null:new As(ht,"hsl")},"func.hsla":At=>{const st=At.match(/^hsla\(\s*([0-9A-Fa-f.]+(?:deg|grad|rad|turn)?)\s*,\s*([0-9A-Fa-f.]+%?)\s*,\s*([0-9A-Fa-f.]+%?)\s*,\s*([0-9A-Fa-f.]+%?)\s*\)$/);if(!st)return null;const ht=[Po(st[1]),Du(st[2],100),Du(st[3],100),Du(st[4],1)];return isNaN(ht[0])||isNaN(ht[1])||isNaN(ht[2])||isNaN(ht[3])?null:new As(ht,"hsl")},"hex.rgb":At=>{const st=At.match(/^#([0-9A-Fa-f])([0-9A-Fa-f])([0-9A-Fa-f])$/);if(st)return new As([parseInt(st[1]+st[1],16),parseInt(st[2]+st[2],16),parseInt(st[3]+st[3],16)],"rgb");const ht=At.match(/^(?:#|0x)([0-9A-Fa-f]{2})([0-9A-Fa-f]{2})([0-9A-Fa-f]{2})$/);return ht?new As([parseInt(ht[1],16),parseInt(ht[2],16),parseInt(ht[3],16)],"rgb"):null},"hex.rgba":At=>{const st=At.match(/^#?([0-9A-Fa-f])([0-9A-Fa-f])([0-9A-Fa-f])([0-9A-Fa-f])$/);if(st)return new As([parseInt(st[1]+st[1],16),parseInt(st[2]+st[2],16),parseInt(st[3]+st[3],16),vo(parseInt(st[4]+st[4],16),0,255,0,1)],"rgb");const ht=At.match(/^(?:#|0x)?([0-9A-Fa-f]{2})([0-9A-Fa-f]{2})([0-9A-Fa-f]{2})([0-9A-Fa-f]{2})$/);return ht?new As([parseInt(ht[1],16),parseInt(ht[2],16),parseInt(ht[3],16),vo(parseInt(ht[4],16),0,255,0,1)],"rgb"):null}};function Sr(At){return Object.keys(jw).reduce((st,ht)=>st||((0,jw[ht])(At)?ht:null),null)}const nu=At=>{const st=Sr(At);return st?jw[st](At):null};function E1(At){return At==="func.hsla"||At==="func.rgba"||At==="hex.rgba"}function OS(At){if(typeof At=="string"){const st=nu(At);if(st)return st}return As.black()}function Iv(At){const st=Vs(Math.floor(At),0,255).toString(16);return st.length===1?`0${st}`:st}function p0(At,st="#"){return`${st}${Il(At.getComponents("rgb")).map(Iv).join("")}`}function pm(At,st="#"){const ht=At.getComponents("rgb");return`${st}${[ht[0],ht[1],ht[2],255*ht[3]].map(Iv).join("")}`}function cA(At){const st=Yl(0);return`rgb(${Il(At.getComponents("rgb")).map(ht=>st(ht)).join(", ")})`}function Dv(At){const st=Yl(2),ht=Yl(0);return`rgba(${At.getComponents("rgb").map((Mt,Ht)=>(Ht===3?st:ht)(Mt)).join(", ")})`}const bp={"func.hsl":function(At){const st=[Yl(0),rA,rA];return`hsl(${Il(At.getComponents("hsl")).map((ht,Mt)=>st[Mt](ht)).join(", ")})`},"func.hsla":function(At){const st=[Yl(0),rA,rA,Yl(2)];return`hsla(${At.getComponents("hsl").map((ht,Mt)=>st[Mt](ht)).join(", ")})`},"func.rgb":cA,"func.rgba":Dv,"hex.rgb":p0,"hex.rgba":pm};function zw(At){return bp[At]}const ba=bn("apl");class zp{constructor(st,ht){this.onValueChange_=this.onValueChange_.bind(this),this.value=ht.value,this.value.emitter.on("change",this.onValueChange_),this.element=st.createElement("div"),this.element.classList.add(ba()),ht.viewProps.bindTabIndex(this.element);const Mt=st.createElement("div");Mt.classList.add(ba("b")),this.element.appendChild(Mt);const Ht=st.createElement("div");Ht.classList.add(ba("c")),Mt.appendChild(Ht),this.colorElem_=Ht;const hn=st.createElement("div");hn.classList.add(ba("m")),this.element.appendChild(hn),this.markerElem_=hn;const Rn=st.createElement("div");Rn.classList.add(ba("p")),this.markerElem_.appendChild(Rn),this.previewElem_=Rn,this.update_()}update_(){const st=this.value.rawValue,ht=st.getComponents("rgb"),Mt=new As([ht[0],ht[1],ht[2],0],"rgb"),Ht=new As([ht[0],ht[1],ht[2],255],"rgb"),hn=["to right",Dv(Mt),Dv(Ht)];this.colorElem_.style.background=`linear-gradient(${hn.join(",")})`,this.previewElem_.style.backgroundColor=Dv(st);const Rn=vo(ht[3],0,1,0,100);this.markerElem_.style.left=`${Rn}%`}onValueChange_(){this.update_()}}class My{constructor(st,ht){this.onKeyDown_=this.onKeyDown_.bind(this),this.onKeyUp_=this.onKeyUp_.bind(this),this.onPointerDown_=this.onPointerDown_.bind(this),this.onPointerMove_=this.onPointerMove_.bind(this),this.onPointerUp_=this.onPointerUp_.bind(this),this.value=ht.value,this.viewProps=ht.viewProps,this.view=new zp(st,{value:this.value,viewProps:this.viewProps}),this.ptHandler_=new tu(this.view.element),this.ptHandler_.emitter.on("down",this.onPointerDown_),this.ptHandler_.emitter.on("move",this.onPointerMove_),this.ptHandler_.emitter.on("up",this.onPointerUp_),this.view.element.addEventListener("keydown",this.onKeyDown_),this.view.element.addEventListener("keyup",this.onKeyUp_)}handlePointerEvent_(st,ht){if(!st.point)return;const Mt=st.point.x/st.bounds.width,Ht=this.value.rawValue,[hn,Rn,lr]=Ht.getComponents("hsv");this.value.setRawValue(new As([hn,Rn,lr,Mt],"hsv"),ht)}onPointerDown_(st){this.handlePointerEvent_(st.data,{forceEmit:!1,last:!1})}onPointerMove_(st){this.handlePointerEvent_(st.data,{forceEmit:!1,last:!1})}onPointerUp_(st){this.handlePointerEvent_(st.data,{forceEmit:!0,last:!0})}onKeyDown_(st){const ht=vu(Tv(!0),Nl(st));if(ht===0)return;const Mt=this.value.rawValue,[Ht,hn,Rn,lr]=Mt.getComponents("hsv");this.value.setRawValue(new As([Ht,hn,Rn,lr+ht],"hsv"),{forceEmit:!1,last:!1})}onKeyUp_(st){vu(Tv(!0),Nl(st))!==0&&this.value.setRawValue(this.value.rawValue,{forceEmit:!0,last:!0})}}const Ep=bn("coltxt");class uA{constructor(st,ht){this.element=st.createElement("div"),this.element.classList.add(Ep());const Mt=st.createElement("div");Mt.classList.add(Ep("m")),this.modeElem_=function(Rn){const lr=Rn.createElement("select");return lr.appendChild([{text:"RGB",value:"rgb"},{text:"HSL",value:"hsl"},{text:"HSV",value:"hsv"}].reduce((Nr,ds)=>{const ws=Rn.createElement("option");return ws.textContent=ds.text,ws.value=ds.value,Nr.appendChild(ws),Nr},Rn.createDocumentFragment())),lr}(st),this.modeElem_.classList.add(Ep("ms")),Mt.appendChild(this.modeSelectElement);const Ht=st.createElement("div");Ht.classList.add(Ep("mm")),Ht.appendChild(Kt(st,"dropdown")),Mt.appendChild(Ht),this.element.appendChild(Mt);const hn=st.createElement("div");hn.classList.add(Ep("w")),this.element.appendChild(hn),this.textsElem_=hn,this.textViews_=ht.textViews,this.applyTextViews_(),jt(ht.colorMode,Rn=>{this.modeElem_.value=Rn})}get modeSelectElement(){return this.modeElem_}get textViews(){return this.textViews_}set textViews(st){this.textViews_=st,this.applyTextViews_()}applyTextViews_(){Ur(this.textsElem_);const st=this.element.ownerDocument;this.textViews_.forEach(ht=>{const Mt=st.createElement("div");Mt.classList.add(Ep("c")),Mt.appendChild(ht.element),this.textsElem_.appendChild(Mt)})}}const rs=Yl(0),f0={rgb:()=>new wo({min:0,max:255}),hsl:At=>new wo(At===0?{min:0,max:360}:{min:0,max:100}),hsv:At=>new wo(At===0?{min:0,max:360}:{min:0,max:100})};function m0(At,st,ht){return new Tl(At,{arrayPosition:ht===0?"fst":ht===2?"lst":"mid",baseStep:Tv(!1),parser:st.parser,props:er.fromObject({draggingScale:1,formatter:rs}),value:pn(0,{constraint:f0[st.colorMode](ht)}),viewProps:st.viewProps})}class Sp{constructor(st,ht){this.onModeSelectChange_=this.onModeSelectChange_.bind(this),this.parser_=ht.parser,this.value=ht.value,this.viewProps=ht.viewProps,this.colorMode=pn(this.value.rawValue.mode),this.ccs_=this.createComponentControllers_(st),this.view=new uA(st,{colorMode:this.colorMode,textViews:[this.ccs_[0].view,this.ccs_[1].view,this.ccs_[2].view]}),this.view.modeSelectElement.addEventListener("change",this.onModeSelectChange_)}createComponentControllers_(st){const ht={colorMode:this.colorMode.rawValue,parser:this.parser_,viewProps:this.viewProps},Mt=[m0(st,ht,0),m0(st,ht,1),m0(st,ht,2)];return Mt.forEach((Ht,hn)=>{Cv({primary:this.value,secondary:Ht.value,forward:Rn=>Rn.rawValue.getComponents(this.colorMode.rawValue)[hn],backward:(Rn,lr)=>{const Nr=this.colorMode.rawValue,ds=Rn.rawValue.getComponents(Nr);return ds[hn]=lr.rawValue,new As(Cy(Il(ds),ds[3]),Nr)}})}),Mt}onModeSelectChange_(st){const ht=st.currentTarget;this.colorMode.rawValue=ht.value,this.ccs_=this.createComponentControllers_(this.view.element.ownerDocument),this.view.textViews=[this.ccs_[0].view,this.ccs_[1].view,this.ccs_[2].view]}}const hA=bn("hpl");class u_{constructor(st,ht){this.onValueChange_=this.onValueChange_.bind(this),this.value=ht.value,this.value.emitter.on("change",this.onValueChange_),this.element=st.createElement("div"),this.element.classList.add(hA()),ht.viewProps.bindTabIndex(this.element);const Mt=st.createElement("div");Mt.classList.add(hA("c")),this.element.appendChild(Mt);const Ht=st.createElement("div");Ht.classList.add(hA("m")),this.element.appendChild(Ht),this.markerElem_=Ht,this.update_()}update_(){const st=this.value.rawValue,[ht]=st.getComponents("hsv");this.markerElem_.style.backgroundColor=cA(new As([ht,100,100],"hsv"));const Mt=vo(ht,0,360,0,100);this.markerElem_.style.left=`${Mt}%`}onValueChange_(){this.update_()}}class qo{constructor(st,ht){this.onKeyDown_=this.onKeyDown_.bind(this),this.onKeyUp_=this.onKeyUp_.bind(this),this.onPointerDown_=this.onPointerDown_.bind(this),this.onPointerMove_=this.onPointerMove_.bind(this),this.onPointerUp_=this.onPointerUp_.bind(this),this.value=ht.value,this.viewProps=ht.viewProps,this.view=new u_(st,{value:this.value,viewProps:this.viewProps}),this.ptHandler_=new tu(this.view.element),this.ptHandler_.emitter.on("down",this.onPointerDown_),this.ptHandler_.emitter.on("move",this.onPointerMove_),this.ptHandler_.emitter.on("up",this.onPointerUp_),this.view.element.addEventListener("keydown",this.onKeyDown_),this.view.element.addEventListener("keyup",this.onKeyUp_)}handlePointerEvent_(st,ht){if(!st.point)return;const Mt=vo(Vs(st.point.x,0,st.bounds.width),0,st.bounds.width,0,359),Ht=this.value.rawValue,[,hn,Rn,lr]=Ht.getComponents("hsv");this.value.setRawValue(new As([Mt,hn,Rn,lr],"hsv"),ht)}onPointerDown_(st){this.handlePointerEvent_(st.data,{forceEmit:!1,last:!1})}onPointerMove_(st){this.handlePointerEvent_(st.data,{forceEmit:!1,last:!1})}onPointerUp_(st){this.handlePointerEvent_(st.data,{forceEmit:!0,last:!0})}onKeyDown_(st){const ht=vu(Tv(!1),Nl(st));if(ht===0)return;const Mt=this.value.rawValue,[Ht,hn,Rn,lr]=Mt.getComponents("hsv");this.value.setRawValue(new As([Ht+ht,hn,Rn,lr],"hsv"),{forceEmit:!1,last:!1})}onKeyUp_(st){vu(Tv(!1),Nl(st))!==0&&this.value.setRawValue(this.value.rawValue,{forceEmit:!0,last:!0})}}const _o=bn("svp");class ap{constructor(st,ht){this.onValueChange_=this.onValueChange_.bind(this),this.value=ht.value,this.value.emitter.on("change",this.onValueChange_),this.element=st.createElement("div"),this.element.classList.add(_o()),ht.viewProps.bindTabIndex(this.element);const Mt=st.createElement("canvas");Mt.height=64,Mt.width=64,Mt.classList.add(_o("c")),this.element.appendChild(Mt),this.canvasElement=Mt;const Ht=st.createElement("div");Ht.classList.add(_o("m")),this.element.appendChild(Ht),this.markerElem_=Ht,this.update_()}update_(){const st=function(ds){const ws=ds.ownerDocument.defaultView;return ws&&"document"in ws?ds.getContext("2d"):null}(this.canvasElement);if(!st)return;const ht=this.value.rawValue.getComponents("hsv"),Mt=this.canvasElement.width,Ht=this.canvasElement.height,hn=st.getImageData(0,0,Mt,Ht),Rn=hn.data;for(let ds=0;ds<Ht;ds++)for(let ws=0;ws<Mt;ws++){const fs=vo(ws,0,Mt,0,100),Pu=vo(ds,0,Ht,100,0),Bo=op(ht[0],fs,Pu),Qp=4*(ds*Mt+ws);Rn[Qp]=Bo[0],Rn[Qp+1]=Bo[1],Rn[Qp+2]=Bo[2],Rn[Qp+3]=255}st.putImageData(hn,0,0);const lr=vo(ht[1],0,100,0,100);this.markerElem_.style.left=`${lr}%`;const Nr=vo(ht[2],0,100,100,0);this.markerElem_.style.top=`${Nr}%`}onValueChange_(){this.update_()}}class h_{constructor(st,ht){this.onKeyDown_=this.onKeyDown_.bind(this),this.onKeyUp_=this.onKeyUp_.bind(this),this.onPointerDown_=this.onPointerDown_.bind(this),this.onPointerMove_=this.onPointerMove_.bind(this),this.onPointerUp_=this.onPointerUp_.bind(this),this.value=ht.value,this.viewProps=ht.viewProps,this.view=new ap(st,{value:this.value,viewProps:this.viewProps}),this.ptHandler_=new tu(this.view.element),this.ptHandler_.emitter.on("down",this.onPointerDown_),this.ptHandler_.emitter.on("move",this.onPointerMove_),this.ptHandler_.emitter.on("up",this.onPointerUp_),this.view.element.addEventListener("keydown",this.onKeyDown_),this.view.element.addEventListener("keyup",this.onKeyUp_)}handlePointerEvent_(st,ht){if(!st.point)return;const Mt=vo(st.point.x,0,st.bounds.width,0,100),Ht=vo(st.point.y,0,st.bounds.height,100,0),[hn,,,Rn]=this.value.rawValue.getComponents("hsv");this.value.setRawValue(new As([hn,Mt,Ht,Rn],"hsv"),ht)}onPointerDown_(st){this.handlePointerEvent_(st.data,{forceEmit:!1,last:!1})}onPointerMove_(st){this.handlePointerEvent_(st.data,{forceEmit:!1,last:!1})}onPointerUp_(st){this.handlePointerEvent_(st.data,{forceEmit:!0,last:!0})}onKeyDown_(st){by(st.key)&&st.preventDefault();const[ht,Mt,Ht,hn]=this.value.rawValue.getComponents("hsv"),Rn=Tv(!1),lr=vu(Rn,Nl(st)),Nr=vu(Rn,Mv(st));lr===0&&Nr===0||this.value.setRawValue(new As([ht,Mt+lr,Ht+Nr,hn],"hsv"),{forceEmit:!1,last:!1})}onKeyUp_(st){const ht=Tv(!1),Mt=vu(ht,Nl(st)),Ht=vu(ht,Mv(st));Mt===0&&Ht===0||this.value.setRawValue(this.value.rawValue,{forceEmit:!0,last:!0})}}class Vw{constructor(st,ht){this.value=ht.value,this.viewProps=ht.viewProps,this.hPaletteC_=new qo(st,{value:this.value,viewProps:this.viewProps}),this.svPaletteC_=new h_(st,{value:this.value,viewProps:this.viewProps}),this.alphaIcs_=ht.supportsAlpha?{palette:new My(st,{value:this.value,viewProps:this.viewProps}),text:new Tl(st,{parser:Do,baseStep:.1,props:er.fromObject({draggingScale:.01,formatter:Yl(2)}),value:pn(0,{constraint:new wo({min:0,max:1})}),viewProps:this.viewProps})}:null,this.alphaIcs_&&Cv({primary:this.value,secondary:this.alphaIcs_.text.value,forward:Mt=>Mt.rawValue.getComponents()[3],backward:(Mt,Ht)=>{const hn=Mt.rawValue.getComponents();return hn[3]=Ht.rawValue,new As(hn,Mt.rawValue.mode)}}),this.textC_=new Sp(st,{parser:Do,value:this.value,viewProps:this.viewProps}),this.view=new aA(st,{alphaViews:this.alphaIcs_?{palette:this.alphaIcs_.palette.view,text:this.alphaIcs_.text.view}:null,hPaletteView:this.hPaletteC_.view,supportsAlpha:ht.supportsAlpha,svPaletteView:this.svPaletteC_.view,textView:this.textC_.view})}get textController(){return this.textC_}}const d_=bn("colsw");class S1{constructor(st,ht){this.onValueChange_=this.onValueChange_.bind(this),ht.value.emitter.on("change",this.onValueChange_),this.value=ht.value,this.element=st.createElement("div"),this.element.classList.add(d_()),ht.viewProps.bindClassModifiers(this.element);const Mt=st.createElement("div");Mt.classList.add(d_("sw")),this.element.appendChild(Mt),this.swatchElem_=Mt;const Ht=st.createElement("button");Ht.classList.add(d_("b")),ht.viewProps.bindDisabled(Ht),this.element.appendChild(Ht),this.buttonElement=Ht,this.update_()}update_(){const st=this.value.rawValue;this.swatchElem_.style.backgroundColor=pm(st)}onValueChange_(){this.update_()}}class C1{constructor(st,ht){this.value=ht.value,this.viewProps=ht.viewProps,this.view=new S1(st,{value:this.value,viewProps:this.viewProps})}}class iu{constructor(st,ht){this.onButtonBlur_=this.onButtonBlur_.bind(this),this.onButtonClick_=this.onButtonClick_.bind(this),this.onPopupChildBlur_=this.onPopupChildBlur_.bind(this),this.onPopupChildKeydown_=this.onPopupChildKeydown_.bind(this),this.value=ht.value,this.viewProps=ht.viewProps,this.foldable_=Js.create(ht.expanded),this.swatchC_=new C1(st,{value:this.value,viewProps:this.viewProps});const Mt=this.swatchC_.view.buttonElement;Mt.addEventListener("blur",this.onButtonBlur_),Mt.addEventListener("click",this.onButtonClick_),this.textC_=new uo(st,{parser:ht.parser,props:er.fromObject({formatter:ht.formatter}),value:this.value,viewProps:this.viewProps}),this.view=new c_(st,{foldable:this.foldable_,pickerLayout:ht.pickerLayout}),this.view.swatchElement.appendChild(this.swatchC_.view.element),this.view.textElement.appendChild(this.textC_.view.element),this.popC_=ht.pickerLayout==="popup"?new ss(st,{viewProps:this.viewProps}):null;const Ht=new Vw(st,{supportsAlpha:ht.supportsAlpha,value:this.value,viewProps:this.viewProps});Ht.view.allFocusableElements.forEach(hn=>{hn.addEventListener("blur",this.onPopupChildBlur_),hn.addEventListener("keydown",this.onPopupChildKeydown_)}),this.pickerC_=Ht,this.popC_?(this.view.element.appendChild(this.popC_.view.element),this.popC_.view.element.appendChild(Ht.view.element),Cv({primary:this.foldable_.value("expanded"),secondary:this.popC_.shows,forward:hn=>hn.rawValue,backward:(hn,Rn)=>Rn.rawValue})):this.view.pickerElement&&(this.view.pickerElement.appendChild(this.pickerC_.view.element),yo(this.foldable_,this.view.pickerElement))}get textController(){return this.textC_}onButtonBlur_(st){if(!this.popC_)return;const ht=this.view.element,Mt=st.relatedTarget;Mt&&ht.contains(Mt)||(this.popC_.shows.rawValue=!1)}onButtonClick_(){this.foldable_.set("expanded",!this.foldable_.get("expanded")),this.foldable_.get("expanded")&&this.pickerC_.view.allFocusableElements[0].focus()}onPopupChildBlur_(st){if(!this.popC_)return;const ht=this.popC_.view.element,Mt=kr(st);Mt&&ht.contains(Mt)||Mt&&Mt===this.swatchC_.view.buttonElement&&!$n(ht.ownerDocument)||(this.popC_.shows.rawValue=!1)}onPopupChildKeydown_(st){this.popC_?st.key==="Escape"&&(this.popC_.shows.rawValue=!1):this.view.pickerElement&&st.key==="Escape"&&this.swatchC_.view.buttonElement.focus()}}function fn(At){return As.isColorObject(At)?As.fromObject(At):As.black()}function Ty(At){return Il(At.getComponents("rgb")).reduce((st,ht)=>st<<8|255&Math.floor(ht),0)}function dA(At){return At.getComponents("rgb").reduce((st,ht,Mt)=>st<<8|255&Math.floor(Mt===3?255*ht:ht),0)>>>0}function Xl(At){return typeof At!="number"?As.black():new As([(st=At)>>16&255,st>>8&255,255&st],"rgb");var st}function fm(At){return typeof At!="number"?As.black():new As([(st=At)>>24&255,st>>16&255,st>>8&255,vo(255&st,0,255,0,1)],"rgb");var st}function lp(At,st){const ht=st.toRgbaObject();At.writeProperty("r",ht.r),At.writeProperty("g",ht.g),At.writeProperty("b",ht.b),At.writeProperty("a",ht.a)}function Fm(At,st){const ht=st.toRgbaObject();At.writeProperty("r",ht.r),At.writeProperty("g",ht.g),At.writeProperty("b",ht.b)}function Kl(At){return"alpha"in At&&At.alpha===!0}function p_(At){return At?st=>pm(st,"0x"):st=>p0(st,"0x")}const f_={id:"input-color-number",type:"input",accept:(At,st)=>{if(typeof At!="number"||!("view"in st)||st.view!=="color")return null;const ht=lA(st);return ht?{initialValue:At,params:ht}:null},binding:{reader:At=>Kl(At.params)?fm:Xl,equals:As.equals,writer:At=>function(st){const ht=st?dA:Ty;return(Mt,Ht)=>{c0(Mt,ht(Ht))}}(Kl(At.params))},controller:At=>{const st=Kl(At.params),ht="expanded"in At.params?At.params.expanded:void 0,Mt="picker"in At.params?At.params.picker:void 0;return new iu(At.document,{expanded:ht!=null&&ht,formatter:p_(st),parser:nu,pickerLayout:Mt??"popup",supportsAlpha:st,value:At.value,viewProps:At.viewProps})}},Pv={id:"input-color-object",type:"input",accept:(At,st)=>{if(!As.isColorObject(At))return null;const ht=lA(st);return ht?{initialValue:At,params:ht}:null},binding:{reader:At=>fn,equals:As.equals,writer:At=>{return st=At.initialValue,As.isRgbaColorObject(st)?lp:Fm;var st}},controller:At=>{const st=As.isRgbaColorObject(At.initialValue),ht="expanded"in At.params?At.params.expanded:void 0,Mt="picker"in At.params?At.params.picker:void 0,Ht=st?pm:p0;return new iu(At.document,{expanded:ht!=null&&ht,formatter:Ht,parser:nu,pickerLayout:Mt??"popup",supportsAlpha:st,value:At.value,viewProps:At.viewProps})}},jm={id:"input-color-string",type:"input",accept:(At,st)=>{if(typeof At!="string"||"view"in st&&st.view==="text"||!Sr(At))return null;const ht=lA(st);return ht?{initialValue:At,params:ht}:null},binding:{reader:At=>OS,equals:As.equals,writer:At=>{const st=Sr(At.initialValue);if(!st)throw gn.shouldNeverHappen();return function(ht){const Mt=zw(ht);return(Ht,hn)=>{c0(Ht,Mt(hn))}}(st)}},controller:At=>{const st=Sr(At.initialValue);if(!st)throw gn.shouldNeverHappen();const ht=zw(st),Mt="expanded"in At.params?At.params.expanded:void 0,Ht="picker"in At.params?At.params.picker:void 0;return new iu(At.document,{expanded:Mt!=null&&Mt,formatter:ht,parser:nu,pickerLayout:Ht??"popup",supportsAlpha:E1(st),value:At.value,viewProps:At.viewProps})}};class ru{constructor(st){this.components=st.components,this.asm_=st.assembly}constrain(st){const ht=this.asm_.toComponents(st).map((Mt,Ht)=>{var hn,Rn;return(Rn=(hn=this.components[Ht])===null||hn===void 0?void 0:hn.constrain(Mt))!==null&&Rn!==void 0?Rn:Mt});return this.asm_.fromComponents(ht)}}const Rv=bn("pndtxt");class g0{constructor(st,ht){this.textViews=ht.textViews,this.element=st.createElement("div"),this.element.classList.add(Rv()),this.textViews.forEach(Mt=>{const Ht=st.createElement("div");Ht.classList.add(Rv("a")),Ht.appendChild(Mt.element),this.element.appendChild(Ht)})}}class zm{constructor(st,ht){this.value=ht.value,this.viewProps=ht.viewProps,this.acs_=ht.axes.map((Mt,Ht)=>function(hn,Rn,lr){return new Tl(hn,{arrayPosition:lr===0?"fst":lr===Rn.axes.length-1?"lst":"mid",baseStep:Rn.axes[lr].baseStep,parser:Rn.parser,props:Rn.axes[lr].textProps,value:pn(0,{constraint:Rn.axes[lr].constraint}),viewProps:Rn.viewProps})}(st,ht,Ht)),this.acs_.forEach((Mt,Ht)=>{Cv({primary:this.value,secondary:Mt.value,forward:hn=>ht.assembly.toComponents(hn.rawValue)[Ht],backward:(hn,Rn)=>{const lr=ht.assembly.toComponents(hn.rawValue);return lr[Ht]=Rn.rawValue,ht.assembly.fromComponents(lr)}})}),this.view=new g0(st,{textViews:this.acs_.map(Mt=>Mt.view)})}}function v0(At){const st=[],ht=function(hn){return"step"in hn&&!Vt(hn.step)?new wp(hn.step):null}(At);ht&&st.push(ht);const Mt=function(hn){return"max"in hn&&!Vt(hn.max)||"min"in hn&&!Vt(hn.min)?new wo({max:hn.max,min:hn.min}):null}(At);Mt&&st.push(Mt);const Ht=l_(At.options);return Ht&&st.push(Ht),new yv(st)}function Qw(At){const[st,ht]=function(Mt){const Ht=Mt?ip(Mt,wo):null;return Ht?[Ht.minValue,Ht.maxValue]:[void 0,void 0]}(At);return[st??0,ht??100]}const LS={id:"input-number",type:"input",accept:(At,st)=>{if(typeof At!="number")return null;const ht=Vr,Mt=yr(st,{format:ht.optional.function,max:ht.optional.number,min:ht.optional.number,options:ht.optional.custom(a_),step:ht.optional.number});return Mt?{initialValue:At,params:Mt}:null},binding:{reader:At=>xp,constraint:At=>v0(At.params),writer:At=>c0},controller:At=>{var st,ht;const Mt=At.value,Ht=At.constraint;if(Ht&&ip(Ht,wv))return new eu(At.document,{props:er.fromObject({options:(st=sA(Ht))!==null&&st!==void 0?st:[]}),value:Mt,viewProps:At.viewProps});const hn=(ht="format"in At.params?At.params.format:void 0)!==null&&ht!==void 0?ht:Yl(Ey(Ht,Mt.rawValue));if(Ht&&ip(Ht,wo)){const[Rn,lr]=Qw(Ht);return new Ho(At.document,{baseStep:u0(Ht),parser:Do,sliderProps:er.fromObject({maxValue:lr,minValue:Rn}),textProps:er.fromObject({draggingScale:h0(Ht,Mt.rawValue),formatter:hn}),value:Mt,viewProps:At.viewProps})}return new Tl(At.document,{baseStep:u0(Ht),parser:Do,props:er.fromObject({draggingScale:h0(Ht,Mt.rawValue),formatter:hn}),value:Mt,viewProps:At.viewProps})}};class Vm{constructor(st=0,ht=0){this.x=st,this.y=ht}getComponents(){return[this.x,this.y]}static isObject(st){if(Vt(st))return!1;const ht=st.x,Mt=st.y;return typeof ht=="number"&&typeof Mt=="number"}static equals(st,ht){return st.x===ht.x&&st.y===ht.y}toObject(){return{x:this.x,y:this.y}}}const m_={toComponents:At=>At.getComponents(),fromComponents:At=>new Vm(...At)},Qm=bn("p2d");class Bv{constructor(st,ht){this.element=st.createElement("div"),this.element.classList.add(Qm()),ht.viewProps.bindClassModifiers(this.element),jt(ht.expanded,Bn(this.element,Qm(void 0,"expanded")));const Mt=st.createElement("div");Mt.classList.add(Qm("h")),this.element.appendChild(Mt);const Ht=st.createElement("button");Ht.classList.add(Qm("b")),Ht.appendChild(Kt(st,"p2dpad")),ht.viewProps.bindDisabled(Ht),Mt.appendChild(Ht),this.buttonElement=Ht;const hn=st.createElement("div");if(hn.classList.add(Qm("t")),Mt.appendChild(hn),this.textElement=hn,ht.pickerLayout==="inline"){const Rn=st.createElement("div");Rn.classList.add(Qm("p")),this.element.appendChild(Rn),this.pickerElement=Rn}else this.pickerElement=null}}const Ss=bn("p2dp");class Ol{constructor(st,ht){this.onFoldableChange_=this.onFoldableChange_.bind(this),this.onValueChange_=this.onValueChange_.bind(this),this.invertsY_=ht.invertsY,this.maxValue_=ht.maxValue,this.element=st.createElement("div"),this.element.classList.add(Ss()),ht.layout==="popup"&&this.element.classList.add(Ss(void 0,"p"));const Mt=st.createElement("div");Mt.classList.add(Ss("p")),ht.viewProps.bindTabIndex(Mt),this.element.appendChild(Mt),this.padElement=Mt;const Ht=st.createElementNS(zn,"svg");Ht.classList.add(Ss("g")),this.padElement.appendChild(Ht),this.svgElem_=Ht;const hn=st.createElementNS(zn,"line");hn.classList.add(Ss("ax")),hn.setAttributeNS(null,"x1","0"),hn.setAttributeNS(null,"y1","50%"),hn.setAttributeNS(null,"x2","100%"),hn.setAttributeNS(null,"y2","50%"),this.svgElem_.appendChild(hn);const Rn=st.createElementNS(zn,"line");Rn.classList.add(Ss("ax")),Rn.setAttributeNS(null,"x1","50%"),Rn.setAttributeNS(null,"y1","0"),Rn.setAttributeNS(null,"x2","50%"),Rn.setAttributeNS(null,"y2","100%"),this.svgElem_.appendChild(Rn);const lr=st.createElementNS(zn,"line");lr.classList.add(Ss("l")),lr.setAttributeNS(null,"x1","50%"),lr.setAttributeNS(null,"y1","50%"),this.svgElem_.appendChild(lr),this.lineElem_=lr;const Nr=st.createElement("div");Nr.classList.add(Ss("m")),this.padElement.appendChild(Nr),this.markerElem_=Nr,ht.value.emitter.on("change",this.onValueChange_),this.value=ht.value,this.update_()}get allFocusableElements(){return[this.padElement]}update_(){const[st,ht]=this.value.rawValue.getComponents(),Mt=this.maxValue_,Ht=vo(st,-Mt,+Mt,0,100),hn=vo(ht,-Mt,+Mt,0,100),Rn=this.invertsY_?100-hn:hn;this.lineElem_.setAttributeNS(null,"x2",`${Ht}%`),this.lineElem_.setAttributeNS(null,"y2",`${Rn}%`),this.markerElem_.style.left=`${Ht}%`,this.markerElem_.style.top=`${Rn}%`}onValueChange_(){this.update_()}onFoldableChange_(){this.update_()}}function Cp(At,st,ht){return[vu(st[0],Nl(At)),vu(st[1],Mv(At))*(ht?1:-1)]}class cp{constructor(st,ht){this.onPadKeyDown_=this.onPadKeyDown_.bind(this),this.onPadKeyUp_=this.onPadKeyUp_.bind(this),this.onPointerDown_=this.onPointerDown_.bind(this),this.onPointerMove_=this.onPointerMove_.bind(this),this.onPointerUp_=this.onPointerUp_.bind(this),this.value=ht.value,this.viewProps=ht.viewProps,this.baseSteps_=ht.baseSteps,this.maxValue_=ht.maxValue,this.invertsY_=ht.invertsY,this.view=new Ol(st,{invertsY:this.invertsY_,layout:ht.layout,maxValue:this.maxValue_,value:this.value,viewProps:this.viewProps}),this.ptHandler_=new tu(this.view.padElement),this.ptHandler_.emitter.on("down",this.onPointerDown_),this.ptHandler_.emitter.on("move",this.onPointerMove_),this.ptHandler_.emitter.on("up",this.onPointerUp_),this.view.padElement.addEventListener("keydown",this.onPadKeyDown_),this.view.padElement.addEventListener("keyup",this.onPadKeyUp_)}handlePointerEvent_(st,ht){if(!st.point)return;const Mt=this.maxValue_,Ht=vo(st.point.x,0,st.bounds.width,-Mt,+Mt),hn=vo(this.invertsY_?st.bounds.height-st.point.y:st.point.y,0,st.bounds.height,-Mt,+Mt);this.value.setRawValue(new Vm(Ht,hn),ht)}onPointerDown_(st){this.handlePointerEvent_(st.data,{forceEmit:!1,last:!1})}onPointerMove_(st){this.handlePointerEvent_(st.data,{forceEmit:!1,last:!1})}onPointerUp_(st){this.handlePointerEvent_(st.data,{forceEmit:!0,last:!0})}onPadKeyDown_(st){by(st.key)&&st.preventDefault();const[ht,Mt]=Cp(st,this.baseSteps_,this.invertsY_);ht===0&&Mt===0||this.value.setRawValue(new Vm(this.value.rawValue.x+ht,this.value.rawValue.y+Mt),{forceEmit:!1,last:!1})}onPadKeyUp_(st){const[ht,Mt]=Cp(st,this.baseSteps_,this.invertsY_);ht===0&&Mt===0||this.value.setRawValue(this.value.rawValue,{forceEmit:!0,last:!0})}}class kv{constructor(st,ht){var Mt,Ht;this.onPopupChildBlur_=this.onPopupChildBlur_.bind(this),this.onPopupChildKeydown_=this.onPopupChildKeydown_.bind(this),this.onPadButtonBlur_=this.onPadButtonBlur_.bind(this),this.onPadButtonClick_=this.onPadButtonClick_.bind(this),this.value=ht.value,this.viewProps=ht.viewProps,this.foldable_=Js.create(ht.expanded),this.popC_=ht.pickerLayout==="popup"?new ss(st,{viewProps:this.viewProps}):null;const hn=new cp(st,{baseSteps:[ht.axes[0].baseStep,ht.axes[1].baseStep],invertsY:ht.invertsY,layout:ht.pickerLayout,maxValue:ht.maxValue,value:this.value,viewProps:this.viewProps});hn.view.allFocusableElements.forEach(Rn=>{Rn.addEventListener("blur",this.onPopupChildBlur_),Rn.addEventListener("keydown",this.onPopupChildKeydown_)}),this.pickerC_=hn,this.textC_=new zm(st,{assembly:m_,axes:ht.axes,parser:ht.parser,value:this.value,viewProps:this.viewProps}),this.view=new Bv(st,{expanded:this.foldable_.value("expanded"),pickerLayout:ht.pickerLayout,viewProps:this.viewProps}),this.view.textElement.appendChild(this.textC_.view.element),(Mt=this.view.buttonElement)===null||Mt===void 0||Mt.addEventListener("blur",this.onPadButtonBlur_),(Ht=this.view.buttonElement)===null||Ht===void 0||Ht.addEventListener("click",this.onPadButtonClick_),this.popC_?(this.view.element.appendChild(this.popC_.view.element),this.popC_.view.element.appendChild(this.pickerC_.view.element),Cv({primary:this.foldable_.value("expanded"),secondary:this.popC_.shows,forward:Rn=>Rn.rawValue,backward:(Rn,lr)=>lr.rawValue})):this.view.pickerElement&&(this.view.pickerElement.appendChild(this.pickerC_.view.element),yo(this.foldable_,this.view.pickerElement))}onPadButtonBlur_(st){if(!this.popC_)return;const ht=this.view.element,Mt=st.relatedTarget;Mt&&ht.contains(Mt)||(this.popC_.shows.rawValue=!1)}onPadButtonClick_(){this.foldable_.set("expanded",!this.foldable_.get("expanded")),this.foldable_.get("expanded")&&this.pickerC_.view.allFocusableElements[0].focus()}onPopupChildBlur_(st){if(!this.popC_)return;const ht=this.popC_.view.element,Mt=kr(st);Mt&&ht.contains(Mt)||Mt&&Mt===this.view.buttonElement&&!$n(ht.ownerDocument)||(this.popC_.shows.rawValue=!1)}onPopupChildKeydown_(st){this.popC_?st.key==="Escape"&&(this.popC_.shows.rawValue=!1):this.view.pickerElement&&st.key==="Escape"&&this.view.buttonElement.focus()}}function Ov(At){return Vm.isObject(At)?new Vm(At.x,At.y):new Vm}function Iy(At,st){At.writeProperty("x",st.x),At.writeProperty("y",st.y)}function _0(At){if(!At)return;const st=[];return Vt(At.step)||st.push(new wp(At.step)),Vt(At.max)&&Vt(At.min)||st.push(new wo({max:At.max,min:At.min})),new yv(st)}function Os(At,st){const ht=At&&ip(At,wo);if(ht)return Math.max(Math.abs(ht.minValue||0),Math.abs(ht.maxValue||0));const Mt=u0(At);return Math.max(10*Math.abs(Mt),10*Math.abs(st))}function Gm(At,st){const ht=st instanceof ru?st.components[0]:void 0,Mt=st instanceof ru?st.components[1]:void 0,Ht=Os(ht,At.x),hn=Os(Mt,At.y);return Math.max(Ht,hn)}function up(At,st){return{baseStep:u0(st),constraint:st,textProps:er.fromObject({draggingScale:h0(st,At),formatter:Yl(Ey(st,At))})}}function M1(At){if(!("y"in At))return!1;const st=At.y;return!!st&&"inverted"in st&&!!st.inverted}const Gw={id:"input-point2d",type:"input",accept:(At,st)=>{if(!Vm.isObject(At))return null;const ht=Vr,Mt=yr(st,{expanded:ht.optional.boolean,picker:ht.optional.custom(Tu),x:ht.optional.custom(jp),y:ht.optional.object({inverted:ht.optional.boolean,max:ht.optional.number,min:ht.optional.number,step:ht.optional.number})});return Mt?{initialValue:At,params:Mt}:null},binding:{reader:At=>Ov,constraint:At=>{return st=At.params,new ru({assembly:m_,components:[_0("x"in st?st.x:void 0),_0("y"in st?st.y:void 0)]});var st},equals:Vm.equals,writer:At=>Iy},controller:At=>{const st=At.document,ht=At.value,Mt=At.constraint;if(!(Mt instanceof ru))throw gn.shouldNeverHappen();const Ht="expanded"in At.params?At.params.expanded:void 0,hn="picker"in At.params?At.params.picker:void 0;return new kv(st,{axes:[up(ht.rawValue.x,Mt.components[0]),up(ht.rawValue.y,Mt.components[1])],expanded:Ht!=null&&Ht,invertsY:M1(At.params),maxValue:Gm(ht.rawValue,Mt),parser:Do,pickerLayout:hn??"popup",value:ht,viewProps:At.viewProps})}};class su{constructor(st=0,ht=0,Mt=0){this.x=st,this.y=ht,this.z=Mt}getComponents(){return[this.x,this.y,this.z]}static isObject(st){if(Vt(st))return!1;const ht=st.x,Mt=st.y,Ht=st.z;return typeof ht=="number"&&typeof Mt=="number"&&typeof Ht=="number"}static equals(st,ht){return st.x===ht.x&&st.y===ht.y&&st.z===ht.z}toObject(){return{x:this.x,y:this.y,z:this.z}}}const Co={toComponents:At=>At.getComponents(),fromComponents:At=>new su(...At)};function Ul(At){return su.isObject(At)?new su(At.x,At.y,At.z):new su}function hp(At,st){At.writeProperty("x",st.x),At.writeProperty("y",st.y),At.writeProperty("z",st.z)}function Mp(At){if(!At)return;const st=[];return Vt(At.step)||st.push(new wp(At.step)),Vt(At.max)&&Vt(At.min)||st.push(new wo({max:At.max,min:At.min})),new yv(st)}function dp(At,st){return{baseStep:u0(st),constraint:st,textProps:er.fromObject({draggingScale:h0(st,At),formatter:Yl(Ey(st,At))})}}const pA={id:"input-point3d",type:"input",accept:(At,st)=>{if(!su.isObject(At))return null;const ht=Vr,Mt=yr(st,{x:ht.optional.custom(jp),y:ht.optional.custom(jp),z:ht.optional.custom(jp)});return Mt?{initialValue:At,params:Mt}:null},binding:{reader:At=>Ul,constraint:At=>{return st=At.params,new ru({assembly:Co,components:[Mp("x"in st?st.x:void 0),Mp("y"in st?st.y:void 0),Mp("z"in st?st.z:void 0)]});var st},equals:su.equals,writer:At=>hp},controller:At=>{const st=At.value,ht=At.constraint;if(!(ht instanceof ru))throw gn.shouldNeverHappen();return new zm(At.document,{assembly:Co,axes:[dp(st.rawValue.x,ht.components[0]),dp(st.rawValue.y,ht.components[1]),dp(st.rawValue.z,ht.components[2])],parser:Do,value:st,viewProps:At.viewProps})}};class A0{constructor(st=0,ht=0,Mt=0,Ht=0){this.x=st,this.y=ht,this.z=Mt,this.w=Ht}getComponents(){return[this.x,this.y,this.z,this.w]}static isObject(st){if(Vt(st))return!1;const ht=st.x,Mt=st.y,Ht=st.z,hn=st.w;return typeof ht=="number"&&typeof Mt=="number"&&typeof Ht=="number"&&typeof hn=="number"}static equals(st,ht){return st.x===ht.x&&st.y===ht.y&&st.z===ht.z&&st.w===ht.w}toObject(){return{x:this.x,y:this.y,z:this.z,w:this.w}}}const Dy={toComponents:At=>At.getComponents(),fromComponents:At=>new A0(...At)};function y0(At){return A0.isObject(At)?new A0(At.x,At.y,At.z,At.w):new A0}function Tp(At,st){At.writeProperty("x",st.x),At.writeProperty("y",st.y),At.writeProperty("z",st.z),At.writeProperty("w",st.w)}function Jl(At){if(!At)return;const st=[];return Vt(At.step)||st.push(new wp(At.step)),Vt(At.max)&&Vt(At.min)||st.push(new wo({max:At.max,min:At.min})),new yv(st)}const Lv={id:"input-point4d",type:"input",accept:(At,st)=>{if(!A0.isObject(At))return null;const ht=Vr,Mt=yr(st,{x:ht.optional.custom(jp),y:ht.optional.custom(jp),z:ht.optional.custom(jp),w:ht.optional.custom(jp)});return Mt?{initialValue:At,params:Mt}:null},binding:{reader:At=>y0,constraint:At=>{return st=At.params,new ru({assembly:Dy,components:[Jl("x"in st?st.x:void 0),Jl("y"in st?st.y:void 0),Jl("z"in st?st.z:void 0),Jl("w"in st?st.w:void 0)]});var st},equals:A0.equals,writer:At=>Tp},controller:At=>{const st=At.value,ht=At.constraint;if(!(ht instanceof ru))throw gn.shouldNeverHappen();return new zm(At.document,{assembly:Dy,axes:st.rawValue.getComponents().map((Mt,Ht)=>{return hn=Mt,{baseStep:u0(Rn=ht.components[Ht]),constraint:Rn,textProps:er.fromObject({draggingScale:h0(Rn,hn),formatter:Yl(Ey(Rn,hn))})};var hn,Rn}),parser:Do,value:st,viewProps:At.viewProps})}},fA={id:"input-string",type:"input",accept:(At,st)=>{if(typeof At!="string")return null;const ht=yr(st,{options:Vr.optional.custom(a_)});return ht?{initialValue:At,params:ht}:null},binding:{reader:At=>r_,constraint:At=>function(st){const ht=[],Mt=l_(st.options);return Mt&&ht.push(Mt),new yv(ht)}(At.params),writer:At=>c0},controller:At=>{var st;const ht=At.document,Mt=At.value,Ht=At.constraint;return Ht&&ip(Ht,wv)?new eu(ht,{props:er.fromObject({options:(st=sA(Ht))!==null&&st!==void 0?st:[]}),value:Mt,viewProps:At.viewProps}):new uo(ht,{parser:hn=>hn,props:er.fromObject({formatter:Lw}),value:Mt,viewProps:At.viewProps})}},_u={defaultInterval:200,defaultLineCount:3},w0=bn("mll");class Vp{constructor(st,ht){this.onValueUpdate_=this.onValueUpdate_.bind(this),this.formatter_=ht.formatter,this.element=st.createElement("div"),this.element.classList.add(w0()),ht.viewProps.bindClassModifiers(this.element);const Mt=st.createElement("textarea");Mt.classList.add(w0("i")),Mt.style.height=`calc(var(--bld-us) * ${ht.lineCount})`,Mt.readOnly=!0,ht.viewProps.bindDisabled(Mt),this.element.appendChild(Mt),this.textareaElem_=Mt,ht.value.emitter.on("change",this.onValueUpdate_),this.value=ht.value,this.update_()}update_(){const st=this.textareaElem_,ht=st.scrollTop===st.scrollHeight-st.clientHeight,Mt=[];this.value.rawValue.forEach(Ht=>{Ht!==void 0&&Mt.push(this.formatter_(Ht))}),st.textContent=Mt.join(`
`),ht&&(st.scrollTop=st.scrollHeight)}onValueUpdate_(){this.update_()}}class Hm{constructor(st,ht){this.value=ht.value,this.viewProps=ht.viewProps,this.view=new Vp(st,{formatter:ht.formatter,lineCount:ht.lineCount,value:this.value,viewProps:this.viewProps})}}const mA=bn("sgl");class gA{constructor(st,ht){this.onValueUpdate_=this.onValueUpdate_.bind(this),this.formatter_=ht.formatter,this.element=st.createElement("div"),this.element.classList.add(mA()),ht.viewProps.bindClassModifiers(this.element);const Mt=st.createElement("input");Mt.classList.add(mA("i")),Mt.readOnly=!0,Mt.type="text",ht.viewProps.bindDisabled(Mt),this.element.appendChild(Mt),this.inputElement=Mt,ht.value.emitter.on("change",this.onValueUpdate_),this.value=ht.value,this.update_()}update_(){const st=this.value.rawValue,ht=st[st.length-1];this.inputElement.value=ht!==void 0?this.formatter_(ht):""}onValueUpdate_(){this.update_()}}class no{constructor(st,ht){this.value=ht.value,this.viewProps=ht.viewProps,this.view=new gA(st,{formatter:ht.formatter,value:this.value,viewProps:this.viewProps})}}const Au={id:"monitor-bool",type:"monitor",accept:(At,st)=>{if(typeof At!="boolean")return null;const ht=yr(st,{lineCount:Vr.optional.number});return ht?{initialValue:At,params:ht}:null},binding:{reader:At=>qs},controller:At=>{var st;return At.value.rawValue.length===1?new no(At.document,{formatter:cm,value:At.value,viewProps:At.viewProps}):new Hm(At.document,{formatter:cm,lineCount:(st=At.params.lineCount)!==null&&st!==void 0?st:_u.defaultLineCount,value:At.value,viewProps:At.viewProps})}};class pp{constructor(){this.emitter=new _n,this.index_=-1}get index(){return this.index_}set index(st){this.index_!==st&&(this.index_=st,this.emitter.emit("change",{index:st,sender:this}))}}const Ip=bn("grl");class mm{constructor(st,ht){this.onCursorChange_=this.onCursorChange_.bind(this),this.onValueUpdate_=this.onValueUpdate_.bind(this),this.element=st.createElement("div"),this.element.classList.add(Ip()),ht.viewProps.bindClassModifiers(this.element),this.formatter_=ht.formatter,this.minValue_=ht.minValue,this.maxValue_=ht.maxValue,this.cursor_=ht.cursor,this.cursor_.emitter.on("change",this.onCursorChange_);const Mt=st.createElementNS(zn,"svg");Mt.classList.add(Ip("g")),Mt.style.height=`calc(var(--bld-us) * ${ht.lineCount})`,this.element.appendChild(Mt),this.svgElem_=Mt;const Ht=st.createElementNS(zn,"polyline");this.svgElem_.appendChild(Ht),this.lineElem_=Ht;const hn=st.createElement("div");hn.classList.add(Ip("t"),bn("tt")()),this.element.appendChild(hn),this.tooltipElem_=hn,ht.value.emitter.on("change",this.onValueUpdate_),this.value=ht.value,this.update_()}get graphElement(){return this.svgElem_}update_(){const st=this.svgElem_.getBoundingClientRect(),ht=this.value.rawValue.length-1,Mt=this.minValue_,Ht=this.maxValue_,hn=[];this.value.rawValue.forEach((ws,fs)=>{if(ws===void 0)return;const Pu=vo(fs,0,ht,0,st.width),Bo=vo(ws,Mt,Ht,st.height,0);hn.push([Pu,Bo].join(","))}),this.lineElem_.setAttributeNS(null,"points",hn.join(" "));const Rn=this.tooltipElem_,lr=this.value.rawValue[this.cursor_.index];if(lr===void 0)return void Rn.classList.remove(Ip("t","a"));const Nr=vo(this.cursor_.index,0,ht,0,st.width),ds=vo(lr,Mt,Ht,st.height,0);Rn.style.left=`${Nr}px`,Rn.style.top=`${ds}px`,Rn.textContent=`${this.formatter_(lr)}`,Rn.classList.contains(Ip("t","a"))||(Rn.classList.add(Ip("t","a"),Ip("t","in")),nr(Rn),Rn.classList.remove(Ip("t","in")))}onValueUpdate_(){this.update_()}onCursorChange_(){this.update_()}}class Xu{constructor(st,ht){if(this.onGraphMouseMove_=this.onGraphMouseMove_.bind(this),this.onGraphMouseLeave_=this.onGraphMouseLeave_.bind(this),this.onGraphPointerDown_=this.onGraphPointerDown_.bind(this),this.onGraphPointerMove_=this.onGraphPointerMove_.bind(this),this.onGraphPointerUp_=this.onGraphPointerUp_.bind(this),this.value=ht.value,this.viewProps=ht.viewProps,this.cursor_=new pp,this.view=new mm(st,{cursor:this.cursor_,formatter:ht.formatter,lineCount:ht.lineCount,maxValue:ht.maxValue,minValue:ht.minValue,value:this.value,viewProps:this.viewProps}),$n(st)){const Mt=new tu(this.view.element);Mt.emitter.on("down",this.onGraphPointerDown_),Mt.emitter.on("move",this.onGraphPointerMove_),Mt.emitter.on("up",this.onGraphPointerUp_)}else this.view.element.addEventListener("mousemove",this.onGraphMouseMove_),this.view.element.addEventListener("mouseleave",this.onGraphMouseLeave_)}onGraphMouseLeave_(){this.cursor_.index=-1}onGraphMouseMove_(st){const ht=this.view.element.getBoundingClientRect();this.cursor_.index=Math.floor(vo(st.offsetX,0,ht.width,0,this.value.rawValue.length))}onGraphPointerDown_(st){this.onGraphPointerMove_(st)}onGraphPointerMove_(st){st.data.point?this.cursor_.index=Math.floor(vo(st.data.point.x,0,st.data.bounds.width,0,this.value.rawValue.length)):this.cursor_.index=-1}onGraphPointerUp_(){this.cursor_.index=-1}}function Wm(At){return"format"in At&&!Vt(At.format)?At.format:Yl(2)}function Py(At){return"view"in At&&At.view==="graph"}const Nv={id:"monitor-number",type:"monitor",accept:(At,st)=>{if(typeof At!="number")return null;const ht=Vr,Mt=yr(st,{format:ht.optional.function,lineCount:ht.optional.number,max:ht.optional.number,min:ht.optional.number,view:ht.optional.string});return Mt?{initialValue:At,params:Mt}:null},binding:{defaultBufferSize:At=>Py(At)?64:1,reader:At=>xp},controller:At=>Py(At.params)?function(st){var ht,Mt,Ht;return new Xu(st.document,{formatter:Wm(st.params),lineCount:(ht=st.params.lineCount)!==null&&ht!==void 0?ht:_u.defaultLineCount,maxValue:(Mt="max"in st.params?st.params.max:null)!==null&&Mt!==void 0?Mt:100,minValue:(Ht="min"in st.params?st.params.min:null)!==null&&Ht!==void 0?Ht:0,value:st.value,viewProps:st.viewProps})}(At):function(st){var ht;return st.value.rawValue.length===1?new no(st.document,{formatter:Wm(st.params),value:st.value,viewProps:st.viewProps}):new Hm(st.document,{formatter:Wm(st.params),lineCount:(ht=st.params.lineCount)!==null&&ht!==void 0?ht:_u.defaultLineCount,value:st.value,viewProps:st.viewProps})}(At)},vA={id:"monitor-string",type:"monitor",accept:(At,st)=>{if(typeof At!="string")return null;const ht=Vr,Mt=yr(st,{lineCount:ht.optional.number,multiline:ht.optional.boolean});return Mt?{initialValue:At,params:Mt}:null},binding:{reader:At=>r_},controller:At=>{var st;const ht=At.value;return ht.rawValue.length>1||"multiline"in At.params&&At.params.multiline?new Hm(At.document,{formatter:Lw,lineCount:(st=At.params.lineCount)!==null&&st!==void 0?st:_u.defaultLineCount,value:ht,viewProps:At.viewProps}):new no(At.document,{formatter:Lw,value:ht,viewProps:At.viewProps})}};class qm{constructor(st){this.onValueChange_=this.onValueChange_.bind(this),this.reader=st.reader,this.writer=st.writer,this.emitter=new _n,this.value=st.value,this.value.emitter.on("change",this.onValueChange_),this.target=st.target,this.read()}read(){const st=this.target.read();st!==void 0&&(this.value.rawValue=this.reader(st))}write_(st){this.writer(this.target,st)}onValueChange_(st){this.write_(st.rawValue),this.emitter.emit("change",{options:st.options,rawValue:st.rawValue,sender:this})}}class yu{constructor(st){this.onTick_=this.onTick_.bind(this),this.reader_=st.reader,this.target=st.target,this.emitter=new _n,this.value=st.value,this.ticker=st.ticker,this.ticker.emitter.on("tick",this.onTick_),this.read()}dispose(){this.ticker.dispose()}read(){const st=this.target.read();if(st===void 0)return;const ht=this.value.rawValue,Mt=this.reader_(st);this.value.rawValue=function(Ht,hn){const Rn=[...Yu(Ht),hn];return Rn.length>Ht.length?Rn.splice(0,Rn.length-Ht.length):qu(Rn,Ht.length),Rn}(ht,Mt),this.emitter.emit("update",{rawValue:Mt,sender:this})}onTick_(st){this.read()}}function T1(At,st){return st===0?new wy:new w1(At,st??_u.defaultInterval)}class Fl{constructor(){this.pluginsMap_={blades:[],inputs:[],monitors:[]}}getAll(){return[...this.pluginsMap_.blades,...this.pluginsMap_.inputs,...this.pluginsMap_.monitors]}register(st){st.type==="blade"?this.pluginsMap_.blades.unshift(st):st.type==="input"?this.pluginsMap_.inputs.unshift(st):st.type==="monitor"&&this.pluginsMap_.monitors.unshift(st)}createInput(st,ht,Mt){if(Vt(ht.read()))throw new gn({context:{key:ht.key},type:"nomatchingcontroller"});const Ht=this.pluginsMap_.inputs.reduce((hn,Rn)=>hn||function(lr,Nr){const ds=lr.accept(Nr.target.read(),Nr.params);if(Vt(ds))return null;const ws=Vr,fs={target:Nr.target,initialValue:ds.initialValue,params:ds.params},Pu=lr.binding.reader(fs),Bo=lr.binding.constraint?lr.binding.constraint(fs):void 0,Qp=pn(Pu(ds.initialValue),{constraint:Bo,equals:lr.binding.equals}),Dp=new qm({reader:Pu,target:Nr.target,value:Qp,writer:lr.binding.writer(fs)}),Ku=ws.optional.boolean(Nr.params.disabled).value,_l=ws.optional.boolean(Nr.params.hidden).value,Fv=lr.controller({constraint:Bo,document:Nr.document,initialValue:ds.initialValue,params:ds.params,value:Dp.value,viewProps:ao.create({disabled:Ku,hidden:_l})}),x0=ws.optional.string(Nr.params.label).value;return new ko(Nr.document,{binding:Dp,blade:Oo(),props:er.fromObject({label:x0||Nr.target.key}),valueController:Fv})}(Rn,{document:st,target:ht,params:Mt}),null);if(Ht)return Ht;throw new gn({context:{key:ht.key},type:"nomatchingcontroller"})}createMonitor(st,ht,Mt){const Ht=this.pluginsMap_.monitors.reduce((hn,Rn)=>hn||function(lr,Nr){var ds,ws,fs;const Pu=Vr,Bo=lr.accept(Nr.target.read(),Nr.params);if(Vt(Bo))return null;const Qp={target:Nr.target,initialValue:Bo.initialValue,params:Bo.params},Dp=lr.binding.reader(Qp),Ku=(ws=(ds=Pu.optional.number(Nr.params.bufferSize).value)!==null&&ds!==void 0?ds:lr.binding.defaultBufferSize&&lr.binding.defaultBufferSize(Bo.params))!==null&&ws!==void 0?ws:1,_l=Pu.optional.number(Nr.params.interval).value,Fv=new yu({reader:Dp,target:Nr.target,ticker:T1(Nr.document,_l),value:No(Ku)}),x0=Pu.optional.boolean(Nr.params.disabled).value,jv=Pu.optional.boolean(Nr.params.hidden).value,b0=lr.controller({document:Nr.document,params:Bo.params,value:Fv.value,viewProps:ao.create({disabled:x0,hidden:jv})}),_A=(fs=Pu.optional.string(Nr.params.label).value)!==null&&fs!==void 0?fs:Nr.target.key;return new Io(Nr.document,{binding:Fv,blade:Oo(),props:er.fromObject({label:_A}),valueController:b0})}(Rn,{document:st,params:Mt,target:ht}),null);if(Ht)return Ht;throw new gn({context:{key:ht.key},type:"nomatchingcontroller"})}createBlade(st,ht){const Mt=this.pluginsMap_.blades.reduce((Ht,hn)=>Ht||function(Rn,lr){const Nr=Rn.accept(lr.params);if(!Nr)return null;const ds=Vr.optional.boolean(lr.params.disabled).value,ws=Vr.optional.boolean(lr.params.hidden).value;return Rn.controller({blade:Oo(),document:lr.document,params:Object.assign(Object.assign({},Nr.params),{disabled:ds,hidden:ws}),viewProps:ao.create({disabled:ds,hidden:ws})})}(hn,{document:st,params:ht}),null);if(!Mt)throw new gn({type:"nomatchingview",context:{params:ht}});return Mt}createBladeApi(st){if(st instanceof ko)return new $a(st);if(st instanceof Io)return new Hl(st);if(st instanceof km)return new Lp(st,this);const ht=this.pluginsMap_.blades.reduce((Mt,Ht)=>Mt||Ht.api({controller:st,pool:this}),null);if(!ht)throw gn.shouldNeverHappen();return ht}}class gm extends b{constructor(st){super(st),this.emitter_=new _n,this.controller_.valueController.value.emitter.on("change",ht=>{this.emitter_.emit("change",{event:new Et(this,ht.rawValue)})})}get label(){return this.controller_.props.get("label")}set label(st){this.controller_.props.set("label",st)}get options(){return this.controller_.valueController.props.get("options")}set options(st){this.controller_.valueController.props.set("options",st)}get value(){return this.controller_.valueController.value.rawValue}set value(st){this.controller_.valueController.value.rawValue=st}on(st,ht){const Mt=ht.bind(this);return this.emitter_.on(st,Ht=>{Mt(Ht.event)}),this}}class Uo extends b{constructor(st){super(st),this.emitter_=new _n,this.controller_.valueController.value.emitter.on("change",ht=>{this.emitter_.emit("change",{event:new Et(this,ht.rawValue)})})}get label(){return this.controller_.props.get("label")}set label(st){this.controller_.props.set("label",st)}get maxValue(){return this.controller_.valueController.sliderController.props.get("maxValue")}set maxValue(st){this.controller_.valueController.sliderController.props.set("maxValue",st)}get minValue(){return this.controller_.valueController.sliderController.props.get("minValue")}set minValue(st){this.controller_.valueController.sliderController.props.set("minValue",st)}get value(){return this.controller_.valueController.value.rawValue}set value(st){this.controller_.valueController.value.rawValue=st}on(st,ht){const Mt=ht.bind(this);return this.emitter_.on(st,Ht=>{Mt(Ht.event)}),this}}class vm extends b{constructor(st){super(st),this.emitter_=new _n,this.controller_.valueController.value.emitter.on("change",ht=>{this.emitter_.emit("change",{event:new Et(this,ht.rawValue)})})}get label(){return this.controller_.props.get("label")}set label(st){this.controller_.props.set("label",st)}get formatter(){return this.controller_.valueController.props.get("formatter")}set formatter(st){this.controller_.valueController.props.set("formatter",st)}get value(){return this.controller_.valueController.value.rawValue}set value(st){this.controller_.valueController.value.rawValue=st}on(st,ht){const Mt=ht.bind(this);return this.emitter_.on(st,Ht=>{Mt(Ht.event)}),this}}const Ro={id:"list",type:"blade",accept(At){const st=Vr,ht=yr(At,{options:st.required.custom(a_),value:st.required.raw,view:st.required.constant("list"),label:st.optional.string});return ht?{params:ht}:null},controller(At){const st=new eu(At.document,{props:er.fromObject({options:Iu(At.params.options)}),value:pn(At.params.value),viewProps:At.viewProps});return new Gu(At.document,{blade:At.blade,props:er.fromObject({label:At.params.label}),valueController:st})},api:At=>At.controller instanceof Gu&&At.controller.valueController instanceof eu?new gm(At.controller):null};class I1 extends na{constructor(st,ht){super(st,ht)}get element(){return this.controller_.view.element}importPreset(st){(function(ht,Mt){ht.forEach(Ht=>{const hn=Mt[Ht.presetKey];hn!==void 0&&Ht.write(hn)})})(this.controller_.rackController.rack.find(ko).map(ht=>ht.binding.target),st),this.refresh()}exportPreset(){return this.controller_.rackController.rack.find(ko).map(st=>st.binding.target).reduce((st,ht)=>Object.assign(st,{[ht.presetKey]:ht.read()}),{})}refresh(){this.controller_.rackController.rack.find(ko).forEach(st=>{st.binding.read()}),this.controller_.rackController.rack.find(Io).forEach(st=>{st.binding.read()})}}class D1 extends Go{constructor(st,ht){super(st,{expanded:ht.expanded,blade:ht.blade,props:ht.props,root:!0,viewProps:ht.viewProps})}}const P1={id:"slider",type:"blade",accept(At){const st=Vr,ht=yr(At,{max:st.required.number,min:st.required.number,view:st.required.constant("slider"),format:st.optional.function,label:st.optional.string,value:st.optional.number});return ht?{params:ht}:null},controller(At){var st,ht;const Mt=(st=At.params.value)!==null&&st!==void 0?st:0,Ht=new Ho(At.document,{baseStep:1,parser:Do,sliderProps:er.fromObject({maxValue:At.params.max,minValue:At.params.min}),textProps:er.fromObject({draggingScale:h0(void 0,Mt),formatter:(ht=At.params.format)!==null&&ht!==void 0?ht:Nm}),value:pn(Mt),viewProps:At.viewProps});return new Gu(At.document,{blade:At.blade,props:er.fromObject({label:At.params.label}),valueController:Ht})},api:At=>At.controller instanceof Gu&&At.controller.valueController instanceof Ho?new Uo(At.controller):null},Uv={id:"text",type:"blade",accept(At){const st=Vr,ht=yr(At,{parse:st.required.function,value:st.required.raw,view:st.required.constant("text"),format:st.optional.function,label:st.optional.string});return ht?{params:ht}:null},controller(At){var st;const ht=new uo(At.document,{parser:At.params.parse,props:er.fromObject({formatter:(st=At.params.format)!==null&&st!==void 0?st:Mt=>String(Mt)}),value:pn(At.params.value),viewProps:At.viewProps});return new Gu(At.document,{blade:At.blade,props:er.fromObject({label:At.params.label}),valueController:ht})},api:At=>At.controller instanceof Gu&&At.controller.valueController instanceof uo?new vm(At.controller):null};function g_(At,st,ht){if(At.querySelector(`style[data-tp-style=${st}]`))return;const Mt=At.createElement("style");Mt.dataset.tpStyle=st,Mt.textContent=ht,At.head.appendChild(Mt)}const v_=new class{constructor(At){const[st,ht]=At.split("-"),Mt=st.split(".");this.major=parseInt(Mt[0],10),this.minor=parseInt(Mt[1],10),this.patch=parseInt(Mt[2],10),this.prerelease=ht??null}toString(){const At=[this.major,this.minor,this.patch].join(".");return this.prerelease!==null?[At,this.prerelease].join("-"):At}}("3.0.8");ot.BladeApi=b,ot.ButtonApi=wn,ot.FolderApi=na,ot.InputBindingApi=$a,ot.ListApi=gm,ot.MonitorBindingApi=Hl,ot.Pane=class extends I1{constructor(At){var st;const ht=At||{},Mt=(st=ht.document)!==null&&st!==void 0?st:Er(),Ht=function(){const hn=new Fl;return[Gw,pA,Lv,fA,LS,jm,Pv,f_,Sy,Au,vA,Nv,Ao,am,Wl,np].forEach(Rn=>{hn.register(Rn)}),hn}();super(new D1(Mt,{expanded:ht.expanded,blade:Oo(),props:er.fromObject({title:ht.title}),viewProps:ao.create()}),Ht),this.pool_=Ht,this.containerElem_=ht.container||function(hn){const Rn=hn.createElement("div");return Rn.classList.add(bn("dfw")()),hn.body&&hn.body.appendChild(Rn),Rn}(Mt),this.containerElem_.appendChild(this.element),this.doc_=Mt,this.usesDefaultWrapper_=!ht.container,this.setUpDefaultPlugins_()}get document(){if(!this.doc_)throw gn.alreadyDisposed();return this.doc_}dispose(){const At=this.containerElem_;if(!At)throw gn.alreadyDisposed();if(this.usesDefaultWrapper_){const st=At.parentElement;st&&st.removeChild(At)}this.containerElem_=null,this.doc_=null,super.dispose()}registerPlugin(At){("plugin"in At?[At.plugin]:"plugins"in At?At.plugins:[]).forEach(st=>{this.pool_.register(st),this.embedPluginStyle_(st)})}embedPluginStyle_(At){At.css&&g_(this.document,`plugin-${At.id}`,At.css)}setUpDefaultPlugins_(){g_(this.document,"default",'.tp-tbiv_b,.tp-coltxtv_ms,.tp-ckbv_i,.tp-rotv_b,.tp-fldv_b,.tp-mllv_i,.tp-sglv_i,.tp-grlv_g,.tp-txtv_i,.tp-p2dpv_p,.tp-colswv_sw,.tp-p2dv_b,.tp-btnv_b,.tp-lstv_s{-webkit-appearance:none;-moz-appearance:none;appearance:none;background-color:transparent;border-width:0;font-family:inherit;font-size:inherit;font-weight:inherit;margin:0;outline:none;padding:0}.tp-p2dv_b,.tp-btnv_b,.tp-lstv_s{background-color:var(--btn-bg);border-radius:var(--elm-br);color:var(--btn-fg);cursor:pointer;display:block;font-weight:bold;height:var(--bld-us);line-height:var(--bld-us);overflow:hidden;text-overflow:ellipsis;white-space:nowrap}.tp-p2dv_b:hover,.tp-btnv_b:hover,.tp-lstv_s:hover{background-color:var(--btn-bg-h)}.tp-p2dv_b:focus,.tp-btnv_b:focus,.tp-lstv_s:focus{background-color:var(--btn-bg-f)}.tp-p2dv_b:active,.tp-btnv_b:active,.tp-lstv_s:active{background-color:var(--btn-bg-a)}.tp-p2dv_b:disabled,.tp-btnv_b:disabled,.tp-lstv_s:disabled{opacity:.5}.tp-txtv_i,.tp-p2dpv_p,.tp-colswv_sw{background-color:var(--in-bg);border-radius:var(--elm-br);box-sizing:border-box;color:var(--in-fg);font-family:inherit;height:var(--bld-us);line-height:var(--bld-us);min-width:0;width:100%}.tp-txtv_i:hover,.tp-p2dpv_p:hover,.tp-colswv_sw:hover{background-color:var(--in-bg-h)}.tp-txtv_i:focus,.tp-p2dpv_p:focus,.tp-colswv_sw:focus{background-color:var(--in-bg-f)}.tp-txtv_i:active,.tp-p2dpv_p:active,.tp-colswv_sw:active{background-color:var(--in-bg-a)}.tp-txtv_i:disabled,.tp-p2dpv_p:disabled,.tp-colswv_sw:disabled{opacity:.5}.tp-mllv_i,.tp-sglv_i,.tp-grlv_g{background-color:var(--mo-bg);border-radius:var(--elm-br);box-sizing:border-box;color:var(--mo-fg);height:var(--bld-us);scrollbar-color:currentColor transparent;scrollbar-width:thin;width:100%}.tp-mllv_i::-webkit-scrollbar,.tp-sglv_i::-webkit-scrollbar,.tp-grlv_g::-webkit-scrollbar{height:8px;width:8px}.tp-mllv_i::-webkit-scrollbar-corner,.tp-sglv_i::-webkit-scrollbar-corner,.tp-grlv_g::-webkit-scrollbar-corner{background-color:transparent}.tp-mllv_i::-webkit-scrollbar-thumb,.tp-sglv_i::-webkit-scrollbar-thumb,.tp-grlv_g::-webkit-scrollbar-thumb{background-clip:padding-box;background-color:currentColor;border:transparent solid 2px;border-radius:4px}.tp-rotv{--font-family: var(--tp-font-family, Roboto Mono, Source Code Pro, Menlo, Courier, monospace);--bs-br: var(--tp-base-border-radius, 6px);--cnt-h-p: var(--tp-container-horizontal-padding, 4px);--cnt-v-p: var(--tp-container-vertical-padding, 4px);--elm-br: var(--tp-element-border-radius, 2px);--bld-s: var(--tp-blade-spacing, 4px);--bld-us: var(--tp-blade-unit-size, 20px);--bs-bg: var(--tp-base-background-color, #28292e);--bs-sh: var(--tp-base-shadow-color, rgba(0, 0, 0, 0.2));--btn-bg: var(--tp-button-background-color, #adafb8);--btn-bg-a: var(--tp-button-background-color-active, #d6d7db);--btn-bg-f: var(--tp-button-background-color-focus, #c8cad0);--btn-bg-h: var(--tp-button-background-color-hover, #bbbcc4);--btn-fg: var(--tp-button-foreground-color, #28292e);--cnt-bg: var(--tp-container-background-color, rgba(187, 188, 196, 0.1));--cnt-bg-a: var(--tp-container-background-color-active, rgba(187, 188, 196, 0.25));--cnt-bg-f: var(--tp-container-background-color-focus, rgba(187, 188, 196, 0.2));--cnt-bg-h: var(--tp-container-background-color-hover, rgba(187, 188, 196, 0.15));--cnt-fg: var(--tp-container-foreground-color, #bbbcc4);--in-bg: var(--tp-input-background-color, rgba(187, 188, 196, 0.1));--in-bg-a: var(--tp-input-background-color-active, rgba(187, 188, 196, 0.25));--in-bg-f: var(--tp-input-background-color-focus, rgba(187, 188, 196, 0.2));--in-bg-h: var(--tp-input-background-color-hover, rgba(187, 188, 196, 0.15));--in-fg: var(--tp-input-foreground-color, #bbbcc4);--lbl-fg: var(--tp-label-foreground-color, rgba(187, 188, 196, 0.7));--mo-bg: var(--tp-monitor-background-color, rgba(0, 0, 0, 0.2));--mo-fg: var(--tp-monitor-foreground-color, rgba(187, 188, 196, 0.7));--grv-fg: var(--tp-groove-foreground-color, rgba(187, 188, 196, 0.1))}.tp-rotv_c>.tp-cntv.tp-v-lst,.tp-tabv_c .tp-brkv>.tp-cntv.tp-v-lst,.tp-fldv_c>.tp-cntv.tp-v-lst{margin-bottom:calc(-1*var(--cnt-v-p))}.tp-rotv_c>.tp-fldv.tp-v-lst .tp-fldv_c,.tp-tabv_c .tp-brkv>.tp-fldv.tp-v-lst .tp-fldv_c,.tp-fldv_c>.tp-fldv.tp-v-lst .tp-fldv_c{border-bottom-left-radius:0}.tp-rotv_c>.tp-fldv.tp-v-lst .tp-fldv_b,.tp-tabv_c .tp-brkv>.tp-fldv.tp-v-lst .tp-fldv_b,.tp-fldv_c>.tp-fldv.tp-v-lst .tp-fldv_b{border-bottom-left-radius:0}.tp-rotv_c>*:not(.tp-v-fst),.tp-tabv_c .tp-brkv>*:not(.tp-v-fst),.tp-fldv_c>*:not(.tp-v-fst){margin-top:var(--bld-s)}.tp-rotv_c>.tp-sprv:not(.tp-v-fst),.tp-tabv_c .tp-brkv>.tp-sprv:not(.tp-v-fst),.tp-fldv_c>.tp-sprv:not(.tp-v-fst),.tp-rotv_c>.tp-cntv:not(.tp-v-fst),.tp-tabv_c .tp-brkv>.tp-cntv:not(.tp-v-fst),.tp-fldv_c>.tp-cntv:not(.tp-v-fst){margin-top:var(--cnt-v-p)}.tp-rotv_c>.tp-sprv+*:not(.tp-v-hidden),.tp-tabv_c .tp-brkv>.tp-sprv+*:not(.tp-v-hidden),.tp-fldv_c>.tp-sprv+*:not(.tp-v-hidden),.tp-rotv_c>.tp-cntv+*:not(.tp-v-hidden),.tp-tabv_c .tp-brkv>.tp-cntv+*:not(.tp-v-hidden),.tp-fldv_c>.tp-cntv+*:not(.tp-v-hidden){margin-top:var(--cnt-v-p)}.tp-rotv_c>.tp-sprv:not(.tp-v-hidden)+.tp-sprv,.tp-tabv_c .tp-brkv>.tp-sprv:not(.tp-v-hidden)+.tp-sprv,.tp-fldv_c>.tp-sprv:not(.tp-v-hidden)+.tp-sprv,.tp-rotv_c>.tp-cntv:not(.tp-v-hidden)+.tp-cntv,.tp-tabv_c .tp-brkv>.tp-cntv:not(.tp-v-hidden)+.tp-cntv,.tp-fldv_c>.tp-cntv:not(.tp-v-hidden)+.tp-cntv{margin-top:0}.tp-tabv_c .tp-brkv>.tp-cntv,.tp-fldv_c>.tp-cntv{margin-left:4px}.tp-tabv_c .tp-brkv>.tp-fldv>.tp-fldv_b,.tp-fldv_c>.tp-fldv>.tp-fldv_b{border-top-left-radius:var(--elm-br);border-bottom-left-radius:var(--elm-br)}.tp-tabv_c .tp-brkv>.tp-fldv.tp-fldv-expanded>.tp-fldv_b,.tp-fldv_c>.tp-fldv.tp-fldv-expanded>.tp-fldv_b{border-bottom-left-radius:0}.tp-tabv_c .tp-brkv .tp-fldv>.tp-fldv_c,.tp-fldv_c .tp-fldv>.tp-fldv_c{border-bottom-left-radius:var(--elm-br)}.tp-tabv_c .tp-brkv>.tp-tabv>.tp-tabv_i,.tp-fldv_c>.tp-tabv>.tp-tabv_i{border-top-left-radius:var(--elm-br)}.tp-tabv_c .tp-brkv .tp-tabv>.tp-tabv_c,.tp-fldv_c .tp-tabv>.tp-tabv_c{border-bottom-left-radius:var(--elm-br)}.tp-rotv_b,.tp-fldv_b{background-color:var(--cnt-bg);color:var(--cnt-fg);cursor:pointer;display:block;height:calc(var(--bld-us) + 4px);line-height:calc(var(--bld-us) + 4px);overflow:hidden;padding-left:var(--cnt-h-p);padding-right:calc(4px + var(--bld-us) + var(--cnt-h-p));position:relative;text-align:left;text-overflow:ellipsis;white-space:nowrap;width:100%;transition:border-radius .2s ease-in-out .2s}.tp-rotv_b:hover,.tp-fldv_b:hover{background-color:var(--cnt-bg-h)}.tp-rotv_b:focus,.tp-fldv_b:focus{background-color:var(--cnt-bg-f)}.tp-rotv_b:active,.tp-fldv_b:active{background-color:var(--cnt-bg-a)}.tp-rotv_b:disabled,.tp-fldv_b:disabled{opacity:.5}.tp-rotv_m,.tp-fldv_m{background:linear-gradient(to left, var(--cnt-fg), var(--cnt-fg) 2px, transparent 2px, transparent 4px, var(--cnt-fg) 4px);border-radius:2px;bottom:0;content:"";display:block;height:6px;right:calc(var(--cnt-h-p) + (var(--bld-us) + 4px - 6px)/2 - 2px);margin:auto;opacity:.5;position:absolute;top:0;transform:rotate(90deg);transition:transform .2s ease-in-out;width:6px}.tp-rotv.tp-rotv-expanded .tp-rotv_m,.tp-fldv.tp-fldv-expanded>.tp-fldv_b>.tp-fldv_m{transform:none}.tp-rotv_c,.tp-fldv_c{box-sizing:border-box;height:0;opacity:0;overflow:hidden;padding-bottom:0;padding-top:0;position:relative;transition:height .2s ease-in-out,opacity .2s linear,padding .2s ease-in-out}.tp-rotv.tp-rotv-cpl:not(.tp-rotv-expanded) .tp-rotv_c,.tp-fldv.tp-fldv-cpl:not(.tp-fldv-expanded)>.tp-fldv_c{display:none}.tp-rotv.tp-rotv-expanded .tp-rotv_c,.tp-fldv.tp-fldv-expanded>.tp-fldv_c{opacity:1;padding-bottom:var(--cnt-v-p);padding-top:var(--cnt-v-p);transform:none;overflow:visible;transition:height .2s ease-in-out,opacity .2s linear .2s,padding .2s ease-in-out}.tp-lstv,.tp-coltxtv_m{position:relative}.tp-lstv_s{padding:0 20px 0 4px;width:100%}.tp-lstv_m,.tp-coltxtv_mm{bottom:0;margin:auto;pointer-events:none;position:absolute;right:2px;top:0}.tp-lstv_m svg,.tp-coltxtv_mm svg{bottom:0;height:16px;margin:auto;position:absolute;right:0;top:0;width:16px}.tp-lstv_m svg path,.tp-coltxtv_mm svg path{fill:currentColor}.tp-pndtxtv,.tp-coltxtv_w{display:flex}.tp-pndtxtv_a,.tp-coltxtv_c{width:100%}.tp-pndtxtv_a+.tp-pndtxtv_a,.tp-coltxtv_c+.tp-pndtxtv_a,.tp-pndtxtv_a+.tp-coltxtv_c,.tp-coltxtv_c+.tp-coltxtv_c{margin-left:2px}.tp-btnv_b{width:100%}.tp-btnv_t{text-align:center}.tp-ckbv_l{display:block;position:relative}.tp-ckbv_i{left:0;opacity:0;position:absolute;top:0}.tp-ckbv_w{background-color:var(--in-bg);border-radius:var(--elm-br);cursor:pointer;display:block;height:var(--bld-us);position:relative;width:var(--bld-us)}.tp-ckbv_w svg{bottom:0;display:block;height:16px;left:0;margin:auto;opacity:0;position:absolute;right:0;top:0;width:16px}.tp-ckbv_w svg path{fill:none;stroke:var(--in-fg);stroke-width:2}.tp-ckbv_i:hover+.tp-ckbv_w{background-color:var(--in-bg-h)}.tp-ckbv_i:focus+.tp-ckbv_w{background-color:var(--in-bg-f)}.tp-ckbv_i:active+.tp-ckbv_w{background-color:var(--in-bg-a)}.tp-ckbv_i:checked+.tp-ckbv_w svg{opacity:1}.tp-ckbv.tp-v-disabled .tp-ckbv_w{opacity:.5}.tp-colv{position:relative}.tp-colv_h{display:flex}.tp-colv_s{flex-grow:0;flex-shrink:0;width:var(--bld-us)}.tp-colv_t{flex:1;margin-left:4px}.tp-colv_p{height:0;margin-top:0;opacity:0;overflow:hidden;transition:height .2s ease-in-out,opacity .2s linear,margin .2s ease-in-out}.tp-colv.tp-colv-cpl .tp-colv_p{overflow:visible}.tp-colv.tp-colv-expanded .tp-colv_p{margin-top:var(--bld-s);opacity:1}.tp-colv .tp-popv{left:calc(-1*var(--cnt-h-p));right:calc(-1*var(--cnt-h-p));top:var(--bld-us)}.tp-colpv_h,.tp-colpv_ap{margin-left:6px;margin-right:6px}.tp-colpv_h{margin-top:var(--bld-s)}.tp-colpv_rgb{display:flex;margin-top:var(--bld-s);width:100%}.tp-colpv_a{display:flex;margin-top:var(--cnt-v-p);padding-top:calc(var(--cnt-v-p) + 2px);position:relative}.tp-colpv_a:before{background-color:var(--grv-fg);content:"";height:2px;left:calc(-1*var(--cnt-h-p));position:absolute;right:calc(-1*var(--cnt-h-p));top:0}.tp-colpv_ap{align-items:center;display:flex;flex:3}.tp-colpv_at{flex:1;margin-left:4px}.tp-svpv{border-radius:var(--elm-br);outline:none;overflow:hidden;position:relative}.tp-svpv_c{cursor:crosshair;display:block;height:calc(var(--bld-us)*4);width:100%}.tp-svpv_m{border-radius:100%;border:rgba(255,255,255,.75) solid 2px;box-sizing:border-box;filter:drop-shadow(0 0 1px rgba(0, 0, 0, 0.3));height:12px;margin-left:-6px;margin-top:-6px;pointer-events:none;position:absolute;width:12px}.tp-svpv:focus .tp-svpv_m{border-color:#fff}.tp-hplv{cursor:pointer;height:var(--bld-us);outline:none;position:relative}.tp-hplv_c{background-image:url(data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAEAAAAABCAYAAABubagXAAAAQ0lEQVQoU2P8z8Dwn0GCgQEDi2OK/RBgYHjBgIpfovFh8j8YBIgzFGQxuqEgPhaDOT5gOhPkdCxOZeBg+IDFZZiGAgCaSSMYtcRHLgAAAABJRU5ErkJggg==);background-position:left top;background-repeat:no-repeat;background-size:100% 100%;border-radius:2px;display:block;height:4px;left:0;margin-top:-2px;position:absolute;top:50%;width:100%}.tp-hplv_m{border-radius:var(--elm-br);border:rgba(255,255,255,.75) solid 2px;box-shadow:0 0 2px rgba(0,0,0,.1);box-sizing:border-box;height:12px;left:50%;margin-left:-6px;margin-top:-6px;pointer-events:none;position:absolute;top:50%;width:12px}.tp-hplv:focus .tp-hplv_m{border-color:#fff}.tp-aplv{cursor:pointer;height:var(--bld-us);outline:none;position:relative;width:100%}.tp-aplv_b{background-color:#fff;background-image:linear-gradient(to top right, #ddd 25%, transparent 25%, transparent 75%, #ddd 75%),linear-gradient(to top right, #ddd 25%, transparent 25%, transparent 75%, #ddd 75%);background-size:4px 4px;background-position:0 0,2px 2px;border-radius:2px;display:block;height:4px;left:0;margin-top:-2px;overflow:hidden;position:absolute;top:50%;width:100%}.tp-aplv_c{bottom:0;left:0;position:absolute;right:0;top:0}.tp-aplv_m{background-color:#fff;background-image:linear-gradient(to top right, #ddd 25%, transparent 25%, transparent 75%, #ddd 75%),linear-gradient(to top right, #ddd 25%, transparent 25%, transparent 75%, #ddd 75%);background-size:12px 12px;background-position:0 0,6px 6px;border-radius:var(--elm-br);box-shadow:0 0 2px rgba(0,0,0,.1);height:12px;left:50%;margin-left:-6px;margin-top:-6px;overflow:hidden;pointer-events:none;position:absolute;top:50%;width:12px}.tp-aplv_p{border-radius:var(--elm-br);border:rgba(255,255,255,.75) solid 2px;box-sizing:border-box;bottom:0;left:0;position:absolute;right:0;top:0}.tp-aplv:focus .tp-aplv_p{border-color:#fff}.tp-colswv{background-color:#fff;background-image:linear-gradient(to top right, #ddd 25%, transparent 25%, transparent 75%, #ddd 75%),linear-gradient(to top right, #ddd 25%, transparent 25%, transparent 75%, #ddd 75%);background-size:10px 10px;background-position:0 0,5px 5px;border-radius:var(--elm-br);overflow:hidden}.tp-colswv.tp-v-disabled{opacity:.5}.tp-colswv_sw{border-radius:0}.tp-colswv_b{-webkit-appearance:none;-moz-appearance:none;appearance:none;background-color:transparent;border-width:0;cursor:pointer;display:block;height:var(--bld-us);left:0;margin:0;outline:none;padding:0;position:absolute;top:0;width:var(--bld-us)}.tp-colswv_b:focus::after{border:rgba(255,255,255,.75) solid 2px;border-radius:var(--elm-br);bottom:0;content:"";display:block;left:0;position:absolute;right:0;top:0}.tp-coltxtv{display:flex;width:100%}.tp-coltxtv_m{margin-right:4px}.tp-coltxtv_ms{border-radius:var(--elm-br);color:var(--lbl-fg);cursor:pointer;height:var(--bld-us);line-height:var(--bld-us);padding:0 18px 0 4px}.tp-coltxtv_ms:hover{background-color:var(--in-bg-h)}.tp-coltxtv_ms:focus{background-color:var(--in-bg-f)}.tp-coltxtv_ms:active{background-color:var(--in-bg-a)}.tp-coltxtv_mm{color:var(--lbl-fg)}.tp-coltxtv_w{flex:1}.tp-dfwv{position:absolute;top:8px;right:8px;width:256px}.tp-fldv.tp-fldv-not .tp-fldv_b{display:none}.tp-fldv_t{padding-left:4px}.tp-fldv_c{border-left:var(--cnt-bg) solid 4px}.tp-fldv_b:hover+.tp-fldv_c{border-left-color:var(--cnt-bg-h)}.tp-fldv_b:focus+.tp-fldv_c{border-left-color:var(--cnt-bg-f)}.tp-fldv_b:active+.tp-fldv_c{border-left-color:var(--cnt-bg-a)}.tp-grlv{position:relative}.tp-grlv_g{display:block;height:calc(var(--bld-us)*3)}.tp-grlv_g polyline{fill:none;stroke:var(--mo-fg);stroke-linejoin:round}.tp-grlv_t{margin-top:-4px;transition:left .05s,top .05s;visibility:hidden}.tp-grlv_t.tp-grlv_t-a{visibility:visible}.tp-grlv_t.tp-grlv_t-in{transition:none}.tp-grlv.tp-v-disabled .tp-grlv_g{opacity:.5}.tp-grlv .tp-ttv{background-color:var(--mo-fg)}.tp-grlv .tp-ttv::before{border-top-color:var(--mo-fg)}.tp-lblv{align-items:center;display:flex;line-height:1.3;padding-left:var(--cnt-h-p);padding-right:var(--cnt-h-p)}.tp-lblv.tp-lblv-nol{display:block}.tp-lblv_l{color:var(--lbl-fg);flex:1;-webkit-hyphens:auto;-ms-hyphens:auto;hyphens:auto;overflow:hidden;padding-left:4px;padding-right:16px}.tp-lblv.tp-v-disabled .tp-lblv_l{opacity:.5}.tp-lblv.tp-lblv-nol .tp-lblv_l{display:none}.tp-lblv_v{align-self:flex-start;flex-grow:0;flex-shrink:0;width:160px}.tp-lblv.tp-lblv-nol .tp-lblv_v{width:100%}.tp-lstv_s{padding:0 20px 0 4px;width:100%}.tp-lstv_m{color:var(--btn-fg)}.tp-sglv_i{padding:0 4px}.tp-sglv.tp-v-disabled .tp-sglv_i{opacity:.5}.tp-mllv_i{display:block;height:calc(var(--bld-us)*3);line-height:var(--bld-us);padding:0 4px;resize:none;white-space:pre}.tp-mllv.tp-v-disabled .tp-mllv_i{opacity:.5}.tp-p2dv{position:relative}.tp-p2dv_h{display:flex}.tp-p2dv_b{height:var(--bld-us);margin-right:4px;position:relative;width:var(--bld-us)}.tp-p2dv_b svg{display:block;height:16px;left:50%;margin-left:-8px;margin-top:-8px;position:absolute;top:50%;width:16px}.tp-p2dv_b svg path{stroke:currentColor;stroke-width:2}.tp-p2dv_b svg circle{fill:currentColor}.tp-p2dv_t{flex:1}.tp-p2dv_p{height:0;margin-top:0;opacity:0;overflow:hidden;transition:height .2s ease-in-out,opacity .2s linear,margin .2s ease-in-out}.tp-p2dv.tp-p2dv-expanded .tp-p2dv_p{margin-top:var(--bld-s);opacity:1}.tp-p2dv .tp-popv{left:calc(-1*var(--cnt-h-p));right:calc(-1*var(--cnt-h-p));top:var(--bld-us)}.tp-p2dpv{padding-left:calc(var(--bld-us) + 4px)}.tp-p2dpv_p{cursor:crosshair;height:0;overflow:hidden;padding-bottom:100%;position:relative}.tp-p2dpv_g{display:block;height:100%;left:0;pointer-events:none;position:absolute;top:0;width:100%}.tp-p2dpv_ax{opacity:.1;stroke:var(--in-fg);stroke-dasharray:1}.tp-p2dpv_l{opacity:.5;stroke:var(--in-fg);stroke-dasharray:1}.tp-p2dpv_m{border:var(--in-fg) solid 1px;border-radius:50%;box-sizing:border-box;height:4px;margin-left:-2px;margin-top:-2px;position:absolute;width:4px}.tp-p2dpv_p:focus .tp-p2dpv_m{background-color:var(--in-fg);border-width:0}.tp-popv{background-color:var(--bs-bg);border-radius:6px;box-shadow:0 2px 4px var(--bs-sh);display:none;max-width:168px;padding:var(--cnt-v-p) var(--cnt-h-p);position:absolute;visibility:hidden;z-index:1000}.tp-popv.tp-popv-v{display:block;visibility:visible}.tp-sprv_r{background-color:var(--grv-fg);border-width:0;display:block;height:2px;margin:0;width:100%}.tp-sldv.tp-v-disabled{opacity:.5}.tp-sldv_t{box-sizing:border-box;cursor:pointer;height:var(--bld-us);margin:0 6px;outline:none;position:relative}.tp-sldv_t::before{background-color:var(--in-bg);border-radius:1px;bottom:0;content:"";display:block;height:2px;left:0;margin:auto;position:absolute;right:0;top:0}.tp-sldv_k{height:100%;left:0;position:absolute;top:0}.tp-sldv_k::before{background-color:var(--in-fg);border-radius:1px;bottom:0;content:"";display:block;height:2px;left:0;margin-bottom:auto;margin-top:auto;position:absolute;right:0;top:0}.tp-sldv_k::after{background-color:var(--btn-bg);border-radius:var(--elm-br);bottom:0;content:"";display:block;height:12px;margin-bottom:auto;margin-top:auto;position:absolute;right:-6px;top:0;width:12px}.tp-sldv_t:hover .tp-sldv_k::after{background-color:var(--btn-bg-h)}.tp-sldv_t:focus .tp-sldv_k::after{background-color:var(--btn-bg-f)}.tp-sldv_t:active .tp-sldv_k::after{background-color:var(--btn-bg-a)}.tp-sldtxtv{display:flex}.tp-sldtxtv_s{flex:2}.tp-sldtxtv_t{flex:1;margin-left:4px}.tp-tabv.tp-v-disabled{opacity:.5}.tp-tabv_i{align-items:flex-end;display:flex;overflow:hidden}.tp-tabv.tp-tabv-nop .tp-tabv_i{height:calc(var(--bld-us) + 4px);position:relative}.tp-tabv.tp-tabv-nop .tp-tabv_i::before{background-color:var(--cnt-bg);bottom:0;content:"";height:2px;left:0;position:absolute;right:0}.tp-tabv_c{border-left:var(--cnt-bg) solid 4px;padding-bottom:var(--cnt-v-p);padding-top:var(--cnt-v-p)}.tp-tbiv{flex:1;min-width:0;position:relative}.tp-tbiv+.tp-tbiv{margin-left:2px}.tp-tbiv+.tp-tbiv::before{background-color:var(--cnt-bg);bottom:0;content:"";height:2px;left:-2px;position:absolute;width:2px}.tp-tbiv_b{background-color:var(--cnt-bg);display:block;padding-left:calc(var(--cnt-h-p) + 4px);padding-right:calc(var(--cnt-h-p) + 4px);width:100%}.tp-tbiv_b:hover{background-color:var(--cnt-bg-h)}.tp-tbiv_b:focus{background-color:var(--cnt-bg-f)}.tp-tbiv_b:active{background-color:var(--cnt-bg-a)}.tp-tbiv_b:disabled{opacity:.5}.tp-tbiv_t{color:var(--cnt-fg);height:calc(var(--bld-us) + 4px);line-height:calc(var(--bld-us) + 4px);opacity:.5;overflow:hidden;text-overflow:ellipsis}.tp-tbiv.tp-tbiv-sel .tp-tbiv_t{opacity:1}.tp-txtv{position:relative}.tp-txtv_i{padding:0 4px}.tp-txtv.tp-txtv-fst .tp-txtv_i{border-bottom-right-radius:0;border-top-right-radius:0}.tp-txtv.tp-txtv-mid .tp-txtv_i{border-radius:0}.tp-txtv.tp-txtv-lst .tp-txtv_i{border-bottom-left-radius:0;border-top-left-radius:0}.tp-txtv.tp-txtv-num .tp-txtv_i{text-align:right}.tp-txtv.tp-txtv-drg .tp-txtv_i{opacity:.3}.tp-txtv_k{cursor:pointer;height:100%;left:-3px;position:absolute;top:0;width:12px}.tp-txtv_k::before{background-color:var(--in-fg);border-radius:1px;bottom:0;content:"";height:calc(var(--bld-us) - 4px);left:50%;margin-bottom:auto;margin-left:-1px;margin-top:auto;opacity:.1;position:absolute;top:0;transition:border-radius .1s,height .1s,transform .1s,width .1s;width:2px}.tp-txtv_k:hover::before,.tp-txtv.tp-txtv-drg .tp-txtv_k::before{opacity:1}.tp-txtv.tp-txtv-drg .tp-txtv_k::before{border-radius:50%;height:4px;transform:translateX(-1px);width:4px}.tp-txtv_g{bottom:0;display:block;height:8px;left:50%;margin:auto;overflow:visible;pointer-events:none;position:absolute;top:0;visibility:hidden;width:100%}.tp-txtv.tp-txtv-drg .tp-txtv_g{visibility:visible}.tp-txtv_gb{fill:none;stroke:var(--in-fg);stroke-dasharray:1}.tp-txtv_gh{fill:none;stroke:var(--in-fg)}.tp-txtv .tp-ttv{margin-left:6px;visibility:hidden}.tp-txtv.tp-txtv-drg .tp-ttv{visibility:visible}.tp-ttv{background-color:var(--in-fg);border-radius:var(--elm-br);color:var(--bs-bg);padding:2px 4px;pointer-events:none;position:absolute;transform:translate(-50%, -100%)}.tp-ttv::before{border-color:var(--in-fg) transparent transparent transparent;border-style:solid;border-width:2px;box-sizing:border-box;content:"";font-size:.9em;height:4px;left:50%;margin-left:-2px;position:absolute;top:100%;width:4px}.tp-rotv{background-color:var(--bs-bg);border-radius:var(--bs-br);box-shadow:0 2px 4px var(--bs-sh);font-family:var(--font-family);font-size:11px;font-weight:500;line-height:1;text-align:left}.tp-rotv_b{border-bottom-left-radius:var(--bs-br);border-bottom-right-radius:var(--bs-br);border-top-left-radius:var(--bs-br);border-top-right-radius:var(--bs-br);padding-left:calc(4px + var(--bld-us) + var(--cnt-h-p));text-align:center}.tp-rotv.tp-rotv-expanded .tp-rotv_b{border-bottom-left-radius:0;border-bottom-right-radius:0}.tp-rotv.tp-rotv-not .tp-rotv_b{display:none}.tp-rotv_c>.tp-fldv.tp-v-lst>.tp-fldv_c,.tp-rotv_c>.tp-tabv.tp-v-lst>.tp-tabv_c{border-bottom-left-radius:var(--bs-br);border-bottom-right-radius:var(--bs-br)}.tp-rotv_c>.tp-fldv.tp-v-lst:not(.tp-fldv-expanded)>.tp-fldv_b{border-bottom-left-radius:var(--bs-br);border-bottom-right-radius:var(--bs-br)}.tp-rotv_c .tp-fldv.tp-v-vlst:not(.tp-fldv-expanded)>.tp-fldv_b{border-bottom-right-radius:var(--bs-br)}.tp-rotv.tp-rotv-not .tp-rotv_c>.tp-fldv.tp-v-fst{margin-top:calc(-1*var(--cnt-v-p))}.tp-rotv.tp-rotv-not .tp-rotv_c>.tp-fldv.tp-v-fst>.tp-fldv_b{border-top-left-radius:var(--bs-br);border-top-right-radius:var(--bs-br)}.tp-rotv.tp-rotv-not .tp-rotv_c>.tp-tabv.tp-v-fst{margin-top:calc(-1*var(--cnt-v-p))}.tp-rotv.tp-rotv-not .tp-rotv_c>.tp-tabv.tp-v-fst>.tp-tabv_i{border-top-left-radius:var(--bs-br);border-top-right-radius:var(--bs-br)}.tp-rotv.tp-v-disabled,.tp-rotv .tp-v-disabled{pointer-events:none}.tp-rotv.tp-v-hidden,.tp-rotv .tp-v-hidden{display:none}'),this.pool_.getAll().forEach(At=>{this.embedPluginStyle_(At)}),this.registerPlugin({plugins:[P1,Ro,np,Uv]})}},ot.SeparatorApi=Ay,ot.SliderApi=Uo,ot.TabApi=yy,ot.TabPageApi=Ap,ot.TextApi=vm,ot.TpChangeEvent=Et,ot.VERSION=v_,Object.defineProperty(ot,"__esModule",{value:!0})})(tt)},23:function(__unused_webpack_module,__webpackgi_exports__,__webpackgi_require__){__webpackgi_require__.d(__webpackgi_exports__,{Q:function(){return DRACOLoader2}});var three_examples_jsm_loaders_DRACOLoader__WEBPACK_IMPORTED_MODULE_0__=__webpackgi_require__(553),three__WEBPACK_IMPORTED_MODULE_1__=__webpackgi_require__(988);class DRACOLoader2 extends three_examples_jsm_loaders_DRACOLoader__WEBPACK_IMPORTED_MODULE_0__._{constructor(j){super(j),this.encoderPending=null,this.encoderConfig={type:"js"},this.setDecoderPath("https://cdn.jsdelivr.net/gh/google/draco@1.4.1/javascript/"),this.setDecoderConfig({type:"js"})}async loadAsync(j,tt){const ot=await super.loadAsync(j,tt);return ot?new three__WEBPACK_IMPORTED_MODULE_1__.Kj0(ot,new three__WEBPACK_IMPORTED_MODULE_1__.Wid):void 0}preload(j=!0,tt=!1){return j&&super.preload(),tt&&this.initEncoder(),this}async initEncoder(){if(this.encoderPending)return this.encoderPending;const useJS=typeof WebAssembly!="object"||this.encoderConfig.type==="js",librariesPending=[],libLoader=this._loadLibrary.bind(this);return useJS?librariesPending.push(libLoader("draco_encoder.js","text")):(librariesPending.push(libLoader("draco_wasm_wrapper.js","text")),librariesPending.push(libLoader("draco_encoder.wasm","arraybuffer"))),this.encoderPending=Promise.all(librariesPending).then(libraries=>{var _a;const jsContent=libraries[0];return useJS||(this.encoderConfig.wasmBinary=libraries[1]),(_a=eval(jsContent+`
DracoEncoderModule;`))===null||_a===void 0?void 0:_a()}),this.encoderPending}async initDecoder(){var _a;await this._initDecoder();const jsContent=await fetch(this.workerSourceURL).then(async j=>j.text()).then(j=>{const tt=j.indexOf("/* worker */");if(tt<1)throw new Error("unable to load decoder module");return j.substring(0,tt-1)});return(_a=eval(jsContent+`
DracoDecoderModule;`))===null||_a===void 0?void 0:_a()}}},87:function(){},263:function(){},988:function(j,tt,ot){ot.d(tt,{$TI:function(){return kE},$V:function(){return lw},$Vf:function(){return fw},$YQ:function(){return iE},A5E:function(){return KT},AHu:function(){return JT},AXT:function(){return wC},Aip:function(){return U0},B02:function(){return an},BFQ:function(){return wv},BG$:function(){return bv},BKK:function(){return mw},BVF:function(){return Er},BVQ:function(){return ev},BbS:function(){return ow},Bf4:function(){return Io},BtG:function(){return qw},CJI:function(){return yu},CN8:function(){return $T},CP7:function(){return oC},CaW:function(){return ts},CdI:function(){return Js},Cne:function(){return nI},CtA:function(){return w1},CtF:function(){return Wv},D1R:function(){return mo},D9w:function(){return np},DT1:function(){return Jv},Djp:function(){return s0},DqL:function(){return rw},DvJ:function(){return E0},E2K:function(){return yv},EB7:function(){return ET},EJi:function(){return DT},EoG:function(){return Oo},F5T:function(){return Fl},FDw:function(){return Go},FE5:function(){return tw},FIo:function(){return Cx},FM8:function(){return Sr},FT0:function(){return BT},FUD:function(){return Ev},FvO:function(){return LC},GG6:function(){return t_},GQ:function(){return jE},GUF:function(){return vo},GVz:function(){return Vw},GZb:function(){return GE},Gih:function(){return Lm},Gql:function(){return ME},H$k:function(){return Ex},HTd:function(){return y1},HW6:function(){return eI},HgB:function(){return Wo},HkE:function(){return nE},Hmr:function(){return sw},Hw6:function(){return Sp},Hy8:function(){return ir},Hyl:function(){return Hp},IEO:function(){return Vy},IFH:function(){return Yl},IKL:function(){return TC},ILR:function(){return wp},IOt:function(){return Nl},Ilk:function(){return rs},Inb:function(){return Cv},Ir4:function(){return h0},JOQ:function(){return C0},JQ4:function(){return Fn},JUT:function(){return d_},JWc:function(){return Ey},KI_:function(){return tu},Kgo:function(){return Zy},KhW:function(){return Dr},Kj0:function(){return Zl},Kz5:function(){return Z0},L5g:function(){return tI},L5s:function(){return jT},LBq:function(){return LE},LSk:function(){return hm},LY2:function(){return yo},L_r:function(){return c_},Lcc:function(){return HC},LgE:function(){return Yu},LgZ:function(){return Hr},LsT:function(){return J0},Ltg:function(){return _o},Lun:function(){return PA},M5h:function(){return un},M6v:function(){return zr},M8C:function(){return jw},Mig:function(){return FT},MyG:function(){return BS},N$j:function(){return E_},N4l:function(){return Bn},NDo:function(){return Ao},NMF:function(){return a0},NYV:function(){return o0},Ns1:function(){return Cs},NwF:function(){return WA},Ny0:function(){return C_},O7d:function(){return QA},OAl:function(){return c0},OM3:function(){return Mt},OTo:function(){return kw},OdW:function(){return Qy},OoA:function(){return Lp},Ox3:function(){return bE},PA7:function(){return by},PMe:function(){return NT},Pa4:function(){return fn},PeU:function(){return kt},Pnf:function(){return Do},PpQ:function(){return m0},QM0:function(){return u0},QRU:function(){return Yp},QZ1:function(){return sA},QmN:function(){return Et},Qpg:function(){return ID},R2R:function(){return Tx},REq:function(){return QC},RNb:function(){return I1},ROQ:function(){return ST},RSm:function(){return wm},Rki:function(){return zx},RlZ:function(){return $n},RsA:function(){return yt},RvT:function(){return a_},S2y:function(){return Vt},S3k:function(){return ov},S9g:function(){return pA},SJI:function(){return MD},SPe:function(){return hC},SUY:function(){return Bx},Se2:function(){return Yn},Sm8:function(){return pn},So8:function(){return IE},SvJ:function(){return So},Syv:function(){return um},T95:function(){return Gu},TOt:function(){return El},TUj:function(){return NE},TUv:function(){return zy},T_1:function(){return Em},T_J:function(){return o_},T__:function(){return dE},T_f:function(){return EE},TlE:function(){return Ro},Tme:function(){return no},Tn7:function(){return AE},TyD:function(){return na},U7:function(){return Xy},UCm:function(){return Ow},USm:function(){return dp},UY4:function(){return cE},UZH:function(){return b},Uk6:function(){return _E},UlW:function(){return r_},Uol:function(){return Qv},V1s:function(){return xA},V4E:function(){return GC},VLJ:function(){return YT},VYz:function(){return k0},Vdb:function(){return zn},Vj0:function(){return zl},Vkp:function(){return nu},VzW:function(){return Wl},W2J:function(){return Iu},WMw:function(){return Yt},WTc:function(){return D1},WXh:function(){return _h},Wbm:function(){return Wt},WdD:function(){return Zs},Wid:function(){return _d},Wjw:function(){return QE},Wl3:function(){return _n},Wpd:function(){return nr},Wqd:function(){return mE},WwZ:function(){return rA},Wzm:function(){return bT},XZw:function(){return gw},Xaj:function(){return Cn},Xcj:function(){return O0},XvJ:function(){return Sx},Y8D:function(){return Ap},YBo:function(){return yE},YGz:function(){return Qo},YKA:function(){return Wu},YLQ:function(){return mu},YN5:function(){return VE},YT8:function(){return CT},Ywn:function(){return S1},Z6B:function(){return kS},ZAu:function(){return T0},ZQ6:function(){return vx},ZRs:function(){return sp},ZZA:function(){return kT},Zp0:function(){return kC},Zr5:function(){return Kt},ZzF:function(){return Xl},Zzh:function(){return UE},_12:function(){return bA},_3:function(){return Cm},_AM:function(){return gu},_C8:function(){return iw},_Li:function(){return $t},_MY:function(){return Pn},_YM:function(){return Xo},_YX:function(){return hw},_am:function(){return OM},_fP:function(){return iu},_iA:function(){return gn},_kC:function(){return bm},_lf:function(){return xp},_sL:function(){return Nm},a$l:function(){return ht},aCh:function(){return Nw},aH4:function(){return ga},aLr:function(){return Bv},aNw:function(){return kp},aVm:function(){return Uv},ad5:function(){return Uw},anP:function(){return Xw},aq0:function(){return FC},av9:function(){return wy},b5g:function(){return aC},bGH:function(){return Qt},b_z:function(){return ro},bdR:function(){return jt},blk:function(){return wT},bnF:function(){return jA},brP:function(){return Av},bsb:function(){return go},c8b:function(){return er},cBI:function(){return L0},cBK:function(){return xm},cJO:function(){return bx},cLu:function(){return lm},cPb:function(){return wu},cRx:function(){return yy},cU9:function(){return OT},ce8:function(){return l0},cek:function(){return av},cum:function(){return jp},dSO:function(){return Hl},dUE:function(){return GA},dYG:function(){return P0},dZ3:function(){return Vu},dd2:function(){return ap},dj0:function(){return l_},dpR:function(){return xD},dwk:function(){return wn},e62:function(){return st},eD:function(){return jn},eMJ:function(){return x1},eaV:function(){return eu},ehD:function(){return bn},ejS:function(){return _g},ekQ:function(){return Up},epp:function(){return bp},fHI:function(){return FA},fO1:function(){return xT},fQA:function(){return zC},fQK:function(){return rC},fSK:function(){return Xn},fY$:function(){return $a},fto:function(){return r0},g8_:function(){return Qu},gH0:function(){return Ux},gSk:function(){return rp},g_z:function(){return pE},ghN:function(){return Ir},gi4:function(){return cm},gti:function(){return _x},hEm:function(){return iA},hH6:function(){return sv},iAb:function(){return Ay},iDF:function(){return xu},iKG:function(){return U1},iLg:function(){return HA},iMs:function(){return OE},iUV:function(){return Xs},iWC:function(){return Vr},iWj:function(){return Ym},i_9:function(){return SD},iiP:function(){return n_},irR:function(){return ao},j4z:function(){return Tu},j87:function(){return v_},jAl:function(){return Sv},jFi:function(){return Ut},jZA:function(){return uo},jfJ:function(){return s_},jwo:function(){return Fw},jyi:function(){return jy},jyz:function(){return _m},k0A:function(){return Om},k74:function(){return yr},kB5:function(){return y_},kFz:function(){return C1},kaV:function(){return RT},knz:function(){return No},kqm:function(){return GT},ksN:function(){return Ur},l0P:function(){return ss},l8J:function(){return b1},lCJ:function(){return At},lDi:function(){return SE},lLk:function(){return rv},lRF:function(){return ox},lRj:function(){return nA},lb7:function(){return LA},lfu:function(){return Sl},lk7:function(){return CE},m7l:function(){return iv},mSO:function(){return Mv},mTL:function(){return ED},mXe:function(){return Vl},m_w:function(){return Gx},mzJ:function(){return BE},nls:function(){return Ju},ntZ:function(){return dn},nvb:function(){return Sm},o8S:function(){return ew},oAp:function(){return k1},oa8:function(){return $u},oqc:function(){return Tl},p3g:function(){return h_},p7A:function(){return ZT},p7y:function(){return Vv},pBf:function(){return op},pIN:function(){return i_},pKu:function(){return e_},pQR:function(){return $y},ptH:function(){return xv},qhX:function(){return Gs},qkB:function(){return yp},qlB:function(){return g_},qyh:function(){return km},rAo:function(){return P1},rBU:function(){return Xr},rDY:function(){return NS},rOj:function(){return Zt},r_:function(){return En},rnI:function(){return qu},rpg:function(){return Mu},s4_:function(){return zT},sYA:function(){return XA},tEQ:function(){return YA},tGC:function(){return Al},tJx:function(){return XT},tUh:function(){return Pl},tf:function(){return PE},tm_:function(){return Gt},trn:function(){return Qx},u37:function(){return CD},u7G:function(){return JA},u9r:function(){return fs},uEv:function(){return xy},uL9:function(){return Ks},uWy:function(){return Lo},uXU:function(){return Fp},ujx:function(){return Hx},v3W:function(){return wo},v9Y:function(){return Sy},vBJ:function(){return gm},vCF:function(){return rn},vCx:function(){return $0},vZf:function(){return Np},vmT:function(){return ep},vpT:function(){return cx},vxC:function(){return ko},w$m:function(){return kr},wJv:function(){return to},wem:function(){return xa},wk1:function(){return Hu},woe:function(){return qy},wuA:function(){return ip},x12:function(){return S_},x5V:function(){return Vs},xEZ:function(){return qo},xG9:function(){return WT},xJs:function(){return Ys},xWb:function(){return Nx},xeV:function(){return RA},xfE:function(){return fu},xo$:function(){return M_},xoR:function(){return PT},xsS:function(){return lC},y$t:function(){return Ky},y2t:function(){return qs},y8_:function(){return ry},yC1:function(){return qA},yGw:function(){return Os},ybr:function(){return A_},yj7:function(){return xC},ylh:function(){return ey},yo9:function(){return lx},yt0:function(){return Ho},ywz:function(){return am},yxD:function(){return wD},z$h:function(){return Lw},z81:function(){return vu},z8B:function(){return cC},zHn:function(){return _0},zbs:function(){return LT},zf8:function(){return Jy},zob:function(){return zE}});const b="144dev",yt={LEFT:0,MIDDLE:1,RIGHT:2,ROTATE:0,DOLLY:1,PAN:2},Et={ROTATE:0,PAN:1,DOLLY_PAN:2,DOLLY_ROTATE:3},kt=0,Gt=1,Vt=2,an=3,Pn=0,gn=1,dn=2,wn=3,_n=0,$t=1,bn=2,Ut=0,jt=1,Yt=2,Bn=3,un=4,Cn=5,Qt=100,Wt=101,Zt=102,En=103,pn=104,er=200,Ir=201,Dr=202,Vr=203,yr=204,Hr=205,Xn=206,ir=207,zn=208,nr=209,$n=210,Er=0,Yn=1,Kt=2,rn=3,jn=4,Ur=5,kr=6,zr=7,Cs=0,Gs=1,Ao=2,Ks=0,Oo=1,Js=2,Qo=3,yo=4,Vu=5,fu=300,$a=301,ko=302,Hl=303,Io=304,Qu=306,Mu=1e3,Lo=1001,Lp=1002,na=1003,mu=1004,y1=1004,ga=1005,Np=1005,xa=1006,km=1007,nA=1007,mo=1008,Go=1008,am=1009,Gu=1010,Ay=1011,J0=1012,Z0=1013,Fn=1014,Wl=1015,lm=1016,Om=1017,ao=1018,to=1020,kw=1021,Ow=1022,Hu=1023,Ap=1024,yy=1025,yp=1026,Av=1027,iA=1028,np=1029,wy=1030,w1=1031,yv=1033,ip=33776,wv=33777,wo=33778,wp=33779,gu=35840,$0=35841,eu=35842,ts=35843,r0=36196,ss=37492,Up=37496,xv=37808,uo=37809,qs=37810,cm=37811,s0=37812,bv=37813,o0=37814,Ys=37815,e_=37816,t_=37817,Lm=37818,Ev=37819,n_=37820,So=37821,go=36492,Sv=2200,Wu=2201,xy=2202,um=2300,a0=2301,i_=2302,Do=2400,xp=2401,Nm=2402,Yl=2500,rp=2501,rA=0,r_=1,Lw=2,qu=3e3,No=3001,Yu=3004,Cv=3005,vu=3200,Mv=3201,Nl=0,by=1,Nw="",tu="srgb",vo="srgb-linear",Uw=0,Vs=7680,l0=7681,sp=7682,s_=7683,Tl=34055,o_=34056,x1=5386,BS=512,Fp=513,Fw=514,Ho=515,c0=516,a_=517,Tu=518,jp=519,Iu=35044,l_=35048,sA=35040,Ey=35045,u0=35049,h0=35041,Wo=35046,b1=35050,kS=35042,Sy="100",hm="300 es",c_=1035;class op{addEventListener(o,g){this._listeners===void 0&&(this._listeners={});const $=this._listeners;$[o]===void 0&&($[o]=[]),$[o].indexOf(g)===-1&&$[o].push(g)}hasEventListener(o,g){if(this._listeners===void 0)return!1;const $=this._listeners;return $[o]!==void 0&&$[o].indexOf(g)!==-1}removeEventListener(o,g){if(this._listeners===void 0)return;const $=this._listeners[o];if($!==void 0){const _e=$.indexOf(g);_e!==-1&&$.splice(_e,1)}}dispatchEvent(o){if(this._listeners===void 0)return;const g=this._listeners[o.type];if(g!==void 0){o.target=this;const $=g.slice(0);for(let _e=0,rt=$.length;_e<rt;_e++)$[_e].call(this,o);o.target=null}}}const Il=["00","01","02","03","04","05","06","07","08","09","0a","0b","0c","0d","0e","0f","10","11","12","13","14","15","16","17","18","19","1a","1b","1c","1d","1e","1f","20","21","22","23","24","25","26","27","28","29","2a","2b","2c","2d","2e","2f","30","31","32","33","34","35","36","37","38","39","3a","3b","3c","3d","3e","3f","40","41","42","43","44","45","46","47","48","49","4a","4b","4c","4d","4e","4f","50","51","52","53","54","55","56","57","58","59","5a","5b","5c","5d","5e","5f","60","61","62","63","64","65","66","67","68","69","6a","6b","6c","6d","6e","6f","70","71","72","73","74","75","76","77","78","79","7a","7b","7c","7d","7e","7f","80","81","82","83","84","85","86","87","88","89","8a","8b","8c","8d","8e","8f","90","91","92","93","94","95","96","97","98","99","9a","9b","9c","9d","9e","9f","a0","a1","a2","a3","a4","a5","a6","a7","a8","a9","aa","ab","ac","ad","ae","af","b0","b1","b2","b3","b4","b5","b6","b7","b8","b9","ba","bb","bc","bd","be","bf","c0","c1","c2","c3","c4","c5","c6","c7","c8","c9","ca","cb","cc","cd","ce","cf","d0","d1","d2","d3","d4","d5","d6","d7","d8","d9","da","db","dc","dd","de","df","e0","e1","e2","e3","e4","e5","e6","e7","e8","e9","ea","eb","ec","ed","ee","ef","f0","f1","f2","f3","f4","f5","f6","f7","f8","f9","fa","fb","fc","fd","fe","ff"];let Cy=1234567;const d0=Math.PI/180,oA=180/Math.PI;function Es(){const dt=4294967295*Math.random()|0,o=4294967295*Math.random()|0,g=4294967295*Math.random()|0,$=4294967295*Math.random()|0;return(Il[255&dt]+Il[dt>>8&255]+Il[dt>>16&255]+Il[dt>>24&255]+"-"+Il[255&o]+Il[o>>8&255]+"-"+Il[o>>16&15|64]+Il[o>>24&255]+"-"+Il[63&g|128]+Il[g>>8&255]+"-"+Il[g>>16&255]+Il[g>>24&255]+Il[255&$]+Il[$>>8&255]+Il[$>>16&255]+Il[$>>24&255]).toLowerCase()}function As(dt,o,g){return Math.max(o,Math.min(g,dt))}function dm(dt,o){return(dt%o+o)%o}function aA(dt,o,g){return(1-g)*dt+g*o}function lA(dt){return(dt&dt-1)==0&&dt!==0}function Tv(dt){return Math.pow(2,Math.ceil(Math.log(dt)/Math.LN2))}function Du(dt){return Math.pow(2,Math.floor(Math.log(dt)/Math.LN2))}function Um(dt,o){switch(o.constructor){case Float32Array:return dt;case Uint16Array:return dt/65535;case Uint8Array:return dt/255;case Int16Array:return Math.max(dt/32767,-1);case Int8Array:return Math.max(dt/127,-1);default:throw new Error("Invalid component type.")}}function Po(dt,o){switch(o.constructor){case Float32Array:return dt;case Uint16Array:return Math.round(65535*dt);case Uint8Array:return Math.round(255*dt);case Int16Array:return Math.round(32767*dt);case Int8Array:return Math.round(127*dt);default:throw new Error("Invalid component type.")}}var jw=Object.freeze({__proto__:null,DEG2RAD:d0,RAD2DEG:oA,generateUUID:Es,clamp:As,euclideanModulo:dm,mapLinear:function(dt,o,g,$,_e){return $+(dt-o)*(_e-$)/(g-o)},inverseLerp:function(dt,o,g){return dt!==o?(g-dt)/(o-dt):0},lerp:aA,damp:function(dt,o,g,$){return aA(dt,o,1-Math.exp(-g*$))},pingpong:function(dt,o=1){return o-Math.abs(dm(dt,2*o)-o)},smoothstep:function(dt,o,g){return dt<=o?0:dt>=g?1:(dt=(dt-o)/(g-o))*dt*(3-2*dt)},smootherstep:function(dt,o,g){return dt<=o?0:dt>=g?1:(dt=(dt-o)/(g-o))*dt*dt*(dt*(6*dt-15)+10)},randInt:function(dt,o){return dt+Math.floor(Math.random()*(o-dt+1))},randFloat:function(dt,o){return dt+Math.random()*(o-dt)},randFloatSpread:function(dt){return dt*(.5-Math.random())},seededRandom:function(dt){dt!==void 0&&(Cy=dt);let o=Cy+=1831565813;return o=Math.imul(o^o>>>15,1|o),o^=o+Math.imul(o^o>>>7,61|o),((o^o>>>14)>>>0)/4294967296},degToRad:function(dt){return dt*d0},radToDeg:function(dt){return dt*oA},isPowerOfTwo:lA,ceilPowerOfTwo:Tv,floorPowerOfTwo:Du,setQuaternionFromProperEuler:function(dt,o,g,$,_e){const rt=Math.cos,at=Math.sin,ct=rt(g/2),ft=at(g/2),mt=rt((o+$)/2),bt=at((o+$)/2),Tt=rt((o-$)/2),St=at((o-$)/2),It=rt(($-o)/2),Rt=at(($-o)/2);switch(_e){case"XYX":dt.set(ct*bt,ft*Tt,ft*St,ct*mt);break;case"YZY":dt.set(ft*St,ct*bt,ft*Tt,ct*mt);break;case"ZXZ":dt.set(ft*Tt,ft*St,ct*bt,ct*mt);break;case"XZX":dt.set(ct*bt,ft*Rt,ft*It,ct*mt);break;case"YXY":dt.set(ft*It,ct*bt,ft*Rt,ct*mt);break;case"ZYZ":dt.set(ft*Rt,ft*It,ct*bt,ct*mt);break;default:console.warn("THREE.MathUtils: .setQuaternionFromProperEuler() encountered an unknown order: "+_e)}},normalize:Po,denormalize:Um});class Sr{constructor(o=0,g=0){Sr.prototype.isVector2=!0,this.x=o,this.y=g}get width(){return this.x}set width(o){this.x=o}get height(){return this.y}set height(o){this.y=o}set(o,g){return this.x=o,this.y=g,this}setScalar(o){return this.x=o,this.y=o,this}setX(o){return this.x=o,this}setY(o){return this.y=o,this}setComponent(o,g){switch(o){case 0:this.x=g;break;case 1:this.y=g;break;default:throw new Error("index is out of range: "+o)}return this}getComponent(o){switch(o){case 0:return this.x;case 1:return this.y;default:throw new Error("index is out of range: "+o)}}clone(){return new this.constructor(this.x,this.y)}copy(o){return this.x=o.x,this.y=o.y,this}add(o){return this.x+=o.x,this.y+=o.y,this}addScalar(o){return this.x+=o,this.y+=o,this}addVectors(o,g){return this.x=o.x+g.x,this.y=o.y+g.y,this}addScaledVector(o,g){return this.x+=o.x*g,this.y+=o.y*g,this}sub(o){return this.x-=o.x,this.y-=o.y,this}subScalar(o){return this.x-=o,this.y-=o,this}subVectors(o,g){return this.x=o.x-g.x,this.y=o.y-g.y,this}multiply(o){return this.x*=o.x,this.y*=o.y,this}multiplyScalar(o){return this.x*=o,this.y*=o,this}divide(o){return this.x/=o.x,this.y/=o.y,this}divideScalar(o){return this.multiplyScalar(1/o)}applyMatrix3(o){const g=this.x,$=this.y,_e=o.elements;return this.x=_e[0]*g+_e[3]*$+_e[6],this.y=_e[1]*g+_e[4]*$+_e[7],this}min(o){return this.x=Math.min(this.x,o.x),this.y=Math.min(this.y,o.y),this}max(o){return this.x=Math.max(this.x,o.x),this.y=Math.max(this.y,o.y),this}clamp(o,g){return this.x=Math.max(o.x,Math.min(g.x,this.x)),this.y=Math.max(o.y,Math.min(g.y,this.y)),this}clampScalar(o,g){return this.x=Math.max(o,Math.min(g,this.x)),this.y=Math.max(o,Math.min(g,this.y)),this}clampLength(o,g){const $=this.length();return this.divideScalar($||1).multiplyScalar(Math.max(o,Math.min(g,$)))}floor(){return this.x=Math.floor(this.x),this.y=Math.floor(this.y),this}ceil(){return this.x=Math.ceil(this.x),this.y=Math.ceil(this.y),this}round(){return this.x=Math.round(this.x),this.y=Math.round(this.y),this}roundToZero(){return this.x=this.x<0?Math.ceil(this.x):Math.floor(this.x),this.y=this.y<0?Math.ceil(this.y):Math.floor(this.y),this}negate(){return this.x=-this.x,this.y=-this.y,this}dot(o){return this.x*o.x+this.y*o.y}cross(o){return this.x*o.y-this.y*o.x}lengthSq(){return this.x*this.x+this.y*this.y}length(){return Math.sqrt(this.x*this.x+this.y*this.y)}manhattanLength(){return Math.abs(this.x)+Math.abs(this.y)}normalize(){return this.divideScalar(this.length()||1)}angle(){return Math.atan2(-this.y,-this.x)+Math.PI}distanceTo(o){return Math.sqrt(this.distanceToSquared(o))}distanceToSquared(o){const g=this.x-o.x,$=this.y-o.y;return g*g+$*$}manhattanDistanceTo(o){return Math.abs(this.x-o.x)+Math.abs(this.y-o.y)}setLength(o){return this.normalize().multiplyScalar(o)}lerp(o,g){return this.x+=(o.x-this.x)*g,this.y+=(o.y-this.y)*g,this}lerpVectors(o,g,$){return this.x=o.x+(g.x-o.x)*$,this.y=o.y+(g.y-o.y)*$,this}equals(o){return o.x===this.x&&o.y===this.y}fromArray(o,g=0){return this.x=o[g],this.y=o[g+1],this}toArray(o=[],g=0){return o[g]=this.x,o[g+1]=this.y,o}fromBufferAttribute(o,g){return this.x=o.getX(g),this.y=o.getY(g),this}rotateAround(o,g){const $=Math.cos(g),_e=Math.sin(g),rt=this.x-o.x,at=this.y-o.y;return this.x=rt*$-at*_e+o.x,this.y=rt*_e+at*$+o.y,this}random(){return this.x=Math.random(),this.y=Math.random(),this}*[Symbol.iterator](){yield this.x,yield this.y}}class nu{constructor(){nu.prototype.isMatrix3=!0,this.elements=[1,0,0,0,1,0,0,0,1]}set(o,g,$,_e,rt,at,ct,ft,mt){const bt=this.elements;return bt[0]=o,bt[1]=_e,bt[2]=ct,bt[3]=g,bt[4]=rt,bt[5]=ft,bt[6]=$,bt[7]=at,bt[8]=mt,this}identity(){return this.set(1,0,0,0,1,0,0,0,1),this}copy(o){const g=this.elements,$=o.elements;return g[0]=$[0],g[1]=$[1],g[2]=$[2],g[3]=$[3],g[4]=$[4],g[5]=$[5],g[6]=$[6],g[7]=$[7],g[8]=$[8],this}extractBasis(o,g,$){return o.setFromMatrix3Column(this,0),g.setFromMatrix3Column(this,1),$.setFromMatrix3Column(this,2),this}setFromMatrix4(o){const g=o.elements;return this.set(g[0],g[4],g[8],g[1],g[5],g[9],g[2],g[6],g[10]),this}multiply(o){return this.multiplyMatrices(this,o)}premultiply(o){return this.multiplyMatrices(o,this)}multiplyMatrices(o,g){const $=o.elements,_e=g.elements,rt=this.elements,at=$[0],ct=$[3],ft=$[6],mt=$[1],bt=$[4],Tt=$[7],St=$[2],It=$[5],Rt=$[8],Dt=_e[0],Ft=_e[3],Nt=_e[6],zt=_e[1],Xt=_e[4],tn=_e[7],sn=_e[2],ln=_e[5],kn=_e[8];return rt[0]=at*Dt+ct*zt+ft*sn,rt[3]=at*Ft+ct*Xt+ft*ln,rt[6]=at*Nt+ct*tn+ft*kn,rt[1]=mt*Dt+bt*zt+Tt*sn,rt[4]=mt*Ft+bt*Xt+Tt*ln,rt[7]=mt*Nt+bt*tn+Tt*kn,rt[2]=St*Dt+It*zt+Rt*sn,rt[5]=St*Ft+It*Xt+Rt*ln,rt[8]=St*Nt+It*tn+Rt*kn,this}multiplyScalar(o){const g=this.elements;return g[0]*=o,g[3]*=o,g[6]*=o,g[1]*=o,g[4]*=o,g[7]*=o,g[2]*=o,g[5]*=o,g[8]*=o,this}determinant(){const o=this.elements,g=o[0],$=o[1],_e=o[2],rt=o[3],at=o[4],ct=o[5],ft=o[6],mt=o[7],bt=o[8];return g*at*bt-g*ct*mt-$*rt*bt+$*ct*ft+_e*rt*mt-_e*at*ft}invert(){const o=this.elements,g=o[0],$=o[1],_e=o[2],rt=o[3],at=o[4],ct=o[5],ft=o[6],mt=o[7],bt=o[8],Tt=bt*at-ct*mt,St=ct*ft-bt*rt,It=mt*rt-at*ft,Rt=g*Tt+$*St+_e*It;if(Rt===0)return this.set(0,0,0,0,0,0,0,0,0);const Dt=1/Rt;return o[0]=Tt*Dt,o[1]=(_e*mt-bt*$)*Dt,o[2]=(ct*$-_e*at)*Dt,o[3]=St*Dt,o[4]=(bt*g-_e*ft)*Dt,o[5]=(_e*rt-ct*g)*Dt,o[6]=It*Dt,o[7]=($*ft-mt*g)*Dt,o[8]=(at*g-$*rt)*Dt,this}transpose(){let o;const g=this.elements;return o=g[1],g[1]=g[3],g[3]=o,o=g[2],g[2]=g[6],g[6]=o,o=g[5],g[5]=g[7],g[7]=o,this}getNormalMatrix(o){return this.setFromMatrix4(o).invert().transpose()}transposeIntoArray(o){const g=this.elements;return o[0]=g[0],o[1]=g[3],o[2]=g[6],o[3]=g[1],o[4]=g[4],o[5]=g[7],o[6]=g[2],o[7]=g[5],o[8]=g[8],this}setUvTransform(o,g,$,_e,rt,at,ct){const ft=Math.cos(rt),mt=Math.sin(rt);return this.set($*ft,$*mt,-$*(ft*at+mt*ct)+at+o,-_e*mt,_e*ft,-_e*(-mt*at+ft*ct)+ct+g,0,0,1),this}scale(o,g){const $=this.elements;return $[0]*=o,$[3]*=o,$[6]*=o,$[1]*=g,$[4]*=g,$[7]*=g,this}rotate(o){const g=Math.cos(o),$=Math.sin(o),_e=this.elements,rt=_e[0],at=_e[3],ct=_e[6],ft=_e[1],mt=_e[4],bt=_e[7];return _e[0]=g*rt+$*ft,_e[3]=g*at+$*mt,_e[6]=g*ct+$*bt,_e[1]=-$*rt+g*ft,_e[4]=-$*at+g*mt,_e[7]=-$*ct+g*bt,this}translate(o,g){const $=this.elements;return $[0]+=o*$[2],$[3]+=o*$[5],$[6]+=o*$[8],$[1]+=g*$[2],$[4]+=g*$[5],$[7]+=g*$[8],this}equals(o){const g=this.elements,$=o.elements;for(let _e=0;_e<9;_e++)if(g[_e]!==$[_e])return!1;return!0}fromArray(o,g=0){for(let $=0;$<9;$++)this.elements[$]=o[$+g];return this}toArray(o=[],g=0){const $=this.elements;return o[g]=$[0],o[g+1]=$[1],o[g+2]=$[2],o[g+3]=$[3],o[g+4]=$[4],o[g+5]=$[5],o[g+6]=$[6],o[g+7]=$[7],o[g+8]=$[8],o}clone(){return new this.constructor().fromArray(this.elements)}}function E1(dt){for(let o=dt.length-1;o>=0;--o)if(dt[o]>65535)return!0;return!1}const OS={Int8Array,Uint8Array,Uint8ClampedArray,Int16Array,Uint16Array,Int32Array,Uint32Array,Float32Array,Float64Array};function Iv(dt,o){return new OS[dt](o)}function p0(dt){return document.createElementNS("http://www.w3.org/1999/xhtml",dt)}function pm(dt){return dt<.04045?.0773993808*dt:Math.pow(.9478672986*dt+.0521327014,2.4)}function cA(dt){return dt<.0031308?12.92*dt:1.055*Math.pow(dt,.41666)-.055}const Dv={[tu]:{[vo]:pm},[vo]:{[tu]:cA}},bp={legacyMode:!0,get workingColorSpace(){return vo},set workingColorSpace(dt){console.warn("THREE.ColorManagement: .workingColorSpace is readonly.")},convert:function(dt,o,g){if(this.legacyMode||o===g||!o||!g)return dt;if(Dv[o]&&Dv[o][g]!==void 0){const $=Dv[o][g];return dt.r=$(dt.r),dt.g=$(dt.g),dt.b=$(dt.b),dt}throw new Error("Unsupported color space conversion.")},fromWorkingColorSpace:function(dt,o){return this.convert(dt,this.workingColorSpace,o)},toWorkingColorSpace:function(dt,o){return this.convert(dt,o,this.workingColorSpace)}},zw={aliceblue:15792383,antiquewhite:16444375,aqua:65535,aquamarine:8388564,azure:15794175,beige:16119260,bisque:16770244,black:0,blanchedalmond:16772045,blue:255,blueviolet:9055202,brown:10824234,burlywood:14596231,cadetblue:6266528,chartreuse:8388352,chocolate:13789470,coral:16744272,cornflowerblue:6591981,cornsilk:16775388,crimson:14423100,cyan:65535,darkblue:139,darkcyan:35723,darkgoldenrod:12092939,darkgray:11119017,darkgreen:25600,darkgrey:11119017,darkkhaki:12433259,darkmagenta:9109643,darkolivegreen:5597999,darkorange:16747520,darkorchid:10040012,darkred:9109504,darksalmon:15308410,darkseagreen:9419919,darkslateblue:4734347,darkslategray:3100495,darkslategrey:3100495,darkturquoise:52945,darkviolet:9699539,deeppink:16716947,deepskyblue:49151,dimgray:6908265,dimgrey:6908265,dodgerblue:2003199,firebrick:11674146,floralwhite:16775920,forestgreen:2263842,fuchsia:16711935,gainsboro:14474460,ghostwhite:16316671,gold:16766720,goldenrod:14329120,gray:8421504,green:32768,greenyellow:11403055,grey:8421504,honeydew:15794160,hotpink:16738740,indianred:13458524,indigo:4915330,ivory:16777200,khaki:15787660,lavender:15132410,lavenderblush:16773365,lawngreen:8190976,lemonchiffon:16775885,lightblue:11393254,lightcoral:15761536,lightcyan:14745599,lightgoldenrodyellow:16448210,lightgray:13882323,lightgreen:9498256,lightgrey:13882323,lightpink:16758465,lightsalmon:16752762,lightseagreen:2142890,lightskyblue:8900346,lightslategray:7833753,lightslategrey:7833753,lightsteelblue:11584734,lightyellow:16777184,lime:65280,limegreen:3329330,linen:16445670,magenta:16711935,maroon:8388608,mediumaquamarine:6737322,mediumblue:205,mediumorchid:12211667,mediumpurple:9662683,mediumseagreen:3978097,mediumslateblue:8087790,mediumspringgreen:64154,mediumturquoise:4772300,mediumvioletred:13047173,midnightblue:1644912,mintcream:16121850,mistyrose:16770273,moccasin:16770229,navajowhite:16768685,navy:128,oldlace:16643558,olive:8421376,olivedrab:7048739,orange:16753920,orangered:16729344,orchid:14315734,palegoldenrod:15657130,palegreen:10025880,paleturquoise:11529966,palevioletred:14381203,papayawhip:16773077,peachpuff:16767673,peru:13468991,pink:16761035,plum:14524637,powderblue:11591910,purple:8388736,rebeccapurple:6697881,red:16711680,rosybrown:12357519,royalblue:4286945,saddlebrown:9127187,salmon:16416882,sandybrown:16032864,seagreen:3050327,seashell:16774638,sienna:10506797,silver:12632256,skyblue:8900331,slateblue:6970061,slategray:7372944,slategrey:7372944,snow:16775930,springgreen:65407,steelblue:4620980,tan:13808780,teal:32896,thistle:14204888,tomato:16737095,turquoise:4251856,violet:15631086,wheat:16113331,white:16777215,whitesmoke:16119285,yellow:16776960,yellowgreen:10145074},ba={r:0,g:0,b:0},zp={h:0,s:0,l:0},My={h:0,s:0,l:0};function Ep(dt,o,g){return g<0&&(g+=1),g>1&&(g-=1),g<1/6?dt+6*(o-dt)*g:g<.5?o:g<2/3?dt+6*(o-dt)*(2/3-g):dt}function uA(dt,o){return o.r=dt.r,o.g=dt.g,o.b=dt.b,o}class rs{constructor(o,g,$){return this.isColor=!0,this.r=1,this.g=1,this.b=1,g===void 0&&$===void 0?this.set(o):this.setRGB(o,g,$)}set(o){return o&&o.isColor?this.copy(o):typeof o=="number"?this.setHex(o):typeof o=="string"&&this.setStyle(o),this}setScalar(o){return this.r=o,this.g=o,this.b=o,this}setHex(o,g=tu){return o=Math.floor(o),this.r=(o>>16&255)/255,this.g=(o>>8&255)/255,this.b=(255&o)/255,bp.toWorkingColorSpace(this,g),this}setRGB(o,g,$,_e=vo){return this.r=o,this.g=g,this.b=$,bp.toWorkingColorSpace(this,_e),this}setHSL(o,g,$,_e=vo){if(o=dm(o,1),g=As(g,0,1),$=As($,0,1),g===0)this.r=this.g=this.b=$;else{const rt=$<=.5?$*(1+g):$+g-$*g,at=2*$-rt;this.r=Ep(at,rt,o+1/3),this.g=Ep(at,rt,o),this.b=Ep(at,rt,o-1/3)}return bp.toWorkingColorSpace(this,_e),this}setStyle(o,g=tu){function $(rt){rt!==void 0&&parseFloat(rt)<1&&console.warn("THREE.Color: Alpha component of "+o+" will be ignored.")}let _e;if(_e=/^((?:rgb|hsl)a?)\(([^\)]*)\)/.exec(o)){let rt;const at=_e[1],ct=_e[2];switch(at){case"rgb":case"rgba":if(rt=/^\s*(\d+)\s*,\s*(\d+)\s*,\s*(\d+)\s*(?:,\s*(\d*\.?\d+)\s*)?$/.exec(ct))return this.r=Math.min(255,parseInt(rt[1],10))/255,this.g=Math.min(255,parseInt(rt[2],10))/255,this.b=Math.min(255,parseInt(rt[3],10))/255,bp.toWorkingColorSpace(this,g),$(rt[4]),this;if(rt=/^\s*(\d+)\%\s*,\s*(\d+)\%\s*,\s*(\d+)\%\s*(?:,\s*(\d*\.?\d+)\s*)?$/.exec(ct))return this.r=Math.min(100,parseInt(rt[1],10))/100,this.g=Math.min(100,parseInt(rt[2],10))/100,this.b=Math.min(100,parseInt(rt[3],10))/100,bp.toWorkingColorSpace(this,g),$(rt[4]),this;break;case"hsl":case"hsla":if(rt=/^\s*(\d*\.?\d+)\s*,\s*(\d*\.?\d+)\%\s*,\s*(\d*\.?\d+)\%\s*(?:,\s*(\d*\.?\d+)\s*)?$/.exec(ct)){const ft=parseFloat(rt[1])/360,mt=parseFloat(rt[2])/100,bt=parseFloat(rt[3])/100;return $(rt[4]),this.setHSL(ft,mt,bt,g)}}}else if(_e=/^\#([A-Fa-f\d]+)$/.exec(o)){const rt=_e[1],at=rt.length;if(at===3)return this.r=parseInt(rt.charAt(0)+rt.charAt(0),16)/255,this.g=parseInt(rt.charAt(1)+rt.charAt(1),16)/255,this.b=parseInt(rt.charAt(2)+rt.charAt(2),16)/255,bp.toWorkingColorSpace(this,g),this;if(at===6)return this.r=parseInt(rt.charAt(0)+rt.charAt(1),16)/255,this.g=parseInt(rt.charAt(2)+rt.charAt(3),16)/255,this.b=parseInt(rt.charAt(4)+rt.charAt(5),16)/255,bp.toWorkingColorSpace(this,g),this}return o&&o.length>0?this.setColorName(o,g):this}setColorName(o,g=tu){const $=zw[o.toLowerCase()];return $!==void 0?this.setHex($,g):console.warn("THREE.Color: Unknown color "+o),this}clone(){return new this.constructor(this.r,this.g,this.b)}copy(o){return this.r=o.r,this.g=o.g,this.b=o.b,this}copySRGBToLinear(o){return this.r=pm(o.r),this.g=pm(o.g),this.b=pm(o.b),this}copyLinearToSRGB(o){return this.r=cA(o.r),this.g=cA(o.g),this.b=cA(o.b),this}convertSRGBToLinear(){return this.copySRGBToLinear(this),this}convertLinearToSRGB(){return this.copyLinearToSRGB(this),this}getHex(o=tu){return bp.fromWorkingColorSpace(uA(this,ba),o),As(255*ba.r,0,255)<<16^As(255*ba.g,0,255)<<8^As(255*ba.b,0,255)<<0}getHexString(o=tu){return("000000"+this.getHex(o).toString(16)).slice(-6)}getHSL(o,g=vo){bp.fromWorkingColorSpace(uA(this,ba),g);const $=ba.r,_e=ba.g,rt=ba.b,at=Math.max($,_e,rt),ct=Math.min($,_e,rt);let ft,mt;const bt=(ct+at)/2;if(ct===at)ft=0,mt=0;else{const Tt=at-ct;switch(mt=bt<=.5?Tt/(at+ct):Tt/(2-at-ct),at){case $:ft=(_e-rt)/Tt+(_e<rt?6:0);break;case _e:ft=(rt-$)/Tt+2;break;case rt:ft=($-_e)/Tt+4}ft/=6}return o.h=ft,o.s=mt,o.l=bt,o}getRGB(o,g=vo){return bp.fromWorkingColorSpace(uA(this,ba),g),o.r=ba.r,o.g=ba.g,o.b=ba.b,o}getStyle(o=tu){return bp.fromWorkingColorSpace(uA(this,ba),o),o!==tu?`color(${o} ${ba.r} ${ba.g} ${ba.b})`:`rgb(${255*ba.r|0},${255*ba.g|0},${255*ba.b|0})`}offsetHSL(o,g,$){return this.getHSL(zp),zp.h+=o,zp.s+=g,zp.l+=$,this.setHSL(zp.h,zp.s,zp.l),this}add(o){return this.r+=o.r,this.g+=o.g,this.b+=o.b,this}addColors(o,g){return this.r=o.r+g.r,this.g=o.g+g.g,this.b=o.b+g.b,this}addScalar(o){return this.r+=o,this.g+=o,this.b+=o,this}sub(o){return this.r=Math.max(0,this.r-o.r),this.g=Math.max(0,this.g-o.g),this.b=Math.max(0,this.b-o.b),this}multiply(o){return this.r*=o.r,this.g*=o.g,this.b*=o.b,this}multiplyScalar(o){return this.r*=o,this.g*=o,this.b*=o,this}lerp(o,g){return this.r+=(o.r-this.r)*g,this.g+=(o.g-this.g)*g,this.b+=(o.b-this.b)*g,this}lerpColors(o,g,$){return this.r=o.r+(g.r-o.r)*$,this.g=o.g+(g.g-o.g)*$,this.b=o.b+(g.b-o.b)*$,this}lerpHSL(o,g){this.getHSL(zp),o.getHSL(My);const $=aA(zp.h,My.h,g),_e=aA(zp.s,My.s,g),rt=aA(zp.l,My.l,g);return this.setHSL($,_e,rt),this}equals(o){return o.r===this.r&&o.g===this.g&&o.b===this.b}fromArray(o,g=0){return this.r=o[g],this.g=o[g+1],this.b=o[g+2],this}toArray(o=[],g=0){return o[g]=this.r,o[g+1]=this.g,o[g+2]=this.b,o}fromBufferAttribute(o,g){return this.r=o.getX(g),this.g=o.getY(g),this.b=o.getZ(g),this}toJSON(){return this.getHex()}*[Symbol.iterator](){yield this.r,yield this.g,yield this.b}}let f0;rs.NAMES=zw;class m0{static getDataURL(o,g=!1){if(/^data:/i.test(o.src)||typeof HTMLCanvasElement>"u")return o.src;let $;if(o instanceof HTMLCanvasElement)$=o;else{f0===void 0&&(f0=p0("canvas")),f0.width=o.width,f0.height=o.height;const _e=f0.getContext("2d");o instanceof ImageData?_e.putImageData(o,0,0):_e.drawImage(o,0,0,o.width,o.height),$=f0}return!g&&($.width>2048||$.height>2048)?(console.warn("THREE.ImageUtils.getDataURL: Image converted to jpg for performance reasons",o),$.toDataURL("image/jpeg",.6)):$.toDataURL("image/png")}static sRGBToLinear(o){if(typeof HTMLImageElement<"u"&&o instanceof HTMLImageElement||typeof HTMLCanvasElement<"u"&&o instanceof HTMLCanvasElement||typeof ImageBitmap<"u"&&o instanceof ImageBitmap){const g=p0("canvas");g.width=o.width,g.height=o.height;const $=g.getContext("2d");$.drawImage(o,0,0,o.width,o.height);const _e=$.getImageData(0,0,o.width,o.height),rt=_e.data;for(let at=0;at<rt.length;at++)rt[at]=255*pm(rt[at]/255);return $.putImageData(_e,0,0),g}if(o.data){const g=o.data.slice(0);for(let $=0;$<g.length;$++)g instanceof Uint8Array||g instanceof Uint8ClampedArray?g[$]=Math.floor(255*pm(g[$]/255)):g[$]=pm(g[$]);return{data:g,width:o.width,height:o.height}}return console.warn("THREE.ImageUtils.sRGBToLinear(): Unsupported image type. No color space conversion applied."),o}}class Sp{constructor(o=null){this.isSource=!0,this.uuid=Es(),this.data=o,this.version=0}set needsUpdate(o){o===!0&&this.version++}toJSON(o){const g=o===void 0||typeof o=="string";if(!g&&o.images[this.uuid]!==void 0)return o.images[this.uuid];const $={uuid:this.uuid,url:""},_e=this.data;if(_e!==null){let rt;if(Array.isArray(_e)){rt=[];for(let at=0,ct=_e.length;at<ct;at++)_e[at].isDataTexture?rt.push(hA(_e[at].image)):rt.push(hA(_e[at]))}else rt=hA(_e);$.url=rt}return g||(o.images[this.uuid]=$),$}}function hA(dt){if(typeof HTMLImageElement<"u"&&dt instanceof HTMLImageElement||typeof HTMLCanvasElement<"u"&&dt instanceof HTMLCanvasElement||typeof ImageBitmap<"u"&&dt instanceof ImageBitmap)return m0.getDataURL(dt);if(dt.data){let o=[];try{o=Array.from(dt.data)}catch(g){g.message.includes("Invalid array length")?console.warn("Serializing large texture, might not be saved in JSON structure."):console.error(g),o=dt.data}return{data:o,width:dt.width,height:dt.height,type:dt.data.constructor.name}}return console.warn("THREE.Texture: Unable to serialize Texture."),{}}let u_=0;class qo extends op{constructor(o=qo.DEFAULT_IMAGE,g=qo.DEFAULT_MAPPING,$=Lo,_e=Lo,rt=xa,at=mo,ct=Hu,ft=am,mt=1,bt=qu){super(),this.isTexture=!0,Object.defineProperty(this,"id",{value:u_++}),this.uuid=Es(),this.name="",this.source=new Sp(o),this.mipmaps=[],this.mapping=g,this.wrapS=$,this.wrapT=_e,this.magFilter=rt,this.minFilter=at,this.anisotropy=mt,this.format=ct,this.internalFormat=null,this.type=ft,this.offset=new Sr(0,0),this.repeat=new Sr(1,1),this.center=new Sr(0,0),this.rotation=0,this.matrixAutoUpdate=!0,this.matrix=new nu,this.generateMipmaps=!0,this.premultiplyAlpha=!1,this.flipY=!0,this.unpackAlignment=4,this.encoding=bt,this.userData={},this.version=0,this.onUpdate=null,this.isRenderTargetTexture=!1,this.needsPMREMUpdate=!1}get image(){return this.source.data}set image(o){this.source.data=o}updateMatrix(){this.matrix.setUvTransform(this.offset.x,this.offset.y,this.repeat.x,this.repeat.y,this.rotation,this.center.x,this.center.y)}clone(){return new this.constructor().copy(this)}copy(o){return this.name=o.name,this.source=o.source,this.mipmaps=o.mipmaps.slice(0),this.mapping=o.mapping,this.wrapS=o.wrapS,this.wrapT=o.wrapT,this.magFilter=o.magFilter,this.minFilter=o.minFilter,this.anisotropy=o.anisotropy,this.format=o.format,this.internalFormat=o.internalFormat,this.type=o.type,this.offset.copy(o.offset),this.repeat.copy(o.repeat),this.center.copy(o.center),this.rotation=o.rotation,this.matrixAutoUpdate=o.matrixAutoUpdate,this.matrix.copy(o.matrix),this.generateMipmaps=o.generateMipmaps,this.premultiplyAlpha=o.premultiplyAlpha,this.flipY=o.flipY,this.unpackAlignment=o.unpackAlignment,this.encoding=o.encoding,this.userData=JSON.parse(JSON.stringify(o.userData)),this.needsUpdate=!0,this}toJSON(o){const g=o===void 0||typeof o=="string";if(!g&&o.textures[this.uuid]!==void 0)return o.textures[this.uuid];const $={metadata:{version:4.5,type:"Texture",generator:"Texture.toJSON"},uuid:this.uuid,name:this.name,image:this.source.toJSON(o).uuid,mapping:this.mapping,repeat:[this.repeat.x,this.repeat.y],offset:[this.offset.x,this.offset.y],center:[this.center.x,this.center.y],rotation:this.rotation,wrap:[this.wrapS,this.wrapT],format:this.format,type:this.type,encoding:this.encoding,minFilter:this.minFilter,magFilter:this.magFilter,anisotropy:this.anisotropy,flipY:this.flipY,premultiplyAlpha:this.premultiplyAlpha,unpackAlignment:this.unpackAlignment};return JSON.stringify(this.userData)!=="{}"&&($.userData=this.userData),g||(o.textures[this.uuid]=$),$}dispose(){this.dispatchEvent({type:"dispose"})}transformUv(o){if(this.mapping!==fu)return o;if(o.applyMatrix3(this.matrix),o.x<0||o.x>1)switch(this.wrapS){case Mu:o.x=o.x-Math.floor(o.x);break;case Lo:o.x=o.x<0?0:1;break;case Lp:Math.abs(Math.floor(o.x)%2)===1?o.x=Math.ceil(o.x)-o.x:o.x=o.x-Math.floor(o.x)}if(o.y<0||o.y>1)switch(this.wrapT){case Mu:o.y=o.y-Math.floor(o.y);break;case Lo:o.y=o.y<0?0:1;break;case Lp:Math.abs(Math.floor(o.y)%2)===1?o.y=Math.ceil(o.y)-o.y:o.y=o.y-Math.floor(o.y)}return this.flipY&&(o.y=1-o.y),o}set needsUpdate(o){o===!0&&(this.version++,this.source.needsUpdate=!0)}}qo.DEFAULT_IMAGE=null,qo.DEFAULT_MAPPING=fu;class _o{constructor(o=0,g=0,$=0,_e=1){_o.prototype.isVector4=!0,this.x=o,this.y=g,this.z=$,this.w=_e}get width(){return this.z}set width(o){this.z=o}get height(){return this.w}set height(o){this.w=o}set(o,g,$,_e){return this.x=o,this.y=g,this.z=$,this.w=_e,this}setScalar(o){return this.x=o,this.y=o,this.z=o,this.w=o,this}setX(o){return this.x=o,this}setY(o){return this.y=o,this}setZ(o){return this.z=o,this}setW(o){return this.w=o,this}setComponent(o,g){switch(o){case 0:this.x=g;break;case 1:this.y=g;break;case 2:this.z=g;break;case 3:this.w=g;break;default:throw new Error("index is out of range: "+o)}return this}getComponent(o){switch(o){case 0:return this.x;case 1:return this.y;case 2:return this.z;case 3:return this.w;default:throw new Error("index is out of range: "+o)}}clone(){return new this.constructor(this.x,this.y,this.z,this.w)}copy(o){return this.x=o.x,this.y=o.y,this.z=o.z,this.w=o.w!==void 0?o.w:1,this}add(o){return this.x+=o.x,this.y+=o.y,this.z+=o.z,this.w+=o.w,this}addScalar(o){return this.x+=o,this.y+=o,this.z+=o,this.w+=o,this}addVectors(o,g){return this.x=o.x+g.x,this.y=o.y+g.y,this.z=o.z+g.z,this.w=o.w+g.w,this}addScaledVector(o,g){return this.x+=o.x*g,this.y+=o.y*g,this.z+=o.z*g,this.w+=o.w*g,this}sub(o){return this.x-=o.x,this.y-=o.y,this.z-=o.z,this.w-=o.w,this}subScalar(o){return this.x-=o,this.y-=o,this.z-=o,this.w-=o,this}subVectors(o,g){return this.x=o.x-g.x,this.y=o.y-g.y,this.z=o.z-g.z,this.w=o.w-g.w,this}multiply(o){return this.x*=o.x,this.y*=o.y,this.z*=o.z,this.w*=o.w,this}multiplyScalar(o){return this.x*=o,this.y*=o,this.z*=o,this.w*=o,this}applyMatrix4(o){const g=this.x,$=this.y,_e=this.z,rt=this.w,at=o.elements;return this.x=at[0]*g+at[4]*$+at[8]*_e+at[12]*rt,this.y=at[1]*g+at[5]*$+at[9]*_e+at[13]*rt,this.z=at[2]*g+at[6]*$+at[10]*_e+at[14]*rt,this.w=at[3]*g+at[7]*$+at[11]*_e+at[15]*rt,this}divideScalar(o){return this.multiplyScalar(1/o)}setAxisAngleFromQuaternion(o){this.w=2*Math.acos(o.w);const g=Math.sqrt(1-o.w*o.w);return g<1e-4?(this.x=1,this.y=0,this.z=0):(this.x=o.x/g,this.y=o.y/g,this.z=o.z/g),this}setAxisAngleFromRotationMatrix(o){let g,$,_e,rt;const ft=o.elements,mt=ft[0],bt=ft[4],Tt=ft[8],St=ft[1],It=ft[5],Rt=ft[9],Dt=ft[2],Ft=ft[6],Nt=ft[10];if(Math.abs(bt-St)<.01&&Math.abs(Tt-Dt)<.01&&Math.abs(Rt-Ft)<.01){if(Math.abs(bt+St)<.1&&Math.abs(Tt+Dt)<.1&&Math.abs(Rt+Ft)<.1&&Math.abs(mt+It+Nt-3)<.1)return this.set(1,0,0,0),this;g=Math.PI;const Xt=(mt+1)/2,tn=(It+1)/2,sn=(Nt+1)/2,ln=(bt+St)/4,kn=(Tt+Dt)/4,Ln=(Rt+Ft)/4;return Xt>tn&&Xt>sn?Xt<.01?($=0,_e=.707106781,rt=.707106781):($=Math.sqrt(Xt),_e=ln/$,rt=kn/$):tn>sn?tn<.01?($=.707106781,_e=0,rt=.707106781):(_e=Math.sqrt(tn),$=ln/_e,rt=Ln/_e):sn<.01?($=.707106781,_e=.707106781,rt=0):(rt=Math.sqrt(sn),$=kn/rt,_e=Ln/rt),this.set($,_e,rt,g),this}let zt=Math.sqrt((Ft-Rt)*(Ft-Rt)+(Tt-Dt)*(Tt-Dt)+(St-bt)*(St-bt));return Math.abs(zt)<.001&&(zt=1),this.x=(Ft-Rt)/zt,this.y=(Tt-Dt)/zt,this.z=(St-bt)/zt,this.w=Math.acos((mt+It+Nt-1)/2),this}min(o){return this.x=Math.min(this.x,o.x),this.y=Math.min(this.y,o.y),this.z=Math.min(this.z,o.z),this.w=Math.min(this.w,o.w),this}max(o){return this.x=Math.max(this.x,o.x),this.y=Math.max(this.y,o.y),this.z=Math.max(this.z,o.z),this.w=Math.max(this.w,o.w),this}clamp(o,g){return this.x=Math.max(o.x,Math.min(g.x,this.x)),this.y=Math.max(o.y,Math.min(g.y,this.y)),this.z=Math.max(o.z,Math.min(g.z,this.z)),this.w=Math.max(o.w,Math.min(g.w,this.w)),this}clampScalar(o,g){return this.x=Math.max(o,Math.min(g,this.x)),this.y=Math.max(o,Math.min(g,this.y)),this.z=Math.max(o,Math.min(g,this.z)),this.w=Math.max(o,Math.min(g,this.w)),this}clampLength(o,g){const $=this.length();return this.divideScalar($||1).multiplyScalar(Math.max(o,Math.min(g,$)))}floor(){return this.x=Math.floor(this.x),this.y=Math.floor(this.y),this.z=Math.floor(this.z),this.w=Math.floor(this.w),this}ceil(){return this.x=Math.ceil(this.x),this.y=Math.ceil(this.y),this.z=Math.ceil(this.z),this.w=Math.ceil(this.w),this}round(){return this.x=Math.round(this.x),this.y=Math.round(this.y),this.z=Math.round(this.z),this.w=Math.round(this.w),this}roundToZero(){return this.x=this.x<0?Math.ceil(this.x):Math.floor(this.x),this.y=this.y<0?Math.ceil(this.y):Math.floor(this.y),this.z=this.z<0?Math.ceil(this.z):Math.floor(this.z),this.w=this.w<0?Math.ceil(this.w):Math.floor(this.w),this}negate(){return this.x=-this.x,this.y=-this.y,this.z=-this.z,this.w=-this.w,this}dot(o){return this.x*o.x+this.y*o.y+this.z*o.z+this.w*o.w}lengthSq(){return this.x*this.x+this.y*this.y+this.z*this.z+this.w*this.w}length(){return Math.sqrt(this.x*this.x+this.y*this.y+this.z*this.z+this.w*this.w)}manhattanLength(){return Math.abs(this.x)+Math.abs(this.y)+Math.abs(this.z)+Math.abs(this.w)}normalize(){return this.divideScalar(this.length()||1)}setLength(o){return this.normalize().multiplyScalar(o)}lerp(o,g){return this.x+=(o.x-this.x)*g,this.y+=(o.y-this.y)*g,this.z+=(o.z-this.z)*g,this.w+=(o.w-this.w)*g,this}lerpVectors(o,g,$){return this.x=o.x+(g.x-o.x)*$,this.y=o.y+(g.y-o.y)*$,this.z=o.z+(g.z-o.z)*$,this.w=o.w+(g.w-o.w)*$,this}equals(o){return o.x===this.x&&o.y===this.y&&o.z===this.z&&o.w===this.w}fromArray(o,g=0){return this.x=o[g],this.y=o[g+1],this.z=o[g+2],this.w=o[g+3],this}toArray(o=[],g=0){return o[g]=this.x,o[g+1]=this.y,o[g+2]=this.z,o[g+3]=this.w,o}fromBufferAttribute(o,g){return this.x=o.getX(g),this.y=o.getY(g),this.z=o.getZ(g),this.w=o.getW(g),this}random(){return this.x=Math.random(),this.y=Math.random(),this.z=Math.random(),this.w=Math.random(),this}*[Symbol.iterator](){yield this.x,yield this.y,yield this.z,yield this.w}}class ap extends op{constructor(o,g,$={}){super(),this.isWebGLRenderTarget=!0,this.width=o,this.height=g,this.depth=1,this.scissor=new _o(0,0,o,g),this.scissorTest=!1,this.viewport=new _o(0,0,o,g);const _e={width:o,height:g,depth:1};this.texture=new qo(_e,$.mapping,$.wrapS,$.wrapT,$.magFilter,$.minFilter,$.format,$.type,$.anisotropy,$.encoding),this.texture.isRenderTargetTexture=!0,this.texture.flipY=!1,this.texture.generateMipmaps=$.generateMipmaps!==void 0&&$.generateMipmaps,this.texture.internalFormat=$.internalFormat!==void 0?$.internalFormat:null,this.texture.minFilter=$.minFilter!==void 0?$.minFilter:xa,this.depthBuffer=$.depthBuffer===void 0||$.depthBuffer,this.stencilBuffer=$.stencilBuffer!==void 0&&$.stencilBuffer,this.depthTexture=$.depthTexture!==void 0?$.depthTexture:null,this.samples=$.samples!==void 0?$.samples:0}setSize(o,g,$=1){this.width===o&&this.height===g&&this.depth===$||(this.width=o,this.height=g,this.depth=$,this.texture.image.width=o,this.texture.image.height=g,this.texture.image.depth=$,this.dispose()),this.viewport.set(0,0,o,g),this.scissor.set(0,0,o,g)}clone(){return new this.constructor().copy(this)}copy(o){this.width=o.width,this.height=o.height,this.depth=o.depth,this.viewport.copy(o.viewport),this.texture=o.texture.clone(),this.texture.isRenderTargetTexture=!0;const g=Object.assign({},o.texture.image);return this.texture.source=new Sp(g),this.depthBuffer=o.depthBuffer,this.stencilBuffer=o.stencilBuffer,o.depthTexture!==null&&(this.depthTexture=o.depthTexture.clone()),this.samples=o.samples,this}dispose(){this.dispatchEvent({type:"dispose"})}}class h_ extends qo{constructor(o=null,g=1,$=1,_e=1){super(null),this.isDataArrayTexture=!0,this.image={data:o,width:g,height:$,depth:_e},this.magFilter=na,this.minFilter=na,this.wrapR=Lo,this.generateMipmaps=!1,this.flipY=!1,this.unpackAlignment=1}}class Vw extends ap{constructor(o,g,$){super(o,g),this.isWebGLArrayRenderTarget=!0,this.depth=$,this.texture=new h_(null,o,g,$),this.texture.isRenderTargetTexture=!0}}class d_ extends qo{constructor(o=null,g=1,$=1,_e=1){super(null),this.isData3DTexture=!0,this.image={data:o,width:g,height:$,depth:_e},this.magFilter=na,this.minFilter=na,this.wrapR=Lo,this.generateMipmaps=!1,this.flipY=!1,this.unpackAlignment=1}}class S1 extends ap{constructor(o,g,$){super(o,g),this.isWebGL3DRenderTarget=!0,this.depth=$,this.texture=new d_(null,o,g,$),this.texture.isRenderTargetTexture=!0}}class C1 extends ap{constructor(o,g,$,_e={}){super(o,g,_e),this.isWebGLMultipleRenderTargets=!0;const rt=this.texture;this.texture=[];for(let at=0;at<$;at++)this.texture[at]=rt.clone(),this.texture[at].isRenderTargetTexture=!0}setSize(o,g,$=1){if(this.width!==o||this.height!==g||this.depth!==$){this.width=o,this.height=g,this.depth=$;for(let _e=0,rt=this.texture.length;_e<rt;_e++)this.texture[_e].image.width=o,this.texture[_e].image.height=g,this.texture[_e].image.depth=$;this.dispose()}return this.viewport.set(0,0,o,g),this.scissor.set(0,0,o,g),this}copy(o){this.dispose(),this.width=o.width,this.height=o.height,this.depth=o.depth,this.viewport.set(0,0,this.width,this.height),this.scissor.set(0,0,this.width,this.height),this.depthBuffer=o.depthBuffer,this.stencilBuffer=o.stencilBuffer,o.depthTexture!==null&&(this.depthTexture=o.depthTexture.clone()),this.texture.length=0;for(let g=0,$=o.texture.length;g<$;g++)this.texture[g]=o.texture[g].clone(),this.texture[g].isRenderTargetTexture=!0;return this}}class iu{constructor(o=0,g=0,$=0,_e=1){this.isQuaternion=!0,this._x=o,this._y=g,this._z=$,this._w=_e}static slerpFlat(o,g,$,_e,rt,at,ct){let ft=$[_e+0],mt=$[_e+1],bt=$[_e+2],Tt=$[_e+3];const St=rt[at+0],It=rt[at+1],Rt=rt[at+2],Dt=rt[at+3];if(ct===0)return o[g+0]=ft,o[g+1]=mt,o[g+2]=bt,void(o[g+3]=Tt);if(ct===1)return o[g+0]=St,o[g+1]=It,o[g+2]=Rt,void(o[g+3]=Dt);if(Tt!==Dt||ft!==St||mt!==It||bt!==Rt){let Ft=1-ct;const Nt=ft*St+mt*It+bt*Rt+Tt*Dt,zt=Nt>=0?1:-1,Xt=1-Nt*Nt;if(Xt>Number.EPSILON){const sn=Math.sqrt(Xt),ln=Math.atan2(sn,Nt*zt);Ft=Math.sin(Ft*ln)/sn,ct=Math.sin(ct*ln)/sn}const tn=ct*zt;if(ft=ft*Ft+St*tn,mt=mt*Ft+It*tn,bt=bt*Ft+Rt*tn,Tt=Tt*Ft+Dt*tn,Ft===1-ct){const sn=1/Math.sqrt(ft*ft+mt*mt+bt*bt+Tt*Tt);ft*=sn,mt*=sn,bt*=sn,Tt*=sn}}o[g]=ft,o[g+1]=mt,o[g+2]=bt,o[g+3]=Tt}static multiplyQuaternionsFlat(o,g,$,_e,rt,at){const ct=$[_e],ft=$[_e+1],mt=$[_e+2],bt=$[_e+3],Tt=rt[at],St=rt[at+1],It=rt[at+2],Rt=rt[at+3];return o[g]=ct*Rt+bt*Tt+ft*It-mt*St,o[g+1]=ft*Rt+bt*St+mt*Tt-ct*It,o[g+2]=mt*Rt+bt*It+ct*St-ft*Tt,o[g+3]=bt*Rt-ct*Tt-ft*St-mt*It,o}get x(){return this._x}set x(o){this._x=o,this._onChangeCallback()}get y(){return this._y}set y(o){this._y=o,this._onChangeCallback()}get z(){return this._z}set z(o){this._z=o,this._onChangeCallback()}get w(){return this._w}set w(o){this._w=o,this._onChangeCallback()}set(o,g,$,_e){return this._x=o,this._y=g,this._z=$,this._w=_e,this._onChangeCallback(),this}clone(){return new this.constructor(this._x,this._y,this._z,this._w)}copy(o){return this._x=o.x,this._y=o.y,this._z=o.z,this._w=o.w,this._onChangeCallback(),this}setFromEuler(o,g){const $=o._x,_e=o._y,rt=o._z,at=o._order,ct=Math.cos,ft=Math.sin,mt=ct($/2),bt=ct(_e/2),Tt=ct(rt/2),St=ft($/2),It=ft(_e/2),Rt=ft(rt/2);switch(at){case"XYZ":this._x=St*bt*Tt+mt*It*Rt,this._y=mt*It*Tt-St*bt*Rt,this._z=mt*bt*Rt+St*It*Tt,this._w=mt*bt*Tt-St*It*Rt;break;case"YXZ":this._x=St*bt*Tt+mt*It*Rt,this._y=mt*It*Tt-St*bt*Rt,this._z=mt*bt*Rt-St*It*Tt,this._w=mt*bt*Tt+St*It*Rt;break;case"ZXY":this._x=St*bt*Tt-mt*It*Rt,this._y=mt*It*Tt+St*bt*Rt,this._z=mt*bt*Rt+St*It*Tt,this._w=mt*bt*Tt-St*It*Rt;break;case"ZYX":this._x=St*bt*Tt-mt*It*Rt,this._y=mt*It*Tt+St*bt*Rt,this._z=mt*bt*Rt-St*It*Tt,this._w=mt*bt*Tt+St*It*Rt;break;case"YZX":this._x=St*bt*Tt+mt*It*Rt,this._y=mt*It*Tt+St*bt*Rt,this._z=mt*bt*Rt-St*It*Tt,this._w=mt*bt*Tt-St*It*Rt;break;case"XZY":this._x=St*bt*Tt-mt*It*Rt,this._y=mt*It*Tt-St*bt*Rt,this._z=mt*bt*Rt+St*It*Tt,this._w=mt*bt*Tt+St*It*Rt;break;default:console.warn("THREE.Quaternion: .setFromEuler() encountered an unknown order: "+at)}return g!==!1&&this._onChangeCallback(),this}setFromAxisAngle(o,g){const $=g/2,_e=Math.sin($);return this._x=o.x*_e,this._y=o.y*_e,this._z=o.z*_e,this._w=Math.cos($),this._onChangeCallback(),this}setFromRotationMatrix(o){const g=o.elements,$=g[0],_e=g[4],rt=g[8],at=g[1],ct=g[5],ft=g[9],mt=g[2],bt=g[6],Tt=g[10],St=$+ct+Tt;if(St>0){const It=.5/Math.sqrt(St+1);this._w=.25/It,this._x=(bt-ft)*It,this._y=(rt-mt)*It,this._z=(at-_e)*It}else if($>ct&&$>Tt){const It=2*Math.sqrt(1+$-ct-Tt);this._w=(bt-ft)/It,this._x=.25*It,this._y=(_e+at)/It,this._z=(rt+mt)/It}else if(ct>Tt){const It=2*Math.sqrt(1+ct-$-Tt);this._w=(rt-mt)/It,this._x=(_e+at)/It,this._y=.25*It,this._z=(ft+bt)/It}else{const It=2*Math.sqrt(1+Tt-$-ct);this._w=(at-_e)/It,this._x=(rt+mt)/It,this._y=(ft+bt)/It,this._z=.25*It}return this._onChangeCallback(),this}setFromUnitVectors(o,g){let $=o.dot(g)+1;return $<Number.EPSILON?($=0,Math.abs(o.x)>Math.abs(o.z)?(this._x=-o.y,this._y=o.x,this._z=0,this._w=$):(this._x=0,this._y=-o.z,this._z=o.y,this._w=$)):(this._x=o.y*g.z-o.z*g.y,this._y=o.z*g.x-o.x*g.z,this._z=o.x*g.y-o.y*g.x,this._w=$),this.normalize()}angleTo(o){return 2*Math.acos(Math.abs(As(this.dot(o),-1,1)))}rotateTowards(o,g){const $=this.angleTo(o);if($===0)return this;const _e=Math.min(1,g/$);return this.slerp(o,_e),this}identity(){return this.set(0,0,0,1)}invert(){return this.conjugate()}conjugate(){return this._x*=-1,this._y*=-1,this._z*=-1,this._onChangeCallback(),this}dot(o){return this._x*o._x+this._y*o._y+this._z*o._z+this._w*o._w}lengthSq(){return this._x*this._x+this._y*this._y+this._z*this._z+this._w*this._w}length(){return Math.sqrt(this._x*this._x+this._y*this._y+this._z*this._z+this._w*this._w)}normalize(){let o=this.length();return o===0?(this._x=0,this._y=0,this._z=0,this._w=1):(o=1/o,this._x=this._x*o,this._y=this._y*o,this._z=this._z*o,this._w=this._w*o),this._onChangeCallback(),this}multiply(o){return this.multiplyQuaternions(this,o)}premultiply(o){return this.multiplyQuaternions(o,this)}multiplyQuaternions(o,g){const $=o._x,_e=o._y,rt=o._z,at=o._w,ct=g._x,ft=g._y,mt=g._z,bt=g._w;return this._x=$*bt+at*ct+_e*mt-rt*ft,this._y=_e*bt+at*ft+rt*ct-$*mt,this._z=rt*bt+at*mt+$*ft-_e*ct,this._w=at*bt-$*ct-_e*ft-rt*mt,this._onChangeCallback(),this}slerp(o,g){if(g===0)return this;if(g===1)return this.copy(o);const $=this._x,_e=this._y,rt=this._z,at=this._w;let ct=at*o._w+$*o._x+_e*o._y+rt*o._z;if(ct<0?(this._w=-o._w,this._x=-o._x,this._y=-o._y,this._z=-o._z,ct=-ct):this.copy(o),ct>=1)return this._w=at,this._x=$,this._y=_e,this._z=rt,this;const ft=1-ct*ct;if(ft<=Number.EPSILON){const It=1-g;return this._w=It*at+g*this._w,this._x=It*$+g*this._x,this._y=It*_e+g*this._y,this._z=It*rt+g*this._z,this.normalize(),this._onChangeCallback(),this}const mt=Math.sqrt(ft),bt=Math.atan2(mt,ct),Tt=Math.sin((1-g)*bt)/mt,St=Math.sin(g*bt)/mt;return this._w=at*Tt+this._w*St,this._x=$*Tt+this._x*St,this._y=_e*Tt+this._y*St,this._z=rt*Tt+this._z*St,this._onChangeCallback(),this}slerpQuaternions(o,g,$){return this.copy(o).slerp(g,$)}random(){const o=Math.random(),g=Math.sqrt(1-o),$=Math.sqrt(o),_e=2*Math.PI*Math.random(),rt=2*Math.PI*Math.random();return this.set(g*Math.cos(_e),$*Math.sin(rt),$*Math.cos(rt),g*Math.sin(_e))}equals(o){return o._x===this._x&&o._y===this._y&&o._z===this._z&&o._w===this._w}fromArray(o,g=0){return this._x=o[g],this._y=o[g+1],this._z=o[g+2],this._w=o[g+3],this._onChangeCallback(),this}toArray(o=[],g=0){return o[g]=this._x,o[g+1]=this._y,o[g+2]=this._z,o[g+3]=this._w,o}fromBufferAttribute(o,g){return this._x=o.getX(g),this._y=o.getY(g),this._z=o.getZ(g),this._w=o.getW(g),this}_onChange(o){return this._onChangeCallback=o,this}_onChangeCallback(){}*[Symbol.iterator](){yield this._x,yield this._y,yield this._z,yield this._w}}class fn{constructor(o=0,g=0,$=0){fn.prototype.isVector3=!0,this.x=o,this.y=g,this.z=$}set(o,g,$){return $===void 0&&($=this.z),this.x=o,this.y=g,this.z=$,this}setScalar(o){return this.x=o,this.y=o,this.z=o,this}setX(o){return this.x=o,this}setY(o){return this.y=o,this}setZ(o){return this.z=o,this}setComponent(o,g){switch(o){case 0:this.x=g;break;case 1:this.y=g;break;case 2:this.z=g;break;default:throw new Error("index is out of range: "+o)}return this}getComponent(o){switch(o){case 0:return this.x;case 1:return this.y;case 2:return this.z;default:throw new Error("index is out of range: "+o)}}clone(){return new this.constructor(this.x,this.y,this.z)}copy(o){return this.x=o.x,this.y=o.y,this.z=o.z,this}add(o){return this.x+=o.x,this.y+=o.y,this.z+=o.z,this}addScalar(o){return this.x+=o,this.y+=o,this.z+=o,this}addVectors(o,g){return this.x=o.x+g.x,this.y=o.y+g.y,this.z=o.z+g.z,this}addScaledVector(o,g){return this.x+=o.x*g,this.y+=o.y*g,this.z+=o.z*g,this}sub(o){return this.x-=o.x,this.y-=o.y,this.z-=o.z,this}subScalar(o){return this.x-=o,this.y-=o,this.z-=o,this}subVectors(o,g){return this.x=o.x-g.x,this.y=o.y-g.y,this.z=o.z-g.z,this}multiply(o){return this.x*=o.x,this.y*=o.y,this.z*=o.z,this}multiplyScalar(o){return this.x*=o,this.y*=o,this.z*=o,this}multiplyVectors(o,g){return this.x=o.x*g.x,this.y=o.y*g.y,this.z=o.z*g.z,this}applyEuler(o){return this.applyQuaternion(dA.setFromEuler(o))}applyAxisAngle(o,g){return this.applyQuaternion(dA.setFromAxisAngle(o,g))}applyMatrix3(o){const g=this.x,$=this.y,_e=this.z,rt=o.elements;return this.x=rt[0]*g+rt[3]*$+rt[6]*_e,this.y=rt[1]*g+rt[4]*$+rt[7]*_e,this.z=rt[2]*g+rt[5]*$+rt[8]*_e,this}applyNormalMatrix(o){return this.applyMatrix3(o).normalize()}applyMatrix4(o){const g=this.x,$=this.y,_e=this.z,rt=o.elements,at=1/(rt[3]*g+rt[7]*$+rt[11]*_e+rt[15]);return this.x=(rt[0]*g+rt[4]*$+rt[8]*_e+rt[12])*at,this.y=(rt[1]*g+rt[5]*$+rt[9]*_e+rt[13])*at,this.z=(rt[2]*g+rt[6]*$+rt[10]*_e+rt[14])*at,this}applyQuaternion(o){const g=this.x,$=this.y,_e=this.z,rt=o.x,at=o.y,ct=o.z,ft=o.w,mt=ft*g+at*_e-ct*$,bt=ft*$+ct*g-rt*_e,Tt=ft*_e+rt*$-at*g,St=-rt*g-at*$-ct*_e;return this.x=mt*ft+St*-rt+bt*-ct-Tt*-at,this.y=bt*ft+St*-at+Tt*-rt-mt*-ct,this.z=Tt*ft+St*-ct+mt*-at-bt*-rt,this}project(o){return this.applyMatrix4(o.matrixWorldInverse).applyMatrix4(o.projectionMatrix)}unproject(o){return this.applyMatrix4(o.projectionMatrixInverse).applyMatrix4(o.matrixWorld)}transformDirection(o){const g=this.x,$=this.y,_e=this.z,rt=o.elements;return this.x=rt[0]*g+rt[4]*$+rt[8]*_e,this.y=rt[1]*g+rt[5]*$+rt[9]*_e,this.z=rt[2]*g+rt[6]*$+rt[10]*_e,this.normalize()}divide(o){return this.x/=o.x,this.y/=o.y,this.z/=o.z,this}divideScalar(o){return this.multiplyScalar(1/o)}min(o){return this.x=Math.min(this.x,o.x),this.y=Math.min(this.y,o.y),this.z=Math.min(this.z,o.z),this}max(o){return this.x=Math.max(this.x,o.x),this.y=Math.max(this.y,o.y),this.z=Math.max(this.z,o.z),this}clamp(o,g){return this.x=Math.max(o.x,Math.min(g.x,this.x)),this.y=Math.max(o.y,Math.min(g.y,this.y)),this.z=Math.max(o.z,Math.min(g.z,this.z)),this}clampScalar(o,g){return this.x=Math.max(o,Math.min(g,this.x)),this.y=Math.max(o,Math.min(g,this.y)),this.z=Math.max(o,Math.min(g,this.z)),this}clampLength(o,g){const $=this.length();return this.divideScalar($||1).multiplyScalar(Math.max(o,Math.min(g,$)))}floor(){return this.x=Math.floor(this.x),this.y=Math.floor(this.y),this.z=Math.floor(this.z),this}ceil(){return this.x=Math.ceil(this.x),this.y=Math.ceil(this.y),this.z=Math.ceil(this.z),this}round(){return this.x=Math.round(this.x),this.y=Math.round(this.y),this.z=Math.round(this.z),this}roundToZero(){return this.x=this.x<0?Math.ceil(this.x):Math.floor(this.x),this.y=this.y<0?Math.ceil(this.y):Math.floor(this.y),this.z=this.z<0?Math.ceil(this.z):Math.floor(this.z),this}negate(){return this.x=-this.x,this.y=-this.y,this.z=-this.z,this}dot(o){return this.x*o.x+this.y*o.y+this.z*o.z}lengthSq(){return this.x*this.x+this.y*this.y+this.z*this.z}length(){return Math.sqrt(this.x*this.x+this.y*this.y+this.z*this.z)}manhattanLength(){return Math.abs(this.x)+Math.abs(this.y)+Math.abs(this.z)}normalize(){return this.divideScalar(this.length()||1)}setLength(o){return this.normalize().multiplyScalar(o)}lerp(o,g){return this.x+=(o.x-this.x)*g,this.y+=(o.y-this.y)*g,this.z+=(o.z-this.z)*g,this}lerpVectors(o,g,$){return this.x=o.x+(g.x-o.x)*$,this.y=o.y+(g.y-o.y)*$,this.z=o.z+(g.z-o.z)*$,this}cross(o){return this.crossVectors(this,o)}crossVectors(o,g){const $=o.x,_e=o.y,rt=o.z,at=g.x,ct=g.y,ft=g.z;return this.x=_e*ft-rt*ct,this.y=rt*at-$*ft,this.z=$*ct-_e*at,this}projectOnVector(o){const g=o.lengthSq();if(g===0)return this.set(0,0,0);const $=o.dot(this)/g;return this.copy(o).multiplyScalar($)}projectOnPlane(o){return Ty.copy(this).projectOnVector(o),this.sub(Ty)}reflect(o){return this.sub(Ty.copy(o).multiplyScalar(2*this.dot(o)))}angleTo(o){const g=Math.sqrt(this.lengthSq()*o.lengthSq());if(g===0)return Math.PI/2;const $=this.dot(o)/g;return Math.acos(As($,-1,1))}distanceTo(o){return Math.sqrt(this.distanceToSquared(o))}distanceToSquared(o){const g=this.x-o.x,$=this.y-o.y,_e=this.z-o.z;return g*g+$*$+_e*_e}manhattanDistanceTo(o){return Math.abs(this.x-o.x)+Math.abs(this.y-o.y)+Math.abs(this.z-o.z)}setFromSpherical(o){return this.setFromSphericalCoords(o.radius,o.phi,o.theta)}setFromSphericalCoords(o,g,$){const _e=Math.sin(g)*o;return this.x=_e*Math.sin($),this.y=Math.cos(g)*o,this.z=_e*Math.cos($),this}setFromCylindrical(o){return this.setFromCylindricalCoords(o.radius,o.theta,o.y)}setFromCylindricalCoords(o,g,$){return this.x=o*Math.sin(g),this.y=$,this.z=o*Math.cos(g),this}setFromMatrixPosition(o){const g=o.elements;return this.x=g[12],this.y=g[13],this.z=g[14],this}setFromMatrixScale(o){const g=this.setFromMatrixColumn(o,0).length(),$=this.setFromMatrixColumn(o,1).length(),_e=this.setFromMatrixColumn(o,2).length();return this.x=g,this.y=$,this.z=_e,this}setFromMatrixColumn(o,g){return this.fromArray(o.elements,4*g)}setFromMatrix3Column(o,g){return this.fromArray(o.elements,3*g)}setFromEuler(o){return this.x=o._x,this.y=o._y,this.z=o._z,this}equals(o){return o.x===this.x&&o.y===this.y&&o.z===this.z}fromArray(o,g=0){return this.x=o[g],this.y=o[g+1],this.z=o[g+2],this}toArray(o=[],g=0){return o[g]=this.x,o[g+1]=this.y,o[g+2]=this.z,o}fromBufferAttribute(o,g){return this.x=o.getX(g),this.y=o.getY(g),this.z=o.getZ(g),this}random(){return this.x=Math.random(),this.y=Math.random(),this.z=Math.random(),this}randomDirection(){const o=2*(Math.random()-.5),g=Math.random()*Math.PI*2,$=Math.sqrt(1-o**2);return this.x=$*Math.cos(g),this.y=$*Math.sin(g),this.z=o,this}*[Symbol.iterator](){yield this.x,yield this.y,yield this.z}}const Ty=new fn,dA=new iu;class Xl{constructor(o=new fn(1/0,1/0,1/0),g=new fn(-1/0,-1/0,-1/0)){this.isBox3=!0,this.min=o,this.max=g}set(o,g){return this.min.copy(o),this.max.copy(g),this}setFromArray(o){let g=1/0,$=1/0,_e=1/0,rt=-1/0,at=-1/0,ct=-1/0;for(let ft=0,mt=o.length;ft<mt;ft+=3){const bt=o[ft],Tt=o[ft+1],St=o[ft+2];bt<g&&(g=bt),Tt<$&&($=Tt),St<_e&&(_e=St),bt>rt&&(rt=bt),Tt>at&&(at=Tt),St>ct&&(ct=St)}return this.min.set(g,$,_e),this.max.set(rt,at,ct),this}setFromBufferAttribute(o){let g=1/0,$=1/0,_e=1/0,rt=-1/0,at=-1/0,ct=-1/0;for(let ft=0,mt=o.count;ft<mt;ft++){const bt=o.getX(ft),Tt=o.getY(ft),St=o.getZ(ft);bt<g&&(g=bt),Tt<$&&($=Tt),St<_e&&(_e=St),bt>rt&&(rt=bt),Tt>at&&(at=Tt),St>ct&&(ct=St)}return this.min.set(g,$,_e),this.max.set(rt,at,ct),this}setFromPoints(o){this.makeEmpty();for(let g=0,$=o.length;g<$;g++)this.expandByPoint(o[g]);return this}setFromCenterAndSize(o,g){const $=lp.copy(g).multiplyScalar(.5);return this.min.copy(o).sub($),this.max.copy(o).add($),this}setFromObject(o,g=!1){return this.makeEmpty(),this.expandByObject(o,g)}clone(){return new this.constructor().copy(this)}copy(o){return this.min.copy(o.min),this.max.copy(o.max),this}makeEmpty(){return this.min.x=this.min.y=this.min.z=1/0,this.max.x=this.max.y=this.max.z=-1/0,this}isEmpty(){return this.max.x<this.min.x||this.max.y<this.min.y||this.max.z<this.min.z}getCenter(o){return this.isEmpty()?o.set(0,0,0):o.addVectors(this.min,this.max).multiplyScalar(.5)}getSize(o){return this.isEmpty()?o.set(0,0,0):o.subVectors(this.max,this.min)}expandByPoint(o){return this.min.min(o),this.max.max(o),this}expandByVector(o){return this.min.sub(o),this.max.add(o),this}expandByScalar(o){return this.min.addScalar(-o),this.max.addScalar(o),this}expandByObject(o,g=!1){o.updateWorldMatrix(!1,!1);const $=o.geometry;if($!==void 0)if(g&&$.attributes!=null&&$.attributes.position!==void 0){const rt=$.attributes.position;for(let at=0,ct=rt.count;at<ct;at++)lp.fromBufferAttribute(rt,at).applyMatrix4(o.matrixWorld),this.expandByPoint(lp)}else $.boundingBox===null&&$.computeBoundingBox(),Fm.copy($.boundingBox),Fm.applyMatrix4(o.matrixWorld),this.union(Fm);const _e=o.children;for(let rt=0,at=_e.length;rt<at;rt++)this.expandByObject(_e[rt],g);return this}containsPoint(o){return!(o.x<this.min.x||o.x>this.max.x||o.y<this.min.y||o.y>this.max.y||o.z<this.min.z||o.z>this.max.z)}containsBox(o){return this.min.x<=o.min.x&&o.max.x<=this.max.x&&this.min.y<=o.min.y&&o.max.y<=this.max.y&&this.min.z<=o.min.z&&o.max.z<=this.max.z}getParameter(o,g){return g.set((o.x-this.min.x)/(this.max.x-this.min.x),(o.y-this.min.y)/(this.max.y-this.min.y),(o.z-this.min.z)/(this.max.z-this.min.z))}intersectsBox(o){return!(o.max.x<this.min.x||o.min.x>this.max.x||o.max.y<this.min.y||o.min.y>this.max.y||o.max.z<this.min.z||o.min.z>this.max.z)}intersectsSphere(o){return this.clampPoint(o.center,lp),lp.distanceToSquared(o.center)<=o.radius*o.radius}intersectsPlane(o){let g,$;return o.normal.x>0?(g=o.normal.x*this.min.x,$=o.normal.x*this.max.x):(g=o.normal.x*this.max.x,$=o.normal.x*this.min.x),o.normal.y>0?(g+=o.normal.y*this.min.y,$+=o.normal.y*this.max.y):(g+=o.normal.y*this.max.y,$+=o.normal.y*this.min.y),o.normal.z>0?(g+=o.normal.z*this.min.z,$+=o.normal.z*this.max.z):(g+=o.normal.z*this.max.z,$+=o.normal.z*this.min.z),g<=-o.constant&&$>=-o.constant}intersectsTriangle(o){if(this.isEmpty())return!1;this.getCenter(Rv),g0.subVectors(this.max,Rv),Kl.subVectors(o.a,Rv),p_.subVectors(o.b,Rv),f_.subVectors(o.c,Rv),Pv.subVectors(p_,Kl),jm.subVectors(f_,p_),ru.subVectors(Kl,f_);let g=[0,-Pv.z,Pv.y,0,-jm.z,jm.y,0,-ru.z,ru.y,Pv.z,0,-Pv.x,jm.z,0,-jm.x,ru.z,0,-ru.x,-Pv.y,Pv.x,0,-jm.y,jm.x,0,-ru.y,ru.x,0];return!!Qw(g,Kl,p_,f_,g0)&&(g=[1,0,0,0,1,0,0,0,1],!!Qw(g,Kl,p_,f_,g0)&&(zm.crossVectors(Pv,jm),g=[zm.x,zm.y,zm.z],Qw(g,Kl,p_,f_,g0)))}clampPoint(o,g){return g.copy(o).clamp(this.min,this.max)}distanceToPoint(o){return lp.copy(o).clamp(this.min,this.max).sub(o).length()}getBoundingSphere(o){return this.getCenter(o.center),o.radius=.5*this.getSize(lp).length(),o}intersect(o){return this.min.max(o.min),this.max.min(o.max),this.isEmpty()&&this.makeEmpty(),this}union(o){return this.min.min(o.min),this.max.max(o.max),this}applyMatrix4(o){return this.isEmpty()||(fm[0].set(this.min.x,this.min.y,this.min.z).applyMatrix4(o),fm[1].set(this.min.x,this.min.y,this.max.z).applyMatrix4(o),fm[2].set(this.min.x,this.max.y,this.min.z).applyMatrix4(o),fm[3].set(this.min.x,this.max.y,this.max.z).applyMatrix4(o),fm[4].set(this.max.x,this.min.y,this.min.z).applyMatrix4(o),fm[5].set(this.max.x,this.min.y,this.max.z).applyMatrix4(o),fm[6].set(this.max.x,this.max.y,this.min.z).applyMatrix4(o),fm[7].set(this.max.x,this.max.y,this.max.z).applyMatrix4(o),this.setFromPoints(fm)),this}translate(o){return this.min.add(o),this.max.add(o),this}equals(o){return o.min.equals(this.min)&&o.max.equals(this.max)}}const fm=[new fn,new fn,new fn,new fn,new fn,new fn,new fn,new fn],lp=new fn,Fm=new Xl,Kl=new fn,p_=new fn,f_=new fn,Pv=new fn,jm=new fn,ru=new fn,Rv=new fn,g0=new fn,zm=new fn,v0=new fn;function Qw(dt,o,g,$,_e){for(let rt=0,at=dt.length-3;rt<=at;rt+=3){v0.fromArray(dt,rt);const ct=_e.x*Math.abs(v0.x)+_e.y*Math.abs(v0.y)+_e.z*Math.abs(v0.z),ft=o.dot(v0),mt=g.dot(v0),bt=$.dot(v0);if(Math.max(-Math.max(ft,mt,bt),Math.min(ft,mt,bt))>ct)return!1}return!0}const LS=new Xl,Vm=new fn,m_=new fn,Qm=new fn;class Bv{constructor(o=new fn,g=-1){this.center=o,this.radius=g}set(o,g){return this.center.copy(o),this.radius=g,this}setFromPoints(o,g){const $=this.center;g!==void 0?$.copy(g):LS.setFromPoints(o).getCenter($);let _e=0;for(let rt=0,at=o.length;rt<at;rt++)_e=Math.max(_e,$.distanceToSquared(o[rt]));return this.radius=Math.sqrt(_e),this}copy(o){return this.center.copy(o.center),this.radius=o.radius,this}isEmpty(){return this.radius<0}makeEmpty(){return this.center.set(0,0,0),this.radius=-1,this}containsPoint(o){return o.distanceToSquared(this.center)<=this.radius*this.radius}distanceToPoint(o){return o.distanceTo(this.center)-this.radius}intersectsSphere(o){const g=this.radius+o.radius;return o.center.distanceToSquared(this.center)<=g*g}intersectsBox(o){return o.intersectsSphere(this)}intersectsPlane(o){return Math.abs(o.distanceToPoint(this.center))<=this.radius}clampPoint(o,g){const $=this.center.distanceToSquared(o);return g.copy(o),$>this.radius*this.radius&&(g.sub(this.center).normalize(),g.multiplyScalar(this.radius).add(this.center)),g}getBoundingBox(o){return this.isEmpty()?(o.makeEmpty(),o):(o.set(this.center,this.center),o.expandByScalar(this.radius),o)}applyMatrix4(o){return this.center.applyMatrix4(o),this.radius=this.radius*o.getMaxScaleOnAxis(),this}translate(o){return this.center.add(o),this}expandByPoint(o){Qm.subVectors(o,this.center);const g=Qm.lengthSq();if(g>this.radius*this.radius){const $=Math.sqrt(g),_e=.5*($-this.radius);this.center.add(Qm.multiplyScalar(_e/$)),this.radius+=_e}return this}union(o){return this.center.equals(o.center)===!0?m_.set(0,0,1).multiplyScalar(o.radius):m_.subVectors(o.center,this.center).normalize().multiplyScalar(o.radius),this.expandByPoint(Vm.copy(o.center).add(m_)),this.expandByPoint(Vm.copy(o.center).sub(m_)),this}equals(o){return o.center.equals(this.center)&&o.radius===this.radius}clone(){return new this.constructor().copy(this)}}const Ss=new fn,Ol=new fn,Cp=new fn,cp=new fn,kv=new fn,Ov=new fn,Iy=new fn;class _0{constructor(o=new fn,g=new fn(0,0,-1)){this.origin=o,this.direction=g}set(o,g){return this.origin.copy(o),this.direction.copy(g),this}copy(o){return this.origin.copy(o.origin),this.direction.copy(o.direction),this}at(o,g){return g.copy(this.direction).multiplyScalar(o).add(this.origin)}lookAt(o){return this.direction.copy(o).sub(this.origin).normalize(),this}recast(o){return this.origin.copy(this.at(o,Ss)),this}closestPointToPoint(o,g){g.subVectors(o,this.origin);const $=g.dot(this.direction);return $<0?g.copy(this.origin):g.copy(this.direction).multiplyScalar($).add(this.origin)}distanceToPoint(o){return Math.sqrt(this.distanceSqToPoint(o))}distanceSqToPoint(o){const g=Ss.subVectors(o,this.origin).dot(this.direction);return g<0?this.origin.distanceToSquared(o):(Ss.copy(this.direction).multiplyScalar(g).add(this.origin),Ss.distanceToSquared(o))}distanceSqToSegment(o,g,$,_e){Ol.copy(o).add(g).multiplyScalar(.5),Cp.copy(g).sub(o).normalize(),cp.copy(this.origin).sub(Ol);const rt=.5*o.distanceTo(g),at=-this.direction.dot(Cp),ct=cp.dot(this.direction),ft=-cp.dot(Cp),mt=cp.lengthSq(),bt=Math.abs(1-at*at);let Tt,St,It,Rt;if(bt>0)if(Tt=at*ft-ct,St=at*ct-ft,Rt=rt*bt,Tt>=0)if(St>=-Rt)if(St<=Rt){const Dt=1/bt;Tt*=Dt,St*=Dt,It=Tt*(Tt+at*St+2*ct)+St*(at*Tt+St+2*ft)+mt}else St=rt,Tt=Math.max(0,-(at*St+ct)),It=-Tt*Tt+St*(St+2*ft)+mt;else St=-rt,Tt=Math.max(0,-(at*St+ct)),It=-Tt*Tt+St*(St+2*ft)+mt;else St<=-Rt?(Tt=Math.max(0,-(-at*rt+ct)),St=Tt>0?-rt:Math.min(Math.max(-rt,-ft),rt),It=-Tt*Tt+St*(St+2*ft)+mt):St<=Rt?(Tt=0,St=Math.min(Math.max(-rt,-ft),rt),It=St*(St+2*ft)+mt):(Tt=Math.max(0,-(at*rt+ct)),St=Tt>0?rt:Math.min(Math.max(-rt,-ft),rt),It=-Tt*Tt+St*(St+2*ft)+mt);else St=at>0?-rt:rt,Tt=Math.max(0,-(at*St+ct)),It=-Tt*Tt+St*(St+2*ft)+mt;return $&&$.copy(this.direction).multiplyScalar(Tt).add(this.origin),_e&&_e.copy(Cp).multiplyScalar(St).add(Ol),It}intersectSphere(o,g){Ss.subVectors(o.center,this.origin);const $=Ss.dot(this.direction),_e=Ss.dot(Ss)-$*$,rt=o.radius*o.radius;if(_e>rt)return null;const at=Math.sqrt(rt-_e),ct=$-at,ft=$+at;return ct<0&&ft<0?null:ct<0?this.at(ft,g):this.at(ct,g)}intersectsSphere(o){return this.distanceSqToPoint(o.center)<=o.radius*o.radius}distanceToPlane(o){const g=o.normal.dot(this.direction);if(g===0)return o.distanceToPoint(this.origin)===0?0:null;const $=-(this.origin.dot(o.normal)+o.constant)/g;return $>=0?$:null}intersectPlane(o,g){const $=this.distanceToPlane(o);return $===null?null:this.at($,g)}intersectsPlane(o){const g=o.distanceToPoint(this.origin);return g===0||o.normal.dot(this.direction)*g<0}intersectBox(o,g){let $,_e,rt,at,ct,ft;const mt=1/this.direction.x,bt=1/this.direction.y,Tt=1/this.direction.z,St=this.origin;return mt>=0?($=(o.min.x-St.x)*mt,_e=(o.max.x-St.x)*mt):($=(o.max.x-St.x)*mt,_e=(o.min.x-St.x)*mt),bt>=0?(rt=(o.min.y-St.y)*bt,at=(o.max.y-St.y)*bt):(rt=(o.max.y-St.y)*bt,at=(o.min.y-St.y)*bt),$>at||rt>_e?null:((rt>$||$!=$)&&($=rt),(at<_e||_e!=_e)&&(_e=at),Tt>=0?(ct=(o.min.z-St.z)*Tt,ft=(o.max.z-St.z)*Tt):(ct=(o.max.z-St.z)*Tt,ft=(o.min.z-St.z)*Tt),$>ft||ct>_e?null:((ct>$||$!=$)&&($=ct),(ft<_e||_e!=_e)&&(_e=ft),_e<0?null:this.at($>=0?$:_e,g)))}intersectsBox(o){return this.intersectBox(o,Ss)!==null}intersectTriangle(o,g,$,_e,rt){kv.subVectors(g,o),Ov.subVectors($,o),Iy.crossVectors(kv,Ov);let at,ct=this.direction.dot(Iy);if(ct>0){if(_e)return null;at=1}else{if(!(ct<0))return null;at=-1,ct=-ct}cp.subVectors(this.origin,o);const ft=at*this.direction.dot(Ov.crossVectors(cp,Ov));if(ft<0)return null;const mt=at*this.direction.dot(kv.cross(cp));if(mt<0||ft+mt>ct)return null;const bt=-at*cp.dot(Iy);return bt<0?null:this.at(bt/ct,rt)}applyMatrix4(o){return this.origin.applyMatrix4(o),this.direction.transformDirection(o),this}equals(o){return o.origin.equals(this.origin)&&o.direction.equals(this.direction)}clone(){return new this.constructor().copy(this)}}class Os{constructor(){Os.prototype.isMatrix4=!0,this.elements=[1,0,0,0,0,1,0,0,0,0,1,0,0,0,0,1]}set(o,g,$,_e,rt,at,ct,ft,mt,bt,Tt,St,It,Rt,Dt,Ft){const Nt=this.elements;return Nt[0]=o,Nt[4]=g,Nt[8]=$,Nt[12]=_e,Nt[1]=rt,Nt[5]=at,Nt[9]=ct,Nt[13]=ft,Nt[2]=mt,Nt[6]=bt,Nt[10]=Tt,Nt[14]=St,Nt[3]=It,Nt[7]=Rt,Nt[11]=Dt,Nt[15]=Ft,this}identity(){return this.set(1,0,0,0,0,1,0,0,0,0,1,0,0,0,0,1),this}clone(){return new Os().fromArray(this.elements)}copy(o){const g=this.elements,$=o.elements;return g[0]=$[0],g[1]=$[1],g[2]=$[2],g[3]=$[3],g[4]=$[4],g[5]=$[5],g[6]=$[6],g[7]=$[7],g[8]=$[8],g[9]=$[9],g[10]=$[10],g[11]=$[11],g[12]=$[12],g[13]=$[13],g[14]=$[14],g[15]=$[15],this}copyPosition(o){const g=this.elements,$=o.elements;return g[12]=$[12],g[13]=$[13],g[14]=$[14],this}setFromMatrix3(o){const g=o.elements;return this.set(g[0],g[3],g[6],0,g[1],g[4],g[7],0,g[2],g[5],g[8],0,0,0,0,1),this}extractBasis(o,g,$){return o.setFromMatrixColumn(this,0),g.setFromMatrixColumn(this,1),$.setFromMatrixColumn(this,2),this}makeBasis(o,g,$){return this.set(o.x,g.x,$.x,0,o.y,g.y,$.y,0,o.z,g.z,$.z,0,0,0,0,1),this}extractRotation(o){const g=this.elements,$=o.elements,_e=1/Gm.setFromMatrixColumn(o,0).length(),rt=1/Gm.setFromMatrixColumn(o,1).length(),at=1/Gm.setFromMatrixColumn(o,2).length();return g[0]=$[0]*_e,g[1]=$[1]*_e,g[2]=$[2]*_e,g[3]=0,g[4]=$[4]*rt,g[5]=$[5]*rt,g[6]=$[6]*rt,g[7]=0,g[8]=$[8]*at,g[9]=$[9]*at,g[10]=$[10]*at,g[11]=0,g[12]=0,g[13]=0,g[14]=0,g[15]=1,this}makeRotationFromEuler(o){const g=this.elements,$=o.x,_e=o.y,rt=o.z,at=Math.cos($),ct=Math.sin($),ft=Math.cos(_e),mt=Math.sin(_e),bt=Math.cos(rt),Tt=Math.sin(rt);if(o.order==="XYZ"){const St=at*bt,It=at*Tt,Rt=ct*bt,Dt=ct*Tt;g[0]=ft*bt,g[4]=-ft*Tt,g[8]=mt,g[1]=It+Rt*mt,g[5]=St-Dt*mt,g[9]=-ct*ft,g[2]=Dt-St*mt,g[6]=Rt+It*mt,g[10]=at*ft}else if(o.order==="YXZ"){const St=ft*bt,It=ft*Tt,Rt=mt*bt,Dt=mt*Tt;g[0]=St+Dt*ct,g[4]=Rt*ct-It,g[8]=at*mt,g[1]=at*Tt,g[5]=at*bt,g[9]=-ct,g[2]=It*ct-Rt,g[6]=Dt+St*ct,g[10]=at*ft}else if(o.order==="ZXY"){const St=ft*bt,It=ft*Tt,Rt=mt*bt,Dt=mt*Tt;g[0]=St-Dt*ct,g[4]=-at*Tt,g[8]=Rt+It*ct,g[1]=It+Rt*ct,g[5]=at*bt,g[9]=Dt-St*ct,g[2]=-at*mt,g[6]=ct,g[10]=at*ft}else if(o.order==="ZYX"){const St=at*bt,It=at*Tt,Rt=ct*bt,Dt=ct*Tt;g[0]=ft*bt,g[4]=Rt*mt-It,g[8]=St*mt+Dt,g[1]=ft*Tt,g[5]=Dt*mt+St,g[9]=It*mt-Rt,g[2]=-mt,g[6]=ct*ft,g[10]=at*ft}else if(o.order==="YZX"){const St=at*ft,It=at*mt,Rt=ct*ft,Dt=ct*mt;g[0]=ft*bt,g[4]=Dt-St*Tt,g[8]=Rt*Tt+It,g[1]=Tt,g[5]=at*bt,g[9]=-ct*bt,g[2]=-mt*bt,g[6]=It*Tt+Rt,g[10]=St-Dt*Tt}else if(o.order==="XZY"){const St=at*ft,It=at*mt,Rt=ct*ft,Dt=ct*mt;g[0]=ft*bt,g[4]=-Tt,g[8]=mt*bt,g[1]=St*Tt+Dt,g[5]=at*bt,g[9]=It*Tt-Rt,g[2]=Rt*Tt-It,g[6]=ct*bt,g[10]=Dt*Tt+St}return g[3]=0,g[7]=0,g[11]=0,g[12]=0,g[13]=0,g[14]=0,g[15]=1,this}makeRotationFromQuaternion(o){return this.compose(M1,o,Gw)}lookAt(o,g,$){const _e=this.elements;return Ul.subVectors(o,g),Ul.lengthSq()===0&&(Ul.z=1),Ul.normalize(),su.crossVectors($,Ul),su.lengthSq()===0&&(Math.abs($.z)===1?Ul.x+=1e-4:Ul.z+=1e-4,Ul.normalize(),su.crossVectors($,Ul)),su.normalize(),Co.crossVectors(Ul,su),_e[0]=su.x,_e[4]=Co.x,_e[8]=Ul.x,_e[1]=su.y,_e[5]=Co.y,_e[9]=Ul.y,_e[2]=su.z,_e[6]=Co.z,_e[10]=Ul.z,this}multiply(o){return this.multiplyMatrices(this,o)}premultiply(o){return this.multiplyMatrices(o,this)}multiplyMatrices(o,g){const $=o.elements,_e=g.elements,rt=this.elements,at=$[0],ct=$[4],ft=$[8],mt=$[12],bt=$[1],Tt=$[5],St=$[9],It=$[13],Rt=$[2],Dt=$[6],Ft=$[10],Nt=$[14],zt=$[3],Xt=$[7],tn=$[11],sn=$[15],ln=_e[0],kn=_e[4],Ln=_e[8],qn=_e[12],Kn=_e[1],On=_e[5],_r=_e[9],Tr=_e[13],gr=_e[2],Or=_e[6],Gr=_e[10],cr=_e[14],ur=_e[3],Fr=_e[7],Ar=_e[11],Qr=_e[15];return rt[0]=at*ln+ct*Kn+ft*gr+mt*ur,rt[4]=at*kn+ct*On+ft*Or+mt*Fr,rt[8]=at*Ln+ct*_r+ft*Gr+mt*Ar,rt[12]=at*qn+ct*Tr+ft*cr+mt*Qr,rt[1]=bt*ln+Tt*Kn+St*gr+It*ur,rt[5]=bt*kn+Tt*On+St*Or+It*Fr,rt[9]=bt*Ln+Tt*_r+St*Gr+It*Ar,rt[13]=bt*qn+Tt*Tr+St*cr+It*Qr,rt[2]=Rt*ln+Dt*Kn+Ft*gr+Nt*ur,rt[6]=Rt*kn+Dt*On+Ft*Or+Nt*Fr,rt[10]=Rt*Ln+Dt*_r+Ft*Gr+Nt*Ar,rt[14]=Rt*qn+Dt*Tr+Ft*cr+Nt*Qr,rt[3]=zt*ln+Xt*Kn+tn*gr+sn*ur,rt[7]=zt*kn+Xt*On+tn*Or+sn*Fr,rt[11]=zt*Ln+Xt*_r+tn*Gr+sn*Ar,rt[15]=zt*qn+Xt*Tr+tn*cr+sn*Qr,this}multiplyScalar(o){const g=this.elements;return g[0]*=o,g[4]*=o,g[8]*=o,g[12]*=o,g[1]*=o,g[5]*=o,g[9]*=o,g[13]*=o,g[2]*=o,g[6]*=o,g[10]*=o,g[14]*=o,g[3]*=o,g[7]*=o,g[11]*=o,g[15]*=o,this}determinant(){const o=this.elements,g=o[0],$=o[4],_e=o[8],rt=o[12],at=o[1],ct=o[5],ft=o[9],mt=o[13],bt=o[2],Tt=o[6],St=o[10],It=o[14];return o[3]*(+rt*ft*Tt-_e*mt*Tt-rt*ct*St+$*mt*St+_e*ct*It-$*ft*It)+o[7]*(+g*ft*It-g*mt*St+rt*at*St-_e*at*It+_e*mt*bt-rt*ft*bt)+o[11]*(+g*mt*Tt-g*ct*It-rt*at*Tt+$*at*It+rt*ct*bt-$*mt*bt)+o[15]*(-_e*ct*bt-g*ft*Tt+g*ct*St+_e*at*Tt-$*at*St+$*ft*bt)}transpose(){const o=this.elements;let g;return g=o[1],o[1]=o[4],o[4]=g,g=o[2],o[2]=o[8],o[8]=g,g=o[6],o[6]=o[9],o[9]=g,g=o[3],o[3]=o[12],o[12]=g,g=o[7],o[7]=o[13],o[13]=g,g=o[11],o[11]=o[14],o[14]=g,this}setPosition(o,g,$){const _e=this.elements;return o.isVector3?(_e[12]=o.x,_e[13]=o.y,_e[14]=o.z):(_e[12]=o,_e[13]=g,_e[14]=$),this}invert(){const o=this.elements,g=o[0],$=o[1],_e=o[2],rt=o[3],at=o[4],ct=o[5],ft=o[6],mt=o[7],bt=o[8],Tt=o[9],St=o[10],It=o[11],Rt=o[12],Dt=o[13],Ft=o[14],Nt=o[15],zt=Tt*Ft*mt-Dt*St*mt+Dt*ft*It-ct*Ft*It-Tt*ft*Nt+ct*St*Nt,Xt=Rt*St*mt-bt*Ft*mt-Rt*ft*It+at*Ft*It+bt*ft*Nt-at*St*Nt,tn=bt*Dt*mt-Rt*Tt*mt+Rt*ct*It-at*Dt*It-bt*ct*Nt+at*Tt*Nt,sn=Rt*Tt*ft-bt*Dt*ft-Rt*ct*St+at*Dt*St+bt*ct*Ft-at*Tt*Ft,ln=g*zt+$*Xt+_e*tn+rt*sn;if(ln===0)return this.set(0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0);const kn=1/ln;return o[0]=zt*kn,o[1]=(Dt*St*rt-Tt*Ft*rt-Dt*_e*It+$*Ft*It+Tt*_e*Nt-$*St*Nt)*kn,o[2]=(ct*Ft*rt-Dt*ft*rt+Dt*_e*mt-$*Ft*mt-ct*_e*Nt+$*ft*Nt)*kn,o[3]=(Tt*ft*rt-ct*St*rt-Tt*_e*mt+$*St*mt+ct*_e*It-$*ft*It)*kn,o[4]=Xt*kn,o[5]=(bt*Ft*rt-Rt*St*rt+Rt*_e*It-g*Ft*It-bt*_e*Nt+g*St*Nt)*kn,o[6]=(Rt*ft*rt-at*Ft*rt-Rt*_e*mt+g*Ft*mt+at*_e*Nt-g*ft*Nt)*kn,o[7]=(at*St*rt-bt*ft*rt+bt*_e*mt-g*St*mt-at*_e*It+g*ft*It)*kn,o[8]=tn*kn,o[9]=(Rt*Tt*rt-bt*Dt*rt-Rt*$*It+g*Dt*It+bt*$*Nt-g*Tt*Nt)*kn,o[10]=(at*Dt*rt-Rt*ct*rt+Rt*$*mt-g*Dt*mt-at*$*Nt+g*ct*Nt)*kn,o[11]=(bt*ct*rt-at*Tt*rt-bt*$*mt+g*Tt*mt+at*$*It-g*ct*It)*kn,o[12]=sn*kn,o[13]=(bt*Dt*_e-Rt*Tt*_e+Rt*$*St-g*Dt*St-bt*$*Ft+g*Tt*Ft)*kn,o[14]=(Rt*ct*_e-at*Dt*_e-Rt*$*ft+g*Dt*ft+at*$*Ft-g*ct*Ft)*kn,o[15]=(at*Tt*_e-bt*ct*_e+bt*$*ft-g*Tt*ft-at*$*St+g*ct*St)*kn,this}scale(o){const g=this.elements,$=o.x,_e=o.y,rt=o.z;return g[0]*=$,g[4]*=_e,g[8]*=rt,g[1]*=$,g[5]*=_e,g[9]*=rt,g[2]*=$,g[6]*=_e,g[10]*=rt,g[3]*=$,g[7]*=_e,g[11]*=rt,this}getMaxScaleOnAxis(){const o=this.elements,g=o[0]*o[0]+o[1]*o[1]+o[2]*o[2],$=o[4]*o[4]+o[5]*o[5]+o[6]*o[6],_e=o[8]*o[8]+o[9]*o[9]+o[10]*o[10];return Math.sqrt(Math.max(g,$,_e))}makeTranslation(o,g,$){return this.set(1,0,0,o,0,1,0,g,0,0,1,$,0,0,0,1),this}makeRotationX(o){const g=Math.cos(o),$=Math.sin(o);return this.set(1,0,0,0,0,g,-$,0,0,$,g,0,0,0,0,1),this}makeRotationY(o){const g=Math.cos(o),$=Math.sin(o);return this.set(g,0,$,0,0,1,0,0,-$,0,g,0,0,0,0,1),this}makeRotationZ(o){const g=Math.cos(o),$=Math.sin(o);return this.set(g,-$,0,0,$,g,0,0,0,0,1,0,0,0,0,1),this}makeRotationAxis(o,g){const $=Math.cos(g),_e=Math.sin(g),rt=1-$,at=o.x,ct=o.y,ft=o.z,mt=rt*at,bt=rt*ct;return this.set(mt*at+$,mt*ct-_e*ft,mt*ft+_e*ct,0,mt*ct+_e*ft,bt*ct+$,bt*ft-_e*at,0,mt*ft-_e*ct,bt*ft+_e*at,rt*ft*ft+$,0,0,0,0,1),this}makeScale(o,g,$){return this.set(o,0,0,0,0,g,0,0,0,0,$,0,0,0,0,1),this}makeShear(o,g,$,_e,rt,at){return this.set(1,$,rt,0,o,1,at,0,g,_e,1,0,0,0,0,1),this}compose(o,g,$){const _e=this.elements,rt=g._x,at=g._y,ct=g._z,ft=g._w,mt=rt+rt,bt=at+at,Tt=ct+ct,St=rt*mt,It=rt*bt,Rt=rt*Tt,Dt=at*bt,Ft=at*Tt,Nt=ct*Tt,zt=ft*mt,Xt=ft*bt,tn=ft*Tt,sn=$.x,ln=$.y,kn=$.z;return _e[0]=(1-(Dt+Nt))*sn,_e[1]=(It+tn)*sn,_e[2]=(Rt-Xt)*sn,_e[3]=0,_e[4]=(It-tn)*ln,_e[5]=(1-(St+Nt))*ln,_e[6]=(Ft+zt)*ln,_e[7]=0,_e[8]=(Rt+Xt)*kn,_e[9]=(Ft-zt)*kn,_e[10]=(1-(St+Dt))*kn,_e[11]=0,_e[12]=o.x,_e[13]=o.y,_e[14]=o.z,_e[15]=1,this}decompose(o,g,$){const _e=this.elements;let rt=Gm.set(_e[0],_e[1],_e[2]).length();const at=Gm.set(_e[4],_e[5],_e[6]).length(),ct=Gm.set(_e[8],_e[9],_e[10]).length();this.determinant()<0&&(rt=-rt),o.x=_e[12],o.y=_e[13],o.z=_e[14],up.copy(this);const ft=1/rt,mt=1/at,bt=1/ct;return up.elements[0]*=ft,up.elements[1]*=ft,up.elements[2]*=ft,up.elements[4]*=mt,up.elements[5]*=mt,up.elements[6]*=mt,up.elements[8]*=bt,up.elements[9]*=bt,up.elements[10]*=bt,g.setFromRotationMatrix(up),$.x=rt,$.y=at,$.z=ct,this}makePerspective(o,g,$,_e,rt,at){const ct=this.elements,ft=2*rt/(g-o),mt=2*rt/($-_e),bt=(g+o)/(g-o),Tt=($+_e)/($-_e),St=-(at+rt)/(at-rt),It=-2*at*rt/(at-rt);return ct[0]=ft,ct[4]=0,ct[8]=bt,ct[12]=0,ct[1]=0,ct[5]=mt,ct[9]=Tt,ct[13]=0,ct[2]=0,ct[6]=0,ct[10]=St,ct[14]=It,ct[3]=0,ct[7]=0,ct[11]=-1,ct[15]=0,this}makeOrthographic(o,g,$,_e,rt,at){const ct=this.elements,ft=1/(g-o),mt=1/($-_e),bt=1/(at-rt),Tt=(g+o)*ft,St=($+_e)*mt,It=(at+rt)*bt;return ct[0]=2*ft,ct[4]=0,ct[8]=0,ct[12]=-Tt,ct[1]=0,ct[5]=2*mt,ct[9]=0,ct[13]=-St,ct[2]=0,ct[6]=0,ct[10]=-2*bt,ct[14]=-It,ct[3]=0,ct[7]=0,ct[11]=0,ct[15]=1,this}equals(o){const g=this.elements,$=o.elements;for(let _e=0;_e<16;_e++)if(g[_e]!==$[_e])return!1;return!0}fromArray(o,g=0){for(let $=0;$<16;$++)this.elements[$]=o[$+g];return this}toArray(o=[],g=0){const $=this.elements;return o[g]=$[0],o[g+1]=$[1],o[g+2]=$[2],o[g+3]=$[3],o[g+4]=$[4],o[g+5]=$[5],o[g+6]=$[6],o[g+7]=$[7],o[g+8]=$[8],o[g+9]=$[9],o[g+10]=$[10],o[g+11]=$[11],o[g+12]=$[12],o[g+13]=$[13],o[g+14]=$[14],o[g+15]=$[15],o}}const Gm=new fn,up=new Os,M1=new fn(0,0,0),Gw=new fn(1,1,1),su=new fn,Co=new fn,Ul=new fn,hp=new Os,Mp=new iu;class dp{constructor(o=0,g=0,$=0,_e=dp.DefaultOrder){this.isEuler=!0,this._x=o,this._y=g,this._z=$,this._order=_e}get x(){return this._x}set x(o){this._x=o,this._onChangeCallback()}get y(){return this._y}set y(o){this._y=o,this._onChangeCallback()}get z(){return this._z}set z(o){this._z=o,this._onChangeCallback()}get order(){return this._order}set order(o){this._order=o,this._onChangeCallback()}set(o,g,$,_e=this._order){return this._x=o,this._y=g,this._z=$,this._order=_e,this._onChangeCallback(),this}clone(){return new this.constructor(this._x,this._y,this._z,this._order)}copy(o){return this._x=o._x,this._y=o._y,this._z=o._z,this._order=o._order,this._onChangeCallback(),this}setFromRotationMatrix(o,g=this._order,$=!0){const _e=o.elements,rt=_e[0],at=_e[4],ct=_e[8],ft=_e[1],mt=_e[5],bt=_e[9],Tt=_e[2],St=_e[6],It=_e[10];switch(g){case"XYZ":this._y=Math.asin(As(ct,-1,1)),Math.abs(ct)<.9999999?(this._x=Math.atan2(-bt,It),this._z=Math.atan2(-at,rt)):(this._x=Math.atan2(St,mt),this._z=0);break;case"YXZ":this._x=Math.asin(-As(bt,-1,1)),Math.abs(bt)<.9999999?(this._y=Math.atan2(ct,It),this._z=Math.atan2(ft,mt)):(this._y=Math.atan2(-Tt,rt),this._z=0);break;case"ZXY":this._x=Math.asin(As(St,-1,1)),Math.abs(St)<.9999999?(this._y=Math.atan2(-Tt,It),this._z=Math.atan2(-at,mt)):(this._y=0,this._z=Math.atan2(ft,rt));break;case"ZYX":this._y=Math.asin(-As(Tt,-1,1)),Math.abs(Tt)<.9999999?(this._x=Math.atan2(St,It),this._z=Math.atan2(ft,rt)):(this._x=0,this._z=Math.atan2(-at,mt));break;case"YZX":this._z=Math.asin(As(ft,-1,1)),Math.abs(ft)<.9999999?(this._x=Math.atan2(-bt,mt),this._y=Math.atan2(-Tt,rt)):(this._x=0,this._y=Math.atan2(ct,It));break;case"XZY":this._z=Math.asin(-As(at,-1,1)),Math.abs(at)<.9999999?(this._x=Math.atan2(St,mt),this._y=Math.atan2(ct,rt)):(this._x=Math.atan2(-bt,It),this._y=0);break;default:console.warn("THREE.Euler: .setFromRotationMatrix() encountered an unknown order: "+g)}return this._order=g,$===!0&&this._onChangeCallback(),this}setFromQuaternion(o,g,$){return hp.makeRotationFromQuaternion(o),this.setFromRotationMatrix(hp,g,$)}setFromVector3(o,g=this._order){return this.set(o.x,o.y,o.z,g)}reorder(o){return Mp.setFromEuler(this),this.setFromQuaternion(Mp,o)}equals(o){return o._x===this._x&&o._y===this._y&&o._z===this._z&&o._order===this._order}fromArray(o){return this._x=o[0],this._y=o[1],this._z=o[2],o[3]!==void 0&&(this._order=o[3]),this._onChangeCallback(),this}toArray(o=[],g=0){return o[g]=this._x,o[g+1]=this._y,o[g+2]=this._z,o[g+3]=this._order,o}_onChange(o){return this._onChangeCallback=o,this}_onChangeCallback(){}*[Symbol.iterator](){yield this._x,yield this._y,yield this._z,yield this._order}toVector3(){console.error("THREE.Euler: .toVector3() has been removed. Use Vector3.setFromEuler() instead")}}dp.DefaultOrder="XYZ",dp.RotationOrders=["XYZ","YZX","ZXY","XZY","YXZ","ZYX"];class pA{constructor(){this.mask=1}set(o){this.mask=(1<<o|0)>>>0}enable(o){this.mask|=1<<o|0}enableAll(){this.mask=-1}toggle(o){this.mask^=1<<o|0}disable(o){this.mask&=~(1<<o|0)}disableAll(){this.mask=0}test(o){return(this.mask&o.mask)!=0}isEnabled(o){return(this.mask&(1<<o|0))!=0}}let A0=0;const Dy=new fn,y0=new iu,Tp=new Os,Jl=new fn,Lv=new fn,fA=new fn,_u=new iu,w0=new fn(1,0,0),Vp=new fn(0,1,0),Hm=new fn(0,0,1),mA={type:"added"},gA={type:"removed"};class no extends op{constructor(){super(),this.isObject3D=!0,Object.defineProperty(this,"id",{value:A0++}),this.uuid=Es(),this.name="",this.type="Object3D",this.parent=null,this.children=[],this.up=no.DefaultUp.clone();const o=new fn,g=new dp,$=new iu,_e=new fn(1,1,1);g._onChange(function(){$.setFromEuler(g,!1)}),$._onChange(function(){g.setFromQuaternion($,void 0,!1)}),Object.defineProperties(this,{position:{configurable:!0,enumerable:!0,value:o},rotation:{configurable:!0,enumerable:!0,value:g},quaternion:{configurable:!0,enumerable:!0,value:$},scale:{configurable:!0,enumerable:!0,value:_e},modelViewMatrix:{value:new Os},normalMatrix:{value:new nu}}),this.matrix=new Os,this.matrixWorld=new Os,this.matrixAutoUpdate=no.DefaultMatrixAutoUpdate,this.matrixWorldNeedsUpdate=!1,this.matrixWorldAutoUpdate=no.DefaultMatrixWorldAutoUpdate,this.layers=new pA,this.visible=!0,this.castShadow=!1,this.receiveShadow=!1,this.frustumCulled=!0,this.renderOrder=0,this.animations=[],this.userData={}}onBeforeRender(o,g,$,_e,rt,at){this.dispatchEvent({type:"beforeRender",renderer:o,scene:g,camera:$,geometry:_e,material:rt,group:at})}onAfterRender(){}applyMatrix4(o){this.matrixAutoUpdate&&this.updateMatrix(),this.matrix.premultiply(o),this.matrix.decompose(this.position,this.quaternion,this.scale)}applyQuaternion(o){return this.quaternion.premultiply(o),this}setRotationFromAxisAngle(o,g){this.quaternion.setFromAxisAngle(o,g)}setRotationFromEuler(o){this.quaternion.setFromEuler(o,!0)}setRotationFromMatrix(o){this.quaternion.setFromRotationMatrix(o)}setRotationFromQuaternion(o){this.quaternion.copy(o)}rotateOnAxis(o,g){return y0.setFromAxisAngle(o,g),this.quaternion.multiply(y0),this}rotateOnWorldAxis(o,g){return y0.setFromAxisAngle(o,g),this.quaternion.premultiply(y0),this}rotateX(o){return this.rotateOnAxis(w0,o)}rotateY(o){return this.rotateOnAxis(Vp,o)}rotateZ(o){return this.rotateOnAxis(Hm,o)}translateOnAxis(o,g){return Dy.copy(o).applyQuaternion(this.quaternion),this.position.add(Dy.multiplyScalar(g)),this}translateX(o){return this.translateOnAxis(w0,o)}translateY(o){return this.translateOnAxis(Vp,o)}translateZ(o){return this.translateOnAxis(Hm,o)}localToWorld(o){return o.applyMatrix4(this.matrixWorld)}worldToLocal(o){return o.applyMatrix4(Tp.copy(this.matrixWorld).invert())}lookAt(o,g,$){o.isVector3?Jl.copy(o):Jl.set(o,g,$);const _e=this.parent;this.updateWorldMatrix(!0,!1),Lv.setFromMatrixPosition(this.matrixWorld),this.isCamera||this.isLight?Tp.lookAt(Lv,Jl,this.up):Tp.lookAt(Jl,Lv,this.up),this.quaternion.setFromRotationMatrix(Tp),_e&&(Tp.extractRotation(_e.matrixWorld),y0.setFromRotationMatrix(Tp),this.quaternion.premultiply(y0.invert()))}add(o){if(arguments.length>1){for(let g=0;g<arguments.length;g++)this.add(arguments[g]);return this}return o===this?(console.error("THREE.Object3D.add: object can't be added as a child of itself.",o),this):(o&&o.isObject3D?(o.parent!==null&&o.parent.remove(o),o.parent=this,this.children.push(o),o.dispatchEvent(mA)):console.error("THREE.Object3D.add: object not an instance of THREE.Object3D.",o),this)}remove(o){if(arguments.length>1){for(let $=0;$<arguments.length;$++)this.remove(arguments[$]);return this}const g=this.children.indexOf(o);return g!==-1&&(o.parent=null,this.children.splice(g,1),o.dispatchEvent(gA)),this}removeFromParent(){const o=this.parent;return o!==null&&o.remove(this),this}clear(){for(let o=0;o<this.children.length;o++){const g=this.children[o];g.parent=null,g.dispatchEvent(gA)}return this.children.length=0,this}attach(o){return this.updateWorldMatrix(!0,!1),Tp.copy(this.matrixWorld).invert(),o.parent!==null&&(o.parent.updateWorldMatrix(!0,!1),Tp.multiply(o.parent.matrixWorld)),o.applyMatrix4(Tp),this.add(o),o.updateWorldMatrix(!1,!0),this}getObjectById(o){return this.getObjectByProperty("id",o)}getObjectByName(o){return this.getObjectByProperty("name",o)}getObjectByProperty(o,g){if(this[o]===g)return this;for(let $=0,_e=this.children.length;$<_e;$++){const rt=this.children[$].getObjectByProperty(o,g);if(rt!==void 0)return rt}}getWorldPosition(o){return this.updateWorldMatrix(!0,!1),o.setFromMatrixPosition(this.matrixWorld)}getWorldQuaternion(o){return this.updateWorldMatrix(!0,!1),this.matrixWorld.decompose(Lv,o,fA),o}getWorldScale(o){return this.updateWorldMatrix(!0,!1),this.matrixWorld.decompose(Lv,_u,o),o}getWorldDirection(o){this.updateWorldMatrix(!0,!1);const g=this.matrixWorld.elements;return o.set(g[8],g[9],g[10]).normalize()}raycast(){}traverse(o){o(this);const g=this.children;for(let $=0,_e=g.length;$<_e;$++)g[$].traverse(o)}traverseVisible(o){if(this.visible===!1)return;o(this);const g=this.children;for(let $=0,_e=g.length;$<_e;$++)g[$].traverseVisible(o)}traverseAncestors(o){const g=this.parent;g!==null&&(o(g),g.traverseAncestors(o))}updateMatrix(){this.matrix.compose(this.position,this.quaternion,this.scale),this.matrixWorldNeedsUpdate=!0}updateMatrixWorld(o){this.matrixAutoUpdate&&this.updateMatrix(),(this.matrixWorldNeedsUpdate||o)&&(this.parent===null?this.matrixWorld.copy(this.matrix):this.matrixWorld.multiplyMatrices(this.parent.matrixWorld,this.matrix),this.matrixWorldNeedsUpdate=!1,o=!0);const g=this.children;for(let $=0,_e=g.length;$<_e;$++){const rt=g[$];rt.matrixWorldAutoUpdate!==!0&&o!==!0||rt.updateMatrixWorld(o)}}updateWorldMatrix(o,g){const $=this.parent;if(o===!0&&$!==null&&$.matrixWorldAutoUpdate===!0&&$.updateWorldMatrix(!0,!1),this.matrixAutoUpdate&&this.updateMatrix(),this.parent===null?this.matrixWorld.copy(this.matrix):this.matrixWorld.multiplyMatrices(this.parent.matrixWorld,this.matrix),g===!0){const _e=this.children;for(let rt=0,at=_e.length;rt<at;rt++){const ct=_e[rt];ct.matrixWorldAutoUpdate===!0&&ct.updateWorldMatrix(!1,!0)}}}toJSON(o){const g=o===void 0||typeof o=="string",$={};g&&(o={geometries:{},materials:{},textures:{},images:{},shapes:{},skeletons:{},animations:{},nodes:{}},$.metadata={version:4.5,type:"Object",generator:"Object3D.toJSON"});const _e={};function rt(ct,ft){return ct[ft.uuid]===void 0&&(ct[ft.uuid]=ft.toJSON(o)),ft.uuid}if(_e.uuid=this.uuid,_e.type=this.type,this.name!==""&&(_e.name=this.name),this.castShadow===!0&&(_e.castShadow=!0),this.receiveShadow===!0&&(_e.receiveShadow=!0),this.visible===!1&&(_e.visible=!1),this.frustumCulled===!1&&(_e.frustumCulled=!1),this.renderOrder!==0&&(_e.renderOrder=this.renderOrder),JSON.stringify(this.userData)!=="{}"&&(_e.userData=this.userData),_e.layers=this.layers.mask,_e.matrix=this.matrix.toArray(),this.matrixAutoUpdate===!1&&(_e.matrixAutoUpdate=!1),this.isInstancedMesh&&(_e.type="InstancedMesh",_e.count=this.count,_e.instanceMatrix=this.instanceMatrix.toJSON(),this.instanceColor!==null&&(_e.instanceColor=this.instanceColor.toJSON())),this.isScene)this.background&&(this.background.isColor?_e.background=this.background.toJSON():this.background.isTexture&&(_e.background=this.background.toJSON(o).uuid)),this.environment&&this.environment.isTexture&&this.environment.isRenderTargetTexture!==!0&&(_e.environment=this.environment.toJSON(o).uuid);else if(this.isMesh||this.isLine||this.isPoints){_e.geometry=rt(o.geometries,this.geometry);const ct=this.geometry.parameters;if(ct!==void 0&&ct.shapes!==void 0){const ft=ct.shapes;if(Array.isArray(ft))for(let mt=0,bt=ft.length;mt<bt;mt++){const Tt=ft[mt];rt(o.shapes,Tt)}else rt(o.shapes,ft)}}if(this.isSkinnedMesh&&(_e.bindMode=this.bindMode,_e.bindMatrix=this.bindMatrix.toArray(),this.skeleton!==void 0&&(rt(o.skeletons,this.skeleton),_e.skeleton=this.skeleton.uuid)),this.material!==void 0)if(Array.isArray(this.material)){const ct=[];for(let ft=0,mt=this.material.length;ft<mt;ft++)ct.push(rt(o.materials,this.material[ft]));_e.material=ct}else _e.material=rt(o.materials,this.material);if(this.children.length>0){_e.children=[];for(let ct=0;ct<this.children.length;ct++)_e.children.push(this.children[ct].toJSON(o).object)}if(this.animations.length>0){_e.animations=[];for(let ct=0;ct<this.animations.length;ct++){const ft=this.animations[ct];_e.animations.push(rt(o.animations,ft))}}if(g){const ct=at(o.geometries),ft=at(o.materials),mt=at(o.textures),bt=at(o.images),Tt=at(o.shapes),St=at(o.skeletons),It=at(o.animations),Rt=at(o.nodes);ct.length>0&&($.geometries=ct),ft.length>0&&($.materials=ft),mt.length>0&&($.textures=mt),bt.length>0&&($.images=bt),Tt.length>0&&($.shapes=Tt),St.length>0&&($.skeletons=St),It.length>0&&($.animations=It),Rt.length>0&&($.nodes=Rt)}return $.object=_e,$;function at(ct){const ft=[];for(const mt in ct){const bt=ct[mt];delete bt.metadata,ft.push(bt)}return ft}}clone(o){return new this.constructor().copy(this,o)}copy(o,g=!0){this.name=o.name,this.up.copy(o.up),this.position.copy(o.position),this.rotation.order=o.rotation.order,this.quaternion.copy(o.quaternion),this.scale.copy(o.scale),this.matrix.copy(o.matrix),this.matrixWorld.copy(o.matrixWorld),this.matrixAutoUpdate=o.matrixAutoUpdate,this.matrixWorldNeedsUpdate=o.matrixWorldNeedsUpdate,this.matrixWorldAutoUpdate=o.matrixWorldAutoUpdate,this.layers.mask=o.layers.mask,this.visible=o.visible,this.castShadow=o.castShadow,this.receiveShadow=o.receiveShadow,this.frustumCulled=o.frustumCulled,this.renderOrder=o.renderOrder,this.userData={};for(const[$,_e]of Object.entries(o.userData))this.userData[$]=!_e||_e&&(_e.isTexture||_e.isObject3D)?_e:JSON.parse(JSON.stringify(_e));if(g===!0)for(let $=0;$<o.children.length;$++){const _e=o.children[$];this.add(_e.clone())}return this}}no.DefaultUp=new fn(0,1,0),no.DefaultMatrixAutoUpdate=!0,no.DefaultMatrixWorldAutoUpdate=!0;const Au=new fn,pp=new fn,Ip=new fn,mm=new fn,Xu=new fn,Wm=new fn,Py=new fn,Nv=new fn,vA=new fn,qm=new fn;class yu{constructor(o=new fn,g=new fn,$=new fn){this.a=o,this.b=g,this.c=$}static getNormal(o,g,$,_e){_e.subVectors($,g),Au.subVectors(o,g),_e.cross(Au);const rt=_e.lengthSq();return rt>0?_e.multiplyScalar(1/Math.sqrt(rt)):_e.set(0,0,0)}static getBarycoord(o,g,$,_e,rt){Au.subVectors(_e,g),pp.subVectors($,g),Ip.subVectors(o,g);const at=Au.dot(Au),ct=Au.dot(pp),ft=Au.dot(Ip),mt=pp.dot(pp),bt=pp.dot(Ip),Tt=at*mt-ct*ct;if(Tt===0)return rt.set(-2,-1,-1);const St=1/Tt,It=(mt*ft-ct*bt)*St,Rt=(at*bt-ct*ft)*St;return rt.set(1-It-Rt,Rt,It)}static containsPoint(o,g,$,_e){return this.getBarycoord(o,g,$,_e,mm),mm.x>=0&&mm.y>=0&&mm.x+mm.y<=1}static getUV(o,g,$,_e,rt,at,ct,ft){return this.getBarycoord(o,g,$,_e,mm),ft.set(0,0),ft.addScaledVector(rt,mm.x),ft.addScaledVector(at,mm.y),ft.addScaledVector(ct,mm.z),ft}static isFrontFacing(o,g,$,_e){return Au.subVectors($,g),pp.subVectors(o,g),Au.cross(pp).dot(_e)<0}set(o,g,$){return this.a.copy(o),this.b.copy(g),this.c.copy($),this}setFromPointsAndIndices(o,g,$,_e){return this.a.copy(o[g]),this.b.copy(o[$]),this.c.copy(o[_e]),this}setFromAttributeAndIndices(o,g,$,_e){return this.a.fromBufferAttribute(o,g),this.b.fromBufferAttribute(o,$),this.c.fromBufferAttribute(o,_e),this}clone(){return new this.constructor().copy(this)}copy(o){return this.a.copy(o.a),this.b.copy(o.b),this.c.copy(o.c),this}getArea(){return Au.subVectors(this.c,this.b),pp.subVectors(this.a,this.b),.5*Au.cross(pp).length()}getMidpoint(o){return o.addVectors(this.a,this.b).add(this.c).multiplyScalar(1/3)}getNormal(o){return yu.getNormal(this.a,this.b,this.c,o)}getPlane(o){return o.setFromCoplanarPoints(this.a,this.b,this.c)}getBarycoord(o,g){return yu.getBarycoord(o,this.a,this.b,this.c,g)}getUV(o,g,$,_e,rt){return yu.getUV(o,this.a,this.b,this.c,g,$,_e,rt)}containsPoint(o){return yu.containsPoint(o,this.a,this.b,this.c)}isFrontFacing(o){return yu.isFrontFacing(this.a,this.b,this.c,o)}intersectsBox(o){return o.intersectsTriangle(this)}closestPointToPoint(o,g){const $=this.a,_e=this.b,rt=this.c;let at,ct;Xu.subVectors(_e,$),Wm.subVectors(rt,$),Nv.subVectors(o,$);const ft=Xu.dot(Nv),mt=Wm.dot(Nv);if(ft<=0&&mt<=0)return g.copy($);vA.subVectors(o,_e);const bt=Xu.dot(vA),Tt=Wm.dot(vA);if(bt>=0&&Tt<=bt)return g.copy(_e);const St=ft*Tt-bt*mt;if(St<=0&&ft>=0&&bt<=0)return at=ft/(ft-bt),g.copy($).addScaledVector(Xu,at);qm.subVectors(o,rt);const It=Xu.dot(qm),Rt=Wm.dot(qm);if(Rt>=0&&It<=Rt)return g.copy(rt);const Dt=It*mt-ft*Rt;if(Dt<=0&&mt>=0&&Rt<=0)return ct=mt/(mt-Rt),g.copy($).addScaledVector(Wm,ct);const Ft=bt*Rt-It*Tt;if(Ft<=0&&Tt-bt>=0&&It-Rt>=0)return Py.subVectors(rt,_e),ct=(Tt-bt)/(Tt-bt+(It-Rt)),g.copy(_e).addScaledVector(Py,ct);const Nt=1/(Ft+Dt+St);return at=Dt*Nt,ct=St*Nt,g.copy($).addScaledVector(Xu,at).addScaledVector(Wm,ct)}equals(o){return o.a.equals(this.a)&&o.b.equals(this.b)&&o.c.equals(this.c)}}let T1=0;class Fl extends op{constructor(){super(),this.isMaterial=!0,Object.defineProperty(this,"id",{value:T1++}),this.uuid=Es(),this.name="",this.type="Material",this.blending=jt,this.side=_n,this.vertexColors=!1,this.opacity=1,this.transparent=!1,this.blendSrc=yr,this.blendDst=Hr,this.blendEquation=Qt,this.blendSrcAlpha=null,this.blendDstAlpha=null,this.blendEquationAlpha=null,this.depthFunc=rn,this.depthTest=!0,this.depthWrite=!0,this.stencilWriteMask=255,this.stencilFunc=jp,this.stencilRef=0,this.stencilFuncMask=255,this.stencilFail=Vs,this.stencilZFail=Vs,this.stencilZPass=Vs,this.stencilWrite=!1,this.clippingPlanes=null,this.clipIntersection=!1,this.clipShadows=!1,this.shadowSide=null,this.colorWrite=!0,this.precision=null,this.polygonOffset=!1,this.polygonOffsetFactor=0,this.polygonOffsetUnits=0,this.dithering=!1,this.alphaToCoverage=!1,this.premultipliedAlpha=!1,this.visible=!0,this.toneMapped=!0,this.userData={},this.version=0,this._alphaTest=0}get alphaTest(){return this._alphaTest}set alphaTest(o){this._alphaTest>0!=o>0&&this.version++,this._alphaTest=o}onBuild(){}onBeforeRender(){}onAfterRender(){}onBeforeCompile(){}customProgramCacheKey(){return this.onBeforeCompile.toString()}setValues(o){if(o!==void 0)for(const g in o){const $=o[g];if($===void 0){console.warn("THREE.Material: '"+g+"' parameter is undefined.");continue}const _e=this[g];_e!==void 0&&(_e&&_e.isColor?_e.set($):_e&&_e.isVector3&&$&&$.isVector3?_e.copy($):this[g]=$)}}toJSON(o){const g=o===void 0||typeof o=="string";g&&(o={textures:{},images:{}});const $={metadata:{version:4.5,type:"Material",generator:"Material.toJSON"}};function _e(rt){const at=[];for(const ct in rt){const ft=rt[ct];delete ft.metadata,at.push(ft)}return at}if($.uuid=this.uuid,$.type=this.type,this.name!==""&&($.name=this.name),this.color&&this.color.isColor&&($.color=this.color.getHex()),this.roughness!==void 0&&($.roughness=this.roughness),this.metalness!==void 0&&($.metalness=this.metalness),this.sheen!==void 0&&($.sheen=this.sheen),this.sheenColor&&this.sheenColor.isColor&&($.sheenColor=this.sheenColor.getHex()),this.sheenRoughness!==void 0&&($.sheenRoughness=this.sheenRoughness),this.emissive&&this.emissive.isColor&&($.emissive=this.emissive.getHex()),this.emissiveIntensity&&this.emissiveIntensity!==1&&($.emissiveIntensity=this.emissiveIntensity),this.specular&&this.specular.isColor&&($.specular=this.specular.getHex()),this.specularIntensity!==void 0&&($.specularIntensity=this.specularIntensity),this.specularColor&&this.specularColor.isColor&&($.specularColor=this.specularColor.getHex()),this.shininess!==void 0&&($.shininess=this.shininess),this.clearcoat!==void 0&&($.clearcoat=this.clearcoat),this.clearcoatRoughness!==void 0&&($.clearcoatRoughness=this.clearcoatRoughness),this.clearcoatMap&&this.clearcoatMap.isTexture&&($.clearcoatMap=this.clearcoatMap.toJSON(o).uuid),this.clearcoatRoughnessMap&&this.clearcoatRoughnessMap.isTexture&&($.clearcoatRoughnessMap=this.clearcoatRoughnessMap.toJSON(o).uuid),this.clearcoatNormalMap&&this.clearcoatNormalMap.isTexture&&($.clearcoatNormalMap=this.clearcoatNormalMap.toJSON(o).uuid,$.clearcoatNormalScale=this.clearcoatNormalScale.toArray()),this.iridescence!==void 0&&($.iridescence=this.iridescence),this.iridescenceIOR!==void 0&&($.iridescenceIOR=this.iridescenceIOR),this.iridescenceThicknessRange!==void 0&&($.iridescenceThicknessRange=this.iridescenceThicknessRange),this.iridescenceMap&&this.iridescenceMap.isTexture&&($.iridescenceMap=this.iridescenceMap.toJSON(o).uuid),this.iridescenceThicknessMap&&this.iridescenceThicknessMap.isTexture&&($.iridescenceThicknessMap=this.iridescenceThicknessMap.toJSON(o).uuid),this.map&&this.map.isTexture&&($.map=this.map.toJSON(o).uuid),this.matcap&&this.matcap.isTexture&&($.matcap=this.matcap.toJSON(o).uuid),this.alphaMap&&this.alphaMap.isTexture&&($.alphaMap=this.alphaMap.toJSON(o).uuid),this.lightMap&&this.lightMap.isTexture&&($.lightMap=this.lightMap.toJSON(o).uuid,$.lightMapIntensity=this.lightMapIntensity),this.aoMap&&this.aoMap.isTexture&&($.aoMap=this.aoMap.toJSON(o).uuid,$.aoMapIntensity=this.aoMapIntensity),this.bumpMap&&this.bumpMap.isTexture&&($.bumpMap=this.bumpMap.toJSON(o).uuid,$.bumpScale=this.bumpScale),this.normalMap&&this.normalMap.isTexture&&($.normalMap=this.normalMap.toJSON(o).uuid,$.normalMapType=this.normalMapType,$.normalScale=this.normalScale.toArray()),this.displacementMap&&this.displacementMap.isTexture&&($.displacementMap=this.displacementMap.toJSON(o).uuid,$.displacementScale=this.displacementScale,$.displacementBias=this.displacementBias),this.roughnessMap&&this.roughnessMap.isTexture&&($.roughnessMap=this.roughnessMap.toJSON(o).uuid),this.metalnessMap&&this.metalnessMap.isTexture&&($.metalnessMap=this.metalnessMap.toJSON(o).uuid),this.emissiveMap&&this.emissiveMap.isTexture&&($.emissiveMap=this.emissiveMap.toJSON(o).uuid),this.specularMap&&this.specularMap.isTexture&&($.specularMap=this.specularMap.toJSON(o).uuid),this.specularIntensityMap&&this.specularIntensityMap.isTexture&&($.specularIntensityMap=this.specularIntensityMap.toJSON(o).uuid),this.specularColorMap&&this.specularColorMap.isTexture&&($.specularColorMap=this.specularColorMap.toJSON(o).uuid),this.envMap&&this.envMap.isTexture&&($.envMap=this.envMap.toJSON(o).uuid,this.combine!==void 0&&($.combine=this.combine)),this.envMapIntensity!==void 0&&($.envMapIntensity=this.envMapIntensity),this.reflectivity!==void 0&&($.reflectivity=this.reflectivity),this.refractionRatio!==void 0&&($.refractionRatio=this.refractionRatio),this.gradientMap&&this.gradientMap.isTexture&&($.gradientMap=this.gradientMap.toJSON(o).uuid),this.transmission!==void 0&&($.transmission=this.transmission),this.transmissionMap&&this.transmissionMap.isTexture&&($.transmissionMap=this.transmissionMap.toJSON(o).uuid),this.thickness!==void 0&&($.thickness=this.thickness),this.thicknessMap&&this.thicknessMap.isTexture&&($.thicknessMap=this.thicknessMap.toJSON(o).uuid),this.attenuationDistance!==void 0&&($.attenuationDistance=this.attenuationDistance),this.attenuationColor!==void 0&&($.attenuationColor=this.attenuationColor.getHex()),this.size!==void 0&&($.size=this.size),this.shadowSide!==null&&($.shadowSide=this.shadowSide),this.sizeAttenuation!==void 0&&($.sizeAttenuation=this.sizeAttenuation),this.blending!==jt&&($.blending=this.blending),this.side!==_n&&($.side=this.side),this.vertexColors&&($.vertexColors=!0),this.opacity<1&&($.opacity=this.opacity),this.transparent===!0&&($.transparent=this.transparent),$.depthFunc=this.depthFunc,$.depthTest=this.depthTest,$.depthWrite=this.depthWrite,$.colorWrite=this.colorWrite,$.stencilWrite=this.stencilWrite,$.stencilWriteMask=this.stencilWriteMask,$.stencilFunc=this.stencilFunc,$.stencilRef=this.stencilRef,$.stencilFuncMask=this.stencilFuncMask,$.stencilFail=this.stencilFail,$.stencilZFail=this.stencilZFail,$.stencilZPass=this.stencilZPass,this.rotation!==void 0&&this.rotation!==0&&($.rotation=this.rotation),this.polygonOffset===!0&&($.polygonOffset=!0),this.polygonOffsetFactor!==0&&($.polygonOffsetFactor=this.polygonOffsetFactor),this.polygonOffsetUnits!==0&&($.polygonOffsetUnits=this.polygonOffsetUnits),this.linewidth!==void 0&&this.linewidth!==1&&($.linewidth=this.linewidth),this.dashSize!==void 0&&($.dashSize=this.dashSize),this.gapSize!==void 0&&($.gapSize=this.gapSize),this.scale!==void 0&&($.scale=this.scale),this.dithering===!0&&($.dithering=!0),this.alphaTest>0&&($.alphaTest=this.alphaTest),this.alphaToCoverage===!0&&($.alphaToCoverage=this.alphaToCoverage),this.premultipliedAlpha===!0&&($.premultipliedAlpha=this.premultipliedAlpha),this.wireframe===!0&&($.wireframe=this.wireframe),this.wireframeLinewidth>1&&($.wireframeLinewidth=this.wireframeLinewidth),this.wireframeLinecap!=="round"&&($.wireframeLinecap=this.wireframeLinecap),this.wireframeLinejoin!=="round"&&($.wireframeLinejoin=this.wireframeLinejoin),this.flatShading===!0&&($.flatShading=this.flatShading),this.visible===!1&&($.visible=!1),this.toneMapped===!1&&($.toneMapped=!1),this.fog===!1&&($.fog=!1),JSON.stringify(this.userData)!=="{}"&&($.userData=this.userData),g){const rt=_e(o.textures),at=_e(o.images);rt.length>0&&($.textures=rt),at.length>0&&($.images=at)}return $}clone(){return new this.constructor().copy(this)}copy(o){this.name=o.name,this.blending=o.blending,this.side=o.side,this.vertexColors=o.vertexColors,this.opacity=o.opacity,this.transparent=o.transparent,this.blendSrc=o.blendSrc,this.blendDst=o.blendDst,this.blendEquation=o.blendEquation,this.blendSrcAlpha=o.blendSrcAlpha,this.blendDstAlpha=o.blendDstAlpha,this.blendEquationAlpha=o.blendEquationAlpha,this.depthFunc=o.depthFunc,this.depthTest=o.depthTest,this.depthWrite=o.depthWrite,this.stencilWriteMask=o.stencilWriteMask,this.stencilFunc=o.stencilFunc,this.stencilRef=o.stencilRef,this.stencilFuncMask=o.stencilFuncMask,this.stencilFail=o.stencilFail,this.stencilZFail=o.stencilZFail,this.stencilZPass=o.stencilZPass,this.stencilWrite=o.stencilWrite;const g=o.clippingPlanes;let $=null;if(g!==null){const _e=g.length;$=new Array(_e);for(let rt=0;rt!==_e;++rt)$[rt]=g[rt].clone()}this.clippingPlanes=$,this.clipIntersection=o.clipIntersection,this.clipShadows=o.clipShadows,this.shadowSide=o.shadowSide,this.colorWrite=o.colorWrite,this.precision=o.precision,this.polygonOffset=o.polygonOffset,this.polygonOffsetFactor=o.polygonOffsetFactor,this.polygonOffsetUnits=o.polygonOffsetUnits,this.dithering=o.dithering,this.alphaTest=o.alphaTest,this.alphaToCoverage=o.alphaToCoverage,this.premultipliedAlpha=o.premultipliedAlpha,this.visible=o.visible,this.toneMapped=o.toneMapped,this.userData={};for(const[_e,rt]of Object.entries(o.userData))this.userData[_e]=!rt||rt&&(rt.isTexture||rt.isObject3D)?rt:JSON.parse(JSON.stringify(rt));return this}dispose(){this.dispatchEvent({type:"dispose"})}set needsUpdate(o){o===!0&&this.version++}}class gm extends Fl{constructor(o){super(),this.isMeshBasicMaterial=!0,this.type="MeshBasicMaterial",this.color=new rs(16777215),this.map=null,this.lightMap=null,this.lightMapIntensity=1,this.aoMap=null,this.aoMapIntensity=1,this.specularMap=null,this.alphaMap=null,this.envMap=null,this.combine=Cs,this.reflectivity=1,this.refractionRatio=.98,this.wireframe=!1,this.wireframeLinewidth=1,this.wireframeLinecap="round",this.wireframeLinejoin="round",this.fog=!0,this.setValues(o)}copy(o){return super.copy(o),this.color.copy(o.color),this.map=o.map,this.lightMap=o.lightMap,this.lightMapIntensity=o.lightMapIntensity,this.aoMap=o.aoMap,this.aoMapIntensity=o.aoMapIntensity,this.specularMap=o.specularMap,this.alphaMap=o.alphaMap,this.envMap=o.envMap,this.combine=o.combine,this.reflectivity=o.reflectivity,this.refractionRatio=o.refractionRatio,this.wireframe=o.wireframe,this.wireframeLinewidth=o.wireframeLinewidth,this.wireframeLinecap=o.wireframeLinecap,this.wireframeLinejoin=o.wireframeLinejoin,this.fog=o.fog,this}}const Uo=new fn,vm=new Sr;class Ro{constructor(o,g,$){if(Array.isArray(o))throw new TypeError("THREE.BufferAttribute: array should be a Typed Array.");this.isBufferAttribute=!0,this.name="",this.array=o,this.itemSize=g,this.count=o!==void 0?o.length/g:0,this.normalized=$===!0,this.usage=Iu,this.updateRange={offset:0,count:-1},this.version=0}onUploadCallback(){}set needsUpdate(o){o===!0&&this.version++}setUsage(o){return this.usage=o,this}copy(o){return this.name=o.name,this.array=new o.array.constructor(o.array),this.itemSize=o.itemSize,this.count=o.count,this.normalized=o.normalized,this.usage=o.usage,this}copyAt(o,g,$){o*=this.itemSize,$*=g.itemSize;for(let _e=0,rt=this.itemSize;_e<rt;_e++)this.array[o+_e]=g.array[$+_e];return this}copyArray(o){return this.array.set(o),this}applyMatrix3(o){if(this.itemSize===2)for(let g=0,$=this.count;g<$;g++)vm.fromBufferAttribute(this,g),vm.applyMatrix3(o),this.setXY(g,vm.x,vm.y);else if(this.itemSize===3)for(let g=0,$=this.count;g<$;g++)Uo.fromBufferAttribute(this,g),Uo.applyMatrix3(o),this.setXYZ(g,Uo.x,Uo.y,Uo.z);return this}applyMatrix4(o){for(let g=0,$=this.count;g<$;g++)Uo.fromBufferAttribute(this,g),Uo.applyMatrix4(o),this.setXYZ(g,Uo.x,Uo.y,Uo.z);return this}applyNormalMatrix(o){for(let g=0,$=this.count;g<$;g++)Uo.fromBufferAttribute(this,g),Uo.applyNormalMatrix(o),this.setXYZ(g,Uo.x,Uo.y,Uo.z);return this}transformDirection(o){for(let g=0,$=this.count;g<$;g++)Uo.fromBufferAttribute(this,g),Uo.transformDirection(o),this.setXYZ(g,Uo.x,Uo.y,Uo.z);return this}set(o,g=0){return this.array.set(o,g),this}getX(o){let g=this.array[o*this.itemSize];return this.normalized&&(g=Um(g,this.array)),g}setX(o,g){return this.normalized&&(g=Po(g,this.array)),this.array[o*this.itemSize]=g,this}getY(o){let g=this.array[o*this.itemSize+1];return this.normalized&&(g=Um(g,this.array)),g}setY(o,g){return this.normalized&&(g=Po(g,this.array)),this.array[o*this.itemSize+1]=g,this}getZ(o){let g=this.array[o*this.itemSize+2];return this.normalized&&(g=Um(g,this.array)),g}setZ(o,g){return this.normalized&&(g=Po(g,this.array)),this.array[o*this.itemSize+2]=g,this}getW(o){let g=this.array[o*this.itemSize+3];return this.normalized&&(g=Um(g,this.array)),g}setW(o,g){return this.normalized&&(g=Po(g,this.array)),this.array[o*this.itemSize+3]=g,this}setXY(o,g,$){return o*=this.itemSize,this.normalized&&(g=Po(g,this.array),$=Po($,this.array)),this.array[o+0]=g,this.array[o+1]=$,this}setXYZ(o,g,$,_e){return o*=this.itemSize,this.normalized&&(g=Po(g,this.array),$=Po($,this.array),_e=Po(_e,this.array)),this.array[o+0]=g,this.array[o+1]=$,this.array[o+2]=_e,this}setXYZW(o,g,$,_e,rt){return o*=this.itemSize,this.normalized&&(g=Po(g,this.array),$=Po($,this.array),_e=Po(_e,this.array),rt=Po(rt,this.array)),this.array[o+0]=g,this.array[o+1]=$,this.array[o+2]=_e,this.array[o+3]=rt,this}onUpload(o){return this.onUploadCallback=o,this}clone(){return new this.constructor(this.array,this.itemSize).copy(this)}toJSON(){const o={itemSize:this.itemSize,type:this.array.constructor.name,array:Array.from(this.array),normalized:this.normalized};return this.name!==""&&(o.name=this.name),this.usage!==Iu&&(o.usage=this.usage),this.updateRange.offset===0&&this.updateRange.count===-1||(o.updateRange=this.updateRange),o}copyColorsArray(){console.error("THREE.BufferAttribute: copyColorsArray() was removed in r144.")}copyVector2sArray(){console.error("THREE.BufferAttribute: copyVector2sArray() was removed in r144.")}copyVector3sArray(){console.error("THREE.BufferAttribute: copyVector3sArray() was removed in r144.")}copyVector4sArray(){console.error("THREE.BufferAttribute: copyVector4sArray() was removed in r144.")}}class I1 extends Ro{constructor(o,g,$){super(new Int8Array(o),g,$)}}class D1 extends Ro{constructor(o,g,$){super(new Uint8Array(o),g,$)}}class P1 extends Ro{constructor(o,g,$){super(new Uint8ClampedArray(o),g,$)}}class Uv extends Ro{constructor(o,g,$){super(new Int16Array(o),g,$)}}class g_ extends Ro{constructor(o,g,$){super(new Uint16Array(o),g,$)}}class v_ extends Ro{constructor(o,g,$){super(new Int32Array(o),g,$)}}class At extends Ro{constructor(o,g,$){super(new Uint32Array(o),g,$)}}class st extends Ro{constructor(o,g,$){super(new Uint16Array(o),g,$),this.isFloat16BufferAttribute=!0}}class ht extends Ro{constructor(o,g,$){super(new Float32Array(o),g,$)}}class Mt extends Ro{constructor(o,g,$){super(new Float64Array(o),g,$)}}let Ht=0;const hn=new Os,Rn=new no,lr=new fn,Nr=new Xl,ds=new Xl,ws=new fn;class fs extends op{constructor(){super(),this.isBufferGeometry=!0,Object.defineProperty(this,"id",{value:Ht++}),this.uuid=Es(),this.name="",this.type="BufferGeometry",this.index=null,this.attributes={},this.morphAttributes={},this.morphTargetsRelative=!1,this.groups=[],this.boundingBox=null,this.boundingSphere=null,this.drawRange={start:0,count:1/0},this.userData={}}getIndex(){return this.index}setIndex(o){return Array.isArray(o)?this.index=new(E1(o)?At:g_)(o,1):this.index=o,this}getAttribute(o){return this.attributes[o]}setAttribute(o,g){return this.attributes[o]=g,this}deleteAttribute(o){return delete this.attributes[o],this}hasAttribute(o){return this.attributes[o]!==void 0}addGroup(o,g,$=0){this.groups.push({start:o,count:g,materialIndex:$})}clearGroups(){this.groups=[]}setDrawRange(o,g){this.drawRange.start=o,this.drawRange.count=g}applyMatrix4(o){const g=this.attributes.position;g!==void 0&&(g.applyMatrix4(o),g.needsUpdate=!0);const $=this.attributes.normal;if($!==void 0){const rt=new nu().getNormalMatrix(o);$.applyNormalMatrix(rt),$.needsUpdate=!0}const _e=this.attributes.tangent;return _e!==void 0&&(_e.transformDirection(o),_e.needsUpdate=!0),this.boundingBox!==null&&this.computeBoundingBox(),this.boundingSphere!==null&&this.computeBoundingSphere(),this}applyQuaternion(o){return hn.makeRotationFromQuaternion(o),this.applyMatrix4(hn),this}rotateX(o){return hn.makeRotationX(o),this.applyMatrix4(hn),this}rotateY(o){return hn.makeRotationY(o),this.applyMatrix4(hn),this}rotateZ(o){return hn.makeRotationZ(o),this.applyMatrix4(hn),this}translate(o,g,$){return hn.makeTranslation(o,g,$),this.applyMatrix4(hn),this}scale(o,g,$){return hn.makeScale(o,g,$),this.applyMatrix4(hn),this}lookAt(o){return Rn.lookAt(o),Rn.updateMatrix(),this.applyMatrix4(Rn.matrix),this}center(){return this.computeBoundingBox(),this.boundingBox.getCenter(lr).negate(),this.translate(lr.x,lr.y,lr.z),this}setFromPoints(o){const g=[];for(let $=0,_e=o.length;$<_e;$++){const rt=o[$];g.push(rt.x,rt.y,rt.z||0)}return this.setAttribute("position",new ht(g,3)),this}computeBoundingBox(){this.boundingBox===null&&(this.boundingBox=new Xl);const o=this.attributes.position,g=this.morphAttributes.position;if(o&&o.isGLBufferAttribute)return console.error('THREE.BufferGeometry.computeBoundingBox(): GLBufferAttribute requires a manual bounding box. Alternatively set "mesh.frustumCulled" to "false".',this),void this.boundingBox.set(new fn(-1/0,-1/0,-1/0),new fn(1/0,1/0,1/0));if(o!==void 0){if(this.boundingBox.setFromBufferAttribute(o),g)for(let $=0,_e=g.length;$<_e;$++){const rt=g[$];Nr.setFromBufferAttribute(rt),this.morphTargetsRelative?(ws.addVectors(this.boundingBox.min,Nr.min),this.boundingBox.expandByPoint(ws),ws.addVectors(this.boundingBox.max,Nr.max),this.boundingBox.expandByPoint(ws)):(this.boundingBox.expandByPoint(Nr.min),this.boundingBox.expandByPoint(Nr.max))}}else this.boundingBox.makeEmpty();(isNaN(this.boundingBox.min.x)||isNaN(this.boundingBox.min.y)||isNaN(this.boundingBox.min.z))&&console.error('THREE.BufferGeometry.computeBoundingBox(): Computed min/max have NaN values. The "position" attribute is likely to have NaN values.',this)}computeBoundingSphere(){this.boundingSphere===null&&(this.boundingSphere=new Bv);const o=this.attributes.position,g=this.morphAttributes.position;if(o&&o.isGLBufferAttribute)return console.error('THREE.BufferGeometry.computeBoundingSphere(): GLBufferAttribute requires a manual bounding sphere. Alternatively set "mesh.frustumCulled" to "false".',this),void this.boundingSphere.set(new fn,1/0);if(o){const $=this.boundingSphere.center;if(Nr.setFromBufferAttribute(o),g)for(let rt=0,at=g.length;rt<at;rt++){const ct=g[rt];ds.setFromBufferAttribute(ct),this.morphTargetsRelative?(ws.addVectors(Nr.min,ds.min),Nr.expandByPoint(ws),ws.addVectors(Nr.max,ds.max),Nr.expandByPoint(ws)):(Nr.expandByPoint(ds.min),Nr.expandByPoint(ds.max))}Nr.getCenter($);let _e=0;for(let rt=0,at=o.count;rt<at;rt++)ws.fromBufferAttribute(o,rt),_e=Math.max(_e,$.distanceToSquared(ws));if(g)for(let rt=0,at=g.length;rt<at;rt++){const ct=g[rt],ft=this.morphTargetsRelative;for(let mt=0,bt=ct.count;mt<bt;mt++)ws.fromBufferAttribute(ct,mt),ft&&(lr.fromBufferAttribute(o,mt),ws.add(lr)),_e=Math.max(_e,$.distanceToSquared(ws))}this.boundingSphere.radius=Math.sqrt(_e),isNaN(this.boundingSphere.radius)&&console.error('THREE.BufferGeometry.computeBoundingSphere(): Computed radius is NaN. The "position" attribute is likely to have NaN values.',this)}}computeTangents(){const o=this.index,g=this.attributes;if(o===null||g.position===void 0||g.normal===void 0||g.uv===void 0)return void console.error("THREE.BufferGeometry: .computeTangents() failed. Missing required attributes (index, position, normal or uv)");const $=o.array,_e=g.position.array,rt=g.normal.array,at=g.uv.array,ct=_e.length/3;this.hasAttribute("tangent")===!1&&this.setAttribute("tangent",new Ro(new Float32Array(4*ct),4));const ft=this.getAttribute("tangent").array,mt=[],bt=[];for(let Kn=0;Kn<ct;Kn++)mt[Kn]=new fn,bt[Kn]=new fn;const Tt=new fn,St=new fn,It=new fn,Rt=new Sr,Dt=new Sr,Ft=new Sr,Nt=new fn,zt=new fn;function Xt(Kn,On,_r){Tt.fromArray(_e,3*Kn),St.fromArray(_e,3*On),It.fromArray(_e,3*_r),Rt.fromArray(at,2*Kn),Dt.fromArray(at,2*On),Ft.fromArray(at,2*_r),St.sub(Tt),It.sub(Tt),Dt.sub(Rt),Ft.sub(Rt);const Tr=1/(Dt.x*Ft.y-Ft.x*Dt.y);isFinite(Tr)&&(Nt.copy(St).multiplyScalar(Ft.y).addScaledVector(It,-Dt.y).multiplyScalar(Tr),zt.copy(It).multiplyScalar(Dt.x).addScaledVector(St,-Ft.x).multiplyScalar(Tr),mt[Kn].add(Nt),mt[On].add(Nt),mt[_r].add(Nt),bt[Kn].add(zt),bt[On].add(zt),bt[_r].add(zt))}let tn=this.groups;tn.length===0&&(tn=[{start:0,count:$.length}]);for(let Kn=0,On=tn.length;Kn<On;++Kn){const _r=tn[Kn],Tr=_r.start;for(let gr=Tr,Or=Tr+_r.count;gr<Or;gr+=3)Xt($[gr+0],$[gr+1],$[gr+2])}const sn=new fn,ln=new fn,kn=new fn,Ln=new fn;function qn(Kn){kn.fromArray(rt,3*Kn),Ln.copy(kn);const On=mt[Kn];sn.copy(On),sn.sub(kn.multiplyScalar(kn.dot(On))).normalize(),ln.crossVectors(Ln,On);const _r=ln.dot(bt[Kn])<0?-1:1;ft[4*Kn]=sn.x,ft[4*Kn+1]=sn.y,ft[4*Kn+2]=sn.z,ft[4*Kn+3]=_r}for(let Kn=0,On=tn.length;Kn<On;++Kn){const _r=tn[Kn],Tr=_r.start;for(let gr=Tr,Or=Tr+_r.count;gr<Or;gr+=3)qn($[gr+0]),qn($[gr+1]),qn($[gr+2])}}computeVertexNormals(){const o=this.index,g=this.getAttribute("position");if(g!==void 0){let $=this.getAttribute("normal");if($===void 0)$=new Ro(new Float32Array(3*g.count),3),this.setAttribute("normal",$);else for(let St=0,It=$.count;St<It;St++)$.setXYZ(St,0,0,0);const _e=new fn,rt=new fn,at=new fn,ct=new fn,ft=new fn,mt=new fn,bt=new fn,Tt=new fn;if(o)for(let St=0,It=o.count;St<It;St+=3){const Rt=o.getX(St+0),Dt=o.getX(St+1),Ft=o.getX(St+2);_e.fromBufferAttribute(g,Rt),rt.fromBufferAttribute(g,Dt),at.fromBufferAttribute(g,Ft),bt.subVectors(at,rt),Tt.subVectors(_e,rt),bt.cross(Tt),ct.fromBufferAttribute($,Rt),ft.fromBufferAttribute($,Dt),mt.fromBufferAttribute($,Ft),ct.add(bt),ft.add(bt),mt.add(bt),$.setXYZ(Rt,ct.x,ct.y,ct.z),$.setXYZ(Dt,ft.x,ft.y,ft.z),$.setXYZ(Ft,mt.x,mt.y,mt.z)}else for(let St=0,It=g.count;St<It;St+=3)_e.fromBufferAttribute(g,St+0),rt.fromBufferAttribute(g,St+1),at.fromBufferAttribute(g,St+2),bt.subVectors(at,rt),Tt.subVectors(_e,rt),bt.cross(Tt),$.setXYZ(St+0,bt.x,bt.y,bt.z),$.setXYZ(St+1,bt.x,bt.y,bt.z),$.setXYZ(St+2,bt.x,bt.y,bt.z);this.normalizeNormals(),$.needsUpdate=!0}}merge(){return console.error("THREE.BufferGeometry.merge() has been removed. Use THREE.BufferGeometryUtils.mergeBufferGeometries() instead."),this}normalizeNormals(){const o=this.attributes.normal;for(let g=0,$=o.count;g<$;g++)ws.fromBufferAttribute(o,g),ws.normalize(),o.setXYZ(g,ws.x,ws.y,ws.z)}toNonIndexed(){function o(ct,ft){const mt=ct.array,bt=ct.itemSize,Tt=ct.normalized,St=new mt.constructor(ft.length*bt);let It=0,Rt=0;for(let Dt=0,Ft=ft.length;Dt<Ft;Dt++){It=ct.isInterleavedBufferAttribute?ft[Dt]*ct.data.stride+ct.offset:ft[Dt]*bt;for(let Nt=0;Nt<bt;Nt++)St[Rt++]=mt[It++]}return new Ro(St,bt,Tt)}if(this.index===null)return console.warn("THREE.BufferGeometry.toNonIndexed(): BufferGeometry is already non-indexed."),this;const g=new fs,$=this.index.array,_e=this.attributes;for(const ct in _e){const ft=o(_e[ct],$);g.setAttribute(ct,ft)}const rt=this.morphAttributes;for(const ct in rt){const ft=[],mt=rt[ct];for(let bt=0,Tt=mt.length;bt<Tt;bt++){const St=o(mt[bt],$);ft.push(St)}g.morphAttributes[ct]=ft}g.morphTargetsRelative=this.morphTargetsRelative;const at=this.groups;for(let ct=0,ft=at.length;ct<ft;ct++){const mt=at[ct];g.addGroup(mt.start,mt.count,mt.materialIndex)}return g}toJSON(){const o={metadata:{version:4.5,type:"BufferGeometry",generator:"BufferGeometry.toJSON"}};if(o.uuid=this.uuid,o.type=this.type,this.name!==""&&(o.name=this.name),Object.keys(this.userData).length>0&&(o.userData=this.userData),this.parameters!==void 0){const ft=this.parameters;for(const mt in ft)ft[mt]!==void 0&&(o[mt]=ft[mt]);return o}o.data={attributes:{}};const g=this.index;g!==null&&(o.data.index={type:g.array.constructor.name,array:Array.prototype.slice.call(g.array)});const $=this.attributes;for(const ft in $){const mt=$[ft];o.data.attributes[ft]=mt.toJSON(o.data)}const _e={};let rt=!1;for(const ft in this.morphAttributes){const mt=this.morphAttributes[ft],bt=[];for(let Tt=0,St=mt.length;Tt<St;Tt++){const It=mt[Tt];bt.push(It.toJSON(o.data))}bt.length>0&&(_e[ft]=bt,rt=!0)}rt&&(o.data.morphAttributes=_e,o.data.morphTargetsRelative=this.morphTargetsRelative);const at=this.groups;at.length>0&&(o.data.groups=JSON.parse(JSON.stringify(at)));const ct=this.boundingSphere;return ct!==null&&(o.data.boundingSphere={center:ct.center.toArray(),radius:ct.radius}),o}clone(){return new this.constructor().copy(this)}copy(o){this.index=null,this.attributes={},this.morphAttributes={},this.groups=[],this.boundingBox=null,this.boundingSphere=null;const g={};this.name=o.name;const $=o.index;$!==null&&this.setIndex($.clone(g));const _e=o.attributes;for(const mt in _e){const bt=_e[mt];this.setAttribute(mt,bt.clone(g))}const rt=o.morphAttributes;for(const mt in rt){const bt=[],Tt=rt[mt];for(let St=0,It=Tt.length;St<It;St++)bt.push(Tt[St].clone(g));this.morphAttributes[mt]=bt}this.morphTargetsRelative=o.morphTargetsRelative;const at=o.groups;for(let mt=0,bt=at.length;mt<bt;mt++){const Tt=at[mt];this.addGroup(Tt.start,Tt.count,Tt.materialIndex)}const ct=o.boundingBox;ct!==null&&(this.boundingBox=ct.clone());const ft=o.boundingSphere;return ft!==null&&(this.boundingSphere=ft.clone()),this.drawRange.start=o.drawRange.start,this.drawRange.count=o.drawRange.count,this.userData=o.userData,o.parameters!==void 0&&(this.parameters=Object.assign({},o.parameters)),this}dispose(){this.dispatchEvent({type:"dispose"})}}const Pu=new Os,Bo=new _0,Qp=new Bv,Dp=new fn,Ku=new fn,_l=new fn,Fv=new fn,x0=new fn,jv=new fn,b0=new fn,_A=new fn,Hw=new fn,AA=new Sr,yA=new Sr,Ww=new Sr,R1=new fn,wA=new fn;class Zl extends no{constructor(o=new fs,g=new gm){super(),this.isMesh=!0,this.type="Mesh",this.geometry=o,this.material=g,this.updateMorphTargets()}copy(o,g){return super.copy(o,g),o.morphTargetInfluences!==void 0&&(this.morphTargetInfluences=o.morphTargetInfluences.slice()),o.morphTargetDictionary!==void 0&&(this.morphTargetDictionary=Object.assign({},o.morphTargetDictionary)),this.material=o.material,this.geometry=o.geometry,this}updateMorphTargets(){const o=this.geometry.morphAttributes,g=Object.keys(o);if(g.length>0){const $=o[g[0]];if($!==void 0){this.morphTargetInfluences=[],this.morphTargetDictionary={};for(let _e=0,rt=$.length;_e<rt;_e++){const at=$[_e].name||String(_e);this.morphTargetInfluences.push(0),this.morphTargetDictionary[at]=_e}}}}raycast(o,g){const $=this.geometry,_e=this.material,rt=this.matrixWorld;if(_e===void 0||($.boundingSphere===null&&$.computeBoundingSphere(),Qp.copy($.boundingSphere),Qp.applyMatrix4(rt),o.ray.intersectsSphere(Qp)===!1)||(Pu.copy(rt).invert(),Bo.copy(o.ray).applyMatrix4(Pu),$.boundingBox!==null&&Bo.intersectsBox($.boundingBox)===!1))return;let at;const ct=$.index,ft=$.attributes.position,mt=$.morphAttributes.position,bt=$.morphTargetsRelative,Tt=$.attributes.uv,St=$.attributes.uv2,It=$.groups,Rt=$.drawRange;if(ct!==null)if(Array.isArray(_e))for(let Dt=0,Ft=It.length;Dt<Ft;Dt++){const Nt=It[Dt],zt=_e[Nt.materialIndex];for(let Xt=Math.max(Nt.start,Rt.start),tn=Math.min(ct.count,Math.min(Nt.start+Nt.count,Rt.start+Rt.count));Xt<tn;Xt+=3){const sn=ct.getX(Xt),ln=ct.getX(Xt+1),kn=ct.getX(Xt+2);at=B1(this,zt,o,Bo,ft,mt,bt,Tt,St,sn,ln,kn),at&&(at.faceIndex=Math.floor(Xt/3),at.face.materialIndex=Nt.materialIndex,g.push(at))}}else for(let Dt=Math.max(0,Rt.start),Ft=Math.min(ct.count,Rt.start+Rt.count);Dt<Ft;Dt+=3){const Nt=ct.getX(Dt),zt=ct.getX(Dt+1),Xt=ct.getX(Dt+2);at=B1(this,_e,o,Bo,ft,mt,bt,Tt,St,Nt,zt,Xt),at&&(at.faceIndex=Math.floor(Dt/3),g.push(at))}else if(ft!==void 0)if(Array.isArray(_e))for(let Dt=0,Ft=It.length;Dt<Ft;Dt++){const Nt=It[Dt],zt=_e[Nt.materialIndex];for(let Xt=Math.max(Nt.start,Rt.start),tn=Math.min(ft.count,Math.min(Nt.start+Nt.count,Rt.start+Rt.count));Xt<tn;Xt+=3)at=B1(this,zt,o,Bo,ft,mt,bt,Tt,St,Xt,Xt+1,Xt+2),at&&(at.faceIndex=Math.floor(Xt/3),at.face.materialIndex=Nt.materialIndex,g.push(at))}else for(let Dt=Math.max(0,Rt.start),Ft=Math.min(ft.count,Rt.start+Rt.count);Dt<Ft;Dt+=3)at=B1(this,_e,o,Bo,ft,mt,bt,Tt,St,Dt,Dt+1,Dt+2),at&&(at.faceIndex=Math.floor(Dt/3),g.push(at))}}function B1(dt,o,g,$,_e,rt,at,ct,ft,mt,bt,Tt){Dp.fromBufferAttribute(_e,mt),Ku.fromBufferAttribute(_e,bt),_l.fromBufferAttribute(_e,Tt);const St=dt.morphTargetInfluences;if(rt&&St){b0.set(0,0,0),_A.set(0,0,0),Hw.set(0,0,0);for(let Rt=0,Dt=rt.length;Rt<Dt;Rt++){const Ft=St[Rt],Nt=rt[Rt];Ft!==0&&(Fv.fromBufferAttribute(Nt,mt),x0.fromBufferAttribute(Nt,bt),jv.fromBufferAttribute(Nt,Tt),at?(b0.addScaledVector(Fv,Ft),_A.addScaledVector(x0,Ft),Hw.addScaledVector(jv,Ft)):(b0.addScaledVector(Fv.sub(Dp),Ft),_A.addScaledVector(x0.sub(Ku),Ft),Hw.addScaledVector(jv.sub(_l),Ft)))}Dp.add(b0),Ku.add(_A),_l.add(Hw)}dt.isSkinnedMesh&&(dt.boneTransform(mt,Dp),dt.boneTransform(bt,Ku),dt.boneTransform(Tt,_l));const It=function(Rt,Dt,Ft,Nt,zt,Xt,tn,sn){let ln;if(ln=Dt.side===$t?Nt.intersectTriangle(tn,Xt,zt,!0,sn):Nt.intersectTriangle(zt,Xt,tn,Dt.side!==bn,sn),ln===null)return null;wA.copy(sn),wA.applyMatrix4(Rt.matrixWorld);const kn=Ft.ray.origin.distanceTo(wA);return kn<Ft.near||kn>Ft.far?null:{distance:kn,point:wA.clone(),object:Rt}}(dt,o,g,$,Dp,Ku,_l,R1);if(It){ct&&(AA.fromBufferAttribute(ct,mt),yA.fromBufferAttribute(ct,bt),Ww.fromBufferAttribute(ct,Tt),It.uv=yu.getUV(R1,Dp,Ku,_l,AA,yA,Ww,new Sr)),ft&&(AA.fromBufferAttribute(ft,mt),yA.fromBufferAttribute(ft,bt),Ww.fromBufferAttribute(ft,Tt),It.uv2=yu.getUV(R1,Dp,Ku,_l,AA,yA,Ww,new Sr));const Rt={a:mt,b:bt,c:Tt,normal:new fn,materialIndex:0};yu.getNormal(Dp,Ku,_l,Rt.normal),It.face=Rt}return It}class E0 extends fs{constructor(o=1,g=1,$=1,_e=1,rt=1,at=1){super(),this.type="BoxGeometry",this.parameters={width:o,height:g,depth:$,widthSegments:_e,heightSegments:rt,depthSegments:at};const ct=this;_e=Math.floor(_e),rt=Math.floor(rt),at=Math.floor(at);const ft=[],mt=[],bt=[],Tt=[];let St=0,It=0;function Rt(Dt,Ft,Nt,zt,Xt,tn,sn,ln,kn,Ln,qn){const Kn=tn/kn,On=sn/Ln,_r=tn/2,Tr=sn/2,gr=ln/2,Or=kn+1,Gr=Ln+1;let cr=0,ur=0;const Fr=new fn;for(let Ar=0;Ar<Gr;Ar++){const Qr=Ar*On-Tr;for(let as=0;as<Or;as++){const Qs=as*Kn-_r;Fr[Dt]=Qs*zt,Fr[Ft]=Qr*Xt,Fr[Nt]=gr,mt.push(Fr.x,Fr.y,Fr.z),Fr[Dt]=0,Fr[Ft]=0,Fr[Nt]=ln>0?1:-1,bt.push(Fr.x,Fr.y,Fr.z),Tt.push(as/kn),Tt.push(1-Ar/Ln),cr+=1}}for(let Ar=0;Ar<Ln;Ar++)for(let Qr=0;Qr<kn;Qr++){const as=St+Qr+Or*Ar,Qs=St+Qr+Or*(Ar+1),ys=St+(Qr+1)+Or*(Ar+1),Hs=St+(Qr+1)+Or*Ar;ft.push(as,Qs,Hs),ft.push(Qs,ys,Hs),ur+=6}ct.addGroup(It,ur,qn),It+=ur,St+=cr}Rt("z","y","x",-1,-1,$,g,o,at,rt,0),Rt("z","y","x",1,-1,$,g,-o,at,rt,1),Rt("x","z","y",1,1,o,$,g,_e,at,2),Rt("x","z","y",1,-1,o,$,-g,_e,at,3),Rt("x","y","z",1,-1,o,g,$,_e,rt,4),Rt("x","y","z",-1,-1,o,g,-$,_e,rt,5),this.setIndex(ft),this.setAttribute("position",new ht(mt,3)),this.setAttribute("normal",new ht(bt,3)),this.setAttribute("uv",new ht(Tt,2))}static fromJSON(o){return new E0(o.width,o.height,o.depth,o.widthSegments,o.heightSegments,o.depthSegments)}}function S0(dt){const o={};for(const g in dt){o[g]={};for(const $ in dt[g]){const _e=dt[g][$];_e&&(_e.isColor||_e.isMatrix3||_e.isMatrix4||_e.isVector2||_e.isVector3||_e.isVector4||_e.isTexture||_e.isQuaternion)?o[g][$]=_e.clone():Array.isArray(_e)?o[g][$]=_e.slice():o[g][$]=_e}}return o}function ou(dt){const o={};for(let g=0;g<dt.length;g++){const $=S0(dt[g]);for(const _e in $)o[_e]=$[_e]}return o}const NS={clone:S0,merge:ou};class _m extends Fl{constructor(o){super(),this.isShaderMaterial=!0,this.type="ShaderMaterial",this.defines={},this.uniforms={},this.uniformsGroups=[],this.vertexShader=`void main() {
	gl_Position = projectionMatrix * modelViewMatrix * vec4( position, 1.0 );
}`,this.fragmentShader=`void main() {
	gl_FragColor = vec4( 1.0, 0.0, 0.0, 1.0 );
}`,this.linewidth=1,this.wireframe=!1,this.wireframeLinewidth=1,this.fog=!1,this.lights=!1,this.clipping=!1,this.extensions={derivatives:!1,fragDepth:!1,drawBuffers:!1,shaderTextureLOD:!1},this.defaultAttributeValues={color:[1,1,1],uv:[0,0],uv2:[0,0]},this.index0AttributeName=void 0,this.uniformsNeedUpdate=!1,this.glslVersion=null,o!==void 0&&this.setValues(o)}copy(o){return super.copy(o),this.fragmentShader=o.fragmentShader,this.vertexShader=o.vertexShader,this.uniforms=S0(o.uniforms),this.uniformsGroups=function(g){const $=[];for(let _e=0;_e<g.length;_e++)$.push(g[_e].clone());return $}(o.uniformsGroups),this.defines=Object.assign({},o.defines),this.wireframe=o.wireframe,this.wireframeLinewidth=o.wireframeLinewidth,this.fog=o.fog,this.lights=o.lights,this.clipping=o.clipping,this.extensions=Object.assign({},o.extensions),this.glslVersion=o.glslVersion,this}toJSON(o){const g=super.toJSON(o);g.glslVersion=this.glslVersion,g.uniforms={};for(const _e in this.uniforms){const rt=this.uniforms[_e].value;rt&&rt.isTexture?g.uniforms[_e]={type:"t",value:rt.toJSON(o).uuid}:rt&&rt.isColor?g.uniforms[_e]={type:"c",value:rt.getHex()}:rt&&rt.isVector2?g.uniforms[_e]={type:"v2",value:rt.toArray()}:rt&&rt.isVector3?g.uniforms[_e]={type:"v3",value:rt.toArray()}:rt&&rt.isVector4?g.uniforms[_e]={type:"v4",value:rt.toArray()}:rt&&rt.isMatrix3?g.uniforms[_e]={type:"m3",value:rt.toArray()}:rt&&rt.isMatrix4?g.uniforms[_e]={type:"m4",value:rt.toArray()}:g.uniforms[_e]={value:rt}}Object.keys(this.defines).length>0&&(g.defines=this.defines),g.vertexShader=this.vertexShader,g.fragmentShader=this.fragmentShader;const $={};for(const _e in this.extensions)this.extensions[_e]===!0&&($[_e]=!0);return Object.keys($).length>0&&(g.extensions=$),g}}class xA extends no{constructor(){super(),this.isCamera=!0,this.type="Camera",this.matrixWorldInverse=new Os,this.projectionMatrix=new Os,this.projectionMatrixInverse=new Os}copy(o,g){return super.copy(o,g),this.matrixWorldInverse.copy(o.matrixWorldInverse),this.projectionMatrix.copy(o.projectionMatrix),this.projectionMatrixInverse.copy(o.projectionMatrixInverse),this}getWorldDirection(o){this.updateWorldMatrix(!0,!1);const g=this.matrixWorld.elements;return o.set(-g[8],-g[9],-g[10]).normalize()}updateMatrixWorld(o){super.updateMatrixWorld(o),this.matrixWorldInverse.copy(this.matrixWorld).invert()}updateWorldMatrix(o,g){super.updateWorldMatrix(o,g),this.matrixWorldInverse.copy(this.matrixWorld).invert()}clone(){return new this.constructor().copy(this)}}class wu extends xA{constructor(o=50,g=1,$=.1,_e=2e3){super(),this.isPerspectiveCamera=!0,this.type="PerspectiveCamera",this.fov=o,this.zoom=1,this.near=$,this.far=_e,this.focus=10,this.aspect=g,this.view=null,this.filmGauge=35,this.filmOffset=0,this.updateProjectionMatrix()}copy(o,g){return super.copy(o,g),this.fov=o.fov,this.zoom=o.zoom,this.near=o.near,this.far=o.far,this.focus=o.focus,this.aspect=o.aspect,this.view=o.view===null?null:Object.assign({},o.view),this.filmGauge=o.filmGauge,this.filmOffset=o.filmOffset,this}setFocalLength(o){const g=.5*this.getFilmHeight()/o;this.fov=2*oA*Math.atan(g),this.updateProjectionMatrix()}getFocalLength(){const o=Math.tan(.5*d0*this.fov);return .5*this.getFilmHeight()/o}getEffectiveFOV(){return 2*oA*Math.atan(Math.tan(.5*d0*this.fov)/this.zoom)}getFilmWidth(){return this.filmGauge*Math.min(this.aspect,1)}getFilmHeight(){return this.filmGauge/Math.max(this.aspect,1)}setViewOffset(o,g,$,_e,rt,at){this.aspect=o/g,this.view===null&&(this.view={enabled:!0,fullWidth:1,fullHeight:1,offsetX:0,offsetY:0,width:1,height:1}),this.view.enabled=!0,this.view.fullWidth=o,this.view.fullHeight=g,this.view.offsetX=$,this.view.offsetY=_e,this.view.width=rt,this.view.height=at,this.updateProjectionMatrix()}clearViewOffset(){this.view!==null&&(this.view.enabled=!1),this.updateProjectionMatrix()}updateProjectionMatrix(){const o=this.near;let g=o*Math.tan(.5*d0*this.fov)/this.zoom,$=2*g,_e=this.aspect*$,rt=-.5*_e;const at=this.view;if(this.view!==null&&this.view.enabled){const ft=at.fullWidth,mt=at.fullHeight;rt+=at.offsetX*_e/ft,g-=at.offsetY*$/mt,_e*=at.width/ft,$*=at.height/mt}const ct=this.filmOffset;ct!==0&&(rt+=o*ct/this.getFilmWidth()),this.projectionMatrix.makePerspective(rt,rt+_e,g,g-$,o,this.far),this.projectionMatrixInverse.copy(this.projectionMatrix).invert()}toJSON(o){const g=super.toJSON(o);return g.object.fov=this.fov,g.object.zoom=this.zoom,g.object.near=this.near,g.object.far=this.far,g.object.focus=this.focus,g.object.aspect=this.aspect,this.view!==null&&(g.object.view=Object.assign({},this.view)),g.object.filmGauge=this.filmGauge,g.object.filmOffset=this.filmOffset,g}}const Ry=90;class OM extends no{constructor(o,g,$){super(),this.type="CubeCamera",this.renderTarget=$;const _e=new wu(Ry,1,o,g);_e.layers=this.layers,_e.up.set(0,-1,0),_e.lookAt(new fn(1,0,0)),this.add(_e);const rt=new wu(Ry,1,o,g);rt.layers=this.layers,rt.up.set(0,-1,0),rt.lookAt(new fn(-1,0,0)),this.add(rt);const at=new wu(Ry,1,o,g);at.layers=this.layers,at.up.set(0,0,1),at.lookAt(new fn(0,1,0)),this.add(at);const ct=new wu(Ry,1,o,g);ct.layers=this.layers,ct.up.set(0,0,-1),ct.lookAt(new fn(0,-1,0)),this.add(ct);const ft=new wu(Ry,1,o,g);ft.layers=this.layers,ft.up.set(0,-1,0),ft.lookAt(new fn(0,0,1)),this.add(ft);const mt=new wu(Ry,1,o,g);mt.layers=this.layers,mt.up.set(0,-1,0),mt.lookAt(new fn(0,0,-1)),this.add(mt)}update(o,g){this.parent===null&&this.updateMatrixWorld();const $=this.renderTarget,[_e,rt,at,ct,ft,mt]=this.children,bt=o.getRenderTarget(),Tt=o.toneMapping,St=o.xr.enabled;o.toneMapping=Ks,o.xr.enabled=!1;const It=$.texture.generateMipmaps;$.texture.generateMipmaps=!1,o.setRenderTarget($,0),o.render(g,_e),o.setRenderTarget($,1),o.render(g,rt),o.setRenderTarget($,2),o.render(g,at),o.setRenderTarget($,3),o.render(g,ct),o.setRenderTarget($,4),o.render(g,ft),$.texture.generateMipmaps=It,o.setRenderTarget($,5),o.render(g,mt),o.setRenderTarget(bt),o.toneMapping=Tt,o.xr.enabled=St,$.texture.needsPMREMUpdate=!0}}class qw extends qo{constructor(o,g,$,_e,rt,at,ct,ft,mt,bt){super(o=o!==void 0?o:[],g=g!==void 0?g:$a,$,_e,rt,at,ct,ft,mt,bt),this.isCubeTexture=!0,this.flipY=!1}get images(){return this.image}set images(o){this.image=o}}class k1 extends ap{constructor(o,g={}){super(o,o,g),this.isWebGLCubeRenderTarget=!0;const $={width:o,height:o,depth:1},_e=[$,$,$,$,$,$];this.texture=new qw(_e,g.mapping,g.wrapS,g.wrapT,g.magFilter,g.minFilter,g.format,g.type,g.anisotropy,g.encoding),this.texture.isRenderTargetTexture=!0,this.texture.generateMipmaps=g.generateMipmaps!==void 0&&g.generateMipmaps,this.texture.minFilter=g.minFilter!==void 0?g.minFilter:xa}fromEquirectangularTexture(o,g){this.texture.type=g.type,this.texture.encoding=g.encoding,this.texture.generateMipmaps=g.generateMipmaps,this.texture.minFilter=g.minFilter,this.texture.magFilter=g.magFilter;const $={tEquirect:{value:null}},_e=`

				varying vec3 vWorldDirection;

				vec3 transformDirection( in vec3 dir, in mat4 matrix ) {

					return normalize( ( matrix * vec4( dir, 0.0 ) ).xyz );

				}

				void main() {

					vWorldDirection = transformDirection( position, modelMatrix );

					#include <begin_vertex>
					#include <project_vertex>

				}
			`,rt=`

				uniform sampler2D tEquirect;

				varying vec3 vWorldDirection;

				#include <common>

				void main() {

					vec3 direction = normalize( vWorldDirection );

					vec2 sampleUV = equirectUv( direction );

					gl_FragColor = texture2D( tEquirect, sampleUV );

				}
			`,at=new E0(5,5,5),ct=new _m({name:"CubemapFromEquirect",uniforms:S0($),vertexShader:_e,fragmentShader:rt,side:$t,blending:Ut});ct.uniforms.tEquirect.value=g;const ft=new Zl(at,ct),mt=g.minFilter;return g.minFilter===mo&&(g.minFilter=xa),new OM(1,10,this).update(o,ft),g.minFilter=mt,ft.geometry.dispose(),ft.material.dispose(),this}clear(o,g,$,_e){const rt=o.getRenderTarget();for(let at=0;at<6;at++)o.setRenderTarget(this,at),o.clear(g,$,_e);o.setRenderTarget(rt)}}const O1=new fn,US=new fn,LM=new nu;class C0{constructor(o=new fn(1,0,0),g=0){this.isPlane=!0,this.normal=o,this.constant=g}set(o,g){return this.normal.copy(o),this.constant=g,this}setComponents(o,g,$,_e){return this.normal.set(o,g,$),this.constant=_e,this}setFromNormalAndCoplanarPoint(o,g){return this.normal.copy(o),this.constant=-g.dot(this.normal),this}setFromCoplanarPoints(o,g,$){const _e=O1.subVectors($,g).cross(US.subVectors(o,g)).normalize();return this.setFromNormalAndCoplanarPoint(_e,o),this}copy(o){return this.normal.copy(o.normal),this.constant=o.constant,this}normalize(){const o=1/this.normal.length();return this.normal.multiplyScalar(o),this.constant*=o,this}negate(){return this.constant*=-1,this.normal.negate(),this}distanceToPoint(o){return this.normal.dot(o)+this.constant}distanceToSphere(o){return this.distanceToPoint(o.center)-o.radius}projectPoint(o,g){return g.copy(this.normal).multiplyScalar(-this.distanceToPoint(o)).add(o)}intersectLine(o,g){const $=o.delta(O1),_e=this.normal.dot($);if(_e===0)return this.distanceToPoint(o.start)===0?g.copy(o.start):null;const rt=-(o.start.dot(this.normal)+this.constant)/_e;return rt<0||rt>1?null:g.copy($).multiplyScalar(rt).add(o.start)}intersectsLine(o){const g=this.distanceToPoint(o.start),$=this.distanceToPoint(o.end);return g<0&&$>0||$<0&&g>0}intersectsBox(o){return o.intersectsPlane(this)}intersectsSphere(o){return o.intersectsPlane(this)}coplanarPoint(o){return o.copy(this.normal).multiplyScalar(-this.constant)}applyMatrix4(o,g){const $=g||LM.getNormalMatrix(o),_e=this.coplanarPoint(O1).applyMatrix4(o),rt=this.normal.applyMatrix3($).normalize();return this.constant=-_e.dot(rt),this}translate(o){return this.constant-=o.dot(this.normal),this}equals(o){return o.normal.equals(this.normal)&&o.constant===this.constant}clone(){return new this.constructor().copy(this)}}const By=new Bv,L1=new fn;class Ym{constructor(o=new C0,g=new C0,$=new C0,_e=new C0,rt=new C0,at=new C0){this.planes=[o,g,$,_e,rt,at]}set(o,g,$,_e,rt,at){const ct=this.planes;return ct[0].copy(o),ct[1].copy(g),ct[2].copy($),ct[3].copy(_e),ct[4].copy(rt),ct[5].copy(at),this}copy(o){const g=this.planes;for(let $=0;$<6;$++)g[$].copy(o.planes[$]);return this}setFromProjectionMatrix(o){const g=this.planes,$=o.elements,_e=$[0],rt=$[1],at=$[2],ct=$[3],ft=$[4],mt=$[5],bt=$[6],Tt=$[7],St=$[8],It=$[9],Rt=$[10],Dt=$[11],Ft=$[12],Nt=$[13],zt=$[14],Xt=$[15];return g[0].setComponents(ct-_e,Tt-ft,Dt-St,Xt-Ft).normalize(),g[1].setComponents(ct+_e,Tt+ft,Dt+St,Xt+Ft).normalize(),g[2].setComponents(ct+rt,Tt+mt,Dt+It,Xt+Nt).normalize(),g[3].setComponents(ct-rt,Tt-mt,Dt-It,Xt-Nt).normalize(),g[4].setComponents(ct-at,Tt-bt,Dt-Rt,Xt-zt).normalize(),g[5].setComponents(ct+at,Tt+bt,Dt+Rt,Xt+zt).normalize(),this}intersectsObject(o){const g=o.geometry;return g.boundingSphere===null&&g.computeBoundingSphere(),By.copy(g.boundingSphere).applyMatrix4(o.matrixWorld),this.intersectsSphere(By)}intersectsSprite(o){return By.center.set(0,0,0),By.radius=.7071067811865476,By.applyMatrix4(o.matrixWorld),this.intersectsSphere(By)}intersectsSphere(o){const g=this.planes,$=o.center,_e=-o.radius;for(let rt=0;rt<6;rt++)if(g[rt].distanceToPoint($)<_e)return!1;return!0}intersectsBox(o){const g=this.planes;for(let $=0;$<6;$++){const _e=g[$];if(L1.x=_e.normal.x>0?o.max.x:o.min.x,L1.y=_e.normal.y>0?o.max.y:o.min.y,L1.z=_e.normal.z>0?o.max.z:o.min.z,_e.distanceToPoint(L1)<0)return!1}return!0}containsPoint(o){const g=this.planes;for(let $=0;$<6;$++)if(g[$].distanceToPoint(o)<0)return!1;return!0}clone(){return new this.constructor().copy(this)}}function N1(){let dt=null,o=!1,g=null,$=null;function _e(rt,at){g(rt,at),$=dt.requestAnimationFrame(_e)}return{start:function(){o!==!0&&g!==null&&($=dt.requestAnimationFrame(_e),o=!0)},stop:function(){dt.cancelAnimationFrame($),o=!1},setAnimationLoop:function(rt){g=rt},setContext:function(rt){dt=rt}}}function NM(dt,o){const g=o.isWebGL2,$=new WeakMap;return{get:function(_e){return _e.isInterleavedBufferAttribute&&(_e=_e.data),$.get(_e)},remove:function(_e){_e.isInterleavedBufferAttribute&&(_e=_e.data);const rt=$.get(_e);rt&&(dt.deleteBuffer(rt.buffer),$.delete(_e))},update:function(_e,rt){if(_e.isGLBufferAttribute){const ct=$.get(_e);return void((!ct||ct.version<_e.version)&&$.set(_e,{buffer:_e.buffer,type:_e.type,bytesPerElement:_e.elementSize,version:_e.version}))}_e.isInterleavedBufferAttribute&&(_e=_e.data);const at=$.get(_e);at===void 0?$.set(_e,function(ct,ft){const mt=ct.array,bt=ct.usage,Tt=dt.createBuffer();let St;if(dt.bindBuffer(ft,Tt),dt.bufferData(ft,mt,bt),ct.onUploadCallback(),mt instanceof Float32Array)St=5126;else if(mt instanceof Uint16Array)if(ct.isFloat16BufferAttribute){if(!g)throw new Error("THREE.WebGLAttributes: Usage of Float16BufferAttribute requires WebGL2.");St=5131}else St=5123;else if(mt instanceof Int16Array)St=5122;else if(mt instanceof Uint32Array)St=5125;else if(mt instanceof Int32Array)St=5124;else if(mt instanceof Int8Array)St=5120;else if(mt instanceof Uint8Array)St=5121;else{if(!(mt instanceof Uint8ClampedArray))throw new Error("THREE.WebGLAttributes: Unsupported buffer data format: "+mt);St=5121}return{buffer:Tt,type:St,bytesPerElement:mt.BYTES_PER_ELEMENT,version:ct.version}}(_e,rt)):at.version<_e.version&&(function(ct,ft,mt){const bt=ft.array,Tt=ft.updateRange;dt.bindBuffer(mt,ct),Tt.count===-1?dt.bufferSubData(mt,0,bt):(g?dt.bufferSubData(mt,Tt.offset*bt.BYTES_PER_ELEMENT,bt,Tt.offset,Tt.count):dt.bufferSubData(mt,Tt.offset*bt.BYTES_PER_ELEMENT,bt.subarray(Tt.offset,Tt.offset+Tt.count)),Tt.count=-1)}(at.buffer,_e,rt),at.version=_e.version)}}}class bA extends fs{constructor(o=1,g=1,$=1,_e=1){super(),this.type="PlaneGeometry",this.parameters={width:o,height:g,widthSegments:$,heightSegments:_e};const rt=o/2,at=g/2,ct=Math.floor($),ft=Math.floor(_e),mt=ct+1,bt=ft+1,Tt=o/ct,St=g/ft,It=[],Rt=[],Dt=[],Ft=[];for(let Nt=0;Nt<bt;Nt++){const zt=Nt*St-at;for(let Xt=0;Xt<mt;Xt++){const tn=Xt*Tt-rt;Rt.push(tn,-zt,0),Dt.push(0,0,1),Ft.push(Xt/ct),Ft.push(1-Nt/ft)}}for(let Nt=0;Nt<ft;Nt++)for(let zt=0;zt<ct;zt++){const Xt=zt+mt*Nt,tn=zt+mt*(Nt+1),sn=zt+1+mt*(Nt+1),ln=zt+1+mt*Nt;It.push(Xt,tn,ln),It.push(tn,sn,ln)}this.setIndex(It),this.setAttribute("position",new ht(Rt,3)),this.setAttribute("normal",new ht(Dt,3)),this.setAttribute("uv",new ht(Ft,2))}static fromJSON(o){return new bA(o.width,o.height,o.widthSegments,o.heightSegments)}}const Zs={alphamap_fragment:`#ifdef USE_ALPHAMAP
	#if defined(INVERSE_ALPHAMAP) && INVERSE_ALPHAMAP >= 1
	diffuseColor.a *= 1.0-texture2D( alphaMap, vUv ).g;
	#else
	diffuseColor.a *= texture2D( alphaMap, vUv ).g;
	#endif
#endif`,alphamap_pars_fragment:`#ifdef USE_ALPHAMAP
	uniform sampler2D alphaMap;
#endif`,alphatest_fragment:`#ifdef USE_ALPHATEST
	if ( diffuseColor.a < alphaTest ) discard;
#endif`,alphatest_pars_fragment:`#ifdef USE_ALPHATEST
	uniform float alphaTest;
#endif`,aomap_fragment:`#ifdef USE_AOMAP
	float ambientOcclusion = ( texture2D( aoMap, vUv2 ).r - 1.0 ) * aoMapIntensity + 1.0;
	reflectedLight.indirectDiffuse *= ambientOcclusion;
	#if defined( USE_ENVMAP ) && defined( STANDARD )
		float dotNV = saturate( dot( geometry.normal, geometry.viewDir ) );
		reflectedLight.indirectSpecular *= computeSpecularOcclusion( dotNV, ambientOcclusion, material.roughness );
	#endif
#endif`,aomap_pars_fragment:`#ifdef USE_AOMAP
	uniform sampler2D aoMap;
	uniform float aoMapIntensity;
#endif`,begin_vertex:"vec3 transformed = vec3( position );",beginnormal_vertex:`vec3 objectNormal = vec3( normal );
#ifdef USE_TANGENT
	vec3 objectTangent = vec3( tangent.xyz );
#endif`,bsdfs:`vec3 BRDF_Lambert( const in vec3 diffuseColor ) {
	return RECIPROCAL_PI * diffuseColor;
}
vec3 F_Schlick( const in vec3 f0, const in float f90, const in float dotVH ) {
	float fresnel = exp2( ( - 5.55473 * dotVH - 6.98316 ) * dotVH );
	return f0 * ( 1.0 - fresnel ) + ( f90 * fresnel );
}
float F_Schlick( const in float f0, const in float f90, const in float dotVH ) {
	float fresnel = exp2( ( - 5.55473 * dotVH - 6.98316 ) * dotVH );
	return f0 * ( 1.0 - fresnel ) + ( f90 * fresnel );
}
vec3 Schlick_to_F0( const in vec3 f, const in float f90, const in float dotVH ) {
    float x = clamp( 1.0 - dotVH, 0.0, 1.0 );
    float x2 = x * x;
    float x5 = clamp( x * x2 * x2, 0.0, 0.9999 );
    return ( f - vec3( f90 ) * x5 ) / ( 1.0 - x5 );
}
float V_GGX_SmithCorrelated( const in float alpha, const in float dotNL, const in float dotNV ) {
	float a2 = pow2( alpha );
	float gv = dotNL * sqrt( a2 + ( 1.0 - a2 ) * pow2( dotNV ) );
	float gl = dotNV * sqrt( a2 + ( 1.0 - a2 ) * pow2( dotNL ) );
	return 0.5 / max( gv + gl, EPSILON );
}
float D_GGX( const in float alpha, const in float dotNH ) {
	float a2 = pow2( alpha );
	float denom = pow2( dotNH ) * ( a2 - 1.0 ) + 1.0;
	return RECIPROCAL_PI * a2 / pow2( denom );
}
vec3 BRDF_GGX( const in vec3 lightDir, const in vec3 viewDir, const in vec3 normal, const in vec3 f0, const in float f90, const in float roughness ) {
	float alpha = pow2( roughness );
	vec3 halfDir = normalize( lightDir + viewDir );
	float dotNL = saturate( dot( normal, lightDir ) );
	float dotNV = saturate( dot( normal, viewDir ) );
	float dotNH = saturate( dot( normal, halfDir ) );
	float dotVH = saturate( dot( viewDir, halfDir ) );
	vec3 F = F_Schlick( f0, f90, dotVH );
	float V = V_GGX_SmithCorrelated( alpha, dotNL, dotNV );
	float D = D_GGX( alpha, dotNH );
	return F * ( V * D );
}
#ifdef USE_IRIDESCENCE
	vec3 BRDF_GGX_Iridescence( const in vec3 lightDir, const in vec3 viewDir, const in vec3 normal, const in vec3 f0, const in float f90, const in float iridescence, const in vec3 iridescenceFresnel, const in float roughness ) {
		float alpha = pow2( roughness );
		vec3 halfDir = normalize( lightDir + viewDir );
		float dotNL = saturate( dot( normal, lightDir ) );
		float dotNV = saturate( dot( normal, viewDir ) );
		float dotNH = saturate( dot( normal, halfDir ) );
		float dotVH = saturate( dot( viewDir, halfDir ) );
		vec3 F = mix( F_Schlick( f0, f90, dotVH ), iridescenceFresnel, iridescence );
		float V = V_GGX_SmithCorrelated( alpha, dotNL, dotNV );
		float D = D_GGX( alpha, dotNH );
		return F * ( V * D );
	}
#endif
vec2 LTC_Uv( const in vec3 N, const in vec3 V, const in float roughness ) {
	const float LUT_SIZE = 64.0;
	const float LUT_SCALE = ( LUT_SIZE - 1.0 ) / LUT_SIZE;
	const float LUT_BIAS = 0.5 / LUT_SIZE;
	float dotNV = saturate( dot( N, V ) );
	vec2 uv = vec2( roughness, sqrt( 1.0 - dotNV ) );
	uv = uv * LUT_SCALE + LUT_BIAS;
	return uv;
}
float LTC_ClippedSphereFormFactor( const in vec3 f ) {
	float l = length( f );
	return max( ( l * l + f.z ) / ( l + 1.0 ), 0.0 );
}
vec3 LTC_EdgeVectorFormFactor( const in vec3 v1, const in vec3 v2 ) {
	float x = dot( v1, v2 );
	float y = abs( x );
	float a = 0.8543985 + ( 0.4965155 + 0.0145206 * y ) * y;
	float b = 3.4175940 + ( 4.1616724 + y ) * y;
	float v = a / b;
	float theta_sintheta = ( x > 0.0 ) ? v : 0.5 * inversesqrt( max( 1.0 - x * x, 1e-7 ) ) - v;
	return cross( v1, v2 ) * theta_sintheta;
}
vec3 LTC_Evaluate( const in vec3 N, const in vec3 V, const in vec3 P, const in mat3 mInv, const in vec3 rectCoords[ 4 ] ) {
	vec3 v1 = rectCoords[ 1 ] - rectCoords[ 0 ];
	vec3 v2 = rectCoords[ 3 ] - rectCoords[ 0 ];
	vec3 lightNormal = cross( v1, v2 );
	if( dot( lightNormal, P - rectCoords[ 0 ] ) < 0.0 ) return vec3( 0.0 );
	vec3 T1, T2;
	T1 = normalize( V - N * dot( V, N ) );
	T2 = - cross( N, T1 );
	mat3 mat = mInv * transposeMat3( mat3( T1, T2, N ) );
	vec3 coords[ 4 ];
	coords[ 0 ] = mat * ( rectCoords[ 0 ] - P );
	coords[ 1 ] = mat * ( rectCoords[ 1 ] - P );
	coords[ 2 ] = mat * ( rectCoords[ 2 ] - P );
	coords[ 3 ] = mat * ( rectCoords[ 3 ] - P );
	coords[ 0 ] = normalize( coords[ 0 ] );
	coords[ 1 ] = normalize( coords[ 1 ] );
	coords[ 2 ] = normalize( coords[ 2 ] );
	coords[ 3 ] = normalize( coords[ 3 ] );
	vec3 vectorFormFactor = vec3( 0.0 );
	vectorFormFactor += LTC_EdgeVectorFormFactor( coords[ 0 ], coords[ 1 ] );
	vectorFormFactor += LTC_EdgeVectorFormFactor( coords[ 1 ], coords[ 2 ] );
	vectorFormFactor += LTC_EdgeVectorFormFactor( coords[ 2 ], coords[ 3 ] );
	vectorFormFactor += LTC_EdgeVectorFormFactor( coords[ 3 ], coords[ 0 ] );
	float result = LTC_ClippedSphereFormFactor( vectorFormFactor );
	return vec3( result );
}
float G_BlinnPhong_Implicit( ) {
	return 0.25;
}
float D_BlinnPhong( const in float shininess, const in float dotNH ) {
	return RECIPROCAL_PI * ( shininess * 0.5 + 1.0 ) * pow( dotNH, shininess );
}
vec3 BRDF_BlinnPhong( const in vec3 lightDir, const in vec3 viewDir, const in vec3 normal, const in vec3 specularColor, const in float shininess ) {
	vec3 halfDir = normalize( lightDir + viewDir );
	float dotNH = saturate( dot( normal, halfDir ) );
	float dotVH = saturate( dot( viewDir, halfDir ) );
	vec3 F = F_Schlick( specularColor, 1.0, dotVH );
	float G = G_BlinnPhong_Implicit( );
	float D = D_BlinnPhong( shininess, dotNH );
	return F * ( G * D );
}
#if defined( USE_SHEEN )
float D_Charlie( float roughness, float dotNH ) {
	float alpha = pow2( roughness );
	float invAlpha = 1.0 / alpha;
	float cos2h = dotNH * dotNH;
	float sin2h = max( 1.0 - cos2h, 0.0078125 );
	return ( 2.0 + invAlpha ) * pow( sin2h, invAlpha * 0.5 ) / ( 2.0 * PI );
}
float V_Neubelt( float dotNV, float dotNL ) {
	return saturate( 1.0 / ( 4.0 * ( dotNL + dotNV - dotNL * dotNV ) ) );
}
vec3 BRDF_Sheen( const in vec3 lightDir, const in vec3 viewDir, const in vec3 normal, vec3 sheenColor, const in float sheenRoughness ) {
	vec3 halfDir = normalize( lightDir + viewDir );
	float dotNL = saturate( dot( normal, lightDir ) );
	float dotNV = saturate( dot( normal, viewDir ) );
	float dotNH = saturate( dot( normal, halfDir ) );
	float D = D_Charlie( sheenRoughness, dotNH );
	float V = V_Neubelt( dotNV, dotNL );
	return sheenColor * ( D * V );
}
#endif`,iridescence_fragment:`#ifdef USE_IRIDESCENCE
	const mat3 XYZ_TO_REC709 = mat3(
		 3.2404542, -0.9692660,  0.0556434,
		-1.5371385,  1.8760108, -0.2040259,
		-0.4985314,  0.0415560,  1.0572252
	);
	vec3 Fresnel0ToIor( vec3 fresnel0 ) {
		vec3 sqrtF0 = sqrt( fresnel0 );
		return ( vec3( 1.0 ) + sqrtF0 ) / ( vec3( 1.0 ) - sqrtF0 );
	}
	vec3 IorToFresnel0( vec3 transmittedIor, float incidentIor ) {
		return pow2( ( transmittedIor - vec3( incidentIor ) ) / ( transmittedIor + vec3( incidentIor ) ) );
	}
	float IorToFresnel0( float transmittedIor, float incidentIor ) {
		return pow2( ( transmittedIor - incidentIor ) / ( transmittedIor + incidentIor ));
	}
	vec3 evalSensitivity( float OPD, vec3 shift ) {
		float phase = 2.0 * PI * OPD * 1.0e-9;
		vec3 val = vec3( 5.4856e-13, 4.4201e-13, 5.2481e-13 );
		vec3 pos = vec3( 1.6810e+06, 1.7953e+06, 2.2084e+06 );
		vec3 var = vec3( 4.3278e+09, 9.3046e+09, 6.6121e+09 );
		vec3 xyz = val * sqrt( 2.0 * PI * var ) * cos( pos * phase + shift ) * exp( - pow2( phase ) * var );
		xyz.x += 9.7470e-14 * sqrt( 2.0 * PI * 4.5282e+09 ) * cos( 2.2399e+06 * phase + shift[ 0 ] ) * exp( - 4.5282e+09 * pow2( phase ) );
		xyz /= 1.0685e-7;
		vec3 rgb = XYZ_TO_REC709 * xyz;
		return rgb;
	}
	vec3 evalIridescence( float outsideIOR, float eta2, float cosTheta1, float thinFilmThickness, vec3 baseF0 ) {
		vec3 I;
		float iridescenceIOR = mix( outsideIOR, eta2, smoothstep( 0.0, 0.03, thinFilmThickness ) );
		float sinTheta2Sq = pow2( outsideIOR / iridescenceIOR ) * ( 1.0 - pow2( cosTheta1 ) );
		float cosTheta2Sq = 1.0 - sinTheta2Sq;
		if ( cosTheta2Sq < 0.0 ) {
			 return vec3( 1.0 );
		}
		float cosTheta2 = sqrt( cosTheta2Sq );
		float R0 = IorToFresnel0( iridescenceIOR, outsideIOR );
		float R12 = F_Schlick( R0, 1.0, cosTheta1 );
		float R21 = R12;
		float T121 = 1.0 - R12;
		float phi12 = 0.0;
		if ( iridescenceIOR < outsideIOR ) phi12 = PI;
		float phi21 = PI - phi12;
		vec3 baseIOR = Fresnel0ToIor( clamp( baseF0, 0.0, 0.9999 ) );		vec3 R1 = IorToFresnel0( baseIOR, iridescenceIOR );
		vec3 R23 = F_Schlick( R1, 1.0, cosTheta2 );
		vec3 phi23 = vec3( 0.0 );
		if ( baseIOR[ 0 ] < iridescenceIOR ) phi23[ 0 ] = PI;
		if ( baseIOR[ 1 ] < iridescenceIOR ) phi23[ 1 ] = PI;
		if ( baseIOR[ 2 ] < iridescenceIOR ) phi23[ 2 ] = PI;
		float OPD = 2.0 * iridescenceIOR * thinFilmThickness * cosTheta2;
		vec3 phi = vec3( phi21 ) + phi23;
		vec3 R123 = clamp( R12 * R23, 1e-5, 0.9999 );
		vec3 r123 = sqrt( R123 );
		vec3 Rs = pow2( T121 ) * R23 / ( vec3( 1.0 ) - R123 );
		vec3 C0 = R12 + Rs;
		I = C0;
		vec3 Cm = Rs - T121;
		for ( int m = 1; m <= 2; ++ m ) {
			Cm *= r123;
			vec3 Sm = 2.0 * evalSensitivity( float( m ) * OPD, float( m ) * phi );
			I += Cm * Sm;
		}
		return max( I, vec3( 0.0 ) );
	}
#endif`,bumpmap_pars_fragment:`#ifdef USE_BUMPMAP
	uniform sampler2D bumpMap;
	uniform float bumpScale;
	vec2 dHdxy_fwd() {
		vec2 dSTdx = dFdx( vUv );
		vec2 dSTdy = dFdy( vUv );
		float Hll = bumpScale * texture2D( bumpMap, vUv ).x;
		float dBx = bumpScale * texture2D( bumpMap, vUv + dSTdx ).x - Hll;
		float dBy = bumpScale * texture2D( bumpMap, vUv + dSTdy ).x - Hll;
		return vec2( dBx, dBy );
	}
	vec3 perturbNormalArb( vec3 surf_pos, vec3 surf_norm, vec2 dHdxy, float faceDirection ) {
		vec3 vSigmaX = dFdx( surf_pos.xyz );
		vec3 vSigmaY = dFdy( surf_pos.xyz );
		vec3 vN = surf_norm;
		vec3 R1 = cross( vSigmaY, vN );
		vec3 R2 = cross( vN, vSigmaX );
		float fDet = dot( vSigmaX, R1 ) * faceDirection;
		vec3 vGrad = sign( fDet ) * ( dHdxy.x * R1 + dHdxy.y * R2 );
		return normalize( abs( fDet ) * surf_norm - vGrad );
	}
#endif`,clipping_planes_fragment:`#if NUM_CLIPPING_PLANES > 0
	vec4 plane;
	#pragma unroll_loop_start
	for ( int i = 0; i < UNION_CLIPPING_PLANES; i ++ ) {
		plane = clippingPlanes[ i ];
		if ( dot( vClipPosition, plane.xyz ) > plane.w ) discard;
	}
	#pragma unroll_loop_end
	#if UNION_CLIPPING_PLANES < NUM_CLIPPING_PLANES
		bool clipped = true;
		#pragma unroll_loop_start
		for ( int i = UNION_CLIPPING_PLANES; i < NUM_CLIPPING_PLANES; i ++ ) {
			plane = clippingPlanes[ i ];
			clipped = ( dot( vClipPosition, plane.xyz ) > plane.w ) && clipped;
		}
		#pragma unroll_loop_end
		if ( clipped ) discard;
	#endif
#endif`,clipping_planes_pars_fragment:`#if NUM_CLIPPING_PLANES > 0
	varying vec3 vClipPosition;
	uniform vec4 clippingPlanes[ NUM_CLIPPING_PLANES ];
#endif`,clipping_planes_pars_vertex:`#if NUM_CLIPPING_PLANES > 0
	varying vec3 vClipPosition;
#endif`,clipping_planes_vertex:`#if NUM_CLIPPING_PLANES > 0
	vClipPosition = - mvPosition.xyz;
#endif`,color_fragment:`#if defined( USE_COLOR_ALPHA )
	diffuseColor *= vColor;
#elif defined( USE_COLOR )
	diffuseColor.rgb *= vColor;
#endif`,color_pars_fragment:`#if defined( USE_COLOR_ALPHA )
	varying vec4 vColor;
#elif defined( USE_COLOR )
	varying vec3 vColor;
#endif`,color_pars_vertex:`#if defined( USE_COLOR_ALPHA )
	varying vec4 vColor;
#elif defined( USE_COLOR ) || defined( USE_INSTANCING_COLOR )
	varying vec3 vColor;
#endif`,color_vertex:`#if defined( USE_COLOR_ALPHA )
	vColor = vec4( 1.0 );
#elif defined( USE_COLOR ) || defined( USE_INSTANCING_COLOR )
	vColor = vec3( 1.0 );
#endif
#ifdef USE_COLOR
	vColor *= color;
#endif
#ifdef USE_INSTANCING_COLOR
	vColor.xyz *= instanceColor.xyz;
#endif`,common:`#define PI 3.141592653589793
#define PI2 6.283185307179586
#define PI_HALF 1.5707963267948966
#define RECIPROCAL_PI 0.3183098861837907
#define RECIPROCAL_PI2 0.15915494309189535
#define EPSILON 1e-6
#ifndef saturate
#define saturate( a ) clamp( a, 0.0, 1.0 )
#endif
#define whiteComplement( a ) ( 1.0 - saturate( a ) )
float pow2( const in float x ) { return x*x; }
vec3 pow2( const in vec3 x ) { return x*x; }
float pow3( const in float x ) { return x*x*x; }
float pow4( const in float x ) { float x2 = x*x; return x2*x2; }
float max3( const in vec3 v ) { return max( max( v.x, v.y ), v.z ); }
float average( const in vec3 v ) { return dot( v, vec3( 0.3333333 ) ); }
highp float rand( const in vec2 uv ) {
	const highp float a = 12.9898, b = 78.233, c = 43758.5453;
	highp float dt = dot( uv.xy, vec2( a,b ) ), sn = mod( dt, PI );
	return fract( sin( sn ) * c );
}
#ifdef HIGH_PRECISION
	float precisionSafeLength( vec3 v ) { return length( v ); }
#else
	float precisionSafeLength( vec3 v ) {
		float maxComponent = max3( abs( v ) );
		return length( v / maxComponent ) * maxComponent;
	}
#endif
struct IncidentLight {
	vec3 color;
	vec3 direction;
	bool visible;
};
struct ReflectedLight {
	vec3 directDiffuse;
	vec3 directSpecular;
	vec3 indirectDiffuse;
	vec3 indirectSpecular;
};
struct GeometricContext {
	vec3 position;
	vec3 normal;
	vec3 viewDir;
#ifdef USE_CLEARCOAT
	vec3 clearcoatNormal;
#endif
};
vec3 transformDirection( in vec3 dir, in mat4 matrix ) {
	return normalize( ( matrix * vec4( dir, 0.0 ) ).xyz );
}
vec3 inverseTransformDirection( in vec3 dir, in mat4 matrix ) {
	return normalize( ( vec4( dir, 0.0 ) * matrix ).xyz );
}
mat3 transposeMat3( const in mat3 m ) {
	mat3 tmp;
	tmp[ 0 ] = vec3( m[ 0 ].x, m[ 1 ].x, m[ 2 ].x );
	tmp[ 1 ] = vec3( m[ 0 ].y, m[ 1 ].y, m[ 2 ].y );
	tmp[ 2 ] = vec3( m[ 0 ].z, m[ 1 ].z, m[ 2 ].z );
	return tmp;
}
float luminance( const in vec3 rgb ) {
	const vec3 weights = vec3( 0.2126729, 0.7151522, 0.0721750 );
	return dot( weights, rgb );
}
bool isPerspectiveMatrix( mat4 m ) {
	return m[ 2 ][ 3 ] == - 1.0;
}
vec2 equirectUv( in vec3 dir ) {
	float u = atan( dir.z, dir.x ) * RECIPROCAL_PI2 + 0.5;
	float v = asin( clamp( dir.y, - 1.0, 1.0 ) ) * RECIPROCAL_PI + 0.5;
	return vec2( u, v );
}`,cube_uv_reflection_fragment:`#ifdef ENVMAP_TYPE_CUBE_UV
	#define cubeUV_minMipLevel 4.0
	#define cubeUV_minTileSize 16.0
	float getFace( vec3 direction ) {
		vec3 absDirection = abs( direction );
		float face = - 1.0;
		if ( absDirection.x > absDirection.z ) {
			if ( absDirection.x > absDirection.y )
				face = direction.x > 0.0 ? 0.0 : 3.0;
			else
				face = direction.y > 0.0 ? 1.0 : 4.0;
		} else {
			if ( absDirection.z > absDirection.y )
				face = direction.z > 0.0 ? 2.0 : 5.0;
			else
				face = direction.y > 0.0 ? 1.0 : 4.0;
		}
		return face;
	}
	vec2 getUV( vec3 direction, float face ) {
		vec2 uv;
		if ( face == 0.0 ) {
			uv = vec2( direction.z, direction.y ) / abs( direction.x );
		} else if ( face == 1.0 ) {
			uv = vec2( - direction.x, - direction.z ) / abs( direction.y );
		} else if ( face == 2.0 ) {
			uv = vec2( - direction.x, direction.y ) / abs( direction.z );
		} else if ( face == 3.0 ) {
			uv = vec2( - direction.z, direction.y ) / abs( direction.x );
		} else if ( face == 4.0 ) {
			uv = vec2( - direction.x, direction.z ) / abs( direction.y );
		} else {
			uv = vec2( direction.x, direction.y ) / abs( direction.z );
		}
		return 0.5 * ( uv + 1.0 );
	}
	vec3 bilinearCubeUV( sampler2D envMap, vec3 direction, float mipInt ) {
		float face = getFace( direction );
		float filterInt = max( cubeUV_minMipLevel - mipInt, 0.0 );
		mipInt = max( mipInt, cubeUV_minMipLevel );
		float faceSize = exp2( mipInt );
		vec2 uv = getUV( direction, face ) * ( faceSize - 2.0 ) + 1.0;
		if ( face > 2.0 ) {
			uv.y += faceSize;
			face -= 3.0;
		}
		uv.x += face * faceSize;
		uv.x += filterInt * 3.0 * cubeUV_minTileSize;
		uv.y += 4.0 * ( exp2( CUBEUV_MAX_MIP ) - faceSize );
		uv.x *= CUBEUV_TEXEL_WIDTH;
		uv.y *= CUBEUV_TEXEL_HEIGHT;
		#ifdef texture2DGradEXT
			return texture2DGradEXT( envMap, uv, vec2( 0.0 ), vec2( 0.0 ) ).rgb;
		#else
			return texture2D( envMap, uv ).rgb;
		#endif
	}
	#define cubeUV_r0 1.0
	#define cubeUV_v0 0.339
	#define cubeUV_m0 - 2.0
	#define cubeUV_r1 0.8
	#define cubeUV_v1 0.276
	#define cubeUV_m1 - 1.0
	#define cubeUV_r4 0.4
	#define cubeUV_v4 0.046
	#define cubeUV_m4 2.0
	#define cubeUV_r5 0.305
	#define cubeUV_v5 0.016
	#define cubeUV_m5 3.0
	#define cubeUV_r6 0.21
	#define cubeUV_v6 0.0038
	#define cubeUV_m6 4.0
	float roughnessToMip( float roughness ) {
		float mip = 0.0;
		if ( roughness >= cubeUV_r1 ) {
			mip = ( cubeUV_r0 - roughness ) * ( cubeUV_m1 - cubeUV_m0 ) / ( cubeUV_r0 - cubeUV_r1 ) + cubeUV_m0;
		} else if ( roughness >= cubeUV_r4 ) {
			mip = ( cubeUV_r1 - roughness ) * ( cubeUV_m4 - cubeUV_m1 ) / ( cubeUV_r1 - cubeUV_r4 ) + cubeUV_m1;
		} else if ( roughness >= cubeUV_r5 ) {
			mip = ( cubeUV_r4 - roughness ) * ( cubeUV_m5 - cubeUV_m4 ) / ( cubeUV_r4 - cubeUV_r5 ) + cubeUV_m4;
		} else if ( roughness >= cubeUV_r6 ) {
			mip = ( cubeUV_r5 - roughness ) * ( cubeUV_m6 - cubeUV_m5 ) / ( cubeUV_r5 - cubeUV_r6 ) + cubeUV_m5;
		} else {
			mip = - 2.0 * log2( 1.16 * roughness );		}
		return mip;
	}
	vec4 textureCubeUV( sampler2D envMap, vec3 sampleDir, float roughness ) {
		float mip = clamp( roughnessToMip( roughness ), cubeUV_m0, CUBEUV_MAX_MIP );
		float mipF = fract( mip );
		float mipInt = floor( mip );
		vec3 color0 = bilinearCubeUV( envMap, sampleDir, mipInt );
		if ( mipF == 0.0 ) {
			return vec4( color0, 1.0 );
		} else {
			vec3 color1 = bilinearCubeUV( envMap, sampleDir, mipInt + 1.0 );
			return vec4( mix( color0, color1, mipF ), 1.0 );
		}
	}
#endif`,defaultnormal_vertex:`vec3 transformedNormal = objectNormal;
#ifdef USE_INSTANCING
	mat3 m = mat3( instanceMatrix );
	transformedNormal /= vec3( dot( m[ 0 ], m[ 0 ] ), dot( m[ 1 ], m[ 1 ] ), dot( m[ 2 ], m[ 2 ] ) );
	transformedNormal = m * transformedNormal;
#endif
transformedNormal = normalMatrix * transformedNormal;
#ifdef FLIP_SIDED
	transformedNormal = - transformedNormal;
#endif
#ifdef USE_TANGENT
	vec3 transformedTangent = ( modelViewMatrix * vec4( objectTangent, 0.0 ) ).xyz;
	#ifdef FLIP_SIDED
		transformedTangent = - transformedTangent;
	#endif
#endif`,displacementmap_pars_vertex:`#ifdef USE_DISPLACEMENTMAP
	uniform sampler2D displacementMap;
	uniform float displacementScale;
	uniform float displacementBias;
#endif`,displacementmap_vertex:`#ifdef USE_DISPLACEMENTMAP
	transformed += normalize( objectNormal ) * ( texture2D( displacementMap, vUv ).x * displacementScale + displacementBias );
#endif`,emissivemap_fragment:`#ifdef USE_EMISSIVEMAP
	vec4 emissiveColor = texture2D( emissiveMap, vUv );
	totalEmissiveRadiance *= emissiveColor.rgb;
#endif`,emissivemap_pars_fragment:`#ifdef USE_EMISSIVEMAP
	uniform sampler2D emissiveMap;
#endif`,encodings_fragment:"gl_FragColor = linearToOutputTexel( gl_FragColor );",encodings_pars_fragment:`vec4 LinearToLinear( in vec4 value ) {
	return value;
}
vec4 LinearTosRGB( in vec4 value ) {
	return vec4( mix( pow( value.rgb, vec3( 0.41666 ) ) * 1.055 - vec3( 0.055 ), value.rgb * 12.92, vec3( lessThanEqual( value.rgb, vec3( 0.0031308 ) ) ) ), value.a );
}
vec4 sRGBToLinear( in vec4 value ) {
	return vec4( mix( pow( value.rgb * 0.9478672986 + vec3( 0.0521327014 ), vec3( 2.4 ) ), value.rgb * 0.0773993808, vec3( lessThanEqual( value.rgb, vec3( 0.04045 ) ) ) ), value.a );
}
vec4 RGBMToLinear( in vec4 value, in float maxRange ) {
	return vec4( value.rgb * value.a * maxRange, 1.0 );
}
vec4 LinearToRGBM( in vec4 value, in float maxRange ) {
	float maxRGB = max( value.r, max( value.g, value.b ) );
	float M = clamp( maxRGB / maxRange, 0.0, 1.0 );
	M = ceil( M * 255.0 ) / 255.0;
	return vec4( value.rgb / ( M * maxRange ), M );
}`,envmap_fragment:`#ifdef USE_ENVMAP
	#ifdef ENV_WORLDPOS
		vec3 cameraToFrag;
		if ( isOrthographic ) {
			cameraToFrag = normalize( vec3( - viewMatrix[ 0 ][ 2 ], - viewMatrix[ 1 ][ 2 ], - viewMatrix[ 2 ][ 2 ] ) );
		} else {
			cameraToFrag = normalize( vWorldPosition - cameraPosition );
		}
		vec3 worldNormal = inverseTransformDirection( normal, viewMatrix );
		#ifdef ENVMAP_MODE_REFLECTION
			vec3 reflectVec = reflect( cameraToFrag, worldNormal );
		#else
			vec3 reflectVec = refract( cameraToFrag, worldNormal, refractionRatio );
		#endif
	#else
		vec3 reflectVec = vReflect;
	#endif
	reflectVec = transformDirection1(reflectVec, rotationMatrix(vec3(0,1,0), envMapRotation));
	#ifdef ENVMAP_TYPE_CUBE
		vec4 envColor = textureCube( envMap, vec3( flipEnvMap * reflectVec.x, reflectVec.yz ) );
	#elif defined( ENVMAP_TYPE_CUBE_UV )
		vec4 envColor = textureCubeUV( envMap, reflectVec, 0.0 );
	#else
		vec4 envColor = vec4( 0.0 );
	#endif
	#ifdef ENVMAP_BLENDING_MULTIPLY
		outgoingLight = mix( outgoingLight, outgoingLight * envColor.xyz, specularStrength * reflectivity );
	#elif defined( ENVMAP_BLENDING_MIX )
		outgoingLight = mix( outgoingLight, envColor.xyz, specularStrength * reflectivity );
	#elif defined( ENVMAP_BLENDING_ADD )
		outgoingLight += envColor.xyz * specularStrength * reflectivity;
	#endif
#endif`,envmap_common_pars_fragment:`#ifdef USE_ENVMAP
	vec3 transformDirection1( in vec3 dir, in mat4 matrix ) {
		return normalize( ( matrix * vec4( dir, 0.0 ) ).xyz );
	}
	mat4 rotationMatrix(vec3 axis, float angle) {
		axis = normalize(axis);
		float s = sin(angle);
		float c = cos(angle);
		float oc = 1.0 - c;
		return mat4(oc * axis.x * axis.x + c,           oc * axis.x * axis.y - axis.z * s,  oc * axis.z * axis.x + axis.y * s,  0.0,
					oc * axis.x * axis.y + axis.z * s,  oc * axis.y * axis.y + c,           oc * axis.y * axis.z - axis.x * s,  0.0,
					oc * axis.z * axis.x - axis.y * s,  oc * axis.y * axis.z + axis.x * s,  oc * axis.z * axis.z + c,           0.0,
					0.0,                                0.0,                                0.0,                                1.0);
	}
	uniform float envMapIntensity;
	uniform float flipEnvMap;
	uniform float envMapRotation;
	#ifdef ENVMAP_TYPE_CUBE
		uniform samplerCube envMap;
	#else
		uniform sampler2D envMap;
	#endif
#endif`,envmap_pars_fragment:`#ifdef USE_ENVMAP
	uniform float reflectivity;
	#if defined( USE_BUMPMAP ) || defined( USE_NORMALMAP ) || defined( PHONG ) || defined( LAMBERT )
		#define ENV_WORLDPOS
	#endif
	#ifdef ENV_WORLDPOS
		varying vec3 vWorldPosition;
		uniform float refractionRatio;
	#else
		varying vec3 vReflect;
	#endif
#endif`,envmap_pars_vertex:`#ifdef USE_ENVMAP
	#if defined( USE_BUMPMAP ) || defined( USE_NORMALMAP ) || defined( PHONG ) || defined( LAMBERT )
		#define ENV_WORLDPOS
	#endif
	#ifdef ENV_WORLDPOS
		
		varying vec3 vWorldPosition;
	#else
		varying vec3 vReflect;
		uniform float refractionRatio;
	#endif
#endif`,envmap_physical_pars_fragment:`#if defined( USE_ENVMAP )
	vec3 getIBLIrradiance( const in vec3 normal ) {
		#if defined( ENVMAP_TYPE_CUBE_UV )
			vec3 worldNormal = inverseTransformDirection( normal, viewMatrix );
			worldNormal = transformDirection1(worldNormal, rotationMatrix(vec3(0,1,0), envMapRotation));
			vec4 envMapColor = textureCubeUV( envMap, worldNormal, 1.0 );
			return PI * envMapColor.rgb * envMapIntensity;
		#else
			return vec3( 0.0 );
		#endif
	}
	vec3 getIBLRadiance( const in vec3 viewDir, const in vec3 normal, const in float roughness ) {
		#if defined( ENVMAP_TYPE_CUBE_UV )
			vec3 reflectVec = reflect( - viewDir, normal );
			reflectVec = normalize( mix( reflectVec, normal, roughness * roughness) );
			reflectVec = inverseTransformDirection( reflectVec, viewMatrix );
			reflectVec = transformDirection1(reflectVec, rotationMatrix(vec3(0,1,0), envMapRotation));
			vec4 envMapColor = textureCubeUV( envMap, reflectVec, roughness );
			return envMapColor.rgb * envMapIntensity;
		#else
			return vec3( 0.0 );
		#endif
	}
#endif`,envmap_vertex:`#ifdef USE_ENVMAP
	#ifdef ENV_WORLDPOS
		vWorldPosition = worldPosition.xyz;
	#else
		vec3 cameraToVertex;
		if ( isOrthographic ) {
			cameraToVertex = normalize( vec3( - viewMatrix[ 0 ][ 2 ], - viewMatrix[ 1 ][ 2 ], - viewMatrix[ 2 ][ 2 ] ) );
		} else {
			cameraToVertex = normalize( worldPosition.xyz - cameraPosition );
		}
		vec3 worldNormal = inverseTransformDirection( transformedNormal, viewMatrix );
		#ifdef ENVMAP_MODE_REFLECTION
			vReflect = reflect( cameraToVertex, worldNormal );
		#else
			vReflect = refract( cameraToVertex, worldNormal, refractionRatio );
		#endif
	#endif
#endif`,fog_vertex:`#ifdef USE_FOG
	vFogDepth = - mvPosition.z;
#endif`,fog_pars_vertex:`#ifdef USE_FOG
	varying float vFogDepth;
#endif`,fog_fragment:`#ifdef USE_FOG
	#ifdef FOG_EXP2
		float fogFactor = 1.0 - exp( - fogDensity * fogDensity * vFogDepth * vFogDepth );
	#else
		float fogFactor = smoothstep( fogNear, fogFar, vFogDepth );
	#endif
	gl_FragColor.rgb = mix( gl_FragColor.rgb, fogColor, fogFactor );
#endif`,fog_pars_fragment:`#ifdef USE_FOG
	uniform vec3 fogColor;
	varying float vFogDepth;
	#ifdef FOG_EXP2
		uniform float fogDensity;
	#else
		uniform float fogNear;
		uniform float fogFar;
	#endif
#endif`,gradientmap_pars_fragment:`#ifdef USE_GRADIENTMAP
	uniform sampler2D gradientMap;
#endif
vec3 getGradientIrradiance( vec3 normal, vec3 lightDirection ) {
	float dotNL = dot( normal, lightDirection );
	vec2 coord = vec2( dotNL * 0.5 + 0.5, 0.0 );
	#ifdef USE_GRADIENTMAP
		return vec3( texture2D( gradientMap, coord ).r );
	#else
		vec2 fw = fwidth( coord ) * 0.5;
		return mix( vec3( 0.7 ), vec3( 1.0 ), smoothstep( 0.7 - fw.x, 0.7 + fw.x, coord.x ) );
	#endif
}`,lightmap_fragment:`#ifdef USE_LIGHTMAP
	vec4 lightMapTexel = texture2D( lightMap, vUv2 );
	vec3 lightMapIrradiance = lightMapTexel.rgb * lightMapIntensity;
	reflectedLight.indirectDiffuse += lightMapIrradiance;
#endif`,lightmap_pars_fragment:`#ifdef USE_LIGHTMAP
	uniform sampler2D lightMap;
	uniform float lightMapIntensity;
#endif`,lights_lambert_fragment:`LambertMaterial material;
material.diffuseColor = diffuseColor.rgb;
material.specularStrength = specularStrength;`,lights_lambert_pars_fragment:`varying vec3 vViewPosition;
struct LambertMaterial {
	vec3 diffuseColor;
	float specularStrength;
};
void RE_Direct_Lambert( const in IncidentLight directLight, const in GeometricContext geometry, const in LambertMaterial material, inout ReflectedLight reflectedLight ) {
	float dotNL = saturate( dot( geometry.normal, directLight.direction ) );
	vec3 irradiance = dotNL * directLight.color;
	reflectedLight.directDiffuse += irradiance * BRDF_Lambert( material.diffuseColor );
}
void RE_IndirectDiffuse_Lambert( const in vec3 irradiance, const in GeometricContext geometry, const in LambertMaterial material, inout ReflectedLight reflectedLight ) {
	reflectedLight.indirectDiffuse += irradiance * BRDF_Lambert( material.diffuseColor );
}
#define RE_Direct				RE_Direct_Lambert
#define RE_IndirectDiffuse		RE_IndirectDiffuse_Lambert
#define Material_LightProbeLOD( material )	(0)`,lights_pars_begin:`uniform bool receiveShadow;
uniform vec3 ambientLightColor;
uniform vec3 lightProbe[ 9 ];
vec3 shGetIrradianceAt( in vec3 normal, in vec3 shCoefficients[ 9 ] ) {
	float x = normal.x, y = normal.y, z = normal.z;
	vec3 result = shCoefficients[ 0 ] * 0.886227;
	result += shCoefficients[ 1 ] * 2.0 * 0.511664 * y;
	result += shCoefficients[ 2 ] * 2.0 * 0.511664 * z;
	result += shCoefficients[ 3 ] * 2.0 * 0.511664 * x;
	result += shCoefficients[ 4 ] * 2.0 * 0.429043 * x * y;
	result += shCoefficients[ 5 ] * 2.0 * 0.429043 * y * z;
	result += shCoefficients[ 6 ] * ( 0.743125 * z * z - 0.247708 );
	result += shCoefficients[ 7 ] * 2.0 * 0.429043 * x * z;
	result += shCoefficients[ 8 ] * 0.429043 * ( x * x - y * y );
	return result;
}
vec3 getLightProbeIrradiance( const in vec3 lightProbe[ 9 ], const in vec3 normal ) {
	vec3 worldNormal = inverseTransformDirection( normal, viewMatrix );
	vec3 irradiance = shGetIrradianceAt( worldNormal, lightProbe );
	return irradiance;
}
vec3 getAmbientLightIrradiance( const in vec3 ambientLightColor ) {
	vec3 irradiance = ambientLightColor;
	return irradiance;
}
float getDistanceAttenuation( const in float lightDistance, const in float cutoffDistance, const in float decayExponent ) {
	#if defined ( PHYSICALLY_CORRECT_LIGHTS )
		float distanceFalloff = 1.0 / max( pow( lightDistance, decayExponent ), 0.01 );
		if ( cutoffDistance > 0.0 ) {
			distanceFalloff *= pow2( saturate( 1.0 - pow4( lightDistance / cutoffDistance ) ) );
		}
		return distanceFalloff;
	#else
		if ( cutoffDistance > 0.0 && decayExponent > 0.0 ) {
			return pow( saturate( - lightDistance / cutoffDistance + 1.0 ), decayExponent );
		}
		return 1.0;
	#endif
}
float getSpotAttenuation( const in float coneCosine, const in float penumbraCosine, const in float angleCosine ) {
	return smoothstep( coneCosine, penumbraCosine, angleCosine );
}
#if NUM_DIR_LIGHTS > 0
	struct DirectionalLight {
		vec3 direction;
		vec3 color;
	};
	uniform DirectionalLight directionalLights[ NUM_DIR_LIGHTS ];
	void getDirectionalLightInfo( const in DirectionalLight directionalLight, const in GeometricContext geometry, out IncidentLight light ) {
		light.color = directionalLight.color;
		light.direction = directionalLight.direction;
		light.visible = true;
	}
#endif
#if NUM_POINT_LIGHTS > 0
	struct PointLight {
		vec3 position;
		vec3 color;
		float distance;
		float decay;
	};
	uniform PointLight pointLights[ NUM_POINT_LIGHTS ];
	void getPointLightInfo( const in PointLight pointLight, const in GeometricContext geometry, out IncidentLight light ) {
		vec3 lVector = pointLight.position - geometry.position;
		light.direction = normalize( lVector );
		float lightDistance = length( lVector );
		light.color = pointLight.color;
		light.color *= getDistanceAttenuation( lightDistance, pointLight.distance, pointLight.decay );
		light.visible = ( light.color != vec3( 0.0 ) );
	}
#endif
#if NUM_SPOT_LIGHTS > 0
	struct SpotLight {
		vec3 position;
		vec3 direction;
		vec3 color;
		float distance;
		float decay;
		float coneCos;
		float penumbraCos;
	};
	uniform SpotLight spotLights[ NUM_SPOT_LIGHTS ];
	void getSpotLightInfo( const in SpotLight spotLight, const in GeometricContext geometry, out IncidentLight light ) {
		vec3 lVector = spotLight.position - geometry.position;
		light.direction = normalize( lVector );
		float angleCos = dot( light.direction, spotLight.direction );
		float spotAttenuation = getSpotAttenuation( spotLight.coneCos, spotLight.penumbraCos, angleCos );
		if ( spotAttenuation > 0.0 ) {
			float lightDistance = length( lVector );
			light.color = spotLight.color * spotAttenuation;
			light.color *= getDistanceAttenuation( lightDistance, spotLight.distance, spotLight.decay );
			light.visible = ( light.color != vec3( 0.0 ) );
		} else {
			light.color = vec3( 0.0 );
			light.visible = false;
		}
	}
#endif
#if NUM_RECT_AREA_LIGHTS > 0
	struct RectAreaLight {
		vec3 color;
		vec3 position;
		vec3 halfWidth;
		vec3 halfHeight;
	};
	uniform sampler2D ltc_1;	uniform sampler2D ltc_2;
	uniform RectAreaLight rectAreaLights[ NUM_RECT_AREA_LIGHTS ];
#endif
#if NUM_HEMI_LIGHTS > 0
	struct HemisphereLight {
		vec3 direction;
		vec3 skyColor;
		vec3 groundColor;
	};
	uniform HemisphereLight hemisphereLights[ NUM_HEMI_LIGHTS ];
	vec3 getHemisphereLightIrradiance( const in HemisphereLight hemiLight, const in vec3 normal ) {
		float dotNL = dot( normal, hemiLight.direction );
		float hemiDiffuseWeight = 0.5 * dotNL + 0.5;
		vec3 irradiance = mix( hemiLight.groundColor, hemiLight.skyColor, hemiDiffuseWeight );
		return irradiance;
	}
#endif`,lights_toon_fragment:`ToonMaterial material;
material.diffuseColor = diffuseColor.rgb;`,lights_toon_pars_fragment:`varying vec3 vViewPosition;
struct ToonMaterial {
	vec3 diffuseColor;
};
void RE_Direct_Toon( const in IncidentLight directLight, const in GeometricContext geometry, const in ToonMaterial material, inout ReflectedLight reflectedLight ) {
	vec3 irradiance = getGradientIrradiance( geometry.normal, directLight.direction ) * directLight.color;
	reflectedLight.directDiffuse += irradiance * BRDF_Lambert( material.diffuseColor );
}
void RE_IndirectDiffuse_Toon( const in vec3 irradiance, const in GeometricContext geometry, const in ToonMaterial material, inout ReflectedLight reflectedLight ) {
	reflectedLight.indirectDiffuse += irradiance * BRDF_Lambert( material.diffuseColor );
}
#define RE_Direct				RE_Direct_Toon
#define RE_IndirectDiffuse		RE_IndirectDiffuse_Toon
#define Material_LightProbeLOD( material )	(0)`,lights_phong_fragment:`BlinnPhongMaterial material;
material.diffuseColor = diffuseColor.rgb;
material.specularColor = specular;
material.specularShininess = shininess;
material.specularStrength = specularStrength;`,lights_phong_pars_fragment:`varying vec3 vViewPosition;
struct BlinnPhongMaterial {
	vec3 diffuseColor;
	vec3 specularColor;
	float specularShininess;
	float specularStrength;
};
void RE_Direct_BlinnPhong( const in IncidentLight directLight, const in GeometricContext geometry, const in BlinnPhongMaterial material, inout ReflectedLight reflectedLight ) {
	float dotNL = saturate( dot( geometry.normal, directLight.direction ) );
	vec3 irradiance = dotNL * directLight.color;
	reflectedLight.directDiffuse += irradiance * BRDF_Lambert( material.diffuseColor );
	reflectedLight.directSpecular += irradiance * BRDF_BlinnPhong( directLight.direction, geometry.viewDir, geometry.normal, material.specularColor, material.specularShininess ) * material.specularStrength;
}
void RE_IndirectDiffuse_BlinnPhong( const in vec3 irradiance, const in GeometricContext geometry, const in BlinnPhongMaterial material, inout ReflectedLight reflectedLight ) {
	reflectedLight.indirectDiffuse += irradiance * BRDF_Lambert( material.diffuseColor );
}
#define RE_Direct				RE_Direct_BlinnPhong
#define RE_IndirectDiffuse		RE_IndirectDiffuse_BlinnPhong
#define Material_LightProbeLOD( material )	(0)`,lights_physical_fragment:`PhysicalMaterial material;
material.diffuseColor = diffuseColor.rgb * ( 1.0 - metalnessFactor );
vec3 dxy = max( abs( dFdx( geometryNormal ) ), abs( dFdy( geometryNormal ) ) );
float geometryRoughness = max( max( dxy.x, dxy.y ), dxy.z );
material.roughness = max( roughnessFactor, 0.0525 );material.roughness += geometryRoughness;
material.roughness = min( material.roughness, 1.0 );
#ifdef IOR
	material.ior = ior;
	#ifdef SPECULAR
		float specularIntensityFactor = specularIntensity;
		vec3 specularColorFactor = specularColor;
		#ifdef USE_SPECULARINTENSITYMAP
			specularIntensityFactor *= texture2D( specularIntensityMap, vUv ).a;
		#endif
		#ifdef USE_SPECULARCOLORMAP
			specularColorFactor *= texture2D( specularColorMap, vUv ).rgb;
		#endif
		material.specularF90 = mix( specularIntensityFactor, 1.0, metalnessFactor );
	#else
		float specularIntensityFactor = 1.0;
		vec3 specularColorFactor = vec3( 1.0 );
		material.specularF90 = 1.0;
	#endif
	material.specularColor = mix( min( pow2( ( material.ior - 1.0 ) / ( material.ior + 1.0 ) ) * specularColorFactor, vec3( 1.0 ) ) * specularIntensityFactor, diffuseColor.rgb, metalnessFactor );
#else
	material.specularColor = mix( vec3( 0.04 ), diffuseColor.rgb, metalnessFactor );
	material.specularF90 = 1.0;
#endif
#ifdef USE_CLEARCOAT
	material.clearcoat = clearcoat;
	material.clearcoatRoughness = clearcoatRoughness;
	material.clearcoatF0 = vec3( 0.04 );
	material.clearcoatF90 = 1.0;
	#ifdef USE_CLEARCOATMAP
		material.clearcoat *= texture2D( clearcoatMap, vUv ).x;
	#endif
	#ifdef USE_CLEARCOAT_ROUGHNESSMAP
		material.clearcoatRoughness *= texture2D( clearcoatRoughnessMap, vUv ).y;
	#endif
	material.clearcoat = saturate( material.clearcoat );	material.clearcoatRoughness = max( material.clearcoatRoughness, 0.0525 );
	material.clearcoatRoughness += geometryRoughness;
	material.clearcoatRoughness = min( material.clearcoatRoughness, 1.0 );
#endif
#ifdef USE_IRIDESCENCE
	material.iridescence = iridescence;
	material.iridescenceIOR = iridescenceIOR;
	#ifdef USE_IRIDESCENCEMAP
		material.iridescence *= texture2D( iridescenceMap, vUv ).r;
	#endif
	#ifdef USE_IRIDESCENCE_THICKNESSMAP
		material.iridescenceThickness = (iridescenceThicknessMaximum - iridescenceThicknessMinimum) * texture2D( iridescenceThicknessMap, vUv ).g + iridescenceThicknessMinimum;
	#else
		material.iridescenceThickness = iridescenceThicknessMaximum;
	#endif
#endif
#ifdef USE_SHEEN
	material.sheenColor = sheenColor;
	#ifdef USE_SHEENCOLORMAP
		material.sheenColor *= texture2D( sheenColorMap, vUv ).rgb;
	#endif
	material.sheenRoughness = clamp( sheenRoughness, 0.07, 1.0 );
	#ifdef USE_SHEENROUGHNESSMAP
		material.sheenRoughness *= texture2D( sheenRoughnessMap, vUv ).a;
	#endif
#endif`,lights_physical_pars_fragment:`struct PhysicalMaterial {
	vec3 diffuseColor;
	float roughness;
	vec3 specularColor;
	float specularF90;
	#ifdef USE_CLEARCOAT
		float clearcoat;
		float clearcoatRoughness;
		vec3 clearcoatF0;
		float clearcoatF90;
	#endif
	#ifdef USE_IRIDESCENCE
		float iridescence;
		float iridescenceIOR;
		float iridescenceThickness;
		vec3 iridescenceFresnel;
		vec3 iridescenceF0;
	#endif
	#ifdef USE_SHEEN
		vec3 sheenColor;
		float sheenRoughness;
	#endif
	#ifdef IOR
		float ior;
	#endif
	#ifdef USE_TRANSMISSION
		float transmission;
		float transmissionAlpha;
		float thickness;
		float attenuationDistance;
		vec3 attenuationColor;
	#endif
};
vec3 clearcoatSpecular = vec3( 0.0 );
vec3 sheenSpecular = vec3( 0.0 );
float IBLSheenBRDF( const in vec3 normal, const in vec3 viewDir, const in float roughness ) {
	float dotNV = saturate( dot( normal, viewDir ) );
	float r2 = roughness * roughness;
	float a = roughness < 0.25 ? -339.2 * r2 + 161.4 * roughness - 25.9 : -8.48 * r2 + 14.3 * roughness - 9.95;
	float b = roughness < 0.25 ? 44.0 * r2 - 23.7 * roughness + 3.26 : 1.97 * r2 - 3.27 * roughness + 0.72;
	float DG = exp( a * dotNV + b ) + ( roughness < 0.25 ? 0.0 : 0.1 * ( roughness - 0.25 ) );
	return saturate( DG * RECIPROCAL_PI );
}
vec2 DFGApprox( const in vec3 normal, const in vec3 viewDir, const in float roughness ) {
	float dotNV = saturate( dot( normal, viewDir ) );
	const vec4 c0 = vec4( - 1, - 0.0275, - 0.572, 0.022 );
	const vec4 c1 = vec4( 1, 0.0425, 1.04, - 0.04 );
	vec4 r = roughness * c0 + c1;
	float a004 = min( r.x * r.x, exp2( - 9.28 * dotNV ) ) * r.x + r.y;
	vec2 fab = vec2( - 1.04, 1.04 ) * a004 + r.zw;
	return fab;
}
vec3 EnvironmentBRDF( const in vec3 normal, const in vec3 viewDir, const in vec3 specularColor, const in float specularF90, const in float roughness ) {
	vec2 fab = DFGApprox( normal, viewDir, roughness );
	return specularColor * fab.x + specularF90 * fab.y;
}
#ifdef USE_IRIDESCENCE
void computeMultiscatteringIridescence( const in vec3 normal, const in vec3 viewDir, const in vec3 specularColor, const in float specularF90, const in float iridescence, const in vec3 iridescenceF0, const in float roughness, inout vec3 singleScatter, inout vec3 multiScatter ) {
#else
void computeMultiscattering( const in vec3 normal, const in vec3 viewDir, const in vec3 specularColor, const in float specularF90, const in float roughness, inout vec3 singleScatter, inout vec3 multiScatter ) {
#endif
	vec2 fab = DFGApprox( normal, viewDir, roughness );
	#ifdef USE_IRIDESCENCE
		vec3 Fr = mix( specularColor, iridescenceF0, iridescence );
	#else
		vec3 Fr = specularColor;
	#endif
	vec3 FssEss = Fr * fab.x + specularF90 * fab.y;
	float Ess = fab.x + fab.y;
	float Ems = 1.0 - Ess;
	vec3 Favg = Fr + ( 1.0 - Fr ) * 0.047619;	vec3 Fms = FssEss * Favg / ( 1.0 - Ems * Favg );
	singleScatter += FssEss;
	multiScatter += Fms * Ems;
}
#if NUM_RECT_AREA_LIGHTS > 0
	void RE_Direct_RectArea_Physical( const in RectAreaLight rectAreaLight, const in GeometricContext geometry, const in PhysicalMaterial material, inout ReflectedLight reflectedLight ) {
		vec3 normal = geometry.normal;
		vec3 viewDir = geometry.viewDir;
		vec3 position = geometry.position;
		vec3 lightPos = rectAreaLight.position;
		vec3 halfWidth = rectAreaLight.halfWidth;
		vec3 halfHeight = rectAreaLight.halfHeight;
		vec3 lightColor = rectAreaLight.color;
		float roughness = material.roughness;
		vec3 rectCoords[ 4 ];
		rectCoords[ 0 ] = lightPos + halfWidth - halfHeight;		rectCoords[ 1 ] = lightPos - halfWidth - halfHeight;
		rectCoords[ 2 ] = lightPos - halfWidth + halfHeight;
		rectCoords[ 3 ] = lightPos + halfWidth + halfHeight;
		vec2 uv = LTC_Uv( normal, viewDir, roughness );
		vec4 t1 = texture2D( ltc_1, uv );
		vec4 t2 = texture2D( ltc_2, uv );
		mat3 mInv = mat3(
			vec3( t1.x, 0, t1.y ),
			vec3(    0, 1,    0 ),
			vec3( t1.z, 0, t1.w )
		);
		vec3 fresnel = ( material.specularColor * t2.x + ( vec3( 1.0 ) - material.specularColor ) * t2.y );
		reflectedLight.directSpecular += lightColor * fresnel * LTC_Evaluate( normal, viewDir, position, mInv, rectCoords );
		reflectedLight.directDiffuse += lightColor * material.diffuseColor * LTC_Evaluate( normal, viewDir, position, mat3( 1.0 ), rectCoords );
	}
#endif
void RE_Direct_Physical( const in IncidentLight directLight, const in GeometricContext geometry, const in PhysicalMaterial material, inout ReflectedLight reflectedLight ) {
	float dotNL = saturate( dot( geometry.normal, directLight.direction ) );
	vec3 irradiance = dotNL * directLight.color;
	#ifdef USE_CLEARCOAT
		float dotNLcc = saturate( dot( geometry.clearcoatNormal, directLight.direction ) );
		vec3 ccIrradiance = dotNLcc * directLight.color;
		clearcoatSpecular += ccIrradiance * BRDF_GGX( directLight.direction, geometry.viewDir, geometry.clearcoatNormal, material.clearcoatF0, material.clearcoatF90, material.clearcoatRoughness );
	#endif
	#ifdef USE_SHEEN
		sheenSpecular += irradiance * BRDF_Sheen( directLight.direction, geometry.viewDir, geometry.normal, material.sheenColor, material.sheenRoughness );
	#endif
	#ifdef USE_IRIDESCENCE
		reflectedLight.directSpecular += irradiance * BRDF_GGX_Iridescence( directLight.direction, geometry.viewDir, geometry.normal, material.specularColor, material.specularF90, material.iridescence, material.iridescenceFresnel, material.roughness );
	#else
		reflectedLight.directSpecular += irradiance * BRDF_GGX( directLight.direction, geometry.viewDir, geometry.normal, material.specularColor, material.specularF90, material.roughness );
	#endif
	reflectedLight.directDiffuse += irradiance * BRDF_Lambert( material.diffuseColor );
}
void RE_IndirectDiffuse_Physical( const in vec3 irradiance, const in GeometricContext geometry, const in PhysicalMaterial material, inout ReflectedLight reflectedLight ) {
	reflectedLight.indirectDiffuse += irradiance * BRDF_Lambert( material.diffuseColor );
}
void RE_IndirectSpecular_Physical( const in vec3 radiance, const in vec3 irradiance, const in vec3 clearcoatRadiance, const in GeometricContext geometry, const in PhysicalMaterial material, inout ReflectedLight reflectedLight) {
	#ifdef USE_CLEARCOAT
		clearcoatSpecular += clearcoatRadiance * EnvironmentBRDF( geometry.clearcoatNormal, geometry.viewDir, material.clearcoatF0, material.clearcoatF90, material.clearcoatRoughness );
	#endif
	#ifdef USE_SHEEN
		sheenSpecular += irradiance * material.sheenColor * IBLSheenBRDF( geometry.normal, geometry.viewDir, material.sheenRoughness );
	#endif
	vec3 singleScattering = vec3( 0.0 );
	vec3 multiScattering = vec3( 0.0 );
	vec3 cosineWeightedIrradiance = irradiance * RECIPROCAL_PI;
	#ifdef USE_IRIDESCENCE
		computeMultiscatteringIridescence( geometry.normal, geometry.viewDir, material.specularColor, material.specularF90, material.iridescence, material.iridescenceFresnel, material.roughness, singleScattering, multiScattering );
	#else
		computeMultiscattering( geometry.normal, geometry.viewDir, material.specularColor, material.specularF90, material.roughness, singleScattering, multiScattering );
	#endif
	vec3 totalScattering = singleScattering + multiScattering;
	vec3 diffuse = material.diffuseColor * ( 1.0 - max( max( totalScattering.r, totalScattering.g ), totalScattering.b ) );
	reflectedLight.indirectSpecular += radiance * singleScattering;
	reflectedLight.indirectSpecular += multiScattering * cosineWeightedIrradiance;
	reflectedLight.indirectDiffuse += diffuse * cosineWeightedIrradiance;
}
#define RE_Direct				RE_Direct_Physical
#define RE_Direct_RectArea		RE_Direct_RectArea_Physical
#define RE_IndirectDiffuse		RE_IndirectDiffuse_Physical
#define RE_IndirectSpecular		RE_IndirectSpecular_Physical
float computeSpecularOcclusion( const in float dotNV, const in float ambientOcclusion, const in float roughness ) {
	return saturate( pow( dotNV + ambientOcclusion, exp2( - 16.0 * roughness - 1.0 ) ) - 1.0 + ambientOcclusion );
}`,lights_fragment_begin:`
GeometricContext geometry;
geometry.position = - vViewPosition;
geometry.normal = normal;
geometry.viewDir = ( isOrthographic ) ? vec3( 0, 0, 1 ) : normalize( vViewPosition );
#ifdef USE_CLEARCOAT
	geometry.clearcoatNormal = clearcoatNormal;
#endif
#ifdef USE_IRIDESCENCE
	float dotNVi = saturate( dot( normal, geometry.viewDir ) );
	if ( material.iridescenceThickness == 0.0 ) {
		material.iridescence = 0.0;
	} else {
		material.iridescence = saturate( material.iridescence );
	}
	if ( material.iridescence > 0.0 ) {
		material.iridescenceFresnel = evalIridescence( 1.0, material.iridescenceIOR, dotNVi, material.iridescenceThickness, material.specularColor );
		material.iridescenceF0 = Schlick_to_F0( material.iridescenceFresnel, 1.0, dotNVi );
	}
#endif
IncidentLight directLight;
#if ( NUM_POINT_LIGHTS > 0 ) && defined( RE_Direct )
	PointLight pointLight;
	#if defined( USE_SHADOWMAP ) && NUM_POINT_LIGHT_SHADOWS > 0
	PointLightShadow pointLightShadow;
	#endif
	#pragma unroll_loop_start
	for ( int i = 0; i < NUM_POINT_LIGHTS; i ++ ) {
		pointLight = pointLights[ i ];
		getPointLightInfo( pointLight, geometry, directLight );
		#if defined( USE_SHADOWMAP ) && ( UNROLLED_LOOP_INDEX < NUM_POINT_LIGHT_SHADOWS )
		pointLightShadow = pointLightShadows[ i ];
		directLight.color *= all( bvec2( directLight.visible, receiveShadow ) ) ? getPointShadow( pointShadowMap[ i ], pointLightShadow.shadowMapSize, pointLightShadow.shadowBias, pointLightShadow.shadowRadius, vPointShadowCoord[ i ], pointLightShadow.shadowCameraNear, pointLightShadow.shadowCameraFar ) : 1.0;
		#endif
		RE_Direct( directLight, geometry, material, reflectedLight );
	}
	#pragma unroll_loop_end
#endif
#if ( NUM_SPOT_LIGHTS > 0 ) && defined( RE_Direct )
	SpotLight spotLight;
	vec4 spotColor;
	vec3 spotLightCoord;
	bool inSpotLightMap;
	#if defined( USE_SHADOWMAP ) && NUM_SPOT_LIGHT_SHADOWS > 0
	SpotLightShadow spotLightShadow;
	#endif
	#pragma unroll_loop_start
	for ( int i = 0; i < NUM_SPOT_LIGHTS; i ++ ) {
		spotLight = spotLights[ i ];
		getSpotLightInfo( spotLight, geometry, directLight );
		#if ( UNROLLED_LOOP_INDEX < NUM_SPOT_LIGHT_SHADOWS_WITH_MAPS )
		#define SPOT_LIGHT_MAP_INDEX UNROLLED_LOOP_INDEX
		#elif ( UNROLLED_LOOP_INDEX < NUM_SPOT_LIGHT_SHADOWS )
		#define SPOT_LIGHT_MAP_INDEX NUM_SPOT_LIGHT_MAPS
		#else
		#define SPOT_LIGHT_MAP_INDEX ( UNROLLED_LOOP_INDEX - NUM_SPOT_LIGHT_SHADOWS + NUM_SPOT_LIGHT_SHADOWS_WITH_MAPS )
		#endif
		#if ( SPOT_LIGHT_MAP_INDEX < NUM_SPOT_LIGHT_MAPS )
			spotLightCoord = vSpotLightCoord[ i ].xyz / vSpotLightCoord[ i ].w;
			inSpotLightMap = all( lessThan( abs( spotLightCoord * 2. - 1. ), vec3( 1.0 ) ) );
			spotColor = texture2D( spotLightMap[ SPOT_LIGHT_MAP_INDEX ], spotLightCoord.xy );
			directLight.color = inSpotLightMap ? directLight.color * spotLight.color * spotColor.rgb : directLight.color;
		#endif
		#undef SPOT_LIGHT_MAP_INDEX
		#if defined( USE_SHADOWMAP ) && ( UNROLLED_LOOP_INDEX < NUM_SPOT_LIGHT_SHADOWS )
		spotLightShadow = spotLightShadows[ i ];
		directLight.color *= all( bvec2( directLight.visible, receiveShadow ) ) ? getShadow( spotShadowMap[ i ], spotLightShadow.shadowMapSize, spotLightShadow.shadowBias, spotLightShadow.shadowRadius, vSpotLightCoord[ i ] ) : 1.0;
		#endif
		RE_Direct( directLight, geometry, material, reflectedLight );
	}
	#pragma unroll_loop_end
#endif
#if ( NUM_DIR_LIGHTS > 0 ) && defined( RE_Direct )
	DirectionalLight directionalLight;
	#if defined( USE_SHADOWMAP ) && NUM_DIR_LIGHT_SHADOWS > 0
	DirectionalLightShadow directionalLightShadow;
	#endif
	#pragma unroll_loop_start
	for ( int i = 0; i < NUM_DIR_LIGHTS; i ++ ) {
		directionalLight = directionalLights[ i ];
		getDirectionalLightInfo( directionalLight, geometry, directLight );
		#if defined( USE_SHADOWMAP ) && ( UNROLLED_LOOP_INDEX < NUM_DIR_LIGHT_SHADOWS )
		directionalLightShadow = directionalLightShadows[ i ];
		directLight.color *= all( bvec2( directLight.visible, receiveShadow ) ) ? getShadow( directionalShadowMap[ i ], directionalLightShadow.shadowMapSize, directionalLightShadow.shadowBias, directionalLightShadow.shadowRadius, vDirectionalShadowCoord[ i ] ) : 1.0;
		#endif
		RE_Direct( directLight, geometry, material, reflectedLight );
	}
	#pragma unroll_loop_end
#endif
#if ( NUM_RECT_AREA_LIGHTS > 0 ) && defined( RE_Direct_RectArea )
	RectAreaLight rectAreaLight;
	#pragma unroll_loop_start
	for ( int i = 0; i < NUM_RECT_AREA_LIGHTS; i ++ ) {
		rectAreaLight = rectAreaLights[ i ];
		RE_Direct_RectArea( rectAreaLight, geometry, material, reflectedLight );
	}
	#pragma unroll_loop_end
#endif
#if defined( RE_IndirectDiffuse )
	vec3 iblIrradiance = vec3( 0.0 );
	vec3 irradiance = getAmbientLightIrradiance( ambientLightColor );
	irradiance += getLightProbeIrradiance( lightProbe, geometry.normal );
	#if ( NUM_HEMI_LIGHTS > 0 )
		#pragma unroll_loop_start
		for ( int i = 0; i < NUM_HEMI_LIGHTS; i ++ ) {
			irradiance += getHemisphereLightIrradiance( hemisphereLights[ i ], geometry.normal );
		}
		#pragma unroll_loop_end
	#endif
#endif
#if defined( RE_IndirectSpecular )
	vec3 radiance = vec3( 0.0 );
	vec3 clearcoatRadiance = vec3( 0.0 );
#endif`,lights_fragment_maps:`#if defined( RE_IndirectDiffuse )
	#ifdef USE_LIGHTMAP
		vec4 lightMapTexel = texture2D( lightMap, vUv2 );
		vec3 lightMapIrradiance = lightMapTexel.rgb * lightMapIntensity;
		irradiance += lightMapIrradiance;
	#endif
	#if defined( USE_ENVMAP ) && defined( STANDARD ) && defined( ENVMAP_TYPE_CUBE_UV )
		iblIrradiance += getIBLIrradiance( geometry.normal );
	#endif
#endif
#if defined( USE_ENVMAP ) && defined( RE_IndirectSpecular )
	radiance += getIBLRadiance( geometry.viewDir, geometry.normal, material.roughness );
	#ifdef USE_CLEARCOAT
		clearcoatRadiance += getIBLRadiance( geometry.viewDir, geometry.clearcoatNormal, material.clearcoatRoughness );
	#endif
#endif`,lights_fragment_end:`#if defined( RE_IndirectDiffuse )
	RE_IndirectDiffuse( irradiance, geometry, material, reflectedLight );
#endif
#if defined( RE_IndirectSpecular )
	RE_IndirectSpecular( radiance, iblIrradiance, clearcoatRadiance, geometry, material, reflectedLight );
#endif`,logdepthbuf_fragment:`#if defined( USE_LOGDEPTHBUF ) && defined( USE_LOGDEPTHBUF_EXT )
	gl_FragDepthEXT = vIsPerspective == 0.0 ? gl_FragCoord.z : log2( vFragDepth ) * logDepthBufFC * 0.5;
#endif`,logdepthbuf_pars_fragment:`#if defined( USE_LOGDEPTHBUF ) && defined( USE_LOGDEPTHBUF_EXT )
	uniform float logDepthBufFC;
	varying float vFragDepth;
	varying float vIsPerspective;
#endif`,logdepthbuf_pars_vertex:`#ifdef USE_LOGDEPTHBUF
	#ifdef USE_LOGDEPTHBUF_EXT
		varying float vFragDepth;
		varying float vIsPerspective;
	#else
		uniform float logDepthBufFC;
	#endif
#endif`,logdepthbuf_vertex:`#ifdef USE_LOGDEPTHBUF
	#ifdef USE_LOGDEPTHBUF_EXT
		vFragDepth = 1.0 + gl_Position.w;
		vIsPerspective = float( isPerspectiveMatrix( projectionMatrix ) );
	#else
		if ( isPerspectiveMatrix( projectionMatrix ) ) {
			gl_Position.z = log2( max( EPSILON, gl_Position.w + 1.0 ) ) * logDepthBufFC - 1.0;
			gl_Position.z *= gl_Position.w;
		}
	#endif
#endif`,map_fragment:`#ifdef USE_MAP
	vec4 sampledDiffuseColor = texture2D( map, vUv );
	#ifdef DECODE_VIDEO_TEXTURE
		sampledDiffuseColor = vec4( mix( pow( sampledDiffuseColor.rgb * 0.9478672986 + vec3( 0.0521327014 ), vec3( 2.4 ) ), sampledDiffuseColor.rgb * 0.0773993808, vec3( lessThanEqual( sampledDiffuseColor.rgb, vec3( 0.04045 ) ) ) ), sampledDiffuseColor.w );
	#endif
	diffuseColor *= sampledDiffuseColor;
#endif`,map_pars_fragment:`#ifdef USE_MAP
	uniform sampler2D map;
#endif`,map_particle_fragment:`#if defined( USE_MAP ) || defined( USE_ALPHAMAP )
	vec2 uv = ( uvTransform * vec3( gl_PointCoord.x, 1.0 - gl_PointCoord.y, 1 ) ).xy;
#endif
#ifdef USE_MAP
	diffuseColor *= texture2D( map, uv );
#endif
#ifdef USE_ALPHAMAP
	diffuseColor.a *= texture2D( alphaMap, uv ).g;
#endif`,map_particle_pars_fragment:`#if defined( USE_MAP ) || defined( USE_ALPHAMAP )
	uniform mat3 uvTransform;
#endif
#ifdef USE_MAP
	uniform sampler2D map;
#endif
#ifdef USE_ALPHAMAP
	uniform sampler2D alphaMap;
#endif`,metalnessmap_fragment:`float metalnessFactor = metalness;
#ifdef USE_METALNESSMAP
	vec4 texelMetalness = texture2D( metalnessMap, vUv );
	metalnessFactor *= texelMetalness.b;
#endif`,metalnessmap_pars_fragment:`#ifdef USE_METALNESSMAP
	uniform sampler2D metalnessMap;
#endif`,morphcolor_vertex:`#if defined( USE_MORPHCOLORS ) && defined( MORPHTARGETS_TEXTURE )
	vColor *= morphTargetBaseInfluence;
	for ( int i = 0; i < MORPHTARGETS_COUNT; i ++ ) {
		#if defined( USE_COLOR_ALPHA )
			if ( morphTargetInfluences[ i ] != 0.0 ) vColor += getMorph( gl_VertexID, i, 2 ) * morphTargetInfluences[ i ];
		#elif defined( USE_COLOR )
			if ( morphTargetInfluences[ i ] != 0.0 ) vColor += getMorph( gl_VertexID, i, 2 ).rgb * morphTargetInfluences[ i ];
		#endif
	}
#endif`,morphnormal_vertex:`#ifdef USE_MORPHNORMALS
	objectNormal *= morphTargetBaseInfluence;
	#ifdef MORPHTARGETS_TEXTURE
		for ( int i = 0; i < MORPHTARGETS_COUNT; i ++ ) {
			if ( morphTargetInfluences[ i ] != 0.0 ) objectNormal += getMorph( gl_VertexID, i, 1 ).xyz * morphTargetInfluences[ i ];
		}
	#else
		objectNormal += morphNormal0 * morphTargetInfluences[ 0 ];
		objectNormal += morphNormal1 * morphTargetInfluences[ 1 ];
		objectNormal += morphNormal2 * morphTargetInfluences[ 2 ];
		objectNormal += morphNormal3 * morphTargetInfluences[ 3 ];
	#endif
#endif`,morphtarget_pars_vertex:`#ifdef USE_MORPHTARGETS
	uniform float morphTargetBaseInfluence;
	#ifdef MORPHTARGETS_TEXTURE
		uniform float morphTargetInfluences[ MORPHTARGETS_COUNT ];
		uniform sampler2DArray morphTargetsTexture;
		uniform ivec2 morphTargetsTextureSize;
		vec4 getMorph( const in int vertexIndex, const in int morphTargetIndex, const in int offset ) {
			int texelIndex = vertexIndex * MORPHTARGETS_TEXTURE_STRIDE + offset;
			int y = texelIndex / morphTargetsTextureSize.x;
			int x = texelIndex - y * morphTargetsTextureSize.x;
			ivec3 morphUV = ivec3( x, y, morphTargetIndex );
			return texelFetch( morphTargetsTexture, morphUV, 0 );
		}
	#else
		#ifndef USE_MORPHNORMALS
			uniform float morphTargetInfluences[ 8 ];
		#else
			uniform float morphTargetInfluences[ 4 ];
		#endif
	#endif
#endif`,morphtarget_vertex:`#ifdef USE_MORPHTARGETS
	transformed *= morphTargetBaseInfluence;
	#ifdef MORPHTARGETS_TEXTURE
		for ( int i = 0; i < MORPHTARGETS_COUNT; i ++ ) {
			if ( morphTargetInfluences[ i ] != 0.0 ) transformed += getMorph( gl_VertexID, i, 0 ).xyz * morphTargetInfluences[ i ];
		}
	#else
		transformed += morphTarget0 * morphTargetInfluences[ 0 ];
		transformed += morphTarget1 * morphTargetInfluences[ 1 ];
		transformed += morphTarget2 * morphTargetInfluences[ 2 ];
		transformed += morphTarget3 * morphTargetInfluences[ 3 ];
		#ifndef USE_MORPHNORMALS
			transformed += morphTarget4 * morphTargetInfluences[ 4 ];
			transformed += morphTarget5 * morphTargetInfluences[ 5 ];
			transformed += morphTarget6 * morphTargetInfluences[ 6 ];
			transformed += morphTarget7 * morphTargetInfluences[ 7 ];
		#endif
	#endif
#endif`,normal_fragment_begin:`float faceDirection = gl_FrontFacing ? 1.0 : - 1.0;
#ifdef FLAT_SHADED
	vec3 fdx = vec3( dFdx( vViewPosition.x ), dFdx( vViewPosition.y ), dFdx( vViewPosition.z ) );
	vec3 fdy = vec3( dFdy( vViewPosition.x ), dFdy( vViewPosition.y ), dFdy( vViewPosition.z ) );
	vec3 normal = normalize( cross( fdx, fdy ) );
#else
	vec3 normal = normalize( vNormal );
	#ifdef DOUBLE_SIDED
		normal = normal * faceDirection;
	#endif
	#ifdef USE_TANGENT
		vec3 tangent = normalize( vTangent );
		vec3 bitangent = normalize( vBitangent );
		#ifdef DOUBLE_SIDED
			tangent = tangent * faceDirection;
			bitangent = bitangent * faceDirection;
		#endif
		#if defined( TANGENTSPACE_NORMALMAP ) || defined( USE_CLEARCOAT_NORMALMAP )
			mat3 vTBN = mat3( tangent, bitangent, normal );
		#endif
	#endif
#endif
vec3 geometryNormal = normal;`,normal_fragment_maps:`#ifdef OBJECTSPACE_NORMALMAP
	normal = texture2D( normalMap, vUv ).xyz * 2.0 - 1.0;
	#ifdef FLIP_SIDED
		normal = - normal;
	#endif
	#ifdef DOUBLE_SIDED
		normal = normal * faceDirection;
	#endif
	normal = normalize( normalMatrix * normal );
#elif defined( TANGENTSPACE_NORMALMAP )
	vec3 mapN = texture2D( normalMap, vUv ).xyz * 2.0 - 1.0;
	mapN.xy *= normalScale;
	#ifdef USE_TANGENT
		normal = normalize( vTBN * mapN );
	#else
		normal = perturbNormal2Arb( - vViewPosition, normal, mapN, faceDirection );
	#endif
#elif defined( USE_BUMPMAP )
	normal = perturbNormalArb( - vViewPosition, normal, dHdxy_fwd(), faceDirection );
#endif`,normal_pars_fragment:`#ifndef FLAT_SHADED
	varying vec3 vNormal;
	#ifdef USE_TANGENT
		varying vec3 vTangent;
		varying vec3 vBitangent;
	#endif
#endif`,normal_pars_vertex:`#ifndef FLAT_SHADED
	varying vec3 vNormal;
	#ifdef USE_TANGENT
		varying vec3 vTangent;
		varying vec3 vBitangent;
	#endif
#endif`,normal_vertex:`#ifndef FLAT_SHADED
	vNormal = normalize( transformedNormal );
	#ifdef USE_TANGENT
		vTangent = normalize( transformedTangent );
		vBitangent = normalize( cross( vNormal, vTangent ) * tangent.w );
	#endif
#endif`,normalmap_pars_fragment:`#ifdef USE_NORMALMAP
	uniform sampler2D normalMap;
	uniform vec2 normalScale;
#endif
#ifdef OBJECTSPACE_NORMALMAP
	uniform mat3 normalMatrix;
#endif
#if ! defined ( USE_TANGENT ) && ( defined ( TANGENTSPACE_NORMALMAP ) || defined ( USE_CLEARCOAT_NORMALMAP ) )
	vec3 perturbNormal2Arb( vec3 eye_pos, vec3 surf_norm, vec3 mapN, float faceDirection ) {
		vec3 q0 = dFdx( eye_pos.xyz );
		vec3 q1 = dFdy( eye_pos.xyz );
		vec2 st0 = dFdx( vUv.st );
		vec2 st1 = dFdy( vUv.st );
		vec3 N = surf_norm;
		vec3 q1perp = cross( q1, N );
		vec3 q0perp = cross( N, q0 );
		vec3 T = q1perp * st0.x + q0perp * st1.x;
		vec3 B = q1perp * st0.y + q0perp * st1.y;
		float det = max( dot( T, T ), dot( B, B ) );
		float scale = ( det == 0.0 ) ? 0.0 : faceDirection * inversesqrt( det );
		return normalize( T * ( mapN.x * scale ) + B * ( mapN.y * scale ) + N * mapN.z );
	}
#endif`,clearcoat_normal_fragment_begin:`#ifdef USE_CLEARCOAT
	vec3 clearcoatNormal = geometryNormal;
#endif`,clearcoat_normal_fragment_maps:`#ifdef USE_CLEARCOAT_NORMALMAP
	vec3 clearcoatMapN = texture2D( clearcoatNormalMap, vUv ).xyz * 2.0 - 1.0;
	clearcoatMapN.xy *= clearcoatNormalScale;
	#ifdef USE_TANGENT
		clearcoatNormal = normalize( vTBN * clearcoatMapN );
	#else
		clearcoatNormal = perturbNormal2Arb( - vViewPosition, clearcoatNormal, clearcoatMapN, faceDirection );
	#endif
#endif`,clearcoat_pars_fragment:`#ifdef USE_CLEARCOATMAP
	uniform sampler2D clearcoatMap;
#endif
#ifdef USE_CLEARCOAT_ROUGHNESSMAP
	uniform sampler2D clearcoatRoughnessMap;
#endif
#ifdef USE_CLEARCOAT_NORMALMAP
	uniform sampler2D clearcoatNormalMap;
	uniform vec2 clearcoatNormalScale;
#endif`,iridescence_pars_fragment:`#ifdef USE_IRIDESCENCEMAP
	uniform sampler2D iridescenceMap;
#endif
#ifdef USE_IRIDESCENCE_THICKNESSMAP
	uniform sampler2D iridescenceThicknessMap;
#endif`,output_fragment:`#ifdef OPAQUE
diffuseColor.a = 1.0;
#endif
#ifdef USE_TRANSMISSION
diffuseColor.a *= material.transmissionAlpha + 0.1;
diffuseColor.a = min(max(diffuseColor.a, 0.), 1.);
#endif
gl_FragColor = vec4( outgoingLight, diffuseColor.a );`,packing:`vec3 packNormalToRGB( const in vec3 normal ) {
	return normalize( normal ) * 0.5 + 0.5;
}
vec3 unpackRGBToNormal( const in vec3 rgb ) {
	return 2.0 * rgb.xyz - 1.0;
}
const float PackUpscale = 256. / 255.;const float UnpackDownscale = 255. / 256.;
const vec3 PackFactors = vec3( 256. * 256. * 256., 256. * 256., 256. );
const vec4 UnpackFactors = UnpackDownscale / vec4( PackFactors, 1. );
const float ShiftRight8 = 1. / 256.;
vec4 packDepthToRGBA( const in float v ) {
	vec4 r = vec4( fract( v * PackFactors ), v );
	r.yzw -= r.xyz * ShiftRight8;	return r * PackUpscale;
}
float unpackRGBAToDepth( const in vec4 v ) {
	return dot( v, UnpackFactors );
}
vec4 pack2HalfToRGBA( vec2 v ) {
	vec4 r = vec4( v.x, fract( v.x * 255.0 ), v.y, fract( v.y * 255.0 ) );
	return vec4( r.x - r.y / 255.0, r.y, r.z - r.w / 255.0, r.w );
}
vec2 unpackRGBATo2Half( vec4 v ) {
	return vec2( v.x + ( v.y / 255.0 ), v.z + ( v.w / 255.0 ) );
}
float viewZToOrthographicDepth( const in float viewZ, const in float near, const in float far ) {
	return ( viewZ + near ) / ( near - far );
}
float orthographicDepthToViewZ( const in float linearClipZ, const in float near, const in float far ) {
	return linearClipZ * ( near - far ) - near;
}
float viewZToPerspectiveDepth( const in float viewZ, const in float near, const in float far ) {
	return ( ( near + viewZ ) * far ) / ( ( far - near ) * viewZ );
}
float perspectiveDepthToViewZ( const in float invClipZ, const in float near, const in float far ) {
	return ( near * far ) / ( ( far - near ) * invClipZ - far );
}`,premultiplied_alpha_fragment:`#ifdef PREMULTIPLIED_ALPHA
	gl_FragColor.rgb *= gl_FragColor.a;
#endif`,project_vertex:`vec4 mvPosition = vec4( transformed, 1.0 );
#ifdef USE_INSTANCING
	mvPosition = instanceMatrix * mvPosition;
#endif
mvPosition = modelViewMatrix * mvPosition;
gl_Position = projectionMatrix * mvPosition;`,dithering_fragment:`#ifdef DITHERING
	gl_FragColor.rgb = dithering( gl_FragColor.rgb );
#endif`,dithering_pars_fragment:`#ifdef DITHERING
	vec3 dithering( vec3 color ) {
		float grid_position = rand( gl_FragCoord.xy );
		vec3 dither_shift_RGB = vec3( 0.25 / 255.0, -0.25 / 255.0, 0.25 / 255.0 );
		dither_shift_RGB = mix( 2.0 * dither_shift_RGB, -2.0 * dither_shift_RGB, grid_position );
		return color + dither_shift_RGB;
	}
#endif`,roughnessmap_fragment:`float roughnessFactor = roughness;
#ifdef USE_ROUGHNESSMAP
	vec4 texelRoughness = texture2D( roughnessMap, vUv );
	roughnessFactor *= texelRoughness.g;
#endif`,roughnessmap_pars_fragment:`#ifdef USE_ROUGHNESSMAP
	uniform sampler2D roughnessMap;
#endif`,shadowmap_pars_fragment:`#if NUM_SPOT_LIGHT_COORDS > 0
  varying vec4 vSpotLightCoord[ NUM_SPOT_LIGHT_COORDS ];
#endif
#if NUM_SPOT_LIGHT_MAPS > 0
  uniform sampler2D spotLightMap[ NUM_SPOT_LIGHT_MAPS ];
#endif
#ifdef USE_SHADOWMAP
	#if NUM_DIR_LIGHT_SHADOWS > 0
		uniform sampler2D directionalShadowMap[ NUM_DIR_LIGHT_SHADOWS ];
		varying vec4 vDirectionalShadowCoord[ NUM_DIR_LIGHT_SHADOWS ];
		struct DirectionalLightShadow {
			float shadowBias;
			float shadowNormalBias;
			float shadowRadius;
			vec2 shadowMapSize;
		};
		uniform DirectionalLightShadow directionalLightShadows[ NUM_DIR_LIGHT_SHADOWS ];
	#endif
	#if NUM_SPOT_LIGHT_SHADOWS > 0
		uniform sampler2D spotShadowMap[ NUM_SPOT_LIGHT_SHADOWS ];
		struct SpotLightShadow {
			float shadowBias;
			float shadowNormalBias;
			float shadowRadius;
			vec2 shadowMapSize;
		};
		uniform SpotLightShadow spotLightShadows[ NUM_SPOT_LIGHT_SHADOWS ];
	#endif
	#if NUM_POINT_LIGHT_SHADOWS > 0
		uniform sampler2D pointShadowMap[ NUM_POINT_LIGHT_SHADOWS ];
		varying vec4 vPointShadowCoord[ NUM_POINT_LIGHT_SHADOWS ];
		struct PointLightShadow {
			float shadowBias;
			float shadowNormalBias;
			float shadowRadius;
			vec2 shadowMapSize;
			float shadowCameraNear;
			float shadowCameraFar;
		};
		uniform PointLightShadow pointLightShadows[ NUM_POINT_LIGHT_SHADOWS ];
	#endif
	float texture2DCompare( sampler2D depths, vec2 uv, float compare ) {
		return step( compare, unpackRGBAToDepth( texture2D( depths, uv ) ) );
	}
	vec2 texture2DDistribution( sampler2D shadow, vec2 uv ) {
		return unpackRGBATo2Half( texture2D( shadow, uv ) );
	}
	float VSMShadow (sampler2D shadow, vec2 uv, float compare ){
		float occlusion = 1.0;
		vec2 distribution = texture2DDistribution( shadow, uv );
		float hard_shadow = step( compare , distribution.x );
		if (hard_shadow != 1.0 ) {
			float distance = compare - distribution.x ;
			float variance = max( 0.00000, distribution.y * distribution.y );
			float softness_probability = variance / (variance + distance * distance );			softness_probability = clamp( ( softness_probability - 0.3 ) / ( 0.95 - 0.3 ), 0.0, 1.0 );			occlusion = clamp( max( hard_shadow, softness_probability ), 0.0, 1.0 );
		}
		return occlusion;
	}
	float getShadow( sampler2D shadowMap, vec2 shadowMapSize, float shadowBias, float shadowRadius, vec4 shadowCoord ) {
		float shadow = 1.0;
		shadowCoord.xyz /= shadowCoord.w;
		shadowCoord.z += shadowBias;
		bvec4 inFrustumVec = bvec4 ( shadowCoord.x >= 0.0, shadowCoord.x <= 1.0, shadowCoord.y >= 0.0, shadowCoord.y <= 1.0 );
		bool inFrustum = all( inFrustumVec );
		bvec2 frustumTestVec = bvec2( inFrustum, shadowCoord.z <= 1.0 );
		bool frustumTest = all( frustumTestVec );
		if ( frustumTest ) {
		#if defined( SHADOWMAP_TYPE_PCF )
			vec2 texelSize = vec2( 1.0 ) / shadowMapSize;
			float dx0 = - texelSize.x * shadowRadius;
			float dy0 = - texelSize.y * shadowRadius;
			float dx1 = + texelSize.x * shadowRadius;
			float dy1 = + texelSize.y * shadowRadius;
			float dx2 = dx0 / 2.0;
			float dy2 = dy0 / 2.0;
			float dx3 = dx1 / 2.0;
			float dy3 = dy1 / 2.0;
			shadow = (
				texture2DCompare( shadowMap, shadowCoord.xy + vec2( dx0, dy0 ), shadowCoord.z ) +
				texture2DCompare( shadowMap, shadowCoord.xy + vec2( 0.0, dy0 ), shadowCoord.z ) +
				texture2DCompare( shadowMap, shadowCoord.xy + vec2( dx1, dy0 ), shadowCoord.z ) +
				texture2DCompare( shadowMap, shadowCoord.xy + vec2( dx2, dy2 ), shadowCoord.z ) +
				texture2DCompare( shadowMap, shadowCoord.xy + vec2( 0.0, dy2 ), shadowCoord.z ) +
				texture2DCompare( shadowMap, shadowCoord.xy + vec2( dx3, dy2 ), shadowCoord.z ) +
				texture2DCompare( shadowMap, shadowCoord.xy + vec2( dx0, 0.0 ), shadowCoord.z ) +
				texture2DCompare( shadowMap, shadowCoord.xy + vec2( dx2, 0.0 ), shadowCoord.z ) +
				texture2DCompare( shadowMap, shadowCoord.xy, shadowCoord.z ) +
				texture2DCompare( shadowMap, shadowCoord.xy + vec2( dx3, 0.0 ), shadowCoord.z ) +
				texture2DCompare( shadowMap, shadowCoord.xy + vec2( dx1, 0.0 ), shadowCoord.z ) +
				texture2DCompare( shadowMap, shadowCoord.xy + vec2( dx2, dy3 ), shadowCoord.z ) +
				texture2DCompare( shadowMap, shadowCoord.xy + vec2( 0.0, dy3 ), shadowCoord.z ) +
				texture2DCompare( shadowMap, shadowCoord.xy + vec2( dx3, dy3 ), shadowCoord.z ) +
				texture2DCompare( shadowMap, shadowCoord.xy + vec2( dx0, dy1 ), shadowCoord.z ) +
				texture2DCompare( shadowMap, shadowCoord.xy + vec2( 0.0, dy1 ), shadowCoord.z ) +
				texture2DCompare( shadowMap, shadowCoord.xy + vec2( dx1, dy1 ), shadowCoord.z )
			) * ( 1.0 / 17.0 );
		#elif defined( SHADOWMAP_TYPE_PCF_SOFT )
			vec2 texelSize = vec2( 1.0 ) / shadowMapSize;
			float dx = texelSize.x;
			float dy = texelSize.y;
			vec2 uv = shadowCoord.xy;
			vec2 f = fract( uv * shadowMapSize + 0.5 );
			uv -= f * texelSize;
			shadow = (
				texture2DCompare( shadowMap, uv, shadowCoord.z ) +
				texture2DCompare( shadowMap, uv + vec2( dx, 0.0 ), shadowCoord.z ) +
				texture2DCompare( shadowMap, uv + vec2( 0.0, dy ), shadowCoord.z ) +
				texture2DCompare( shadowMap, uv + texelSize, shadowCoord.z ) +
				mix( texture2DCompare( shadowMap, uv + vec2( -dx, 0.0 ), shadowCoord.z ),
					 texture2DCompare( shadowMap, uv + vec2( 2.0 * dx, 0.0 ), shadowCoord.z ),
					 f.x ) +
				mix( texture2DCompare( shadowMap, uv + vec2( -dx, dy ), shadowCoord.z ),
					 texture2DCompare( shadowMap, uv + vec2( 2.0 * dx, dy ), shadowCoord.z ),
					 f.x ) +
				mix( texture2DCompare( shadowMap, uv + vec2( 0.0, -dy ), shadowCoord.z ),
					 texture2DCompare( shadowMap, uv + vec2( 0.0, 2.0 * dy ), shadowCoord.z ),
					 f.y ) +
				mix( texture2DCompare( shadowMap, uv + vec2( dx, -dy ), shadowCoord.z ),
					 texture2DCompare( shadowMap, uv + vec2( dx, 2.0 * dy ), shadowCoord.z ),
					 f.y ) +
				mix( mix( texture2DCompare( shadowMap, uv + vec2( -dx, -dy ), shadowCoord.z ),
						  texture2DCompare( shadowMap, uv + vec2( 2.0 * dx, -dy ), shadowCoord.z ),
						  f.x ),
					 mix( texture2DCompare( shadowMap, uv + vec2( -dx, 2.0 * dy ), shadowCoord.z ),
						  texture2DCompare( shadowMap, uv + vec2( 2.0 * dx, 2.0 * dy ), shadowCoord.z ),
						  f.x ),
					 f.y )
			) * ( 1.0 / 9.0 );
		#elif defined( SHADOWMAP_TYPE_VSM )
			shadow = VSMShadow( shadowMap, shadowCoord.xy, shadowCoord.z );
		#else
			shadow = texture2DCompare( shadowMap, shadowCoord.xy, shadowCoord.z );
		#endif
		}
		return shadow;
	}
	vec2 cubeToUV( vec3 v, float texelSizeY ) {
		vec3 absV = abs( v );
		float scaleToCube = 1.0 / max( absV.x, max( absV.y, absV.z ) );
		absV *= scaleToCube;
		v *= scaleToCube * ( 1.0 - 2.0 * texelSizeY );
		vec2 planar = v.xy;
		float almostATexel = 1.5 * texelSizeY;
		float almostOne = 1.0 - almostATexel;
		if ( absV.z >= almostOne ) {
			if ( v.z > 0.0 )
				planar.x = 4.0 - v.x;
		} else if ( absV.x >= almostOne ) {
			float signX = sign( v.x );
			planar.x = v.z * signX + 2.0 * signX;
		} else if ( absV.y >= almostOne ) {
			float signY = sign( v.y );
			planar.x = v.x + 2.0 * signY + 2.0;
			planar.y = v.z * signY - 2.0;
		}
		return vec2( 0.125, 0.25 ) * planar + vec2( 0.375, 0.75 );
	}
	float getPointShadow( sampler2D shadowMap, vec2 shadowMapSize, float shadowBias, float shadowRadius, vec4 shadowCoord, float shadowCameraNear, float shadowCameraFar ) {
		vec2 texelSize = vec2( 1.0 ) / ( shadowMapSize * vec2( 4.0, 2.0 ) );
		vec3 lightToPosition = shadowCoord.xyz;
		float dp = ( length( lightToPosition ) - shadowCameraNear ) / ( shadowCameraFar - shadowCameraNear );		dp += shadowBias;
		vec3 bd3D = normalize( lightToPosition );
		#if defined( SHADOWMAP_TYPE_PCF ) || defined( SHADOWMAP_TYPE_PCF_SOFT ) || defined( SHADOWMAP_TYPE_VSM )
			vec2 offset = vec2( - 1, 1 ) * shadowRadius * texelSize.y;
			return (
				texture2DCompare( shadowMap, cubeToUV( bd3D + offset.xyy, texelSize.y ), dp ) +
				texture2DCompare( shadowMap, cubeToUV( bd3D + offset.yyy, texelSize.y ), dp ) +
				texture2DCompare( shadowMap, cubeToUV( bd3D + offset.xyx, texelSize.y ), dp ) +
				texture2DCompare( shadowMap, cubeToUV( bd3D + offset.yyx, texelSize.y ), dp ) +
				texture2DCompare( shadowMap, cubeToUV( bd3D, texelSize.y ), dp ) +
				texture2DCompare( shadowMap, cubeToUV( bd3D + offset.xxy, texelSize.y ), dp ) +
				texture2DCompare( shadowMap, cubeToUV( bd3D + offset.yxy, texelSize.y ), dp ) +
				texture2DCompare( shadowMap, cubeToUV( bd3D + offset.xxx, texelSize.y ), dp ) +
				texture2DCompare( shadowMap, cubeToUV( bd3D + offset.yxx, texelSize.y ), dp )
			) * ( 1.0 / 9.0 );
		#else
			return texture2DCompare( shadowMap, cubeToUV( bd3D, texelSize.y ), dp );
		#endif
	}
#endif`,shadowmap_pars_vertex:`#if NUM_SPOT_LIGHT_COORDS > 0
  uniform mat4 spotLightMatrix[ NUM_SPOT_LIGHT_COORDS ];
  varying vec4 vSpotLightCoord[ NUM_SPOT_LIGHT_COORDS ];
#endif
#ifdef USE_SHADOWMAP
	#if NUM_DIR_LIGHT_SHADOWS > 0
		uniform mat4 directionalShadowMatrix[ NUM_DIR_LIGHT_SHADOWS ];
		varying vec4 vDirectionalShadowCoord[ NUM_DIR_LIGHT_SHADOWS ];
		struct DirectionalLightShadow {
			float shadowBias;
			float shadowNormalBias;
			float shadowRadius;
			vec2 shadowMapSize;
		};
		uniform DirectionalLightShadow directionalLightShadows[ NUM_DIR_LIGHT_SHADOWS ];
	#endif
	#if NUM_SPOT_LIGHT_SHADOWS > 0
		struct SpotLightShadow {
			float shadowBias;
			float shadowNormalBias;
			float shadowRadius;
			vec2 shadowMapSize;
		};
		uniform SpotLightShadow spotLightShadows[ NUM_SPOT_LIGHT_SHADOWS ];
	#endif
	#if NUM_POINT_LIGHT_SHADOWS > 0
		uniform mat4 pointShadowMatrix[ NUM_POINT_LIGHT_SHADOWS ];
		varying vec4 vPointShadowCoord[ NUM_POINT_LIGHT_SHADOWS ];
		struct PointLightShadow {
			float shadowBias;
			float shadowNormalBias;
			float shadowRadius;
			vec2 shadowMapSize;
			float shadowCameraNear;
			float shadowCameraFar;
		};
		uniform PointLightShadow pointLightShadows[ NUM_POINT_LIGHT_SHADOWS ];
	#endif
#endif`,shadowmap_vertex:`#if defined( USE_SHADOWMAP )
	#if NUM_DIR_LIGHT_SHADOWS > 0 || NUM_SPOT_LIGHT_SHADOWS > 0 || NUM_POINT_LIGHT_SHADOWS > 0
		vec3 shadowWorldNormal = inverseTransformDirection( transformedNormal, viewMatrix );
		vec4 shadowWorldPosition;
	#endif
	#if NUM_DIR_LIGHT_SHADOWS > 0
	#pragma unroll_loop_start
	for ( int i = 0; i < NUM_DIR_LIGHT_SHADOWS; i ++ ) {
		shadowWorldPosition = worldPosition + vec4( shadowWorldNormal * directionalLightShadows[ i ].shadowNormalBias, 0 );
		vDirectionalShadowCoord[ i ] = directionalShadowMatrix[ i ] * shadowWorldPosition;
	}
	#pragma unroll_loop_end
	#endif
	#if NUM_SPOT_LIGHT_SHADOWS > 0
	#pragma unroll_loop_start
	for ( int i = 0; i < NUM_SPOT_LIGHT_SHADOWS; i ++ ) {
		shadowWorldPosition = worldPosition;
		#if ( UNROLLED_LOOP_INDEX < NUM_SPOT_LIGHT_SHADOWS )
			shadowWorldPosition.xyz += shadowWorldNormal * spotLightShadows[ i ].shadowNormalBias;
		#endif
		vSpotLightCoord[ i ] = spotLightMatrix[ i ] * shadowWorldPosition;
	}
	#pragma unroll_loop_end
	#endif
	#if NUM_POINT_LIGHT_SHADOWS > 0
	#pragma unroll_loop_start
	for ( int i = 0; i < NUM_POINT_LIGHT_SHADOWS; i ++ ) {
		shadowWorldPosition = worldPosition + vec4( shadowWorldNormal * pointLightShadows[ i ].shadowNormalBias, 0 );
		vPointShadowCoord[ i ] = pointShadowMatrix[ i ] * shadowWorldPosition;
	}
	#pragma unroll_loop_end
	#endif
#endif`,shadowmask_pars_fragment:`float getShadowMask() {
	float shadow = 1.0;
	#ifdef USE_SHADOWMAP
	#if NUM_DIR_LIGHT_SHADOWS > 0
	DirectionalLightShadow directionalLight;
	#pragma unroll_loop_start
	for ( int i = 0; i < NUM_DIR_LIGHT_SHADOWS; i ++ ) {
		directionalLight = directionalLightShadows[ i ];
		shadow *= receiveShadow ? getShadow( directionalShadowMap[ i ], directionalLight.shadowMapSize, directionalLight.shadowBias, directionalLight.shadowRadius, vDirectionalShadowCoord[ i ] ) : 1.0;
	}
	#pragma unroll_loop_end
	#endif
	#if NUM_SPOT_LIGHT_SHADOWS > 0
	SpotLightShadow spotLight;
	#pragma unroll_loop_start
	for ( int i = 0; i < NUM_SPOT_LIGHT_SHADOWS; i ++ ) {
		spotLight = spotLightShadows[ i ];
		shadow *= receiveShadow ? getShadow( spotShadowMap[ i ], spotLight.shadowMapSize, spotLight.shadowBias, spotLight.shadowRadius, vSpotLightCoord[ i ] ) : 1.0;
	}
	#pragma unroll_loop_end
	#endif
	#if NUM_POINT_LIGHT_SHADOWS > 0
	PointLightShadow pointLight;
	#pragma unroll_loop_start
	for ( int i = 0; i < NUM_POINT_LIGHT_SHADOWS; i ++ ) {
		pointLight = pointLightShadows[ i ];
		shadow *= receiveShadow ? getPointShadow( pointShadowMap[ i ], pointLight.shadowMapSize, pointLight.shadowBias, pointLight.shadowRadius, vPointShadowCoord[ i ], pointLight.shadowCameraNear, pointLight.shadowCameraFar ) : 1.0;
	}
	#pragma unroll_loop_end
	#endif
	#endif
	return shadow;
}`,skinbase_vertex:`#ifdef USE_SKINNING
	mat4 boneMatX = getBoneMatrix( skinIndex.x );
	mat4 boneMatY = getBoneMatrix( skinIndex.y );
	mat4 boneMatZ = getBoneMatrix( skinIndex.z );
	mat4 boneMatW = getBoneMatrix( skinIndex.w );
#endif`,skinning_pars_vertex:`#ifdef USE_SKINNING
	uniform mat4 bindMatrix;
	uniform mat4 bindMatrixInverse;
	uniform highp sampler2D boneTexture;
	uniform int boneTextureSize;
	mat4 getBoneMatrix( const in float i ) {
		float j = i * 4.0;
		float x = mod( j, float( boneTextureSize ) );
		float y = floor( j / float( boneTextureSize ) );
		float dx = 1.0 / float( boneTextureSize );
		float dy = 1.0 / float( boneTextureSize );
		y = dy * ( y + 0.5 );
		vec4 v1 = texture2D( boneTexture, vec2( dx * ( x + 0.5 ), y ) );
		vec4 v2 = texture2D( boneTexture, vec2( dx * ( x + 1.5 ), y ) );
		vec4 v3 = texture2D( boneTexture, vec2( dx * ( x + 2.5 ), y ) );
		vec4 v4 = texture2D( boneTexture, vec2( dx * ( x + 3.5 ), y ) );
		mat4 bone = mat4( v1, v2, v3, v4 );
		return bone;
	}
#endif`,skinning_vertex:`#ifdef USE_SKINNING
	vec4 skinVertex = bindMatrix * vec4( transformed, 1.0 );
	vec4 skinned = vec4( 0.0 );
	skinned += boneMatX * skinVertex * skinWeight.x;
	skinned += boneMatY * skinVertex * skinWeight.y;
	skinned += boneMatZ * skinVertex * skinWeight.z;
	skinned += boneMatW * skinVertex * skinWeight.w;
	transformed = ( bindMatrixInverse * skinned ).xyz;
#endif`,skinnormal_vertex:`#ifdef USE_SKINNING
	mat4 skinMatrix = mat4( 0.0 );
	skinMatrix += skinWeight.x * boneMatX;
	skinMatrix += skinWeight.y * boneMatY;
	skinMatrix += skinWeight.z * boneMatZ;
	skinMatrix += skinWeight.w * boneMatW;
	skinMatrix = bindMatrixInverse * skinMatrix * bindMatrix;
	objectNormal = vec4( skinMatrix * vec4( objectNormal, 0.0 ) ).xyz;
	#ifdef USE_TANGENT
		objectTangent = vec4( skinMatrix * vec4( objectTangent, 0.0 ) ).xyz;
	#endif
#endif`,specularmap_fragment:`float specularStrength;
#ifdef USE_SPECULARMAP
	vec4 texelSpecular = texture2D( specularMap, vUv );
	specularStrength = texelSpecular.r;
#else
	specularStrength = 1.0;
#endif`,specularmap_pars_fragment:`#ifdef USE_SPECULARMAP
	uniform sampler2D specularMap;
#endif`,tonemapping_fragment:`#if defined( TONE_MAPPING )
	gl_FragColor.rgb = toneMapping( gl_FragColor.rgb );
#endif`,tonemapping_pars_fragment:`#ifndef saturate
#define saturate( a ) clamp( a, 0.0, 1.0 )
#endif
uniform float toneMappingExposure;
vec3 LinearToneMapping( vec3 color ) {
	return toneMappingExposure * color;
}
vec3 ReinhardToneMapping( vec3 color ) {
	color *= toneMappingExposure;
	return saturate( color / ( vec3( 1.0 ) + color ) );
}
vec3 OptimizedCineonToneMapping( vec3 color ) {
	color *= toneMappingExposure;
	color = max( vec3( 0.0 ), color - 0.004 );
	return pow( ( color * ( 6.2 * color + 0.5 ) ) / ( color * ( 6.2 * color + 1.7 ) + 0.06 ), vec3( 2.2 ) );
}
vec3 RRTAndODTFit( vec3 v ) {
	vec3 a = v * ( v + 0.0245786 ) - 0.000090537;
	vec3 b = v * ( 0.983729 * v + 0.4329510 ) + 0.238081;
	return a / b;
}
vec3 ACESFilmicToneMapping( vec3 color ) {
	const mat3 ACESInputMat = mat3(
		vec3( 0.59719, 0.07600, 0.02840 ),		vec3( 0.35458, 0.90834, 0.13383 ),
		vec3( 0.04823, 0.01566, 0.83777 )
	);
	const mat3 ACESOutputMat = mat3(
		vec3(  1.60475, -0.10208, -0.00327 ),		vec3( -0.53108,  1.10813, -0.07276 ),
		vec3( -0.07367, -0.00605,  1.07602 )
	);
	color *= toneMappingExposure / 0.6;
	color = ACESInputMat * color;
	color = RRTAndODTFit( color );
	color = ACESOutputMat * color;
	return saturate( color );
}
vec3 CustomToneMapping( vec3 color ) { return color; }`,transmission_fragment:`#ifdef USE_TRANSMISSION
	material.transmission = transmission;
	material.transmissionAlpha = 1.0;
	material.thickness = thickness;
	material.attenuationDistance = attenuationDistance;
	material.attenuationColor = attenuationColor;
	#ifdef USE_TRANSMISSIONMAP
		material.transmission *= texture2D( transmissionMap, vUv ).r;
	#endif
	#ifdef USE_THICKNESSMAP
		material.thickness *= texture2D( thicknessMap, vUv ).g;
	#endif
	vec3 pos = vWorldPosition;
	vec3 v = normalize( cameraPosition - pos );
	vec3 n = inverseTransformDirection( normal, viewMatrix );
	vec4 transmission = getIBLVolumeRefraction(
		n, v, material.roughness, material.diffuseColor, material.specularColor, material.specularF90,
		pos, modelMatrix, viewMatrix, projectionMatrix, material.ior, material.thickness,
		material.attenuationColor, material.attenuationDistance );
	material.transmissionAlpha = mix( material.transmissionAlpha, transmission.a, material.transmission );
	totalDiffuse = mix( totalDiffuse, transmission.rgb, material.transmission );
#endif`,transmission_pars_fragment:`#ifdef USE_TRANSMISSION
	uniform float transmission;
	uniform float thickness;
	uniform float attenuationDistance;
	uniform vec3 attenuationColor;
	#ifdef USE_TRANSMISSIONMAP
		uniform sampler2D transmissionMap;
	#endif
	#ifdef USE_THICKNESSMAP
		uniform sampler2D thicknessMap;
	#endif
	uniform vec2 transmissionSamplerSize;
	uniform sampler2D transmissionSamplerMap;
	uniform mat4 modelMatrix;
	uniform mat4 projectionMatrix;
	varying vec3 vWorldPosition;
	vec3 getVolumeTransmissionRay( const in vec3 n, const in vec3 v, const in float thickness, const in float ior, const in mat4 modelMatrix ) {
		vec3 refractionVector = refract( - v, normalize( n ), 1.0 / ior );
		vec3 modelScale;
		modelScale.x = length( vec3( modelMatrix[ 0 ].xyz ) );
		modelScale.y = length( vec3( modelMatrix[ 1 ].xyz ) );
		modelScale.z = length( vec3( modelMatrix[ 2 ].xyz ) );
		return normalize( refractionVector ) * thickness * modelScale;
	}
	float applyIorToRoughness( const in float roughness, const in float ior ) {
		return roughness * clamp( ior * 2.0 - 2.0, 0.0, 1.0 );
	}
	vec4 getTransmissionSample( const in vec2 fragCoord, const in float roughness, const in float ior ) {
		float framebufferLod = log2( transmissionSamplerSize.x ) * applyIorToRoughness( roughness, ior );
		#ifdef texture2DLodEXT
			return transmissionSamplerMapTexelToLinear ( texture2DLodEXT( transmissionSamplerMap, fragCoord.xy, framebufferLod ) );
		#else
			return transmissionSamplerMapTexelToLinear ( texture2D( transmissionSamplerMap, fragCoord.xy, framebufferLod ) );
		#endif
	}
	vec3 applyVolumeAttenuation( const in vec3 radiance, const in float transmissionDistance, const in vec3 attenuationColor, const in float attenuationDistance ) {
		if ( attenuationDistance == 0.0 ) {
			return radiance;
		} else {
			vec3 attenuationCoefficient = -log( attenuationColor ) / attenuationDistance;
			vec3 transmittance = exp( - attenuationCoefficient * transmissionDistance );			return transmittance * radiance;
		}
	}
	vec4 getIBLVolumeRefraction( const in vec3 n, const in vec3 v, const in float roughness, const in vec3 diffuseColor,
		const in vec3 specularColor, const in float specularF90, const in vec3 position, const in mat4 modelMatrix,
		const in mat4 viewMatrix, const in mat4 projMatrix, const in float ior, const in float thickness,
		const in vec3 attenuationColor, const in float attenuationDistance ) {
		vec3 transmissionRay = getVolumeTransmissionRay( n, v, thickness, ior, modelMatrix );
		vec3 refractedRayExit = position + transmissionRay;
		vec4 ndcPos = projMatrix * viewMatrix * vec4( refractedRayExit, 1.0 );
		vec2 refractionCoords = ndcPos.xy / ndcPos.w;
		refractionCoords += 1.0;
		refractionCoords /= 2.0;
		vec4 transmittedLight = getTransmissionSample( refractionCoords, roughness, ior );
		vec3 attenuatedColor = applyVolumeAttenuation( transmittedLight.rgb, length( transmissionRay ), attenuationColor, attenuationDistance );
		vec3 F = EnvironmentBRDF( n, v, specularColor, specularF90, roughness );
		return vec4( ( 1.0 - F ) * attenuatedColor * diffuseColor, transmittedLight.a );
	}
#endif`,uv_pars_fragment:`#if ( defined( USE_UV ) && ! defined( UVS_VERTEX_ONLY ) )
	varying vec2 vUv;
#endif`,uv_pars_vertex:`#ifdef USE_UV
	#ifdef UVS_VERTEX_ONLY
		vec2 vUv;
	#else
		varying vec2 vUv;
	#endif
	uniform mat3 uvTransform;
#endif`,uv_vertex:`#ifdef USE_UV
	vUv = ( uvTransform * vec3( uv, 1 ) ).xy;
#endif`,uv2_pars_fragment:`#if defined( USE_LIGHTMAP ) || defined( USE_AOMAP )
	varying vec2 vUv2;
#endif`,uv2_pars_vertex:`#if defined( USE_LIGHTMAP ) || defined( USE_AOMAP )
	attribute vec2 uv2;
	varying vec2 vUv2;
	uniform mat3 uv2Transform;
#endif`,uv2_vertex:`#if defined( USE_LIGHTMAP ) || defined( USE_AOMAP )
	vUv2 = ( uv2Transform * vec3( uv2, 1 ) ).xy;
#endif`,worldpos_vertex:`#if defined( USE_ENVMAP ) || defined( DISTANCE ) || defined ( USE_SHADOWMAP ) || defined ( USE_TRANSMISSION )
	vec4 worldPosition = vec4( transformed, 1.0 );
	#ifdef USE_INSTANCING
		worldPosition = instanceMatrix * worldPosition;
	#endif
	worldPosition = modelMatrix * worldPosition;
#endif`,background_vert:`varying vec2 vUv;
uniform mat3 uvTransform;
uniform bool flipX;
uniform bool flipY;
void main() {
	vUv = ( uvTransform * vec3( uv, 1 ) ).xy;
    vUv = flipX ? vec2( 1.0 - vUv.x, vUv.y ) : vUv;
    vUv = flipY ? vec2( vUv.x, 1.0 - vUv.y ) : vUv;
	gl_Position = vec4( position.xy, 1.0, 1.0 );
}`,background_frag:`uniform sampler2D t2D;
varying vec2 vUv;
void main() {
	gl_FragColor = texture2D( t2D, vUv );
	#ifdef DECODE_VIDEO_TEXTURE
		gl_FragColor = vec4( mix( pow( gl_FragColor.rgb * 0.9478672986 + vec3( 0.0521327014 ), vec3( 2.4 ) ), gl_FragColor.rgb * 0.0773993808, vec3( lessThanEqual( gl_FragColor.rgb, vec3( 0.04045 ) ) ) ), gl_FragColor.w );
	#endif
	#include <tonemapping_fragment>
	#include <encodings_fragment>
}`,cube_vert:`varying vec3 vWorldDirection;
#include <common>
void main() {
	vWorldDirection = transformDirection( position, modelMatrix );
	#include <begin_vertex>
	#include <project_vertex>
	gl_Position.z = gl_Position.w;
}`,cube_frag:`#include <envmap_common_pars_fragment>
uniform float opacity;
varying vec3 vWorldDirection;
#include <cube_uv_reflection_fragment>
void main() {
	vec3 vReflect = vWorldDirection;
	#include <envmap_fragment>
	gl_FragColor = envColor;
	gl_FragColor.a *= opacity;
	#include <tonemapping_fragment>
	#include <encodings_fragment>
}`,depth_vert:`#include <common>
#include <uv_pars_vertex>
#include <displacementmap_pars_vertex>
#include <morphtarget_pars_vertex>
#include <skinning_pars_vertex>
#include <logdepthbuf_pars_vertex>
#include <clipping_planes_pars_vertex>
varying vec2 vHighPrecisionZW;
void main() {
	#include <uv_vertex>
	#include <skinbase_vertex>
	#ifdef USE_DISPLACEMENTMAP
		#include <beginnormal_vertex>
		#include <morphnormal_vertex>
		#include <skinnormal_vertex>
	#endif
	#include <begin_vertex>
	#include <morphtarget_vertex>
	#include <skinning_vertex>
	#include <displacementmap_vertex>
	#include <project_vertex>
	#include <logdepthbuf_vertex>
	#include <clipping_planes_vertex>
	vHighPrecisionZW = gl_Position.zw;
}`,depth_frag:`#if DEPTH_PACKING == 3200
	uniform float opacity;
#endif
#include <common>
#include <packing>
#include <uv_pars_fragment>
#include <map_pars_fragment>
#include <alphamap_pars_fragment>
#include <alphatest_pars_fragment>
#include <logdepthbuf_pars_fragment>
#include <clipping_planes_pars_fragment>
varying vec2 vHighPrecisionZW;
void main() {
	#include <clipping_planes_fragment>
	vec4 diffuseColor = vec4( 1.0 );
	#if DEPTH_PACKING == 3200
		diffuseColor.a = opacity;
	#endif
	#include <map_fragment>
	#include <alphamap_fragment>
	#include <alphatest_fragment>
	#include <logdepthbuf_fragment>
	float fragCoordZ = 0.5 * vHighPrecisionZW[0] / vHighPrecisionZW[1] + 0.5;
	#if DEPTH_PACKING == 3200
		gl_FragColor = vec4( vec3( 1.0 - fragCoordZ ), opacity );
	#elif DEPTH_PACKING == 3201
		gl_FragColor = packDepthToRGBA( fragCoordZ );
	#endif
}`,distanceRGBA_vert:`#define DISTANCE
varying vec3 vWorldPosition;
#include <common>
#include <uv_pars_vertex>
#include <displacementmap_pars_vertex>
#include <morphtarget_pars_vertex>
#include <skinning_pars_vertex>
#include <clipping_planes_pars_vertex>
void main() {
	#include <uv_vertex>
	#include <skinbase_vertex>
	#ifdef USE_DISPLACEMENTMAP
		#include <beginnormal_vertex>
		#include <morphnormal_vertex>
		#include <skinnormal_vertex>
	#endif
	#include <begin_vertex>
	#include <morphtarget_vertex>
	#include <skinning_vertex>
	#include <displacementmap_vertex>
	#include <project_vertex>
	#include <worldpos_vertex>
	#include <clipping_planes_vertex>
	vWorldPosition = worldPosition.xyz;
}`,distanceRGBA_frag:`#define DISTANCE
uniform vec3 referencePosition;
uniform float nearDistance;
uniform float farDistance;
varying vec3 vWorldPosition;
#include <common>
#include <packing>
#include <uv_pars_fragment>
#include <map_pars_fragment>
#include <alphamap_pars_fragment>
#include <alphatest_pars_fragment>
#include <clipping_planes_pars_fragment>
void main () {
	#include <clipping_planes_fragment>
	vec4 diffuseColor = vec4( 1.0 );
	#include <map_fragment>
	#include <alphamap_fragment>
	#include <alphatest_fragment>
	float dist = length( vWorldPosition - referencePosition );
	dist = ( dist - nearDistance ) / ( farDistance - nearDistance );
	dist = saturate( dist );
	gl_FragColor = packDepthToRGBA( dist );
}`,equirect_vert:`varying vec3 vWorldDirection;
#include <common>
void main() {
	vWorldDirection = transformDirection( position, modelMatrix );
	#include <begin_vertex>
	#include <project_vertex>
}`,equirect_frag:`uniform sampler2D tEquirect;
varying vec3 vWorldDirection;
#include <common>
void main() {
	vec3 direction = normalize( vWorldDirection );
	vec2 sampleUV = equirectUv( direction );
	gl_FragColor = texture2D( tEquirect, sampleUV );
	#include <tonemapping_fragment>
	#include <encodings_fragment>
}`,linedashed_vert:`uniform float scale;
attribute float lineDistance;
varying float vLineDistance;
#include <common>
#include <color_pars_vertex>
#include <fog_pars_vertex>
#include <morphtarget_pars_vertex>
#include <logdepthbuf_pars_vertex>
#include <clipping_planes_pars_vertex>
void main() {
	vLineDistance = scale * lineDistance;
	#include <color_vertex>
	#include <morphcolor_vertex>
	#include <begin_vertex>
	#include <morphtarget_vertex>
	#include <project_vertex>
	#include <logdepthbuf_vertex>
	#include <clipping_planes_vertex>
	#include <fog_vertex>
}`,linedashed_frag:`uniform vec3 diffuse;
uniform float opacity;
uniform float dashSize;
uniform float totalSize;
varying float vLineDistance;
#include <common>
#include <color_pars_fragment>
#include <fog_pars_fragment>
#include <logdepthbuf_pars_fragment>
#include <clipping_planes_pars_fragment>
void main() {
	#include <clipping_planes_fragment>
	if ( mod( vLineDistance, totalSize ) > dashSize ) {
		discard;
	}
	vec3 outgoingLight = vec3( 0.0 );
	vec4 diffuseColor = vec4( diffuse, opacity );
	#include <logdepthbuf_fragment>
	#include <color_fragment>
	outgoingLight = diffuseColor.rgb;
	#include <output_fragment>
	#include <tonemapping_fragment>
	#include <encodings_fragment>
	#include <fog_fragment>
	#include <premultiplied_alpha_fragment>
}`,meshbasic_vert:`#include <common>
#include <uv_pars_vertex>
#include <uv2_pars_vertex>
#include <envmap_pars_vertex>
#include <color_pars_vertex>
#include <fog_pars_vertex>
#include <morphtarget_pars_vertex>
#include <skinning_pars_vertex>
#include <logdepthbuf_pars_vertex>
#include <clipping_planes_pars_vertex>
void main() {
	#include <uv_vertex>
	#include <uv2_vertex>
	#include <color_vertex>
	#include <morphcolor_vertex>
	#if defined ( USE_ENVMAP ) || defined ( USE_SKINNING )
		#include <beginnormal_vertex>
		#include <morphnormal_vertex>
		#include <skinbase_vertex>
		#include <skinnormal_vertex>
		#include <defaultnormal_vertex>
	#endif
	#include <begin_vertex>
	#include <morphtarget_vertex>
	#include <skinning_vertex>
	#include <project_vertex>
	#include <logdepthbuf_vertex>
	#include <clipping_planes_vertex>
	#include <worldpos_vertex>
	#include <envmap_vertex>
	#include <fog_vertex>
}`,meshbasic_frag:`uniform vec3 diffuse;
uniform float opacity;
#ifndef FLAT_SHADED
	varying vec3 vNormal;
#endif
#include <common>
#include <dithering_pars_fragment>
#include <color_pars_fragment>
#include <uv_pars_fragment>
#include <uv2_pars_fragment>
#include <map_pars_fragment>
#include <alphamap_pars_fragment>
#include <alphatest_pars_fragment>
#include <aomap_pars_fragment>
#include <lightmap_pars_fragment>
#include <envmap_common_pars_fragment>
#include <envmap_pars_fragment>
#include <fog_pars_fragment>
#include <specularmap_pars_fragment>
#include <logdepthbuf_pars_fragment>
#include <clipping_planes_pars_fragment>
void main() {
	#include <clipping_planes_fragment>
	vec4 diffuseColor = vec4( diffuse, opacity );
	#include <logdepthbuf_fragment>
	#include <map_fragment>
	#include <color_fragment>
	#include <alphamap_fragment>
	#include <alphatest_fragment>
	#include <specularmap_fragment>
	ReflectedLight reflectedLight = ReflectedLight( vec3( 0.0 ), vec3( 0.0 ), vec3( 0.0 ), vec3( 0.0 ) );
	#ifdef USE_LIGHTMAP
		vec4 lightMapTexel = texture2D( lightMap, vUv2 );
		reflectedLight.indirectDiffuse += lightMapTexel.rgb * lightMapIntensity * RECIPROCAL_PI;
	#else
		reflectedLight.indirectDiffuse += vec3( 1.0 );
	#endif
	#include <aomap_fragment>
	reflectedLight.indirectDiffuse *= diffuseColor.rgb;
	vec3 outgoingLight = reflectedLight.indirectDiffuse;
	#include <envmap_fragment>
	#include <output_fragment>
	#include <tonemapping_fragment>
	#include <encodings_fragment>
	#include <fog_fragment>
	#include <premultiplied_alpha_fragment>
	#include <dithering_fragment>
}`,meshlambert_vert:`#define LAMBERT
varying vec3 vViewPosition;
#include <common>
#include <uv_pars_vertex>
#include <uv2_pars_vertex>
#include <displacementmap_pars_vertex>
#include <envmap_pars_vertex>
#include <color_pars_vertex>
#include <fog_pars_vertex>
#include <normal_pars_vertex>
#include <morphtarget_pars_vertex>
#include <skinning_pars_vertex>
#include <shadowmap_pars_vertex>
#include <logdepthbuf_pars_vertex>
#include <clipping_planes_pars_vertex>
void main() {
	#include <uv_vertex>
	#include <uv2_vertex>
	#include <color_vertex>
	#include <morphcolor_vertex>
	#include <beginnormal_vertex>
	#include <morphnormal_vertex>
	#include <skinbase_vertex>
	#include <skinnormal_vertex>
	#include <defaultnormal_vertex>
	#include <normal_vertex>
	#include <begin_vertex>
	#include <morphtarget_vertex>
	#include <skinning_vertex>
	#include <displacementmap_vertex>
	#include <project_vertex>
	#include <logdepthbuf_vertex>
	#include <clipping_planes_vertex>
	vViewPosition = - mvPosition.xyz;
	#include <worldpos_vertex>
	#include <envmap_vertex>
	#include <shadowmap_vertex>
	#include <fog_vertex>
}`,meshlambert_frag:`#define LAMBERT
uniform vec3 diffuse;
uniform vec3 emissive;
uniform float opacity;
#include <common>
#include <packing>
#include <dithering_pars_fragment>
#include <color_pars_fragment>
#include <uv_pars_fragment>
#include <uv2_pars_fragment>
#include <map_pars_fragment>
#include <alphamap_pars_fragment>
#include <alphatest_pars_fragment>
#include <aomap_pars_fragment>
#include <lightmap_pars_fragment>
#include <emissivemap_pars_fragment>
#include <envmap_common_pars_fragment>
#include <envmap_pars_fragment>
#include <fog_pars_fragment>
#include <bsdfs>
#include <lights_pars_begin>
#include <normal_pars_fragment>
#include <lights_lambert_pars_fragment>
#include <shadowmap_pars_fragment>
#include <bumpmap_pars_fragment>
#include <normalmap_pars_fragment>
#include <specularmap_pars_fragment>
#include <logdepthbuf_pars_fragment>
#include <clipping_planes_pars_fragment>
void main() {
	#include <clipping_planes_fragment>
	vec4 diffuseColor = vec4( diffuse, opacity );
	ReflectedLight reflectedLight = ReflectedLight( vec3( 0.0 ), vec3( 0.0 ), vec3( 0.0 ), vec3( 0.0 ) );
	vec3 totalEmissiveRadiance = emissive;
	#include <logdepthbuf_fragment>
	#include <map_fragment>
	#include <color_fragment>
	#include <alphamap_fragment>
	#include <alphatest_fragment>
	#include <specularmap_fragment>
	#include <normal_fragment_begin>
	#include <normal_fragment_maps>
	#include <emissivemap_fragment>
	#include <lights_lambert_fragment>
	#include <lights_fragment_begin>
	#include <lights_fragment_maps>
	#include <lights_fragment_end>
	#include <aomap_fragment>
	vec3 outgoingLight = reflectedLight.directDiffuse + reflectedLight.indirectDiffuse + totalEmissiveRadiance;
	#include <envmap_fragment>
	#include <output_fragment>
	#include <tonemapping_fragment>
	#include <encodings_fragment>
	#include <fog_fragment>
	#include <premultiplied_alpha_fragment>
	#include <dithering_fragment>
}`,meshmatcap_vert:`#define MATCAP
varying vec3 vViewPosition;
#include <common>
#include <uv_pars_vertex>
#include <color_pars_vertex>
#include <displacementmap_pars_vertex>
#include <fog_pars_vertex>
#include <normal_pars_vertex>
#include <morphtarget_pars_vertex>
#include <skinning_pars_vertex>
#include <logdepthbuf_pars_vertex>
#include <clipping_planes_pars_vertex>
void main() {
	#include <uv_vertex>
	#include <color_vertex>
	#include <morphcolor_vertex>
	#include <beginnormal_vertex>
	#include <morphnormal_vertex>
	#include <skinbase_vertex>
	#include <skinnormal_vertex>
	#include <defaultnormal_vertex>
	#include <normal_vertex>
	#include <begin_vertex>
	#include <morphtarget_vertex>
	#include <skinning_vertex>
	#include <displacementmap_vertex>
	#include <project_vertex>
	#include <logdepthbuf_vertex>
	#include <clipping_planes_vertex>
	#include <fog_vertex>
	vViewPosition = - mvPosition.xyz;
}`,meshmatcap_frag:`#define MATCAP
uniform vec3 diffuse;
uniform float opacity;
uniform sampler2D matcap;
varying vec3 vViewPosition;
#include <common>
#include <dithering_pars_fragment>
#include <color_pars_fragment>
#include <uv_pars_fragment>
#include <map_pars_fragment>
#include <alphamap_pars_fragment>
#include <alphatest_pars_fragment>
#include <fog_pars_fragment>
#include <normal_pars_fragment>
#include <bumpmap_pars_fragment>
#include <normalmap_pars_fragment>
#include <logdepthbuf_pars_fragment>
#include <clipping_planes_pars_fragment>
void main() {
	#include <clipping_planes_fragment>
	vec4 diffuseColor = vec4( diffuse, opacity );
	#include <logdepthbuf_fragment>
	#include <map_fragment>
	#include <color_fragment>
	#include <alphamap_fragment>
	#include <alphatest_fragment>
	#include <normal_fragment_begin>
	#include <normal_fragment_maps>
	vec3 viewDir = normalize( vViewPosition );
	vec3 x = normalize( vec3( viewDir.z, 0.0, - viewDir.x ) );
	vec3 y = cross( viewDir, x );
	vec2 uv = vec2( dot( x, normal ), dot( y, normal ) ) * 0.495 + 0.5;
	#ifdef USE_MATCAP
		vec4 matcapColor = texture2D( matcap, uv );
	#else
		vec4 matcapColor = vec4( vec3( mix( 0.2, 0.8, uv.y ) ), 1.0 );
	#endif
	vec3 outgoingLight = diffuseColor.rgb * matcapColor.rgb;
	#include <output_fragment>
	#include <tonemapping_fragment>
	#include <encodings_fragment>
	#include <fog_fragment>
	#include <premultiplied_alpha_fragment>
	#include <dithering_fragment>
}`,meshnormal_vert:`#define NORMAL
#if defined( FLAT_SHADED ) || defined( USE_BUMPMAP ) || defined( TANGENTSPACE_NORMALMAP )
	varying vec3 vViewPosition;
#endif
#include <common>
#include <uv_pars_vertex>
#include <displacementmap_pars_vertex>
#include <normal_pars_vertex>
#include <morphtarget_pars_vertex>
#include <skinning_pars_vertex>
#include <logdepthbuf_pars_vertex>
#include <clipping_planes_pars_vertex>
void main() {
	#include <uv_vertex>
	#include <beginnormal_vertex>
	#include <morphnormal_vertex>
	#include <skinbase_vertex>
	#include <skinnormal_vertex>
	#include <defaultnormal_vertex>
	#include <normal_vertex>
	#include <begin_vertex>
	#include <morphtarget_vertex>
	#include <skinning_vertex>
	#include <displacementmap_vertex>
	#include <project_vertex>
	#include <logdepthbuf_vertex>
	#include <clipping_planes_vertex>
#if defined( FLAT_SHADED ) || defined( USE_BUMPMAP ) || defined( TANGENTSPACE_NORMALMAP )
	vViewPosition = - mvPosition.xyz;
#endif
}`,meshnormal_frag:`#define NORMAL
uniform float opacity;
#if defined( FLAT_SHADED ) || defined( USE_BUMPMAP ) || defined( TANGENTSPACE_NORMALMAP )
	varying vec3 vViewPosition;
#endif
#include <packing>
#include <uv_pars_fragment>
#include <normal_pars_fragment>
#include <bumpmap_pars_fragment>
#include <normalmap_pars_fragment>
#include <logdepthbuf_pars_fragment>
#include <clipping_planes_pars_fragment>
void main() {
	#include <clipping_planes_fragment>
	#include <logdepthbuf_fragment>
	#include <normal_fragment_begin>
	#include <normal_fragment_maps>
	gl_FragColor = vec4( packNormalToRGB( normal ), opacity );
	#ifdef OPAQUE
		gl_FragColor.a = 1.0;
	#endif
}`,meshphong_vert:`#define PHONG
varying vec3 vViewPosition;
#include <common>
#include <uv_pars_vertex>
#include <uv2_pars_vertex>
#include <displacementmap_pars_vertex>
#include <envmap_pars_vertex>
#include <color_pars_vertex>
#include <fog_pars_vertex>
#include <normal_pars_vertex>
#include <morphtarget_pars_vertex>
#include <skinning_pars_vertex>
#include <shadowmap_pars_vertex>
#include <logdepthbuf_pars_vertex>
#include <clipping_planes_pars_vertex>
void main() {
	#include <uv_vertex>
	#include <uv2_vertex>
	#include <color_vertex>
	#include <morphcolor_vertex>
	#include <beginnormal_vertex>
	#include <morphnormal_vertex>
	#include <skinbase_vertex>
	#include <skinnormal_vertex>
	#include <defaultnormal_vertex>
	#include <normal_vertex>
	#include <begin_vertex>
	#include <morphtarget_vertex>
	#include <skinning_vertex>
	#include <displacementmap_vertex>
	#include <project_vertex>
	#include <logdepthbuf_vertex>
	#include <clipping_planes_vertex>
	vViewPosition = - mvPosition.xyz;
	#include <worldpos_vertex>
	#include <envmap_vertex>
	#include <shadowmap_vertex>
	#include <fog_vertex>
}`,meshphong_frag:`#define PHONG
uniform vec3 diffuse;
uniform vec3 emissive;
uniform vec3 specular;
uniform float shininess;
uniform float opacity;
#include <common>
#include <packing>
#include <dithering_pars_fragment>
#include <color_pars_fragment>
#include <uv_pars_fragment>
#include <uv2_pars_fragment>
#include <map_pars_fragment>
#include <alphamap_pars_fragment>
#include <alphatest_pars_fragment>
#include <aomap_pars_fragment>
#include <lightmap_pars_fragment>
#include <emissivemap_pars_fragment>
#include <envmap_common_pars_fragment>
#include <envmap_pars_fragment>
#include <fog_pars_fragment>
#include <bsdfs>
#include <lights_pars_begin>
#include <normal_pars_fragment>
#include <lights_phong_pars_fragment>
#include <shadowmap_pars_fragment>
#include <bumpmap_pars_fragment>
#include <normalmap_pars_fragment>
#include <specularmap_pars_fragment>
#include <logdepthbuf_pars_fragment>
#include <clipping_planes_pars_fragment>
void main() {
	#include <clipping_planes_fragment>
	vec4 diffuseColor = vec4( diffuse, opacity );
	ReflectedLight reflectedLight = ReflectedLight( vec3( 0.0 ), vec3( 0.0 ), vec3( 0.0 ), vec3( 0.0 ) );
	vec3 totalEmissiveRadiance = emissive;
	#include <logdepthbuf_fragment>
	#include <map_fragment>
	#include <color_fragment>
	#include <alphamap_fragment>
	#include <alphatest_fragment>
	#include <specularmap_fragment>
	#include <normal_fragment_begin>
	#include <normal_fragment_maps>
	#include <emissivemap_fragment>
	#include <lights_phong_fragment>
	#include <lights_fragment_begin>
	#include <lights_fragment_maps>
	#include <lights_fragment_end>
	#include <aomap_fragment>
	vec3 outgoingLight = reflectedLight.directDiffuse + reflectedLight.indirectDiffuse + reflectedLight.directSpecular + reflectedLight.indirectSpecular + totalEmissiveRadiance;
	#include <envmap_fragment>
	#include <output_fragment>
	#include <tonemapping_fragment>
	#include <encodings_fragment>
	#include <fog_fragment>
	#include <premultiplied_alpha_fragment>
	#include <dithering_fragment>
}`,meshphysical_vert:`#define STANDARD
varying vec3 vViewPosition;
#ifdef USE_TRANSMISSION
	varying vec3 vWorldPosition;
#endif
#include <common>
#include <uv_pars_vertex>
#include <uv2_pars_vertex>
#include <displacementmap_pars_vertex>
#include <color_pars_vertex>
#include <fog_pars_vertex>
#include <normal_pars_vertex>
#include <morphtarget_pars_vertex>
#include <skinning_pars_vertex>
#include <shadowmap_pars_vertex>
#include <logdepthbuf_pars_vertex>
#include <clipping_planes_pars_vertex>
void main() {
	#include <uv_vertex>
	#include <uv2_vertex>
	#include <color_vertex>
	#include <morphcolor_vertex>
	#include <beginnormal_vertex>
	#include <morphnormal_vertex>
	#include <skinbase_vertex>
	#include <skinnormal_vertex>
	#include <defaultnormal_vertex>
	#include <normal_vertex>
	#include <begin_vertex>
	#include <morphtarget_vertex>
	#include <skinning_vertex>
	#include <displacementmap_vertex>
	#include <project_vertex>
	#include <logdepthbuf_vertex>
	#include <clipping_planes_vertex>
	vViewPosition = - mvPosition.xyz;
	#include <worldpos_vertex>
	#include <shadowmap_vertex>
	#include <fog_vertex>
#ifdef USE_TRANSMISSION
	vWorldPosition = worldPosition.xyz;
#endif
}`,meshphysical_frag:`#define STANDARD
#ifdef PHYSICAL
	#define IOR
	#define SPECULAR
#endif
uniform vec3 diffuse;
uniform vec3 emissive;
uniform float roughness;
uniform float metalness;
uniform float opacity;
#ifdef IOR
	uniform float ior;
#endif
#ifdef SPECULAR
	uniform float specularIntensity;
	uniform vec3 specularColor;
	#ifdef USE_SPECULARINTENSITYMAP
		uniform sampler2D specularIntensityMap;
	#endif
	#ifdef USE_SPECULARCOLORMAP
		uniform sampler2D specularColorMap;
	#endif
#endif
#ifdef USE_CLEARCOAT
	uniform float clearcoat;
	uniform float clearcoatRoughness;
#endif
#ifdef USE_IRIDESCENCE
	uniform float iridescence;
	uniform float iridescenceIOR;
	uniform float iridescenceThicknessMinimum;
	uniform float iridescenceThicknessMaximum;
#endif
#ifdef USE_SHEEN
	uniform vec3 sheenColor;
	uniform float sheenRoughness;
	#ifdef USE_SHEENCOLORMAP
		uniform sampler2D sheenColorMap;
	#endif
	#ifdef USE_SHEENROUGHNESSMAP
		uniform sampler2D sheenRoughnessMap;
	#endif
#endif
varying vec3 vViewPosition;
#include <common>
#include <packing>
#include <dithering_pars_fragment>
#include <color_pars_fragment>
#include <uv_pars_fragment>
#include <uv2_pars_fragment>
#include <map_pars_fragment>
#include <alphamap_pars_fragment>
#include <alphatest_pars_fragment>
#include <aomap_pars_fragment>
#include <lightmap_pars_fragment>
#include <emissivemap_pars_fragment>
#include <bsdfs>
#include <iridescence_fragment>
#include <cube_uv_reflection_fragment>
#include <envmap_common_pars_fragment>
#include <envmap_physical_pars_fragment>
#include <fog_pars_fragment>
#include <lights_pars_begin>
#include <normal_pars_fragment>
#include <lights_physical_pars_fragment>
#include <transmission_pars_fragment>
#include <shadowmap_pars_fragment>
#include <bumpmap_pars_fragment>
#include <normalmap_pars_fragment>
#include <clearcoat_pars_fragment>
#include <iridescence_pars_fragment>
#include <roughnessmap_pars_fragment>
#include <metalnessmap_pars_fragment>
#include <logdepthbuf_pars_fragment>
#include <clipping_planes_pars_fragment>
void main() {
	#include <clipping_planes_fragment>
	vec4 diffuseColor = vec4( diffuse, opacity );
	ReflectedLight reflectedLight = ReflectedLight( vec3( 0.0 ), vec3( 0.0 ), vec3( 0.0 ), vec3( 0.0 ) );
	vec3 totalEmissiveRadiance = emissive;
	#include <logdepthbuf_fragment>
	#include <map_fragment>
	#include <color_fragment>
	#include <alphamap_fragment>
	#include <alphatest_fragment>
	#include <roughnessmap_fragment>
	#include <metalnessmap_fragment>
	#include <normal_fragment_begin>
	#include <normal_fragment_maps>
	#include <clearcoat_normal_fragment_begin>
	#include <clearcoat_normal_fragment_maps>
	#include <emissivemap_fragment>
	#include <lights_physical_fragment>
	#include <lights_fragment_begin>
	#include <lights_fragment_maps>
	#include <lights_fragment_end>
	#include <aomap_fragment>
	vec3 totalDiffuse = reflectedLight.directDiffuse + reflectedLight.indirectDiffuse;
	vec3 totalSpecular = reflectedLight.directSpecular + reflectedLight.indirectSpecular;
	#include <transmission_fragment>
	vec3 outgoingLight = totalDiffuse + totalSpecular + totalEmissiveRadiance;
	#ifdef USE_SHEEN
		float sheenEnergyComp = 1.0 - 0.157 * max3( material.sheenColor );
		outgoingLight = outgoingLight * sheenEnergyComp + sheenSpecular;
	#endif
	#ifdef USE_CLEARCOAT
		float dotNVcc = saturate( dot( geometry.clearcoatNormal, geometry.viewDir ) );
		vec3 Fcc = F_Schlick( material.clearcoatF0, material.clearcoatF90, dotNVcc );
		outgoingLight = outgoingLight * ( 1.0 - material.clearcoat * Fcc ) + clearcoatSpecular * material.clearcoat;
	#endif
	#include <output_fragment>
	#include <tonemapping_fragment>
	#include <encodings_fragment>
	#include <fog_fragment>
	#include <premultiplied_alpha_fragment>
	#include <dithering_fragment>
}`,meshtoon_vert:`#define TOON
varying vec3 vViewPosition;
#include <common>
#include <uv_pars_vertex>
#include <uv2_pars_vertex>
#include <displacementmap_pars_vertex>
#include <color_pars_vertex>
#include <fog_pars_vertex>
#include <normal_pars_vertex>
#include <morphtarget_pars_vertex>
#include <skinning_pars_vertex>
#include <shadowmap_pars_vertex>
#include <logdepthbuf_pars_vertex>
#include <clipping_planes_pars_vertex>
void main() {
	#include <uv_vertex>
	#include <uv2_vertex>
	#include <color_vertex>
	#include <morphcolor_vertex>
	#include <beginnormal_vertex>
	#include <morphnormal_vertex>
	#include <skinbase_vertex>
	#include <skinnormal_vertex>
	#include <defaultnormal_vertex>
	#include <normal_vertex>
	#include <begin_vertex>
	#include <morphtarget_vertex>
	#include <skinning_vertex>
	#include <displacementmap_vertex>
	#include <project_vertex>
	#include <logdepthbuf_vertex>
	#include <clipping_planes_vertex>
	vViewPosition = - mvPosition.xyz;
	#include <worldpos_vertex>
	#include <shadowmap_vertex>
	#include <fog_vertex>
}`,meshtoon_frag:`#define TOON
uniform vec3 diffuse;
uniform vec3 emissive;
uniform float opacity;
#include <common>
#include <packing>
#include <dithering_pars_fragment>
#include <color_pars_fragment>
#include <uv_pars_fragment>
#include <uv2_pars_fragment>
#include <map_pars_fragment>
#include <alphamap_pars_fragment>
#include <alphatest_pars_fragment>
#include <aomap_pars_fragment>
#include <lightmap_pars_fragment>
#include <emissivemap_pars_fragment>
#include <gradientmap_pars_fragment>
#include <fog_pars_fragment>
#include <bsdfs>
#include <lights_pars_begin>
#include <normal_pars_fragment>
#include <lights_toon_pars_fragment>
#include <shadowmap_pars_fragment>
#include <bumpmap_pars_fragment>
#include <normalmap_pars_fragment>
#include <logdepthbuf_pars_fragment>
#include <clipping_planes_pars_fragment>
void main() {
	#include <clipping_planes_fragment>
	vec4 diffuseColor = vec4( diffuse, opacity );
	ReflectedLight reflectedLight = ReflectedLight( vec3( 0.0 ), vec3( 0.0 ), vec3( 0.0 ), vec3( 0.0 ) );
	vec3 totalEmissiveRadiance = emissive;
	#include <logdepthbuf_fragment>
	#include <map_fragment>
	#include <color_fragment>
	#include <alphamap_fragment>
	#include <alphatest_fragment>
	#include <normal_fragment_begin>
	#include <normal_fragment_maps>
	#include <emissivemap_fragment>
	#include <lights_toon_fragment>
	#include <lights_fragment_begin>
	#include <lights_fragment_maps>
	#include <lights_fragment_end>
	#include <aomap_fragment>
	vec3 outgoingLight = reflectedLight.directDiffuse + reflectedLight.indirectDiffuse + totalEmissiveRadiance;
	#include <output_fragment>
	#include <tonemapping_fragment>
	#include <encodings_fragment>
	#include <fog_fragment>
	#include <premultiplied_alpha_fragment>
	#include <dithering_fragment>
}`,points_vert:`uniform float size;
uniform float scale;
#include <common>
#include <color_pars_vertex>
#include <fog_pars_vertex>
#include <morphtarget_pars_vertex>
#include <logdepthbuf_pars_vertex>
#include <clipping_planes_pars_vertex>
void main() {
	#include <color_vertex>
	#include <morphcolor_vertex>
	#include <begin_vertex>
	#include <morphtarget_vertex>
	#include <project_vertex>
	gl_PointSize = size;
	#ifdef USE_SIZEATTENUATION
		bool isPerspective = isPerspectiveMatrix( projectionMatrix );
		if ( isPerspective ) gl_PointSize *= ( scale / - mvPosition.z );
	#endif
	#include <logdepthbuf_vertex>
	#include <clipping_planes_vertex>
	#include <worldpos_vertex>
	#include <fog_vertex>
}`,points_frag:`uniform vec3 diffuse;
uniform float opacity;
#include <common>
#include <color_pars_fragment>
#include <map_particle_pars_fragment>
#include <alphatest_pars_fragment>
#include <fog_pars_fragment>
#include <logdepthbuf_pars_fragment>
#include <clipping_planes_pars_fragment>
void main() {
	#include <clipping_planes_fragment>
	vec3 outgoingLight = vec3( 0.0 );
	vec4 diffuseColor = vec4( diffuse, opacity );
	#include <logdepthbuf_fragment>
	#include <map_particle_fragment>
	#include <color_fragment>
	#include <alphatest_fragment>
	outgoingLight = diffuseColor.rgb;
	#include <output_fragment>
	#include <tonemapping_fragment>
	#include <encodings_fragment>
	#include <fog_fragment>
	#include <premultiplied_alpha_fragment>
}`,shadow_vert:`#include <common>
#include <fog_pars_vertex>
#include <morphtarget_pars_vertex>
#include <skinning_pars_vertex>
#include <shadowmap_pars_vertex>
void main() {
	#include <beginnormal_vertex>
	#include <morphnormal_vertex>
	#include <skinbase_vertex>
	#include <skinnormal_vertex>
	#include <defaultnormal_vertex>
	#include <begin_vertex>
	#include <morphtarget_vertex>
	#include <skinning_vertex>
	#include <project_vertex>
	#include <worldpos_vertex>
	#include <shadowmap_vertex>
	#include <fog_vertex>
}`,shadow_frag:`uniform vec3 color;
uniform float opacity;
#include <common>
#include <packing>
#include <fog_pars_fragment>
#include <bsdfs>
#include <lights_pars_begin>
#include <shadowmap_pars_fragment>
#include <shadowmask_pars_fragment>
void main() {
	gl_FragColor = vec4( color, opacity * ( 1.0 - getShadowMask() ) );
	#include <tonemapping_fragment>
	#include <encodings_fragment>
	#include <fog_fragment>
}`,sprite_vert:`uniform float rotation;
uniform vec2 center;
#include <common>
#include <uv_pars_vertex>
#include <fog_pars_vertex>
#include <logdepthbuf_pars_vertex>
#include <clipping_planes_pars_vertex>
void main() {
	#include <uv_vertex>
	vec4 mvPosition = modelViewMatrix * vec4( 0.0, 0.0, 0.0, 1.0 );
	vec2 scale;
	scale.x = length( vec3( modelMatrix[ 0 ].x, modelMatrix[ 0 ].y, modelMatrix[ 0 ].z ) );
	scale.y = length( vec3( modelMatrix[ 1 ].x, modelMatrix[ 1 ].y, modelMatrix[ 1 ].z ) );
	#ifndef USE_SIZEATTENUATION
		bool isPerspective = isPerspectiveMatrix( projectionMatrix );
		if ( isPerspective ) scale *= - mvPosition.z;
	#endif
	vec2 alignedPosition = ( position.xy - ( center - vec2( 0.5 ) ) ) * scale;
	vec2 rotatedPosition;
	rotatedPosition.x = cos( rotation ) * alignedPosition.x - sin( rotation ) * alignedPosition.y;
	rotatedPosition.y = sin( rotation ) * alignedPosition.x + cos( rotation ) * alignedPosition.y;
	mvPosition.xy += rotatedPosition;
	gl_Position = projectionMatrix * mvPosition;
	#include <logdepthbuf_vertex>
	#include <clipping_planes_vertex>
	#include <fog_vertex>
}`,sprite_frag:`uniform vec3 diffuse;
uniform float opacity;
#include <common>
#include <uv_pars_fragment>
#include <map_pars_fragment>
#include <alphamap_pars_fragment>
#include <alphatest_pars_fragment>
#include <fog_pars_fragment>
#include <logdepthbuf_pars_fragment>
#include <clipping_planes_pars_fragment>
void main() {
	#include <clipping_planes_fragment>
	vec3 outgoingLight = vec3( 0.0 );
	vec4 diffuseColor = vec4( diffuse, opacity );
	#include <logdepthbuf_fragment>
	#include <map_fragment>
	#include <alphamap_fragment>
	#include <alphatest_fragment>
	outgoingLight = diffuseColor.rgb;
	#include <output_fragment>
	#include <tonemapping_fragment>
	#include <encodings_fragment>
	#include <fog_fragment>
}`},Xr={common:{diffuse:{value:new rs(16777215)},opacity:{value:1},map:{value:null},uvTransform:{value:new nu},uv2Transform:{value:new nu},alphaMap:{value:null},alphaTest:{value:0}},specularmap:{specularMap:{value:null}},envmap:{envMap:{value:null},envMapRotation:{value:0},flipEnvMap:{value:-1},reflectivity:{value:1},ior:{value:1.5},refractionRatio:{value:.98}},aomap:{aoMap:{value:null},aoMapIntensity:{value:1}},lightmap:{lightMap:{value:null},lightMapIntensity:{value:1}},emissivemap:{emissiveMap:{value:null}},bumpmap:{bumpMap:{value:null},bumpScale:{value:1}},normalmap:{normalMap:{value:null},normalScale:{value:new Sr(1,1)}},displacementmap:{displacementMap:{value:null},displacementScale:{value:1},displacementBias:{value:0}},roughnessmap:{roughnessMap:{value:null}},metalnessmap:{metalnessMap:{value:null}},gradientmap:{gradientMap:{value:null}},fog:{fogDensity:{value:25e-5},fogNear:{value:1},fogFar:{value:2e3},fogColor:{value:new rs(16777215)}},lights:{ambientLightColor:{value:[]},lightProbe:{value:[]},directionalLights:{value:[],properties:{direction:{},color:{}}},directionalLightShadows:{value:[],properties:{shadowBias:{},shadowNormalBias:{},shadowRadius:{},shadowMapSize:{}}},directionalShadowMap:{value:[]},directionalShadowMatrix:{value:[]},spotLights:{value:[],properties:{color:{},position:{},direction:{},distance:{},coneCos:{},penumbraCos:{},decay:{}}},spotLightShadows:{value:[],properties:{shadowBias:{},shadowNormalBias:{},shadowRadius:{},shadowMapSize:{}}},spotLightMap:{value:[]},spotShadowMap:{value:[]},spotLightMatrix:{value:[]},pointLights:{value:[],properties:{color:{},position:{},decay:{},distance:{}}},pointLightShadows:{value:[],properties:{shadowBias:{},shadowNormalBias:{},shadowRadius:{},shadowMapSize:{},shadowCameraNear:{},shadowCameraFar:{}}},pointShadowMap:{value:[]},pointShadowMatrix:{value:[]},hemisphereLights:{value:[],properties:{direction:{},skyColor:{},groundColor:{}}},rectAreaLights:{value:[],properties:{color:{},position:{},width:{},height:{}}},ltc_1:{value:null},ltc_2:{value:null}},points:{diffuse:{value:new rs(16777215)},opacity:{value:1},size:{value:1},scale:{value:1},map:{value:null},alphaMap:{value:null},alphaTest:{value:0},uvTransform:{value:new nu}},sprite:{diffuse:{value:new rs(16777215)},opacity:{value:1},center:{value:new Sr(.5,.5)},rotation:{value:0},map:{value:null},alphaMap:{value:null},alphaTest:{value:0},uvTransform:{value:new nu}}},zl={basic:{uniforms:ou([Xr.common,Xr.specularmap,Xr.envmap,Xr.aomap,Xr.lightmap,Xr.fog]),vertexShader:Zs.meshbasic_vert,fragmentShader:Zs.meshbasic_frag},lambert:{uniforms:ou([Xr.common,Xr.specularmap,Xr.envmap,Xr.aomap,Xr.lightmap,Xr.emissivemap,Xr.bumpmap,Xr.normalmap,Xr.displacementmap,Xr.fog,Xr.lights,{emissive:{value:new rs(0)}}]),vertexShader:Zs.meshlambert_vert,fragmentShader:Zs.meshlambert_frag},phong:{uniforms:ou([Xr.common,Xr.specularmap,Xr.envmap,Xr.aomap,Xr.lightmap,Xr.emissivemap,Xr.bumpmap,Xr.normalmap,Xr.displacementmap,Xr.fog,Xr.lights,{emissive:{value:new rs(0)},specular:{value:new rs(1118481)},shininess:{value:30}}]),vertexShader:Zs.meshphong_vert,fragmentShader:Zs.meshphong_frag},standard:{uniforms:ou([Xr.common,Xr.envmap,Xr.aomap,Xr.lightmap,Xr.emissivemap,Xr.bumpmap,Xr.normalmap,Xr.displacementmap,Xr.roughnessmap,Xr.metalnessmap,Xr.fog,Xr.lights,{emissive:{value:new rs(0)},roughness:{value:1},metalness:{value:0},envMapIntensity:{value:1}}]),vertexShader:Zs.meshphysical_vert,fragmentShader:Zs.meshphysical_frag},toon:{uniforms:ou([Xr.common,Xr.aomap,Xr.lightmap,Xr.emissivemap,Xr.bumpmap,Xr.normalmap,Xr.displacementmap,Xr.gradientmap,Xr.fog,Xr.lights,{emissive:{value:new rs(0)}}]),vertexShader:Zs.meshtoon_vert,fragmentShader:Zs.meshtoon_frag},matcap:{uniforms:ou([Xr.common,Xr.bumpmap,Xr.normalmap,Xr.displacementmap,Xr.fog,{matcap:{value:null}}]),vertexShader:Zs.meshmatcap_vert,fragmentShader:Zs.meshmatcap_frag},points:{uniforms:ou([Xr.points,Xr.fog]),vertexShader:Zs.points_vert,fragmentShader:Zs.points_frag},dashed:{uniforms:ou([Xr.common,Xr.fog,{scale:{value:1},dashSize:{value:1},totalSize:{value:2}}]),vertexShader:Zs.linedashed_vert,fragmentShader:Zs.linedashed_frag},depth:{uniforms:ou([Xr.common,Xr.displacementmap]),vertexShader:Zs.depth_vert,fragmentShader:Zs.depth_frag},normal:{uniforms:ou([Xr.common,Xr.bumpmap,Xr.normalmap,Xr.displacementmap,{opacity:{value:1}}]),vertexShader:Zs.meshnormal_vert,fragmentShader:Zs.meshnormal_frag},sprite:{uniforms:ou([Xr.sprite,Xr.fog]),vertexShader:Zs.sprite_vert,fragmentShader:Zs.sprite_frag},background:{uniforms:{uvTransform:{value:new nu},t2D:{value:null},flipX:{value:!1},flipY:{value:!1}},vertexShader:Zs.background_vert,fragmentShader:Zs.background_frag},cube:{uniforms:ou([Xr.envmap,{opacity:{value:1}}]),vertexShader:Zs.cube_vert,fragmentShader:Zs.cube_frag},equirect:{uniforms:{tEquirect:{value:null}},vertexShader:Zs.equirect_vert,fragmentShader:Zs.equirect_frag},distanceRGBA:{uniforms:ou([Xr.common,Xr.displacementmap,{referencePosition:{value:new fn},nearDistance:{value:1},farDistance:{value:1e3}}]),vertexShader:Zs.distanceRGBA_vert,fragmentShader:Zs.distanceRGBA_frag},shadow:{uniforms:ou([Xr.lights,Xr.fog,{color:{value:new rs(0)},opacity:{value:1}}]),vertexShader:Zs.shadow_vert,fragmentShader:Zs.shadow_frag}};function ky(dt,o,g,$,_e,rt){const at=new rs(0);let ct,ft,mt=_e===!0?0:1,bt=null,Tt=0,St=null;function It(Rt,Dt){g.buffers.color.setClear(Rt.r,Rt.g,Rt.b,Dt,rt)}return{getClearColor:function(){return at},setClearColor:function(Rt,Dt=1){at.set(Rt),mt=Dt,It(at,mt)},getClearAlpha:function(){return mt},setClearAlpha:function(Rt){mt=Rt,It(at,mt)},getPlaneMesh:function(){return ct},getBoxMesh:function(){return ft},getBoxMesh2:function(){return ft===void 0&&(ft=new Zl(new E0(1,1,1),new _m({name:"BackgroundCubeMaterial",uniforms:S0(zl.cube.uniforms),vertexShader:zl.cube.vertexShader,fragmentShader:zl.cube.fragmentShader,side:$t,depthTest:!1,depthWrite:!1,fog:!1})),ft.geometry.deleteAttribute("normal"),ft.geometry.deleteAttribute("uv"),ft.onBeforeRender=function(Rt,Dt,Ft){this.matrixWorld.copyPosition(Ft.matrixWorld)},Object.defineProperty(ft.material,"envMap",{get:function(){return this.uniforms.envMap.value}}),$.update(ft)),ft},render:function(Rt,Dt){let Ft=!1,Nt=Dt.isScene===!0?Dt.background:null;Nt&&Nt.isTexture&&(Nt=o.get(Nt));const zt=dt.xr,Xt=zt.getSession&&zt.getSession();Xt&&Xt.environmentBlendMode==="additive"&&(Nt=null),Nt===null?It(at,mt):Nt&&Nt.isColor&&(It(Nt,1),Ft=!0),(dt.autoClear||Ft)&&dt.clear(dt.autoClearColor,dt.autoClearDepth,dt.autoClearStencil),Nt&&(Nt.isCubeTexture||Nt.mapping===Qu)?(ft===void 0&&(ft=new Zl(new E0(1,1,1),new _m({name:"BackgroundCubeMaterial",uniforms:S0(zl.cube.uniforms),vertexShader:zl.cube.vertexShader,fragmentShader:zl.cube.fragmentShader,side:$t,depthTest:!1,depthWrite:!1,fog:!1})),ft.geometry.deleteAttribute("normal"),ft.geometry.deleteAttribute("uv"),ft.onBeforeRender=function(tn,sn,ln){this.matrixWorld.copyPosition(ln.matrixWorld)},Object.defineProperty(ft.material,"envMap",{get:function(){return this.uniforms.envMap.value}}),$.update(ft)),ft.material.uniforms.envMap.value=Nt,ft.material.uniforms.envMapRotation.value=Nt.rotation||0,ft.material.uniforms.flipEnvMap.value=Nt.isCubeTexture&&Nt.isRenderTargetTexture===!1?-1:1,bt===Nt&&Tt===Nt.version&&St===dt.toneMapping||(ft.material.needsUpdate=!0,bt=Nt,Tt=Nt.version,St=dt.toneMapping),ft.layers.enableAll(),Rt.unshift(ft,ft.geometry,ft.material,0,0,null)):Nt&&Nt.isTexture&&(ct===void 0&&(ct=new Zl(new bA(2,2),new _m({name:"BackgroundMaterial",uniforms:S0(zl.background.uniforms),vertexShader:zl.background.vertexShader,fragmentShader:zl.background.fragmentShader,side:_n,depthTest:!1,depthWrite:!1,fog:!1})),ct.geometry.deleteAttribute("normal"),Object.defineProperty(ct.material,"map",{get:function(){return this.uniforms.t2D.value}}),$.update(ct)),ct.material.uniforms.t2D.value=Nt,ct.material.uniforms.flipX.value=Nt.userData.flipX||!1,ct.material.uniforms.flipY.value=Nt.userData.flipY||!1,Nt.matrixAutoUpdate===!0&&Nt.updateMatrix(),ct.material.uniforms.uvTransform.value.copy(Nt.matrix),bt===Nt&&Tt===Nt.version&&St===dt.toneMapping||(ct.material.needsUpdate=!0,bt=Nt,Tt=Nt.version,St=dt.toneMapping),ct.layers.enableAll(),Rt.unshift(ct,ct.geometry,ct.material,0,0,null))}}}function FS(dt,o,g,$){const _e=dt.getParameter(34921),rt=$.isWebGL2?null:o.get("OES_vertex_array_object"),at=$.isWebGL2||rt!==null,ct={},ft=It(null);let mt=ft,bt=!1;function Tt(sn){return $.isWebGL2?dt.bindVertexArray(sn):rt.bindVertexArrayOES(sn)}function St(sn){return $.isWebGL2?dt.deleteVertexArray(sn):rt.deleteVertexArrayOES(sn)}function It(sn){const ln=[],kn=[],Ln=[];for(let qn=0;qn<_e;qn++)ln[qn]=0,kn[qn]=0,Ln[qn]=0;return{geometry:null,program:null,wireframe:!1,newAttributes:ln,enabledAttributes:kn,attributeDivisors:Ln,object:sn,attributes:{},index:null}}function Rt(){const sn=mt.newAttributes;for(let ln=0,kn=sn.length;ln<kn;ln++)sn[ln]=0}function Dt(sn){Ft(sn,0)}function Ft(sn,ln){const kn=mt.newAttributes,Ln=mt.enabledAttributes,qn=mt.attributeDivisors;kn[sn]=1,Ln[sn]===0&&(dt.enableVertexAttribArray(sn),Ln[sn]=1),qn[sn]!==ln&&(($.isWebGL2?dt:o.get("ANGLE_instanced_arrays"))[$.isWebGL2?"vertexAttribDivisor":"vertexAttribDivisorANGLE"](sn,ln),qn[sn]=ln)}function Nt(){const sn=mt.newAttributes,ln=mt.enabledAttributes;for(let kn=0,Ln=ln.length;kn<Ln;kn++)ln[kn]!==sn[kn]&&(dt.disableVertexAttribArray(kn),ln[kn]=0)}function zt(sn,ln,kn,Ln,qn,Kn){$.isWebGL2!==!0||kn!==5124&&kn!==5125?dt.vertexAttribPointer(sn,ln,kn,Ln,qn,Kn):dt.vertexAttribIPointer(sn,ln,kn,qn,Kn)}function Xt(){tn(),bt=!0,mt!==ft&&(mt=ft,Tt(mt.object))}function tn(){ft.geometry=null,ft.program=null,ft.wireframe=!1}return{setup:function(sn,ln,kn,Ln,qn){let Kn=!1;if(at){const On=function(_r,Tr,gr){const Or=gr.wireframe===!0;let Gr=ct[_r.id];Gr===void 0&&(Gr={},ct[_r.id]=Gr);let cr=Gr[Tr.id];cr===void 0&&(cr={},Gr[Tr.id]=cr);let ur=cr[Or];return ur===void 0&&(ur=It($.isWebGL2?dt.createVertexArray():rt.createVertexArrayOES()),cr[Or]=ur),ur}(Ln,kn,ln);mt!==On&&(mt=On,Tt(mt.object)),Kn=function(_r,Tr,gr,Or){const Gr=mt.attributes,cr=Tr.attributes;let ur=0;const Fr=gr.getAttributes();for(const Ar in Fr)if(Fr[Ar].location>=0){const Qr=Gr[Ar];let as=cr[Ar];if(as===void 0&&(Ar==="instanceMatrix"&&_r.instanceMatrix&&(as=_r.instanceMatrix),Ar==="instanceColor"&&_r.instanceColor&&(as=_r.instanceColor)),Qr===void 0||Qr.attribute!==as||as&&Qr.data!==as.data)return!0;ur++}return mt.attributesNum!==ur||mt.index!==Or}(sn,Ln,kn,qn),Kn&&function(_r,Tr,gr,Or){const Gr={},cr=Tr.attributes;let ur=0;const Fr=gr.getAttributes();for(const Ar in Fr)if(Fr[Ar].location>=0){let Qr=cr[Ar];Qr===void 0&&(Ar==="instanceMatrix"&&_r.instanceMatrix&&(Qr=_r.instanceMatrix),Ar==="instanceColor"&&_r.instanceColor&&(Qr=_r.instanceColor));const as={};as.attribute=Qr,Qr&&Qr.data&&(as.data=Qr.data),Gr[Ar]=as,ur++}mt.attributes=Gr,mt.attributesNum=ur,mt.index=Or}(sn,Ln,kn,qn)}else{const On=ln.wireframe===!0;mt.geometry===Ln.id&&mt.program===kn.id&&mt.wireframe===On||(mt.geometry=Ln.id,mt.program=kn.id,mt.wireframe=On,Kn=!0)}qn!==null&&g.update(qn,34963),(Kn||bt)&&(bt=!1,function(On,_r,Tr,gr){if($.isWebGL2===!1&&(On.isInstancedMesh||gr.isInstancedBufferGeometry)&&o.get("ANGLE_instanced_arrays")===null)return;Rt();const Or=gr.attributes,Gr=Tr.getAttributes(),cr=_r.defaultAttributeValues;for(const ur in Gr){const Fr=Gr[ur];if(Fr.location>=0){let Ar=Or[ur];if(Ar===void 0&&(ur==="instanceMatrix"&&On.instanceMatrix&&(Ar=On.instanceMatrix),ur==="instanceColor"&&On.instanceColor&&(Ar=On.instanceColor)),Ar!==void 0){const Qr=Ar.normalized,as=Ar.itemSize,Qs=g.get(Ar);if(Qs===void 0)continue;const ys=Qs.buffer,Hs=Qs.type,Dn=Qs.bytesPerElement;if(Ar.isInterleavedBufferAttribute){const yn=Ar.data,tr=yn.stride,Hn=Ar.offset;if(yn.isInstancedInterleavedBuffer){for(let In=0;In<Fr.locationSize;In++)Ft(Fr.location+In,yn.meshPerAttribute);On.isInstancedMesh!==!0&&gr._maxInstanceCount===void 0&&(gr._maxInstanceCount=yn.meshPerAttribute*yn.count)}else for(let In=0;In<Fr.locationSize;In++)Dt(Fr.location+In);dt.bindBuffer(34962,ys);for(let In=0;In<Fr.locationSize;In++)zt(Fr.location+In,as/Fr.locationSize,Hs,Qr,tr*Dn,(Hn+as/Fr.locationSize*In)*Dn)}else{if(Ar.isInstancedBufferAttribute){for(let yn=0;yn<Fr.locationSize;yn++)Ft(Fr.location+yn,Ar.meshPerAttribute);On.isInstancedMesh!==!0&&gr._maxInstanceCount===void 0&&(gr._maxInstanceCount=Ar.meshPerAttribute*Ar.count)}else for(let yn=0;yn<Fr.locationSize;yn++)Dt(Fr.location+yn);dt.bindBuffer(34962,ys);for(let yn=0;yn<Fr.locationSize;yn++)zt(Fr.location+yn,as/Fr.locationSize,Hs,Qr,as*Dn,as/Fr.locationSize*yn*Dn)}}else if(cr!==void 0){const Qr=cr[ur];if(Qr!==void 0)switch(Qr.length){case 2:dt.vertexAttrib2fv(Fr.location,Qr);break;case 3:dt.vertexAttrib3fv(Fr.location,Qr);break;case 4:dt.vertexAttrib4fv(Fr.location,Qr);break;default:dt.vertexAttrib1fv(Fr.location,Qr)}}}}Nt()}(sn,ln,kn,Ln),qn!==null&&dt.bindBuffer(34963,g.get(qn).buffer))},reset:Xt,resetDefaultState:tn,dispose:function(){Xt();for(const sn in ct){const ln=ct[sn];for(const kn in ln){const Ln=ln[kn];for(const qn in Ln)St(Ln[qn].object),delete Ln[qn];delete ln[kn]}delete ct[sn]}},releaseStatesOfGeometry:function(sn){if(ct[sn.id]===void 0)return;const ln=ct[sn.id];for(const kn in ln){const Ln=ln[kn];for(const qn in Ln)St(Ln[qn].object),delete Ln[qn];delete ln[kn]}delete ct[sn.id]},releaseStatesOfProgram:function(sn){for(const ln in ct){const kn=ct[ln];if(kn[sn.id]===void 0)continue;const Ln=kn[sn.id];for(const qn in Ln)St(Ln[qn].object),delete Ln[qn];delete kn[sn.id]}},initAttributes:Rt,enableAttribute:Dt,disableUnusedAttributes:Nt}}function Yw(dt,o,g,$){const _e=$.isWebGL2;let rt;this.setMode=function(at){rt=at},this.render=function(at,ct){dt.drawArrays(rt,at,ct),g.update(ct,rt,1)},this.renderInstances=function(at,ct,ft){if(ft===0)return;let mt,bt;if(_e)mt=dt,bt="drawArraysInstanced";else if(mt=o.get("ANGLE_instanced_arrays"),bt="drawArraysInstancedANGLE",mt===null)return void console.error("THREE.WebGLBufferRenderer: using THREE.InstancedBufferGeometry but hardware does not support extension ANGLE_instanced_arrays.");mt[bt](rt,at,ct,ft),g.update(ct,rt,ft)}}function iD(dt,o,g){let $;function _e(tn){if(tn==="highp"){if(dt.getShaderPrecisionFormat(35633,36338).precision>0&&dt.getShaderPrecisionFormat(35632,36338).precision>0)return"highp";tn="mediump"}return tn==="mediump"&&dt.getShaderPrecisionFormat(35633,36337).precision>0&&dt.getShaderPrecisionFormat(35632,36337).precision>0?"mediump":"lowp"}const rt=typeof WebGL2RenderingContext<"u"&&dt instanceof WebGL2RenderingContext||typeof WebGL2ComputeRenderingContext<"u"&&dt instanceof WebGL2ComputeRenderingContext;let at=g.precision!==void 0?g.precision:"highp";const ct=_e(at);ct!==at&&(console.warn("THREE.WebGLRenderer:",at,"not supported, using",ct,"instead."),at=ct);const ft=rt||o.has("WEBGL_draw_buffers"),mt=g.logarithmicDepthBuffer===!0,bt=dt.getParameter(34930),Tt=dt.getParameter(35660),St=dt.getParameter(3379),It=dt.getParameter(34076),Rt=dt.getParameter(34921),Dt=dt.getParameter(36347),Ft=dt.getParameter(36348),Nt=dt.getParameter(36349),zt=Tt>0,Xt=rt||o.has("OES_texture_float");return{isWebGL2:rt,drawBuffers:ft,getMaxAnisotropy:function(){if($!==void 0)return $;if(o.has("EXT_texture_filter_anisotropic")===!0){const tn=o.get("EXT_texture_filter_anisotropic");$=dt.getParameter(tn.MAX_TEXTURE_MAX_ANISOTROPY_EXT)}else $=0;return $},getMaxPrecision:_e,precision:at,logarithmicDepthBuffer:mt,maxTextures:bt,maxVertexTextures:Tt,maxTextureSize:St,maxCubemapSize:It,maxAttributes:Rt,maxVertexUniforms:Dt,maxVaryings:Ft,maxFragmentUniforms:Nt,vertexTextures:zt,floatFragmentTextures:Xt,floatVertexTextures:zt&&Xt,maxSamples:rt?dt.getParameter(36183):0}}function rD(dt){const o=this;let g=null,$=0,_e=!1,rt=!1;const at=new C0,ct=new nu,ft={value:null,needsUpdate:!1};function mt(){ft.value!==g&&(ft.value=g,ft.needsUpdate=$>0),o.numPlanes=$,o.numIntersection=0}function bt(Tt,St,It,Rt){const Dt=Tt!==null?Tt.length:0;let Ft=null;if(Dt!==0){if(Ft=ft.value,Rt!==!0||Ft===null){const Nt=It+4*Dt,zt=St.matrixWorldInverse;ct.getNormalMatrix(zt),(Ft===null||Ft.length<Nt)&&(Ft=new Float32Array(Nt));for(let Xt=0,tn=It;Xt!==Dt;++Xt,tn+=4)at.copy(Tt[Xt]).applyMatrix4(zt,ct),at.normal.toArray(Ft,tn),Ft[tn+3]=at.constant}ft.value=Ft,ft.needsUpdate=!0}return o.numPlanes=Dt,o.numIntersection=0,Ft}this.uniform=ft,this.numPlanes=0,this.numIntersection=0,this.init=function(Tt,St,It){const Rt=Tt.length!==0||St||$!==0||_e;return _e=St,g=bt(Tt,It,0),$=Tt.length,Rt},this.beginShadows=function(){rt=!0,bt(null)},this.endShadows=function(){rt=!1,mt()},this.setState=function(Tt,St,It){const Rt=Tt.clippingPlanes,Dt=Tt.clipIntersection,Ft=Tt.clipShadows,Nt=dt.get(Tt);if(!_e||Rt===null||Rt.length===0||rt&&!Ft)rt?bt(null):mt();else{const zt=rt?0:$,Xt=4*zt;let tn=Nt.clippingState||null;ft.value=tn,tn=bt(Rt,St,Xt,It);for(let sn=0;sn!==Xt;++sn)tn[sn]=g[sn];Nt.clippingState=tn,this.numIntersection=Dt?this.numPlanes:0,this.numPlanes+=zt}}}function sD(dt){let o=new WeakMap;function g(_e,rt){return rt===Hl?_e.mapping=$a:rt===Io&&(_e.mapping=ko),_e}function $(_e){const rt=_e.target;rt.removeEventListener("dispose",$);const at=o.get(rt);at!==void 0&&(o.delete(rt),at.dispose())}return{get:function(_e){if(_e&&_e.isTexture&&_e.isRenderTargetTexture===!1){const rt=_e.mapping;if(rt===Hl||rt===Io){if(o.has(_e)){const at=o.get(_e).texture;return at.rotation=_e.rotation,g(at,_e.mapping)}{const at=_e.image;if(at&&at.height>0){const ct=new k1(at.height/2);return ct.fromEquirectangularTexture(dt,_e),ct.texture.rotation=_e.rotation,o.set(_e,ct),_e.addEventListener("dispose",$),g(ct.texture,_e.mapping)}return null}}}return _e},dispose:function(){o=new WeakMap}}}zl.physical={uniforms:ou([zl.standard.uniforms,{clearcoat:{value:0},clearcoatMap:{value:null},clearcoatRoughness:{value:0},clearcoatRoughnessMap:{value:null},clearcoatNormalScale:{value:new Sr(1,1)},clearcoatNormalMap:{value:null},iridescence:{value:0},iridescenceMap:{value:null},iridescenceIOR:{value:1.3},iridescenceThicknessMinimum:{value:100},iridescenceThicknessMaximum:{value:400},iridescenceThicknessMap:{value:null},sheen:{value:0},sheenColor:{value:new rs(0)},sheenColorMap:{value:null},sheenRoughness:{value:1},sheenRoughnessMap:{value:null},transmission:{value:0},transmissionMap:{value:null},transmissionSamplerSize:{value:new Sr},transmissionSamplerMap:{value:null},thickness:{value:0},thicknessMap:{value:null},attenuationDistance:{value:0},attenuationColor:{value:new rs(0)},specularIntensity:{value:1},specularIntensityMap:{value:null},specularColor:{value:new rs(1,1,1)},specularColorMap:{value:null}}]),vertexShader:Zs.meshphysical_vert,fragmentShader:Zs.meshphysical_frag};class U1 extends xA{constructor(o=-1,g=1,$=1,_e=-1,rt=.1,at=2e3){super(),this.isOrthographicCamera=!0,this.type="OrthographicCamera",this.zoom=1,this.view=null,this.left=o,this.right=g,this.top=$,this.bottom=_e,this.near=rt,this.far=at,this.updateProjectionMatrix()}copy(o,g){return super.copy(o,g),this.left=o.left,this.right=o.right,this.top=o.top,this.bottom=o.bottom,this.near=o.near,this.far=o.far,this.zoom=o.zoom,this.view=o.view===null?null:Object.assign({},o.view),this}setViewOffset(o,g,$,_e,rt,at){this.view===null&&(this.view={enabled:!0,fullWidth:1,fullHeight:1,offsetX:0,offsetY:0,width:1,height:1}),this.view.enabled=!0,this.view.fullWidth=o,this.view.fullHeight=g,this.view.offsetX=$,this.view.offsetY=_e,this.view.width=rt,this.view.height=at,this.updateProjectionMatrix()}clearViewOffset(){this.view!==null&&(this.view.enabled=!1),this.updateProjectionMatrix()}updateProjectionMatrix(){const o=(this.right-this.left)/(2*this.zoom),g=(this.top-this.bottom)/(2*this.zoom),$=(this.right+this.left)/2,_e=(this.top+this.bottom)/2;let rt=$-o,at=$+o,ct=_e+g,ft=_e-g;if(this.view!==null&&this.view.enabled){const mt=(this.right-this.left)/this.view.fullWidth/this.zoom,bt=(this.top-this.bottom)/this.view.fullHeight/this.zoom;rt+=mt*this.view.offsetX,at=rt+mt*this.view.width,ct-=bt*this.view.offsetY,ft=ct-bt*this.view.height}this.projectionMatrix.makeOrthographic(rt,at,ct,ft,this.near,this.far),this.projectionMatrixInverse.copy(this.projectionMatrix).invert()}toJSON(o){const g=super.toJSON(o);return g.object.zoom=this.zoom,g.object.left=this.left,g.object.right=this.right,g.object.top=this.top,g.object.bottom=this.bottom,g.object.near=this.near,g.object.far=this.far,this.view!==null&&(g.object.view=Object.assign({},this.view)),g}}const jS=[.125,.215,.35,.446,.526,.582],F1=new U1,UM=new rs;let zS=null;const EA=(1+Math.sqrt(5))/2,Oy=1/EA,VS=[new fn(1,1,1),new fn(-1,1,1),new fn(1,1,-1),new fn(-1,1,-1),new fn(0,EA,Oy),new fn(0,EA,-Oy),new fn(Oy,0,EA),new fn(-Oy,0,EA),new fn(EA,Oy,0),new fn(-EA,Oy,0)];class Xw{constructor(o){this._renderer=o,this._pingPongRenderTarget=null,this._lodMax=0,this._cubeSize=0,this._lodPlanes=[],this._sizeLods=[],this._sigmas=[],this._blurMaterial=null,this._cubemapMaterial=null,this._equirectMaterial=null,this._compileMaterial(this._blurMaterial)}fromScene(o,g=0,$=.1,_e=100){zS=this._renderer.getRenderTarget(),this._setSize(256);const rt=this._allocateTargets();return rt.depthBuffer=!0,this._sceneToCubeUV(o,$,_e,rt),g>0&&this._blur(rt,0,0,g),this._applyPMREM(rt),this._cleanup(rt),rt}fromEquirectangular(o,g=null){return this._fromTexture(o,g)}fromCubemap(o,g=null){return this._fromTexture(o,g)}compileCubemapShader(){this._cubemapMaterial===null&&(this._cubemapMaterial=HS(),this._compileMaterial(this._cubemapMaterial))}compileEquirectangularShader(){this._equirectMaterial===null&&(this._equirectMaterial=GS(),this._compileMaterial(this._equirectMaterial))}dispose(){this._dispose(),this._cubemapMaterial!==null&&this._cubemapMaterial.dispose(),this._equirectMaterial!==null&&this._equirectMaterial.dispose()}_setSize(o){this._lodMax=Math.floor(Math.log2(o)),this._cubeSize=Math.pow(2,this._lodMax)}_dispose(){this._blurMaterial!==null&&this._blurMaterial.dispose(),this._pingPongRenderTarget!==null&&this._pingPongRenderTarget.dispose();for(let o=0;o<this._lodPlanes.length;o++)this._lodPlanes[o].dispose()}_cleanup(o){this._renderer.setRenderTarget(zS),o.scissorTest=!1,SA(o,0,0,o.width,o.height)}_fromTexture(o,g){o.mapping===$a||o.mapping===ko?this._setSize(o.image.length===0?16:o.image[0].width||o.image[0].image.width):this._setSize(o.image.width/4),zS=this._renderer.getRenderTarget();const $=g||this._allocateTargets();return this._textureToCubeUV(o,$),this._applyPMREM($),this._cleanup($),$}_allocateTargets(){const o=3*Math.max(this._cubeSize,112),g=4*this._cubeSize,$={magFilter:xa,minFilter:xa,generateMipmaps:!1,type:lm,format:Hu,encoding:qu,depthBuffer:!1},_e=QS(o,g,$);if(this._pingPongRenderTarget===null||this._pingPongRenderTarget.width!==o){this._pingPongRenderTarget!==null&&this._dispose(),this._pingPongRenderTarget=QS(o,g,$);const{_lodMax:rt}=this;({sizeLods:this._sizeLods,lodPlanes:this._lodPlanes,sigmas:this._sigmas}=function(at){const ct=[],ft=[],mt=[];let bt=at;const Tt=at-4+1+jS.length;for(let St=0;St<Tt;St++){const It=Math.pow(2,bt);ft.push(It);let Rt=1/It;St>at-4?Rt=jS[St-at+4-1]:St===0&&(Rt=0),mt.push(Rt);const Dt=1/(It-2),Ft=-Dt,Nt=1+Dt,zt=[Ft,Ft,Nt,Ft,Nt,Nt,Ft,Ft,Nt,Nt,Ft,Nt],Xt=6,tn=6,sn=3,ln=2,kn=1,Ln=new Float32Array(sn*tn*Xt),qn=new Float32Array(ln*tn*Xt),Kn=new Float32Array(kn*tn*Xt);for(let _r=0;_r<Xt;_r++){const Tr=_r%3*2/3-1,gr=_r>2?0:-1,Or=[Tr,gr,0,Tr+2/3,gr,0,Tr+2/3,gr+1,0,Tr,gr,0,Tr+2/3,gr+1,0,Tr,gr+1,0];Ln.set(Or,sn*tn*_r),qn.set(zt,ln*tn*_r);const Gr=[_r,_r,_r,_r,_r,_r];Kn.set(Gr,kn*tn*_r)}const On=new fs;On.setAttribute("position",new Ro(Ln,sn)),On.setAttribute("uv",new Ro(qn,ln)),On.setAttribute("faceIndex",new Ro(Kn,kn)),ct.push(On),bt>4&&bt--}return{lodPlanes:ct,sizeLods:ft,sigmas:mt}}(rt)),this._blurMaterial=function(at,ct,ft){const mt=new Float32Array(20),bt=new fn(0,1,0);return new _m({name:"SphericalGaussianBlur",defines:{n:20,CUBEUV_TEXEL_WIDTH:1/ct,CUBEUV_TEXEL_HEIGHT:1/ft,CUBEUV_MAX_MIP:`${at}.0`},uniforms:{envMap:{value:null},samples:{value:1},weights:{value:mt},latitudinal:{value:!1},dTheta:{value:0},mipInt:{value:0},poleAxis:{value:bt}},vertexShader:`

		precision mediump float;
		precision mediump int;

		attribute float faceIndex;

		varying vec3 vOutputDirection;

		// RH coordinate system; PMREM face-indexing convention
		vec3 getDirection( vec2 uv, float face ) {

			uv = 2.0 * uv - 1.0;

			vec3 direction = vec3( uv, 1.0 );

			if ( face == 0.0 ) {

				direction = direction.zyx; // ( 1, v, u ) pos x

			} else if ( face == 1.0 ) {

				direction = direction.xzy;
				direction.xz *= -1.0; // ( -u, 1, -v ) pos y

			} else if ( face == 2.0 ) {

				direction.x *= -1.0; // ( -u, v, 1 ) pos z

			} else if ( face == 3.0 ) {

				direction = direction.zyx;
				direction.xz *= -1.0; // ( -1, v, -u ) neg x

			} else if ( face == 4.0 ) {

				direction = direction.xzy;
				direction.xy *= -1.0; // ( -u, -1, v ) neg y

			} else if ( face == 5.0 ) {

				direction.z *= -1.0; // ( u, v, -1 ) neg z

			}

			return direction;

		}

		void main() {

			vOutputDirection = getDirection( uv, faceIndex );
			gl_Position = vec4( position, 1.0 );

		}
	`,fragmentShader:`

			precision mediump float;
			precision mediump int;

			varying vec3 vOutputDirection;

			uniform sampler2D envMap;
			uniform int samples;
			uniform float weights[ n ];
			uniform bool latitudinal;
			uniform float dTheta;
			uniform float mipInt;
			uniform vec3 poleAxis;

			#define ENVMAP_TYPE_CUBE_UV
			#include <cube_uv_reflection_fragment>

			vec3 getSample( float theta, vec3 axis ) {

				float cosTheta = cos( theta );
				// Rodrigues' axis-angle rotation
				vec3 sampleDirection = vOutputDirection * cosTheta
					+ cross( axis, vOutputDirection ) * sin( theta )
					+ axis * dot( axis, vOutputDirection ) * ( 1.0 - cosTheta );

				return bilinearCubeUV( envMap, sampleDirection, mipInt );

			}

			void main() {

				vec3 axis = latitudinal ? poleAxis : cross( poleAxis, vOutputDirection );

				if ( all( equal( axis, vec3( 0.0 ) ) ) ) {

					axis = vec3( vOutputDirection.z, 0.0, - vOutputDirection.x );

				}

				axis = normalize( axis );

				gl_FragColor = vec4( 0.0, 0.0, 0.0, 1.0 );
				gl_FragColor.rgb += weights[ 0 ] * getSample( 0.0, axis );

				for ( int i = 1; i < n; i++ ) {

					if ( i >= samples ) {

						break;

					}

					float theta = dTheta * float( i );
					gl_FragColor.rgb += weights[ i ] * getSample( -1.0 * theta, axis );
					gl_FragColor.rgb += weights[ i ] * getSample( theta, axis );

				}

			}
		`,blending:Ut,depthTest:!1,depthWrite:!1})}(rt,o,g)}return _e}_compileMaterial(o){const g=new Zl(this._lodPlanes[0],o);this._renderer.compile(g,F1)}_sceneToCubeUV(o,g,$,_e){const rt=new wu(90,1,g,$),at=[1,-1,1,1,1,1],ct=[1,1,1,-1,-1,-1],ft=this._renderer,mt=ft.autoClear,bt=ft.toneMapping;ft.getClearColor(UM),ft.toneMapping=Ks,ft.autoClear=!1;const Tt=new gm({name:"PMREM.Background",side:$t,depthWrite:!1,depthTest:!1}),St=new Zl(new E0,Tt);let It=!1;const Rt=o.background;Rt?Rt.isColor&&(Tt.color.copy(Rt),o.background=null,It=!0):(Tt.color.copy(UM),It=!0);for(let Dt=0;Dt<6;Dt++){const Ft=Dt%3;Ft===0?(rt.up.set(0,at[Dt],0),rt.lookAt(ct[Dt],0,0)):Ft===1?(rt.up.set(0,0,at[Dt]),rt.lookAt(0,ct[Dt],0)):(rt.up.set(0,at[Dt],0),rt.lookAt(0,0,ct[Dt]));const Nt=this._cubeSize;SA(_e,Ft*Nt,Dt>2?Nt:0,Nt,Nt),ft.setRenderTarget(_e),It&&ft.render(St,rt),ft.render(o,rt)}St.geometry.dispose(),St.material.dispose(),ft.toneMapping=bt,ft.autoClear=mt,o.background=Rt}_textureToCubeUV(o,g){const $=this._renderer,_e=o.mapping===$a||o.mapping===ko;_e?(this._cubemapMaterial===null&&(this._cubemapMaterial=HS()),this._cubemapMaterial.uniforms.flipEnvMap.value=o.isRenderTargetTexture===!1?-1:1):this._equirectMaterial===null&&(this._equirectMaterial=GS());const rt=_e?this._cubemapMaterial:this._equirectMaterial,at=new Zl(this._lodPlanes[0],rt);rt.uniforms.envMap.value=o;const ct=this._cubeSize;SA(g,0,0,3*ct,2*ct),$.setRenderTarget(g),$.render(at,F1)}_applyPMREM(o){const g=this._renderer,$=g.autoClear;g.autoClear=!1;for(let _e=1;_e<this._lodPlanes.length;_e++){const rt=Math.sqrt(this._sigmas[_e]*this._sigmas[_e]-this._sigmas[_e-1]*this._sigmas[_e-1]),at=VS[(_e-1)%VS.length];this._blur(o,_e-1,_e,rt,at)}g.autoClear=$}_blur(o,g,$,_e,rt){const at=this._pingPongRenderTarget;this._halfBlur(o,at,g,$,_e,"latitudinal",rt),this._halfBlur(at,o,$,$,_e,"longitudinal",rt)}_halfBlur(o,g,$,_e,rt,at,ct){const ft=this._renderer,mt=this._blurMaterial;at!=="latitudinal"&&at!=="longitudinal"&&console.error("blur direction must be either latitudinal or longitudinal!");const bt=new Zl(this._lodPlanes[_e],mt),Tt=mt.uniforms,St=this._sizeLods[$]-1,It=isFinite(rt)?Math.PI/(2*St):2*Math.PI/39,Rt=rt/It,Dt=isFinite(rt)?1+Math.floor(3*Rt):20;Dt>20&&console.warn(`sigmaRadians, ${rt}, is too large and will clip, as it requested ${Dt} samples when the maximum is set to 20`);const Ft=[];let Nt=0;for(let tn=0;tn<20;++tn){const sn=tn/Rt,ln=Math.exp(-sn*sn/2);Ft.push(ln),tn===0?Nt+=ln:tn<Dt&&(Nt+=2*ln)}for(let tn=0;tn<Ft.length;tn++)Ft[tn]=Ft[tn]/Nt;Tt.envMap.value=o.texture,Tt.samples.value=Dt,Tt.weights.value=Ft,Tt.latitudinal.value=at==="latitudinal",ct&&(Tt.poleAxis.value=ct);const{_lodMax:zt}=this;Tt.dTheta.value=It,Tt.mipInt.value=zt-$;const Xt=this._sizeLods[_e];SA(g,3*Xt*(_e>zt-4?_e-zt+4:0),4*(this._cubeSize-Xt),3*Xt,2*Xt),ft.setRenderTarget(g),ft.render(bt,F1)}}function QS(dt,o,g){const $=new ap(dt,o,g);return $.texture.mapping=Qu,$.texture.name="PMREM.cubeUv",$.scissorTest=!0,$}function SA(dt,o,g,$,_e){dt.viewport.set(o,g,$,_e),dt.scissor.set(o,g,$,_e)}function GS(){return new _m({name:"EquirectangularToCubeUV",uniforms:{envMap:{value:null}},vertexShader:`

		precision mediump float;
		precision mediump int;

		attribute float faceIndex;

		varying vec3 vOutputDirection;

		// RH coordinate system; PMREM face-indexing convention
		vec3 getDirection( vec2 uv, float face ) {

			uv = 2.0 * uv - 1.0;

			vec3 direction = vec3( uv, 1.0 );

			if ( face == 0.0 ) {

				direction = direction.zyx; // ( 1, v, u ) pos x

			} else if ( face == 1.0 ) {

				direction = direction.xzy;
				direction.xz *= -1.0; // ( -u, 1, -v ) pos y

			} else if ( face == 2.0 ) {

				direction.x *= -1.0; // ( -u, v, 1 ) pos z

			} else if ( face == 3.0 ) {

				direction = direction.zyx;
				direction.xz *= -1.0; // ( -1, v, -u ) neg x

			} else if ( face == 4.0 ) {

				direction = direction.xzy;
				direction.xy *= -1.0; // ( -u, -1, v ) neg y

			} else if ( face == 5.0 ) {

				direction.z *= -1.0; // ( u, v, -1 ) neg z

			}

			return direction;

		}

		void main() {

			vOutputDirection = getDirection( uv, faceIndex );
			gl_Position = vec4( position, 1.0 );

		}
	`,fragmentShader:`

			precision mediump float;
			precision mediump int;

			varying vec3 vOutputDirection;

			uniform sampler2D envMap;

			#include <common>

			void main() {

				vec3 outputDirection = normalize( vOutputDirection );
				vec2 uv = equirectUv( outputDirection );

				gl_FragColor = vec4( texture2D ( envMap, uv ).rgb, 1.0 );

			}
		`,blending:Ut,depthTest:!1,depthWrite:!1})}function HS(){return new _m({name:"CubemapToCubeUV",uniforms:{envMap:{value:null},flipEnvMap:{value:-1}},vertexShader:`

		precision mediump float;
		precision mediump int;

		attribute float faceIndex;

		varying vec3 vOutputDirection;

		// RH coordinate system; PMREM face-indexing convention
		vec3 getDirection( vec2 uv, float face ) {

			uv = 2.0 * uv - 1.0;

			vec3 direction = vec3( uv, 1.0 );

			if ( face == 0.0 ) {

				direction = direction.zyx; // ( 1, v, u ) pos x

			} else if ( face == 1.0 ) {

				direction = direction.xzy;
				direction.xz *= -1.0; // ( -u, 1, -v ) pos y

			} else if ( face == 2.0 ) {

				direction.x *= -1.0; // ( -u, v, 1 ) pos z

			} else if ( face == 3.0 ) {

				direction = direction.zyx;
				direction.xz *= -1.0; // ( -1, v, -u ) neg x

			} else if ( face == 4.0 ) {

				direction = direction.xzy;
				direction.xy *= -1.0; // ( -u, -1, v ) neg y

			} else if ( face == 5.0 ) {

				direction.z *= -1.0; // ( u, v, -1 ) neg z

			}

			return direction;

		}

		void main() {

			vOutputDirection = getDirection( uv, faceIndex );
			gl_Position = vec4( position, 1.0 );

		}
	`,fragmentShader:`

			precision mediump float;
			precision mediump int;

			uniform float flipEnvMap;

			varying vec3 vOutputDirection;

			uniform samplerCube envMap;

			void main() {

				gl_FragColor = textureCube( envMap, vec3( flipEnvMap * vOutputDirection.x, vOutputDirection.yz ) );

			}
		`,blending:Ut,depthTest:!1,depthWrite:!1})}function FM(dt){let o=new WeakMap,g=null;function $(_e){const rt=_e.target;rt.removeEventListener("dispose",$);const at=o.get(rt);at!==void 0&&(o.delete(rt),at.dispose())}return{get:function(_e){if(_e&&_e.isTexture){const rt=_e.mapping,at=rt===Hl||rt===Io,ct=rt===$a||rt===ko;if(at||ct){if(_e.isRenderTargetTexture&&_e.needsPMREMUpdate===!0){_e.needsPMREMUpdate=!1;let ft=o.get(_e);return g===null&&(g=new Xw(dt)),ft=at?g.fromEquirectangular(_e,ft):g.fromCubemap(_e,ft),o.set(_e,ft),ft.texture}if(o.has(_e))return o.get(_e).texture;{const ft=_e.image;if(at&&ft&&ft.height>0||ct&&ft&&function(mt){let bt=0;for(let Tt=0;Tt<6;Tt++)mt[Tt]!==void 0&&bt++;return bt===6}(ft)){g===null&&(g=new Xw(dt));const mt=at?g.fromEquirectangular(_e):g.fromCubemap(_e);return o.set(_e,mt),_e.addEventListener("dispose",$),mt.texture}return null}}}return _e},dispose:function(){o=new WeakMap,g!==null&&(g.dispose(),g=null)}}}function oD(dt){const o={};function g($){if(o[$]!==void 0)return o[$];let _e;switch($){case"WEBGL_depth_texture":_e=dt.getExtension("WEBGL_depth_texture")||dt.getExtension("MOZ_WEBGL_depth_texture")||dt.getExtension("WEBKIT_WEBGL_depth_texture");break;case"EXT_texture_filter_anisotropic":_e=dt.getExtension("EXT_texture_filter_anisotropic")||dt.getExtension("MOZ_EXT_texture_filter_anisotropic")||dt.getExtension("WEBKIT_EXT_texture_filter_anisotropic");break;case"WEBGL_compressed_texture_s3tc":_e=dt.getExtension("WEBGL_compressed_texture_s3tc")||dt.getExtension("MOZ_WEBGL_compressed_texture_s3tc")||dt.getExtension("WEBKIT_WEBGL_compressed_texture_s3tc");break;case"WEBGL_compressed_texture_pvrtc":_e=dt.getExtension("WEBGL_compressed_texture_pvrtc")||dt.getExtension("WEBKIT_WEBGL_compressed_texture_pvrtc");break;default:_e=dt.getExtension($)}return o[$]=_e,_e}return{has:function($){return g($)!==null},init:function($){$.isWebGL2?g("EXT_color_buffer_float"):(g("WEBGL_depth_texture"),g("OES_texture_float"),g("OES_texture_half_float"),g("OES_texture_half_float_linear"),g("OES_standard_derivatives"),g("OES_element_index_uint"),g("OES_vertex_array_object"),g("ANGLE_instanced_arrays")),g("OES_texture_float_linear"),g("EXT_color_buffer_half_float"),g("WEBGL_multisampled_render_to_texture")},get:function($){const _e=g($);return _e===null&&console.warn("THREE.WebGLRenderer: "+$+" extension not supported."),_e}}}function aD(dt,o,g,$){const _e={},rt=new WeakMap;function at(ft){const mt=ft.target;mt.index!==null&&o.remove(mt.index);for(const Tt in mt.attributes)o.remove(mt.attributes[Tt]);mt.removeEventListener("dispose",at),delete _e[mt.id];const bt=rt.get(mt);bt&&(o.remove(bt),rt.delete(mt)),$.releaseStatesOfGeometry(mt),mt.isInstancedBufferGeometry===!0&&delete mt._maxInstanceCount,g.memory.geometries--}function ct(ft){const mt=[],bt=ft.index,Tt=ft.attributes.position;let St=0;if(bt!==null){const Dt=bt.array;St=bt.version;for(let Ft=0,Nt=Dt.length;Ft<Nt;Ft+=3){const zt=Dt[Ft+0],Xt=Dt[Ft+1],tn=Dt[Ft+2];mt.push(zt,Xt,Xt,tn,tn,zt)}}else{const Dt=Tt.array;St=Tt.version;for(let Ft=0,Nt=Dt.length/3-1;Ft<Nt;Ft+=3){const zt=Ft+0,Xt=Ft+1,tn=Ft+2;mt.push(zt,Xt,Xt,tn,tn,zt)}}const It=new(E1(mt)?At:g_)(mt,1);It.version=St;const Rt=rt.get(ft);Rt&&o.remove(Rt),rt.set(ft,It)}return{get:function(ft,mt){return _e[mt.id]===!0||(mt.addEventListener("dispose",at),_e[mt.id]=!0,g.memory.geometries++),mt},update:function(ft){const mt=ft.attributes;for(const Tt in mt)o.update(mt[Tt],34962);const bt=ft.morphAttributes;for(const Tt in bt){const St=bt[Tt];for(let It=0,Rt=St.length;It<Rt;It++)o.update(St[It],34962)}},getWireframeAttribute:function(ft){const mt=rt.get(ft);if(mt){const bt=ft.index;bt!==null&&mt.version<bt.version&&ct(ft)}else ct(ft);return rt.get(ft)}}}function io(dt,o,g,$){const _e=$.isWebGL2;let rt,at,ct;this.setMode=function(ft){rt=ft},this.setIndex=function(ft){at=ft.type,ct=ft.bytesPerElement},this.render=function(ft,mt){dt.drawElements(rt,mt,at,ft*ct),g.update(mt,rt,1)},this.renderInstances=function(ft,mt,bt){if(bt===0)return;let Tt,St;if(_e)Tt=dt,St="drawElementsInstanced";else if(Tt=o.get("ANGLE_instanced_arrays"),St="drawElementsInstancedANGLE",Tt===null)return void console.error("THREE.WebGLIndexedBufferRenderer: using THREE.InstancedBufferGeometry but hardware does not support extension ANGLE_instanced_arrays.");Tt[St](rt,mt,at,ft*ct,bt),g.update(mt,rt,bt)}}function WS(dt){const o={frame:0,calls:0,triangles:0,points:0,lines:0};return{memory:{geometries:0,textures:0},render:o,programs:null,autoReset:!0,reset:function(){o.frame++,o.calls=0,o.triangles=0,o.points=0,o.lines=0},update:function(g,$,_e){switch(o.calls++,$){case 4:o.triangles+=_e*(g/3);break;case 1:o.lines+=_e*(g/2);break;case 3:o.lines+=_e*(g-1);break;case 2:o.lines+=_e*g;break;case 0:o.points+=_e*g;break;default:console.error("THREE.WebGLInfo: Unknown draw mode:",$)}}}}function jM(dt,o){return dt[0]-o[0]}function zM(dt,o){return Math.abs(o[1])-Math.abs(dt[1])}function qr(dt,o,g){const $={},_e=new Float32Array(8),rt=new WeakMap,at=new _o,ct=[];for(let ft=0;ft<8;ft++)ct[ft]=[ft,0];return{update:function(ft,mt,bt,Tt){const St=ft.morphTargetInfluences;if(o.isWebGL2===!0){const It=mt.morphAttributes.position||mt.morphAttributes.normal||mt.morphAttributes.color,Rt=It!==void 0?It.length:0;let Dt=rt.get(mt);if(Dt===void 0||Dt.count!==Rt){Dt!==void 0&&Dt.texture.dispose();const zt=mt.morphAttributes.position!==void 0,Xt=mt.morphAttributes.normal!==void 0,tn=mt.morphAttributes.color!==void 0,sn=mt.morphAttributes.position||[],ln=mt.morphAttributes.normal||[],kn=mt.morphAttributes.color||[];let Ln=0;zt===!0&&(Ln=1),Xt===!0&&(Ln=2),tn===!0&&(Ln=3);let qn=mt.attributes.position.count*Ln,Kn=1;qn>o.maxTextureSize&&(Kn=Math.ceil(qn/o.maxTextureSize),qn=o.maxTextureSize);const On=new Float32Array(qn*Kn*4*Rt),_r=new h_(On,qn,Kn,Rt);_r.type=Wl,_r.needsUpdate=!0;const Tr=4*Ln;for(let gr=0;gr<Rt;gr++){const Or=sn[gr],Gr=ln[gr],cr=kn[gr],ur=qn*Kn*4*gr;for(let Fr=0;Fr<Or.count;Fr++){const Ar=Fr*Tr;zt===!0&&(at.fromBufferAttribute(Or,Fr),On[ur+Ar+0]=at.x,On[ur+Ar+1]=at.y,On[ur+Ar+2]=at.z,On[ur+Ar+3]=0),Xt===!0&&(at.fromBufferAttribute(Gr,Fr),On[ur+Ar+4]=at.x,On[ur+Ar+5]=at.y,On[ur+Ar+6]=at.z,On[ur+Ar+7]=0),tn===!0&&(at.fromBufferAttribute(cr,Fr),On[ur+Ar+8]=at.x,On[ur+Ar+9]=at.y,On[ur+Ar+10]=at.z,On[ur+Ar+11]=cr.itemSize===4?at.w:1)}}Dt={count:Rt,texture:_r,size:new Sr(qn,Kn)},rt.set(mt,Dt),mt.addEventListener("dispose",function gr(){_r.dispose(),rt.delete(mt),mt.removeEventListener("dispose",gr)})}let Ft=0;for(let zt=0;zt<St.length;zt++)Ft+=St[zt];const Nt=mt.morphTargetsRelative?1:1-Ft;Tt.getUniforms().setValue(dt,"morphTargetBaseInfluence",Nt),Tt.getUniforms().setValue(dt,"morphTargetInfluences",St),Tt.getUniforms().setValue(dt,"morphTargetsTexture",Dt.texture,g),Tt.getUniforms().setValue(dt,"morphTargetsTextureSize",Dt.size)}else{const It=St===void 0?0:St.length;let Rt=$[mt.id];if(Rt===void 0||Rt.length!==It){Rt=[];for(let Xt=0;Xt<It;Xt++)Rt[Xt]=[Xt,0];$[mt.id]=Rt}for(let Xt=0;Xt<It;Xt++){const tn=Rt[Xt];tn[0]=Xt,tn[1]=St[Xt]}Rt.sort(zM);for(let Xt=0;Xt<8;Xt++)Xt<It&&Rt[Xt][1]?(ct[Xt][0]=Rt[Xt][0],ct[Xt][1]=Rt[Xt][1]):(ct[Xt][0]=Number.MAX_SAFE_INTEGER,ct[Xt][1]=0);ct.sort(jM);const Dt=mt.morphAttributes.position,Ft=mt.morphAttributes.normal;let Nt=0;for(let Xt=0;Xt<8;Xt++){const tn=ct[Xt],sn=tn[0],ln=tn[1];sn!==Number.MAX_SAFE_INTEGER&&ln?(Dt&&mt.getAttribute("morphTarget"+Xt)!==Dt[sn]&&mt.setAttribute("morphTarget"+Xt,Dt[sn]),Ft&&mt.getAttribute("morphNormal"+Xt)!==Ft[sn]&&mt.setAttribute("morphNormal"+Xt,Ft[sn]),_e[Xt]=ln,Nt+=ln):(Dt&&mt.hasAttribute("morphTarget"+Xt)===!0&&mt.deleteAttribute("morphTarget"+Xt),Ft&&mt.hasAttribute("morphNormal"+Xt)===!0&&mt.deleteAttribute("morphNormal"+Xt),_e[Xt]=0)}const zt=mt.morphTargetsRelative?1:1-Nt;Tt.getUniforms().setValue(dt,"morphTargetBaseInfluence",zt),Tt.getUniforms().setValue(dt,"morphTargetInfluences",_e)}}}}function Ls(dt,o,g,$){let _e=new WeakMap;function rt(at){const ct=at.target;ct.removeEventListener("dispose",rt),g.remove(ct.instanceMatrix),ct.instanceColor!==null&&g.remove(ct.instanceColor)}return{update:function(at){const ct=$.render.frame,ft=at.geometry,mt=o.get(at,ft);return _e.get(mt)!==ct&&(o.update(mt),_e.set(mt,ct)),at.isInstancedMesh&&(at.hasEventListener("dispose",rt)===!1&&at.addEventListener("dispose",rt),g.update(at.instanceMatrix,34962),at.instanceColor!==null&&g.update(at.instanceColor,34962)),mt},dispose:function(){_e=new WeakMap}}}const CA=new qo,Am=new h_,j1=new d_,z1=new qw,qS=[],ho=[],VM=new Float32Array(16),YS=new Float32Array(9),XS=new Float32Array(4);function MA(dt,o,g){const $=dt[0];if($<=0||$>0)return dt;const _e=o*g;let rt=qS[_e];if(rt===void 0&&(rt=new Float32Array(_e),qS[_e]=rt),o!==0){$.toArray(rt,0);for(let at=1,ct=0;at!==o;++at)ct+=g,dt[at].toArray(rt,ct)}return rt}function fp(dt,o){if(dt.length!==o.length)return!1;for(let g=0,$=dt.length;g<$;g++)if(dt[g]!==o[g])return!1;return!0}function Ru(dt,o){for(let g=0,$=o.length;g<$;g++)dt[g]=o[g]}function Kw(dt,o){let g=ho[o];g===void 0&&(g=new Int32Array(o),ho[o]=g);for(let $=0;$!==o;++$)g[$]=dt.allocateTextureUnit();return g}function Xm(dt,o){const g=this.cache;g[0]!==o&&(dt.uniform1f(this.addr,o),g[0]=o)}function zv(dt,o){const g=this.cache;if(o.x!==void 0)g[0]===o.x&&g[1]===o.y||(dt.uniform2f(this.addr,o.x,o.y),g[0]=o.x,g[1]=o.y);else{if(fp(g,o))return;dt.uniform2fv(this.addr,o),Ru(g,o)}}function lD(dt,o){const g=this.cache;if(o.x!==void 0)g[0]===o.x&&g[1]===o.y&&g[2]===o.z||(dt.uniform3f(this.addr,o.x,o.y,o.z),g[0]=o.x,g[1]=o.y,g[2]=o.z);else if(o.r!==void 0)g[0]===o.r&&g[1]===o.g&&g[2]===o.b||(dt.uniform3f(this.addr,o.r,o.g,o.b),g[0]=o.r,g[1]=o.g,g[2]=o.b);else{if(fp(g,o))return;dt.uniform3fv(this.addr,o),Ru(g,o)}}function V1(dt,o){const g=this.cache;if(o.x!==void 0)g[0]===o.x&&g[1]===o.y&&g[2]===o.z&&g[3]===o.w||(dt.uniform4f(this.addr,o.x,o.y,o.z,o.w),g[0]=o.x,g[1]=o.y,g[2]=o.z,g[3]=o.w);else{if(fp(g,o))return;dt.uniform4fv(this.addr,o),Ru(g,o)}}function M0(dt,o){const g=this.cache,$=o.elements;if($===void 0){if(fp(g,o))return;dt.uniformMatrix2fv(this.addr,!1,o),Ru(g,o)}else{if(fp(g,$))return;XS.set($),dt.uniformMatrix2fv(this.addr,!1,XS),Ru(g,$)}}function QM(dt,o){const g=this.cache,$=o.elements;if($===void 0){if(fp(g,o))return;dt.uniformMatrix3fv(this.addr,!1,o),Ru(g,o)}else{if(fp(g,$))return;YS.set($),dt.uniformMatrix3fv(this.addr,!1,YS),Ru(g,$)}}function Jw(dt,o){const g=this.cache,$=o.elements;if($===void 0){if(fp(g,o))return;dt.uniformMatrix4fv(this.addr,!1,o),Ru(g,o)}else{if(fp(g,$))return;VM.set($),dt.uniformMatrix4fv(this.addr,!1,VM),Ru(g,$)}}function KS(dt,o){const g=this.cache;g[0]!==o&&(dt.uniform1i(this.addr,o),g[0]=o)}function Zw(dt,o){const g=this.cache;fp(g,o)||(dt.uniform2iv(this.addr,o),Ru(g,o))}function GM(dt,o){const g=this.cache;fp(g,o)||(dt.uniform3iv(this.addr,o),Ru(g,o))}function JS(dt,o){const g=this.cache;fp(g,o)||(dt.uniform4iv(this.addr,o),Ru(g,o))}function Bu(dt,o){const g=this.cache;g[0]!==o&&(dt.uniform1ui(this.addr,o),g[0]=o)}function Km(dt,o){const g=this.cache;fp(g,o)||(dt.uniform2uiv(this.addr,o),Ru(g,o))}function $w(dt,o){const g=this.cache;fp(g,o)||(dt.uniform3uiv(this.addr,o),Ru(g,o))}function Q1(dt,o){const g=this.cache;fp(g,o)||(dt.uniform4uiv(this.addr,o),Ru(g,o))}function Jm(dt,o,g){const $=this.cache,_e=g.allocateTextureUnit();$[0]!==_e&&(dt.uniform1i(this.addr,_e),$[0]=_e),g.setTexture2D(o||CA,_e)}function ZS(dt,o,g){const $=this.cache,_e=g.allocateTextureUnit();$[0]!==_e&&(dt.uniform1i(this.addr,_e),$[0]=_e),g.setTexture3D(o||j1,_e)}function G1(dt,o,g){const $=this.cache,_e=g.allocateTextureUnit();$[0]!==_e&&(dt.uniform1i(this.addr,_e),$[0]=_e),g.setTextureCube(o||z1,_e)}function HM(dt,o,g){const $=this.cache,_e=g.allocateTextureUnit();$[0]!==_e&&(dt.uniform1i(this.addr,_e),$[0]=_e),g.setTexture2DArray(o||Am,_e)}function H1(dt,o){dt.uniform1fv(this.addr,o)}function Zm(dt,o){const g=MA(o,this.size,2);dt.uniform2fv(this.addr,g)}function Gp(dt,o){const g=MA(o,this.size,3);dt.uniform3fv(this.addr,g)}function W1(dt,o){const g=MA(o,this.size,4);dt.uniform4fv(this.addr,g)}function WM(dt,o){const g=MA(o,this.size,4);dt.uniformMatrix2fv(this.addr,!1,g)}function q1(dt,o){const g=MA(o,this.size,9);dt.uniformMatrix3fv(this.addr,!1,g)}function qM(dt,o){const g=MA(o,this.size,16);dt.uniformMatrix4fv(this.addr,!1,g)}function $S(dt,o){dt.uniform1iv(this.addr,o)}function Y1(dt,o){dt.uniform2iv(this.addr,o)}function YM(dt,o){dt.uniform3iv(this.addr,o)}function XM(dt,o){dt.uniform4iv(this.addr,o)}function cD(dt,o){dt.uniform1uiv(this.addr,o)}function KM(dt,o){dt.uniform2uiv(this.addr,o)}function JM(dt,o){dt.uniform3uiv(this.addr,o)}function ZM(dt,o){dt.uniform4uiv(this.addr,o)}function Pp(dt,o,g){const $=o.length,_e=Kw(g,$);dt.uniform1iv(this.addr,_e);for(let rt=0;rt!==$;++rt)g.setTexture2D(o[rt]||CA,_e[rt])}function Fo(dt,o,g){const $=o.length,_e=Kw(g,$);dt.uniform1iv(this.addr,_e);for(let rt=0;rt!==$;++rt)g.setTexture3D(o[rt]||j1,_e[rt])}function $M(dt,o,g){const $=o.length,_e=Kw(g,$);dt.uniform1iv(this.addr,_e);for(let rt=0;rt!==$;++rt)g.setTextureCube(o[rt]||z1,_e[rt])}function TA(dt,o,g){const $=o.length,_e=Kw(g,$);dt.uniform1iv(this.addr,_e);for(let rt=0;rt!==$;++rt)g.setTexture2DArray(o[rt]||Am,_e[rt])}class Rp{constructor(o,g,$){this.id=o,this.addr=$,this.cache=[],this.setValue=function(_e){switch(_e){case 5126:return Xm;case 35664:return zv;case 35665:return lD;case 35666:return V1;case 35674:return M0;case 35675:return QM;case 35676:return Jw;case 5124:case 35670:return KS;case 35667:case 35671:return Zw;case 35668:case 35672:return GM;case 35669:case 35673:return JS;case 5125:return Bu;case 36294:return Km;case 36295:return $w;case 36296:return Q1;case 35678:case 36198:case 36298:case 36306:case 35682:return Jm;case 35679:case 36299:case 36307:return ZS;case 35680:case 36300:case 36308:case 36293:return G1;case 36289:case 36303:case 36311:case 36292:return HM}}(g.type)}}class __{constructor(o,g,$){this.id=o,this.addr=$,this.cache=[],this.size=g.size,this.setValue=function(_e){switch(_e){case 5126:return H1;case 35664:return Zm;case 35665:return Gp;case 35666:return W1;case 35674:return WM;case 35675:return q1;case 35676:return qM;case 5124:case 35670:return $S;case 35667:case 35671:return Y1;case 35668:case 35672:return YM;case 35669:case 35673:return XM;case 5125:return cD;case 36294:return KM;case 36295:return JM;case 36296:return ZM;case 35678:case 36198:case 36298:case 36306:case 35682:return Pp;case 35679:case 36299:case 36307:return Fo;case 35680:case 36300:case 36308:case 36293:return $M;case 36289:case 36303:case 36311:case 36292:return TA}}(g.type)}}class xl{constructor(o){this.id=o,this.seq=[],this.map={}}setValue(o,g,$){const _e=this.seq;for(let rt=0,at=_e.length;rt!==at;++rt){const ct=_e[rt];ct.setValue(o,g[ct.id],$)}}}const X1=/(\w+)(\])?(\[|\.)?/g;function K1(dt,o){dt.seq.push(o),dt.map[o.id]=o}function eT(dt,o,g){const $=dt.name,_e=$.length;for(X1.lastIndex=0;;){const rt=X1.exec($),at=X1.lastIndex;let ct=rt[1];const ft=rt[2]==="]",mt=rt[3];if(ft&&(ct|=0),mt===void 0||mt==="["&&at+2===_e){K1(g,mt===void 0?new Rp(ct,dt,o):new __(ct,dt,o));break}{let bt=g.map[ct];bt===void 0&&(bt=new xl(ct),K1(g,bt)),g=bt}}}class ex{constructor(o,g){this.seq=[],this.map={};const $=o.getProgramParameter(g,35718);for(let _e=0;_e<$;++_e){const rt=o.getActiveUniform(g,_e);eT(rt,o.getUniformLocation(g,rt.name),this)}}setValue(o,g,$,_e){const rt=this.map[g];rt!==void 0&&rt.setValue(o,$,_e)}setOptional(o,g,$){const _e=g[$];_e!==void 0&&this.setValue(o,$,_e)}static upload(o,g,$,_e){for(let rt=0,at=g.length;rt!==at;++rt){const ct=g[rt],ft=$[ct.id];ft.needsUpdate!==!1&&ct.setValue(o,ft.value,_e)}}static seqWithValue(o,g){const $=[];for(let _e=0,rt=o.length;_e!==rt;++_e){const at=o[_e];at.id in g&&$.push(at)}return $}}function eC(dt,o,g){const $=dt.createShader(o);return dt.shaderSource($,g),dt.compileShader($),$}let uD=0;function tT(dt){switch(dt){case qu:return["Linear","( value )"];case No:return["sRGB","( value )"];case Cv:return["RGBM","( value, 16.0 )"];default:return console.warn("THREE.WebGLProgram: Unsupported encoding:",dt),["Linear","( value )"]}}function nT(dt,o,g){const $=dt.getShaderParameter(o,35713),_e=dt.getShaderInfoLog(o).trim();if($&&_e==="")return"";const rt=/ERROR: 0:(\d+)/.exec(_e);if(rt){const at=parseInt(rt[1]);return g.toUpperCase()+`

`+_e+`

`+function(ct,ft){const mt=ct.split(`
`),bt=[],Tt=Math.max(ft-6,0),St=Math.min(ft+6,mt.length);for(let It=Tt;It<St;It++){const Rt=It+1;bt.push(`${Rt===ft?">":" "} ${Rt}: ${mt[It]}`)}return bt.join(`
`)}(dt.getShaderSource(o),at)}return _e}function hD(dt,o){const g=tT(o);return"vec4 "+dt+"( vec4 value ) { return "+g[0]+"ToLinear"+g[1]+"; }"}function dD(dt,o){const g=tT(o);return"vec4 "+dt+"( vec4 value ) { return LinearTo"+g[0]+g[1]+"; }"}function pD(dt,o){let g;switch(o){case Oo:g="Linear";break;case Js:g="Reinhard";break;case Qo:g="OptimizedCineon";break;case yo:g="ACESFilmic";break;case Vu:g="Custom";break;default:console.warn("THREE.WebGLProgram: Unsupported toneMapping:",o),g="Linear"}return"vec3 "+dt+"( vec3 color ) { return "+g+"ToneMapping( color ); }"}function IA(dt){return dt!==""}function tx(dt,o){const g=o.numSpotLightShadows+o.numSpotLightMaps-o.numSpotLightShadowsWithMaps;return dt.replace(/NUM_DIR_LIGHTS/g,o.numDirLights).replace(/NUM_SPOT_LIGHTS/g,o.numSpotLights).replace(/NUM_SPOT_LIGHT_MAPS/g,o.numSpotLightMaps).replace(/NUM_SPOT_LIGHT_COORDS/g,g).replace(/NUM_RECT_AREA_LIGHTS/g,o.numRectAreaLights).replace(/NUM_POINT_LIGHTS/g,o.numPointLights).replace(/NUM_HEMI_LIGHTS/g,o.numHemiLights).replace(/NUM_DIR_LIGHT_SHADOWS/g,o.numDirLightShadows).replace(/NUM_SPOT_LIGHT_SHADOWS_WITH_MAPS/g,o.numSpotLightShadowsWithMaps).replace(/NUM_SPOT_LIGHT_SHADOWS/g,o.numSpotLightShadows).replace(/NUM_POINT_LIGHT_SHADOWS/g,o.numPointLightShadows)}function jo(dt,o){return dt.replace(/NUM_CLIPPING_PLANES/g,o.numClippingPlanes).replace(/UNION_CLIPPING_PLANES/g,o.numClippingPlanes-o.numClipIntersection)}const iT=/^[ \t]*#include +<([\w\d./]+)>/gm;function J1(dt){return dt.replace(iT,Z1)}function Z1(dt,o){const g=Zs[o];if(g===void 0)throw new Error("Can not resolve #include <"+o+">");return J1(g)}const $1=/#pragma unroll_loop_start\s+for\s*\(\s*int\s+i\s*=\s*(\d+)\s*;\s*i\s*<\s*(\d+)\s*;\s*i\s*\+\+\s*\)\s*{([\s\S]+?)}\s+#pragma unroll_loop_end/g;function $m(dt){return dt.replace($1,rT)}function rT(dt,o,g,$){let _e="";for(let rt=parseInt(o);rt<parseInt(g);rt++)_e+=$.replace(/\[\s*i\s*\]/g,"[ "+rt+" ]").replace(/UNROLLED_LOOP_INDEX/g,rt);return _e}function Ly(dt){let o="precision "+dt.precision+` float;
precision `+dt.precision+" int;";return dt.precision==="highp"?o+=`
#define HIGH_PRECISION`:dt.precision==="mediump"?o+=`
#define MEDIUM_PRECISION`:dt.precision==="lowp"&&(o+=`
#define LOW_PRECISION`),o}function DA(dt,o,g,$){const _e=dt.getContext(),rt=g.defines;let at=g.vertexShader,ct=g.fragmentShader;const ft=function(Ln){let qn="SHADOWMAP_TYPE_BASIC";return Ln.shadowMapType===gn?qn="SHADOWMAP_TYPE_PCF":Ln.shadowMapType===dn?qn="SHADOWMAP_TYPE_PCF_SOFT":Ln.shadowMapType===wn&&(qn="SHADOWMAP_TYPE_VSM"),qn}(g),mt=function(Ln){let qn="ENVMAP_TYPE_CUBE";if(Ln.envMap)switch(Ln.envMapMode){case $a:case ko:qn="ENVMAP_TYPE_CUBE";break;case Qu:qn="ENVMAP_TYPE_CUBE_UV"}return qn}(g),bt=function(Ln){let qn="ENVMAP_MODE_REFLECTION";return Ln.envMap&&Ln.envMapMode===ko&&(qn="ENVMAP_MODE_REFRACTION"),qn}(g),Tt=function(Ln){let qn="ENVMAP_BLENDING_NONE";if(Ln.envMap)switch(Ln.combine){case Cs:qn="ENVMAP_BLENDING_MULTIPLY";break;case Gs:qn="ENVMAP_BLENDING_MIX";break;case Ao:qn="ENVMAP_BLENDING_ADD"}return qn}(g),St=function(Ln){const qn=Ln.envMapCubeUVHeight;if(qn===null)return null;const Kn=Math.log2(qn)-2,On=1/qn;return{texelWidth:1/(3*Math.max(Math.pow(2,Kn),112)),texelHeight:On,maxMip:Kn}}(g),It=g.isWebGL2?"":function(Ln){return[Ln.extensionDerivatives||Ln.envMapCubeUVHeight||Ln.bumpMap||Ln.tangentSpaceNormalMap||Ln.clearcoatNormalMap||Ln.flatShading||Ln.shaderID==="physical"?"#extension GL_OES_standard_derivatives : enable":"",(Ln.extensionFragDepth||Ln.logarithmicDepthBuffer)&&Ln.rendererExtensionFragDepth?"#extension GL_EXT_frag_depth : enable":"",Ln.extensionDrawBuffers&&Ln.rendererExtensionDrawBuffers?"#extension GL_EXT_draw_buffers : require":"",(Ln.extensionShaderTextureLOD||Ln.envMap||Ln.transmission)&&Ln.rendererExtensionShaderTextureLod?"#extension GL_EXT_shader_texture_lod : enable":""].filter(IA).join(`
`)}(g),Rt=function(Ln){const qn=[];for(const Kn in Ln){const On=Ln[Kn];On!==!1&&qn.push("#define "+Kn+" "+On)}return qn.join(`
`)}(rt),Dt=_e.createProgram();let Ft,Nt,zt=g.glslVersion?"#version "+g.glslVersion+`
`:"";g.isRawShaderMaterial?(Ft=[Rt].filter(IA).join(`
`),Ft.length>0&&(Ft+=`
`),Nt=[It,Rt].filter(IA).join(`
`),Nt.length>0&&(Nt+=`
`)):(Ft=[Ly(g),"#define SHADER_NAME "+g.shaderName,Rt,g.instancing?"#define USE_INSTANCING":"",g.instancingColor?"#define USE_INSTANCING_COLOR":"",g.supportsVertexTextures?"#define VERTEX_TEXTURES":"",g.useFog&&g.fog?"#define USE_FOG":"",g.useFog&&g.fogExp2?"#define FOG_EXP2":"",g.map?"#define USE_MAP":"",g.envMap?"#define USE_ENVMAP":"",g.envMap?"#define "+bt:"",g.lightMap?"#define USE_LIGHTMAP":"",g.aoMap?"#define USE_AOMAP":"",g.emissiveMap?"#define USE_EMISSIVEMAP":"",g.bumpMap?"#define USE_BUMPMAP":"",g.normalMap?"#define USE_NORMALMAP":"",g.normalMap&&g.objectSpaceNormalMap?"#define OBJECTSPACE_NORMALMAP":"",g.normalMap&&g.tangentSpaceNormalMap?"#define TANGENTSPACE_NORMALMAP":"",g.clearcoatMap?"#define USE_CLEARCOATMAP":"",g.clearcoatRoughnessMap?"#define USE_CLEARCOAT_ROUGHNESSMAP":"",g.clearcoatNormalMap?"#define USE_CLEARCOAT_NORMALMAP":"",g.iridescenceMap?"#define USE_IRIDESCENCEMAP":"",g.iridescenceThicknessMap?"#define USE_IRIDESCENCE_THICKNESSMAP":"",g.displacementMap&&g.supportsVertexTextures?"#define USE_DISPLACEMENTMAP":"",g.specularMap?"#define USE_SPECULARMAP":"",g.specularIntensityMap?"#define USE_SPECULARINTENSITYMAP":"",g.specularColorMap?"#define USE_SPECULARCOLORMAP":"",g.roughnessMap?"#define USE_ROUGHNESSMAP":"",g.metalnessMap?"#define USE_METALNESSMAP":"",g.alphaMap?"#define USE_ALPHAMAP":"",g.transmission?"#define USE_TRANSMISSION":"",g.transmissionMap?"#define USE_TRANSMISSIONMAP":"",g.thicknessMap?"#define USE_THICKNESSMAP":"",g.sheenColorMap?"#define USE_SHEENCOLORMAP":"",g.sheenRoughnessMap?"#define USE_SHEENROUGHNESSMAP":"",g.vertexTangents?"#define USE_TANGENT":"",g.vertexColors?"#define USE_COLOR":"",g.vertexAlphas?"#define USE_COLOR_ALPHA":"",g.vertexUvs?"#define USE_UV":"",g.uvsVertexOnly?"#define UVS_VERTEX_ONLY":"",g.flatShading?"#define FLAT_SHADED":"",g.skinning?"#define USE_SKINNING":"",g.morphTargets?"#define USE_MORPHTARGETS":"",g.morphNormals&&g.flatShading===!1?"#define USE_MORPHNORMALS":"",g.morphColors&&g.isWebGL2?"#define USE_MORPHCOLORS":"",g.morphTargetsCount>0&&g.isWebGL2?"#define MORPHTARGETS_TEXTURE":"",g.morphTargetsCount>0&&g.isWebGL2?"#define MORPHTARGETS_TEXTURE_STRIDE "+g.morphTextureStride:"",g.morphTargetsCount>0&&g.isWebGL2?"#define MORPHTARGETS_COUNT "+g.morphTargetsCount:"",g.doubleSided?"#define DOUBLE_SIDED":"",g.flipSided?"#define FLIP_SIDED":"",g.shadowMapEnabled?"#define USE_SHADOWMAP":"",g.shadowMapEnabled?"#define "+ft:"",g.sizeAttenuation?"#define USE_SIZEATTENUATION":"",g.logarithmicDepthBuffer?"#define USE_LOGDEPTHBUF":"",g.logarithmicDepthBuffer&&g.rendererExtensionFragDepth?"#define USE_LOGDEPTHBUF_EXT":"","uniform mat4 modelMatrix;","uniform mat4 modelViewMatrix;","uniform mat4 projectionMatrix;","uniform mat4 viewMatrix;","uniform mat3 normalMatrix;","uniform vec3 cameraPosition;","uniform bool isOrthographic;","#ifdef USE_INSTANCING","	attribute mat4 instanceMatrix;","#endif","#ifdef USE_INSTANCING_COLOR","	attribute vec3 instanceColor;","#endif","attribute vec3 position;","attribute vec3 normal;","attribute vec2 uv;","#ifdef USE_TANGENT","	attribute vec4 tangent;","#endif","#if defined( USE_COLOR_ALPHA )","	attribute vec4 color;","#elif defined( USE_COLOR )","	attribute vec3 color;","#endif","#if ( defined( USE_MORPHTARGETS ) && ! defined( MORPHTARGETS_TEXTURE ) )","	attribute vec3 morphTarget0;","	attribute vec3 morphTarget1;","	attribute vec3 morphTarget2;","	attribute vec3 morphTarget3;","	#ifdef USE_MORPHNORMALS","		attribute vec3 morphNormal0;","		attribute vec3 morphNormal1;","		attribute vec3 morphNormal2;","		attribute vec3 morphNormal3;","	#else","		attribute vec3 morphTarget4;","		attribute vec3 morphTarget5;","		attribute vec3 morphTarget6;","		attribute vec3 morphTarget7;","	#endif","#endif","#ifdef USE_SKINNING","	attribute vec4 skinIndex;","	attribute vec4 skinWeight;","#endif",`
`].filter(IA).join(`
`),Nt=[It,Ly(g),"#define SHADER_NAME "+g.shaderName,Rt,g.useFog&&g.fog?"#define USE_FOG":"",g.useFog&&g.fogExp2?"#define FOG_EXP2":"",g.map?"#define USE_MAP":"",g.matcap?"#define USE_MATCAP":"",g.envMap?"#define USE_ENVMAP":"",g.envMap?"#define "+mt:"",g.envMap?"#define "+bt:"",g.envMap?"#define "+Tt:"",St?"#define CUBEUV_TEXEL_WIDTH "+St.texelWidth:"",St?"#define CUBEUV_TEXEL_HEIGHT "+St.texelHeight:"",St?"#define CUBEUV_MAX_MIP "+St.maxMip+".0":"",g.lightMap?"#define USE_LIGHTMAP":"",g.aoMap?"#define USE_AOMAP":"",g.emissiveMap?"#define USE_EMISSIVEMAP":"",g.bumpMap?"#define USE_BUMPMAP":"",g.normalMap?"#define USE_NORMALMAP":"",g.normalMap&&g.objectSpaceNormalMap?"#define OBJECTSPACE_NORMALMAP":"",g.normalMap&&g.tangentSpaceNormalMap?"#define TANGENTSPACE_NORMALMAP":"",g.clearcoat?"#define USE_CLEARCOAT":"",g.clearcoatMap?"#define USE_CLEARCOATMAP":"",g.clearcoatRoughnessMap?"#define USE_CLEARCOAT_ROUGHNESSMAP":"",g.clearcoatNormalMap?"#define USE_CLEARCOAT_NORMALMAP":"",g.iridescence?"#define USE_IRIDESCENCE":"",g.iridescenceMap?"#define USE_IRIDESCENCEMAP":"",g.iridescenceThicknessMap?"#define USE_IRIDESCENCE_THICKNESSMAP":"",g.specularMap?"#define USE_SPECULARMAP":"",g.specularIntensityMap?"#define USE_SPECULARINTENSITYMAP":"",g.specularColorMap?"#define USE_SPECULARCOLORMAP":"",g.roughnessMap?"#define USE_ROUGHNESSMAP":"",g.metalnessMap?"#define USE_METALNESSMAP":"",g.alphaMap?"#define USE_ALPHAMAP":"",g.alphaTest?"#define USE_ALPHATEST":"",g.sheen?"#define USE_SHEEN":"",g.sheenColorMap?"#define USE_SHEENCOLORMAP":"",g.sheenRoughnessMap?"#define USE_SHEENROUGHNESSMAP":"",g.transmission?"#define USE_TRANSMISSION":"",g.transmissionMap?"#define USE_TRANSMISSIONMAP":"",g.thicknessMap?"#define USE_THICKNESSMAP":"",g.decodeVideoTexture?"#define DECODE_VIDEO_TEXTURE":"",g.vertexTangents?"#define USE_TANGENT":"",g.vertexColors||g.instancingColor?"#define USE_COLOR":"",g.vertexAlphas?"#define USE_COLOR_ALPHA":"",g.vertexUvs?"#define USE_UV":"",g.uvsVertexOnly?"#define UVS_VERTEX_ONLY":"",g.gradientMap?"#define USE_GRADIENTMAP":"",g.flatShading?"#define FLAT_SHADED":"",g.doubleSided?"#define DOUBLE_SIDED":"",g.flipSided?"#define FLIP_SIDED":"",g.shadowMapEnabled?"#define USE_SHADOWMAP":"",g.shadowMapEnabled?"#define "+ft:"",g.premultipliedAlpha?"#define PREMULTIPLIED_ALPHA":"",g.physicallyCorrectLights?"#define PHYSICALLY_CORRECT_LIGHTS":"",g.logarithmicDepthBuffer?"#define USE_LOGDEPTHBUF":"",g.logarithmicDepthBuffer&&g.rendererExtensionFragDepth?"#define USE_LOGDEPTHBUF_EXT":"","uniform mat4 viewMatrix;","uniform vec3 cameraPosition;","uniform bool isOrthographic;",g.toneMapping!==Ks?"#define TONE_MAPPING":"",g.toneMapping!==Ks?Zs.tonemapping_pars_fragment:"",g.toneMapping!==Ks?pD("toneMapping",g.toneMapping):"",g.dithering?"#define DITHERING":"",g.opaque?"#define OPAQUE":"",Zs.encodings_pars_fragment,dD("linearToOutputTexel",g.outputEncoding),g.transmissionSamplerMapEncoding?hD("transmissionSamplerMapTexelToLinear",g.transmissionSamplerMapEncoding):"",g.useDepthPacking?"#define DEPTH_PACKING "+g.depthPacking:"",`
`].filter(IA).join(`
`)),at=J1(at),at=tx(at,g),at=jo(at,g),ct=J1(ct),ct=tx(ct,g),ct=jo(ct,g),at=$m(at),ct=$m(ct),g.isWebGL2&&g.isRawShaderMaterial!==!0&&(zt=`#version 300 es
`,Ft=["precision mediump sampler2DArray;","#define attribute in","#define varying out","#define texture2D texture"].join(`
`)+`
`+Ft,Nt=["#define varying in",g.glslVersion===hm?"":"layout(location = 0) out highp vec4 pc_fragColor;",g.glslVersion===hm?"":"#define gl_FragColor pc_fragColor","#define gl_FragDepthEXT gl_FragDepth","#define texture2D texture","#define textureCube texture","#define texture2DProj textureProj","#define texture2DLodEXT textureLod","#define texture2DProjLodEXT textureProjLod","#define textureCubeLodEXT textureLod","#define texture2DGradEXT textureGrad","#define texture2DProjGradEXT textureProjGrad","#define textureCubeGradEXT textureGrad"].join(`
`)+`
`+Nt);const Xt=zt+Nt+ct,tn=eC(_e,35633,zt+Ft+at),sn=eC(_e,35632,Xt);if(_e.attachShader(Dt,tn),_e.attachShader(Dt,sn),g.index0AttributeName!==void 0?_e.bindAttribLocation(Dt,0,g.index0AttributeName):g.morphTargets===!0&&_e.bindAttribLocation(Dt,0,"position"),_e.linkProgram(Dt),dt.debug.checkShaderErrors){const Ln=_e.getProgramInfoLog(Dt).trim(),qn=_e.getShaderInfoLog(tn).trim(),Kn=_e.getShaderInfoLog(sn).trim();let On=!0,_r=!0;if(_e.getProgramParameter(Dt,35714)===!1){On=!1;const Tr=nT(_e,tn,"vertex"),gr=nT(_e,sn,"fragment");console.error("THREE.WebGLProgram: Shader Error "+_e.getError()+" - VALIDATE_STATUS "+_e.getProgramParameter(Dt,35715)+`

Program Info Log: `+Ln+`
`+Tr+`
`+gr)}else Ln!==""?console.warn("THREE.WebGLProgram: Program Info Log:",Ln):qn!==""&&Kn!==""||(_r=!1);_r&&(this.diagnostics={runnable:On,programLog:Ln,vertexShader:{log:qn,prefix:Ft},fragmentShader:{log:Kn,prefix:Nt}})}let ln,kn;return _e.deleteShader(tn),_e.deleteShader(sn),this.getUniforms=function(){return ln===void 0&&(ln=new ex(_e,Dt)),ln},this.getAttributes=function(){return kn===void 0&&(kn=function(Ln,qn){const Kn={},On=Ln.getProgramParameter(qn,35721);for(let _r=0;_r<On;_r++){const Tr=Ln.getActiveAttrib(qn,_r),gr=Tr.name;let Or=1;Tr.type===35674&&(Or=2),Tr.type===35675&&(Or=3),Tr.type===35676&&(Or=4),Kn[gr]={type:Tr.type,location:Ln.getAttribLocation(qn,gr),locationSize:Or}}return Kn}(_e,Dt)),kn},this.destroy=function(){$.releaseStatesOfProgram(this),_e.deleteProgram(Dt),this.program=void 0},this.name=g.shaderName,this.id=uD++,this.cacheKey=o,this.usedTimes=1,this.program=Dt,this.vertexShader=tn,this.fragmentShader=sn,this}let nx=0;class eE{constructor(){this.shaderCache=new Map,this.materialCache=new Map}update(o){const g=o.vertexShader,$=o.fragmentShader,_e=this._getShaderStage(g),rt=this._getShaderStage($),at=this._getShaderCacheForMaterial(o);return at.has(_e)===!1&&(at.add(_e),_e.usedTimes++),at.has(rt)===!1&&(at.add(rt),rt.usedTimes++),this}remove(o){const g=this.materialCache.get(o);for(const $ of g)$.usedTimes--,$.usedTimes===0&&this.shaderCache.delete($.code);return this.materialCache.delete(o),this}getVertexShaderID(o){return this._getShaderStage(o.vertexShader).id}getFragmentShaderID(o){return this._getShaderStage(o.fragmentShader).id}dispose(){this.shaderCache.clear(),this.materialCache.clear()}_getShaderCacheForMaterial(o){const g=this.materialCache;let $=g.get(o);return $===void 0&&($=new Set,g.set(o,$)),$}_getShaderStage(o){const g=this.shaderCache;let $=g.get(o);return $===void 0&&($=new ix(o),g.set(o,$)),$}}class ix{constructor(o){this.id=nx++,this.code=o,this.usedTimes=0}}function rx(dt,o,g,$,_e,rt,at){const ct=new pA,ft=new eE,mt=[],bt=_e.isWebGL2,Tt=_e.logarithmicDepthBuffer,St=_e.vertexTextures;let It=_e.precision;const Rt={MeshDepthMaterial:"depth",MeshDistanceMaterial:"distanceRGBA",MeshNormalMaterial:"normal",MeshBasicMaterial:"basic",MeshLambertMaterial:"lambert",MeshPhongMaterial:"phong",MeshToonMaterial:"toon",MeshStandardMaterial:"physical",MeshPhysicalMaterial:"physical",MeshMatcapMaterial:"matcap",LineBasicMaterial:"basic",LineDashedMaterial:"dashed",PointsMaterial:"points",ShadowMaterial:"shadow",SpriteMaterial:"sprite"};return{getParameters:function(Dt,Ft,Nt,zt,Xt){const tn=zt.fog,sn=Xt.geometry,ln=Dt.isMeshStandardMaterial?zt.environment:null,kn=(Dt.isMeshStandardMaterial?g:o).get(Dt.envMap||ln),Ln=kn&&kn.mapping===Qu?kn.image.height:null,qn=Rt[Dt.type];Dt.precision!==null&&(It=_e.getMaxPrecision(Dt.precision),It!==Dt.precision&&console.warn("THREE.WebGLProgram.getParameters:",Dt.precision,"not supported, using",It,"instead."));const Kn=sn.morphAttributes.position||sn.morphAttributes.normal||sn.morphAttributes.color,On=Kn!==void 0?Kn.length:0;let _r,Tr,gr,Or,Gr=0;if(sn.morphAttributes.position!==void 0&&(Gr=1),sn.morphAttributes.normal!==void 0&&(Gr=2),sn.morphAttributes.color!==void 0&&(Gr=3),qn){const as=zl[qn];_r=as.vertexShader,Tr=as.fragmentShader}else _r=Dt.vertexShader,Tr=Dt.fragmentShader,ft.update(Dt),gr=ft.getVertexShaderID(Dt),Or=ft.getFragmentShaderID(Dt);const cr=dt.getRenderTarget(),ur=dt.userData&&dt.userData.transmissionRenderTarget,Fr=Dt.alphaTest>0,Ar=Dt.clearcoat>0,Qr=Dt.iridescence>0;return{isWebGL2:bt,shaderID:qn,shaderName:Dt.type,vertexShader:_r,fragmentShader:Tr,defines:Dt.defines,customVertexShaderID:gr,customFragmentShaderID:Or,isRawShaderMaterial:Dt.isRawShaderMaterial===!0,glslVersion:Dt.glslVersion,precision:It,instancing:Xt.isInstancedMesh===!0,instancingColor:Xt.isInstancedMesh===!0&&Xt.instanceColor!==null,supportsVertexTextures:St,outputEncoding:cr===null?dt.outputEncoding:cr.isXRRenderTarget===!0||cr.texture.encoding!==No?cr.texture.encoding:qu,map:!!Dt.map,matcap:!!Dt.matcap,envMap:!!kn,envMapMode:kn&&kn.mapping,envMapCubeUVHeight:Ln,lightMap:!!Dt.lightMap,aoMap:!!Dt.aoMap,emissiveMap:!!Dt.emissiveMap,bumpMap:!!Dt.bumpMap,normalMap:!!Dt.normalMap,objectSpaceNormalMap:Dt.normalMapType===by,tangentSpaceNormalMap:Dt.normalMapType===Nl,decodeVideoTexture:!!Dt.map&&Dt.map.isVideoTexture===!0&&Dt.map.encoding===No,clearcoat:Ar,clearcoatMap:Ar&&!!Dt.clearcoatMap,clearcoatRoughnessMap:Ar&&!!Dt.clearcoatRoughnessMap,clearcoatNormalMap:Ar&&!!Dt.clearcoatNormalMap,iridescence:Qr,iridescenceMap:Qr&&!!Dt.iridescenceMap,iridescenceThicknessMap:Qr&&!!Dt.iridescenceThicknessMap,displacementMap:!!Dt.displacementMap,roughnessMap:!!Dt.roughnessMap,metalnessMap:!!Dt.metalnessMap,specularMap:!!Dt.specularMap,specularIntensityMap:!!Dt.specularIntensityMap,specularColorMap:!!Dt.specularColorMap,opaque:Dt.transparent===!1&&Dt.blending===jt&&!(Dt.transmission>0),alphaMap:!!Dt.alphaMap,alphaTest:Fr,gradientMap:!!Dt.gradientMap,sheen:Dt.sheen>0,sheenColorMap:!!Dt.sheenColorMap,sheenRoughnessMap:!!Dt.sheenRoughnessMap,transmission:Dt.transmission>0,transmissionMap:!!Dt.transmissionMap,transmissionSamplerMapEncoding:ur?ur.texture.encoding:qu,thicknessMap:!!Dt.thicknessMap,combine:Dt.combine,vertexTangents:!!Dt.normalMap&&!!sn.attributes.tangent,vertexColors:Dt.vertexColors,vertexAlphas:Dt.vertexColors===!0&&!!sn.attributes.color&&sn.attributes.color.itemSize===4,vertexUvs:!!(Dt.map||Dt.bumpMap||Dt.normalMap||Dt.specularMap||Dt.alphaMap||Dt.emissiveMap||Dt.roughnessMap||Dt.metalnessMap||Dt.clearcoatMap||Dt.clearcoatRoughnessMap||Dt.clearcoatNormalMap||Dt.iridescenceMap||Dt.iridescenceThicknessMap||Dt.displacementMap||Dt.transmissionMap||Dt.thicknessMap||Dt.specularIntensityMap||Dt.specularColorMap||Dt.sheenColorMap||Dt.sheenRoughnessMap),uvsVertexOnly:!(Dt.map||Dt.bumpMap||Dt.normalMap||Dt.specularMap||Dt.alphaMap||Dt.emissiveMap||Dt.roughnessMap||Dt.metalnessMap||Dt.clearcoatNormalMap||Dt.iridescenceMap||Dt.iridescenceThicknessMap||Dt.transmission>0||Dt.transmissionMap||Dt.thicknessMap||Dt.specularIntensityMap||Dt.specularColorMap||Dt.sheen>0||Dt.sheenColorMap||Dt.sheenRoughnessMap||!Dt.displacementMap),fog:!!tn,useFog:Dt.fog===!0,fogExp2:tn&&tn.isFogExp2,flatShading:!!Dt.flatShading,sizeAttenuation:Dt.sizeAttenuation,logarithmicDepthBuffer:Tt,skinning:Xt.isSkinnedMesh===!0,morphTargets:sn.morphAttributes.position!==void 0,morphNormals:sn.morphAttributes.normal!==void 0,morphColors:sn.morphAttributes.color!==void 0,morphTargetsCount:On,morphTextureStride:Gr,numDirLights:Ft.directional.length,numPointLights:Ft.point.length,numSpotLights:Ft.spot.length,numSpotLightMaps:Ft.spotLightMap.length,numRectAreaLights:Ft.rectArea.length,numHemiLights:Ft.hemi.length,numDirLightShadows:Ft.directionalShadowMap.length,numPointLightShadows:Ft.pointShadowMap.length,numSpotLightShadows:Ft.spotShadowMap.length,numSpotLightShadowsWithMaps:Ft.numSpotLightShadowsWithMaps,numClippingPlanes:at.numPlanes,numClipIntersection:at.numIntersection,dithering:Dt.dithering,shadowMapEnabled:dt.shadowMap.enabled&&Nt.length>0,shadowMapType:dt.shadowMap.type,toneMapping:Dt.toneMapped?dt.toneMapping:Ks,physicallyCorrectLights:dt.physicallyCorrectLights,premultipliedAlpha:Dt.premultipliedAlpha,doubleSided:Dt.side===bn,flipSided:Dt.side===$t,useDepthPacking:!!Dt.depthPacking,depthPacking:Dt.depthPacking||0,index0AttributeName:Dt.index0AttributeName,extensionDerivatives:Dt.extensions&&Dt.extensions.derivatives,extensionFragDepth:Dt.extensions&&Dt.extensions.fragDepth,extensionDrawBuffers:Dt.extensions&&Dt.extensions.drawBuffers,extensionShaderTextureLOD:Dt.extensions&&Dt.extensions.shaderTextureLOD,rendererExtensionFragDepth:bt||$.has("EXT_frag_depth"),rendererExtensionDrawBuffers:bt||$.has("WEBGL_draw_buffers"),rendererExtensionShaderTextureLod:bt||$.has("EXT_shader_texture_lod"),customProgramCacheKey:Dt.customProgramCacheKey()}},getProgramCacheKey:function(Dt){const Ft=[];if(Dt.shaderID?Ft.push(Dt.shaderID):(Ft.push(Dt.customVertexShaderID),Ft.push(Dt.customFragmentShaderID)),Dt.defines!==void 0)for(const Nt in Dt.defines)Ft.push(Nt),Ft.push(Dt.defines[Nt]);return Dt.isRawShaderMaterial===!1&&(function(Nt,zt){Nt.push(zt.precision),Nt.push(zt.outputEncoding),Nt.push(zt.envMapMode),Nt.push(zt.envMapCubeUVHeight),Nt.push(zt.combine),Nt.push(zt.vertexUvs),Nt.push(zt.fogExp2),Nt.push(zt.sizeAttenuation),Nt.push(zt.morphTargetsCount),Nt.push(zt.morphAttributeCount),Nt.push(zt.numDirLights),Nt.push(zt.numPointLights),Nt.push(zt.numSpotLights),Nt.push(zt.numSpotLightMaps),Nt.push(zt.numHemiLights),Nt.push(zt.numRectAreaLights),Nt.push(zt.numDirLightShadows),Nt.push(zt.numPointLightShadows),Nt.push(zt.numSpotLightShadows),Nt.push(zt.numSpotLightShadowsWithMaps),Nt.push(zt.shadowMapType),Nt.push(zt.toneMapping),Nt.push(zt.numClippingPlanes),Nt.push(zt.numClipIntersection),Nt.push(zt.depthPacking)}(Ft,Dt),function(Nt,zt){ct.disableAll(),zt.isWebGL2&&ct.enable(0),zt.supportsVertexTextures&&ct.enable(1),zt.instancing&&ct.enable(2),zt.instancingColor&&ct.enable(3),zt.map&&ct.enable(4),zt.matcap&&ct.enable(5),zt.envMap&&ct.enable(6),zt.lightMap&&ct.enable(7),zt.aoMap&&ct.enable(8),zt.emissiveMap&&ct.enable(9),zt.bumpMap&&ct.enable(10),zt.normalMap&&ct.enable(11),zt.objectSpaceNormalMap&&ct.enable(12),zt.tangentSpaceNormalMap&&ct.enable(13),zt.clearcoat&&ct.enable(14),zt.clearcoatMap&&ct.enable(15),zt.clearcoatRoughnessMap&&ct.enable(16),zt.clearcoatNormalMap&&ct.enable(17),zt.iridescence&&ct.enable(18),zt.iridescenceMap&&ct.enable(19),zt.iridescenceThicknessMap&&ct.enable(20),zt.displacementMap&&ct.enable(21),zt.specularMap&&ct.enable(22),zt.roughnessMap&&ct.enable(23),zt.metalnessMap&&ct.enable(24),zt.gradientMap&&ct.enable(25),zt.alphaMap&&ct.enable(26),zt.alphaTest&&ct.enable(27),zt.vertexColors&&ct.enable(28),zt.vertexAlphas&&ct.enable(29),zt.vertexUvs&&ct.enable(30),zt.vertexTangents&&ct.enable(31),zt.uvsVertexOnly&&ct.enable(32),Nt.push(ct.mask),ct.disableAll(),zt.fog&&ct.enable(0),zt.useFog&&ct.enable(1),zt.flatShading&&ct.enable(2),zt.logarithmicDepthBuffer&&ct.enable(3),zt.skinning&&ct.enable(4),zt.morphTargets&&ct.enable(5),zt.morphNormals&&ct.enable(6),zt.morphColors&&ct.enable(7),zt.premultipliedAlpha&&ct.enable(8),zt.shadowMapEnabled&&ct.enable(9),zt.physicallyCorrectLights&&ct.enable(10),zt.doubleSided&&ct.enable(11),zt.flipSided&&ct.enable(12),zt.useDepthPacking&&ct.enable(13),zt.dithering&&ct.enable(14),zt.specularIntensityMap&&ct.enable(15),zt.specularColorMap&&ct.enable(16),zt.transmission&&ct.enable(17),zt.transmissionMap&&ct.enable(18),zt.thicknessMap&&ct.enable(19),zt.sheen&&ct.enable(20),zt.sheenColorMap&&ct.enable(21),zt.sheenRoughnessMap&&ct.enable(22),zt.decodeVideoTexture&&ct.enable(23),zt.opaque&&ct.enable(24),Nt.push(ct.mask)}(Ft,Dt),Ft.push(dt.outputEncoding)),Ft.push(Dt.customProgramCacheKey),Ft.join()},getUniforms:function(Dt){const Ft=Rt[Dt.type];let Nt;if(Ft){const zt=zl[Ft];Nt=NS.clone(zt.uniforms)}else Nt=Dt.uniforms;return Nt},acquireProgram:function(Dt,Ft){let Nt;for(let zt=0,Xt=mt.length;zt<Xt;zt++){const tn=mt[zt];if(tn.cacheKey===Ft){Nt=tn,++Nt.usedTimes;break}}return Nt===void 0&&(Nt=new DA(dt,Ft,Dt,rt),mt.push(Nt)),Nt},releaseProgram:function(Dt){if(--Dt.usedTimes==0){const Ft=mt.indexOf(Dt);mt[Ft]=mt[mt.length-1],mt.pop(),Dt.destroy()}},releaseShaderCache:function(Dt){ft.remove(Dt)},programs:mt,dispose:function(){ft.dispose()}}}function fD(){let dt=new WeakMap;return{get:function(o){let g=dt.get(o);return g===void 0&&(g={},dt.set(o,g)),g},remove:function(o){dt.delete(o)},update:function(o,g,$){dt.get(o)[g]=$},dispose:function(){dt=new WeakMap}}}function mD(dt,o){return dt.groupOrder!==o.groupOrder?dt.groupOrder-o.groupOrder:dt.renderOrder!==o.renderOrder?dt.renderOrder-o.renderOrder:dt.material.id!==o.material.id?dt.material.id-o.material.id:dt.z!==o.z?dt.z-o.z:dt.id-o.id}function tC(dt,o){return dt.groupOrder!==o.groupOrder?dt.groupOrder-o.groupOrder:dt.renderOrder!==o.renderOrder?dt.renderOrder-o.renderOrder:dt.z!==o.z?o.z-dt.z:dt.id-o.id}function sx(){const dt=[];let o=0;const g=[],$=[],_e=[];function rt(at,ct,ft,mt,bt,Tt){let St=dt[o];return St===void 0?(St={id:at.id,object:at,geometry:ct,material:ft,groupOrder:mt,renderOrder:at.renderOrder,z:bt,group:Tt},dt[o]=St):(St.id=at.id,St.object=at,St.geometry=ct,St.material=ft,St.groupOrder=mt,St.renderOrder=at.renderOrder,St.z=bt,St.group=Tt),o++,St}return{opaque:g,transmissive:$,transparent:_e,init:function(){o=0,g.length=0,$.length=0,_e.length=0},push:function(at,ct,ft,mt,bt,Tt){const St=rt(at,ct,ft,mt,bt,Tt);ft.transmission>0?$.push(St):ft.transparent===!0?_e.push(St):g.push(St)},unshift:function(at,ct,ft,mt,bt,Tt){const St=rt(at,ct,ft,mt,bt,Tt);ft.transmission>0?$.unshift(St):ft.transparent===!0?_e.unshift(St):g.unshift(St)},finish:function(){for(let at=o,ct=dt.length;at<ct;at++){const ft=dt[at];if(ft.id===null)break;ft.id=null,ft.object=null,ft.geometry=null,ft.material=null,ft.group=null}},sort:function(at,ct){g.length>1&&g.sort(at||mD),$.length>1&&$.sort(ct||tC),_e.length>1&&_e.sort(ct||tC)}}}function sT(){let dt=new WeakMap;return{get:function(o,g){const $=dt.get(o);let _e;return $===void 0?(_e=new sx,dt.set(o,[_e])):g>=$.length?(_e=new sx,$.push(_e)):_e=$[g],_e},dispose:function(){dt=new WeakMap}}}function gD(){const dt={};return{get:function(o){if(dt[o.id]!==void 0)return dt[o.id];let g;switch(o.type){case"DirectionalLight":g={direction:new fn,color:new rs};break;case"SpotLight":g={position:new fn,direction:new fn,color:new rs,distance:0,coneCos:0,penumbraCos:0,decay:0};break;case"PointLight":g={position:new fn,color:new rs,distance:0,decay:0};break;case"HemisphereLight":g={direction:new fn,skyColor:new rs,groundColor:new rs};break;case"RectAreaLight":g={color:new rs,position:new fn,halfWidth:new fn,halfHeight:new fn}}return dt[o.id]=g,g}}}let oT=0;function aT(dt,o){return(o.castShadow?2:0)-(dt.castShadow?2:0)+(o.map?1:0)-(dt.map?1:0)}function lT(dt,o){const g=new gD,$=function(){const ft={};return{get:function(mt){if(ft[mt.id]!==void 0)return ft[mt.id];let bt;switch(mt.type){case"DirectionalLight":case"SpotLight":bt={shadowBias:0,shadowNormalBias:0,shadowRadius:1,shadowMapSize:new Sr};break;case"PointLight":bt={shadowBias:0,shadowNormalBias:0,shadowRadius:1,shadowMapSize:new Sr,shadowCameraNear:1,shadowCameraFar:1e3}}return ft[mt.id]=bt,bt}}}(),_e={version:0,hash:{directionalLength:-1,pointLength:-1,spotLength:-1,rectAreaLength:-1,hemiLength:-1,numDirectionalShadows:-1,numPointShadows:-1,numSpotShadows:-1,numSpotMaps:-1},ambient:[0,0,0],probe:[],directional:[],directionalShadow:[],directionalShadowMap:[],directionalShadowMatrix:[],spot:[],spotLightMap:[],spotShadow:[],spotShadowMap:[],spotLightMatrix:[],rectArea:[],rectAreaLTC1:null,rectAreaLTC2:null,point:[],pointShadow:[],pointShadowMap:[],pointShadowMatrix:[],hemi:[],numSpotLightShadowsWithMaps:0};for(let ft=0;ft<9;ft++)_e.probe.push(new fn);const rt=new fn,at=new Os,ct=new Os;return{setup:function(ft,mt){let bt=0,Tt=0,St=0;for(let qn=0;qn<9;qn++)_e.probe[qn].set(0,0,0);let It=0,Rt=0,Dt=0,Ft=0,Nt=0,zt=0,Xt=0,tn=0,sn=0,ln=0;ft.sort(aT);const kn=mt!==!0?Math.PI:1;for(let qn=0,Kn=ft.length;qn<Kn;qn++){const On=ft[qn],_r=On.color,Tr=On.intensity,gr=On.distance,Or=On.shadow&&On.shadow.map?On.shadow.map.texture:null;if(On.isAmbientLight)bt+=_r.r*Tr*kn,Tt+=_r.g*Tr*kn,St+=_r.b*Tr*kn;else if(On.isLightProbe)for(let Gr=0;Gr<9;Gr++)_e.probe[Gr].addScaledVector(On.sh.coefficients[Gr],Tr);else if(On.isDirectionalLight){const Gr=g.get(On);if(Gr.color.copy(On.color).multiplyScalar(On.intensity*kn),On.castShadow){const cr=On.shadow,ur=$.get(On);ur.shadowBias=cr.bias,ur.shadowNormalBias=cr.normalBias,ur.shadowRadius=cr.radius,ur.shadowMapSize=cr.mapSize,_e.directionalShadow[It]=ur,_e.directionalShadowMap[It]=Or,_e.directionalShadowMatrix[It]=On.shadow.matrix,zt++}_e.directional[It]=Gr,It++}else if(On.isSpotLight){const Gr=g.get(On);Gr.position.setFromMatrixPosition(On.matrixWorld),Gr.color.copy(_r).multiplyScalar(Tr*kn),Gr.distance=gr,Gr.coneCos=Math.cos(On.angle),Gr.penumbraCos=Math.cos(On.angle*(1-On.penumbra)),Gr.decay=On.decay,_e.spot[Dt]=Gr;const cr=On.shadow;if(On.map&&(_e.spotLightMap[sn]=On.map,sn++,cr.updateMatrices(On),On.castShadow&&ln++),_e.spotLightMatrix[Dt]=cr.matrix,On.castShadow){const ur=$.get(On);ur.shadowBias=cr.bias,ur.shadowNormalBias=cr.normalBias,ur.shadowRadius=cr.radius,ur.shadowMapSize=cr.mapSize,_e.spotShadow[Dt]=ur,_e.spotShadowMap[Dt]=Or,tn++}Dt++}else if(On.isRectAreaLight){const Gr=g.get(On);Gr.color.copy(_r).multiplyScalar(Tr),Gr.halfWidth.set(.5*On.width,0,0),Gr.halfHeight.set(0,.5*On.height,0),_e.rectArea[Ft]=Gr,Ft++}else if(On.isPointLight){const Gr=g.get(On);if(Gr.color.copy(On.color).multiplyScalar(On.intensity*kn),Gr.distance=On.distance,Gr.decay=On.decay,On.castShadow){const cr=On.shadow,ur=$.get(On);ur.shadowBias=cr.bias,ur.shadowNormalBias=cr.normalBias,ur.shadowRadius=cr.radius,ur.shadowMapSize=cr.mapSize,ur.shadowCameraNear=cr.camera.near,ur.shadowCameraFar=cr.camera.far,_e.pointShadow[Rt]=ur,_e.pointShadowMap[Rt]=Or,_e.pointShadowMatrix[Rt]=On.shadow.matrix,Xt++}_e.point[Rt]=Gr,Rt++}else if(On.isHemisphereLight){const Gr=g.get(On);Gr.skyColor.copy(On.color).multiplyScalar(Tr*kn),Gr.groundColor.copy(On.groundColor).multiplyScalar(Tr*kn),_e.hemi[Nt]=Gr,Nt++}}Ft>0&&(o.isWebGL2||dt.has("OES_texture_float_linear")===!0?(_e.rectAreaLTC1=Xr.LTC_FLOAT_1,_e.rectAreaLTC2=Xr.LTC_FLOAT_2):dt.has("OES_texture_half_float_linear")===!0?(_e.rectAreaLTC1=Xr.LTC_HALF_1,_e.rectAreaLTC2=Xr.LTC_HALF_2):console.error("THREE.WebGLRenderer: Unable to use RectAreaLight. Missing WebGL extensions.")),_e.ambient[0]=bt,_e.ambient[1]=Tt,_e.ambient[2]=St;const Ln=_e.hash;Ln.directionalLength===It&&Ln.pointLength===Rt&&Ln.spotLength===Dt&&Ln.rectAreaLength===Ft&&Ln.hemiLength===Nt&&Ln.numDirectionalShadows===zt&&Ln.numPointShadows===Xt&&Ln.numSpotShadows===tn&&Ln.numSpotMaps===sn||(_e.directional.length=It,_e.spot.length=Dt,_e.rectArea.length=Ft,_e.point.length=Rt,_e.hemi.length=Nt,_e.directionalShadow.length=zt,_e.directionalShadowMap.length=zt,_e.pointShadow.length=Xt,_e.pointShadowMap.length=Xt,_e.spotShadow.length=tn,_e.spotShadowMap.length=tn,_e.directionalShadowMatrix.length=zt,_e.pointShadowMatrix.length=Xt,_e.spotLightMatrix.length=tn+sn-ln,_e.spotLightMap.length=sn,_e.numSpotLightShadowsWithMaps=ln,Ln.directionalLength=It,Ln.pointLength=Rt,Ln.spotLength=Dt,Ln.rectAreaLength=Ft,Ln.hemiLength=Nt,Ln.numDirectionalShadows=zt,Ln.numPointShadows=Xt,Ln.numSpotShadows=tn,Ln.numSpotMaps=sn,_e.version=oT++)},setupView:function(ft,mt){let bt=0,Tt=0,St=0,It=0,Rt=0;const Dt=mt.matrixWorldInverse;for(let Ft=0,Nt=ft.length;Ft<Nt;Ft++){const zt=ft[Ft];if(zt.isDirectionalLight){const Xt=_e.directional[bt];Xt.direction.setFromMatrixPosition(zt.matrixWorld),rt.setFromMatrixPosition(zt.target.matrixWorld),Xt.direction.sub(rt),Xt.direction.transformDirection(Dt),bt++}else if(zt.isSpotLight){const Xt=_e.spot[St];Xt.position.setFromMatrixPosition(zt.matrixWorld),Xt.position.applyMatrix4(Dt),Xt.direction.setFromMatrixPosition(zt.matrixWorld),rt.setFromMatrixPosition(zt.target.matrixWorld),Xt.direction.sub(rt),Xt.direction.transformDirection(Dt),St++}else if(zt.isRectAreaLight){const Xt=_e.rectArea[It];Xt.position.setFromMatrixPosition(zt.matrixWorld),Xt.position.applyMatrix4(Dt),ct.identity(),at.copy(zt.matrixWorld),at.premultiply(Dt),ct.extractRotation(at),Xt.halfWidth.set(.5*zt.width,0,0),Xt.halfHeight.set(0,.5*zt.height,0),Xt.halfWidth.applyMatrix4(ct),Xt.halfHeight.applyMatrix4(ct),It++}else if(zt.isPointLight){const Xt=_e.point[Tt];Xt.position.setFromMatrixPosition(zt.matrixWorld),Xt.position.applyMatrix4(Dt),Tt++}else if(zt.isHemisphereLight){const Xt=_e.hemi[Rt];Xt.direction.setFromMatrixPosition(zt.matrixWorld),Xt.direction.transformDirection(Dt),Rt++}}},state:_e}}function cT(dt,o){const g=new lT(dt,o),$=[],_e=[];return{init:function(){$.length=0,_e.length=0},state:{lightsArray:$,shadowsArray:_e,lights:g},setupLights:function(rt){g.setup($,rt)},setupLightsView:function(rt){g.setupView($,rt)},pushLight:function(rt){$.push(rt)},pushShadow:function(rt){_e.push(rt)}}}function nC(dt,o){let g=new WeakMap;return{get:function($,_e=0){const rt=g.get($);let at;return rt===void 0?(at=new cT(dt,o),g.set($,[at])):_e>=rt.length?(at=new cT(dt,o),rt.push(at)):at=rt[_e],at},dispose:function(){g=new WeakMap}}}class ox extends Fl{constructor(o){super(),this.isMeshDepthMaterial=!0,this.type="MeshDepthMaterial",this.depthPacking=vu,this.map=null,this.alphaMap=null,this.displacementMap=null,this.displacementScale=1,this.displacementBias=0,this.wireframe=!1,this.wireframeLinewidth=1,this.setValues(o)}copy(o){return super.copy(o),this.depthPacking=o.depthPacking,this.map=o.map,this.alphaMap=o.alphaMap,this.displacementMap=o.displacementMap,this.displacementScale=o.displacementScale,this.displacementBias=o.displacementBias,this.wireframe=o.wireframe,this.wireframeLinewidth=o.wireframeLinewidth,this}}class PA extends Fl{constructor(o){super(),this.isMeshDistanceMaterial=!0,this.type="MeshDistanceMaterial",this.referencePosition=new fn,this.nearDistance=1,this.farDistance=1e3,this.map=null,this.alphaMap=null,this.displacementMap=null,this.displacementScale=1,this.displacementBias=0,this.setValues(o)}copy(o){return super.copy(o),this.referencePosition.copy(o.referencePosition),this.nearDistance=o.nearDistance,this.farDistance=o.farDistance,this.map=o.map,this.alphaMap=o.alphaMap,this.displacementMap=o.displacementMap,this.displacementScale=o.displacementScale,this.displacementBias=o.displacementBias,this}}function tE(dt,o,g){let $=new Ym;const _e=new Sr,rt=new Sr,at=new _o,ct=new ox({depthPacking:Mv}),ft=new PA,mt={},bt=g.maxTextureSize,Tt={0:$t,1:_n,2:bn},St=new _m({defines:{VSM_SAMPLES:8},uniforms:{shadow_pass:{value:null},resolution:{value:new Sr},radius:{value:4}},vertexShader:`void main() {
	gl_Position = vec4( position, 1.0 );
}`,fragmentShader:`uniform sampler2D shadow_pass;
uniform vec2 resolution;
uniform float radius;
#include <packing>
void main() {
	const float samples = float( VSM_SAMPLES );
	float mean = 0.0;
	float squared_mean = 0.0;
	float uvStride = samples <= 1.0 ? 0.0 : 2.0 / ( samples - 1.0 );
	float uvStart = samples <= 1.0 ? 0.0 : - 1.0;
	for ( float i = 0.0; i < samples; i ++ ) {
		float uvOffset = uvStart + i * uvStride;
		#ifdef HORIZONTAL_PASS
			vec2 distribution = unpackRGBATo2Half( texture2D( shadow_pass, ( gl_FragCoord.xy + vec2( uvOffset, 0.0 ) * radius ) / resolution ) );
			mean += distribution.x;
			squared_mean += distribution.y * distribution.y + distribution.x * distribution.x;
		#else
			float depth = unpackRGBAToDepth( texture2D( shadow_pass, ( gl_FragCoord.xy + vec2( 0.0, uvOffset ) * radius ) / resolution ) );
			mean += depth;
			squared_mean += depth * depth;
		#endif
	}
	mean = mean / samples;
	squared_mean = squared_mean / samples;
	float std_dev = sqrt( squared_mean - mean * mean );
	gl_FragColor = pack2HalfToRGBA( vec2( mean, std_dev ) );
}`}),It=St.clone();It.defines.HORIZONTAL_PASS=1;const Rt=new fs;Rt.setAttribute("position",new Ro(new Float32Array([-1,-1,.5,3,-1,.5,-1,3,.5]),3));const Dt=new Zl(Rt,St),Ft=this;function Nt(tn,sn){const ln=o.update(Dt);St.defines.VSM_SAMPLES!==tn.blurSamples&&(St.defines.VSM_SAMPLES=tn.blurSamples,It.defines.VSM_SAMPLES=tn.blurSamples,St.needsUpdate=!0,It.needsUpdate=!0),tn.mapPass===null&&(tn.mapPass=new ap(_e.x,_e.y)),St.uniforms.shadow_pass.value=tn.map.texture,St.uniforms.resolution.value=tn.mapSize,St.uniforms.radius.value=tn.radius,dt.setRenderTarget(tn.mapPass),dt.clear(),dt.renderBufferDirect(sn,null,ln,St,Dt,null),It.uniforms.shadow_pass.value=tn.mapPass.texture,It.uniforms.resolution.value=tn.mapSize,It.uniforms.radius.value=tn.radius,dt.setRenderTarget(tn.map),dt.clear(),dt.renderBufferDirect(sn,null,ln,It,Dt,null)}function zt(tn,sn,ln,kn,Ln,qn){let Kn=null;const On=ln.isPointLight===!0?tn.customDistanceMaterial:tn.customDepthMaterial;if(Kn=On!==void 0?On:ln.isPointLight===!0?ft:ct,dt.localClippingEnabled&&sn.clipShadows===!0&&Array.isArray(sn.clippingPlanes)&&sn.clippingPlanes.length!==0||sn.displacementMap&&sn.displacementScale!==0||sn.alphaMap&&sn.alphaTest>0){const _r=Kn.uuid,Tr=sn.uuid;let gr=mt[_r];gr===void 0&&(gr={},mt[_r]=gr);let Or=gr[Tr];Or===void 0&&(Or=Kn.clone(),gr[Tr]=Or),Kn=Or}return Kn.visible=sn.visible,Kn.wireframe=sn.wireframe,Kn.side=qn===wn?sn.shadowSide!==null?sn.shadowSide:sn.side:sn.shadowSide!==null?sn.shadowSide:Tt[sn.side],Kn.alphaMap=sn.alphaMap,Kn.alphaTest=sn.alphaTest,Kn.clipShadows=sn.clipShadows,Kn.clippingPlanes=sn.clippingPlanes,Kn.clipIntersection=sn.clipIntersection,Kn.displacementMap=sn.displacementMap,Kn.displacementScale=sn.displacementScale,Kn.displacementBias=sn.displacementBias,Kn.wireframeLinewidth=sn.wireframeLinewidth,Kn.linewidth=sn.linewidth,ln.isPointLight===!0&&Kn.isMeshDistanceMaterial===!0&&(Kn.referencePosition.setFromMatrixPosition(ln.matrixWorld),Kn.nearDistance=kn,Kn.farDistance=Ln),Kn}function Xt(tn,sn,ln,kn,Ln){if(tn.visible===!1)return;if(tn.layers.test(sn.layers)&&(tn.isMesh||tn.isLine||tn.isPoints)&&(tn.castShadow||tn.receiveShadow&&Ln===wn)&&(!tn.frustumCulled||$.intersectsObject(tn))){tn.modelViewMatrix.multiplyMatrices(ln.matrixWorldInverse,tn.matrixWorld);const Kn=o.update(tn),On=tn.material;if(Array.isArray(On)){const _r=Kn.groups;for(let Tr=0,gr=_r.length;Tr<gr;Tr++){const Or=_r[Tr],Gr=On[Or.materialIndex];if(Gr&&Gr.visible){const cr=zt(tn,Gr,kn,ln.near,ln.far,Ln);dt.renderBufferDirect(ln,null,Kn,cr,tn,Or)}}}else if(On.visible){const _r=zt(tn,On,kn,ln.near,ln.far,Ln);dt.renderBufferDirect(ln,null,Kn,_r,tn,null)}}const qn=tn.children;for(let Kn=0,On=qn.length;Kn<On;Kn++)Xt(qn[Kn],sn,ln,kn,Ln)}this.enabled=!1,this.autoUpdate=!0,this.needsUpdate=!1,this.type=gn,this.render=function(tn,sn,ln){if(Ft.enabled===!1||Ft.autoUpdate===!1&&Ft.needsUpdate===!1||tn.length===0)return;const kn=dt.getRenderTarget(),Ln=dt.getActiveCubeFace(),qn=dt.getActiveMipmapLevel(),Kn=dt.state;Kn.setBlending(Ut),Kn.buffers.color.setClear(1,1,1,1),Kn.buffers.depth.setTest(!0),Kn.setScissorTest(!1);for(let On=0,_r=tn.length;On<_r;On++){const Tr=tn[On],gr=Tr.shadow;if(gr===void 0){console.warn("THREE.WebGLShadowMap:",Tr,"has no shadow.");continue}if(gr.autoUpdate===!1&&gr.needsUpdate===!1)continue;_e.copy(gr.mapSize);const Or=gr.getFrameExtents();if(_e.multiply(Or),rt.copy(gr.mapSize),(_e.x>bt||_e.y>bt)&&(_e.x>bt&&(rt.x=Math.floor(bt/Or.x),_e.x=rt.x*Or.x,gr.mapSize.x=rt.x),_e.y>bt&&(rt.y=Math.floor(bt/Or.y),_e.y=rt.y*Or.y,gr.mapSize.y=rt.y)),gr.map===null){const cr=this.type!==wn?{minFilter:na,magFilter:na}:{};gr.map=new ap(_e.x,_e.y,cr),gr.map.texture.name=Tr.name+".shadowMap",gr.camera.updateProjectionMatrix()}dt.setRenderTarget(gr.map),dt.clear();const Gr=gr.getViewportCount();for(let cr=0;cr<Gr;cr++){const ur=gr.getViewport(cr);at.set(rt.x*ur.x,rt.y*ur.y,rt.x*ur.z,rt.y*ur.w),Kn.viewport(at),gr.updateMatrices(Tr,cr),$=gr.getFrustum(),Xt(sn,ln,gr.camera,Tr,this.type)}gr.isPointLightShadow!==!0&&this.type===wn&&Nt(gr,ln),gr.needsUpdate=!1}Ft.needsUpdate=!1,dt.setRenderTarget(kn,Ln,qn)}}function uT(dt,o,g){const $=g.isWebGL2,_e=new function(){let Jt=!1;const or=new _o;let Zn=null;const vr=new _o(0,0,0,0);return{setMask:function(Pr){Zn===Pr||Jt||(dt.colorMask(Pr,Pr,Pr,Pr),Zn=Pr)},setLocked:function(Pr){Jt=Pr},setClear:function(Pr,Jr,gs,Ds,Ns){Ns===!0&&(Pr*=Ds,Jr*=Ds,gs*=Ds),or.set(Pr,Jr,gs,Ds),vr.equals(or)===!1&&(dt.clearColor(Pr,Jr,gs,Ds),vr.copy(or))},reset:function(){Jt=!1,Zn=null,vr.set(-1,0,0,0)}}},rt=new function(){let Jt=!1,or=null,Zn=null,vr=null;return{setTest:function(Pr){Pr?ys(2929):Hs(2929)},setMask:function(Pr){or===Pr||Jt||(dt.depthMask(Pr),or=Pr)},setFunc:function(Pr){if(Zn!==Pr){if(Pr)switch(Pr){case Er:dt.depthFunc(512);break;case Yn:dt.depthFunc(519);break;case Kt:dt.depthFunc(513);break;case rn:dt.depthFunc(515);break;case jn:dt.depthFunc(514);break;case Ur:dt.depthFunc(518);break;case kr:dt.depthFunc(516);break;case zr:dt.depthFunc(517);break;default:dt.depthFunc(515)}else dt.depthFunc(515);Zn=Pr}},setLocked:function(Pr){Jt=Pr},setClear:function(Pr){vr!==Pr&&(dt.clearDepth(Pr),vr=Pr)},reset:function(){Jt=!1,or=null,Zn=null,vr=null}}},at=new function(){let Jt=!1,or=null,Zn=null,vr=null,Pr=null,Jr=null,gs=null,Ds=null,Ns=null;return{setTest:function(xs){Jt||(xs?ys(2960):Hs(2960))},setMask:function(xs){or===xs||Jt||(dt.stencilMask(xs),or=xs)},setFunc:function(xs,Ms,xo){Zn===xs&&vr===Ms&&Pr===xo||(dt.stencilFunc(xs,Ms,xo),Zn=xs,vr=Ms,Pr=xo)},setOp:function(xs,Ms,xo){Jr===xs&&gs===Ms&&Ds===xo||(dt.stencilOp(xs,Ms,xo),Jr=xs,gs=Ms,Ds=xo)},setLocked:function(xs){Jt=xs},setClear:function(xs){Ns!==xs&&(dt.clearStencil(xs),Ns=xs)},reset:function(){Jt=!1,or=null,Zn=null,vr=null,Pr=null,Jr=null,gs=null,Ds=null,Ns=null}}},ct=new WeakMap,ft=new WeakMap;let mt={},bt={},Tt=new WeakMap,St=[],It=null,Rt=!1,Dt=null,Ft=null,Nt=null,zt=null,Xt=null,tn=null,sn=null,ln=!1,kn=null,Ln=null,qn=null,Kn=null,On=null;const _r=dt.getParameter(35661);let Tr=!1,gr=0;const Or=dt.getParameter(7938);Or.indexOf("WebGL")!==-1?(gr=parseFloat(/^WebGL (\d)/.exec(Or)[1]),Tr=gr>=1):Or.indexOf("OpenGL ES")!==-1&&(gr=parseFloat(/^OpenGL ES (\d)/.exec(Or)[1]),Tr=gr>=2);let Gr=null,cr={};const ur=dt.getParameter(3088),Fr=dt.getParameter(2978),Ar=new _o().fromArray(ur),Qr=new _o().fromArray(Fr);function as(Jt,or,Zn){const vr=new Uint8Array(4),Pr=dt.createTexture();dt.bindTexture(Jt,Pr),dt.texParameteri(Jt,10241,9728),dt.texParameteri(Jt,10240,9728);for(let Jr=0;Jr<Zn;Jr++)dt.texImage2D(or+Jr,0,6408,1,1,0,6408,5121,vr);return Pr}const Qs={};function ys(Jt){mt[Jt]!==!0&&(dt.enable(Jt),mt[Jt]=!0)}function Hs(Jt){mt[Jt]!==!1&&(dt.disable(Jt),mt[Jt]=!1)}Qs[3553]=as(3553,3553,1),Qs[34067]=as(34067,34069,6),_e.setClear(0,0,0,1),rt.setClear(1),at.setClear(0),ys(2929),rt.setFunc(rn),Hn(!1),In(Gt),ys(2884),tr(Ut);const Dn={[Qt]:32774,[Wt]:32778,[Zt]:32779};if($)Dn[En]=32775,Dn[pn]=32776;else{const Jt=o.get("EXT_blend_minmax");Jt!==null&&(Dn[En]=Jt.MIN_EXT,Dn[pn]=Jt.MAX_EXT)}const yn={[er]:0,[Ir]:1,[Dr]:768,[yr]:770,[$n]:776,[zn]:774,[Xn]:772,[Vr]:769,[Hr]:771,[nr]:775,[ir]:773};function tr(Jt,or,Zn,vr,Pr,Jr,gs,Ds){if(Jt!==Ut){if(Rt===!1&&(ys(3042),Rt=!0),Jt===Cn)Pr=Pr||or,Jr=Jr||Zn,gs=gs||vr,or===Ft&&Pr===Xt||(dt.blendEquationSeparate(Dn[or],Dn[Pr]),Ft=or,Xt=Pr),Zn===Nt&&vr===zt&&Jr===tn&&gs===sn||(dt.blendFuncSeparate(yn[Zn],yn[vr],yn[Jr],yn[gs]),Nt=Zn,zt=vr,tn=Jr,sn=gs),Dt=Jt,ln=null;else if(Jt!==Dt||Ds!==ln){if(Ft===Qt&&Xt===Qt||(dt.blendEquation(32774),Ft=Qt,Xt=Qt),Ds)switch(Jt){case jt:dt.blendFuncSeparate(1,771,1,771);break;case Yt:dt.blendFunc(1,1);break;case Bn:dt.blendFuncSeparate(0,769,0,1);break;case un:dt.blendFuncSeparate(0,768,0,770);break;default:console.error("THREE.WebGLState: Invalid blending: ",Jt)}else switch(Jt){case jt:dt.blendFuncSeparate(770,771,1,771);break;case Yt:dt.blendFunc(770,1);break;case Bn:dt.blendFuncSeparate(0,769,0,1);break;case un:dt.blendFunc(0,768);break;default:console.error("THREE.WebGLState: Invalid blending: ",Jt)}Nt=null,zt=null,tn=null,sn=null,Dt=Jt,ln=Ds}}else Rt===!0&&(Hs(3042),Rt=!1)}function Hn(Jt){kn!==Jt&&(Jt?dt.frontFace(2304):dt.frontFace(2305),kn=Jt)}function In(Jt){Jt!==kt?(ys(2884),Jt!==Ln&&(Jt===Gt?dt.cullFace(1029):Jt===Vt?dt.cullFace(1028):dt.cullFace(1032))):Hs(2884),Ln=Jt}function Wn(Jt,or,Zn){Jt?(ys(32823),Kn===or&&On===Zn||(dt.polygonOffset(or,Zn),Kn=or,On=Zn)):Hs(32823)}function pr(Jt){Jt===void 0&&(Jt=33984+_r-1),Gr!==Jt&&(dt.activeTexture(Jt),Gr=Jt)}return{buffers:{color:_e,depth:rt,stencil:at},enable:ys,disable:Hs,bindFramebuffer:function(Jt,or){return bt[Jt]!==or&&(dt.bindFramebuffer(Jt,or),bt[Jt]=or,$&&(Jt===36009&&(bt[36160]=or),Jt===36160&&(bt[36009]=or)),!0)},drawBuffers:function(Jt,or){let Zn=St,vr=!1;if(Jt)if(Zn=Tt.get(or),Zn===void 0&&(Zn=[],Tt.set(or,Zn)),Jt.isWebGLMultipleRenderTargets){const Pr=Jt.texture;if(Zn.length!==Pr.length||Zn[0]!==36064){for(let Jr=0,gs=Pr.length;Jr<gs;Jr++)Zn[Jr]=36064+Jr;Zn.length=Pr.length,vr=!0}}else Zn[0]!==36064&&(Zn[0]=36064,vr=!0);else Zn[0]!==1029&&(Zn[0]=1029,vr=!0);vr&&(g.isWebGL2?dt.drawBuffers(Zn):o.get("WEBGL_draw_buffers").drawBuffersWEBGL(Zn))},useProgram:function(Jt){return It!==Jt&&(dt.useProgram(Jt),It=Jt,!0)},setBlending:tr,setMaterial:function(Jt,or){Jt.side===bn?Hs(2884):ys(2884);let Zn=Jt.side===$t;or&&(Zn=!Zn),Hn(Zn),Jt.blending===jt&&Jt.transparent===!1?tr(Ut):tr(Jt.blending,Jt.blendEquation,Jt.blendSrc,Jt.blendDst,Jt.blendEquationAlpha,Jt.blendSrcAlpha,Jt.blendDstAlpha,Jt.premultipliedAlpha),rt.setFunc(Jt.depthFunc),rt.setTest(Jt.depthTest),rt.setMask(Jt.depthWrite),_e.setMask(Jt.colorWrite);const vr=Jt.stencilWrite;at.setTest(vr),vr&&(at.setMask(Jt.stencilWriteMask),at.setFunc(Jt.stencilFunc,Jt.stencilRef,Jt.stencilFuncMask),at.setOp(Jt.stencilFail,Jt.stencilZFail,Jt.stencilZPass)),Wn(Jt.polygonOffset,Jt.polygonOffsetFactor,Jt.polygonOffsetUnits),Jt.alphaToCoverage===!0?ys(32926):Hs(32926)},setFlipSided:Hn,setCullFace:In,setLineWidth:function(Jt){Jt!==qn&&(Tr&&dt.lineWidth(Jt),qn=Jt)},setPolygonOffset:Wn,setScissorTest:function(Jt){Jt?ys(3089):Hs(3089)},activeTexture:pr,bindTexture:function(Jt,or){Gr===null&&pr();let Zn=cr[Gr];Zn===void 0&&(Zn={type:void 0,texture:void 0},cr[Gr]=Zn),Zn.type===Jt&&Zn.texture===or||(dt.bindTexture(Jt,or||Qs[Jt]),Zn.type=Jt,Zn.texture=or)},unbindTexture:function(){const Jt=cr[Gr];Jt!==void 0&&Jt.type!==void 0&&(dt.bindTexture(Jt.type,null),Jt.type=void 0,Jt.texture=void 0)},compressedTexImage2D:function(){try{dt.compressedTexImage2D.apply(dt,arguments)}catch(Jt){console.error("THREE.WebGLState:",Jt)}},texImage2D:function(){try{dt.texImage2D.apply(dt,arguments)}catch(Jt){console.error("THREE.WebGLState:",Jt)}},texImage3D:function(){try{dt.texImage3D.apply(dt,arguments)}catch(Jt){console.error("THREE.WebGLState:",Jt)}},updateUBOMapping:function(Jt,or){let Zn=ft.get(or);Zn===void 0&&(Zn=new WeakMap,ft.set(or,Zn));let vr=Zn.get(Jt);vr===void 0&&(vr=dt.getUniformBlockIndex(or,Jt.name),Zn.set(Jt,vr))},uniformBlockBinding:function(Jt,or){const Zn=ft.get(or).get(Jt);ct.get(Jt)!==Zn&&(dt.uniformBlockBinding(or,Zn,Jt.__bindingPointIndex),ct.set(Jt,Zn))},texStorage2D:function(){try{dt.texStorage2D.apply(dt,arguments)}catch(Jt){console.error("THREE.WebGLState:",Jt)}},texStorage3D:function(){try{dt.texStorage3D.apply(dt,arguments)}catch(Jt){console.error("THREE.WebGLState:",Jt)}},texSubImage2D:function(){try{dt.texSubImage2D.apply(dt,arguments)}catch(Jt){console.error("THREE.WebGLState:",Jt)}},texSubImage3D:function(){try{dt.texSubImage3D.apply(dt,arguments)}catch(Jt){console.error("THREE.WebGLState:",Jt)}},compressedTexSubImage2D:function(){try{dt.compressedTexSubImage2D.apply(dt,arguments)}catch(Jt){console.error("THREE.WebGLState:",Jt)}},scissor:function(Jt){Ar.equals(Jt)===!1&&(dt.scissor(Jt.x,Jt.y,Jt.z,Jt.w),Ar.copy(Jt))},viewport:function(Jt){Qr.equals(Jt)===!1&&(dt.viewport(Jt.x,Jt.y,Jt.z,Jt.w),Qr.copy(Jt))},reset:function(){dt.disable(3042),dt.disable(2884),dt.disable(2929),dt.disable(32823),dt.disable(3089),dt.disable(2960),dt.disable(32926),dt.blendEquation(32774),dt.blendFunc(1,0),dt.blendFuncSeparate(1,0,1,0),dt.colorMask(!0,!0,!0,!0),dt.clearColor(0,0,0,0),dt.depthMask(!0),dt.depthFunc(513),dt.clearDepth(1),dt.stencilMask(4294967295),dt.stencilFunc(519,0,4294967295),dt.stencilOp(7680,7680,7680),dt.clearStencil(0),dt.cullFace(1029),dt.frontFace(2305),dt.polygonOffset(0,0),dt.activeTexture(33984),dt.bindFramebuffer(36160,null),$===!0&&(dt.bindFramebuffer(36009,null),dt.bindFramebuffer(36008,null)),dt.useProgram(null),dt.lineWidth(1),dt.scissor(0,0,dt.canvas.width,dt.canvas.height),dt.viewport(0,0,dt.canvas.width,dt.canvas.height),mt={},Gr=null,cr={},bt={},Tt=new WeakMap,St=[],It=null,Rt=!1,Dt=null,Ft=null,Nt=null,zt=null,Xt=null,tn=null,sn=null,ln=!1,kn=null,Ln=null,qn=null,Kn=null,On=null,Ar.set(0,0,dt.canvas.width,dt.canvas.height),Qr.set(0,0,dt.canvas.width,dt.canvas.height),_e.reset(),rt.reset(),at.reset()}}}function iC(dt,o,g,$,_e,rt,at){const ct=_e.isWebGL2,ft=_e.maxTextures,mt=_e.maxCubemapSize,bt=_e.maxTextureSize,Tt=_e.maxSamples,St=o.has("WEBGL_multisampled_render_to_texture")?o.get("WEBGL_multisampled_render_to_texture"):null,It=/OculusBrowser/g.test(navigator.userAgent),Rt=new WeakMap;let Dt;const Ft=new WeakMap;let Nt=!1;try{Nt=typeof OffscreenCanvas<"u"&&new OffscreenCanvas(1,1).getContext("2d")!==null}catch{}function zt(Dn,yn){return Nt?new OffscreenCanvas(Dn,yn):p0("canvas")}function Xt(Dn,yn,tr,Hn){let In=1;if((Dn.width>Hn||Dn.height>Hn)&&(In=Hn/Math.max(Dn.width,Dn.height)),In<1||yn===!0){if(typeof HTMLImageElement<"u"&&Dn instanceof HTMLImageElement||typeof HTMLCanvasElement<"u"&&Dn instanceof HTMLCanvasElement||typeof ImageBitmap<"u"&&Dn instanceof ImageBitmap){const Wn=yn?Du:Math.floor,pr=Wn(In*Dn.width),Jt=Wn(In*Dn.height);Dt===void 0&&(Dt=zt(pr,Jt));const or=tr?zt(pr,Jt):Dt;return or.width=pr,or.height=Jt,or.getContext("2d").drawImage(Dn,0,0,pr,Jt),console.warn("THREE.WebGLRenderer: Texture has been resized from ("+Dn.width+"x"+Dn.height+") to ("+pr+"x"+Jt+")."),or}return"data"in Dn&&console.warn("THREE.WebGLRenderer: Image in DataTexture is too big ("+Dn.width+"x"+Dn.height+")."),Dn}return Dn}function tn(Dn){return lA(Dn.width)&&lA(Dn.height)}function sn(Dn,yn){return Dn.generateMipmaps&&yn&&Dn.minFilter!==na&&Dn.minFilter!==xa}function ln(Dn){dt.generateMipmap(Dn)}function kn(Dn,yn,tr,Hn,In=!1){if(ct===!1)return yn;if(Dn!==null){if(dt[Dn]!==void 0)return dt[Dn];console.warn("THREE.WebGLRenderer: Attempt to use non-existing WebGL internal format '"+Dn+"'")}let Wn=yn;return yn===6403&&(tr===5126&&(Wn=33326),tr===5131&&(Wn=33325),tr===5121&&(Wn=33321)),yn===33319&&(tr===5126&&(Wn=33328),tr===5131&&(Wn=33327),tr===5121&&(Wn=33323)),yn===6408&&(tr===5126&&(Wn=34836),tr===5131&&(Wn=34842),tr===5121&&(Wn=Hn===No&&In===!1?35907:32856),tr===32819&&(Wn=32854),tr===32820&&(Wn=32855)),Wn!==33325&&Wn!==33326&&Wn!==33327&&Wn!==33328&&Wn!==34842&&Wn!==34836||o.get("EXT_color_buffer_float"),Wn}function Ln(Dn,yn,tr){return sn(Dn,tr)===!0||Dn.isFramebufferTexture&&Dn.minFilter!==na&&Dn.minFilter!==xa?Math.log2(Math.max(yn.width,yn.height))+1:Dn.mipmaps!==void 0&&Dn.mipmaps.length>0?Dn.mipmaps.length:Dn.isCompressedTexture&&Array.isArray(Dn.image)?yn.mipmaps.length:1}function qn(Dn){return Dn===na||Dn===mu||Dn===ga?9728:9729}function Kn(Dn){const yn=Dn.target;yn.removeEventListener("dispose",Kn),function(tr){const Hn=$.get(tr);if(Hn.__webglInit===void 0)return;const In=tr.source,Wn=Ft.get(In);if(Wn){const pr=Wn[Hn.__cacheKey];pr.usedTimes--,pr.usedTimes===0&&_r(tr),Object.keys(Wn).length===0&&Ft.delete(In)}$.remove(tr)}(yn),yn.isVideoTexture&&Rt.delete(yn)}function On(Dn){const yn=Dn.target;yn.removeEventListener("dispose",On),function(tr){const Hn=tr.texture,In=$.get(tr),Wn=$.get(Hn);if(Wn.__webglTexture!==void 0&&(dt.deleteTexture(Wn.__webglTexture),at.memory.textures--),tr.depthTexture&&tr.depthTexture.dispose(),tr.isWebGLCubeRenderTarget)for(let pr=0;pr<6;pr++)dt.deleteFramebuffer(In.__webglFramebuffer[pr]),In.__webglDepthbuffer&&dt.deleteRenderbuffer(In.__webglDepthbuffer[pr]);else{if(dt.deleteFramebuffer(In.__webglFramebuffer),In.__webglDepthbuffer&&dt.deleteRenderbuffer(In.__webglDepthbuffer),In.__webglMultisampledFramebuffer&&dt.deleteFramebuffer(In.__webglMultisampledFramebuffer),In.__webglColorRenderbuffer)for(let pr=0;pr<In.__webglColorRenderbuffer.length;pr++)In.__webglColorRenderbuffer[pr]&&dt.deleteRenderbuffer(In.__webglColorRenderbuffer[pr]);In.__webglDepthRenderbuffer&&dt.deleteRenderbuffer(In.__webglDepthRenderbuffer)}if(tr.isWebGLMultipleRenderTargets)for(let pr=0,Jt=Hn.length;pr<Jt;pr++){const or=$.get(Hn[pr]);or.__webglTexture&&(dt.deleteTexture(or.__webglTexture),at.memory.textures--),$.remove(Hn[pr])}$.remove(Hn),$.remove(tr)}(yn)}function _r(Dn){const yn=$.get(Dn);dt.deleteTexture(yn.__webglTexture);const tr=Dn.source;delete Ft.get(tr)[yn.__cacheKey],at.memory.textures--}let Tr=0;function gr(Dn,yn){const tr=$.get(Dn);if(Dn.isVideoTexture&&function(Hn){const In=at.render.frame;Rt.get(Hn)!==In&&(Rt.set(Hn,In),Hn.update())}(Dn),Dn.isRenderTargetTexture===!1&&Dn.version>0&&tr.__version!==Dn.version){const Hn=Dn.image;if(Hn===null)console.warn("THREE.WebGLRenderer: Texture marked for update but no image data found.");else{if(Hn.complete!==!1)return void Fr(tr,Dn,yn);console.warn("THREE.WebGLRenderer: Texture marked for update but image is incomplete")}}g.activeTexture(33984+yn),g.bindTexture(3553,tr.__webglTexture)}const Or={[Mu]:10497,[Lo]:33071,[Lp]:33648},Gr={[na]:9728,[mu]:9984,[ga]:9986,[xa]:9729,[km]:9985,[mo]:9987};function cr(Dn,yn,tr){if(tr?(dt.texParameteri(Dn,10242,Or[yn.wrapS]),dt.texParameteri(Dn,10243,Or[yn.wrapT]),Dn!==32879&&Dn!==35866||dt.texParameteri(Dn,32882,Or[yn.wrapR]),dt.texParameteri(Dn,10240,Gr[yn.magFilter]),dt.texParameteri(Dn,10241,Gr[yn.minFilter])):(dt.texParameteri(Dn,10242,33071),dt.texParameteri(Dn,10243,33071),Dn!==32879&&Dn!==35866||dt.texParameteri(Dn,32882,33071),yn.wrapS===Lo&&yn.wrapT===Lo||console.warn("THREE.WebGLRenderer: Texture is not power of two. Texture.wrapS and Texture.wrapT should be set to THREE.ClampToEdgeWrapping."),dt.texParameteri(Dn,10240,qn(yn.magFilter)),dt.texParameteri(Dn,10241,qn(yn.minFilter)),yn.minFilter!==na&&yn.minFilter!==xa&&console.warn("THREE.WebGLRenderer: Texture is not power of two. Texture.minFilter should be set to THREE.NearestFilter or THREE.LinearFilter.")),o.has("EXT_texture_filter_anisotropic")===!0){const Hn=o.get("EXT_texture_filter_anisotropic");if(yn.type===Wl&&o.has("OES_texture_float_linear")===!1||ct===!1&&yn.type===lm&&o.has("OES_texture_half_float_linear")===!1)return;(yn.anisotropy>1||$.get(yn).__currentAnisotropy)&&(dt.texParameterf(Dn,Hn.TEXTURE_MAX_ANISOTROPY_EXT,Math.min(yn.anisotropy,_e.getMaxAnisotropy())),$.get(yn).__currentAnisotropy=yn.anisotropy)}}function ur(Dn,yn){let tr=!1;Dn.__webglInit===void 0&&(Dn.__webglInit=!0,yn.addEventListener("dispose",Kn));const Hn=yn.source;let In=Ft.get(Hn);In===void 0&&(In={},Ft.set(Hn,In));const Wn=function(pr){const Jt=[];return Jt.push(pr.wrapS),Jt.push(pr.wrapT),Jt.push(pr.magFilter),Jt.push(pr.minFilter),Jt.push(pr.anisotropy),Jt.push(pr.internalFormat),Jt.push(pr.format),Jt.push(pr.type),Jt.push(pr.generateMipmaps),Jt.push(pr.premultiplyAlpha),Jt.push(pr.flipY),Jt.push(pr.unpackAlignment),Jt.push(pr.encoding),Jt.join()}(yn);if(Wn!==Dn.__cacheKey){In[Wn]===void 0&&(In[Wn]={texture:dt.createTexture(),usedTimes:0},at.memory.textures++,tr=!0),In[Wn].usedTimes++;const pr=In[Dn.__cacheKey];pr!==void 0&&(In[Dn.__cacheKey].usedTimes--,pr.usedTimes===0&&_r(yn)),Dn.__cacheKey=Wn,Dn.__webglTexture=In[Wn].texture}return tr}function Fr(Dn,yn,tr){let Hn=3553;yn.isDataArrayTexture&&(Hn=35866),yn.isData3DTexture&&(Hn=32879);const In=ur(Dn,yn),Wn=yn.source;if(g.activeTexture(33984+tr),g.bindTexture(Hn,Dn.__webglTexture),Wn.version!==Wn.__currentVersion||In===!0){dt.pixelStorei(37440,yn.flipY),dt.pixelStorei(37441,yn.premultiplyAlpha),dt.pixelStorei(3317,yn.unpackAlignment),dt.pixelStorei(37443,0);const pr=function(Ms){return!ct&&(Ms.wrapS!==Lo||Ms.wrapT!==Lo||Ms.minFilter!==na&&Ms.minFilter!==xa)}(yn)&&tn(yn.image)===!1;let Jt=Xt(yn.image,pr,!1,bt);Jt=Hs(yn,Jt);const or=tn(Jt)||ct,Zn=rt.convert(yn.format,yn.encoding);let vr,Pr=rt.convert(yn.type),Jr=kn(yn.internalFormat,Zn,Pr,yn.encoding,yn.isVideoTexture);cr(Hn,yn,or);const gs=yn.mipmaps,Ds=ct&&yn.isVideoTexture!==!0,Ns=Wn.__currentVersion===void 0||In===!0,xs=Ln(yn,Jt,or);if(yn.isDepthTexture)Jr=6402,ct?Jr=yn.type===Wl?36012:yn.type===Fn?33190:yn.type===to?35056:33189:yn.type===Wl&&console.error("WebGLRenderer: Floating point depth texture requires WebGL2."),yn.format===yp&&Jr===6402&&yn.type!==J0&&yn.type!==Fn&&(console.warn("THREE.WebGLRenderer: Use UnsignedShortType or UnsignedIntType for DepthFormat DepthTexture."),yn.type=Fn,Pr=rt.convert(yn.type)),yn.format===Av&&Jr===6402&&(Jr=34041,yn.type!==to&&(console.warn("THREE.WebGLRenderer: Use UnsignedInt248Type for DepthStencilFormat DepthTexture."),yn.type=to,Pr=rt.convert(yn.type))),Ns&&(Ds?g.texStorage2D(3553,1,Jr,Jt.width,Jt.height):g.texImage2D(3553,0,Jr,Jt.width,Jt.height,0,Zn,Pr,null));else if(yn.isDataTexture)if(gs.length>0&&or){Ds&&Ns&&g.texStorage2D(3553,xs,Jr,gs[0].width,gs[0].height);for(let Ms=0,xo=gs.length;Ms<xo;Ms++)vr=gs[Ms],Ds?g.texSubImage2D(3553,Ms,0,0,vr.width,vr.height,Zn,Pr,vr.data):g.texImage2D(3553,Ms,Jr,vr.width,vr.height,0,Zn,Pr,vr.data);yn.generateMipmaps=!1}else Ds?(Ns&&g.texStorage2D(3553,xs,Jr,Jt.width,Jt.height),g.texSubImage2D(3553,0,0,0,Jt.width,Jt.height,Zn,Pr,Jt.data)):g.texImage2D(3553,0,Jr,Jt.width,Jt.height,0,Zn,Pr,Jt.data);else if(yn.isCompressedTexture){Ds&&Ns&&g.texStorage2D(3553,xs,Jr,gs[0].width,gs[0].height);for(let Ms=0,xo=gs.length;Ms<xo;Ms++)vr=gs[Ms],yn.format!==Hu?Zn!==null?Ds?g.compressedTexSubImage2D(3553,Ms,0,0,vr.width,vr.height,Zn,vr.data):g.compressedTexImage2D(3553,Ms,Jr,vr.width,vr.height,0,vr.data):console.warn("THREE.WebGLRenderer: Attempt to load unsupported compressed texture format in .uploadTexture()"):Ds?g.texSubImage2D(3553,Ms,0,0,vr.width,vr.height,Zn,Pr,vr.data):g.texImage2D(3553,Ms,Jr,vr.width,vr.height,0,Zn,Pr,vr.data)}else if(yn.isDataArrayTexture)Ds?(Ns&&g.texStorage3D(35866,xs,Jr,Jt.width,Jt.height,Jt.depth),g.texSubImage3D(35866,0,0,0,0,Jt.width,Jt.height,Jt.depth,Zn,Pr,Jt.data)):g.texImage3D(35866,0,Jr,Jt.width,Jt.height,Jt.depth,0,Zn,Pr,Jt.data);else if(yn.isData3DTexture)Ds?(Ns&&g.texStorage3D(32879,xs,Jr,Jt.width,Jt.height,Jt.depth),g.texSubImage3D(32879,0,0,0,0,Jt.width,Jt.height,Jt.depth,Zn,Pr,Jt.data)):g.texImage3D(32879,0,Jr,Jt.width,Jt.height,Jt.depth,0,Zn,Pr,Jt.data);else if(yn.isFramebufferTexture){if(Ns)if(Ds)g.texStorage2D(3553,xs,Jr,Jt.width,Jt.height);else{let Ms=Jt.width,xo=Jt.height;for(let Jp=0;Jp<xs;Jp++)g.texImage2D(3553,Jp,Jr,Ms,xo,0,Zn,Pr,null),Ms>>=1,xo>>=1}}else if(gs.length>0&&or){Ds&&Ns&&g.texStorage2D(3553,xs,Jr,gs[0].width,gs[0].height);for(let Ms=0,xo=gs.length;Ms<xo;Ms++)vr=gs[Ms],Ds?g.texSubImage2D(3553,Ms,0,0,Zn,Pr,vr):g.texImage2D(3553,Ms,Jr,Zn,Pr,vr);yn.generateMipmaps=!1}else Ds?(Ns&&g.texStorage2D(3553,xs,Jr,Jt.width,Jt.height),g.texSubImage2D(3553,0,0,0,Zn,Pr,Jt)):g.texImage2D(3553,0,Jr,Zn,Pr,Jt);sn(yn,or)&&ln(Hn),Wn.__currentVersion=Wn.version,yn.onUpdate&&yn.onUpdate(yn)}Dn.__version=yn.version}function Ar(Dn,yn,tr,Hn,In){const Wn=rt.convert(tr.format,tr.encoding),pr=rt.convert(tr.type),Jt=kn(tr.internalFormat,Wn,pr,tr.encoding);$.get(yn).__hasExternalTextures||(In===32879||In===35866?g.texImage3D(In,0,Jt,yn.width,yn.height,yn.depth,0,Wn,pr,null):g.texImage2D(In,0,Jt,yn.width,yn.height,0,Wn,pr,null)),g.bindFramebuffer(36160,Dn),ys(yn)?St.framebufferTexture2DMultisampleEXT(36160,Hn,In,$.get(tr).__webglTexture,0,Qs(yn)):dt.framebufferTexture2D(36160,Hn,In,$.get(tr).__webglTexture,0),g.bindFramebuffer(36160,null)}function Qr(Dn,yn,tr){if(dt.bindRenderbuffer(36161,Dn),yn.depthBuffer&&!yn.stencilBuffer){let Hn=33189;if(tr||ys(yn)){const In=yn.depthTexture;In&&In.isDepthTexture&&(In.type===Wl?Hn=36012:In.type===Fn&&(Hn=33190));const Wn=Qs(yn);ys(yn)?St.renderbufferStorageMultisampleEXT(36161,Wn,Hn,yn.width,yn.height):dt.renderbufferStorageMultisample(36161,Wn,Hn,yn.width,yn.height)}else dt.renderbufferStorage(36161,Hn,yn.width,yn.height);dt.framebufferRenderbuffer(36160,36096,36161,Dn)}else if(yn.depthBuffer&&yn.stencilBuffer){const Hn=Qs(yn);tr&&ys(yn)===!1?dt.renderbufferStorageMultisample(36161,Hn,35056,yn.width,yn.height):ys(yn)?St.renderbufferStorageMultisampleEXT(36161,Hn,35056,yn.width,yn.height):dt.renderbufferStorage(36161,34041,yn.width,yn.height),dt.framebufferRenderbuffer(36160,33306,36161,Dn)}else{const Hn=yn.isWebGLMultipleRenderTargets===!0?yn.texture:[yn.texture];for(let In=0;In<Hn.length;In++){const Wn=Hn[In],pr=rt.convert(Wn.format,Wn.encoding),Jt=rt.convert(Wn.type),or=kn(Wn.internalFormat,pr,Jt,Wn.encoding),Zn=Qs(yn);tr&&ys(yn)===!1?dt.renderbufferStorageMultisample(36161,Zn,or,yn.width,yn.height):ys(yn)?St.renderbufferStorageMultisampleEXT(36161,Zn,or,yn.width,yn.height):dt.renderbufferStorage(36161,or,yn.width,yn.height)}}dt.bindRenderbuffer(36161,null)}function as(Dn){const yn=$.get(Dn),tr=Dn.isWebGLCubeRenderTarget===!0;if(Dn.depthTexture&&!yn.__autoAllocateDepthBuffer){if(tr)throw new Error("target.depthTexture not supported in Cube render targets");(function(Hn,In){if(In&&In.isWebGLCubeRenderTarget)throw new Error("Depth Texture with cube render targets is not supported");if(g.bindFramebuffer(36160,Hn),!In.depthTexture||!In.depthTexture.isDepthTexture)throw new Error("renderTarget.depthTexture must be an instance of THREE.DepthTexture");$.get(In.depthTexture).__webglTexture&&In.depthTexture.image.width===In.width&&In.depthTexture.image.height===In.height||(In.depthTexture.image.width=In.width,In.depthTexture.image.height=In.height,In.depthTexture.needsUpdate=!0),gr(In.depthTexture,0);const Wn=$.get(In.depthTexture).__webglTexture,pr=Qs(In);if(In.depthTexture.format===yp)ys(In)?St.framebufferTexture2DMultisampleEXT(36160,36096,3553,Wn,0,pr):dt.framebufferTexture2D(36160,36096,3553,Wn,0);else{if(In.depthTexture.format!==Av)throw new Error("Unknown depthTexture format");ys(In)?St.framebufferTexture2DMultisampleEXT(36160,33306,3553,Wn,0,pr):dt.framebufferTexture2D(36160,33306,3553,Wn,0)}})(yn.__webglFramebuffer,Dn)}else if(tr){yn.__webglDepthbuffer=[];for(let Hn=0;Hn<6;Hn++)g.bindFramebuffer(36160,yn.__webglFramebuffer[Hn]),yn.__webglDepthbuffer[Hn]=dt.createRenderbuffer(),Qr(yn.__webglDepthbuffer[Hn],Dn,!1)}else g.bindFramebuffer(36160,yn.__webglFramebuffer),yn.__webglDepthbuffer=dt.createRenderbuffer(),Qr(yn.__webglDepthbuffer,Dn,!1);g.bindFramebuffer(36160,null)}function Qs(Dn){return Math.min(Tt,Dn.samples)}function ys(Dn){const yn=$.get(Dn);return ct&&Dn.samples>0&&o.has("WEBGL_multisampled_render_to_texture")===!0&&yn.__useRenderToTexture!==!1}function Hs(Dn,yn){const tr=Dn.encoding,Hn=Dn.format,In=Dn.type;return Dn.isCompressedTexture===!0||Dn.isVideoTexture===!0||Dn.format===c_||tr!==qu&&(tr===No?ct===!1?o.has("EXT_sRGB")===!0&&Hn===Hu?(Dn.format=c_,Dn.minFilter=xa,Dn.generateMipmaps=!1):yn=m0.sRGBToLinear(yn):Hn===Hu&&In===am||console.warn("THREE.WebGLTextures: sRGB encoded textures have to use RGBAFormat and UnsignedByteType."):tr===RGBM16Encoding||console.error("THREE.WebGLTextures: Unsupported texture encoding:",tr)),yn}this.allocateTextureUnit=function(){const Dn=Tr;return Dn>=ft&&console.warn("THREE.WebGLTextures: Trying to use "+Dn+" texture units while this GPU supports only "+ft),Tr+=1,Dn},this.resetTextureUnits=function(){Tr=0},this.setTexture2D=gr,this.setTexture2DArray=function(Dn,yn){const tr=$.get(Dn);Dn.version>0&&tr.__version!==Dn.version?Fr(tr,Dn,yn):(g.activeTexture(33984+yn),g.bindTexture(35866,tr.__webglTexture))},this.setTexture3D=function(Dn,yn){const tr=$.get(Dn);Dn.version>0&&tr.__version!==Dn.version?Fr(tr,Dn,yn):(g.activeTexture(33984+yn),g.bindTexture(32879,tr.__webglTexture))},this.setTextureCube=function(Dn,yn){const tr=$.get(Dn);Dn.version>0&&tr.__version!==Dn.version?function(Hn,In,Wn){if(In.image.length!==6)return;const pr=ur(Hn,In),Jt=In.source;if(g.activeTexture(33984+Wn),g.bindTexture(34067,Hn.__webglTexture),Jt.version!==Jt.__currentVersion||pr===!0){dt.pixelStorei(37440,In.flipY),dt.pixelStorei(37441,In.premultiplyAlpha),dt.pixelStorei(3317,In.unpackAlignment),dt.pixelStorei(37443,0);const or=In.isCompressedTexture||In.image[0].isCompressedTexture,Zn=In.image[0]&&In.image[0].isDataTexture,vr=[];for(let Is=0;Is<6;Is++)vr[Is]=or||Zn?Zn?In.image[Is].image:In.image[Is]:Xt(In.image[Is],!1,!0,mt),vr[Is]=Hs(In,vr[Is]);const Pr=vr[0],Jr=tn(Pr)||ct,gs=rt.convert(In.format,In.encoding),Ds=rt.convert(In.type),Ns=kn(In.internalFormat,gs,Ds,In.encoding),xs=ct&&In.isVideoTexture!==!0,Ms=Jt.__currentVersion===void 0||pr===!0;let xo,Jp=Ln(In,Pr,Jr);if(cr(34067,In,Jr),or){xs&&Ms&&g.texStorage2D(34067,Jp,Ns,Pr.width,Pr.height);for(let Is=0;Is<6;Is++){xo=vr[Is].mipmaps;for(let bo=0;bo<xo.length;bo++){const Mo=xo[bo];In.format!==Hu?gs!==null?xs?g.compressedTexSubImage2D(34069+Is,bo,0,0,Mo.width,Mo.height,gs,Mo.data):g.compressedTexImage2D(34069+Is,bo,Ns,Mo.width,Mo.height,0,Mo.data):console.warn("THREE.WebGLRenderer: Attempt to load unsupported compressed texture format in .setTextureCube()"):xs?g.texSubImage2D(34069+Is,bo,0,0,Mo.width,Mo.height,gs,Ds,Mo.data):g.texImage2D(34069+Is,bo,Ns,Mo.width,Mo.height,0,gs,Ds,Mo.data)}}}else{xo=In.mipmaps,xs&&Ms&&(xo.length>0&&Jp++,g.texStorage2D(34067,Jp,Ns,vr[0].width,vr[0].height));for(let Is=0;Is<6;Is++)if(Zn){xs?g.texSubImage2D(34069+Is,0,0,0,vr[Is].width,vr[Is].height,gs,Ds,vr[Is].data):g.texImage2D(34069+Is,0,Ns,vr[Is].width,vr[Is].height,0,gs,Ds,vr[Is].data);for(let bo=0;bo<xo.length;bo++){const Mo=xo[bo].image[Is].image;xs?g.texSubImage2D(34069+Is,bo+1,0,0,Mo.width,Mo.height,gs,Ds,Mo.data):g.texImage2D(34069+Is,bo+1,Ns,Mo.width,Mo.height,0,gs,Ds,Mo.data)}}else{xs?g.texSubImage2D(34069+Is,0,0,0,gs,Ds,vr[Is]):g.texImage2D(34069+Is,0,Ns,gs,Ds,vr[Is]);for(let bo=0;bo<xo.length;bo++){const Mo=xo[bo];xs?g.texSubImage2D(34069+Is,bo+1,0,0,gs,Ds,Mo.image[Is]):g.texImage2D(34069+Is,bo+1,Ns,gs,Ds,Mo.image[Is])}}}sn(In,Jr)&&ln(34067),Jt.__currentVersion=Jt.version,In.onUpdate&&In.onUpdate(In)}Hn.__version=In.version}(tr,Dn,yn):(g.activeTexture(33984+yn),g.bindTexture(34067,tr.__webglTexture))},this.rebindTextures=function(Dn,yn,tr){const Hn=$.get(Dn);yn!==void 0&&Ar(Hn.__webglFramebuffer,Dn,Dn.texture,36064,3553),tr!==void 0&&as(Dn)},this.setupRenderTarget=function(Dn){const yn=Dn.texture,tr=$.get(Dn),Hn=$.get(yn);Dn.addEventListener("dispose",On),Dn.isWebGLMultipleRenderTargets!==!0&&(Hn.__webglTexture===void 0&&(Hn.__webglTexture=dt.createTexture()),Hn.__version=yn.version,at.memory.textures++);const In=Dn.isWebGLCubeRenderTarget===!0,Wn=Dn.isWebGLMultipleRenderTargets===!0,pr=tn(Dn)||ct;if(In){tr.__webglFramebuffer=[];for(let Jt=0;Jt<6;Jt++)tr.__webglFramebuffer[Jt]=dt.createFramebuffer()}else{if(tr.__webglFramebuffer=dt.createFramebuffer(),Wn)if(_e.drawBuffers){const Jt=Dn.texture;for(let or=0,Zn=Jt.length;or<Zn;or++){const vr=$.get(Jt[or]);vr.__webglTexture===void 0&&(vr.__webglTexture=dt.createTexture(),at.memory.textures++)}}else console.warn("THREE.WebGLRenderer: WebGLMultipleRenderTargets can only be used with WebGL2 or WEBGL_draw_buffers extension.");if(ct&&Dn.samples>0&&ys(Dn)===!1){const Jt=Wn?yn:[yn];tr.__webglMultisampledFramebuffer=dt.createFramebuffer(),tr.__webglColorRenderbuffer=[],g.bindFramebuffer(36160,tr.__webglMultisampledFramebuffer);for(let or=0;or<Jt.length;or++){const Zn=Jt[or];tr.__webglColorRenderbuffer[or]=dt.createRenderbuffer(),dt.bindRenderbuffer(36161,tr.__webglColorRenderbuffer[or]);const vr=rt.convert(Zn.format,Zn.encoding),Pr=rt.convert(Zn.type),Jr=kn(Zn.internalFormat,vr,Pr,Zn.encoding),gs=Qs(Dn);dt.renderbufferStorageMultisample(36161,gs,Jr,Dn.width,Dn.height),dt.framebufferRenderbuffer(36160,36064+or,36161,tr.__webglColorRenderbuffer[or])}dt.bindRenderbuffer(36161,null),Dn.depthBuffer&&(tr.__webglDepthRenderbuffer=dt.createRenderbuffer(),Qr(tr.__webglDepthRenderbuffer,Dn,!0)),g.bindFramebuffer(36160,null)}}if(In){g.bindTexture(34067,Hn.__webglTexture),cr(34067,yn,pr);for(let Jt=0;Jt<6;Jt++)Ar(tr.__webglFramebuffer[Jt],Dn,yn,36064,34069+Jt);sn(yn,pr)&&ln(34067),g.unbindTexture()}else if(Wn){const Jt=Dn.texture;for(let or=0,Zn=Jt.length;or<Zn;or++){const vr=Jt[or],Pr=$.get(vr);g.bindTexture(3553,Pr.__webglTexture),cr(3553,vr,pr),Ar(tr.__webglFramebuffer,Dn,vr,36064+or,3553),sn(vr,pr)&&ln(3553)}g.unbindTexture()}else{let Jt=3553;(Dn.isWebGL3DRenderTarget||Dn.isWebGLArrayRenderTarget)&&(ct?Jt=Dn.isWebGL3DRenderTarget?32879:35866:console.error("THREE.WebGLTextures: THREE.Data3DTexture and THREE.DataArrayTexture only supported with WebGL2.")),g.bindTexture(Jt,Hn.__webglTexture),cr(Jt,yn,pr),Ar(tr.__webglFramebuffer,Dn,yn,36064,Jt),sn(yn,pr)&&ln(Jt),g.unbindTexture()}Dn.depthBuffer&&as(Dn)},this.updateRenderTargetMipmap=function(Dn){const yn=tn(Dn)||ct,tr=Dn.isWebGLMultipleRenderTargets===!0?Dn.texture:[Dn.texture],Hn=Dn.isWebGLCubeRenderTarget?34067:3553;for(let In=0,Wn=tr.length;In<Wn;In++){const pr=tr[In],Jt=$.get(pr),or=Jt.__webglTexture;Jt.__version!==pr.version&&(g.bindTexture(Hn,or),cr(Hn,pr,yn),g.unbindTexture(),Jt.__version=pr.version),sn(pr,yn)&&(g.bindTexture(Hn,or),ln(Hn),g.unbindTexture())}},this.updateMultisampleRenderTarget=function(Dn){if(ct&&Dn.samples>0&&ys(Dn)===!1){const yn=Dn.isWebGLMultipleRenderTargets?Dn.texture:[Dn.texture],tr=Dn.width,Hn=Dn.height;let In=16384;const Wn=[],pr=Dn.stencilBuffer?33306:36096,Jt=$.get(Dn),or=Dn.isWebGLMultipleRenderTargets===!0;if(or)for(let Zn=0;Zn<yn.length;Zn++)g.bindFramebuffer(36160,Jt.__webglMultisampledFramebuffer),dt.framebufferRenderbuffer(36160,36064+Zn,36161,null),g.bindFramebuffer(36160,Jt.__webglFramebuffer),dt.framebufferTexture2D(36009,36064+Zn,3553,null,0);g.bindFramebuffer(36008,Jt.__webglMultisampledFramebuffer),g.bindFramebuffer(36009,Jt.__webglFramebuffer);for(let Zn=0;Zn<yn.length;Zn++){Wn.push(36064+Zn),Dn.depthBuffer&&Wn.push(pr);const vr=Jt.__ignoreDepthValues!==void 0&&Jt.__ignoreDepthValues;if(vr===!1&&(Dn.depthBuffer&&(In|=256),Dn.stencilBuffer&&(In|=1024)),or&&dt.framebufferRenderbuffer(36008,36064,36161,Jt.__webglColorRenderbuffer[Zn]),vr===!0&&(dt.invalidateFramebuffer(36008,[pr]),dt.invalidateFramebuffer(36009,[pr])),or){const Pr=$.get(yn[Zn]).__webglTexture;dt.framebufferTexture2D(36009,36064,3553,Pr,0)}dt.blitFramebuffer(0,0,tr,Hn,0,0,tr,Hn,In,9728),It&&dt.invalidateFramebuffer(36008,Wn)}if(g.bindFramebuffer(36008,null),g.bindFramebuffer(36009,null),or)for(let Zn=0;Zn<yn.length;Zn++){g.bindFramebuffer(36160,Jt.__webglMultisampledFramebuffer),dt.framebufferRenderbuffer(36160,36064+Zn,36161,Jt.__webglColorRenderbuffer[Zn]);const vr=$.get(yn[Zn]).__webglTexture;g.bindFramebuffer(36160,Jt.__webglFramebuffer),dt.framebufferTexture2D(36009,36064+Zn,3553,vr,0)}g.bindFramebuffer(36009,Jt.__webglMultisampledFramebuffer)}},this.setupDepthRenderbuffer=as,this.setupFrameBufferTexture=Ar,this.useMultisampledRTT=ys}function rC(dt,o,g){const $=g.isWebGL2;return{convert:function(_e,rt=null){let at;if(_e===am)return 5121;if(_e===Om)return 32819;if(_e===ao)return 32820;if(_e===Gu)return 5120;if(_e===Ay)return 5122;if(_e===J0)return 5123;if(_e===Z0)return 5124;if(_e===Fn)return 5125;if(_e===Wl)return 5126;if(_e===lm)return $?5131:(at=o.get("OES_texture_half_float"),at!==null?at.HALF_FLOAT_OES:null);if(_e===kw)return 6406;if(_e===Hu)return 6408;if(_e===Ap)return 6409;if(_e===yy)return 6410;if(_e===yp)return 6402;if(_e===Av)return 34041;if(_e===iA)return 6403;if(_e===Ow)return console.warn("THREE.WebGLRenderer: THREE.RGBFormat has been removed. Use THREE.RGBAFormat instead. https://github.com/mrdoob/three.js/pull/23228"),6408;if(_e===c_)return at=o.get("EXT_sRGB"),at!==null?at.SRGB_ALPHA_EXT:null;if(_e===np)return 36244;if(_e===wy)return 33319;if(_e===w1)return 33320;if(_e===yv)return 36249;if(_e===ip||_e===wv||_e===wo||_e===wp)if(rt===No){if(at=o.get("WEBGL_compressed_texture_s3tc_srgb"),at===null)return null;if(_e===ip)return at.COMPRESSED_SRGB_S3TC_DXT1_EXT;if(_e===wv)return at.COMPRESSED_SRGB_ALPHA_S3TC_DXT1_EXT;if(_e===wo)return at.COMPRESSED_SRGB_ALPHA_S3TC_DXT3_EXT;if(_e===wp)return at.COMPRESSED_SRGB_ALPHA_S3TC_DXT5_EXT}else{if(at=o.get("WEBGL_compressed_texture_s3tc"),at===null)return null;if(_e===ip)return at.COMPRESSED_RGB_S3TC_DXT1_EXT;if(_e===wv)return at.COMPRESSED_RGBA_S3TC_DXT1_EXT;if(_e===wo)return at.COMPRESSED_RGBA_S3TC_DXT3_EXT;if(_e===wp)return at.COMPRESSED_RGBA_S3TC_DXT5_EXT}if(_e===gu||_e===$0||_e===eu||_e===ts){if(at=o.get("WEBGL_compressed_texture_pvrtc"),at===null)return null;if(_e===gu)return at.COMPRESSED_RGB_PVRTC_4BPPV1_IMG;if(_e===$0)return at.COMPRESSED_RGB_PVRTC_2BPPV1_IMG;if(_e===eu)return at.COMPRESSED_RGBA_PVRTC_4BPPV1_IMG;if(_e===ts)return at.COMPRESSED_RGBA_PVRTC_2BPPV1_IMG}if(_e===r0)return at=o.get("WEBGL_compressed_texture_etc1"),at!==null?at.COMPRESSED_RGB_ETC1_WEBGL:null;if(_e===ss||_e===Up){if(at=o.get("WEBGL_compressed_texture_etc"),at===null)return null;if(_e===ss)return rt===No?at.COMPRESSED_SRGB8_ETC2:at.COMPRESSED_RGB8_ETC2;if(_e===Up)return rt===No?at.COMPRESSED_SRGB8_ALPHA8_ETC2_EAC:at.COMPRESSED_RGBA8_ETC2_EAC}if(_e===xv||_e===uo||_e===qs||_e===cm||_e===s0||_e===bv||_e===o0||_e===Ys||_e===e_||_e===t_||_e===Lm||_e===Ev||_e===n_||_e===So){if(at=o.get("WEBGL_compressed_texture_astc"),at===null)return null;if(_e===xv)return rt===No?at.COMPRESSED_SRGB8_ALPHA8_ASTC_4x4_KHR:at.COMPRESSED_RGBA_ASTC_4x4_KHR;if(_e===uo)return rt===No?at.COMPRESSED_SRGB8_ALPHA8_ASTC_5x4_KHR:at.COMPRESSED_RGBA_ASTC_5x4_KHR;if(_e===qs)return rt===No?at.COMPRESSED_SRGB8_ALPHA8_ASTC_5x5_KHR:at.COMPRESSED_RGBA_ASTC_5x5_KHR;if(_e===cm)return rt===No?at.COMPRESSED_SRGB8_ALPHA8_ASTC_6x5_KHR:at.COMPRESSED_RGBA_ASTC_6x5_KHR;if(_e===s0)return rt===No?at.COMPRESSED_SRGB8_ALPHA8_ASTC_6x6_KHR:at.COMPRESSED_RGBA_ASTC_6x6_KHR;if(_e===bv)return rt===No?at.COMPRESSED_SRGB8_ALPHA8_ASTC_8x5_KHR:at.COMPRESSED_RGBA_ASTC_8x5_KHR;if(_e===o0)return rt===No?at.COMPRESSED_SRGB8_ALPHA8_ASTC_8x6_KHR:at.COMPRESSED_RGBA_ASTC_8x6_KHR;if(_e===Ys)return rt===No?at.COMPRESSED_SRGB8_ALPHA8_ASTC_8x8_KHR:at.COMPRESSED_RGBA_ASTC_8x8_KHR;if(_e===e_)return rt===No?at.COMPRESSED_SRGB8_ALPHA8_ASTC_10x5_KHR:at.COMPRESSED_RGBA_ASTC_10x5_KHR;if(_e===t_)return rt===No?at.COMPRESSED_SRGB8_ALPHA8_ASTC_10x6_KHR:at.COMPRESSED_RGBA_ASTC_10x6_KHR;if(_e===Lm)return rt===No?at.COMPRESSED_SRGB8_ALPHA8_ASTC_10x8_KHR:at.COMPRESSED_RGBA_ASTC_10x8_KHR;if(_e===Ev)return rt===No?at.COMPRESSED_SRGB8_ALPHA8_ASTC_10x10_KHR:at.COMPRESSED_RGBA_ASTC_10x10_KHR;if(_e===n_)return rt===No?at.COMPRESSED_SRGB8_ALPHA8_ASTC_12x10_KHR:at.COMPRESSED_RGBA_ASTC_12x10_KHR;if(_e===So)return rt===No?at.COMPRESSED_SRGB8_ALPHA8_ASTC_12x12_KHR:at.COMPRESSED_RGBA_ASTC_12x12_KHR}if(_e===go){if(at=o.get("EXT_texture_compression_bptc"),at===null)return null;if(_e===go)return rt===No?at.COMPRESSED_SRGB_ALPHA_BPTC_UNORM_EXT:at.COMPRESSED_RGBA_BPTC_UNORM_EXT}return _e===to?$?34042:(at=o.get("WEBGL_depth_texture"),at!==null?at.UNSIGNED_INT_24_8_WEBGL:null):dt[_e]!==void 0?dt[_e]:null}}}class nE extends wu{constructor(o=[]){super(),this.isArrayCamera=!0,this.cameras=o}}class T0 extends no{constructor(){super(),this.isGroup=!0,this.type="Group"}}const hT={type:"move"};class ax{constructor(){this._targetRay=null,this._grip=null,this._hand=null}getHandSpace(){return this._hand===null&&(this._hand=new T0,this._hand.matrixAutoUpdate=!1,this._hand.visible=!1,this._hand.joints={},this._hand.inputState={pinching:!1}),this._hand}getTargetRaySpace(){return this._targetRay===null&&(this._targetRay=new T0,this._targetRay.matrixAutoUpdate=!1,this._targetRay.visible=!1,this._targetRay.hasLinearVelocity=!1,this._targetRay.linearVelocity=new fn,this._targetRay.hasAngularVelocity=!1,this._targetRay.angularVelocity=new fn),this._targetRay}getGripSpace(){return this._grip===null&&(this._grip=new T0,this._grip.matrixAutoUpdate=!1,this._grip.visible=!1,this._grip.hasLinearVelocity=!1,this._grip.linearVelocity=new fn,this._grip.hasAngularVelocity=!1,this._grip.angularVelocity=new fn),this._grip}dispatchEvent(o){return this._targetRay!==null&&this._targetRay.dispatchEvent(o),this._grip!==null&&this._grip.dispatchEvent(o),this._hand!==null&&this._hand.dispatchEvent(o),this}disconnect(o){return this.dispatchEvent({type:"disconnected",data:o}),this._targetRay!==null&&(this._targetRay.visible=!1),this._grip!==null&&(this._grip.visible=!1),this._hand!==null&&(this._hand.visible=!1),this}update(o,g,$){let _e=null,rt=null,at=null;const ct=this._targetRay,ft=this._grip,mt=this._hand;if(o&&g.session.visibilityState!=="visible-blurred"){if(mt&&o.hand){at=!0;for(const Dt of o.hand.values()){const Ft=g.getJointPose(Dt,$);if(mt.joints[Dt.jointName]===void 0){const zt=new T0;zt.matrixAutoUpdate=!1,zt.visible=!1,mt.joints[Dt.jointName]=zt,mt.add(zt)}const Nt=mt.joints[Dt.jointName];Ft!==null&&(Nt.matrix.fromArray(Ft.transform.matrix),Nt.matrix.decompose(Nt.position,Nt.rotation,Nt.scale),Nt.jointRadius=Ft.radius),Nt.visible=Ft!==null}const bt=mt.joints["index-finger-tip"],Tt=mt.joints["thumb-tip"],St=bt.position.distanceTo(Tt.position),It=.02,Rt=.005;mt.inputState.pinching&&St>It+Rt?(mt.inputState.pinching=!1,this.dispatchEvent({type:"pinchend",handedness:o.handedness,target:this})):!mt.inputState.pinching&&St<=It-Rt&&(mt.inputState.pinching=!0,this.dispatchEvent({type:"pinchstart",handedness:o.handedness,target:this}))}else ft!==null&&o.gripSpace&&(rt=g.getPose(o.gripSpace,$),rt!==null&&(ft.matrix.fromArray(rt.transform.matrix),ft.matrix.decompose(ft.position,ft.rotation,ft.scale),rt.linearVelocity?(ft.hasLinearVelocity=!0,ft.linearVelocity.copy(rt.linearVelocity)):ft.hasLinearVelocity=!1,rt.angularVelocity?(ft.hasAngularVelocity=!0,ft.angularVelocity.copy(rt.angularVelocity)):ft.hasAngularVelocity=!1));ct!==null&&(_e=g.getPose(o.targetRaySpace,$),_e===null&&rt!==null&&(_e=rt),_e!==null&&(ct.matrix.fromArray(_e.transform.matrix),ct.matrix.decompose(ct.position,ct.rotation,ct.scale),_e.linearVelocity?(ct.hasLinearVelocity=!0,ct.linearVelocity.copy(_e.linearVelocity)):ct.hasLinearVelocity=!1,_e.angularVelocity?(ct.hasAngularVelocity=!0,ct.angularVelocity.copy(_e.angularVelocity)):ct.hasAngularVelocity=!1,this.dispatchEvent(hT)))}return ct!==null&&(ct.visible=_e!==null),ft!==null&&(ft.visible=rt!==null),mt!==null&&(mt.visible=at!==null),this}}class iE extends qo{constructor(o,g,$,_e,rt,at,ct,ft,mt,bt){if((bt=bt!==void 0?bt:yp)!==yp&&bt!==Av)throw new Error("DepthTexture format must be either THREE.DepthFormat or THREE.DepthStencilFormat");$===void 0&&bt===yp&&($=Fn),$===void 0&&bt===Av&&($=to),super(null,_e,rt,at,ct,ft,bt,$,mt),this.isDepthTexture=!0,this.image={width:o,height:g},this.magFilter=ct!==void 0?ct:na,this.minFilter=ft!==void 0?ft:na,this.flipY=!1,this.generateMipmaps=!1}}class sC extends op{constructor(o,g){super();const $=this;let _e=null,rt=1,at=null,ct="local-floor",ft=null,mt=null,bt=null,Tt=null,St=null,It=null;const Rt=g.getContextAttributes();let Dt=null,Ft=null;const Nt=[],zt=[],Xt=new wu;Xt.layers.enable(1),Xt.viewport=new _o;const tn=new wu;tn.layers.enable(2),tn.viewport=new _o;const sn=[Xt,tn],ln=new nE;ln.layers.enable(1),ln.layers.enable(2);let kn=null,Ln=null;function qn(cr){const ur=zt.indexOf(cr.inputSource);if(ur===-1)return;const Fr=Nt[ur];Fr!==void 0&&Fr.dispatchEvent({type:cr.type,data:cr.inputSource})}function Kn(){_e.removeEventListener("select",qn),_e.removeEventListener("selectstart",qn),_e.removeEventListener("selectend",qn),_e.removeEventListener("squeeze",qn),_e.removeEventListener("squeezestart",qn),_e.removeEventListener("squeezeend",qn),_e.removeEventListener("end",Kn),_e.removeEventListener("inputsourceschange",On);for(let cr=0;cr<Nt.length;cr++){const ur=zt[cr];ur!==null&&(zt[cr]=null,Nt[cr].disconnect(ur))}kn=null,Ln=null,o.setRenderTarget(Dt),St=null,Tt=null,bt=null,_e=null,Ft=null,Gr.stop(),$.isPresenting=!1,$.dispatchEvent({type:"sessionend"})}function On(cr){for(let ur=0;ur<cr.removed.length;ur++){const Fr=cr.removed[ur],Ar=zt.indexOf(Fr);Ar>=0&&(zt[Ar]=null,Nt[Ar].dispatchEvent({type:"disconnected",data:Fr}))}for(let ur=0;ur<cr.added.length;ur++){const Fr=cr.added[ur];let Ar=zt.indexOf(Fr);if(Ar===-1){for(let as=0;as<Nt.length;as++){if(as>=zt.length){zt.push(Fr),Ar=as;break}if(zt[as]===null){zt[as]=Fr,Ar=as;break}}if(Ar===-1)break}const Qr=Nt[Ar];Qr&&Qr.dispatchEvent({type:"connected",data:Fr})}}this.cameraAutoUpdate=!0,this.enabled=!1,this.isPresenting=!1,this.getController=function(cr){let ur=Nt[cr];return ur===void 0&&(ur=new ax,Nt[cr]=ur),ur.getTargetRaySpace()},this.getControllerGrip=function(cr){let ur=Nt[cr];return ur===void 0&&(ur=new ax,Nt[cr]=ur),ur.getGripSpace()},this.getHand=function(cr){let ur=Nt[cr];return ur===void 0&&(ur=new ax,Nt[cr]=ur),ur.getHandSpace()},this.setFramebufferScaleFactor=function(cr){rt=cr,$.isPresenting===!0&&console.warn("THREE.WebXRManager: Cannot change framebuffer scale while presenting.")},this.setReferenceSpaceType=function(cr){ct=cr,$.isPresenting===!0&&console.warn("THREE.WebXRManager: Cannot change reference space type while presenting.")},this.getReferenceSpace=function(){return ft||at},this.setReferenceSpace=function(cr){ft=cr},this.getBaseLayer=function(){return Tt!==null?Tt:St},this.getBinding=function(){return bt},this.getFrame=function(){return It},this.getSession=function(){return _e},this.setSession=async function(cr){if(_e=cr,_e!==null){if(Dt=o.getRenderTarget(),_e.addEventListener("select",qn),_e.addEventListener("selectstart",qn),_e.addEventListener("selectend",qn),_e.addEventListener("squeeze",qn),_e.addEventListener("squeezestart",qn),_e.addEventListener("squeezeend",qn),_e.addEventListener("end",Kn),_e.addEventListener("inputsourceschange",On),Rt.xrCompatible!==!0&&await g.makeXRCompatible(),_e.renderState.layers===void 0||o.capabilities.isWebGL2===!1){const ur={antialias:_e.renderState.layers!==void 0||Rt.antialias,alpha:Rt.alpha,depth:Rt.depth,stencil:Rt.stencil,framebufferScaleFactor:rt};St=new XRWebGLLayer(_e,g,ur),_e.updateRenderState({baseLayer:St}),Ft=new ap(St.framebufferWidth,St.framebufferHeight,{format:Hu,type:am,encoding:o.outputEncoding,stencilBuffer:Rt.stencil})}else{let ur=null,Fr=null,Ar=null;Rt.depth&&(Ar=Rt.stencil?35056:33190,ur=Rt.stencil?Av:yp,Fr=Rt.stencil?to:Fn);const Qr={colorFormat:32856,depthFormat:Ar,scaleFactor:rt};bt=new XRWebGLBinding(_e,g),Tt=bt.createProjectionLayer(Qr),_e.updateRenderState({layers:[Tt]}),Ft=new ap(Tt.textureWidth,Tt.textureHeight,{format:Hu,type:am,depthTexture:new iE(Tt.textureWidth,Tt.textureHeight,Fr,void 0,void 0,void 0,void 0,void 0,void 0,ur),stencilBuffer:Rt.stencil,encoding:o.outputEncoding,samples:Rt.antialias?4:0}),o.properties.get(Ft).__ignoreDepthValues=Tt.ignoreDepthValues}Ft.isXRRenderTarget=!0,this.setFoveation(1),ft=null,at=await _e.requestReferenceSpace(ct),Gr.setContext(_e),Gr.start(),$.isPresenting=!0,$.dispatchEvent({type:"sessionstart"})}};const _r=new fn,Tr=new fn;function gr(cr,ur){ur===null?cr.matrixWorld.copy(cr.matrix):cr.matrixWorld.multiplyMatrices(ur.matrixWorld,cr.matrix),cr.matrixWorldInverse.copy(cr.matrixWorld).invert()}this.updateCamera=function(cr){if(_e===null)return;ln.near=tn.near=Xt.near=cr.near,ln.far=tn.far=Xt.far=cr.far,kn===ln.near&&Ln===ln.far||(_e.updateRenderState({depthNear:ln.near,depthFar:ln.far}),kn=ln.near,Ln=ln.far);const ur=cr.parent,Fr=ln.cameras;gr(ln,ur);for(let Qr=0;Qr<Fr.length;Qr++)gr(Fr[Qr],ur);ln.matrixWorld.decompose(ln.position,ln.quaternion,ln.scale),cr.matrix.copy(ln.matrix),cr.matrix.decompose(cr.position,cr.quaternion,cr.scale);const Ar=cr.children;for(let Qr=0,as=Ar.length;Qr<as;Qr++)Ar[Qr].updateMatrixWorld(!0);Fr.length===2?function(Qr,as,Qs){_r.setFromMatrixPosition(as.matrixWorld),Tr.setFromMatrixPosition(Qs.matrixWorld);const ys=_r.distanceTo(Tr),Hs=as.projectionMatrix.elements,Dn=Qs.projectionMatrix.elements,yn=Hs[14]/(Hs[10]-1),tr=Hs[14]/(Hs[10]+1),Hn=(Hs[9]+1)/Hs[5],In=(Hs[9]-1)/Hs[5],Wn=(Hs[8]-1)/Hs[0],pr=(Dn[8]+1)/Dn[0],Jt=yn*Wn,or=yn*pr,Zn=ys/(-Wn+pr),vr=Zn*-Wn;as.matrixWorld.decompose(Qr.position,Qr.quaternion,Qr.scale),Qr.translateX(vr),Qr.translateZ(Zn),Qr.matrixWorld.compose(Qr.position,Qr.quaternion,Qr.scale),Qr.matrixWorldInverse.copy(Qr.matrixWorld).invert();const Pr=yn+Zn,Jr=tr+Zn,gs=Jt-vr,Ds=or+(ys-vr),Ns=Hn*tr/Jr*Pr,xs=In*tr/Jr*Pr;Qr.projectionMatrix.makePerspective(gs,Ds,Ns,xs,Pr,Jr)}(ln,Xt,tn):ln.projectionMatrix.copy(Xt.projectionMatrix)},this.getCamera=function(){return ln},this.getFoveation=function(){return Tt!==null?Tt.fixedFoveation:St!==null?St.fixedFoveation:void 0},this.setFoveation=function(cr){Tt!==null&&(Tt.fixedFoveation=cr),St!==null&&St.fixedFoveation!==void 0&&(St.fixedFoveation=cr)};let Or=null;this.onPreAnimationFrameCallback=null;const Gr=new N1;Gr.setAnimationLoop(function(cr,ur){if($.onPreAnimationFrameCallback&&$.onPreAnimationFrameCallback(cr,ur),mt=ur.getViewerPose(ft||at),It=ur,mt!==null){const Fr=mt.views;St!==null&&(o.setRenderTargetFramebuffer(Ft,St.framebuffer),o.setRenderTarget(Ft));let Ar=!1;Fr.length!==ln.cameras.length&&(ln.cameras.length=0,Ar=!0);for(let Qr=0;Qr<Fr.length;Qr++){const as=Fr[Qr];let Qs=null;if(St!==null)Qs=St.getViewport(as);else{const Hs=bt.getViewSubImage(Tt,as);Qs=Hs.viewport,Qr===0&&(o.setRenderTargetTextures(Ft,Hs.colorTexture,Tt.ignoreDepthValues?void 0:Hs.depthStencilTexture),o.setRenderTarget(Ft))}let ys=sn[Qr];ys===void 0&&(ys=new wu,ys.layers.enable(Qr),ys.viewport=new _o,sn[Qr]=ys),ys.matrix.fromArray(as.transform.matrix),ys.projectionMatrix.fromArray(as.projectionMatrix),ys.viewport.set(Qs.x,Qs.y,Qs.width,Qs.height),Qr===0&&ln.matrix.copy(ys.matrix),Ar===!0&&ln.cameras.push(ys)}}for(let Fr=0;Fr<Nt.length;Fr++){const Ar=zt[Fr],Qr=Nt[Fr];Ar!==null&&Qr!==void 0&&Qr.update(Ar,ur,ft||at)}Or&&Or(cr,ur),It=null}),this.setAnimationLoop=function(cr){Or=cr},this.dispose=function(){}}}function dT(dt,o){function g($,_e){$.opacity.value=_e.opacity,_e.color&&$.diffuse.value.copy(_e.color),_e.emissive&&$.emissive.value.copy(_e.emissive).multiplyScalar(_e.emissiveIntensity),_e.map&&($.map.value=_e.map),_e.alphaMap&&($.alphaMap.value=_e.alphaMap),_e.bumpMap&&($.bumpMap.value=_e.bumpMap,$.bumpScale.value=_e.bumpScale,_e.side===$t&&($.bumpScale.value*=-1)),_e.displacementMap&&($.displacementMap.value=_e.displacementMap,$.displacementScale.value=_e.displacementScale,$.displacementBias.value=_e.displacementBias),_e.emissiveMap&&($.emissiveMap.value=_e.emissiveMap),_e.normalMap&&($.normalMap.value=_e.normalMap,$.normalScale.value.copy(_e.normalScale),_e.side===$t&&$.normalScale.value.negate()),_e.specularMap&&($.specularMap.value=_e.specularMap),_e.alphaTest>0&&($.alphaTest.value=_e.alphaTest);const rt=o.get(_e).envMap;if(rt){$.envMap.value=rt;const ft=o.get(_e).environment||rt;$.envMapRotation.value=ft?ft.rotation:0,$.flipEnvMap.value=rt.isCubeTexture&&rt.isRenderTargetTexture===!1?-1:1,$.reflectivity.value=_e.reflectivity,$.ior.value=_e.ior,$.refractionRatio.value=_e.refractionRatio}if(_e.lightMap){$.lightMap.value=_e.lightMap;const ft=dt.physicallyCorrectLights!==!0?Math.PI:1;$.lightMapIntensity.value=_e.lightMapIntensity*ft}let at,ct;_e.aoMap&&($.aoMap.value=_e.aoMap,$.aoMapIntensity.value=_e.aoMapIntensity),_e.map?at=_e.map:_e.specularMap?at=_e.specularMap:_e.displacementMap?at=_e.displacementMap:_e.normalMap?at=_e.normalMap:_e.bumpMap?at=_e.bumpMap:_e.roughnessMap?at=_e.roughnessMap:_e.metalnessMap?at=_e.metalnessMap:_e.alphaMap?at=_e.alphaMap:_e.emissiveMap?at=_e.emissiveMap:_e.clearcoatMap?at=_e.clearcoatMap:_e.clearcoatNormalMap?at=_e.clearcoatNormalMap:_e.clearcoatRoughnessMap?at=_e.clearcoatRoughnessMap:_e.iridescenceMap?at=_e.iridescenceMap:_e.iridescenceThicknessMap?at=_e.iridescenceThicknessMap:_e.specularIntensityMap?at=_e.specularIntensityMap:_e.specularColorMap?at=_e.specularColorMap:_e.transmissionMap?at=_e.transmissionMap:_e.thicknessMap?at=_e.thicknessMap:_e.sheenColorMap?at=_e.sheenColorMap:_e.sheenRoughnessMap&&(at=_e.sheenRoughnessMap),at!==void 0&&(at.isWebGLRenderTarget&&(at=at.texture),at.matrixAutoUpdate===!0&&at.updateMatrix(),$.uvTransform.value.copy(at.matrix)),_e.aoMap?ct=_e.aoMap:_e.lightMap&&(ct=_e.lightMap),ct!==void 0&&(ct.isWebGLRenderTarget&&(ct=ct.texture),ct.matrixAutoUpdate===!0&&ct.updateMatrix(),$.uv2Transform.value.copy(ct.matrix))}return{refreshFogUniforms:function($,_e){$.fogColor.value.copy(_e.color),_e.isFog?($.fogNear.value=_e.near,$.fogFar.value=_e.far):_e.isFogExp2&&($.fogDensity.value=_e.density)},refreshMaterialUniforms:function($,_e,rt,at,ct){_e.isMeshBasicMaterial||_e.isMeshLambertMaterial?g($,_e):_e.isMeshToonMaterial?(g($,_e),function(ft,mt){mt.gradientMap&&(ft.gradientMap.value=mt.gradientMap)}($,_e)):_e.isMeshPhongMaterial?(g($,_e),function(ft,mt){ft.specular.value.copy(mt.specular),ft.shininess.value=Math.max(mt.shininess,1e-4)}($,_e)):_e.isMeshStandardMaterial?(g($,_e),function(ft,mt){ft.roughness.value=mt.roughness,ft.metalness.value=mt.metalness,mt.roughnessMap&&(ft.roughnessMap.value=mt.roughnessMap),mt.metalnessMap&&(ft.metalnessMap.value=mt.metalnessMap),o.get(mt).envMap&&(ft.envMapIntensity.value=mt.envMapIntensity)}($,_e),_e.isMeshPhysicalMaterial&&function(ft,mt,bt){ft.ior.value=mt.ior,mt.sheen>0&&(ft.sheenColor.value.copy(mt.sheenColor).multiplyScalar(mt.sheen),ft.sheenRoughness.value=mt.sheenRoughness,mt.sheenColorMap&&(ft.sheenColorMap.value=mt.sheenColorMap),mt.sheenRoughnessMap&&(ft.sheenRoughnessMap.value=mt.sheenRoughnessMap)),mt.clearcoat>0&&(ft.clearcoat.value=mt.clearcoat,ft.clearcoatRoughness.value=mt.clearcoatRoughness,mt.clearcoatMap&&(ft.clearcoatMap.value=mt.clearcoatMap),mt.clearcoatRoughnessMap&&(ft.clearcoatRoughnessMap.value=mt.clearcoatRoughnessMap),mt.clearcoatNormalMap&&(ft.clearcoatNormalScale.value.copy(mt.clearcoatNormalScale),ft.clearcoatNormalMap.value=mt.clearcoatNormalMap,mt.side===$t&&ft.clearcoatNormalScale.value.negate())),mt.iridescence>0&&(ft.iridescence.value=mt.iridescence,ft.iridescenceIOR.value=mt.iridescenceIOR,ft.iridescenceThicknessMinimum.value=mt.iridescenceThicknessRange[0],ft.iridescenceThicknessMaximum.value=mt.iridescenceThicknessRange[1],mt.iridescenceMap&&(ft.iridescenceMap.value=mt.iridescenceMap),mt.iridescenceThicknessMap&&(ft.iridescenceThicknessMap.value=mt.iridescenceThicknessMap)),mt.transmission>0&&(ft.transmission.value=mt.transmission,ft.transmissionSamplerMap.value=bt.texture,ft.transmissionSamplerSize.value.set(bt.width,bt.height),mt.transmissionMap&&(ft.transmissionMap.value=mt.transmissionMap),ft.thickness.value=mt.thickness,mt.thicknessMap&&(ft.thicknessMap.value=mt.thicknessMap),ft.attenuationDistance.value=mt.attenuationDistance,ft.attenuationColor.value.copy(mt.attenuationColor)),ft.specularIntensity.value=mt.specularIntensity,ft.specularColor.value.copy(mt.specularColor),mt.specularIntensityMap&&(ft.specularIntensityMap.value=mt.specularIntensityMap),mt.specularColorMap&&(ft.specularColorMap.value=mt.specularColorMap)}($,_e,ct)):_e.isMeshMatcapMaterial?(g($,_e),function(ft,mt){mt.matcap&&(ft.matcap.value=mt.matcap)}($,_e)):_e.isMeshDepthMaterial?g($,_e):_e.isMeshDistanceMaterial?(g($,_e),function(ft,mt){ft.referencePosition.value.copy(mt.referencePosition),ft.nearDistance.value=mt.nearDistance,ft.farDistance.value=mt.farDistance}($,_e)):_e.isMeshNormalMaterial?g($,_e):_e.isLineBasicMaterial?(function(ft,mt){ft.diffuse.value.copy(mt.color),ft.opacity.value=mt.opacity}($,_e),_e.isLineDashedMaterial&&function(ft,mt){ft.dashSize.value=mt.dashSize,ft.totalSize.value=mt.dashSize+mt.gapSize,ft.scale.value=mt.scale}($,_e)):_e.isPointsMaterial?function(ft,mt,bt,Tt){let St;ft.diffuse.value.copy(mt.color),ft.opacity.value=mt.opacity,ft.size.value=mt.size*bt,ft.scale.value=.5*Tt,mt.map&&(ft.map.value=mt.map),mt.alphaMap&&(ft.alphaMap.value=mt.alphaMap),mt.alphaTest>0&&(ft.alphaTest.value=mt.alphaTest),mt.map?St=mt.map:mt.alphaMap&&(St=mt.alphaMap),St!==void 0&&(St.matrixAutoUpdate===!0&&St.updateMatrix(),ft.uvTransform.value.copy(St.matrix))}($,_e,rt,at):_e.isSpriteMaterial?function(ft,mt){let bt;ft.diffuse.value.copy(mt.color),ft.opacity.value=mt.opacity,ft.rotation.value=mt.rotation,mt.map&&(ft.map.value=mt.map),mt.alphaMap&&(ft.alphaMap.value=mt.alphaMap),mt.alphaTest>0&&(ft.alphaTest.value=mt.alphaTest),mt.map?bt=mt.map:mt.alphaMap&&(bt=mt.alphaMap),bt!==void 0&&(bt.matrixAutoUpdate===!0&&bt.updateMatrix(),ft.uvTransform.value.copy(bt.matrix))}($,_e):_e.isShadowMaterial?($.color.value.copy(_e.color),$.opacity.value=_e.opacity):_e.isShaderMaterial&&(_e.transmission!==void 0&&($.transmission&&($.transmission.value=_e.transmission),$.transmissionSamplerMap&&ct&&($.transmissionSamplerMap.value=ct?ct.texture:null),$.transmissionSamplerSize&&ct&&$.transmissionSamplerSize.value.set(ct.width,ct.height)),_e.uniformsNeedUpdate=!1)}}}function rE(dt,o,g,$){let _e={},rt={},at=[];const ct=g.isWebGL2?dt.getParameter(35375):0;function ft(Tt,St,It){const Rt=Tt.value;if(It[St]===void 0)return It[St]=typeof Rt=="number"?Rt:Rt.clone(),!0;if(typeof Rt=="number"){if(It[St]!==Rt)return It[St]=Rt,!0}else{const Dt=It[St];if(Dt.equals(Rt)===!1)return Dt.copy(Rt),!0}return!1}function mt(Tt){const St=Tt.value,It={boundary:0,storage:0};return typeof St=="number"?(It.boundary=4,It.storage=4):St.isVector2?(It.boundary=8,It.storage=8):St.isVector3||St.isColor?(It.boundary=16,It.storage=12):St.isVector4?(It.boundary=16,It.storage=16):St.isMatrix3?(It.boundary=48,It.storage=48):St.isMatrix4?(It.boundary=64,It.storage=64):St.isTexture?console.warn("THREE.WebGLRenderer: Texture samplers can not be part of an uniforms group."):console.warn("THREE.WebGLRenderer: Unsupported uniform value type.",St),It}function bt(Tt){const St=Tt.target;St.removeEventListener("dispose",bt);const It=at.indexOf(St.__bindingPointIndex);at.splice(It,1),dt.deleteBuffer(_e[St.id]),delete _e[St.id],delete rt[St.id]}return{bind:function(Tt,St){const It=St.program;$.uniformBlockBinding(Tt,It)},update:function(Tt,St){let It=_e[Tt.id];It===void 0&&(function(Ft){const Nt=Ft.uniforms;let zt=0,Xt=0;for(let tn=0,sn=Nt.length;tn<sn;tn++){const ln=Nt[tn],kn=mt(ln);if(ln.__data=new Float32Array(kn.storage/Float32Array.BYTES_PER_ELEMENT),ln.__offset=zt,tn>0){Xt=zt%16;const Ln=16-Xt;Xt!==0&&Ln-kn.boundary<0&&(zt+=16-Xt,ln.__offset=zt)}zt+=kn.storage}Xt=zt%16,Xt>0&&(zt+=16-Xt),Ft.__size=zt,Ft.__cache={}}(Tt),It=function(Ft){const Nt=function(){for(let sn=0;sn<ct;sn++)if(at.indexOf(sn)===-1)return at.push(sn),sn;return console.error("THREE.WebGLRenderer: Maximum number of simultaneously usable uniforms groups reached."),0}();Ft.__bindingPointIndex=Nt;const zt=dt.createBuffer(),Xt=Ft.__size,tn=Ft.usage;return dt.bindBuffer(35345,zt),dt.bufferData(35345,Xt,tn),dt.bindBuffer(35345,null),dt.bindBufferBase(35345,Nt,zt),zt}(Tt),_e[Tt.id]=It,Tt.addEventListener("dispose",bt));const Rt=St.program;$.updateUBOMapping(Tt,Rt);const Dt=o.render.frame;rt[Tt.id]!==Dt&&(function(Ft){const Nt=_e[Ft.id],zt=Ft.uniforms,Xt=Ft.__cache;dt.bindBuffer(35345,Nt);for(let tn=0,sn=zt.length;tn<sn;tn++){const ln=zt[tn];if(ft(ln,tn,Xt)===!0){const kn=ln.value,Ln=ln.__offset;typeof kn=="number"?(ln.__data[0]=kn,dt.bufferSubData(35345,Ln,ln.__data)):(ln.value.isMatrix3?(ln.__data[0]=ln.value.elements[0],ln.__data[1]=ln.value.elements[1],ln.__data[2]=ln.value.elements[2],ln.__data[3]=ln.value.elements[0],ln.__data[4]=ln.value.elements[3],ln.__data[5]=ln.value.elements[4],ln.__data[6]=ln.value.elements[5],ln.__data[7]=ln.value.elements[0],ln.__data[8]=ln.value.elements[6],ln.__data[9]=ln.value.elements[7],ln.__data[10]=ln.value.elements[8],ln.__data[11]=ln.value.elements[0]):kn.toArray(ln.__data),dt.bufferSubData(35345,Ln,ln.__data))}}dt.bindBuffer(35345,null)}(Tt),rt[Tt.id]=Dt)},dispose:function(){for(const Tt in _e)dt.deleteBuffer(_e[Tt]);at=[],_e={},rt={}}}}function oC(dt={}){this.isWebGLRenderer=!0;const o=dt.canvas!==void 0?dt.canvas:function(){const Sn=p0("canvas");return Sn.style.display="block",Sn}(),g=dt.context!==void 0?dt.context:null,$=dt.depth===void 0||dt.depth,_e=dt.stencil===void 0||dt.stencil,rt=dt.antialias!==void 0&&dt.antialias,at=dt.premultipliedAlpha===void 0||dt.premultipliedAlpha,ct=dt.preserveDrawingBuffer!==void 0&&dt.preserveDrawingBuffer,ft=dt.powerPreference!==void 0?dt.powerPreference:"default",mt=dt.failIfMajorPerformanceCaveat!==void 0&&dt.failIfMajorPerformanceCaveat;let bt;bt=g!==null?g.getContextAttributes().alpha:dt.alpha!==void 0&&dt.alpha;let Tt=null,St=null;const It=[],Rt=[];this.domElement=o,this.debug={checkShaderErrors:!0},this.autoClear=!0,this.autoClearColor=!0,this.autoClearDepth=!0,this.autoClearStencil=!0,this.sortObjects=!0,this.clippingPlanes=[],this.localClippingEnabled=!1,this.outputEncoding=qu,this.physicallyCorrectLights=!1,this.toneMapping=Ks,this.toneMappingExposure=1,this.userData={},Object.defineProperties(this,{gammaFactor:{get:function(){return console.warn("THREE.WebGLRenderer: .gammaFactor has been removed."),2},set:function(){console.warn("THREE.WebGLRenderer: .gammaFactor has been removed.")}}});const Dt=this;let Ft=!1,Nt=0,zt=0,Xt=null,tn=-1,sn=null;const ln=new _o,kn=new _o;let Ln=null,qn=o.width,Kn=o.height,On=1,_r=null,Tr=null;const gr=new _o(0,0,qn,Kn),Or=new _o(0,0,qn,Kn);let Gr=!1;const cr=new Ym;let ur=!1,Fr=!1,Ar=null;const Qr=new Os,as=new Sr,Qs=new fn,ys={background:null,fog:null,environment:null,overrideMaterial:null,isScene:!0};function Hs(){return Xt===null?On:1}let Dn,yn,tr,Hn,In,Wn,pr,Jt,or,Zn,vr,Pr,Jr,gs,Ds,Ns,xs,Ms,xo,Jp,Is,bo,Mo,Wx,es=g;function WC(Sn,fr){for(let br=0;br<Sn.length;br++){const wr=Sn[br],hr=o.getContext(wr,fr);if(hr!==null)return hr}return null}try{const Sn={alpha:!0,depth:$,stencil:_e,antialias:rt,premultipliedAlpha:at,preserveDrawingBuffer:ct,powerPreference:ft,failIfMajorPerformanceCaveat:mt};if("setAttribute"in o&&o.setAttribute("data-engine",`three.js r${b}`),o.addEventListener("webglcontextlost",HE,!1),o.addEventListener("webglcontextrestored",vw,!1),o.addEventListener("webglcontextcreationerror",iI,!1),es===null){const fr=["webgl2","webgl","experimental-webgl"];if(Dt.isWebGL1Renderer===!0&&fr.shift(),es=WC(fr,Sn),es===null)throw WC(fr)?new Error("Error creating WebGL context with your selected attributes."):new Error("Error creating WebGL context.")}es.getShaderPrecisionFormat===void 0&&(es.getShaderPrecisionFormat=function(){return{rangeMin:1,rangeMax:1,precision:1}})}catch(Sn){throw console.error("THREE.WebGLRenderer: "+Sn.message),Sn}function F0(){Dn=new oD(es),yn=new iD(es,Dn,dt),Dn.init(yn),bo=new rC(es,Dn,yn),tr=new uT(es,Dn,yn),Hn=new WS,In=new fD,Wn=new iC(es,Dn,tr,In,yn,bo,Hn),pr=new sD(Dt),Jt=new FM(Dt),or=new NM(es,yn),Mo=new FS(es,Dn,or,yn),Zn=new aD(es,or,Hn,Mo),vr=new Ls(es,Zn,or,Hn),xo=new qr(es,yn,Wn),Ns=new rD(In),Pr=new rx(Dt,pr,Jt,Dn,yn,Mo,Ns),Jr=new dT(Dt,In),gs=new sT,Ds=new nC(Dn,yn),Ms=new ky(Dt,pr,tr,vr,bt,at),xs=new tE(Dt,vr,yn),Wx=new rE(es,Hn,yn,tr),Jp=new Yw(es,Dn,Hn,yn),Is=new io(es,Dn,Hn,yn),Hn.programs=Pr.programs,Dt.capabilities=yn,Dt.extensions=Dn,Dt.properties=In,Dt.renderLists=gs,Dt.shadowMap=xs,Dt.state=tr,Dt.info=Hn,Dt.background=Ms,Dt.cubeuvmaps=Jt}F0();const bu=new sC(Dt,es);function HE(Sn){Sn.preventDefault(),console.log("THREE.WebGLRenderer: Context Lost."),Ft=!0}function vw(){console.log("THREE.WebGLRenderer: Context Restored."),Ft=!1;const Sn=Hn.autoReset,fr=xs.enabled,br=xs.autoUpdate,wr=xs.needsUpdate,hr=xs.type;F0(),Hn.autoReset=Sn,xs.enabled=fr,xs.autoUpdate=br,xs.needsUpdate=wr,xs.type=hr}function iI(Sn){console.error("THREE.WebGLRenderer: A WebGL context could not be created. Reason: ",Sn.statusMessage)}function rI(Sn){const fr=Sn.target;fr.removeEventListener("dispose",rI),function(br){(function(wr){const hr=In.get(wr).programs;hr!==void 0&&(hr.forEach(function(Kr){Pr.releaseProgram(Kr)}),wr.isShaderMaterial&&Pr.releaseShaderCache(wr))})(br),In.remove(br)}(fr)}this.xr=bu,this.getContext=function(){return es},this.getContextAttributes=function(){return es.getContextAttributes()},this.forceContextLoss=function(){const Sn=Dn.get("WEBGL_lose_context");Sn&&Sn.loseContext()},this.forceContextRestore=function(){const Sn=Dn.get("WEBGL_lose_context");Sn&&Sn.restoreContext()},this.getPixelRatio=function(){return On},this.setPixelRatio=function(Sn){Sn!==void 0&&(On=Sn,this.setSize(qn,Kn,!1))},this.getSize=function(Sn){return Sn.set(qn,Kn)},this.setSize=function(Sn,fr,br){bu.isPresenting?console.warn("THREE.WebGLRenderer: Can't change size while VR device is presenting."):(qn=Sn,Kn=fr,o.width=Math.floor(Sn*On),o.height=Math.floor(fr*On),br!==!1&&(o.style.width=Sn+"px",o.style.height=fr+"px"),this.setViewport(0,0,Sn,fr))},this.getDrawingBufferSize=function(Sn){return Sn.set(qn*On,Kn*On).floor()},this.setDrawingBufferSize=function(Sn,fr,br){qn=Sn,Kn=fr,On=br,o.width=Math.floor(Sn*br),o.height=Math.floor(fr*br),this.setViewport(0,0,Sn,fr)},this.getCurrentViewport=function(Sn){return Sn.copy(ln)},this.getViewport=function(Sn){return Sn.copy(gr)},this.setViewport=function(Sn,fr,br,wr){Sn.isVector4?gr.set(Sn.x,Sn.y,Sn.z,Sn.w):gr.set(Sn,fr,br,wr),tr.viewport(ln.copy(gr).multiplyScalar(On).floor())},this.getScissor=function(Sn){return Sn.copy(Or)},this.setScissor=function(Sn,fr,br,wr){Sn.isVector4?Or.set(Sn.x,Sn.y,Sn.z,Sn.w):Or.set(Sn,fr,br,wr),tr.scissor(kn.copy(Or).multiplyScalar(On).floor())},this.getScissorTest=function(){return Gr},this.setScissorTest=function(Sn){tr.setScissorTest(Gr=Sn)},this.setOpaqueSort=function(Sn){_r=Sn},this.setTransparentSort=function(Sn){Tr=Sn},this.getClearColor=function(Sn){return Sn.copy(Ms.getClearColor())},this.setClearColor=function(){Ms.setClearColor.apply(Ms,arguments)},this.getClearAlpha=function(){return Ms.getClearAlpha()},this.setClearAlpha=function(){Ms.setClearAlpha.apply(Ms,arguments)},this.clear=function(Sn=!0,fr=!0,br=!0){let wr=0;Sn&&(wr|=16384),fr&&(wr|=256),br&&(wr|=1024),es.clear(wr)},this.clearColor=function(){this.clear(!0,!1,!1)},this.clearDepth=function(){this.clear(!1,!0,!1)},this.clearStencil=function(){this.clear(!1,!1,!0)},this.dispose=function(){o.removeEventListener("webglcontextlost",HE,!1),o.removeEventListener("webglcontextrestored",vw,!1),o.removeEventListener("webglcontextcreationerror",iI,!1),gs.dispose(),Ds.dispose(),In.dispose(),pr.dispose(),Jt.dispose(),vr.dispose(),Mo.dispose(),Wx.dispose(),Pr.dispose(),bu.dispose(),bu.removeEventListener("sessionstart",sI),bu.removeEventListener("sessionend",oI),Ar&&(Ar.dispose(),Ar=null),P_.stop()},this.renderBufferDirect=function(Sn,fr,br,wr,hr,Kr){fr===null&&(fr=ys);const Ps=hr.isMesh&&hr.matrixWorld.determinant()<0,Ts=function(Su,Aw,$p,Rs,lu){Aw.isScene!==!0&&(Aw=ys),Wn.resetTextureUnits();const qx=Aw.fog,XC=Rs.isMeshStandardMaterial?Aw.environment:null,RD=Xt===null?Dt.outputEncoding:Xt.isXRRenderTarget===!0||Xt.texture.encoding&&Xt.texture.encoding!==No?Xt.texture.encoding:qu,XE=(Rs.isMeshStandardMaterial?Jt:pr).get(Rs.envMap||XC),uI=Rs.vertexColors===!0&&!!$p.attributes.color&&$p.attributes.color.itemSize===4,KC=!!Rs.normalMap&&!!$p.attributes.tangent,JC=!!$p.morphAttributes.position,BD=!!$p.morphAttributes.normal,ZC=!!$p.morphAttributes.color,hI=Rs.toneMapped?Dt.toneMapping:Ks,dI=$p.morphAttributes.position||$p.morphAttributes.normal||$p.morphAttributes.color,kD=dI!==void 0?dI.length:0,zo=In.get(Rs),OD=St.state.lights;if(ur===!0&&(Fr===!0||Su!==sn)){const Nu=Su===sn&&Rs.id===tn;Ns.setState(Rs,Su,Nu)}let z0=!1;Rs.version===zo.__version?zo.needsLights&&zo.lightsStateVersion!==OD.state.version||zo.outputEncoding!==RD||lu.isInstancedMesh&&zo.instancing===!1?z0=!0:lu.isInstancedMesh||zo.instancing!==!0?lu.isSkinnedMesh&&zo.skinning===!1?z0=!0:lu.isSkinnedMesh||zo.skinning!==!0?zo.envMap!==XE||Rs.fog===!0&&zo.fog!==qx?z0=!0:zo.numClippingPlanes===void 0||zo.numClippingPlanes===Ns.numPlanes&&zo.numIntersection===Ns.numIntersection?(zo.vertexAlphas!==uI||zo.vertexTangents!==KC||zo.morphTargets!==JC||zo.morphNormals!==BD||zo.morphColors!==ZC||zo.toneMapping!==hI||yn.isWebGL2===!0&&zo.morphTargetsCount!==kD)&&(z0=!0):z0=!0:z0=!0:z0=!0:(z0=!0,zo.__version=Rs.version);let B_=zo.currentProgram;z0===!0&&(B_=qE(Rs,Aw,lu));let KE=!1,yw=!1,JE=!1;const Jo=B_.getUniforms(),oy=zo.uniforms;if(tr.useProgram(B_.program)&&(KE=!0,yw=!0,JE=!0),Rs.id!==tn&&(tn=Rs.id,yw=!0),KE||sn!==Su){if(Jo.setValue(es,"projectionMatrix",Su.projectionMatrix),yn.logarithmicDepthBuffer&&Jo.setValue(es,"logDepthBufFC",2/(Math.log(Su.far+1)/Math.LN2)),sn!==Su&&(sn=Su,yw=!0,JE=!0),Rs.isShaderMaterial||Rs.isMeshPhongMaterial||Rs.isMeshToonMaterial||Rs.isMeshStandardMaterial||Rs.envMap){const Nu=Jo.map.cameraPosition;Nu!==void 0&&Nu.setValue(es,Qs.setFromMatrixPosition(Su.matrixWorld))}(Rs.isMeshPhongMaterial||Rs.isMeshToonMaterial||Rs.isMeshLambertMaterial||Rs.isMeshBasicMaterial||Rs.isMeshStandardMaterial||Rs.isShaderMaterial)&&Jo.setValue(es,"isOrthographic",Su.isOrthographicCamera===!0),(Rs.isMeshPhongMaterial||Rs.isMeshToonMaterial||Rs.isMeshLambertMaterial||Rs.isMeshBasicMaterial||Rs.isMeshStandardMaterial||Rs.isShaderMaterial||Rs.isShadowMaterial||lu.isSkinnedMesh)&&Jo.setValue(es,"viewMatrix",Su.matrixWorldInverse)}if(lu.isSkinnedMesh){Jo.setOptional(es,lu,"bindMatrix"),Jo.setOptional(es,lu,"bindMatrixInverse");const Nu=lu.skeleton;Nu&&(yn.floatVertexTextures?(Nu.boneTexture===null&&Nu.computeBoneTexture(),Jo.setValue(es,"boneTexture",Nu.boneTexture,Wn),Jo.setValue(es,"boneTextureSize",Nu.boneTextureSize)):console.warn("THREE.WebGLRenderer: SkinnedMesh can only be used with WebGL 2. With WebGL 1 OES_texture_float and vertex textures support is required."))}const ZE=$p.morphAttributes;var Mm,uv;(ZE.position!==void 0||ZE.normal!==void 0||ZE.color!==void 0&&yn.isWebGL2===!0)&&xo.update(lu,$p,Rs,B_),(yw||zo.receiveShadow!==lu.receiveShadow)&&(zo.receiveShadow=lu.receiveShadow,Jo.setValue(es,"receiveShadow",lu.receiveShadow)),Rs.isMeshGouraudMaterial&&Rs.envMap!==null&&(oy.envMap.value=XE,oy.flipEnvMap.value=XE.isCubeTexture&&XE.isRenderTargetTexture===!1?-1:1),yw&&(Jo.setValue(es,"toneMappingExposure",Dt.toneMappingExposure),zo.needsLights&&(uv=JE,(Mm=oy).ambientLightColor.needsUpdate=uv,Mm.lightProbe.needsUpdate=uv,Mm.directionalLights.needsUpdate=uv,Mm.directionalLightShadows.needsUpdate=uv,Mm.pointLights.needsUpdate=uv,Mm.pointLightShadows.needsUpdate=uv,Mm.spotLights.needsUpdate=uv,Mm.spotLightShadows.needsUpdate=uv,Mm.rectAreaLights.needsUpdate=uv,Mm.hemisphereLights.needsUpdate=uv),qx&&Rs.fog===!0&&Jr.refreshFogUniforms(oy,qx),Jr.refreshMaterialUniforms(oy,Rs,On,Kn,Dt.userData.transmissionRenderTarget||Ar),ex.upload(es,zo.uniformsList,oy,Wn)),Rs.isShaderMaterial&&Rs.uniformsNeedUpdate===!0&&(ex.upload(es,zo.uniformsList,oy,Wn),Rs.uniformsNeedUpdate=!1),Rs.isSpriteMaterial&&Jo.setValue(es,"center",lu.center),Jo.setValue(es,"modelViewMatrix",lu.modelViewMatrix),Jo.setValue(es,"normalMatrix",lu.normalMatrix),Jo.setValue(es,"modelMatrix",lu.matrixWorld);const pI=Rs.extraUniformsToUpload;if(pI&&Object.entries(pI).forEach(([Nu,Yx])=>Jo.setValue(es,Nu,Yx.value,Wn)),Rs.isShaderMaterial||Rs.isRawShaderMaterial){const Nu=Rs.uniformsGroups;for(let Yx=0,fI=Nu.length;Yx<fI;Yx++)if(yn.isWebGL2){const $C=Nu[Yx];Wx.update($C,B_),Wx.bind($C,B_)}else console.warn("THREE.WebGLRenderer: Uniform Buffer Objects can only be used with WebGL 2.")}return B_}(Sn,fr,br,wr,hr);tr.setMaterial(wr,Ps);let so=br.index;const Cl=br.attributes.position;if(so===null){if(Cl===void 0||Cl.count===0)return}else if(so.count===0)return;let po,eo=1;wr.wireframe===!0&&(so=Zn.getWireframeAttribute(br),eo=2),Mo.setup(hr,wr,Ts,br,so);let Eu=Jp;so!==null&&(po=or.get(so),Eu=Is,Eu.setIndex(po));const _w=so!==null?so.count:Cl.count,Zp=br.drawRange.start*eo,YE=br.drawRange.count*eo,R_=Kr!==null?Kr.start*eo:0,PD=Kr!==null?Kr.count*eo:1/0,sy=Math.max(Zp,R_),YC=Math.min(_w,Zp+YE,R_+PD)-1,j0=Math.max(0,YC-sy+1);if(j0!==0){if(hr.isMesh)wr.wireframe===!0?(tr.setLineWidth(wr.wireframeLinewidth*Hs()),Eu.setMode(1)):Eu.setMode(4);else if(hr.isLine){let Su=wr.linewidth;Su===void 0&&(Su=1),tr.setLineWidth(Su*Hs()),hr.isLineSegments?Eu.setMode(1):hr.isLineLoop?Eu.setMode(2):Eu.setMode(3)}else hr.isPoints?Eu.setMode(0):hr.isSprite&&Eu.setMode(4);if(hr.isInstancedMesh)Eu.renderInstances(sy,j0,hr.count);else if(br.isInstancedBufferGeometry){const Su=Math.min(br.instanceCount,br._maxInstanceCount);Eu.renderInstances(sy,j0,Su)}else Eu.render(sy,j0)}},this.compile=function(Sn,fr){function br(wr,hr,Kr){wr.transparent===!0&&wr.side===bn?(wr.side=$t,wr.needsUpdate=!0,qE(wr,hr,Kr),wr.side=_n,wr.needsUpdate=!0,qE(wr,hr,Kr),wr.side=bn):qE(wr,hr,Kr)}St=Ds.get(Sn),St.init(),Rt.push(St),Sn.traverseVisible(function(wr){wr.isLight&&wr.layers.test(fr.layers)&&(St.pushLight(wr),wr.castShadow&&St.pushShadow(wr))}),St.setupLights(Dt.physicallyCorrectLights),Sn.traverse(function(wr){const hr=wr.material;if(hr)if(Array.isArray(hr))for(let Kr=0;Kr<hr.length;Kr++)br(hr[Kr],Sn,wr);else br(hr,Sn,wr)}),Rt.pop(),St=null};let qC=null;function sI(){P_.stop()}function oI(){P_.start()}const P_=new N1;function aI(Sn,fr,br,wr){if(Sn.visible===!1)return;if(Sn.layers.test(fr.layers)){if(Sn.isGroup)br=Sn.renderOrder;else if(Sn.isLOD)Sn.autoUpdate===!0&&Sn.update(fr);else if(Sn.isLight)St.pushLight(Sn),Sn.castShadow&&St.pushShadow(Sn);else if(Sn.isSprite){if(!Sn.frustumCulled||cr.intersectsSprite(Sn)){wr&&Qs.setFromMatrixPosition(Sn.matrixWorld).applyMatrix4(Qr);const Kr=vr.update(Sn),Ps=Sn.material;Ps.visible&&Tt.push(Sn,Kr,Ps,br,Qs.z,null)}}else if((Sn.isMesh||Sn.isLine||Sn.isPoints)&&(Sn.isSkinnedMesh&&Sn.skeleton.frame!==Hn.render.frame&&(Sn.skeleton.update(),Sn.skeleton.frame=Hn.render.frame),!Sn.frustumCulled||cr.intersectsObject(Sn))){wr&&Qs.setFromMatrixPosition(Sn.matrixWorld).applyMatrix4(Qr);const Kr=vr.update(Sn),Ps=Sn.material;if(Array.isArray(Ps)){const Ts=Kr.groups;for(let so=0,Cl=Ts.length;so<Cl;so++){const po=Ts[so],eo=Ps[po.materialIndex];eo&&eo.visible&&Tt.push(Sn,Kr,eo,br,Qs.z,po)}}else Ps.visible&&Tt.push(Sn,Kr,Ps,br,Qs.z,null)}}const hr=Sn.children;for(let Kr=0,Ps=hr.length;Kr<Ps;Kr++)aI(hr[Kr],fr,br,wr)}function lI(Sn,fr,br,wr){const hr=Sn.opaque,Kr=Sn.transmissive,Ps=Sn.transparent;if(St.setupLightsView(br),Dt.userData.transmissionRender===void 0&&Dt.userData.renderTransmissionPass!==!1&&Kr.length>0&&function(Ts,so,Cl){console.error("three.js internal render transmission pass should not be called");const po=yn.isWebGL2;Ar===null&&(Ar=new ap(1,1,{generateMipmaps:!0,type:Dn.has("EXT_color_buffer_half_float")?lm:am,minFilter:mo,samples:po&&rt===!0?4:0})),Dt.getDrawingBufferSize(as),po?Ar.setSize(as.x,as.y):Ar.setSize(Du(as.x),Du(as.y));const eo=Dt.getRenderTarget();Dt.setRenderTarget(Ar),Dt.clear();const Eu=Dt.toneMapping;Dt.toneMapping=Ks,WE(Ts,so,Cl),Dt.toneMapping=Eu,Wn.updateMultisampleRenderTarget(Ar),Wn.updateRenderTargetMipmap(Ar),Dt.setRenderTarget(eo)}([...hr,...Ps],fr,br),wr&&tr.viewport(ln.copy(wr)),Dt.userData.opaqueRender!==!1&&hr.length>0&&WE(hr,fr,br),Dt.userData.transparentRender!==!1&&Ps.length>0&&WE(Ps,fr,br),Dt.userData.transmissionRender!==!1&&Kr.length>0){Ar||(Ar=new ap(1,1));const Ts=Dt.userData.transmissionRenderTarget.texture,so=yn.isWebGL2,Cl=Ts.generateMipmaps,po=Ts.minFilter;so&&Dt.userData.blurTransmissionTarget&&(Ts.generateMipmaps=!0,Ts.minFilter=mo,Ts.needsUpdate=!0,Wn.updateRenderTargetMipmap(Dt.userData.transmissionRenderTarget)),WE(Kr,fr,br),so&&Dt.userData.blurTransmissionTarget&&(Ts.generateMipmaps=Cl,Ts.minFilter=po,Ts.needsUpdate=!0,Wn.updateRenderTargetMipmap(Dt.userData.transmissionRenderTarget))}tr.buffers.depth.setTest(!0),tr.buffers.depth.setMask(!0),tr.buffers.color.setMask(!0),tr.setPolygonOffset(!1)}function WE(Sn,fr,br){const wr={...Dt.userData};Dt.userData.opaqueRender=void 0,Dt.userData.transparentRender=void 0,Dt.userData.transmissionRender=void 0,Dt.userData.backgroundRender=void 0;const hr=fr.isScene===!0?fr.overrideMaterial:null;for(let Kr=0,Ps=Sn.length;Kr<Ps;Kr++){const Ts=Sn[Kr],so=Ts.object,Cl=Ts.geometry,po=hr===null?Ts.material:hr,eo=Ts.group;so.layers.test(br.layers)&&DD(so,fr,br,Cl,po,eo)}Object.assign(Dt.userData,wr)}function DD(Sn,fr,br,wr,hr,Kr){Sn.onBeforeRender(Dt,fr,br,wr,hr,Kr),Sn.modelViewMatrix.multiplyMatrices(br.matrixWorldInverse,Sn.matrixWorld),Sn.normalMatrix.getNormalMatrix(Sn.modelViewMatrix),hr.onBeforeRender(Dt,fr,br,wr,Sn,Kr),hr.transparent===!0&&hr.side===bn?(hr.side=$t,hr.needsUpdate=!0,Dt.renderBufferDirect(br,fr,wr,hr,Sn,Kr),hr.side=_n,hr.needsUpdate=!0,Dt.renderBufferDirect(br,fr,wr,hr,Sn,Kr),hr.side=bn):Dt.renderBufferDirect(br,fr,wr,hr,Sn,Kr),Sn.onAfterRender(Dt,fr,br,wr,hr,Kr),hr.onAfterRender(Dt,fr,br,wr,Sn,Kr)}function qE(Sn,fr,br){fr.isScene!==!0&&(fr=ys);const wr=In.get(Sn),hr=St.state.lights,Kr=St.state.shadowsArray,Ps=hr.state.version,Ts=Pr.getParameters(Sn,hr.state,Kr,fr,br),so=Pr.getProgramCacheKey(Ts);let Cl=wr.programs;wr.environment=Sn.isMeshStandardMaterial?fr.environment:null,wr.fog=fr.fog,wr.envMap=(Sn.isMeshStandardMaterial?Jt:pr).get(Sn.envMap||wr.environment),Cl===void 0&&(Sn.addEventListener("dispose",rI),Cl=new Map,wr.programs=Cl);let po=Cl.get(so);if(po!==void 0){if(wr.currentProgram===po&&wr.lightsStateVersion===Ps)return cI(Sn,Ts),po}else Ts.uniforms=Pr.getUniforms(Sn),Sn.onBuild(br,Ts,Dt),Sn.onBeforeCompile(Ts,Dt),po=Pr.acquireProgram(Ts,so),Cl.set(so,po),wr.uniforms=Ts.uniforms;const eo=wr.uniforms;(Sn.isShaderMaterial||Sn.isRawShaderMaterial)&&Sn.clipping!==!0||(eo.clippingPlanes=Ns.uniform),cI(Sn,Ts),wr.needsLights=function(Zp){return Zp.isMeshLambertMaterial||Zp.isMeshToonMaterial||Zp.isMeshPhongMaterial||Zp.isMeshStandardMaterial||Zp.isShadowMaterial||Zp.isShaderMaterial&&Zp.lights===!0}(Sn),wr.lightsStateVersion=Ps,wr.needsLights&&(eo.ambientLightColor.value=hr.state.ambient,eo.lightProbe.value=hr.state.probe,eo.directionalLights.value=hr.state.directional,eo.directionalLightShadows.value=hr.state.directionalShadow,eo.spotLights.value=hr.state.spot,eo.spotLightShadows.value=hr.state.spotShadow,eo.rectAreaLights.value=hr.state.rectArea,eo.ltc_1.value=hr.state.rectAreaLTC1,eo.ltc_2.value=hr.state.rectAreaLTC2,eo.pointLights.value=hr.state.point,eo.pointLightShadows.value=hr.state.pointShadow,eo.hemisphereLights.value=hr.state.hemi,eo.directionalShadowMap.value=hr.state.directionalShadowMap,eo.directionalShadowMatrix.value=hr.state.directionalShadowMatrix,eo.spotShadowMap.value=hr.state.spotShadowMap,eo.spotLightMatrix.value=hr.state.spotLightMatrix,eo.spotLightMap.value=hr.state.spotLightMap,eo.pointShadowMap.value=hr.state.pointShadowMap,eo.pointShadowMatrix.value=hr.state.pointShadowMatrix);const Eu=po.getUniforms(),_w=ex.seqWithValue(Eu.seq,eo);return wr.currentProgram=po,wr.uniformsList=_w,po}function cI(Sn,fr){const br=In.get(Sn);br.outputEncoding=fr.outputEncoding,br.instancing=fr.instancing,br.skinning=fr.skinning,br.morphTargets=fr.morphTargets,br.morphNormals=fr.morphNormals,br.morphColors=fr.morphColors,br.morphTargetsCount=fr.morphTargetsCount,br.numClippingPlanes=fr.numClippingPlanes,br.numIntersection=fr.numClipIntersection,br.vertexAlphas=fr.vertexAlphas,br.vertexTangents=fr.vertexTangents,br.toneMapping=fr.toneMapping}P_.setAnimationLoop(function(Sn){qC&&qC(Sn)}),typeof self<"u"&&P_.setContext(self),this.setAnimationLoop=function(Sn){qC=Sn,bu.setAnimationLoop(Sn),Sn===null?P_.stop():P_.start()},bu.addEventListener("sessionstart",sI),bu.addEventListener("sessionend",oI),this.render=function(Sn,fr){if(fr===void 0||fr.isCamera===!0){if(Ft!==!0){if(Sn.matrixWorldAutoUpdate===!0&&Sn.updateMatrixWorld(),fr.parent===null&&fr.matrixWorldAutoUpdate===!0&&fr.updateMatrixWorld(),bu.enabled===!0&&bu.isPresenting===!0&&(bu.cameraAutoUpdate===!0&&bu.updateCamera(fr),fr=bu.getCamera()),Sn.isScene===!0&&Sn.onBeforeRender(Dt,Sn,fr,Xt),St=Ds.get(Sn,Rt.length),St.init(),Rt.push(St),Qr.multiplyMatrices(fr.projectionMatrix,fr.matrixWorldInverse),cr.setFromProjectionMatrix(Qr),Fr=this.localClippingEnabled,ur=Ns.init(this.clippingPlanes,Fr,fr),Tt=gs.get(Sn,It.length),Tt.init(),It.push(Tt),aI(Sn,fr,0,Dt.sortObjects),Tt.finish(),Dt.sortObjects===!0&&Tt.sort(_r,Tr),Dt.userData.shadowMapRender){ur===!0&&Ns.beginShadows();const br=St.state.shadowsArray;br.length>0&&xs.render(br,Sn,fr),ur===!0&&Ns.endShadows()}if(this.info.autoReset===!0&&this.info.reset(),Dt.userData.backgroundRender!==!1&&Ms.render(Tt,Sn),Dt.userData.sceneRender!==!1)if(St.setupLights(Dt.physicallyCorrectLights),fr.isArrayCamera){const br=fr.cameras;for(let wr=0,hr=br.length;wr<hr;wr++){const Kr=br[wr];lI(Tt,Sn,Kr,Kr.viewport)}}else lI(Tt,Sn,fr);Xt!==null&&(Wn.updateMultisampleRenderTarget(Xt),Wn.updateRenderTargetMipmap(Xt)),Sn.isScene===!0&&Sn.onAfterRender(Dt,Sn,fr),Mo.resetDefaultState(),tn=-1,sn=null,Rt.pop(),St=Rt.length>0?Rt[Rt.length-1]:null,It.pop(),Tt=It.length>0?It[It.length-1]:null}}else console.error("THREE.WebGLRenderer.render: camera is not an instance of THREE.Camera.")},this.getActiveCubeFace=function(){return Nt},this.getActiveMipmapLevel=function(){return zt},this.getRenderTarget=function(){return Xt},this.setRenderTargetTextures=function(Sn,fr,br){In.get(Sn.texture).__webglTexture=fr,In.get(Sn.depthTexture).__webglTexture=br;const wr=In.get(Sn);wr.__hasExternalTextures=!0,wr.__hasExternalTextures&&(wr.__autoAllocateDepthBuffer=br===void 0,wr.__autoAllocateDepthBuffer||Dn.has("WEBGL_multisampled_render_to_texture")===!0&&(console.warn("THREE.WebGLRenderer: Render-to-texture extension was disabled because an external texture was provided"),wr.__useRenderToTexture=!1))},this.setRenderTargetFramebuffer=function(Sn,fr){const br=In.get(Sn);br.__webglFramebuffer=fr,br.__useDefaultFramebuffer=fr===void 0},this.setRenderTarget=function(Sn,fr=0,br=0){Xt=Sn,Nt=fr,zt=br;let wr=!0;if(Sn){const Ts=In.get(Sn);Ts.__useDefaultFramebuffer!==void 0?(tr.bindFramebuffer(36160,null),wr=!1):Ts.__webglFramebuffer===void 0?Wn.setupRenderTarget(Sn):Ts.__hasExternalTextures&&Wn.rebindTextures(Sn,In.get(Sn.texture).__webglTexture,In.get(Sn.depthTexture).__webglTexture)}let hr=null,Kr=!1,Ps=!1;if(Sn){const Ts=Sn.texture;(Ts.isData3DTexture||Ts.isDataArrayTexture)&&(Ps=!0);const so=In.get(Sn).__webglFramebuffer;Sn.isWebGLCubeRenderTarget?(hr=so[fr],Kr=!0):hr=yn.isWebGL2&&Sn.samples>0&&Wn.useMultisampledRTT(Sn)===!1?In.get(Sn).__webglMultisampledFramebuffer:so,ln.copy(Sn.viewport),kn.copy(Sn.scissor),Ln=Sn.scissorTest}else ln.copy(gr).multiplyScalar(On).floor(),kn.copy(Or).multiplyScalar(On).floor(),Ln=Gr;if(tr.bindFramebuffer(36160,hr)&&yn.drawBuffers&&wr&&tr.drawBuffers(Sn,hr),tr.viewport(ln),tr.scissor(kn),tr.setScissorTest(Ln),Kr){const Ts=In.get(Sn.texture);es.framebufferTexture2D(36160,36064,34069+fr,Ts.__webglTexture,br)}else if(Ps){const Ts=In.get(Sn.texture),so=fr||0;es.framebufferTextureLayer(36160,36064,Ts.__webglTexture,br||0,so)}tn=-1},this.readRenderTargetPixels=function(Sn,fr,br,wr,hr,Kr,Ps){if(!Sn||!Sn.isWebGLRenderTarget)return void console.error("THREE.WebGLRenderer.readRenderTargetPixels: renderTarget is not THREE.WebGLRenderTarget.");let Ts=In.get(Sn).__webglFramebuffer;if(Sn.isWebGLCubeRenderTarget&&Ps!==void 0&&(Ts=Ts[Ps]),Ts){tr.bindFramebuffer(36160,Ts);try{const so=Sn.texture,Cl=so.format,po=so.type;if(Cl!==Hu&&bo.convert(Cl)!==es.getParameter(35739))return void console.error("THREE.WebGLRenderer.readRenderTargetPixels: renderTarget is not in RGBA or implementation defined format.");const eo=po===lm&&(Dn.has("EXT_color_buffer_half_float")||yn.isWebGL2&&Dn.has("EXT_color_buffer_float"));if(!(po===am||bo.convert(po)===es.getParameter(35738)||po===Wl&&(yn.isWebGL2||Dn.has("OES_texture_float")||Dn.has("WEBGL_color_buffer_float"))||eo))return void console.error("THREE.WebGLRenderer.readRenderTargetPixels: renderTarget is not in UnsignedByteType or implementation defined type.");fr>=0&&fr<=Sn.width-wr&&br>=0&&br<=Sn.height-hr&&es.readPixels(fr,br,wr,hr,bo.convert(Cl),bo.convert(po),Kr)}finally{const so=Xt!==null?In.get(Xt).__webglFramebuffer:null;tr.bindFramebuffer(36160,so)}}},this.copyFramebufferToTexture=function(Sn,fr,br=0){const wr=Math.pow(2,-br),hr=Math.floor(fr.image.width*wr),Kr=Math.floor(fr.image.height*wr);Wn.setTexture2D(fr,0),es.copyTexSubImage2D(3553,br,0,0,Sn.x,Sn.y,hr,Kr),tr.unbindTexture()},this.copyTextureToTexture=function(Sn,fr,br,wr=0){const hr=fr.image.width,Kr=fr.image.height,Ps=bo.convert(br.format),Ts=bo.convert(br.type);Wn.setTexture2D(br,0),es.pixelStorei(37440,br.flipY),es.pixelStorei(37441,br.premultiplyAlpha),es.pixelStorei(3317,br.unpackAlignment),fr.isDataTexture?es.texSubImage2D(3553,wr,Sn.x,Sn.y,hr,Kr,Ps,Ts,fr.image.data):fr.isCompressedTexture?es.compressedTexSubImage2D(3553,wr,Sn.x,Sn.y,fr.mipmaps[0].width,fr.mipmaps[0].height,Ps,fr.mipmaps[0].data):es.texSubImage2D(3553,wr,Sn.x,Sn.y,Ps,Ts,fr.image),wr===0&&br.generateMipmaps&&es.generateMipmap(3553),tr.unbindTexture()},this.copyTextureToTexture3D=function(Sn,fr,br,wr,hr=0){if(Dt.isWebGL1Renderer)return void console.warn("THREE.WebGLRenderer.copyTextureToTexture3D: can only be used with WebGL2.");const Kr=Sn.max.x-Sn.min.x+1,Ps=Sn.max.y-Sn.min.y+1,Ts=Sn.max.z-Sn.min.z+1,so=bo.convert(wr.format),Cl=bo.convert(wr.type);let po;if(wr.isData3DTexture)Wn.setTexture3D(wr,0),po=32879;else{if(!wr.isDataArrayTexture)return void console.warn("THREE.WebGLRenderer.copyTextureToTexture3D: only supports THREE.DataTexture3D and THREE.DataTexture2DArray.");Wn.setTexture2DArray(wr,0),po=35866}es.pixelStorei(37440,wr.flipY),es.pixelStorei(37441,wr.premultiplyAlpha),es.pixelStorei(3317,wr.unpackAlignment);const eo=es.getParameter(3314),Eu=es.getParameter(32878),_w=es.getParameter(3316),Zp=es.getParameter(3315),YE=es.getParameter(32877),R_=br.isCompressedTexture?br.mipmaps[0]:br.image;es.pixelStorei(3314,R_.width),es.pixelStorei(32878,R_.height),es.pixelStorei(3316,Sn.min.x),es.pixelStorei(3315,Sn.min.y),es.pixelStorei(32877,Sn.min.z),br.isDataTexture||br.isData3DTexture?es.texSubImage3D(po,hr,fr.x,fr.y,fr.z,Kr,Ps,Ts,so,Cl,R_.data):br.isCompressedTexture?(console.warn("THREE.WebGLRenderer.copyTextureToTexture3D: untested support for compressed srcTexture."),es.compressedTexSubImage3D(po,hr,fr.x,fr.y,fr.z,Kr,Ps,Ts,so,R_.data)):es.texSubImage3D(po,hr,fr.x,fr.y,fr.z,Kr,Ps,Ts,so,Cl,R_),es.pixelStorei(3314,eo),es.pixelStorei(32878,Eu),es.pixelStorei(3316,_w),es.pixelStorei(3315,Zp),es.pixelStorei(32877,YE),hr===0&&wr.generateMipmaps&&es.generateMipmap(po),tr.unbindTexture()},this.initTexture=function(Sn){Sn.isCubeTexture?Wn.setTextureCube(Sn,0):Sn.isData3DTexture?Wn.setTexture3D(Sn,0):Sn.isDataArrayTexture?Wn.setTexture2DArray(Sn,0):Wn.setTexture2D(Sn,0),tr.unbindTexture()},this.resetState=function(){Nt=0,zt=0,Xt=null,tr.reset(),Mo.reset()},typeof __THREE_DEVTOOLS__<"u"&&__THREE_DEVTOOLS__.dispatchEvent(new CustomEvent("observe",{detail:this}))}class aC extends oC{}aC.prototype.isWebGL1Renderer=!0;class lx{constructor(o,g=25e-5){this.isFogExp2=!0,this.name="",this.color=new rs(o),this.density=g}clone(){return new lx(this.color,this.density)}toJSON(){return{type:"FogExp2",color:this.color.getHex(),density:this.density}}}class A_{constructor(o,g=1,$=1e3){this.isFog=!0,this.name="",this.color=new rs(o),this.near=g,this.far=$}clone(){return new A_(this.color,this.near,this.far)}toJSON(){return{type:"Fog",color:this.color.getHex(),near:this.near,far:this.far}}}class lC extends no{constructor(){super(),this.isScene=!0,this.type="Scene",this.background=null,this.environment=null,this.fog=null,this.overrideMaterial=null,typeof __THREE_DEVTOOLS__<"u"&&__THREE_DEVTOOLS__.dispatchEvent(new CustomEvent("observe",{detail:this}))}copy(o,g){return super.copy(o,g),o.background!==null&&(this.background=o.background.clone()),o.environment!==null&&(this.environment=o.environment.clone()),o.fog!==null&&(this.fog=o.fog.clone()),o.overrideMaterial!==null&&(this.overrideMaterial=o.overrideMaterial.clone()),this.matrixAutoUpdate=o.matrixAutoUpdate,this}toJSON(o){const g=super.toJSON(o);return this.fog!==null&&(g.object.fog=this.fog.toJSON()),g}get autoUpdate(){return console.warn("THREE.Scene: autoUpdate was renamed to matrixWorldAutoUpdate in r144."),this.matrixWorldAutoUpdate}set autoUpdate(o){console.warn("THREE.Scene: autoUpdate was renamed to matrixWorldAutoUpdate in r144."),this.matrixWorldAutoUpdate=o}}class cx{constructor(o,g){this.isInterleavedBuffer=!0,this.array=o,this.stride=g,this.count=o!==void 0?o.length/g:0,this.usage=Iu,this.updateRange={offset:0,count:-1},this.version=0,this.uuid=Es()}onUploadCallback(){}set needsUpdate(o){o===!0&&this.version++}setUsage(o){return this.usage=o,this}copy(o){return this.array=new o.array.constructor(o.array),this.count=o.count,this.stride=o.stride,this.usage=o.usage,this}copyAt(o,g,$){o*=this.stride,$*=g.stride;for(let _e=0,rt=this.stride;_e<rt;_e++)this.array[o+_e]=g.array[$+_e];return this}set(o,g=0){return this.array.set(o,g),this}clone(o){o.arrayBuffers===void 0&&(o.arrayBuffers={}),this.array.buffer._uuid===void 0&&(this.array.buffer._uuid=Es()),o.arrayBuffers[this.array.buffer._uuid]===void 0&&(o.arrayBuffers[this.array.buffer._uuid]=this.array.slice(0).buffer);const g=new this.array.constructor(o.arrayBuffers[this.array.buffer._uuid]),$=new this.constructor(g,this.stride);return $.setUsage(this.usage),$}onUpload(o){return this.onUploadCallback=o,this}toJSON(o){return o.arrayBuffers===void 0&&(o.arrayBuffers={}),this.array.buffer._uuid===void 0&&(this.array.buffer._uuid=Es()),o.arrayBuffers[this.array.buffer._uuid]===void 0&&(o.arrayBuffers[this.array.buffer._uuid]=Array.from(new Uint32Array(this.array.buffer))),{uuid:this.uuid,buffer:this.array.buffer._uuid,type:this.array.constructor.name,stride:this.stride}}}const lo=new fn;class y_{constructor(o,g,$,_e=!1){this.isInterleavedBufferAttribute=!0,this.name="",this.data=o,this.itemSize=g,this.offset=$,this.normalized=_e===!0}get count(){return this.data.count}get array(){return this.data.array}set needsUpdate(o){this.data.needsUpdate=o}applyMatrix4(o){for(let g=0,$=this.data.count;g<$;g++)lo.fromBufferAttribute(this,g),lo.applyMatrix4(o),this.setXYZ(g,lo.x,lo.y,lo.z);return this}applyNormalMatrix(o){for(let g=0,$=this.count;g<$;g++)lo.fromBufferAttribute(this,g),lo.applyNormalMatrix(o),this.setXYZ(g,lo.x,lo.y,lo.z);return this}transformDirection(o){for(let g=0,$=this.count;g<$;g++)lo.fromBufferAttribute(this,g),lo.transformDirection(o),this.setXYZ(g,lo.x,lo.y,lo.z);return this}setX(o,g){return this.normalized&&(g=Po(g,this.array)),this.data.array[o*this.data.stride+this.offset]=g,this}setY(o,g){return this.normalized&&(g=Po(g,this.array)),this.data.array[o*this.data.stride+this.offset+1]=g,this}setZ(o,g){return this.normalized&&(g=Po(g,this.array)),this.data.array[o*this.data.stride+this.offset+2]=g,this}setW(o,g){return this.normalized&&(g=Po(g,this.array)),this.data.array[o*this.data.stride+this.offset+3]=g,this}getX(o){let g=this.data.array[o*this.data.stride+this.offset];return this.normalized&&(g=Um(g,this.array)),g}getY(o){let g=this.data.array[o*this.data.stride+this.offset+1];return this.normalized&&(g=Um(g,this.array)),g}getZ(o){let g=this.data.array[o*this.data.stride+this.offset+2];return this.normalized&&(g=Um(g,this.array)),g}getW(o){let g=this.data.array[o*this.data.stride+this.offset+3];return this.normalized&&(g=Um(g,this.array)),g}setXY(o,g,$){return o=o*this.data.stride+this.offset,this.normalized&&(g=Po(g,this.array),$=Po($,this.array)),this.data.array[o+0]=g,this.data.array[o+1]=$,this}setXYZ(o,g,$,_e){return o=o*this.data.stride+this.offset,this.normalized&&(g=Po(g,this.array),$=Po($,this.array),_e=Po(_e,this.array)),this.data.array[o+0]=g,this.data.array[o+1]=$,this.data.array[o+2]=_e,this}setXYZW(o,g,$,_e,rt){return o=o*this.data.stride+this.offset,this.normalized&&(g=Po(g,this.array),$=Po($,this.array),_e=Po(_e,this.array),rt=Po(rt,this.array)),this.data.array[o+0]=g,this.data.array[o+1]=$,this.data.array[o+2]=_e,this.data.array[o+3]=rt,this}clone(o){if(o===void 0){console.log("THREE.InterleavedBufferAttribute.clone(): Cloning an interleaved buffer attribute will deinterleave buffer data.");const g=[];for(let $=0;$<this.count;$++){const _e=$*this.data.stride+this.offset;for(let rt=0;rt<this.itemSize;rt++)g.push(this.data.array[_e+rt])}return new Ro(new this.array.constructor(g),this.itemSize,this.normalized)}return o.interleavedBuffers===void 0&&(o.interleavedBuffers={}),o.interleavedBuffers[this.data.uuid]===void 0&&(o.interleavedBuffers[this.data.uuid]=this.data.clone(o)),new y_(o.interleavedBuffers[this.data.uuid],this.itemSize,this.offset,this.normalized)}toJSON(o){if(o===void 0){console.log("THREE.InterleavedBufferAttribute.toJSON(): Serializing an interleaved buffer attribute will deinterleave buffer data.");const g=[];for(let $=0;$<this.count;$++){const _e=$*this.data.stride+this.offset;for(let rt=0;rt<this.itemSize;rt++)g.push(this.data.array[_e+rt])}return{itemSize:this.itemSize,type:this.array.constructor.name,array:g,normalized:this.normalized}}return o.interleavedBuffers===void 0&&(o.interleavedBuffers={}),o.interleavedBuffers[this.data.uuid]===void 0&&(o.interleavedBuffers[this.data.uuid]=this.data.toJSON(o)),{isInterleavedBufferAttribute:!0,itemSize:this.itemSize,data:this.data.uuid,offset:this.offset,normalized:this.normalized}}}class RA extends Fl{constructor(o){super(),this.isSpriteMaterial=!0,this.type="SpriteMaterial",this.color=new rs(16777215),this.map=null,this.alphaMap=null,this.rotation=0,this.sizeAttenuation=!0,this.transparent=!0,this.fog=!0,this.setValues(o)}copy(o){return super.copy(o),this.color.copy(o.color),this.map=o.map,this.alphaMap=o.alphaMap,this.rotation=o.rotation,this.sizeAttenuation=o.sizeAttenuation,this.fog=o.fog,this}}let w_;const ux=new fn,Ny=new fn,BA=new fn,I0=new Sr,Uy=new Sr,sE=new Os,x_=new fn,Fy=new fn,b_=new fn,hx=new Sr,dx=new Sr,pT=new Sr;class jy extends no{constructor(o){if(super(),this.isSprite=!0,this.type="Sprite",w_===void 0){w_=new fs;const g=new Float32Array([-.5,-.5,0,0,0,.5,-.5,0,1,0,.5,.5,0,1,1,-.5,.5,0,0,1]),$=new cx(g,5);w_.setIndex([0,1,2,0,2,3]),w_.setAttribute("position",new y_($,3,0,!1)),w_.setAttribute("uv",new y_($,2,3,!1))}this.geometry=w_,this.material=o!==void 0?o:new RA,this.center=new Sr(.5,.5)}raycast(o,g){o.camera===null&&console.error('THREE.Sprite: "Raycaster.camera" needs to be set in order to raycast against sprites.'),Ny.setFromMatrixScale(this.matrixWorld),sE.copy(o.camera.matrixWorld),this.modelViewMatrix.multiplyMatrices(o.camera.matrixWorldInverse,this.matrixWorld),BA.setFromMatrixPosition(this.modelViewMatrix),o.camera.isPerspectiveCamera&&this.material.sizeAttenuation===!1&&Ny.multiplyScalar(-BA.z);const $=this.material.rotation;let _e,rt;$!==0&&(rt=Math.cos($),_e=Math.sin($));const at=this.center;kA(x_.set(-.5,-.5,0),BA,at,Ny,_e,rt),kA(Fy.set(.5,-.5,0),BA,at,Ny,_e,rt),kA(b_.set(.5,.5,0),BA,at,Ny,_e,rt),hx.set(0,0),dx.set(1,0),pT.set(1,1);let ct=o.ray.intersectTriangle(x_,Fy,b_,!1,ux);if(ct===null&&(kA(Fy.set(-.5,.5,0),BA,at,Ny,_e,rt),dx.set(0,1),ct=o.ray.intersectTriangle(x_,b_,Fy,!1,ux),ct===null))return;const ft=o.ray.origin.distanceTo(ux);ft<o.near||ft>o.far||g.push({distance:ft,point:ux.clone(),uv:yu.getUV(ux,x_,Fy,b_,hx,dx,pT,new Sr),face:null,object:this})}copy(o,g){return super.copy(o,g),o.center!==void 0&&this.center.copy(o.center),this.material=o.material,this}}function kA(dt,o,g,$,_e,rt){I0.subVectors(dt,g).addScalar(.5).multiply($),_e!==void 0?(Uy.x=rt*I0.x-_e*I0.y,Uy.y=_e*I0.x+rt*I0.y):Uy.copy(I0),dt.copy(o),dt.x+=Uy.x,dt.y+=Uy.y,dt.applyMatrix4(sE)}const px=new fn,oE=new fn;class cC extends no{constructor(){super(),this._currentLevel=0,this.type="LOD",Object.defineProperties(this,{levels:{enumerable:!0,value:[]},isLOD:{value:!0}}),this.autoUpdate=!0}copy(o){super.copy(o,!1);const g=o.levels;for(let $=0,_e=g.length;$<_e;$++){const rt=g[$];this.addLevel(rt.object.clone(),rt.distance)}return this.autoUpdate=o.autoUpdate,this}addLevel(o,g=0){g=Math.abs(g);const $=this.levels;let _e;for(_e=0;_e<$.length&&!(g<$[_e].distance);_e++);return $.splice(_e,0,{distance:g,object:o}),this.add(o),this}getCurrentLevel(){return this._currentLevel}getObjectForDistance(o){const g=this.levels;if(g.length>0){let $,_e;for($=1,_e=g.length;$<_e&&!(o<g[$].distance);$++);return g[$-1].object}return null}raycast(o,g){if(this.levels.length>0){px.setFromMatrixPosition(this.matrixWorld);const $=o.ray.origin.distanceTo(px);this.getObjectForDistance($).raycast(o,g)}}update(o){const g=this.levels;if(g.length>1){px.setFromMatrixPosition(o.matrixWorld),oE.setFromMatrixPosition(this.matrixWorld);const $=px.distanceTo(oE)/o.zoom;let _e,rt;for(g[0].object.visible=!0,_e=1,rt=g.length;_e<rt&&$>=g[_e].distance;_e++)g[_e-1].object.visible=!1,g[_e].object.visible=!0;for(this._currentLevel=_e-1;_e<rt;_e++)g[_e].object.visible=!1}}toJSON(o){const g=super.toJSON(o);this.autoUpdate===!1&&(g.object.autoUpdate=!1),g.object.levels=[];const $=this.levels;for(let _e=0,rt=$.length;_e<rt;_e++){const at=$[_e];g.object.levels.push({object:at.object.uuid,distance:at.distance})}return g}}const fT=new fn,aE=new _o,OA=new _o,uC=new fn,mT=new Os;class zy extends Zl{constructor(o,g){super(o,g),this.isSkinnedMesh=!0,this.type="SkinnedMesh",this.bindMode="attached",this.bindMatrix=new Os,this.bindMatrixInverse=new Os}copy(o,g){return super.copy(o,g),this.bindMode=o.bindMode,this.bindMatrix.copy(o.bindMatrix),this.bindMatrixInverse.copy(o.bindMatrixInverse),this.skeleton=o.skeleton,this}bind(o,g){this.skeleton=o,g===void 0&&(this.updateMatrixWorld(!0),this.skeleton.calculateInverses(),g=this.matrixWorld),this.bindMatrix.copy(g),this.bindMatrixInverse.copy(g).invert()}pose(){this.skeleton.pose()}normalizeSkinWeights(){const o=new _o,g=this.geometry.attributes.skinWeight;for(let $=0,_e=g.count;$<_e;$++){o.fromBufferAttribute(g,$);const rt=1/o.manhattanLength();rt!==1/0?o.multiplyScalar(rt):o.set(1,0,0,0),g.setXYZW($,o.x,o.y,o.z,o.w)}}updateMatrixWorld(o){super.updateMatrixWorld(o),this.bindMode==="attached"?this.bindMatrixInverse.copy(this.matrixWorld).invert():this.bindMode==="detached"?this.bindMatrixInverse.copy(this.bindMatrix).invert():console.warn("THREE.SkinnedMesh: Unrecognized bindMode: "+this.bindMode)}boneTransform(o,g){const $=this.skeleton,_e=this.geometry;aE.fromBufferAttribute(_e.attributes.skinIndex,o),OA.fromBufferAttribute(_e.attributes.skinWeight,o),fT.copy(g).applyMatrix4(this.bindMatrix),g.set(0,0,0);for(let rt=0;rt<4;rt++){const at=OA.getComponent(rt);if(at!==0){const ct=aE.getComponent(rt);mT.multiplyMatrices($.bones[ct].matrixWorld,$.boneInverses[ct]),g.addScaledVector(uC.copy(fT).applyMatrix4(mT),at)}}return g.applyMatrix4(this.bindMatrixInverse)}}class E_ extends no{constructor(){super(),this.isBone=!0,this.type="Bone"}}class Vy extends qo{constructor(o=null,g=1,$=1,_e,rt,at,ct,ft,mt=na,bt=na,Tt,St){super(null,at,ct,ft,mt,bt,_e,rt,Tt,St),this.isDataTexture=!0,this.image={data:o,width:g,height:$},this.generateMipmaps=!1,this.flipY=!1,this.unpackAlignment=1}}const gT=new Os,vT=new Os;class Qy{constructor(o=[],g=[]){this.uuid=Es(),this.bones=o.slice(0),this.boneInverses=g,this.boneMatrices=null,this.boneTexture=null,this.boneTextureSize=0,this.frame=-1,this.init()}init(){const o=this.bones,g=this.boneInverses;if(this.boneMatrices=new Float32Array(16*o.length),g.length===0)this.calculateInverses();else if(o.length!==g.length){console.warn("THREE.Skeleton: Number of inverse bone matrices does not match amount of bones."),this.boneInverses=[];for(let $=0,_e=this.bones.length;$<_e;$++)this.boneInverses.push(new Os)}}calculateInverses(){this.boneInverses.length=0;for(let o=0,g=this.bones.length;o<g;o++){const $=new Os;this.bones[o]&&$.copy(this.bones[o].matrixWorld).invert(),this.boneInverses.push($)}}pose(){for(let o=0,g=this.bones.length;o<g;o++){const $=this.bones[o];$&&$.matrixWorld.copy(this.boneInverses[o]).invert()}for(let o=0,g=this.bones.length;o<g;o++){const $=this.bones[o];$&&($.parent&&$.parent.isBone?($.matrix.copy($.parent.matrixWorld).invert(),$.matrix.multiply($.matrixWorld)):$.matrix.copy($.matrixWorld),$.matrix.decompose($.position,$.quaternion,$.scale))}}update(){const o=this.bones,g=this.boneInverses,$=this.boneMatrices,_e=this.boneTexture;for(let rt=0,at=o.length;rt<at;rt++){const ct=o[rt]?o[rt].matrixWorld:vT;gT.multiplyMatrices(ct,g[rt]),gT.toArray($,16*rt)}_e!==null&&(_e.needsUpdate=!0)}clone(){return new Qy(this.bones,this.boneInverses)}computeBoneTexture(){let o=Math.sqrt(4*this.bones.length);o=Tv(o),o=Math.max(o,4);const g=new Float32Array(o*o*4);g.set(this.boneMatrices);const $=new Vy(g,o,o,Hu,Wl);return $.needsUpdate=!0,this.boneMatrices=g,this.boneTexture=$,this.boneTextureSize=o,this}getBoneByName(o){for(let g=0,$=this.bones.length;g<$;g++){const _e=this.bones[g];if(_e.name===o)return _e}}dispose(){this.boneTexture!==null&&(this.boneTexture.dispose(),this.boneTexture=null)}fromJSON(o,g){this.uuid=o.uuid;for(let $=0,_e=o.bones.length;$<_e;$++){const rt=o.bones[$];let at=g[rt];at===void 0&&(console.warn("THREE.Skeleton: No bone found with UUID:",rt),at=new E_),this.bones.push(at),this.boneInverses.push(new Os().fromArray(o.boneInverses[$]))}return this.init(),this}toJSON(){const o={metadata:{version:4.5,type:"Skeleton",generator:"Skeleton.toJSON"},bones:[],boneInverses:[]};o.uuid=this.uuid;const g=this.bones,$=this.boneInverses;for(let _e=0,rt=g.length;_e<rt;_e++){const at=g[_e];o.bones.push(at.uuid);const ct=$[_e];o.boneInverses.push(ct.toArray())}return o}}class LA extends Ro{constructor(o,g,$,_e=1){super(o,g,$),this.isInstancedBufferAttribute=!0,this.meshPerAttribute=_e}copy(o){return super.copy(o),this.meshPerAttribute=o.meshPerAttribute,this}toJSON(){const o=super.toJSON();return o.meshPerAttribute=this.meshPerAttribute,o.isInstancedBufferAttribute=!0,o}}const _T=new Os,AT=new Os,fx=[],Gy=new Zl;class hC extends Zl{constructor(o,g,$){super(o,g),this.isInstancedMesh=!0,this.instanceMatrix=new LA(new Float32Array(16*$),16),this.instanceColor=null,this.count=$,this.frustumCulled=!1}copy(o,g){return super.copy(o,g),this.instanceMatrix.copy(o.instanceMatrix),o.instanceColor!==null&&(this.instanceColor=o.instanceColor.clone()),this.count=o.count,this}getColorAt(o,g){g.fromArray(this.instanceColor.array,3*o)}getMatrixAt(o,g){g.fromArray(this.instanceMatrix.array,16*o)}raycast(o,g){const $=this.matrixWorld,_e=this.count;if(Gy.geometry=this.geometry,Gy.material=this.material,Gy.material!==void 0)for(let rt=0;rt<_e;rt++){this.getMatrixAt(rt,_T),AT.multiplyMatrices($,_T),Gy.matrixWorld=AT,Gy.raycast(o,fx);for(let at=0,ct=fx.length;at<ct;at++){const ft=fx[at];ft.instanceId=rt,ft.object=this,g.push(ft)}fx.length=0}}setColorAt(o,g){this.instanceColor===null&&(this.instanceColor=new LA(new Float32Array(3*this.instanceMatrix.count),3)),g.toArray(this.instanceColor.array,3*o)}setMatrixAt(o,g){g.toArray(this.instanceMatrix.array,16*o)}updateMorphTargets(){}dispose(){this.dispatchEvent({type:"dispose"})}}class Ju extends Fl{constructor(o){super(),this.isLineBasicMaterial=!0,this.type="LineBasicMaterial",this.color=new rs(16777215),this.linewidth=1,this.linecap="round",this.linejoin="round",this.fog=!0,this.setValues(o)}copy(o){return super.copy(o),this.color.copy(o.color),this.linewidth=o.linewidth,this.linecap=o.linecap,this.linejoin=o.linejoin,this.fog=o.fog,this}}const dC=new fn,yT=new fn,pC=new Os,fC=new _0,Hy=new Bv;class S_ extends no{constructor(o=new fs,g=new Ju){super(),this.isLine=!0,this.type="Line",this.geometry=o,this.material=g,this.updateMorphTargets()}copy(o,g){return super.copy(o,g),this.material=o.material,this.geometry=o.geometry,this}computeLineDistances(){const o=this.geometry;if(o.index===null){const g=o.attributes.position,$=[0];for(let _e=1,rt=g.count;_e<rt;_e++)dC.fromBufferAttribute(g,_e-1),yT.fromBufferAttribute(g,_e),$[_e]=$[_e-1],$[_e]+=dC.distanceTo(yT);o.setAttribute("lineDistance",new ht($,1))}else console.warn("THREE.Line.computeLineDistances(): Computation only possible with non-indexed BufferGeometry.");return this}raycast(o,g){const $=this.geometry,_e=this.matrixWorld,rt=o.params.Line.threshold,at=$.drawRange;if($.boundingSphere===null&&$.computeBoundingSphere(),Hy.copy($.boundingSphere),Hy.applyMatrix4(_e),Hy.radius+=rt,o.ray.intersectsSphere(Hy)===!1)return;pC.copy(_e).invert(),fC.copy(o.ray).applyMatrix4(pC);const ct=rt/((this.scale.x+this.scale.y+this.scale.z)/3),ft=ct*ct,mt=new fn,bt=new fn,Tt=new fn,St=new fn,It=this.isLineSegments?2:1,Rt=$.index,Dt=$.attributes.position;if(Rt!==null)for(let Ft=Math.max(0,at.start),Nt=Math.min(Rt.count,at.start+at.count)-1;Ft<Nt;Ft+=It){const zt=Rt.getX(Ft),Xt=Rt.getX(Ft+1);if(mt.fromBufferAttribute(Dt,zt),bt.fromBufferAttribute(Dt,Xt),fC.distanceSqToSegment(mt,bt,St,Tt)>ft)continue;St.applyMatrix4(this.matrixWorld);const tn=o.ray.origin.distanceTo(St);tn<o.near||tn>o.far||g.push({distance:tn,point:Tt.clone().applyMatrix4(this.matrixWorld),index:Ft,face:null,faceIndex:null,object:this})}else for(let Ft=Math.max(0,at.start),Nt=Math.min(Dt.count,at.start+at.count)-1;Ft<Nt;Ft+=It){if(mt.fromBufferAttribute(Dt,Ft),bt.fromBufferAttribute(Dt,Ft+1),fC.distanceSqToSegment(mt,bt,St,Tt)>ft)continue;St.applyMatrix4(this.matrixWorld);const zt=o.ray.origin.distanceTo(St);zt<o.near||zt>o.far||g.push({distance:zt,point:Tt.clone().applyMatrix4(this.matrixWorld),index:Ft,face:null,faceIndex:null,object:this})}}updateMorphTargets(){const o=this.geometry.morphAttributes,g=Object.keys(o);if(g.length>0){const $=o[g[0]];if($!==void 0){this.morphTargetInfluences=[],this.morphTargetDictionary={};for(let _e=0,rt=$.length;_e<rt;_e++){const at=$[_e].name||String(_e);this.morphTargetInfluences.push(0),this.morphTargetDictionary[at]=_e}}}}}const lE=new fn,mC=new fn;class _g extends S_{constructor(o,g){super(o,g),this.isLineSegments=!0,this.type="LineSegments"}computeLineDistances(){const o=this.geometry;if(o.index===null){const g=o.attributes.position,$=[];for(let _e=0,rt=g.count;_e<rt;_e+=2)lE.fromBufferAttribute(g,_e),mC.fromBufferAttribute(g,_e+1),$[_e]=_e===0?0:$[_e-1],$[_e+1]=$[_e]+lE.distanceTo(mC);o.setAttribute("lineDistance",new ht($,1))}else console.warn("THREE.LineSegments.computeLineDistances(): Computation only possible with non-indexed BufferGeometry.");return this}}class wT extends S_{constructor(o,g){super(o,g),this.isLineLoop=!0,this.type="LineLoop"}}class cE extends Fl{constructor(o){super(),this.isPointsMaterial=!0,this.type="PointsMaterial",this.color=new rs(16777215),this.map=null,this.alphaMap=null,this.size=1,this.sizeAttenuation=!0,this.fog=!0,this.setValues(o)}copy(o){return super.copy(o),this.color.copy(o.color),this.map=o.map,this.alphaMap=o.alphaMap,this.size=o.size,this.sizeAttenuation=o.sizeAttenuation,this.fog=o.fog,this}}const uE=new Os,gC=new _0,Wy=new Bv,hE=new fn;class qy extends no{constructor(o=new fs,g=new cE){super(),this.isPoints=!0,this.type="Points",this.geometry=o,this.material=g,this.updateMorphTargets()}copy(o,g){return super.copy(o,g),this.material=o.material,this.geometry=o.geometry,this}raycast(o,g){const $=this.geometry,_e=this.matrixWorld,rt=o.params.Points.threshold,at=$.drawRange;if($.boundingSphere===null&&$.computeBoundingSphere(),Wy.copy($.boundingSphere),Wy.applyMatrix4(_e),Wy.radius+=rt,o.ray.intersectsSphere(Wy)===!1)return;uE.copy(_e).invert(),gC.copy(o.ray).applyMatrix4(uE);const ct=rt/((this.scale.x+this.scale.y+this.scale.z)/3),ft=ct*ct,mt=$.index,bt=$.attributes.position;if(mt!==null)for(let Tt=Math.max(0,at.start),St=Math.min(mt.count,at.start+at.count);Tt<St;Tt++){const It=mt.getX(Tt);hE.fromBufferAttribute(bt,It),vC(hE,It,ft,_e,o,g,this)}else for(let Tt=Math.max(0,at.start),St=Math.min(bt.count,at.start+at.count);Tt<St;Tt++)hE.fromBufferAttribute(bt,Tt),vC(hE,Tt,ft,_e,o,g,this)}updateMorphTargets(){const o=this.geometry.morphAttributes,g=Object.keys(o);if(g.length>0){const $=o[g[0]];if($!==void 0){this.morphTargetInfluences=[],this.morphTargetDictionary={};for(let _e=0,rt=$.length;_e<rt;_e++){const at=$[_e].name||String(_e);this.morphTargetInfluences.push(0),this.morphTargetDictionary[at]=_e}}}}}function vC(dt,o,g,$,_e,rt,at){const ct=gC.distanceSqToPoint(dt);if(ct<g){const ft=new fn;gC.closestPointToPoint(dt,ft),ft.applyMatrix4($);const mt=_e.ray.origin.distanceTo(ft);if(mt<_e.near||mt>_e.far)return;rt.push({distance:mt,distanceToRay:Math.sqrt(ct),point:ft,index:o,face:null,object:at})}}class xT extends qo{constructor(o,g,$,_e,rt,at,ct,ft,mt){super(o,g,$,_e,rt,at,ct,ft,mt),this.isVideoTexture=!0,this.minFilter=at!==void 0?at:xa,this.magFilter=rt!==void 0?rt:xa,this.generateMipmaps=!1;const bt=this;"requestVideoFrameCallback"in o&&o.requestVideoFrameCallback(function Tt(){bt.needsUpdate=!0,o.requestVideoFrameCallback(Tt)})}clone(){return new this.constructor(this.image).copy(this)}update(){const o=this.image;!("requestVideoFrameCallback"in o)&&o.readyState>=o.HAVE_CURRENT_DATA&&(this.needsUpdate=!0)}}class bT extends qo{constructor(o,g,$){super({width:o,height:g}),this.isFramebufferTexture=!0,this.format=$,this.magFilter=na,this.minFilter=na,this.generateMipmaps=!1,this.needsUpdate=!0}}class ET extends qo{constructor(o,g,$,_e,rt,at,ct,ft,mt,bt,Tt,St){super(null,at,ct,ft,mt,bt,_e,rt,Tt,St),this.isCompressedTexture=!0,this.image={width:g,height:$},this.mipmaps=o,this.flipY=!1,this.generateMipmaps=!1}}class ST extends qo{constructor(o,g,$,_e,rt,at,ct,ft,mt){super(o,g,$,_e,rt,at,ct,ft,mt),this.isCanvasTexture=!0,this.needsUpdate=!0}}class Hp{constructor(){this.type="Curve",this.arcLengthDivisions=200}getPoint(){return console.warn("THREE.Curve: .getPoint() not implemented."),null}getPointAt(o,g){const $=this.getUtoTmapping(o);return this.getPoint($,g)}getPoints(o=5){const g=[];for(let $=0;$<=o;$++)g.push(this.getPoint($/o));return g}getSpacedPoints(o=5){const g=[];for(let $=0;$<=o;$++)g.push(this.getPointAt($/o));return g}getLength(){const o=this.getLengths();return o[o.length-1]}getLengths(o=this.arcLengthDivisions){if(this.cacheArcLengths&&this.cacheArcLengths.length===o+1&&!this.needsUpdate)return this.cacheArcLengths;this.needsUpdate=!1;const g=[];let $,_e=this.getPoint(0),rt=0;g.push(0);for(let at=1;at<=o;at++)$=this.getPoint(at/o),rt+=$.distanceTo(_e),g.push(rt),_e=$;return this.cacheArcLengths=g,g}updateArcLengths(){this.needsUpdate=!0,this.getLengths()}getUtoTmapping(o,g){const $=this.getLengths();let _e=0;const rt=$.length;let at;at=g||o*$[rt-1];let ct,ft=0,mt=rt-1;for(;ft<=mt;)if(_e=Math.floor(ft+(mt-ft)/2),ct=$[_e]-at,ct<0)ft=_e+1;else{if(!(ct>0)){mt=_e;break}mt=_e-1}if(_e=mt,$[_e]===at)return _e/(rt-1);const bt=$[_e];return(_e+(at-bt)/($[_e+1]-bt))/(rt-1)}getTangent(o,g){let _e=o-1e-4,rt=o+1e-4;_e<0&&(_e=0),rt>1&&(rt=1);const at=this.getPoint(_e),ct=this.getPoint(rt),ft=g||(at.isVector2?new Sr:new fn);return ft.copy(ct).sub(at).normalize(),ft}getTangentAt(o,g){const $=this.getUtoTmapping(o);return this.getTangent($,g)}computeFrenetFrames(o,g){const $=new fn,_e=[],rt=[],at=[],ct=new fn,ft=new Os;for(let It=0;It<=o;It++){const Rt=It/o;_e[It]=this.getTangentAt(Rt,new fn)}rt[0]=new fn,at[0]=new fn;let mt=Number.MAX_VALUE;const bt=Math.abs(_e[0].x),Tt=Math.abs(_e[0].y),St=Math.abs(_e[0].z);bt<=mt&&(mt=bt,$.set(1,0,0)),Tt<=mt&&(mt=Tt,$.set(0,1,0)),St<=mt&&$.set(0,0,1),ct.crossVectors(_e[0],$).normalize(),rt[0].crossVectors(_e[0],ct),at[0].crossVectors(_e[0],rt[0]);for(let It=1;It<=o;It++){if(rt[It]=rt[It-1].clone(),at[It]=at[It-1].clone(),ct.crossVectors(_e[It-1],_e[It]),ct.length()>Number.EPSILON){ct.normalize();const Rt=Math.acos(As(_e[It-1].dot(_e[It]),-1,1));rt[It].applyMatrix4(ft.makeRotationAxis(ct,Rt))}at[It].crossVectors(_e[It],rt[It])}if(g===!0){let It=Math.acos(As(rt[0].dot(rt[o]),-1,1));It/=o,_e[0].dot(ct.crossVectors(rt[0],rt[o]))>0&&(It=-It);for(let Rt=1;Rt<=o;Rt++)rt[Rt].applyMatrix4(ft.makeRotationAxis(_e[Rt],It*Rt)),at[Rt].crossVectors(_e[Rt],rt[Rt])}return{tangents:_e,normals:rt,binormals:at}}clone(){return new this.constructor().copy(this)}copy(o){return this.arcLengthDivisions=o.arcLengthDivisions,this}toJSON(){const o={metadata:{version:4.5,type:"Curve",generator:"Curve.toJSON"}};return o.arcLengthDivisions=this.arcLengthDivisions,o.type=this.type,o}fromJSON(o){return this.arcLengthDivisions=o.arcLengthDivisions,this}}class C_ extends Hp{constructor(o=0,g=0,$=1,_e=1,rt=0,at=2*Math.PI,ct=!1,ft=0){super(),this.isEllipseCurve=!0,this.type="EllipseCurve",this.aX=o,this.aY=g,this.xRadius=$,this.yRadius=_e,this.aStartAngle=rt,this.aEndAngle=at,this.aClockwise=ct,this.aRotation=ft}getPoint(o,g){const $=g||new Sr,_e=2*Math.PI;let rt=this.aEndAngle-this.aStartAngle;const at=Math.abs(rt)<Number.EPSILON;for(;rt<0;)rt+=_e;for(;rt>_e;)rt-=_e;rt<Number.EPSILON&&(rt=at?0:_e),this.aClockwise!==!0||at||(rt===_e?rt=-_e:rt-=_e);const ct=this.aStartAngle+o*rt;let ft=this.aX+this.xRadius*Math.cos(ct),mt=this.aY+this.yRadius*Math.sin(ct);if(this.aRotation!==0){const bt=Math.cos(this.aRotation),Tt=Math.sin(this.aRotation),St=ft-this.aX,It=mt-this.aY;ft=St*bt-It*Tt+this.aX,mt=St*Tt+It*bt+this.aY}return $.set(ft,mt)}copy(o){return super.copy(o),this.aX=o.aX,this.aY=o.aY,this.xRadius=o.xRadius,this.yRadius=o.yRadius,this.aStartAngle=o.aStartAngle,this.aEndAngle=o.aEndAngle,this.aClockwise=o.aClockwise,this.aRotation=o.aRotation,this}toJSON(){const o=super.toJSON();return o.aX=this.aX,o.aY=this.aY,o.xRadius=this.xRadius,o.yRadius=this.yRadius,o.aStartAngle=this.aStartAngle,o.aEndAngle=this.aEndAngle,o.aClockwise=this.aClockwise,o.aRotation=this.aRotation,o}fromJSON(o){return super.fromJSON(o),this.aX=o.aX,this.aY=o.aY,this.xRadius=o.xRadius,this.yRadius=o.yRadius,this.aStartAngle=o.aStartAngle,this.aEndAngle=o.aEndAngle,this.aClockwise=o.aClockwise,this.aRotation=o.aRotation,this}}class dE extends C_{constructor(o,g,$,_e,rt,at){super(o,g,$,$,_e,rt,at),this.isArcCurve=!0,this.type="ArcCurve"}}function NA(){let dt=0,o=0,g=0,$=0;function _e(rt,at,ct,ft){dt=rt,o=ct,g=-3*rt+3*at-2*ct-ft,$=2*rt-2*at+ct+ft}return{initCatmullRom:function(rt,at,ct,ft,mt){_e(at,ct,mt*(ct-rt),mt*(ft-at))},initNonuniformCatmullRom:function(rt,at,ct,ft,mt,bt,Tt){let St=(at-rt)/mt-(ct-rt)/(mt+bt)+(ct-at)/bt,It=(ct-at)/bt-(ft-at)/(bt+Tt)+(ft-ct)/Tt;St*=bt,It*=bt,_e(at,ct,St,It)},calc:function(rt){const at=rt*rt;return dt+o*rt+g*at+$*(at*rt)}}}const UA=new fn,mx=new NA,_C=new NA,AC=new NA;class CT extends Hp{constructor(o=[],g=!1,$="centripetal",_e=.5){super(),this.isCatmullRomCurve3=!0,this.type="CatmullRomCurve3",this.points=o,this.closed=g,this.curveType=$,this.tension=_e}getPoint(o,g=new fn){const $=g,_e=this.points,rt=_e.length,at=(rt-(this.closed?0:1))*o;let ct,ft,mt=Math.floor(at),bt=at-mt;this.closed?mt+=mt>0?0:(Math.floor(Math.abs(mt)/rt)+1)*rt:bt===0&&mt===rt-1&&(mt=rt-2,bt=1),this.closed||mt>0?ct=_e[(mt-1)%rt]:(UA.subVectors(_e[0],_e[1]).add(_e[0]),ct=UA);const Tt=_e[mt%rt],St=_e[(mt+1)%rt];if(this.closed||mt+2<rt?ft=_e[(mt+2)%rt]:(UA.subVectors(_e[rt-1],_e[rt-2]).add(_e[rt-1]),ft=UA),this.curveType==="centripetal"||this.curveType==="chordal"){const It=this.curveType==="chordal"?.5:.25;let Rt=Math.pow(ct.distanceToSquared(Tt),It),Dt=Math.pow(Tt.distanceToSquared(St),It),Ft=Math.pow(St.distanceToSquared(ft),It);Dt<1e-4&&(Dt=1),Rt<1e-4&&(Rt=Dt),Ft<1e-4&&(Ft=Dt),mx.initNonuniformCatmullRom(ct.x,Tt.x,St.x,ft.x,Rt,Dt,Ft),_C.initNonuniformCatmullRom(ct.y,Tt.y,St.y,ft.y,Rt,Dt,Ft),AC.initNonuniformCatmullRom(ct.z,Tt.z,St.z,ft.z,Rt,Dt,Ft)}else this.curveType==="catmullrom"&&(mx.initCatmullRom(ct.x,Tt.x,St.x,ft.x,this.tension),_C.initCatmullRom(ct.y,Tt.y,St.y,ft.y,this.tension),AC.initCatmullRom(ct.z,Tt.z,St.z,ft.z,this.tension));return $.set(mx.calc(bt),_C.calc(bt),AC.calc(bt)),$}copy(o){super.copy(o),this.points=[];for(let g=0,$=o.points.length;g<$;g++){const _e=o.points[g];this.points.push(_e.clone())}return this.closed=o.closed,this.curveType=o.curveType,this.tension=o.tension,this}toJSON(){const o=super.toJSON();o.points=[];for(let g=0,$=this.points.length;g<$;g++){const _e=this.points[g];o.points.push(_e.toArray())}return o.closed=this.closed,o.curveType=this.curveType,o.tension=this.tension,o}fromJSON(o){super.fromJSON(o),this.points=[];for(let g=0,$=o.points.length;g<$;g++){const _e=o.points[g];this.points.push(new fn().fromArray(_e))}return this.closed=o.closed,this.curveType=o.curveType,this.tension=o.tension,this}}function yC(dt,o,g,$,_e){const rt=.5*($-o),at=.5*(_e-g),ct=dt*dt;return(2*g-2*$+rt+at)*(dt*ct)+(-3*g+3*$-2*rt-at)*ct+rt*dt+g}function gx(dt,o,g,$){return function(_e,rt){const at=1-_e;return at*at*rt}(dt,o)+function(_e,rt){return 2*(1-_e)*_e*rt}(dt,g)+function(_e,rt){return _e*_e*rt}(dt,$)}function Yy(dt,o,g,$,_e){return function(rt,at){const ct=1-rt;return ct*ct*ct*at}(dt,o)+function(rt,at){const ct=1-rt;return 3*ct*ct*rt*at}(dt,g)+function(rt,at){return 3*(1-rt)*rt*rt*at}(dt,$)+function(rt,at){return rt*rt*rt*at}(dt,_e)}class wC extends Hp{constructor(o=new Sr,g=new Sr,$=new Sr,_e=new Sr){super(),this.isCubicBezierCurve=!0,this.type="CubicBezierCurve",this.v0=o,this.v1=g,this.v2=$,this.v3=_e}getPoint(o,g=new Sr){const $=g,_e=this.v0,rt=this.v1,at=this.v2,ct=this.v3;return $.set(Yy(o,_e.x,rt.x,at.x,ct.x),Yy(o,_e.y,rt.y,at.y,ct.y)),$}copy(o){return super.copy(o),this.v0.copy(o.v0),this.v1.copy(o.v1),this.v2.copy(o.v2),this.v3.copy(o.v3),this}toJSON(){const o=super.toJSON();return o.v0=this.v0.toArray(),o.v1=this.v1.toArray(),o.v2=this.v2.toArray(),o.v3=this.v3.toArray(),o}fromJSON(o){return super.fromJSON(o),this.v0.fromArray(o.v0),this.v1.fromArray(o.v1),this.v2.fromArray(o.v2),this.v3.fromArray(o.v3),this}}class xC extends Hp{constructor(o=new fn,g=new fn,$=new fn,_e=new fn){super(),this.isCubicBezierCurve3=!0,this.type="CubicBezierCurve3",this.v0=o,this.v1=g,this.v2=$,this.v3=_e}getPoint(o,g=new fn){const $=g,_e=this.v0,rt=this.v1,at=this.v2,ct=this.v3;return $.set(Yy(o,_e.x,rt.x,at.x,ct.x),Yy(o,_e.y,rt.y,at.y,ct.y),Yy(o,_e.z,rt.z,at.z,ct.z)),$}copy(o){return super.copy(o),this.v0.copy(o.v0),this.v1.copy(o.v1),this.v2.copy(o.v2),this.v3.copy(o.v3),this}toJSON(){const o=super.toJSON();return o.v0=this.v0.toArray(),o.v1=this.v1.toArray(),o.v2=this.v2.toArray(),o.v3=this.v3.toArray(),o}fromJSON(o){return super.fromJSON(o),this.v0.fromArray(o.v0),this.v1.fromArray(o.v1),this.v2.fromArray(o.v2),this.v3.fromArray(o.v3),this}}class pE extends Hp{constructor(o=new Sr,g=new Sr){super(),this.isLineCurve=!0,this.type="LineCurve",this.v1=o,this.v2=g}getPoint(o,g=new Sr){const $=g;return o===1?$.copy(this.v2):($.copy(this.v2).sub(this.v1),$.multiplyScalar(o).add(this.v1)),$}getPointAt(o,g){return this.getPoint(o,g)}getTangent(o,g){const $=g||new Sr;return $.copy(this.v2).sub(this.v1).normalize(),$}copy(o){return super.copy(o),this.v1.copy(o.v1),this.v2.copy(o.v2),this}toJSON(){const o=super.toJSON();return o.v1=this.v1.toArray(),o.v2=this.v2.toArray(),o}fromJSON(o){return super.fromJSON(o),this.v1.fromArray(o.v1),this.v2.fromArray(o.v2),this}}class Xy extends Hp{constructor(o=new fn,g=new fn){super(),this.isLineCurve3=!0,this.type="LineCurve3",this.v1=o,this.v2=g}getPoint(o,g=new fn){const $=g;return o===1?$.copy(this.v2):($.copy(this.v2).sub(this.v1),$.multiplyScalar(o).add(this.v1)),$}getPointAt(o,g){return this.getPoint(o,g)}copy(o){return super.copy(o),this.v1.copy(o.v1),this.v2.copy(o.v2),this}toJSON(){const o=super.toJSON();return o.v1=this.v1.toArray(),o.v2=this.v2.toArray(),o}fromJSON(o){return super.fromJSON(o),this.v1.fromArray(o.v1),this.v2.fromArray(o.v2),this}}class vx extends Hp{constructor(o=new Sr,g=new Sr,$=new Sr){super(),this.isQuadraticBezierCurve=!0,this.type="QuadraticBezierCurve",this.v0=o,this.v1=g,this.v2=$}getPoint(o,g=new Sr){const $=g,_e=this.v0,rt=this.v1,at=this.v2;return $.set(gx(o,_e.x,rt.x,at.x),gx(o,_e.y,rt.y,at.y)),$}copy(o){return super.copy(o),this.v0.copy(o.v0),this.v1.copy(o.v1),this.v2.copy(o.v2),this}toJSON(){const o=super.toJSON();return o.v0=this.v0.toArray(),o.v1=this.v1.toArray(),o.v2=this.v2.toArray(),o}fromJSON(o){return super.fromJSON(o),this.v0.fromArray(o.v0),this.v1.fromArray(o.v1),this.v2.fromArray(o.v2),this}}class Vl extends Hp{constructor(o=new fn,g=new fn,$=new fn){super(),this.isQuadraticBezierCurve3=!0,this.type="QuadraticBezierCurve3",this.v0=o,this.v1=g,this.v2=$}getPoint(o,g=new fn){const $=g,_e=this.v0,rt=this.v1,at=this.v2;return $.set(gx(o,_e.x,rt.x,at.x),gx(o,_e.y,rt.y,at.y),gx(o,_e.z,rt.z,at.z)),$}copy(o){return super.copy(o),this.v0.copy(o.v0),this.v1.copy(o.v1),this.v2.copy(o.v2),this}toJSON(){const o=super.toJSON();return o.v0=this.v0.toArray(),o.v1=this.v1.toArray(),o.v2=this.v2.toArray(),o}fromJSON(o){return super.fromJSON(o),this.v0.fromArray(o.v0),this.v1.fromArray(o.v1),this.v2.fromArray(o.v2),this}}class _x extends Hp{constructor(o=[]){super(),this.isSplineCurve=!0,this.type="SplineCurve",this.points=o}getPoint(o,g=new Sr){const $=g,_e=this.points,rt=(_e.length-1)*o,at=Math.floor(rt),ct=rt-at,ft=_e[at===0?at:at-1],mt=_e[at],bt=_e[at>_e.length-2?_e.length-1:at+1],Tt=_e[at>_e.length-3?_e.length-1:at+2];return $.set(yC(ct,ft.x,mt.x,bt.x,Tt.x),yC(ct,ft.y,mt.y,bt.y,Tt.y)),$}copy(o){super.copy(o),this.points=[];for(let g=0,$=o.points.length;g<$;g++){const _e=o.points[g];this.points.push(_e.clone())}return this}toJSON(){const o=super.toJSON();o.points=[];for(let g=0,$=this.points.length;g<$;g++){const _e=this.points[g];o.points.push(_e.toArray())}return o}fromJSON(o){super.fromJSON(o),this.points=[];for(let g=0,$=o.points.length;g<$;g++){const _e=o.points[g];this.points.push(new Sr().fromArray(_e))}return this}}var fE=Object.freeze({__proto__:null,ArcCurve:dE,CatmullRomCurve3:CT,CubicBezierCurve:wC,CubicBezierCurve3:xC,EllipseCurve:C_,LineCurve:pE,LineCurve3:Xy,QuadraticBezierCurve:vx,QuadraticBezierCurve3:Vl,SplineCurve:_x});class mE extends Hp{constructor(){super(),this.type="CurvePath",this.curves=[],this.autoClose=!1}add(o){this.curves.push(o)}closePath(){const o=this.curves[0].getPoint(0),g=this.curves[this.curves.length-1].getPoint(1);o.equals(g)||this.curves.push(new pE(g,o))}getPoint(o,g){const $=o*this.getLength(),_e=this.getCurveLengths();let rt=0;for(;rt<_e.length;){if(_e[rt]>=$){const at=_e[rt]-$,ct=this.curves[rt],ft=ct.getLength(),mt=ft===0?0:1-at/ft;return ct.getPointAt(mt,g)}rt++}return null}getLength(){const o=this.getCurveLengths();return o[o.length-1]}updateArcLengths(){this.needsUpdate=!0,this.cacheLengths=null,this.getCurveLengths()}getCurveLengths(){if(this.cacheLengths&&this.cacheLengths.length===this.curves.length)return this.cacheLengths;const o=[];let g=0;for(let $=0,_e=this.curves.length;$<_e;$++)g+=this.curves[$].getLength(),o.push(g);return this.cacheLengths=o,o}getSpacedPoints(o=40){const g=[];for(let $=0;$<=o;$++)g.push(this.getPoint($/o));return this.autoClose&&g.push(g[0]),g}getPoints(o=12){const g=[];let $;for(let _e=0,rt=this.curves;_e<rt.length;_e++){const at=rt[_e],ct=at.isEllipseCurve?2*o:at.isLineCurve||at.isLineCurve3?1:at.isSplineCurve?o*at.points.length:o,ft=at.getPoints(ct);for(let mt=0;mt<ft.length;mt++){const bt=ft[mt];$&&$.equals(bt)||(g.push(bt),$=bt)}}return this.autoClose&&g.length>1&&!g[g.length-1].equals(g[0])&&g.push(g[0]),g}copy(o){super.copy(o),this.curves=[];for(let g=0,$=o.curves.length;g<$;g++){const _e=o.curves[g];this.curves.push(_e.clone())}return this.autoClose=o.autoClose,this}toJSON(){const o=super.toJSON();o.autoClose=this.autoClose,o.curves=[];for(let g=0,$=this.curves.length;g<$;g++){const _e=this.curves[g];o.curves.push(_e.toJSON())}return o}fromJSON(o){super.fromJSON(o),this.autoClose=o.autoClose,this.curves=[];for(let g=0,$=o.curves.length;g<$;g++){const _e=o.curves[g];this.curves.push(new fE[_e.type]().fromJSON(_e))}return this}}class Ky extends mE{constructor(o){super(),this.type="Path",this.currentPoint=new Sr,o&&this.setFromPoints(o)}setFromPoints(o){this.moveTo(o[0].x,o[0].y);for(let g=1,$=o.length;g<$;g++)this.lineTo(o[g].x,o[g].y);return this}moveTo(o,g){return this.currentPoint.set(o,g),this}lineTo(o,g){const $=new pE(this.currentPoint.clone(),new Sr(o,g));return this.curves.push($),this.currentPoint.set(o,g),this}quadraticCurveTo(o,g,$,_e){const rt=new vx(this.currentPoint.clone(),new Sr(o,g),new Sr($,_e));return this.curves.push(rt),this.currentPoint.set($,_e),this}bezierCurveTo(o,g,$,_e,rt,at){const ct=new wC(this.currentPoint.clone(),new Sr(o,g),new Sr($,_e),new Sr(rt,at));return this.curves.push(ct),this.currentPoint.set(rt,at),this}splineThru(o){const g=[this.currentPoint.clone()].concat(o),$=new _x(g);return this.curves.push($),this.currentPoint.copy(o[o.length-1]),this}arc(o,g,$,_e,rt,at){const ct=this.currentPoint.x,ft=this.currentPoint.y;return this.absarc(o+ct,g+ft,$,_e,rt,at),this}absarc(o,g,$,_e,rt,at){return this.absellipse(o,g,$,$,_e,rt,at),this}ellipse(o,g,$,_e,rt,at,ct,ft){const mt=this.currentPoint.x,bt=this.currentPoint.y;return this.absellipse(o+mt,g+bt,$,_e,rt,at,ct,ft),this}absellipse(o,g,$,_e,rt,at,ct,ft){const mt=new C_(o,g,$,_e,rt,at,ct,ft);if(this.curves.length>0){const Tt=mt.getPoint(0);Tt.equals(this.currentPoint)||this.lineTo(Tt.x,Tt.y)}this.curves.push(mt);const bt=mt.getPoint(1);return this.currentPoint.copy(bt),this}copy(o){return super.copy(o),this.currentPoint.copy(o.currentPoint),this}toJSON(){const o=super.toJSON();return o.currentPoint=this.currentPoint.toArray(),o}fromJSON(o){return super.fromJSON(o),this.currentPoint.fromArray(o.currentPoint),this}}class Vv extends fs{constructor(o=[new Sr(0,-.5),new Sr(.5,0),new Sr(0,.5)],g=12,$=0,_e=2*Math.PI){super(),this.type="LatheGeometry",this.parameters={points:o,segments:g,phiStart:$,phiLength:_e},g=Math.floor(g),_e=As(_e,0,2*Math.PI);const rt=[],at=[],ct=[],ft=[],mt=[],bt=1/g,Tt=new fn,St=new Sr,It=new fn,Rt=new fn,Dt=new fn;let Ft=0,Nt=0;for(let zt=0;zt<=o.length-1;zt++)switch(zt){case 0:Ft=o[zt+1].x-o[zt].x,Nt=o[zt+1].y-o[zt].y,It.x=1*Nt,It.y=-Ft,It.z=0*Nt,Dt.copy(It),It.normalize(),ft.push(It.x,It.y,It.z);break;case o.length-1:ft.push(Dt.x,Dt.y,Dt.z);break;default:Ft=o[zt+1].x-o[zt].x,Nt=o[zt+1].y-o[zt].y,It.x=1*Nt,It.y=-Ft,It.z=0*Nt,Rt.copy(It),It.x+=Dt.x,It.y+=Dt.y,It.z+=Dt.z,It.normalize(),ft.push(It.x,It.y,It.z),Dt.copy(Rt)}for(let zt=0;zt<=g;zt++){const Xt=$+zt*bt*_e,tn=Math.sin(Xt),sn=Math.cos(Xt);for(let ln=0;ln<=o.length-1;ln++){Tt.x=o[ln].x*tn,Tt.y=o[ln].y,Tt.z=o[ln].x*sn,at.push(Tt.x,Tt.y,Tt.z),St.x=zt/g,St.y=ln/(o.length-1),ct.push(St.x,St.y);const kn=ft[3*ln+0]*tn,Ln=ft[3*ln+1],qn=ft[3*ln+0]*sn;mt.push(kn,Ln,qn)}}for(let zt=0;zt<g;zt++)for(let Xt=0;Xt<o.length-1;Xt++){const tn=Xt+zt*o.length,sn=tn,ln=tn+o.length,kn=tn+o.length+1,Ln=tn+1;rt.push(sn,ln,Ln),rt.push(kn,Ln,ln)}this.setIndex(rt),this.setAttribute("position",new ht(at,3)),this.setAttribute("uv",new ht(ct,2)),this.setAttribute("normal",new ht(mt,3))}static fromJSON(o){return new Vv(o.points,o.segments,o.phiStart,o.phiLength)}}class ev extends Vv{constructor(o=1,g=1,$=4,_e=8){const rt=new Ky;rt.absarc(0,-g/2,o,1.5*Math.PI,0),rt.absarc(0,g/2,o,0,.5*Math.PI),super(rt.getPoints($),_e),this.type="CapsuleGeometry",this.parameters={radius:o,height:g,capSegments:$,radialSegments:_e}}static fromJSON(o){return new ev(o.radius,o.length,o.capSegments,o.radialSegments)}}class Jy extends fs{constructor(o=1,g=8,$=0,_e=2*Math.PI){super(),this.type="CircleGeometry",this.parameters={radius:o,segments:g,thetaStart:$,thetaLength:_e},g=Math.max(3,g);const rt=[],at=[],ct=[],ft=[],mt=new fn,bt=new Sr;at.push(0,0,0),ct.push(0,0,1),ft.push(.5,.5);for(let Tt=0,St=3;Tt<=g;Tt++,St+=3){const It=$+Tt/g*_e;mt.x=o*Math.cos(It),mt.y=o*Math.sin(It),at.push(mt.x,mt.y,mt.z),ct.push(0,0,1),bt.x=(at[St]/o+1)/2,bt.y=(at[St+1]/o+1)/2,ft.push(bt.x,bt.y)}for(let Tt=1;Tt<=g;Tt++)rt.push(Tt,Tt+1,0);this.setIndex(rt),this.setAttribute("position",new ht(at,3)),this.setAttribute("normal",new ht(ct,3)),this.setAttribute("uv",new ht(ft,2))}static fromJSON(o){return new Jy(o.radius,o.segments,o.thetaStart,o.thetaLength)}}class FA extends fs{constructor(o=1,g=1,$=1,_e=8,rt=1,at=!1,ct=0,ft=2*Math.PI){super(),this.type="CylinderGeometry",this.parameters={radiusTop:o,radiusBottom:g,height:$,radialSegments:_e,heightSegments:rt,openEnded:at,thetaStart:ct,thetaLength:ft};const mt=this;_e=Math.floor(_e),rt=Math.floor(rt);const bt=[],Tt=[],St=[],It=[];let Rt=0;const Dt=[],Ft=$/2;let Nt=0;function zt(Xt){const tn=Rt,sn=new Sr,ln=new fn;let kn=0;const Ln=Xt===!0?o:g,qn=Xt===!0?1:-1;for(let On=1;On<=_e;On++)Tt.push(0,Ft*qn,0),St.push(0,qn,0),It.push(.5,.5),Rt++;const Kn=Rt;for(let On=0;On<=_e;On++){const _r=On/_e*ft+ct,Tr=Math.cos(_r),gr=Math.sin(_r);ln.x=Ln*gr,ln.y=Ft*qn,ln.z=Ln*Tr,Tt.push(ln.x,ln.y,ln.z),St.push(0,qn,0),sn.x=.5*Tr+.5,sn.y=.5*gr*qn+.5,It.push(sn.x,sn.y),Rt++}for(let On=0;On<_e;On++){const _r=tn+On,Tr=Kn+On;Xt===!0?bt.push(Tr,Tr+1,_r):bt.push(Tr+1,Tr,_r),kn+=3}mt.addGroup(Nt,kn,Xt===!0?1:2),Nt+=kn}(function(){const Xt=new fn,tn=new fn;let sn=0;const ln=(g-o)/$;for(let kn=0;kn<=rt;kn++){const Ln=[],qn=kn/rt,Kn=qn*(g-o)+o;for(let On=0;On<=_e;On++){const _r=On/_e,Tr=_r*ft+ct,gr=Math.sin(Tr),Or=Math.cos(Tr);tn.x=Kn*gr,tn.y=-qn*$+Ft,tn.z=Kn*Or,Tt.push(tn.x,tn.y,tn.z),Xt.set(gr,ln,Or).normalize(),St.push(Xt.x,Xt.y,Xt.z),It.push(_r,1-qn),Ln.push(Rt++)}Dt.push(Ln)}for(let kn=0;kn<_e;kn++)for(let Ln=0;Ln<rt;Ln++){const qn=Dt[Ln][kn],Kn=Dt[Ln+1][kn],On=Dt[Ln+1][kn+1],_r=Dt[Ln][kn+1];bt.push(qn,Kn,_r),bt.push(Kn,On,_r),sn+=6}mt.addGroup(Nt,sn,0),Nt+=sn})(),at===!1&&(o>0&&zt(!0),g>0&&zt(!1)),this.setIndex(bt),this.setAttribute("position",new ht(Tt,3)),this.setAttribute("normal",new ht(St,3)),this.setAttribute("uv",new ht(It,2))}static fromJSON(o){return new FA(o.radiusTop,o.radiusBottom,o.height,o.radialSegments,o.heightSegments,o.openEnded,o.thetaStart,o.thetaLength)}}class ro extends FA{constructor(o=1,g=1,$=8,_e=1,rt=!1,at=0,ct=2*Math.PI){super(0,o,g,$,_e,rt,at,ct),this.type="ConeGeometry",this.parameters={radius:o,height:g,radialSegments:$,heightSegments:_e,openEnded:rt,thetaStart:at,thetaLength:ct}}static fromJSON(o){return new ro(o.radius,o.height,o.radialSegments,o.heightSegments,o.openEnded,o.thetaStart,o.thetaLength)}}class Qv extends fs{constructor(o=[],g=[],$=1,_e=0){super(),this.type="PolyhedronGeometry",this.parameters={vertices:o,indices:g,radius:$,detail:_e};const rt=[],at=[];function ct(St,It,Rt,Dt){const Ft=Dt+1,Nt=[];for(let zt=0;zt<=Ft;zt++){Nt[zt]=[];const Xt=St.clone().lerp(Rt,zt/Ft),tn=It.clone().lerp(Rt,zt/Ft),sn=Ft-zt;for(let ln=0;ln<=sn;ln++)Nt[zt][ln]=ln===0&&zt===Ft?Xt:Xt.clone().lerp(tn,ln/sn)}for(let zt=0;zt<Ft;zt++)for(let Xt=0;Xt<2*(Ft-zt)-1;Xt++){const tn=Math.floor(Xt/2);Xt%2==0?(ft(Nt[zt][tn+1]),ft(Nt[zt+1][tn]),ft(Nt[zt][tn])):(ft(Nt[zt][tn+1]),ft(Nt[zt+1][tn+1]),ft(Nt[zt+1][tn]))}}function ft(St){rt.push(St.x,St.y,St.z)}function mt(St,It){const Rt=3*St;It.x=o[Rt+0],It.y=o[Rt+1],It.z=o[Rt+2]}function bt(St,It,Rt,Dt){Dt<0&&St.x===1&&(at[It]=St.x-1),Rt.x===0&&Rt.z===0&&(at[It]=Dt/2/Math.PI+.5)}function Tt(St){return Math.atan2(St.z,-St.x)}(function(St){const It=new fn,Rt=new fn,Dt=new fn;for(let Ft=0;Ft<g.length;Ft+=3)mt(g[Ft+0],It),mt(g[Ft+1],Rt),mt(g[Ft+2],Dt),ct(It,Rt,Dt,St)})(_e),function(St){const It=new fn;for(let Rt=0;Rt<rt.length;Rt+=3)It.x=rt[Rt+0],It.y=rt[Rt+1],It.z=rt[Rt+2],It.normalize().multiplyScalar(St),rt[Rt+0]=It.x,rt[Rt+1]=It.y,rt[Rt+2]=It.z}($),function(){const St=new fn;for(let Rt=0;Rt<rt.length;Rt+=3){St.x=rt[Rt+0],St.y=rt[Rt+1],St.z=rt[Rt+2];const Dt=Tt(St)/2/Math.PI+.5,Ft=(It=St,Math.atan2(-It.y,Math.sqrt(It.x*It.x+It.z*It.z))/Math.PI+.5);at.push(Dt,1-Ft)}var It;(function(){const Rt=new fn,Dt=new fn,Ft=new fn,Nt=new fn,zt=new Sr,Xt=new Sr,tn=new Sr;for(let sn=0,ln=0;sn<rt.length;sn+=9,ln+=6){Rt.set(rt[sn+0],rt[sn+1],rt[sn+2]),Dt.set(rt[sn+3],rt[sn+4],rt[sn+5]),Ft.set(rt[sn+6],rt[sn+7],rt[sn+8]),zt.set(at[ln+0],at[ln+1]),Xt.set(at[ln+2],at[ln+3]),tn.set(at[ln+4],at[ln+5]),Nt.copy(Rt).add(Dt).add(Ft).divideScalar(3);const kn=Tt(Nt);bt(zt,ln+0,Rt,kn),bt(Xt,ln+2,Dt,kn),bt(tn,ln+4,Ft,kn)}})(),function(){for(let Rt=0;Rt<at.length;Rt+=6){const Dt=at[Rt+0],Ft=at[Rt+2],Nt=at[Rt+4],zt=Math.max(Dt,Ft,Nt),Xt=Math.min(Dt,Ft,Nt);zt>.9&&Xt<.1&&(Dt<.2&&(at[Rt+0]+=1),Ft<.2&&(at[Rt+2]+=1),Nt<.2&&(at[Rt+4]+=1))}}()}(),this.setAttribute("position",new ht(rt,3)),this.setAttribute("normal",new ht(rt.slice(),3)),this.setAttribute("uv",new ht(at,2)),_e===0?this.computeVertexNormals():this.normalizeNormals()}static fromJSON(o){return new Qv(o.vertices,o.indices,o.radius,o.details)}}class Zy extends Qv{constructor(o=1,g=0){const $=(1+Math.sqrt(5))/2,_e=1/$;super([-1,-1,-1,-1,-1,1,-1,1,-1,-1,1,1,1,-1,-1,1,-1,1,1,1,-1,1,1,1,0,-_e,-$,0,-_e,$,0,_e,-$,0,_e,$,-_e,-$,0,-_e,$,0,_e,-$,0,_e,$,0,-$,0,-_e,$,0,-_e,-$,0,_e,$,0,_e],[3,11,7,3,7,15,3,15,13,7,19,17,7,17,6,7,6,15,17,4,8,17,8,10,17,10,6,8,0,16,8,16,2,8,2,10,0,12,1,0,1,18,0,18,16,6,10,2,6,2,13,6,13,15,2,16,18,2,18,3,2,3,13,18,1,9,18,9,11,18,11,3,4,14,12,4,12,0,4,0,8,11,9,5,11,5,19,11,19,7,19,5,14,19,14,4,19,4,17,1,12,14,1,14,5,1,5,9],o,g),this.type="DodecahedronGeometry",this.parameters={radius:o,detail:g}}static fromJSON(o){return new Zy(o.radius,o.detail)}}const Dl=new fn,gE=new fn,tv=new fn,Zu=new yu;class El extends fs{constructor(o=null,g=1){if(super(),this.type="EdgesGeometry",this.parameters={geometry:o,thresholdAngle:g},o!==null){const _e=Math.pow(10,4),rt=Math.cos(d0*g),at=o.getIndex(),ct=o.getAttribute("position"),ft=at?at.count:ct.count,mt=[0,0,0],bt=["a","b","c"],Tt=new Array(3),St={},It=[];for(let Rt=0;Rt<ft;Rt+=3){at?(mt[0]=at.getX(Rt),mt[1]=at.getX(Rt+1),mt[2]=at.getX(Rt+2)):(mt[0]=Rt,mt[1]=Rt+1,mt[2]=Rt+2);const{a:Dt,b:Ft,c:Nt}=Zu;if(Dt.fromBufferAttribute(ct,mt[0]),Ft.fromBufferAttribute(ct,mt[1]),Nt.fromBufferAttribute(ct,mt[2]),Zu.getNormal(tv),Tt[0]=`${Math.round(Dt.x*_e)},${Math.round(Dt.y*_e)},${Math.round(Dt.z*_e)}`,Tt[1]=`${Math.round(Ft.x*_e)},${Math.round(Ft.y*_e)},${Math.round(Ft.z*_e)}`,Tt[2]=`${Math.round(Nt.x*_e)},${Math.round(Nt.y*_e)},${Math.round(Nt.z*_e)}`,Tt[0]!==Tt[1]&&Tt[1]!==Tt[2]&&Tt[2]!==Tt[0])for(let zt=0;zt<3;zt++){const Xt=(zt+1)%3,tn=Tt[zt],sn=Tt[Xt],ln=Zu[bt[zt]],kn=Zu[bt[Xt]],Ln=`${tn}_${sn}`,qn=`${sn}_${tn}`;qn in St&&St[qn]?(tv.dot(St[qn].normal)<=rt&&(It.push(ln.x,ln.y,ln.z),It.push(kn.x,kn.y,kn.z)),St[qn]=null):Ln in St||(St[Ln]={index0:mt[zt],index1:mt[Xt],normal:tv.clone()})}}for(const Rt in St)if(St[Rt]){const{index0:Dt,index1:Ft}=St[Rt];Dl.fromBufferAttribute(ct,Dt),gE.fromBufferAttribute(ct,Ft),It.push(Dl.x,Dl.y,Dl.z),It.push(gE.x,gE.y,gE.z)}this.setAttribute("position",new ht(It,3))}}}class jA extends Ky{constructor(o){super(o),this.uuid=Es(),this.type="Shape",this.holes=[]}getPointsHoles(o){const g=[];for(let $=0,_e=this.holes.length;$<_e;$++)g[$]=this.holes[$].getPoints(o);return g}extractPoints(o){return{shape:this.getPoints(o),holes:this.getPointsHoles(o)}}copy(o){super.copy(o),this.holes=[];for(let g=0,$=o.holes.length;g<$;g++){const _e=o.holes[g];this.holes.push(_e.clone())}return this}toJSON(){const o=super.toJSON();o.uuid=this.uuid,o.holes=[];for(let g=0,$=this.holes.length;g<$;g++){const _e=this.holes[g];o.holes.push(_e.toJSON())}return o}fromJSON(o){super.fromJSON(o),this.uuid=o.uuid,this.holes=[];for(let g=0,$=o.holes.length;g<$;g++){const _e=o.holes[g];this.holes.push(new Ky().fromJSON(_e))}return this}}function MT(dt,o,g,$,_e){let rt,at;if(_e===function(ct,ft,mt,bt){let Tt=0;for(let St=ft,It=mt-bt;St<mt;St+=bt)Tt+=(ct[It]-ct[St])*(ct[St+1]+ct[It+1]),It=St;return Tt}(dt,o,g,$)>0)for(rt=o;rt<g;rt+=$)at=wx(rt,dt[rt],dt[rt+1],at);else for(rt=g-$;rt>=o;rt-=$)at=wx(rt,dt[rt],dt[rt+1],at);return at&&Bp(at,at.next)&&(gp(at),at=at.next),at}function mp(dt,o){if(!dt)return dt;o||(o=dt);let g,$=dt;do if(g=!1,$.steiner||!Bp($,$.next)&&Yo($.prev,$,$.next)!==0)$=$.next;else{if(gp($),$=o=$.prev,$===$.next)break;g=!0}while(g||$!==o);return o}function zA(dt,o,g,$,_e,rt,at){if(!dt)return;!at&&rt&&function(bt,Tt,St,It){let Rt=bt;do Rt.z===null&&(Rt.z=vE(Rt.x,Rt.y,Tt,St,It)),Rt.prevZ=Rt.prev,Rt.nextZ=Rt.next,Rt=Rt.next;while(Rt!==bt);Rt.prevZ.nextZ=null,Rt.prevZ=null,function(Dt){let Ft,Nt,zt,Xt,tn,sn,ln,kn,Ln=1;do{for(Nt=Dt,Dt=null,tn=null,sn=0;Nt;){for(sn++,zt=Nt,ln=0,Ft=0;Ft<Ln&&(ln++,zt=zt.nextZ,zt);Ft++);for(kn=Ln;ln>0||kn>0&&zt;)ln!==0&&(kn===0||!zt||Nt.z<=zt.z)?(Xt=Nt,Nt=Nt.nextZ,ln--):(Xt=zt,zt=zt.nextZ,kn--),tn?tn.nextZ=Xt:Dt=Xt,Xt.prevZ=tn,tn=Xt;Nt=zt}tn.nextZ=null,Ln*=2}while(sn>1)}(Rt)}(dt,$,_e,rt);let ct,ft,mt=dt;for(;dt.prev!==dt.next;)if(ct=dt.prev,ft=dt.next,rt?EC(dt,$,_e,rt):bC(dt))o.push(ct.i/g),o.push(dt.i/g),o.push(ft.i/g),gp(dt),dt=ft.next,mt=ft.next;else if((dt=ft)===mt){at?at===1?zA(dt=SC(mp(dt),o,g),o,g,$,_e,rt,2):at===2&&vD(dt,o,g,$,_e,rt):zA(mp(dt),o,g,$,_e,rt,1);break}}function bC(dt){const o=dt.prev,g=dt,$=dt.next;if(Yo(o,g,$)>=0)return!1;let _e=dt.next.next;for(;_e!==dt.prev;){if(VA(o.x,o.y,g.x,g.y,$.x,$.y,_e.x,_e.y)&&Yo(_e.prev,_e,_e.next)>=0)return!1;_e=_e.next}return!0}function EC(dt,o,g,$){const _e=dt.prev,rt=dt,at=dt.next;if(Yo(_e,rt,at)>=0)return!1;const ct=_e.x<rt.x?_e.x<at.x?_e.x:at.x:rt.x<at.x?rt.x:at.x,ft=_e.y<rt.y?_e.y<at.y?_e.y:at.y:rt.y<at.y?rt.y:at.y,mt=_e.x>rt.x?_e.x>at.x?_e.x:at.x:rt.x>at.x?rt.x:at.x,bt=_e.y>rt.y?_e.y>at.y?_e.y:at.y:rt.y>at.y?rt.y:at.y,Tt=vE(ct,ft,o,g,$),St=vE(mt,bt,o,g,$);let It=dt.prevZ,Rt=dt.nextZ;for(;It&&It.z>=Tt&&Rt&&Rt.z<=St;){if(It!==dt.prev&&It!==dt.next&&VA(_e.x,_e.y,rt.x,rt.y,at.x,at.y,It.x,It.y)&&Yo(It.prev,It,It.next)>=0||(It=It.prevZ,Rt!==dt.prev&&Rt!==dt.next&&VA(_e.x,_e.y,rt.x,rt.y,at.x,at.y,Rt.x,Rt.y)&&Yo(Rt.prev,Rt,Rt.next)>=0))return!1;Rt=Rt.nextZ}for(;It&&It.z>=Tt;){if(It!==dt.prev&&It!==dt.next&&VA(_e.x,_e.y,rt.x,rt.y,at.x,at.y,It.x,It.y)&&Yo(It.prev,It,It.next)>=0)return!1;It=It.prevZ}for(;Rt&&Rt.z<=St;){if(Rt!==dt.prev&&Rt!==dt.next&&VA(_e.x,_e.y,rt.x,rt.y,at.x,at.y,Rt.x,Rt.y)&&Yo(Rt.prev,Rt,Rt.next)>=0)return!1;Rt=Rt.nextZ}return!0}function SC(dt,o,g){let $=dt;do{const _e=$.prev,rt=$.next.next;!Bp(_e,rt)&&MC(_e,$,$.next,rt)&&nv(_e,rt)&&nv(rt,_e)&&(o.push(_e.i/g),o.push($.i/g),o.push(rt.i/g),gp($),gp($.next),$=dt=rt),$=$.next}while($!==dt);return mp($)}function vD(dt,o,g,$,_e,rt){let at=dt;do{let ct=at.next.next;for(;ct!==at.prev;){if(at.i!==ct.i&&CC(at,ct)){let ft=ku(at,ct);return at=mp(at,at.next),ft=mp(ft,ft.next),zA(at,o,g,$,_e,rt),void zA(ft,o,g,$,_e,rt)}ct=ct.next}at=at.next}while(at!==dt)}function _D(dt,o){return dt.x-o.x}function AD(dt,o){if(o=function(g,$){let _e=$;const rt=g.x,at=g.y;let ct,ft=-1/0;do{if(at<=_e.y&&at>=_e.next.y&&_e.next.y!==_e.y){const Rt=_e.x+(at-_e.y)*(_e.next.x-_e.x)/(_e.next.y-_e.y);if(Rt<=rt&&Rt>ft){if(ft=Rt,Rt===rt){if(at===_e.y)return _e;if(at===_e.next.y)return _e.next}ct=_e.x<_e.next.x?_e:_e.next}}_e=_e.next}while(_e!==$);if(!ct)return null;if(rt===ft)return ct;const mt=ct,bt=ct.x,Tt=ct.y;let St,It=1/0;_e=ct;do rt>=_e.x&&_e.x>=bt&&rt!==_e.x&&VA(at<Tt?rt:ft,at,bt,Tt,at<Tt?ft:rt,at,_e.x,_e.y)&&(St=Math.abs(at-_e.y)/(rt-_e.x),nv(_e,g)&&(St<It||St===It&&(_e.x>ct.x||_e.x===ct.x&&yD(ct,_e)))&&(ct=_e,It=St)),_e=_e.next;while(_e!==mt);return ct}(dt,o),o){const g=ku(o,dt);mp(o,o.next),mp(g,g.next)}}function yD(dt,o){return Yo(dt.prev,dt,o.prev)<0&&Yo(o.next,dt,dt.next)<0}function vE(dt,o,g,$,_e){return(dt=1431655765&((dt=858993459&((dt=252645135&((dt=16711935&((dt=32767*(dt-g)*_e)|dt<<8))|dt<<4))|dt<<2))|dt<<1))|(o=1431655765&((o=858993459&((o=252645135&((o=16711935&((o=32767*(o-$)*_e)|o<<8))|o<<4))|o<<2))|o<<1))<<1}function Ax(dt){let o=dt,g=dt;do(o.x<g.x||o.x===g.x&&o.y<g.y)&&(g=o),o=o.next;while(o!==dt);return g}function VA(dt,o,g,$,_e,rt,at,ct){return(_e-at)*(o-ct)-(dt-at)*(rt-ct)>=0&&(dt-at)*($-ct)-(g-at)*(o-ct)>=0&&(g-at)*(rt-ct)-(_e-at)*($-ct)>=0}function CC(dt,o){return dt.next.i!==o.i&&dt.prev.i!==o.i&&!function(g,$){let _e=g;do{if(_e.i!==g.i&&_e.next.i!==g.i&&_e.i!==$.i&&_e.next.i!==$.i&&MC(_e,_e.next,g,$))return!0;_e=_e.next}while(_e!==g);return!1}(dt,o)&&(nv(dt,o)&&nv(o,dt)&&function(g,$){let _e=g,rt=!1;const at=(g.x+$.x)/2,ct=(g.y+$.y)/2;do _e.y>ct!=_e.next.y>ct&&_e.next.y!==_e.y&&at<(_e.next.x-_e.x)*(ct-_e.y)/(_e.next.y-_e.y)+_e.x&&(rt=!rt),_e=_e.next;while(_e!==g);return rt}(dt,o)&&(Yo(dt.prev,dt,o.prev)||Yo(dt,o.prev,o))||Bp(dt,o)&&Yo(dt.prev,dt,dt.next)>0&&Yo(o.prev,o,o.next)>0)}function Yo(dt,o,g){return(o.y-dt.y)*(g.x-o.x)-(o.x-dt.x)*(g.y-o.y)}function Bp(dt,o){return dt.x===o.x&&dt.y===o.y}function MC(dt,o,g,$){const _e=Gv(Yo(dt,o,g)),rt=Gv(Yo(dt,o,$)),at=Gv(Yo(g,$,dt)),ct=Gv(Yo(g,$,o));return _e!==rt&&at!==ct||!(_e!==0||!yx(dt,g,o))||!(rt!==0||!yx(dt,$,o))||!(at!==0||!yx(g,dt,$))||!(ct!==0||!yx(g,o,$))}function yx(dt,o,g){return o.x<=Math.max(dt.x,g.x)&&o.x>=Math.min(dt.x,g.x)&&o.y<=Math.max(dt.y,g.y)&&o.y>=Math.min(dt.y,g.y)}function Gv(dt){return dt>0?1:dt<0?-1:0}function nv(dt,o){return Yo(dt.prev,dt,dt.next)<0?Yo(dt,o,dt.next)>=0&&Yo(dt,dt.prev,o)>=0:Yo(dt,o,dt.prev)<0||Yo(dt,dt.next,o)<0}function ku(dt,o){const g=new D0(dt.i,dt.x,dt.y),$=new D0(o.i,o.x,o.y),_e=dt.next,rt=o.prev;return dt.next=o,o.prev=dt,g.next=_e,_e.prev=g,$.next=g,g.prev=$,rt.next=$,$.prev=rt,$}function wx(dt,o,g,$){const _e=new D0(dt,o,g);return $?(_e.next=$.next,_e.prev=$,$.next.prev=_e,$.next=_e):(_e.prev=_e,_e.next=_e),_e}function gp(dt){dt.next.prev=dt.prev,dt.prev.next=dt.next,dt.prevZ&&(dt.prevZ.nextZ=dt.nextZ),dt.nextZ&&(dt.nextZ.prevZ=dt.prevZ)}function D0(dt,o,g){this.i=dt,this.x=o,this.y=g,this.prev=null,this.next=null,this.z=null,this.prevZ=null,this.nextZ=null,this.steiner=!1}class xu{static area(o){const g=o.length;let $=0;for(let _e=g-1,rt=0;rt<g;_e=rt++)$+=o[_e].x*o[rt].y-o[rt].x*o[_e].y;return .5*$}static isClockWise(o){return xu.area(o)<0}static triangulateShape(o,g){const $=[],_e=[],rt=[];ym(o),xx($,o);let at=o.length;g.forEach(ym);for(let ft=0;ft<g.length;ft++)_e.push(at),at+=g[ft].length,xx($,g[ft]);const ct=function(ft,mt,bt=2){const Tt=mt&&mt.length,St=Tt?mt[0]*bt:ft.length;let It=MT(ft,0,St,bt,!0);const Rt=[];if(!It||It.next===It.prev)return Rt;let Dt,Ft,Nt,zt,Xt,tn,sn;if(Tt&&(It=function(ln,kn,Ln,qn){const Kn=[];let On,_r,Tr,gr,Or;for(On=0,_r=kn.length;On<_r;On++)Tr=kn[On]*qn,gr=On<_r-1?kn[On+1]*qn:ln.length,Or=MT(ln,Tr,gr,qn,!1),Or===Or.next&&(Or.steiner=!0),Kn.push(Ax(Or));for(Kn.sort(_D),On=0;On<Kn.length;On++)AD(Kn[On],Ln),Ln=mp(Ln,Ln.next);return Ln}(ft,mt,It,bt)),ft.length>80*bt){Dt=Nt=ft[0],Ft=zt=ft[1];for(let ln=bt;ln<St;ln+=bt)Xt=ft[ln],tn=ft[ln+1],Xt<Dt&&(Dt=Xt),tn<Ft&&(Ft=tn),Xt>Nt&&(Nt=Xt),tn>zt&&(zt=tn);sn=Math.max(Nt-Dt,zt-Ft),sn=sn!==0?1/sn:0}return zA(It,Rt,bt,Dt,Ft,sn),Rt}($,_e);for(let ft=0;ft<ct.length;ft+=3)rt.push(ct.slice(ft,ft+3));return rt}}function ym(dt){const o=dt.length;o>2&&dt[o-1].equals(dt[0])&&dt.pop()}function xx(dt,o){for(let g=0;g<o.length;g++)dt.push(o[g].x),dt.push(o[g].y)}class QA extends fs{constructor(o=new jA([new Sr(.5,.5),new Sr(-.5,.5),new Sr(-.5,-.5),new Sr(.5,-.5)]),g={}){super(),this.type="ExtrudeGeometry",this.parameters={shapes:o,options:g},o=Array.isArray(o)?o:[o];const $=this,_e=[],rt=[];for(let ct=0,ft=o.length;ct<ft;ct++)at(o[ct]);function at(ct){const ft=[],mt=g.curveSegments!==void 0?g.curveSegments:12,bt=g.steps!==void 0?g.steps:1,Tt=g.depth!==void 0?g.depth:1;let St=g.bevelEnabled===void 0||g.bevelEnabled,It=g.bevelThickness!==void 0?g.bevelThickness:.2,Rt=g.bevelSize!==void 0?g.bevelSize:It-.1,Dt=g.bevelOffset!==void 0?g.bevelOffset:0,Ft=g.bevelSegments!==void 0?g.bevelSegments:3;const Nt=g.extrudePath,zt=g.UVGenerator!==void 0?g.UVGenerator:Wp;let Xt,tn,sn,ln,kn,Ln=!1;Nt&&(Xt=Nt.getSpacedPoints(bt),Ln=!0,St=!1,tn=Nt.computeFrenetFrames(bt,!1),sn=new fn,ln=new fn,kn=new fn),St||(Ft=0,It=0,Rt=0,Dt=0);const qn=ct.extractPoints(mt);let Kn=qn.shape;const On=qn.holes;if(!xu.isClockWise(Kn)){Kn=Kn.reverse();for(let Hn=0,In=On.length;Hn<In;Hn++){const Wn=On[Hn];xu.isClockWise(Wn)&&(On[Hn]=Wn.reverse())}}const _r=xu.triangulateShape(Kn,On),Tr=Kn;for(let Hn=0,In=On.length;Hn<In;Hn++){const Wn=On[Hn];Kn=Kn.concat(Wn)}function gr(Hn,In,Wn){return In||console.error("THREE.ExtrudeGeometry: vec does not exist"),In.clone().multiplyScalar(Wn).add(Hn)}const Or=Kn.length,Gr=_r.length;function cr(Hn,In,Wn){let pr,Jt,or;const Zn=Hn.x-In.x,vr=Hn.y-In.y,Pr=Wn.x-Hn.x,Jr=Wn.y-Hn.y,gs=Zn*Zn+vr*vr,Ds=Zn*Jr-vr*Pr;if(Math.abs(Ds)>Number.EPSILON){const Ns=Math.sqrt(gs),xs=Math.sqrt(Pr*Pr+Jr*Jr),Ms=In.x-vr/Ns,xo=In.y+Zn/Ns,Jp=((Wn.x-Jr/xs-Ms)*Jr-(Wn.y+Pr/xs-xo)*Pr)/(Zn*Jr-vr*Pr);pr=Ms+Zn*Jp-Hn.x,Jt=xo+vr*Jp-Hn.y;const Is=pr*pr+Jt*Jt;if(Is<=2)return new Sr(pr,Jt);or=Math.sqrt(Is/2)}else{let Ns=!1;Zn>Number.EPSILON?Pr>Number.EPSILON&&(Ns=!0):Zn<-Number.EPSILON?Pr<-Number.EPSILON&&(Ns=!0):Math.sign(vr)===Math.sign(Jr)&&(Ns=!0),Ns?(pr=-vr,Jt=Zn,or=Math.sqrt(gs)):(pr=Zn,Jt=vr,or=Math.sqrt(gs/2))}return new Sr(pr/or,Jt/or)}const ur=[];for(let Hn=0,In=Tr.length,Wn=In-1,pr=Hn+1;Hn<In;Hn++,Wn++,pr++)Wn===In&&(Wn=0),pr===In&&(pr=0),ur[Hn]=cr(Tr[Hn],Tr[Wn],Tr[pr]);const Fr=[];let Ar,Qr=ur.concat();for(let Hn=0,In=On.length;Hn<In;Hn++){const Wn=On[Hn];Ar=[];for(let pr=0,Jt=Wn.length,or=Jt-1,Zn=pr+1;pr<Jt;pr++,or++,Zn++)or===Jt&&(or=0),Zn===Jt&&(Zn=0),Ar[pr]=cr(Wn[pr],Wn[or],Wn[Zn]);Fr.push(Ar),Qr=Qr.concat(Ar)}for(let Hn=0;Hn<Ft;Hn++){const In=Hn/Ft,Wn=It*Math.cos(In*Math.PI/2),pr=Rt*Math.sin(In*Math.PI/2)+Dt;for(let Jt=0,or=Tr.length;Jt<or;Jt++){const Zn=gr(Tr[Jt],ur[Jt],pr);ys(Zn.x,Zn.y,-Wn)}for(let Jt=0,or=On.length;Jt<or;Jt++){const Zn=On[Jt];Ar=Fr[Jt];for(let vr=0,Pr=Zn.length;vr<Pr;vr++){const Jr=gr(Zn[vr],Ar[vr],pr);ys(Jr.x,Jr.y,-Wn)}}}const as=Rt+Dt;for(let Hn=0;Hn<Or;Hn++){const In=St?gr(Kn[Hn],Qr[Hn],as):Kn[Hn];Ln?(ln.copy(tn.normals[0]).multiplyScalar(In.x),sn.copy(tn.binormals[0]).multiplyScalar(In.y),kn.copy(Xt[0]).add(ln).add(sn),ys(kn.x,kn.y,kn.z)):ys(In.x,In.y,0)}for(let Hn=1;Hn<=bt;Hn++)for(let In=0;In<Or;In++){const Wn=St?gr(Kn[In],Qr[In],as):Kn[In];Ln?(ln.copy(tn.normals[Hn]).multiplyScalar(Wn.x),sn.copy(tn.binormals[Hn]).multiplyScalar(Wn.y),kn.copy(Xt[Hn]).add(ln).add(sn),ys(kn.x,kn.y,kn.z)):ys(Wn.x,Wn.y,Tt/bt*Hn)}for(let Hn=Ft-1;Hn>=0;Hn--){const In=Hn/Ft,Wn=It*Math.cos(In*Math.PI/2),pr=Rt*Math.sin(In*Math.PI/2)+Dt;for(let Jt=0,or=Tr.length;Jt<or;Jt++){const Zn=gr(Tr[Jt],ur[Jt],pr);ys(Zn.x,Zn.y,Tt+Wn)}for(let Jt=0,or=On.length;Jt<or;Jt++){const Zn=On[Jt];Ar=Fr[Jt];for(let vr=0,Pr=Zn.length;vr<Pr;vr++){const Jr=gr(Zn[vr],Ar[vr],pr);Ln?ys(Jr.x,Jr.y+Xt[bt-1].y,Xt[bt-1].x+Wn):ys(Jr.x,Jr.y,Tt+Wn)}}}function Qs(Hn,In){let Wn=Hn.length;for(;--Wn>=0;){const pr=Wn;let Jt=Wn-1;Jt<0&&(Jt=Hn.length-1);for(let or=0,Zn=bt+2*Ft;or<Zn;or++){const vr=Or*or,Pr=Or*(or+1);Dn(In+pr+vr,In+Jt+vr,In+Jt+Pr,In+pr+Pr)}}}function ys(Hn,In,Wn){ft.push(Hn),ft.push(In),ft.push(Wn)}function Hs(Hn,In,Wn){yn(Hn),yn(In),yn(Wn);const pr=_e.length/3,Jt=zt.generateTopUV($,_e,pr-3,pr-2,pr-1);tr(Jt[0]),tr(Jt[1]),tr(Jt[2])}function Dn(Hn,In,Wn,pr){yn(Hn),yn(In),yn(pr),yn(In),yn(Wn),yn(pr);const Jt=_e.length/3,or=zt.generateSideWallUV($,_e,Jt-6,Jt-3,Jt-2,Jt-1);tr(or[0]),tr(or[1]),tr(or[3]),tr(or[1]),tr(or[2]),tr(or[3])}function yn(Hn){_e.push(ft[3*Hn+0]),_e.push(ft[3*Hn+1]),_e.push(ft[3*Hn+2])}function tr(Hn){rt.push(Hn.x),rt.push(Hn.y)}(function(){const Hn=_e.length/3;if(St){let In=0,Wn=Or*In;for(let pr=0;pr<Gr;pr++){const Jt=_r[pr];Hs(Jt[2]+Wn,Jt[1]+Wn,Jt[0]+Wn)}In=bt+2*Ft,Wn=Or*In;for(let pr=0;pr<Gr;pr++){const Jt=_r[pr];Hs(Jt[0]+Wn,Jt[1]+Wn,Jt[2]+Wn)}}else{for(let In=0;In<Gr;In++){const Wn=_r[In];Hs(Wn[2],Wn[1],Wn[0])}for(let In=0;In<Gr;In++){const Wn=_r[In];Hs(Wn[0]+Or*bt,Wn[1]+Or*bt,Wn[2]+Or*bt)}}$.addGroup(Hn,_e.length/3-Hn,0)})(),function(){const Hn=_e.length/3;let In=0;Qs(Tr,In),In+=Tr.length;for(let Wn=0,pr=On.length;Wn<pr;Wn++){const Jt=On[Wn];Qs(Jt,In),In+=Jt.length}$.addGroup(Hn,_e.length/3-Hn,1)}()}this.setAttribute("position",new ht(_e,3)),this.setAttribute("uv",new ht(rt,2)),this.computeVertexNormals()}toJSON(){const o=super.toJSON();return function(g,$,_e){if(_e.shapes=[],Array.isArray(g))for(let rt=0,at=g.length;rt<at;rt++){const ct=g[rt];_e.shapes.push(ct.uuid)}else _e.shapes.push(g.uuid);return _e.options=Object.assign({},$),$.extrudePath!==void 0&&(_e.options.extrudePath=$.extrudePath.toJSON()),_e}(this.parameters.shapes,this.parameters.options,o)}static fromJSON(o,g){const $=[];for(let rt=0,at=o.shapes.length;rt<at;rt++){const ct=g[o.shapes[rt]];$.push(ct)}const _e=o.options.extrudePath;return _e!==void 0&&(o.options.extrudePath=new fE[_e.type]().fromJSON(_e)),new QA($,o.options)}}const Wp={generateTopUV:function(dt,o,g,$,_e){const rt=o[3*g],at=o[3*g+1],ct=o[3*$],ft=o[3*$+1],mt=o[3*_e],bt=o[3*_e+1];return[new Sr(rt,at),new Sr(ct,ft),new Sr(mt,bt)]},generateSideWallUV:function(dt,o,g,$,_e,rt){const at=o[3*g],ct=o[3*g+1],ft=o[3*g+2],mt=o[3*$],bt=o[3*$+1],Tt=o[3*$+2],St=o[3*_e],It=o[3*_e+1],Rt=o[3*_e+2],Dt=o[3*rt],Ft=o[3*rt+1],Nt=o[3*rt+2];return Math.abs(ct-bt)<Math.abs(at-mt)?[new Sr(at,1-ft),new Sr(mt,1-Tt),new Sr(St,1-Rt),new Sr(Dt,1-Nt)]:[new Sr(ct,1-ft),new Sr(bt,1-Tt),new Sr(It,1-Rt),new Sr(Ft,1-Nt)]}};class bx extends Qv{constructor(o=1,g=0){const $=(1+Math.sqrt(5))/2;super([-1,$,0,1,$,0,-1,-$,0,1,-$,0,0,-1,$,0,1,$,0,-1,-$,0,1,-$,$,0,-1,$,0,1,-$,0,-1,-$,0,1],[0,11,5,0,5,1,0,1,7,0,7,10,0,10,11,1,5,9,5,11,4,11,10,2,10,7,6,7,1,8,3,9,4,3,4,2,3,2,6,3,6,8,3,8,9,4,9,5,2,4,11,6,2,10,8,6,7,9,8,1],o,g),this.type="IcosahedronGeometry",this.parameters={radius:o,detail:g}}static fromJSON(o){return new bx(o.radius,o.detail)}}class $y extends Qv{constructor(o=1,g=0){super([1,0,0,-1,0,0,0,1,0,0,-1,0,0,0,1,0,0,-1],[0,2,4,0,4,3,0,3,5,0,5,2,1,2,5,1,5,3,1,3,4,1,4,2],o,g),this.type="OctahedronGeometry",this.parameters={radius:o,detail:g}}static fromJSON(o){return new $y(o.radius,o.detail)}}class ew extends fs{constructor(o=.5,g=1,$=8,_e=1,rt=0,at=2*Math.PI){super(),this.type="RingGeometry",this.parameters={innerRadius:o,outerRadius:g,thetaSegments:$,phiSegments:_e,thetaStart:rt,thetaLength:at},$=Math.max(3,$);const ct=[],ft=[],mt=[],bt=[];let Tt=o;const St=(g-o)/(_e=Math.max(1,_e)),It=new fn,Rt=new Sr;for(let Dt=0;Dt<=_e;Dt++){for(let Ft=0;Ft<=$;Ft++){const Nt=rt+Ft/$*at;It.x=Tt*Math.cos(Nt),It.y=Tt*Math.sin(Nt),ft.push(It.x,It.y,It.z),mt.push(0,0,1),Rt.x=(It.x/g+1)/2,Rt.y=(It.y/g+1)/2,bt.push(Rt.x,Rt.y)}Tt+=St}for(let Dt=0;Dt<_e;Dt++){const Ft=Dt*($+1);for(let Nt=0;Nt<$;Nt++){const zt=Nt+Ft,Xt=zt,tn=zt+$+1,sn=zt+$+2,ln=zt+1;ct.push(Xt,tn,ln),ct.push(tn,sn,ln)}}this.setIndex(ct),this.setAttribute("position",new ht(ft,3)),this.setAttribute("normal",new ht(mt,3)),this.setAttribute("uv",new ht(bt,2))}static fromJSON(o){return new ew(o.innerRadius,o.outerRadius,o.thetaSegments,o.phiSegments,o.thetaStart,o.thetaLength)}}class $u extends fs{constructor(o=new jA([new Sr(0,.5),new Sr(-.5,-.5),new Sr(.5,-.5)]),g=12){super(),this.type="ShapeGeometry",this.parameters={shapes:o,curveSegments:g};const $=[],_e=[],rt=[],at=[];let ct=0,ft=0;if(Array.isArray(o)===!1)mt(o);else for(let bt=0;bt<o.length;bt++)mt(o[bt]),this.addGroup(ct,ft,bt),ct+=ft,ft=0;function mt(bt){const Tt=_e.length/3,St=bt.extractPoints(g);let It=St.shape;const Rt=St.holes;xu.isClockWise(It)===!1&&(It=It.reverse());for(let Ft=0,Nt=Rt.length;Ft<Nt;Ft++){const zt=Rt[Ft];xu.isClockWise(zt)===!0&&(Rt[Ft]=zt.reverse())}const Dt=xu.triangulateShape(It,Rt);for(let Ft=0,Nt=Rt.length;Ft<Nt;Ft++){const zt=Rt[Ft];It=It.concat(zt)}for(let Ft=0,Nt=It.length;Ft<Nt;Ft++){const zt=It[Ft];_e.push(zt.x,zt.y,0),rt.push(0,0,1),at.push(zt.x,zt.y)}for(let Ft=0,Nt=Dt.length;Ft<Nt;Ft++){const zt=Dt[Ft],Xt=zt[0]+Tt,tn=zt[1]+Tt,sn=zt[2]+Tt;$.push(Xt,tn,sn),ft+=3}}this.setIndex($),this.setAttribute("position",new ht(_e,3)),this.setAttribute("normal",new ht(rt,3)),this.setAttribute("uv",new ht(at,2))}toJSON(){const o=super.toJSON();return function(g,$){if($.shapes=[],Array.isArray(g))for(let _e=0,rt=g.length;_e<rt;_e++){const at=g[_e];$.shapes.push(at.uuid)}else $.shapes.push(g.uuid);return $}(this.parameters.shapes,o)}static fromJSON(o,g){const $=[];for(let _e=0,rt=o.shapes.length;_e<rt;_e++){const at=g[o.shapes[_e]];$.push(at)}return new $u($,o.curveSegments)}}class M_ extends fs{constructor(o=1,g=32,$=16,_e=0,rt=2*Math.PI,at=0,ct=Math.PI){super(),this.type="SphereGeometry",this.parameters={radius:o,widthSegments:g,heightSegments:$,phiStart:_e,phiLength:rt,thetaStart:at,thetaLength:ct},g=Math.max(3,Math.floor(g)),$=Math.max(2,Math.floor($));const ft=Math.min(at+ct,Math.PI);let mt=0;const bt=[],Tt=new fn,St=new fn,It=[],Rt=[],Dt=[],Ft=[];for(let Nt=0;Nt<=$;Nt++){const zt=[],Xt=Nt/$;let tn=0;Nt==0&&at==0?tn=.5/g:Nt==$&&ft==Math.PI&&(tn=-.5/g);for(let sn=0;sn<=g;sn++){const ln=sn/g;Tt.x=-o*Math.cos(_e+ln*rt)*Math.sin(at+Xt*ct),Tt.y=o*Math.cos(at+Xt*ct),Tt.z=o*Math.sin(_e+ln*rt)*Math.sin(at+Xt*ct),Rt.push(Tt.x,Tt.y,Tt.z),St.copy(Tt).normalize(),Dt.push(St.x,St.y,St.z),Ft.push(ln+tn,1-Xt),zt.push(mt++)}bt.push(zt)}for(let Nt=0;Nt<$;Nt++)for(let zt=0;zt<g;zt++){const Xt=bt[Nt][zt+1],tn=bt[Nt][zt],sn=bt[Nt+1][zt],ln=bt[Nt+1][zt+1];(Nt!==0||at>0)&&It.push(Xt,tn,ln),(Nt!==$-1||ft<Math.PI)&&It.push(tn,sn,ln)}this.setIndex(It),this.setAttribute("position",new ht(Rt,3)),this.setAttribute("normal",new ht(Dt,3)),this.setAttribute("uv",new ht(Ft,2))}static fromJSON(o){return new M_(o.radius,o.widthSegments,o.heightSegments,o.phiStart,o.phiLength,o.thetaStart,o.thetaLength)}}class Ex extends Qv{constructor(o=1,g=0){super([1,1,1,-1,-1,1,-1,1,-1,1,-1,-1],[2,1,0,0,3,2,1,3,0,2,3,1],o,g),this.type="TetrahedronGeometry",this.parameters={radius:o,detail:g}}static fromJSON(o){return new Ex(o.radius,o.detail)}}class Sx extends fs{constructor(o=1,g=.4,$=8,_e=6,rt=2*Math.PI){super(),this.type="TorusGeometry",this.parameters={radius:o,tube:g,radialSegments:$,tubularSegments:_e,arc:rt},$=Math.floor($),_e=Math.floor(_e);const at=[],ct=[],ft=[],mt=[],bt=new fn,Tt=new fn,St=new fn;for(let It=0;It<=$;It++)for(let Rt=0;Rt<=_e;Rt++){const Dt=Rt/_e*rt,Ft=It/$*Math.PI*2;Tt.x=(o+g*Math.cos(Ft))*Math.cos(Dt),Tt.y=(o+g*Math.cos(Ft))*Math.sin(Dt),Tt.z=g*Math.sin(Ft),ct.push(Tt.x,Tt.y,Tt.z),bt.x=o*Math.cos(Dt),bt.y=o*Math.sin(Dt),St.subVectors(Tt,bt).normalize(),ft.push(St.x,St.y,St.z),mt.push(Rt/_e),mt.push(It/$)}for(let It=1;It<=$;It++)for(let Rt=1;Rt<=_e;Rt++){const Dt=(_e+1)*It+Rt-1,Ft=(_e+1)*(It-1)+Rt-1,Nt=(_e+1)*(It-1)+Rt,zt=(_e+1)*It+Rt;at.push(Dt,Ft,zt),at.push(Ft,Nt,zt)}this.setIndex(at),this.setAttribute("position",new ht(ct,3)),this.setAttribute("normal",new ht(ft,3)),this.setAttribute("uv",new ht(mt,2))}static fromJSON(o){return new Sx(o.radius,o.tube,o.radialSegments,o.tubularSegments,o.arc)}}class tw extends fs{constructor(o=1,g=.4,$=64,_e=8,rt=2,at=3){super(),this.type="TorusKnotGeometry",this.parameters={radius:o,tube:g,tubularSegments:$,radialSegments:_e,p:rt,q:at},$=Math.floor($),_e=Math.floor(_e);const ct=[],ft=[],mt=[],bt=[],Tt=new fn,St=new fn,It=new fn,Rt=new fn,Dt=new fn,Ft=new fn,Nt=new fn;for(let Xt=0;Xt<=$;++Xt){const tn=Xt/$*rt*Math.PI*2;zt(tn,rt,at,o,It),zt(tn+.01,rt,at,o,Rt),Ft.subVectors(Rt,It),Nt.addVectors(Rt,It),Dt.crossVectors(Ft,Nt),Nt.crossVectors(Dt,Ft),Dt.normalize(),Nt.normalize();for(let sn=0;sn<=_e;++sn){const ln=sn/_e*Math.PI*2,kn=-g*Math.cos(ln),Ln=g*Math.sin(ln);Tt.x=It.x+(kn*Nt.x+Ln*Dt.x),Tt.y=It.y+(kn*Nt.y+Ln*Dt.y),Tt.z=It.z+(kn*Nt.z+Ln*Dt.z),ft.push(Tt.x,Tt.y,Tt.z),St.subVectors(Tt,It).normalize(),mt.push(St.x,St.y,St.z),bt.push(Xt/$),bt.push(sn/_e)}}for(let Xt=1;Xt<=$;Xt++)for(let tn=1;tn<=_e;tn++){const sn=(_e+1)*(Xt-1)+(tn-1),ln=(_e+1)*Xt+(tn-1),kn=(_e+1)*Xt+tn,Ln=(_e+1)*(Xt-1)+tn;ct.push(sn,ln,Ln),ct.push(ln,kn,Ln)}function zt(Xt,tn,sn,ln,kn){const Ln=Math.cos(Xt),qn=Math.sin(Xt),Kn=sn/tn*Xt,On=Math.cos(Kn);kn.x=ln*(2+On)*.5*Ln,kn.y=ln*(2+On)*qn*.5,kn.z=ln*Math.sin(Kn)*.5}this.setIndex(ct),this.setAttribute("position",new ht(ft,3)),this.setAttribute("normal",new ht(mt,3)),this.setAttribute("uv",new ht(bt,2))}static fromJSON(o){return new tw(o.radius,o.tube,o.tubularSegments,o.radialSegments,o.p,o.q)}}class _h extends fs{constructor(o=new Vl(new fn(-1,-1,0),new fn(-1,1,0),new fn(1,1,0)),g=64,$=1,_e=8,rt=!1){super(),this.type="TubeGeometry",this.parameters={path:o,tubularSegments:g,radius:$,radialSegments:_e,closed:rt};const at=o.computeFrenetFrames(g,rt);this.tangents=at.tangents,this.normals=at.normals,this.binormals=at.binormals;const ct=new fn,ft=new fn,mt=new Sr;let bt=new fn;const Tt=[],St=[],It=[],Rt=[];function Dt(Ft){bt=o.getPointAt(Ft/g,bt);const Nt=at.normals[Ft],zt=at.binormals[Ft];for(let Xt=0;Xt<=_e;Xt++){const tn=Xt/_e*Math.PI*2,sn=Math.sin(tn),ln=-Math.cos(tn);ft.x=ln*Nt.x+sn*zt.x,ft.y=ln*Nt.y+sn*zt.y,ft.z=ln*Nt.z+sn*zt.z,ft.normalize(),St.push(ft.x,ft.y,ft.z),ct.x=bt.x+$*ft.x,ct.y=bt.y+$*ft.y,ct.z=bt.z+$*ft.z,Tt.push(ct.x,ct.y,ct.z)}}(function(){for(let Ft=0;Ft<g;Ft++)Dt(Ft);Dt(rt===!1?g:0),function(){for(let Ft=0;Ft<=g;Ft++)for(let Nt=0;Nt<=_e;Nt++)mt.x=Ft/g,mt.y=Nt/_e,It.push(mt.x,mt.y)}(),function(){for(let Ft=1;Ft<=g;Ft++)for(let Nt=1;Nt<=_e;Nt++){const zt=(_e+1)*(Ft-1)+(Nt-1),Xt=(_e+1)*Ft+(Nt-1),tn=(_e+1)*Ft+Nt,sn=(_e+1)*(Ft-1)+Nt;Rt.push(zt,Xt,sn),Rt.push(Xt,tn,sn)}}()})(),this.setIndex(Rt),this.setAttribute("position",new ht(Tt,3)),this.setAttribute("normal",new ht(St,3)),this.setAttribute("uv",new ht(It,2))}toJSON(){const o=super.toJSON();return o.path=this.parameters.path.toJSON(),o}static fromJSON(o){return new _h(new fE[o.path.type]().fromJSON(o.path),o.tubularSegments,o.radius,o.radialSegments,o.closed)}}class _E extends fs{constructor(o=null){if(super(),this.type="WireframeGeometry",this.parameters={geometry:o},o!==null){const g=[],$=new Set,_e=new fn,rt=new fn;if(o.index!==null){const at=o.attributes.position,ct=o.index;let ft=o.groups;ft.length===0&&(ft=[{start:0,count:ct.count,materialIndex:0}]);for(let mt=0,bt=ft.length;mt<bt;++mt){const Tt=ft[mt],St=Tt.start;for(let It=St,Rt=St+Tt.count;It<Rt;It+=3)for(let Dt=0;Dt<3;Dt++){const Ft=ct.getX(It+Dt),Nt=ct.getX(It+(Dt+1)%3);_e.fromBufferAttribute(at,Ft),rt.fromBufferAttribute(at,Nt),TT(_e,rt,$)===!0&&(g.push(_e.x,_e.y,_e.z),g.push(rt.x,rt.y,rt.z))}}}else{const at=o.attributes.position;for(let ct=0,ft=at.count/3;ct<ft;ct++)for(let mt=0;mt<3;mt++){const bt=3*ct+mt,Tt=3*ct+(mt+1)%3;_e.fromBufferAttribute(at,bt),rt.fromBufferAttribute(at,Tt),TT(_e,rt,$)===!0&&(g.push(_e.x,_e.y,_e.z),g.push(rt.x,rt.y,rt.z))}}this.setAttribute("position",new ht(g,3))}}}function TT(dt,o,g){const $=`${dt.x},${dt.y},${dt.z}-${o.x},${o.y},${o.z}`,_e=`${o.x},${o.y},${o.z}-${dt.x},${dt.y},${dt.z}`;return g.has($)!==!0&&g.has(_e)!==!0&&(g.add($),g.add(_e),!0)}var IT=Object.freeze({__proto__:null,BoxGeometry:E0,CapsuleGeometry:ev,CircleGeometry:Jy,ConeGeometry:ro,CylinderGeometry:FA,DodecahedronGeometry:Zy,EdgesGeometry:El,ExtrudeGeometry:QA,IcosahedronGeometry:bx,LatheGeometry:Vv,OctahedronGeometry:$y,PlaneGeometry:bA,PolyhedronGeometry:Qv,RingGeometry:ew,ShapeGeometry:$u,SphereGeometry:M_,TetrahedronGeometry:Ex,TorusGeometry:Sx,TorusKnotGeometry:tw,TubeGeometry:_h,WireframeGeometry:_E});class AE extends Fl{constructor(o){super(),this.isShadowMaterial=!0,this.type="ShadowMaterial",this.color=new rs(0),this.transparent=!0,this.fog=!0,this.setValues(o)}copy(o){return super.copy(o),this.color.copy(o.color),this.fog=o.fog,this}}class Cx extends _m{constructor(o){super(o),this.isRawShaderMaterial=!0,this.type="RawShaderMaterial"}}class _d extends Fl{constructor(o){super(),this.isMeshStandardMaterial=!0,this.defines={STANDARD:""},this.type="MeshStandardMaterial",this.color=new rs(16777215),this.roughness=1,this.metalness=0,this.map=null,this.lightMap=null,this.lightMapIntensity=1,this.aoMap=null,this.aoMapIntensity=1,this.emissive=new rs(0),this.emissiveIntensity=1,this.emissiveMap=null,this.bumpMap=null,this.bumpScale=1,this.normalMap=null,this.normalMapType=Nl,this.normalScale=new Sr(1,1),this.displacementMap=null,this.displacementScale=1,this.displacementBias=0,this.roughnessMap=null,this.metalnessMap=null,this.alphaMap=null,this.envMap=null,this.envMapIntensity=1,this.wireframe=!1,this.wireframeLinewidth=1,this.wireframeLinecap="round",this.wireframeLinejoin="round",this.flatShading=!1,this.fog=!0,this.setValues(o)}copy(o){return super.copy(o),this.defines={STANDARD:""},this.color.copy(o.color),this.roughness=o.roughness,this.metalness=o.metalness,this.map=o.map,this.lightMap=o.lightMap,this.lightMapIntensity=o.lightMapIntensity,this.aoMap=o.aoMap,this.aoMapIntensity=o.aoMapIntensity,this.emissive.copy(o.emissive),this.emissiveMap=o.emissiveMap,this.emissiveIntensity=o.emissiveIntensity,this.bumpMap=o.bumpMap,this.bumpScale=o.bumpScale,this.normalMap=o.normalMap,this.normalMapType=o.normalMapType,this.normalScale.copy(o.normalScale),this.displacementMap=o.displacementMap,this.displacementScale=o.displacementScale,this.displacementBias=o.displacementBias,this.roughnessMap=o.roughnessMap,this.metalnessMap=o.metalnessMap,this.alphaMap=o.alphaMap,this.envMap=o.envMap,this.envMapIntensity=o.envMapIntensity,this.wireframe=o.wireframe,this.wireframeLinewidth=o.wireframeLinewidth,this.wireframeLinecap=o.wireframeLinecap,this.wireframeLinejoin=o.wireframeLinejoin,this.flatShading=o.flatShading,this.fog=o.fog,this}}class DT extends _d{constructor(o){super(),this.isMeshPhysicalMaterial=!0,this.defines={STANDARD:"",PHYSICAL:""},this.type="MeshPhysicalMaterial",this.clearcoatMap=null,this.clearcoatRoughness=0,this.clearcoatRoughnessMap=null,this.clearcoatNormalScale=new Sr(1,1),this.clearcoatNormalMap=null,this.ior=1.5,Object.defineProperty(this,"reflectivity",{get:function(){return As(2.5*(this.ior-1)/(this.ior+1),0,1)},set:function(g){this.ior=(1+.4*g)/(1-.4*g)}}),this.iridescenceMap=null,this.iridescenceIOR=1.3,this.iridescenceThicknessRange=[100,400],this.iridescenceThicknessMap=null,this.sheenColor=new rs(0),this.sheenColorMap=null,this.sheenRoughness=1,this.sheenRoughnessMap=null,this.transmissionMap=null,this.thickness=0,this.thicknessMap=null,this.attenuationDistance=0,this.attenuationColor=new rs(1,1,1),this.specularIntensity=1,this.specularIntensityMap=null,this.specularColor=new rs(1,1,1),this.specularColorMap=null,this._sheen=0,this._clearcoat=0,this._iridescence=0,this._transmission=0,this.setValues(o)}get sheen(){return this._sheen}set sheen(o){this._sheen>0!=o>0&&this.version++,this._sheen=o}get clearcoat(){return this._clearcoat}set clearcoat(o){this._clearcoat>0!=o>0&&this.version++,this._clearcoat=o}get iridescence(){return this._iridescence}set iridescence(o){this._iridescence>0!=o>0&&this.version++,this._iridescence=o}get transmission(){return this._transmission}set transmission(o){this._transmission>0!=o>0&&this.version++,this._transmission=o}copy(o){return super.copy(o),this.defines={STANDARD:"",PHYSICAL:""},this.clearcoat=o.clearcoat,this.clearcoatMap=o.clearcoatMap,this.clearcoatRoughness=o.clearcoatRoughness,this.clearcoatRoughnessMap=o.clearcoatRoughnessMap,this.clearcoatNormalMap=o.clearcoatNormalMap,this.clearcoatNormalScale.copy(o.clearcoatNormalScale),this.ior=o.ior,this.iridescence=o.iridescence,this.iridescenceMap=o.iridescenceMap,this.iridescenceIOR=o.iridescenceIOR,this.iridescenceThicknessRange=[...o.iridescenceThicknessRange],this.iridescenceThicknessMap=o.iridescenceThicknessMap,this.sheen=o.sheen,this.sheenColor.copy(o.sheenColor),this.sheenColorMap=o.sheenColorMap,this.sheenRoughness=o.sheenRoughness,this.sheenRoughnessMap=o.sheenRoughnessMap,this.transmission=o.transmission,this.transmissionMap=o.transmissionMap,this.thickness=o.thickness,this.thicknessMap=o.thicknessMap,this.attenuationDistance=o.attenuationDistance,this.attenuationColor.copy(o.attenuationColor),this.specularIntensity=o.specularIntensity,this.specularIntensityMap=o.specularIntensityMap,this.specularColor.copy(o.specularColor),this.specularColorMap=o.specularColorMap,this}}class PT extends Fl{constructor(o){super(),this.isMeshPhongMaterial=!0,this.type="MeshPhongMaterial",this.color=new rs(16777215),this.specular=new rs(1118481),this.shininess=30,this.map=null,this.lightMap=null,this.lightMapIntensity=1,this.aoMap=null,this.aoMapIntensity=1,this.emissive=new rs(0),this.emissiveIntensity=1,this.emissiveMap=null,this.bumpMap=null,this.bumpScale=1,this.normalMap=null,this.normalMapType=Nl,this.normalScale=new Sr(1,1),this.displacementMap=null,this.displacementScale=1,this.displacementBias=0,this.specularMap=null,this.alphaMap=null,this.envMap=null,this.combine=Cs,this.reflectivity=1,this.refractionRatio=.98,this.wireframe=!1,this.wireframeLinewidth=1,this.wireframeLinecap="round",this.wireframeLinejoin="round",this.flatShading=!1,this.fog=!0,this.setValues(o)}copy(o){return super.copy(o),this.color.copy(o.color),this.specular.copy(o.specular),this.shininess=o.shininess,this.map=o.map,this.lightMap=o.lightMap,this.lightMapIntensity=o.lightMapIntensity,this.aoMap=o.aoMap,this.aoMapIntensity=o.aoMapIntensity,this.emissive.copy(o.emissive),this.emissiveMap=o.emissiveMap,this.emissiveIntensity=o.emissiveIntensity,this.bumpMap=o.bumpMap,this.bumpScale=o.bumpScale,this.normalMap=o.normalMap,this.normalMapType=o.normalMapType,this.normalScale.copy(o.normalScale),this.displacementMap=o.displacementMap,this.displacementScale=o.displacementScale,this.displacementBias=o.displacementBias,this.specularMap=o.specularMap,this.alphaMap=o.alphaMap,this.envMap=o.envMap,this.combine=o.combine,this.reflectivity=o.reflectivity,this.refractionRatio=o.refractionRatio,this.wireframe=o.wireframe,this.wireframeLinewidth=o.wireframeLinewidth,this.wireframeLinecap=o.wireframeLinecap,this.wireframeLinejoin=o.wireframeLinejoin,this.flatShading=o.flatShading,this.fog=o.fog,this}}class TC extends Fl{constructor(o){super(),this.isMeshToonMaterial=!0,this.defines={TOON:""},this.type="MeshToonMaterial",this.color=new rs(16777215),this.map=null,this.gradientMap=null,this.lightMap=null,this.lightMapIntensity=1,this.aoMap=null,this.aoMapIntensity=1,this.emissive=new rs(0),this.emissiveIntensity=1,this.emissiveMap=null,this.bumpMap=null,this.bumpScale=1,this.normalMap=null,this.normalMapType=Nl,this.normalScale=new Sr(1,1),this.displacementMap=null,this.displacementScale=1,this.displacementBias=0,this.alphaMap=null,this.wireframe=!1,this.wireframeLinewidth=1,this.wireframeLinecap="round",this.wireframeLinejoin="round",this.fog=!0,this.setValues(o)}copy(o){return super.copy(o),this.color.copy(o.color),this.map=o.map,this.gradientMap=o.gradientMap,this.lightMap=o.lightMap,this.lightMapIntensity=o.lightMapIntensity,this.aoMap=o.aoMap,this.aoMapIntensity=o.aoMapIntensity,this.emissive.copy(o.emissive),this.emissiveMap=o.emissiveMap,this.emissiveIntensity=o.emissiveIntensity,this.bumpMap=o.bumpMap,this.bumpScale=o.bumpScale,this.normalMap=o.normalMap,this.normalMapType=o.normalMapType,this.normalScale.copy(o.normalScale),this.displacementMap=o.displacementMap,this.displacementScale=o.displacementScale,this.displacementBias=o.displacementBias,this.alphaMap=o.alphaMap,this.wireframe=o.wireframe,this.wireframeLinewidth=o.wireframeLinewidth,this.wireframeLinecap=o.wireframeLinecap,this.wireframeLinejoin=o.wireframeLinejoin,this.fog=o.fog,this}}class wm extends Fl{constructor(o){super(),this.isMeshNormalMaterial=!0,this.type="MeshNormalMaterial",this.bumpMap=null,this.bumpScale=1,this.normalMap=null,this.normalMapType=Nl,this.normalScale=new Sr(1,1),this.displacementMap=null,this.displacementScale=1,this.displacementBias=0,this.wireframe=!1,this.wireframeLinewidth=1,this.flatShading=!1,this.setValues(o)}copy(o){return super.copy(o),this.bumpMap=o.bumpMap,this.bumpScale=o.bumpScale,this.normalMap=o.normalMap,this.normalMapType=o.normalMapType,this.normalScale.copy(o.normalScale),this.displacementMap=o.displacementMap,this.displacementScale=o.displacementScale,this.displacementBias=o.displacementBias,this.wireframe=o.wireframe,this.wireframeLinewidth=o.wireframeLinewidth,this.flatShading=o.flatShading,this}}class yE extends Fl{constructor(o){super(),this.isMeshLambertMaterial=!0,this.type="MeshLambertMaterial",this.color=new rs(16777215),this.map=null,this.lightMap=null,this.lightMapIntensity=1,this.aoMap=null,this.aoMapIntensity=1,this.emissive=new rs(0),this.emissiveIntensity=1,this.emissiveMap=null,this.bumpMap=null,this.bumpScale=1,this.normalMap=null,this.normalMapType=Nl,this.normalScale=new Sr(1,1),this.displacementMap=null,this.displacementScale=1,this.displacementBias=0,this.specularMap=null,this.alphaMap=null,this.envMap=null,this.combine=Cs,this.reflectivity=1,this.refractionRatio=.98,this.wireframe=!1,this.wireframeLinewidth=1,this.wireframeLinecap="round",this.wireframeLinejoin="round",this.flatShading=!1,this.fog=!0,this.setValues(o)}copy(o){return super.copy(o),this.color.copy(o.color),this.map=o.map,this.lightMap=o.lightMap,this.lightMapIntensity=o.lightMapIntensity,this.aoMap=o.aoMap,this.aoMapIntensity=o.aoMapIntensity,this.emissive.copy(o.emissive),this.emissiveMap=o.emissiveMap,this.emissiveIntensity=o.emissiveIntensity,this.bumpMap=o.bumpMap,this.bumpScale=o.bumpScale,this.normalMap=o.normalMap,this.normalMapType=o.normalMapType,this.normalScale.copy(o.normalScale),this.displacementMap=o.displacementMap,this.displacementScale=o.displacementScale,this.displacementBias=o.displacementBias,this.specularMap=o.specularMap,this.alphaMap=o.alphaMap,this.envMap=o.envMap,this.combine=o.combine,this.reflectivity=o.reflectivity,this.refractionRatio=o.refractionRatio,this.wireframe=o.wireframe,this.wireframeLinewidth=o.wireframeLinewidth,this.wireframeLinecap=o.wireframeLinecap,this.wireframeLinejoin=o.wireframeLinejoin,this.flatShading=o.flatShading,this.fog=o.fog,this}}class RT extends Fl{constructor(o){super(),this.isMeshMatcapMaterial=!0,this.defines={MATCAP:""},this.type="MeshMatcapMaterial",this.color=new rs(16777215),this.matcap=null,this.map=null,this.bumpMap=null,this.bumpScale=1,this.normalMap=null,this.normalMapType=Nl,this.normalScale=new Sr(1,1),this.displacementMap=null,this.displacementScale=1,this.displacementBias=0,this.alphaMap=null,this.flatShading=!1,this.fog=!0,this.setValues(o)}copy(o){return super.copy(o),this.defines={MATCAP:""},this.color.copy(o.color),this.matcap=o.matcap,this.map=o.map,this.bumpMap=o.bumpMap,this.bumpScale=o.bumpScale,this.normalMap=o.normalMap,this.normalMapType=o.normalMapType,this.normalScale.copy(o.normalScale),this.displacementMap=o.displacementMap,this.displacementScale=o.displacementScale,this.displacementBias=o.displacementBias,this.alphaMap=o.alphaMap,this.flatShading=o.flatShading,this.fog=o.fog,this}}class BT extends Ju{constructor(o){super(),this.isLineDashedMaterial=!0,this.type="LineDashedMaterial",this.scale=1,this.dashSize=3,this.gapSize=1,this.setValues(o)}copy(o){return super.copy(o),this.scale=o.scale,this.dashSize=o.dashSize,this.gapSize=o.gapSize,this}}function qp(dt,o,g){return IC(dt)?new dt.constructor(dt.subarray(o,g!==void 0?g:dt.length)):dt.slice(o,g)}function Hv(dt,o,g){return!dt||!g&&dt.constructor===o?dt:typeof o.BYTES_PER_ELEMENT=="number"?new o(dt):Array.prototype.slice.call(dt)}function IC(dt){return ArrayBuffer.isView(dt)&&!(dt instanceof DataView)}function Mx(dt){const o=dt.length,g=new Array(o);for(let $=0;$!==o;++$)g[$]=$;return g.sort(function($,_e){return dt[$]-dt[_e]}),g}function wE(dt,o,g){const $=dt.length,_e=new dt.constructor($);for(let rt=0,at=0;at!==$;++rt){const ct=g[rt]*o;for(let ft=0;ft!==o;++ft)_e[at++]=dt[ct+ft]}return _e}function nw(dt,o,g,$){let _e=1,rt=dt[0];for(;rt!==void 0&&rt[$]===void 0;)rt=dt[_e++];if(rt===void 0)return;let at=rt[$];if(at!==void 0)if(Array.isArray(at))do at=rt[$],at!==void 0&&(o.push(rt.time),g.push.apply(g,at)),rt=dt[_e++];while(rt!==void 0);else if(at.toArray!==void 0)do at=rt[$],at!==void 0&&(o.push(rt.time),at.toArray(g,g.length)),rt=dt[_e++];while(rt!==void 0);else do at=rt[$],at!==void 0&&(o.push(rt.time),g.push(at)),rt=dt[_e++];while(rt!==void 0)}var kT=Object.freeze({__proto__:null,arraySlice:qp,convertArray:Hv,isTypedArray:IC,getKeyframeOrder:Mx,sortedArray:wE,flattenJSON:nw,subclip:function(dt,o,g,$,_e=30){const rt=dt.clone();rt.name=o;const at=[];for(let ft=0;ft<rt.tracks.length;++ft){const mt=rt.tracks[ft],bt=mt.getValueSize(),Tt=[],St=[];for(let It=0;It<mt.times.length;++It){const Rt=mt.times[It]*_e;if(!(Rt<g||Rt>=$)){Tt.push(mt.times[It]);for(let Dt=0;Dt<bt;++Dt)St.push(mt.values[It*bt+Dt])}}Tt.length!==0&&(mt.times=Hv(Tt,mt.times.constructor),mt.values=Hv(St,mt.values.constructor),at.push(mt))}rt.tracks=at;let ct=1/0;for(let ft=0;ft<rt.tracks.length;++ft)ct>rt.tracks[ft].times[0]&&(ct=rt.tracks[ft].times[0]);for(let ft=0;ft<rt.tracks.length;++ft)rt.tracks[ft].shift(-1*ct);return rt.resetDuration(),rt},makeClipAdditive:function(dt,o=0,g=dt,$=30){$<=0&&($=30);const _e=g.tracks.length,rt=o/$;for(let at=0;at<_e;++at){const ct=g.tracks[at],ft=ct.ValueTypeName;if(ft==="bool"||ft==="string")continue;const mt=dt.tracks.find(function(Nt){return Nt.name===ct.name&&Nt.ValueTypeName===ft});if(mt===void 0)continue;let bt=0;const Tt=ct.getValueSize();ct.createInterpolant.isInterpolantFactoryMethodGLTFCubicSpline&&(bt=Tt/3);let St=0;const It=mt.getValueSize();mt.createInterpolant.isInterpolantFactoryMethodGLTFCubicSpline&&(St=It/3);const Rt=ct.times.length-1;let Dt;if(rt<=ct.times[0]){const Nt=bt,zt=Tt-bt;Dt=qp(ct.values,Nt,zt)}else if(rt>=ct.times[Rt]){const Nt=Rt*Tt+bt,zt=Nt+Tt-bt;Dt=qp(ct.values,Nt,zt)}else{const Nt=ct.createInterpolant(),zt=bt,Xt=Tt-bt;Nt.evaluate(rt),Dt=qp(Nt.resultBuffer,zt,Xt)}ft==="quaternion"&&new iu().fromArray(Dt).normalize().conjugate().toArray(Dt);const Ft=mt.times.length;for(let Nt=0;Nt<Ft;++Nt){const zt=Nt*It+St;if(ft==="quaternion")iu.multiplyQuaternionsFlat(mt.values,zt,Dt,0,mt.values,zt);else{const Xt=It-2*St;for(let tn=0;tn<Xt;++tn)mt.values[zt+tn]-=Dt[tn]}}}return dt.blendMode=rp,dt}});class iw{constructor(o,g,$,_e){this.parameterPositions=o,this._cachedIndex=0,this.resultBuffer=_e!==void 0?_e:new g.constructor($),this.sampleValues=g,this.valueSize=$,this.settings=null,this.DefaultSettings_={}}evaluate(o){const g=this.parameterPositions;let $=this._cachedIndex,_e=g[$],rt=g[$-1];e:{t:{let at;n:{i:if(!(o<_e)){for(let ct=$+2;;){if(_e===void 0){if(o<rt)break i;return $=g.length,this._cachedIndex=$,this.copySampleValue_($-1)}if($===ct)break;if(rt=_e,_e=g[++$],o<_e)break t}at=g.length;break n}if(o>=rt)break e;{const ct=g[1];o<ct&&($=2,rt=ct);for(let ft=$-2;;){if(rt===void 0)return this._cachedIndex=0,this.copySampleValue_(0);if($===ft)break;if(_e=rt,rt=g[--$-1],o>=rt)break t}at=$,$=0}}for(;$<at;){const ct=$+at>>>1;o<g[ct]?at=ct:$=ct+1}if(_e=g[$],rt=g[$-1],rt===void 0)return this._cachedIndex=0,this.copySampleValue_(0);if(_e===void 0)return $=g.length,this._cachedIndex=$,this.copySampleValue_($-1)}this._cachedIndex=$,this.intervalChanged_($,rt,_e)}return this.interpolate_($,rt,o,_e)}getSettings_(){return this.settings||this.DefaultSettings_}copySampleValue_(o){const g=this.resultBuffer,$=this.sampleValues,_e=this.valueSize,rt=o*_e;for(let at=0;at!==_e;++at)g[at]=$[rt+at];return g}interpolate_(){throw new Error("call to abstract method")}intervalChanged_(){}}class P0 extends iw{constructor(o,g,$,_e){super(o,g,$,_e),this._weightPrev=-0,this._offsetPrev=-0,this._weightNext=-0,this._offsetNext=-0,this.DefaultSettings_={endingStart:Do,endingEnd:Do}}intervalChanged_(o,g,$){const _e=this.parameterPositions;let rt=o-2,at=o+1,ct=_e[rt],ft=_e[at];if(ct===void 0)switch(this.getSettings_().endingStart){case xp:rt=o,ct=2*g-$;break;case Nm:rt=_e.length-2,ct=g+_e[rt]-_e[rt+1];break;default:rt=o,ct=$}if(ft===void 0)switch(this.getSettings_().endingEnd){case xp:at=o,ft=2*$-g;break;case Nm:at=1,ft=$+_e[1]-_e[0];break;default:at=o-1,ft=g}const mt=.5*($-g),bt=this.valueSize;this._weightPrev=mt/(g-ct),this._weightNext=mt/(ft-$),this._offsetPrev=rt*bt,this._offsetNext=at*bt}interpolate_(o,g,$,_e){const rt=this.resultBuffer,at=this.sampleValues,ct=this.valueSize,ft=o*ct,mt=ft-ct,bt=this._offsetPrev,Tt=this._offsetNext,St=this._weightPrev,It=this._weightNext,Rt=($-g)/(_e-g),Dt=Rt*Rt,Ft=Dt*Rt,Nt=-St*Ft+2*St*Dt-St*Rt,zt=(1+St)*Ft+(-1.5-2*St)*Dt+(-.5+St)*Rt+1,Xt=(-1-It)*Ft+(1.5+It)*Dt+.5*Rt,tn=It*Ft-It*Dt;for(let sn=0;sn!==ct;++sn)rt[sn]=Nt*at[bt+sn]+zt*at[mt+sn]+Xt*at[ft+sn]+tn*at[Tt+sn];return rt}}class Sl extends iw{constructor(o,g,$,_e){super(o,g,$,_e)}interpolate_(o,g,$,_e){const rt=this.resultBuffer,at=this.sampleValues,ct=this.valueSize,ft=o*ct,mt=ft-ct,bt=($-g)/(_e-g),Tt=1-bt;for(let St=0;St!==ct;++St)rt[St]=at[mt+St]*Tt+at[ft+St]*bt;return rt}}class OT extends iw{constructor(o,g,$,_e){super(o,g,$,_e)}interpolate_(o){return this.copySampleValue_(o-1)}}class Pl{constructor(o,g,$,_e){if(o===void 0)throw new Error("THREE.KeyframeTrack: track name is undefined");if(g===void 0||g.length===0)throw new Error("THREE.KeyframeTrack: no keyframes in track named "+o);this.name=o,this.times=Hv(g,this.TimeBufferType),this.values=Hv($,this.ValueBufferType),this.setInterpolation(_e||this.DefaultInterpolation)}static toJSON(o){const g=o.constructor;let $;if(g.toJSON!==this.toJSON)$=g.toJSON(o);else{$={name:o.name,times:Hv(o.times,Array),values:Hv(o.values,Array)};const _e=o.getInterpolation();_e!==o.DefaultInterpolation&&($.interpolation=_e)}return $.type=o.ValueTypeName,$}InterpolantFactoryMethodDiscrete(o){return new OT(this.times,this.values,this.getValueSize(),o)}InterpolantFactoryMethodLinear(o){return new Sl(this.times,this.values,this.getValueSize(),o)}InterpolantFactoryMethodSmooth(o){return new P0(this.times,this.values,this.getValueSize(),o)}setInterpolation(o){let g;switch(o){case um:g=this.InterpolantFactoryMethodDiscrete;break;case a0:g=this.InterpolantFactoryMethodLinear;break;case i_:g=this.InterpolantFactoryMethodSmooth}if(g===void 0){const $="unsupported interpolation for "+this.ValueTypeName+" keyframe track named "+this.name;if(this.createInterpolant===void 0){if(o===this.DefaultInterpolation)throw new Error($);this.setInterpolation(this.DefaultInterpolation)}return console.warn("THREE.KeyframeTrack:",$),this}return this.createInterpolant=g,this}getInterpolation(){switch(this.createInterpolant){case this.InterpolantFactoryMethodDiscrete:return um;case this.InterpolantFactoryMethodLinear:return a0;case this.InterpolantFactoryMethodSmooth:return i_}}getValueSize(){return this.values.length/this.times.length}shift(o){if(o!==0){const g=this.times;for(let $=0,_e=g.length;$!==_e;++$)g[$]+=o}return this}scale(o){if(o!==1){const g=this.times;for(let $=0,_e=g.length;$!==_e;++$)g[$]*=o}return this}trim(o,g){const $=this.times,_e=$.length;let rt=0,at=_e-1;for(;rt!==_e&&$[rt]<o;)++rt;for(;at!==-1&&$[at]>g;)--at;if(++at,rt!==0||at!==_e){rt>=at&&(at=Math.max(at,1),rt=at-1);const ct=this.getValueSize();this.times=qp($,rt,at),this.values=qp(this.values,rt*ct,at*ct)}return this}validate(){let o=!0;const g=this.getValueSize();g-Math.floor(g)!=0&&(console.error("THREE.KeyframeTrack: Invalid value size in track.",this),o=!1);const $=this.times,_e=this.values,rt=$.length;rt===0&&(console.error("THREE.KeyframeTrack: Track is empty.",this),o=!1);let at=null;for(let ct=0;ct!==rt;ct++){const ft=$[ct];if(typeof ft=="number"&&isNaN(ft)){console.error("THREE.KeyframeTrack: Time is not a valid number.",this,ct,ft),o=!1;break}if(at!==null&&at>ft){console.error("THREE.KeyframeTrack: Out of order keys.",this,ct,ft,at),o=!1;break}at=ft}if(_e!==void 0&&IC(_e))for(let ct=0,ft=_e.length;ct!==ft;++ct){const mt=_e[ct];if(isNaN(mt)){console.error("THREE.KeyframeTrack: Value is not a valid number.",this,ct,mt),o=!1;break}}return o}optimize(){const o=qp(this.times),g=qp(this.values),$=this.getValueSize(),_e=this.getInterpolation()===i_,rt=o.length-1;let at=1;for(let ct=1;ct<rt;++ct){let ft=!1;const mt=o[ct];if(mt!==o[ct+1]&&(ct!==1||mt!==o[0]))if(_e)ft=!0;else{const bt=ct*$,Tt=bt-$,St=bt+$;for(let It=0;It!==$;++It){const Rt=g[bt+It];if(Rt!==g[Tt+It]||Rt!==g[St+It]){ft=!0;break}}}if(ft){if(ct!==at){o[at]=o[ct];const bt=ct*$,Tt=at*$;for(let St=0;St!==$;++St)g[Tt+St]=g[bt+St]}++at}}if(rt>0){o[at]=o[rt];for(let ct=rt*$,ft=at*$,mt=0;mt!==$;++mt)g[ft+mt]=g[ct+mt];++at}return at!==o.length?(this.times=qp(o,0,at),this.values=qp(g,0,at*$)):(this.times=o,this.values=g),this}clone(){const o=qp(this.times,0),g=qp(this.values,0),$=new this.constructor(this.name,o,g);return $.createInterpolant=this.createInterpolant,$}}Pl.prototype.TimeBufferType=Float32Array,Pl.prototype.ValueBufferType=Float32Array,Pl.prototype.DefaultInterpolation=a0;class Xo extends Pl{}Xo.prototype.ValueTypeName="bool",Xo.prototype.ValueBufferType=Array,Xo.prototype.DefaultInterpolation=um,Xo.prototype.InterpolantFactoryMethodLinear=void 0,Xo.prototype.InterpolantFactoryMethodSmooth=void 0;class Tx extends Pl{}Tx.prototype.ValueTypeName="color";class GA extends Pl{}GA.prototype.ValueTypeName="number";class LT extends iw{constructor(o,g,$,_e){super(o,g,$,_e)}interpolate_(o,g,$,_e){const rt=this.resultBuffer,at=this.sampleValues,ct=this.valueSize,ft=($-g)/(_e-g);let mt=o*ct;for(let bt=mt+ct;mt!==bt;mt+=4)iu.slerpFlat(rt,0,at,mt-ct,at,mt,ft);return rt}}class HA extends Pl{InterpolantFactoryMethodLinear(o){return new LT(this.times,this.values,this.getValueSize(),o)}}HA.prototype.ValueTypeName="quaternion",HA.prototype.DefaultInterpolation=a0,HA.prototype.InterpolantFactoryMethodSmooth=void 0;class WA extends Pl{}WA.prototype.ValueTypeName="string",WA.prototype.ValueBufferType=Array,WA.prototype.DefaultInterpolation=um,WA.prototype.InterpolantFactoryMethodLinear=void 0,WA.prototype.InterpolantFactoryMethodSmooth=void 0;class qA extends Pl{}qA.prototype.ValueTypeName="vector";class iv{constructor(o,g=-1,$,_e=Yl){this.name=o,this.tracks=$,this.duration=g,this.blendMode=_e,this.uuid=Es(),this.duration<0&&this.resetDuration()}static parse(o){const g=[],$=o.tracks,_e=1/(o.fps||1);for(let at=0,ct=$.length;at!==ct;++at)g.push(Ix($[at]).scale(_e));const rt=new this(o.name,o.duration,g,o.blendMode);return rt.uuid=o.uuid,rt}static toJSON(o){const g=[],$=o.tracks,_e={name:o.name,duration:o.duration,tracks:g,uuid:o.uuid,blendMode:o.blendMode};for(let rt=0,at=$.length;rt!==at;++rt)g.push(Pl.toJSON($[rt]));return _e}static CreateFromMorphTargetSequence(o,g,$,_e){const rt=g.length,at=[];for(let ct=0;ct<rt;ct++){let ft=[],mt=[];ft.push((ct+rt-1)%rt,ct,(ct+1)%rt),mt.push(0,1,0);const bt=Mx(ft);ft=wE(ft,1,bt),mt=wE(mt,1,bt),_e||ft[0]!==0||(ft.push(rt),mt.push(mt[0])),at.push(new GA(".morphTargetInfluences["+g[ct].name+"]",ft,mt).scale(1/$))}return new this(o,-1,at)}static findByName(o,g){let $=o;if(!Array.isArray(o)){const _e=o;$=_e.geometry&&_e.geometry.animations||_e.animations}for(let _e=0;_e<$.length;_e++)if($[_e].name===g)return $[_e];return null}static CreateClipsFromMorphTargetSequences(o,g,$){const _e={},rt=/^([\w-]*?)([\d]+)$/;for(let ct=0,ft=o.length;ct<ft;ct++){const mt=o[ct],bt=mt.name.match(rt);if(bt&&bt.length>1){const Tt=bt[1];let St=_e[Tt];St||(_e[Tt]=St=[]),St.push(mt)}}const at=[];for(const ct in _e)at.push(this.CreateFromMorphTargetSequence(ct,_e[ct],g,$));return at}static parseAnimation(o,g){if(!o)return console.error("THREE.AnimationClip: No animation in JSONLoader data."),null;const $=function(bt,Tt,St,It,Rt){if(St.length!==0){const Dt=[],Ft=[];nw(St,Dt,Ft,It),Dt.length!==0&&Rt.push(new bt(Tt,Dt,Ft))}},_e=[],rt=o.name||"default",at=o.fps||30,ct=o.blendMode;let ft=o.length||-1;const mt=o.hierarchy||[];for(let bt=0;bt<mt.length;bt++){const Tt=mt[bt].keys;if(Tt&&Tt.length!==0)if(Tt[0].morphTargets){const St={};let It;for(It=0;It<Tt.length;It++)if(Tt[It].morphTargets)for(let Rt=0;Rt<Tt[It].morphTargets.length;Rt++)St[Tt[It].morphTargets[Rt]]=-1;for(const Rt in St){const Dt=[],Ft=[];for(let Nt=0;Nt!==Tt[It].morphTargets.length;++Nt){const zt=Tt[It];Dt.push(zt.time),Ft.push(zt.morphTarget===Rt?1:0)}_e.push(new GA(".morphTargetInfluence["+Rt+"]",Dt,Ft))}ft=St.length*at}else{const St=".bones["+g[bt].name+"]";$(qA,St+".position",Tt,"pos",_e),$(HA,St+".quaternion",Tt,"rot",_e),$(qA,St+".scale",Tt,"scl",_e)}}return _e.length===0?null:new this(rt,ft,_e,ct)}resetDuration(){let o=0;for(let g=0,$=this.tracks.length;g!==$;++g){const _e=this.tracks[g];o=Math.max(o,_e.times[_e.times.length-1])}return this.duration=o,this}trim(){for(let o=0;o<this.tracks.length;o++)this.tracks[o].trim(0,this.duration);return this}validate(){let o=!0;for(let g=0;g<this.tracks.length;g++)o=o&&this.tracks[g].validate();return o}optimize(){for(let o=0;o<this.tracks.length;o++)this.tracks[o].optimize();return this}clone(){const o=[];for(let g=0;g<this.tracks.length;g++)o.push(this.tracks[g].clone());return new this.constructor(this.name,this.duration,o,this.blendMode)}toJSON(){return this.constructor.toJSON(this)}}function Ix(dt){if(dt.type===void 0)throw new Error("THREE.KeyframeTrack: track type undefined, can not parse");const o=function(g){switch(g.toLowerCase()){case"scalar":case"double":case"float":case"number":case"integer":return GA;case"vector":case"vector2":case"vector3":case"vector4":return qA;case"color":return Tx;case"quaternion":return HA;case"bool":case"boolean":return Xo;case"string":return WA}throw new Error("THREE.KeyframeTrack: Unsupported typeName: "+g)}(dt.type);if(dt.times===void 0){const g=[],$=[];nw(dt.keys,g,$,"value"),dt.times=g,dt.values=$}return o.parse!==void 0?o.parse(dt):new o(dt.name,dt.times,dt.values,dt.interpolation)}const Wv={enabled:!1,files:{},add:function(dt,o){this.enabled!==!1&&(this.files[dt]=o)},get:function(dt,o){return this.enabled===!1?o?Promise.resolve():void 0:o?Promise.resolve(this.files[dt]):this.files[dt]},remove:function(dt){delete this.files[dt]},clear:function(){this.files={}}};class rv{constructor(o,g,$){const _e=this;let rt,at=!1,ct=0,ft=0;const mt=[];this.onStart=void 0,this.onLoad=o,this.onProgress=g,this.onError=$,this.itemStart=function(bt){ft++,at===!1&&_e.onStart!==void 0&&_e.onStart(bt,ct,ft),at=!0},this.itemEnd=function(bt){ct++,_e.onProgress!==void 0&&_e.onProgress(bt,ct,ft),ct===ft&&(at=!1,_e.onLoad!==void 0&&_e.onLoad())},this.itemError=function(bt){_e.onError!==void 0&&_e.onError(bt)},this.resolveURL=function(bt){return rt?rt(bt):bt},this.setURLModifier=function(bt){return rt=bt,this},this.addHandler=function(bt,Tt){return mt.push(bt,Tt),this},this.removeHandler=function(bt){const Tt=mt.indexOf(bt);return Tt!==-1&&mt.splice(Tt,2),this},this.getHandler=function(bt){for(let Tt=0,St=mt.length;Tt<St;Tt+=2){const It=mt[Tt],Rt=mt[Tt+1];if(It.global&&(It.lastIndex=0),It.test(bt))return Rt}return null}}}const YA=new rv;class kp{constructor(o){this.manager=o!==void 0?o:YA,this.crossOrigin="anonymous",this.withCredentials=!1,this.path="",this.resourcePath="",this.requestHeader={}}load(){}loadAsync(o,g){const $=this;return new Promise(function(_e,rt){$.load(o,_e,g,rt)})}parse(){}setCrossOrigin(o){return this.crossOrigin=o,this}setWithCredentials(o){return this.withCredentials=o,this}setPath(o){return this.path=o,this}setResourcePath(o){return this.resourcePath=o,this}setRequestHeader(o){return this.requestHeader=o,this}}const R0={};class T_ extends Error{constructor(o,g){super(o),this.response=g}}class sv extends kp{constructor(o){super(o),this.responseType="text"}load(o,g,$,_e){o===void 0&&(o=""),this.path!==void 0&&(o=this.path+o),o=this.manager.resolveURL(o),Wv.get(o,this.responseType,this.mimeType).then(rt=>{if(rt!==void 0)return this.manager.itemStart(o),setTimeout(()=>{g&&g(rt),this.manager.itemEnd(o)},0),rt;if(R0[o]!==void 0)return void R0[o].push({onLoad:g,onProgress:$,onError:_e});R0[o]=[],R0[o].push({onLoad:g,onProgress:$,onError:_e});const at=new Request(o,{headers:new Headers(this.requestHeader),credentials:this.withCredentials?"include":"same-origin"}),ct=this.mimeType,ft=this.responseType;fetch(at).then(mt=>{if(mt.status===200||mt.status===0){if(mt.status===0&&console.warn("THREE.FileLoader: HTTP Status 0 received."),typeof ReadableStream>"u"||mt.body===void 0||mt.body.getReader===void 0)return mt;const bt=R0[o],Tt=mt.body.getReader(),St=mt.headers.get("Content-Length"),It=St?parseInt(St):0,Rt=It!==0;let Dt=0;const Ft=new ReadableStream({start(Nt){(function zt(){Tt.read().then(({done:Xt,value:tn})=>{if(Xt)Nt.close();else{Dt+=tn.byteLength;const sn=new ProgressEvent("progress",{lengthComputable:Rt,loaded:Dt,total:It});for(let ln=0,kn=bt.length;ln<kn;ln++){const Ln=bt[ln];Ln.onProgress&&Ln.onProgress(sn)}Nt.enqueue(tn),zt()}})})()}});return new Response(Ft)}throw new T_(`fetch for "${mt.url}" responded with ${mt.status}: ${mt.statusText}`,mt)}).then(mt=>{switch(ft){case"arraybuffer":return mt.arrayBuffer();case"blob":return mt.blob();case"document":return mt.text().then(bt=>new DOMParser().parseFromString(bt,ct));case"json":return mt.json();default:if(ct===void 0)return mt.text();{const bt=/charset="?([^;"\s]*)"?/i.exec(ct),Tt=bt&&bt[1]?bt[1].toLowerCase():void 0,St=new TextDecoder(Tt);return mt.arrayBuffer().then(It=>St.decode(It))}}}).then(mt=>{Wv.add(o,mt,this.responseType);const bt=R0[o];delete R0[o];for(let Tt=0,St=bt.length;Tt<St;Tt++){const It=bt[Tt];It.onLoad&&It.onLoad(mt)}}).catch(mt=>{const bt=R0[o];if(bt===void 0)throw this.manager.itemError(o),mt;delete R0[o];for(let Tt=0,St=bt.length;Tt<St;Tt++){const It=bt[Tt];It.onError&&It.onError(mt)}this.manager.itemError(o)}).finally(()=>{this.manager.itemEnd(o)}),this.manager.itemStart(o)})}setResponseType(o){return this.responseType=o,this}setMimeType(o){return this.mimeType=o,this}}class XA extends kp{constructor(o){super(o)}load(o,g,$,_e){const rt=this,at=new sv(this.manager);at.setPath(this.path),at.setRequestHeader(this.requestHeader),at.setWithCredentials(this.withCredentials),at.load(o,function(ct){try{g(rt.parse(JSON.parse(ct)))}catch(ft){_e?_e(ft):console.error(ft),rt.manager.itemError(o)}},$,_e)}parse(o){const g=[];for(let $=0;$<o.length;$++){const _e=iv.parse(o[$]);g.push(_e)}return g}}class rw extends kp{constructor(o){super(o)}load(o,g,$,_e){const rt=this,at=[],ct=new ET,ft=new sv(this.manager);ft.setPath(this.path),ft.setResponseType("arraybuffer"),ft.setRequestHeader(this.requestHeader),ft.setWithCredentials(rt.withCredentials);let mt=0;function bt(Tt){ft.load(o[Tt],function(St){const It=rt.parse(St,!0);at[Tt]={width:It.width,height:It.height,format:It.format,mipmaps:It.mipmaps},mt+=1,mt===6&&(It.mipmapCount===1&&(ct.minFilter=xa),ct.image=at,ct.format=It.format,ct.needsUpdate=!0,g&&g(ct))},$,_e)}if(Array.isArray(o))for(let Tt=0,St=o.length;Tt<St;++Tt)bt(Tt);else ft.load(o,function(Tt){const St=rt.parse(Tt,!0);if(St.isCubemap){const It=St.mipmaps.length/St.mipmapCount;for(let Rt=0;Rt<It;Rt++){at[Rt]={mipmaps:[]};for(let Dt=0;Dt<St.mipmapCount;Dt++)at[Rt].mipmaps.push(St.mipmaps[Rt*St.mipmapCount+Dt]),at[Rt].format=St.format,at[Rt].width=St.width,at[Rt].height=St.height}ct.image=at}else ct.image.width=St.width,ct.image.height=St.height,ct.mipmaps=St.mipmaps;St.mipmapCount===1&&(ct.minFilter=xa),ct.format=St.format,ct.needsUpdate=!0,g&&g(ct)},$,_e);return ct}}class ov extends kp{constructor(o){super(o)}load(o,g,$,_e){this.path!==void 0&&(o=this.path+o),o=this.manager.resolveURL(o);const rt=this,at=Wv.get(o);if(at!==void 0)return rt.manager.itemStart(o),setTimeout(function(){g&&g(at),rt.manager.itemEnd(o)},0),at;const ct=p0("img");function ft(){bt(),Wv.add(o,this),g&&g(this),rt.manager.itemEnd(o)}function mt(Tt){bt(),_e&&_e(Tt),rt.manager.itemError(o),rt.manager.itemEnd(o)}function bt(){ct.removeEventListener("load",ft,!1),ct.removeEventListener("error",mt,!1)}return ct.addEventListener("load",ft,!1),ct.addEventListener("error",mt,!1),o.slice(0,5)!=="data:"&&this.crossOrigin!==void 0&&(ct.crossOrigin=this.crossOrigin),rt.manager.itemStart(o),ct.src=o,ct}}class xm extends kp{constructor(o){super(o)}load(o,g,$,_e){const rt=new qw,at=new ov(this.manager);at.setCrossOrigin(this.crossOrigin),at.setPath(this.path);let ct=0;function ft(mt){at.load(o[mt],function(bt){rt.images[mt]=bt,ct++,ct===6&&(rt.needsUpdate=!0,g&&g(rt))},void 0,_e)}for(let mt=0;mt<o.length;++mt)ft(mt);return rt}}class wD extends kp{constructor(o){super(o)}load(o,g,$,_e){const rt=this,at=new Vy,ct=new sv(this.manager);return ct.setResponseType("arraybuffer"),ct.setRequestHeader(this.requestHeader),ct.setPath(this.path),ct.setWithCredentials(rt.withCredentials),ct.load(o,function(ft){const mt=rt.parse(ft);mt&&(mt.image!==void 0?at.image=mt.image:mt.data!==void 0&&(at.image.width=mt.width,at.image.height=mt.height,at.image.data=mt.data,at.image.complete=!0),at.wrapS=mt.wrapS!==void 0?mt.wrapS:Lo,at.wrapT=mt.wrapT!==void 0?mt.wrapT:Lo,at.magFilter=mt.magFilter!==void 0?mt.magFilter:xa,at.minFilter=mt.minFilter!==void 0?mt.minFilter:xa,at.anisotropy=mt.anisotropy!==void 0?mt.anisotropy:1,mt.encoding!==void 0&&(at.encoding=mt.encoding),mt.flipY!==void 0&&(at.flipY=mt.flipY),mt.format!==void 0&&(at.format=mt.format),mt.type!==void 0&&(at.type=mt.type),mt.mipmaps!==void 0&&(at.mipmaps=mt.mipmaps,at.minFilter=mo),mt.mipmapCount===1&&(at.minFilter=xa),mt.generateMipmaps!==void 0&&(at.generateMipmaps=mt.generateMipmaps),at.needsUpdate=!0,g&&g(at,mt))},$,_e),at}}class xD extends kp{constructor(o){super(o)}load(o,g,$,_e){const rt=new qo,at=new ov(this.manager);return at.setCrossOrigin(this.crossOrigin),at.setPath(this.path),at.load(o,function(ct){rt.image=ct,rt.needsUpdate=!0,g!==void 0&&g(rt)},$,_e),rt}}class bm extends no{constructor(o,g=1){super(),this.isLight=!0,this.type="Light",this.color=new rs(o),this.intensity=g}dispose(){}copy(o,g){return super.copy(o,g),this.color.copy(o.color),this.intensity=o.intensity,this}toJSON(o){const g=super.toJSON(o);return g.object.color=this.color.getHex(),g.object.intensity=this.intensity,this.groundColor!==void 0&&(g.object.groundColor=this.groundColor.getHex()),this.distance!==void 0&&(g.object.distance=this.distance),this.angle!==void 0&&(g.object.angle=this.angle),this.decay!==void 0&&(g.object.decay=this.decay),this.penumbra!==void 0&&(g.object.penumbra=this.penumbra),this.shadow!==void 0&&(g.object.shadow=this.shadow.toJSON()),g}}class ep extends bm{constructor(o,g,$){super(o,$),this.isHemisphereLight=!0,this.type="HemisphereLight",this.position.copy(no.DefaultUp),this.updateMatrix(),this.groundColor=new rs(g)}copy(o,g){return super.copy(o,g),this.groundColor.copy(o.groundColor),this}}const DC=new Os,xE=new fn,qv=new fn;class Dx{constructor(o){this.camera=o,this.bias=0,this.normalBias=0,this.radius=1,this.blurSamples=8,this.mapSize=new Sr(512,512),this.map=null,this.mapPass=null,this.matrix=new Os,this.autoUpdate=!0,this.needsUpdate=!1,this._frustum=new Ym,this._frameExtents=new Sr(1,1),this._viewportCount=1,this._viewports=[new _o(0,0,1,1)]}getViewportCount(){return this._viewportCount}getFrustum(){return this._frustum}updateMatrices(o){const g=this.camera,$=this.matrix;xE.setFromMatrixPosition(o.matrixWorld),g.position.copy(xE),qv.setFromMatrixPosition(o.target.matrixWorld),g.lookAt(qv),g.updateMatrixWorld(),DC.multiplyMatrices(g.projectionMatrix,g.matrixWorldInverse),this._frustum.setFromProjectionMatrix(DC),$.set(.5,0,0,.5,0,.5,0,.5,0,0,.5,.5,0,0,0,1),$.multiply(g.projectionMatrix),$.multiply(g.matrixWorldInverse)}getViewport(o){return this._viewports[o]}getFrameExtents(){return this._frameExtents}dispose(){this.map&&this.map.dispose(),this.mapPass&&this.mapPass.dispose()}copy(o){return this.camera=o.camera.clone(),this.bias=o.bias,this.normalBias=o.normalBias,this.radius=o.radius,this.mapSize.copy(o.mapSize),this}clone(){return new this.constructor().copy(this)}toJSON(){const o={};return this.bias!==0&&(o.bias=this.bias),this.normalBias!==0&&(o.normalBias=this.normalBias),this.radius!==1&&(o.radius=this.radius),this.mapSize.x===512&&this.mapSize.y===512||(o.mapSize=this.mapSize.toArray()),o.camera=this.camera.toJSON(!1).object,delete o.camera.matrix,o}}class PC extends Dx{constructor(){super(new wu(50,1,.5,500)),this.isSpotLightShadow=!0,this.focus=1}updateMatrices(o){const g=this.camera,$=2*oA*o.angle*this.focus,_e=this.mapSize.width/this.mapSize.height,rt=o.distance||g.far;$===g.fov&&_e===g.aspect&&rt===g.far||(g.fov=$,g.aspect=_e,g.far=rt,g.updateProjectionMatrix()),super.updateMatrices(o)}copy(o){return super.copy(o),this.focus=o.focus,this}}class NT extends bm{constructor(o,g,$=0,_e=Math.PI/3,rt=0,at=1){super(o,g),this.isSpotLight=!0,this.type="SpotLight",this.position.copy(no.DefaultUp),this.updateMatrix(),this.target=new no,this.distance=$,this.angle=_e,this.penumbra=rt,this.decay=at,this.map=null,this.shadow=new PC}get power(){return this.intensity*Math.PI}set power(o){this.intensity=o/Math.PI}dispose(){this.shadow.dispose()}copy(o,g){return super.copy(o,g),this.distance=o.distance,this.angle=o.angle,this.penumbra=o.penumbra,this.decay=o.decay,this.target=o.target.clone(),this.shadow=o.shadow.clone(),this}}const RC=new Os,KA=new fn,Px=new fn;class BC extends Dx{constructor(){super(new wu(90,1,.5,500)),this.isPointLightShadow=!0,this._frameExtents=new Sr(4,2),this._viewportCount=6,this._viewports=[new _o(2,1,1,1),new _o(0,1,1,1),new _o(3,1,1,1),new _o(1,1,1,1),new _o(3,0,1,1),new _o(1,0,1,1)],this._cubeDirections=[new fn(1,0,0),new fn(-1,0,0),new fn(0,0,1),new fn(0,0,-1),new fn(0,1,0),new fn(0,-1,0)],this._cubeUps=[new fn(0,1,0),new fn(0,1,0),new fn(0,1,0),new fn(0,1,0),new fn(0,0,1),new fn(0,0,-1)]}updateMatrices(o,g=0){const $=this.camera,_e=this.matrix,rt=o.distance||$.far;rt!==$.far&&($.far=rt,$.updateProjectionMatrix()),KA.setFromMatrixPosition(o.matrixWorld),$.position.copy(KA),Px.copy($.position),Px.add(this._cubeDirections[g]),$.up.copy(this._cubeUps[g]),$.lookAt(Px),$.updateMatrixWorld(),_e.makeTranslation(-KA.x,-KA.y,-KA.z),RC.multiplyMatrices($.projectionMatrix,$.matrixWorldInverse),this._frustum.setFromProjectionMatrix(RC)}}class av extends bm{constructor(o,g,$=0,_e=1){super(o,g),this.isPointLight=!0,this.type="PointLight",this.distance=$,this.decay=_e,this.shadow=new BC}get power(){return 4*this.intensity*Math.PI}set power(o){this.intensity=o/(4*Math.PI)}dispose(){this.shadow.dispose()}copy(o,g){return super.copy(o,g),this.distance=o.distance,this.decay=o.decay,this.shadow=o.shadow.clone(),this}}class UT extends Dx{constructor(){super(new U1(-5,5,5,-5,.5,500)),this.isDirectionalLightShadow=!0}}class bE extends bm{constructor(o,g){super(o,g),this.isDirectionalLight=!0,this.type="DirectionalLight",this.position.copy(no.DefaultUp),this.updateMatrix(),this.target=new no,this.shadow=new UT}dispose(){this.shadow.dispose()}copy(o){return super.copy(o),this.target=o.target.clone(),this.shadow=o.shadow.clone(),this}}class FT extends bm{constructor(o,g){super(o,g),this.isAmbientLight=!0,this.type="AmbientLight"}}class EE extends bm{constructor(o,g,$=10,_e=10){super(o,g),this.isRectAreaLight=!0,this.type="RectAreaLight",this.width=$,this.height=_e}get power(){return this.intensity*this.width*this.height*Math.PI}set power(o){this.intensity=o/(this.width*this.height*Math.PI)}copy(o){return super.copy(o),this.width=o.width,this.height=o.height,this}toJSON(o){const g=super.toJSON(o);return g.object.width=this.width,g.object.height=this.height,g}}class SE{constructor(){this.isSphericalHarmonics3=!0,this.coefficients=[];for(let o=0;o<9;o++)this.coefficients.push(new fn)}set(o){for(let g=0;g<9;g++)this.coefficients[g].copy(o[g]);return this}zero(){for(let o=0;o<9;o++)this.coefficients[o].set(0,0,0);return this}getAt(o,g){const $=o.x,_e=o.y,rt=o.z,at=this.coefficients;return g.copy(at[0]).multiplyScalar(.282095),g.addScaledVector(at[1],.488603*_e),g.addScaledVector(at[2],.488603*rt),g.addScaledVector(at[3],.488603*$),g.addScaledVector(at[4],$*_e*1.092548),g.addScaledVector(at[5],_e*rt*1.092548),g.addScaledVector(at[6],.315392*(3*rt*rt-1)),g.addScaledVector(at[7],$*rt*1.092548),g.addScaledVector(at[8],.546274*($*$-_e*_e)),g}getIrradianceAt(o,g){const $=o.x,_e=o.y,rt=o.z,at=this.coefficients;return g.copy(at[0]).multiplyScalar(.886227),g.addScaledVector(at[1],1.023328*_e),g.addScaledVector(at[2],1.023328*rt),g.addScaledVector(at[3],1.023328*$),g.addScaledVector(at[4],.858086*$*_e),g.addScaledVector(at[5],.858086*_e*rt),g.addScaledVector(at[6],.743125*rt*rt-.247708),g.addScaledVector(at[7],.858086*$*rt),g.addScaledVector(at[8],.429043*($*$-_e*_e)),g}add(o){for(let g=0;g<9;g++)this.coefficients[g].add(o.coefficients[g]);return this}addScaledSH(o,g){for(let $=0;$<9;$++)this.coefficients[$].addScaledVector(o.coefficients[$],g);return this}scale(o){for(let g=0;g<9;g++)this.coefficients[g].multiplyScalar(o);return this}lerp(o,g){for(let $=0;$<9;$++)this.coefficients[$].lerp(o.coefficients[$],g);return this}equals(o){for(let g=0;g<9;g++)if(!this.coefficients[g].equals(o.coefficients[g]))return!1;return!0}copy(o){return this.set(o.coefficients)}clone(){return new this.constructor().copy(this)}fromArray(o,g=0){const $=this.coefficients;for(let _e=0;_e<9;_e++)$[_e].fromArray(o,g+3*_e);return this}toArray(o=[],g=0){const $=this.coefficients;for(let _e=0;_e<9;_e++)$[_e].toArray(o,g+3*_e);return o}static getBasisAt(o,g){const $=o.x,_e=o.y,rt=o.z;g[0]=.282095,g[1]=.488603*_e,g[2]=.488603*rt,g[3]=.488603*$,g[4]=1.092548*$*_e,g[5]=1.092548*_e*rt,g[6]=.315392*(3*rt*rt-1),g[7]=1.092548*$*rt,g[8]=.546274*($*$-_e*_e)}}class CE extends bm{constructor(o=new SE,g=1){super(void 0,g),this.isLightProbe=!0,this.sh=o}copy(o){return super.copy(o),this.sh.copy(o.sh),this}fromJSON(o){return this.intensity=o.intensity,this.sh.fromArray(o.sh),this}toJSON(o){const g=super.toJSON(o);return g.object.sh=this.sh.toArray(),g}}class JA extends kp{constructor(o){super(o),this.textures={}}load(o,g,$,_e){const rt=this,at=new sv(rt.manager);at.setPath(rt.path),at.setRequestHeader(rt.requestHeader),at.setWithCredentials(rt.withCredentials),at.load(o,function(ct){try{g(rt.parse(JSON.parse(ct)))}catch(ft){_e?_e(ft):console.error(ft),rt.manager.itemError(o)}},$,_e)}parse(o){const g=this.textures;function $(rt){return g[rt]===void 0&&console.warn("THREE.MaterialLoader: Undefined texture",rt),g[rt]}const _e=JA.createMaterialFromType(o.type);if(o.uuid!==void 0&&(_e.uuid=o.uuid),o.name!==void 0&&(_e.name=o.name),o.color!==void 0&&_e.color!==void 0&&_e.color.setHex(o.color),o.roughness!==void 0&&(_e.roughness=o.roughness),o.metalness!==void 0&&(_e.metalness=o.metalness),o.sheen!==void 0&&(_e.sheen=o.sheen),o.sheenColor!==void 0&&(_e.sheenColor=new rs().setHex(o.sheenColor)),o.sheenRoughness!==void 0&&(_e.sheenRoughness=o.sheenRoughness),o.emissive!==void 0&&_e.emissive!==void 0&&_e.emissive.setHex(o.emissive),o.specular!==void 0&&_e.specular!==void 0&&_e.specular.setHex(o.specular),o.specularIntensity!==void 0&&(_e.specularIntensity=o.specularIntensity),o.specularColor!==void 0&&_e.specularColor!==void 0&&_e.specularColor.setHex(o.specularColor),o.shininess!==void 0&&(_e.shininess=o.shininess),o.clearcoat!==void 0&&(_e.clearcoat=o.clearcoat),o.clearcoatRoughness!==void 0&&(_e.clearcoatRoughness=o.clearcoatRoughness),o.iridescence!==void 0&&(_e.iridescence=o.iridescence),o.iridescenceIOR!==void 0&&(_e.iridescenceIOR=o.iridescenceIOR),o.iridescenceThicknessRange!==void 0&&(_e.iridescenceThicknessRange=o.iridescenceThicknessRange),o.transmission!==void 0&&(_e.transmission=o.transmission),o.thickness!==void 0&&(_e.thickness=o.thickness),o.attenuationDistance!==void 0&&(_e.attenuationDistance=o.attenuationDistance),o.attenuationColor!==void 0&&_e.attenuationColor!==void 0&&_e.attenuationColor.setHex(o.attenuationColor),o.fog!==void 0&&(_e.fog=o.fog),o.flatShading!==void 0&&(_e.flatShading=o.flatShading),o.blending!==void 0&&(_e.blending=o.blending),o.combine!==void 0&&(_e.combine=o.combine),o.side!==void 0&&(_e.side=o.side),o.shadowSide!==void 0&&(_e.shadowSide=o.shadowSide),o.opacity!==void 0&&(_e.opacity=o.opacity),o.transparent!==void 0&&(_e.transparent=o.transparent),o.alphaTest!==void 0&&(_e.alphaTest=o.alphaTest),o.depthTest!==void 0&&(_e.depthTest=o.depthTest),o.depthWrite!==void 0&&(_e.depthWrite=o.depthWrite),o.colorWrite!==void 0&&(_e.colorWrite=o.colorWrite),o.stencilWrite!==void 0&&(_e.stencilWrite=o.stencilWrite),o.stencilWriteMask!==void 0&&(_e.stencilWriteMask=o.stencilWriteMask),o.stencilFunc!==void 0&&(_e.stencilFunc=o.stencilFunc),o.stencilRef!==void 0&&(_e.stencilRef=o.stencilRef),o.stencilFuncMask!==void 0&&(_e.stencilFuncMask=o.stencilFuncMask),o.stencilFail!==void 0&&(_e.stencilFail=o.stencilFail),o.stencilZFail!==void 0&&(_e.stencilZFail=o.stencilZFail),o.stencilZPass!==void 0&&(_e.stencilZPass=o.stencilZPass),o.wireframe!==void 0&&(_e.wireframe=o.wireframe),o.wireframeLinewidth!==void 0&&(_e.wireframeLinewidth=o.wireframeLinewidth),o.wireframeLinecap!==void 0&&(_e.wireframeLinecap=o.wireframeLinecap),o.wireframeLinejoin!==void 0&&(_e.wireframeLinejoin=o.wireframeLinejoin),o.rotation!==void 0&&(_e.rotation=o.rotation),o.linewidth!==1&&(_e.linewidth=o.linewidth),o.dashSize!==void 0&&(_e.dashSize=o.dashSize),o.gapSize!==void 0&&(_e.gapSize=o.gapSize),o.scale!==void 0&&(_e.scale=o.scale),o.polygonOffset!==void 0&&(_e.polygonOffset=o.polygonOffset),o.polygonOffsetFactor!==void 0&&(_e.polygonOffsetFactor=o.polygonOffsetFactor),o.polygonOffsetUnits!==void 0&&(_e.polygonOffsetUnits=o.polygonOffsetUnits),o.dithering!==void 0&&(_e.dithering=o.dithering),o.alphaToCoverage!==void 0&&(_e.alphaToCoverage=o.alphaToCoverage),o.premultipliedAlpha!==void 0&&(_e.premultipliedAlpha=o.premultipliedAlpha),o.visible!==void 0&&(_e.visible=o.visible),o.toneMapped!==void 0&&(_e.toneMapped=o.toneMapped),o.userData!==void 0&&(_e.userData=o.userData),o.vertexColors!==void 0&&(typeof o.vertexColors=="number"?_e.vertexColors=o.vertexColors>0:_e.vertexColors=o.vertexColors),o.uniforms!==void 0)for(const rt in o.uniforms){const at=o.uniforms[rt];switch(_e.uniforms[rt]={},at.type){case"t":_e.uniforms[rt].value=$(at.value);break;case"c":_e.uniforms[rt].value=new rs().setHex(at.value);break;case"v2":_e.uniforms[rt].value=new Sr().fromArray(at.value);break;case"v3":_e.uniforms[rt].value=new fn().fromArray(at.value);break;case"v4":_e.uniforms[rt].value=new _o().fromArray(at.value);break;case"m3":_e.uniforms[rt].value=new nu().fromArray(at.value);break;case"m4":_e.uniforms[rt].value=new Os().fromArray(at.value);break;default:_e.uniforms[rt].value=at.value}}if(o.defines!==void 0&&(_e.defines=o.defines),o.vertexShader!==void 0&&(_e.vertexShader=o.vertexShader),o.fragmentShader!==void 0&&(_e.fragmentShader=o.fragmentShader),o.glslVersion!==void 0&&(_e.glslVersion=o.glslVersion),o.extensions!==void 0)for(const rt in o.extensions)_e.extensions[rt]=o.extensions[rt];if(o.size!==void 0&&(_e.size=o.size),o.sizeAttenuation!==void 0&&(_e.sizeAttenuation=o.sizeAttenuation),o.map!==void 0&&(_e.map=$(o.map)),o.matcap!==void 0&&(_e.matcap=$(o.matcap)),o.alphaMap!==void 0&&(_e.alphaMap=$(o.alphaMap)),o.bumpMap!==void 0&&(_e.bumpMap=$(o.bumpMap)),o.bumpScale!==void 0&&(_e.bumpScale=o.bumpScale),o.normalMap!==void 0&&(_e.normalMap=$(o.normalMap)),o.normalMapType!==void 0&&(_e.normalMapType=o.normalMapType),o.normalScale!==void 0){let rt=o.normalScale;Array.isArray(rt)===!1&&(rt=[rt,rt]),_e.normalScale=new Sr().fromArray(rt)}return o.displacementMap!==void 0&&(_e.displacementMap=$(o.displacementMap)),o.displacementScale!==void 0&&(_e.displacementScale=o.displacementScale),o.displacementBias!==void 0&&(_e.displacementBias=o.displacementBias),o.roughnessMap!==void 0&&(_e.roughnessMap=$(o.roughnessMap)),o.metalnessMap!==void 0&&(_e.metalnessMap=$(o.metalnessMap)),o.emissiveMap!==void 0&&(_e.emissiveMap=$(o.emissiveMap)),o.emissiveIntensity!==void 0&&(_e.emissiveIntensity=o.emissiveIntensity),o.specularMap!==void 0&&(_e.specularMap=$(o.specularMap)),o.specularIntensityMap!==void 0&&(_e.specularIntensityMap=$(o.specularIntensityMap)),o.specularColorMap!==void 0&&(_e.specularColorMap=$(o.specularColorMap)),o.envMap!==void 0&&(_e.envMap=$(o.envMap)),o.envMapIntensity!==void 0&&(_e.envMapIntensity=o.envMapIntensity),o.reflectivity!==void 0&&(_e.reflectivity=o.reflectivity),o.refractionRatio!==void 0&&(_e.refractionRatio=o.refractionRatio),o.lightMap!==void 0&&(_e.lightMap=$(o.lightMap)),o.lightMapIntensity!==void 0&&(_e.lightMapIntensity=o.lightMapIntensity),o.aoMap!==void 0&&(_e.aoMap=$(o.aoMap)),o.aoMapIntensity!==void 0&&(_e.aoMapIntensity=o.aoMapIntensity),o.gradientMap!==void 0&&(_e.gradientMap=$(o.gradientMap)),o.clearcoatMap!==void 0&&(_e.clearcoatMap=$(o.clearcoatMap)),o.clearcoatRoughnessMap!==void 0&&(_e.clearcoatRoughnessMap=$(o.clearcoatRoughnessMap)),o.clearcoatNormalMap!==void 0&&(_e.clearcoatNormalMap=$(o.clearcoatNormalMap)),o.clearcoatNormalScale!==void 0&&(_e.clearcoatNormalScale=new Sr().fromArray(o.clearcoatNormalScale)),o.iridescenceMap!==void 0&&(_e.iridescenceMap=$(o.iridescenceMap)),o.iridescenceThicknessMap!==void 0&&(_e.iridescenceThicknessMap=$(o.iridescenceThicknessMap)),o.transmissionMap!==void 0&&(_e.transmissionMap=$(o.transmissionMap)),o.thicknessMap!==void 0&&(_e.thicknessMap=$(o.thicknessMap)),o.sheenColorMap!==void 0&&(_e.sheenColorMap=$(o.sheenColorMap)),o.sheenRoughnessMap!==void 0&&(_e.sheenRoughnessMap=$(o.sheenRoughnessMap)),_e}setTextures(o){return this.textures=o,this}static createMaterialFromType(o){return new{ShadowMaterial:AE,SpriteMaterial:RA,RawShaderMaterial:Cx,ShaderMaterial:_m,PointsMaterial:cE,MeshPhysicalMaterial:DT,MeshStandardMaterial:_d,MeshPhongMaterial:PT,MeshToonMaterial:TC,MeshNormalMaterial:wm,MeshLambertMaterial:yE,MeshDepthMaterial:ox,MeshDistanceMaterial:PA,MeshBasicMaterial:gm,MeshMatcapMaterial:RT,LineDashedMaterial:BT,LineBasicMaterial:Ju,Material:Fl}[o]}}class kC{static decodeText(o){if(typeof TextDecoder<"u")return new TextDecoder().decode(o);let g="";for(let $=0,_e=o.length;$<_e;$++)g+=String.fromCharCode(o[$]);try{return decodeURIComponent(escape(g))}catch{return g}}static extractUrlBase(o){const g=o.lastIndexOf("/");return g===-1?"./":o.slice(0,g+1)}static resolveURL(o,g){return typeof o!="string"||o===""?"":(/^https?:\/\//i.test(g)&&/^\//.test(o)&&(g=g.replace(/(^https?:\/\/[^\/]+).*/i,"$1")),/^(https?:)?\/\//i.test(o)||/^data:.*,.*$/i.test(o)||/^blob:.*$/i.test(o)?o:g+o)}}class jT extends fs{constructor(){super(),this.isInstancedBufferGeometry=!0,this.type="InstancedBufferGeometry",this.instanceCount=1/0}copy(o){return super.copy(o),this.instanceCount=o.instanceCount,this}clone(){return new this.constructor().copy(this)}toJSON(){const o=super.toJSON(this);return o.instanceCount=this.instanceCount,o.isInstancedBufferGeometry=!0,o}}class zT extends kp{constructor(o){super(o)}load(o,g,$,_e){const rt=this,at=new sv(rt.manager);at.setPath(rt.path),at.setRequestHeader(rt.requestHeader),at.setWithCredentials(rt.withCredentials),at.load(o,function(ct){try{g(rt.parse(JSON.parse(ct)))}catch(ft){_e?_e(ft):console.error(ft),rt.manager.itemError(o)}},$,_e)}parse(o){const g={},$={};function _e(Tt,St){if(g[St]!==void 0)return g[St];const It=Tt.interleavedBuffers[St],Rt=function(Nt,zt){if($[zt]!==void 0)return $[zt];const Xt=Nt.arrayBuffers[zt],tn=new Uint32Array(Xt).buffer;return $[zt]=tn,tn}(Tt,It.buffer),Dt=Iv(It.type,Rt),Ft=new cx(Dt,It.stride);return Ft.uuid=It.uuid,g[St]=Ft,Ft}const rt=o.isInstancedBufferGeometry?new jT:new fs,at=o.data.index;if(at!==void 0){const Tt=Iv(at.type,at.array);rt.setIndex(new Ro(Tt,1))}const ct=o.data.attributes;for(const Tt in ct){const St=ct[Tt];let It;if(St.isInterleavedBufferAttribute){const Rt=_e(o.data,St.data);It=new y_(Rt,St.itemSize,St.offset,St.normalized)}else{const Rt=Iv(St.type,St.array);It=new(St.isInstancedBufferAttribute?LA:Ro)(Rt,St.itemSize,St.normalized)}St.name!==void 0&&(It.name=St.name),St.usage!==void 0&&It.setUsage(St.usage),St.updateRange!==void 0&&(It.updateRange.offset=St.updateRange.offset,It.updateRange.count=St.updateRange.count),rt.setAttribute(Tt,It)}const ft=o.data.morphAttributes;if(ft)for(const Tt in ft){const St=ft[Tt],It=[];for(let Rt=0,Dt=St.length;Rt<Dt;Rt++){const Ft=St[Rt];let Nt;if(Ft.isInterleavedBufferAttribute){const zt=_e(o.data,Ft.data);Nt=new y_(zt,Ft.itemSize,Ft.offset,Ft.normalized)}else{const zt=Iv(Ft.type,Ft.array);Nt=new Ro(zt,Ft.itemSize,Ft.normalized)}Ft.name!==void 0&&(Nt.name=Ft.name),It.push(Nt)}rt.morphAttributes[Tt]=It}o.data.morphTargetsRelative&&(rt.morphTargetsRelative=!0);const mt=o.data.groups||o.data.drawcalls||o.data.offsets;if(mt!==void 0)for(let Tt=0,St=mt.length;Tt!==St;++Tt){const It=mt[Tt];rt.addGroup(It.start,It.count,It.materialIndex)}const bt=o.data.boundingSphere;if(bt!==void 0){const Tt=new fn;bt.center!==void 0&&Tt.fromArray(bt.center),rt.boundingSphere=new Bv(Tt,bt.radius)}return o.name&&(rt.name=o.name),o.userData&&(rt.userData=o.userData),rt}}class ME extends kp{constructor(o){super(o)}load(o,g,$,_e){const rt=this,at=this.path===""?kC.extractUrlBase(o):this.path;this.resourcePath=this.resourcePath||at;const ct=new sv(this.manager);ct.setPath(this.path),ct.setRequestHeader(this.requestHeader),ct.setWithCredentials(this.withCredentials),ct.load(o,function(ft){let mt=null;try{mt=JSON.parse(ft)}catch(Tt){return _e!==void 0&&_e(Tt),void console.error("THREE:ObjectLoader: Can't parse "+o+".",Tt.message)}const bt=mt.metadata;bt!==void 0&&bt.type!==void 0&&bt.type.toLowerCase()!=="geometry"?rt.parse(mt,g):console.error("THREE.ObjectLoader: Can't load "+o)},$,_e)}async loadAsync(o,g){const $=this.path===""?kC.extractUrlBase(o):this.path;this.resourcePath=this.resourcePath||$;const _e=new sv(this.manager);_e.setPath(this.path),_e.setRequestHeader(this.requestHeader),_e.setWithCredentials(this.withCredentials);const rt=await _e.loadAsync(o,g),at=JSON.parse(rt),ct=at.metadata;if(ct===void 0||ct.type===void 0||ct.type.toLowerCase()==="geometry")throw new Error("THREE.ObjectLoader: Can't load "+o);return await this.parseAsync(at)}parse(o,g){const $=this.parseAnimations(o.animations),_e=this.parseShapes(o.shapes),rt=this.parseGeometries(o.geometries,_e),at=this.parseImages(o.images,function(){g!==void 0&&g(mt)}),ct=this.parseTextures(o.textures,at),ft=this.parseMaterials(o.materials,ct),mt=this.parseObject(o.object,rt,ft,ct,$),bt=this.parseSkeletons(o.skeletons,mt);if(this.bindSkeletons(mt,bt),g!==void 0){let Tt=!1;for(const St in at)if(at[St].data instanceof HTMLImageElement){Tt=!0;break}Tt===!1&&g(mt)}return mt}async parseAsync(o){const g=this.parseAnimations(o.animations),$=this.parseShapes(o.shapes),_e=this.parseGeometries(o.geometries,$),rt=await this.parseImagesAsync(o.images),at=this.parseTextures(o.textures,rt),ct=this.parseMaterials(o.materials,at),ft=this.parseObject(o.object,_e,ct,at,g),mt=this.parseSkeletons(o.skeletons,ft);return this.bindSkeletons(ft,mt),ft}parseShapes(o){const g={};if(o!==void 0)for(let $=0,_e=o.length;$<_e;$++){const rt=new jA().fromJSON(o[$]);g[rt.uuid]=rt}return g}parseSkeletons(o,g){const $={},_e={};if(g.traverse(function(rt){rt.isBone&&(_e[rt.uuid]=rt)}),o!==void 0)for(let rt=0,at=o.length;rt<at;rt++){const ct=new Qy().fromJSON(o[rt],_e);$[ct.uuid]=ct}return $}parseGeometries(o,g){const $={};if(o!==void 0){const _e=new zT;for(let rt=0,at=o.length;rt<at;rt++){let ct;const ft=o[rt];switch(ft.type){case"BufferGeometry":case"InstancedBufferGeometry":ct=_e.parse(ft);break;default:ft.type in IT?ct=IT[ft.type].fromJSON(ft,g):console.warn(`THREE.ObjectLoader: Unsupported geometry type "${ft.type}"`)}ct.uuid=ft.uuid,ft.name!==void 0&&(ct.name=ft.name),ct.isBufferGeometry===!0&&ft.userData!==void 0&&(ct.userData=ft.userData),$[ft.uuid]=ct}}return $}parseMaterials(o,g){const $={},_e={};if(o!==void 0){const rt=new JA;rt.setTextures(g);for(let at=0,ct=o.length;at<ct;at++){const ft=o[at];$[ft.uuid]===void 0&&($[ft.uuid]=rt.parse(ft)),_e[ft.uuid]=$[ft.uuid]}}return _e}parseAnimations(o){const g={};if(o!==void 0)for(let $=0;$<o.length;$++){const _e=o[$],rt=iv.parse(_e);g[rt.uuid]=rt}return g}parseImages(o,g){const $=this,_e={};let rt;function at(ct){if(typeof ct=="string"){const ft=ct;return function(mt){return $.manager.itemStart(mt),rt.load(mt,function(){$.manager.itemEnd(mt)},void 0,function(){$.manager.itemError(mt),$.manager.itemEnd(mt)})}(/^(\/\/)|([a-z]+:(\/\/)?)/i.test(ft)?ft:$.resourcePath+ft)}return ct.data?{data:Iv(ct.type,ct.data),width:ct.width,height:ct.height,complete:!0}:null}if(o!==void 0&&o.length>0){const ct=new rv(g);rt=new ov(ct),rt.setCrossOrigin(this.crossOrigin);for(let ft=0,mt=o.length;ft<mt;ft++){const bt=o[ft],Tt=bt.url;if(Array.isArray(Tt)){const St=[];for(let It=0,Rt=Tt.length;It<Rt;It++){const Dt=at(Tt[It]);Dt!==null&&(Dt instanceof HTMLImageElement?St.push(Dt):St.push(new Vy(Dt.data,Dt.width,Dt.height)))}_e[bt.uuid]=new Sp(St)}else{const St=at(bt.url);_e[bt.uuid]=new Sp(St)}}}return _e}async parseImagesAsync(o){const g=this,$={};let _e;async function rt(at){if(typeof at=="string"){const ct=at,ft=/^(\/\/)|([a-z]+:(\/\/)?)/i.test(ct)?ct:g.resourcePath+ct;return await _e.loadAsync(ft)}return at.data?{data:Iv(at.type,at.data),width:at.width,height:at.height,complete:!0}:null}if(o!==void 0&&o.length>0){_e=new ov(this.manager),_e.setCrossOrigin(this.crossOrigin);for(let at=0,ct=o.length;at<ct;at++){const ft=o[at],mt=ft.url;if(Array.isArray(mt)){const bt=[];for(let Tt=0,St=mt.length;Tt<St;Tt++){const It=mt[Tt],Rt=await rt(It);Rt!==null&&(Rt instanceof HTMLImageElement?bt.push(Rt):bt.push(new Vy(Rt.data,Rt.width,Rt.height)))}$[ft.uuid]=new Sp(bt)}else{const bt=await rt(ft.url);$[ft.uuid]=new Sp(bt)}}}return $}parseTextures(o,g){function $(rt,at){return typeof rt=="number"?rt:(console.warn("THREE.ObjectLoader.parseTexture: Constant should be in numeric form.",rt),at[rt])}const _e={};if(o!==void 0)for(let rt=0,at=o.length;rt<at;rt++){const ct=o[rt];ct.image===void 0&&console.warn('THREE.ObjectLoader: No "image" specified for',ct.uuid),g[ct.image]===void 0&&console.warn("THREE.ObjectLoader: Undefined image",ct.image);const ft=g[ct.image],mt=ft?ft.data:void 0;let bt;Array.isArray(mt)?(bt=new qw,mt.length===6&&(bt.needsUpdate=!0)):(bt=mt&&mt.data?new Vy:new qo,mt&&mt.complete&&(bt.needsUpdate=!0)),bt.source=ft,bt.uuid=ct.uuid,ct.name!==void 0&&(bt.name=ct.name),ct.mapping!==void 0&&(bt.mapping=$(ct.mapping,bD)),ct.offset!==void 0&&bt.offset.fromArray(ct.offset),ct.repeat!==void 0&&bt.repeat.fromArray(ct.repeat),ct.center!==void 0&&bt.center.fromArray(ct.center),ct.rotation!==void 0&&(bt.rotation=ct.rotation),ct.wrap!==void 0&&(bt.wrapS=$(ct.wrap[0],ZA),bt.wrapT=$(ct.wrap[1],ZA)),ct.format!==void 0&&(bt.format=ct.format),ct.type!==void 0&&(bt.type=ct.type),ct.encoding!==void 0&&(bt.encoding=ct.encoding),ct.minFilter!==void 0&&(bt.minFilter=$(ct.minFilter,B0)),ct.magFilter!==void 0&&(bt.magFilter=$(ct.magFilter,B0)),ct.anisotropy!==void 0&&(bt.anisotropy=ct.anisotropy),ct.flipY!==void 0&&(bt.flipY=ct.flipY),ct.premultiplyAlpha!==void 0&&(bt.premultiplyAlpha=ct.premultiplyAlpha),ct.unpackAlignment!==void 0&&(bt.unpackAlignment=ct.unpackAlignment),ct.userData!==void 0&&(bt.userData=ct.userData),_e[ct.uuid]=bt}return _e}parseObject(o,g,$,_e,rt){let at,ct,ft;function mt(St){return g[St]===void 0&&console.warn("THREE.ObjectLoader: Undefined geometry",St),g[St]}function bt(St){if(St!==void 0){if(Array.isArray(St)){const It=[];for(let Rt=0,Dt=St.length;Rt<Dt;Rt++){const Ft=St[Rt];$[Ft]===void 0&&console.warn("THREE.ObjectLoader: Undefined material",Ft),It.push($[Ft])}return It}return $[St]===void 0&&console.warn("THREE.ObjectLoader: Undefined material",St),$[St]}}function Tt(St){return _e[St]===void 0&&console.warn("THREE.ObjectLoader: Undefined texture",St),_e[St]}switch(o.type){case"Scene":at=new lC,o.background!==void 0&&(Number.isInteger(o.background)?at.background=new rs(o.background):at.background=Tt(o.background)),o.environment!==void 0&&(at.environment=Tt(o.environment)),o.fog!==void 0&&(o.fog.type==="Fog"?at.fog=new A_(o.fog.color,o.fog.near,o.fog.far):o.fog.type==="FogExp2"&&(at.fog=new lx(o.fog.color,o.fog.density)));break;case"PerspectiveCamera":at=new wu(o.fov,o.aspect,o.near,o.far),o.focus!==void 0&&(at.focus=o.focus),o.zoom!==void 0&&(at.zoom=o.zoom),o.filmGauge!==void 0&&(at.filmGauge=o.filmGauge),o.filmOffset!==void 0&&(at.filmOffset=o.filmOffset),o.view!==void 0&&(at.view=Object.assign({},o.view));break;case"OrthographicCamera":at=new U1(o.left,o.right,o.top,o.bottom,o.near,o.far),o.zoom!==void 0&&(at.zoom=o.zoom),o.view!==void 0&&(at.view=Object.assign({},o.view));break;case"AmbientLight":at=new FT(o.color,o.intensity);break;case"DirectionalLight":at=new bE(o.color,o.intensity);break;case"PointLight":at=new av(o.color,o.intensity,o.distance,o.decay);break;case"RectAreaLight":at=new EE(o.color,o.intensity,o.width,o.height);break;case"SpotLight":at=new NT(o.color,o.intensity,o.distance,o.angle,o.penumbra,o.decay);break;case"HemisphereLight":at=new ep(o.color,o.groundColor,o.intensity);break;case"LightProbe":at=new CE().fromJSON(o);break;case"SkinnedMesh":ct=mt(o.geometry),ft=bt(o.material),at=new zy(ct,ft),o.bindMode!==void 0&&(at.bindMode=o.bindMode),o.bindMatrix!==void 0&&at.bindMatrix.fromArray(o.bindMatrix),o.skeleton!==void 0&&(at.skeleton=o.skeleton);break;case"Mesh":ct=mt(o.geometry),ft=bt(o.material),at=new Zl(ct,ft);break;case"InstancedMesh":ct=mt(o.geometry),ft=bt(o.material);const St=o.count,It=o.instanceMatrix,Rt=o.instanceColor;at=new hC(ct,ft,St),at.instanceMatrix=new LA(new Float32Array(It.array),16),Rt!==void 0&&(at.instanceColor=new LA(new Float32Array(Rt.array),Rt.itemSize));break;case"LOD":at=new cC;break;case"Line":at=new S_(mt(o.geometry),bt(o.material));break;case"LineLoop":at=new wT(mt(o.geometry),bt(o.material));break;case"LineSegments":at=new _g(mt(o.geometry),bt(o.material));break;case"PointCloud":case"Points":at=new qy(mt(o.geometry),bt(o.material));break;case"Sprite":at=new jy(bt(o.material));break;case"Group":at=new T0;break;case"Bone":at=new E_;break;default:at=new no}if(at.uuid=o.uuid,o.name!==void 0&&(at.name=o.name),o.matrix!==void 0?(at.matrix.fromArray(o.matrix),o.matrixAutoUpdate!==void 0&&(at.matrixAutoUpdate=o.matrixAutoUpdate),at.matrixAutoUpdate&&at.matrix.decompose(at.position,at.quaternion,at.scale)):(o.position!==void 0&&at.position.fromArray(o.position),o.rotation!==void 0&&at.rotation.fromArray(o.rotation),o.quaternion!==void 0&&at.quaternion.fromArray(o.quaternion),o.scale!==void 0&&at.scale.fromArray(o.scale)),o.castShadow!==void 0&&(at.castShadow=o.castShadow),o.receiveShadow!==void 0&&(at.receiveShadow=o.receiveShadow),o.shadow&&(o.shadow.bias!==void 0&&(at.shadow.bias=o.shadow.bias),o.shadow.normalBias!==void 0&&(at.shadow.normalBias=o.shadow.normalBias),o.shadow.radius!==void 0&&(at.shadow.radius=o.shadow.radius),o.shadow.mapSize!==void 0&&at.shadow.mapSize.fromArray(o.shadow.mapSize),o.shadow.camera!==void 0&&(at.shadow.camera=this.parseObject(o.shadow.camera))),o.visible!==void 0&&(at.visible=o.visible),o.frustumCulled!==void 0&&(at.frustumCulled=o.frustumCulled),o.renderOrder!==void 0&&(at.renderOrder=o.renderOrder),o.userData!==void 0&&(at.userData=o.userData),o.layers!==void 0&&(at.layers.mask=o.layers),o.children!==void 0){const St=o.children;for(let It=0;It<St.length;It++)at.add(this.parseObject(St[It],g,$,_e,rt))}if(o.animations!==void 0){const St=o.animations;for(let It=0;It<St.length;It++){const Rt=St[It];at.animations.push(rt[Rt])}}if(o.type==="LOD"){o.autoUpdate!==void 0&&(at.autoUpdate=o.autoUpdate);const St=o.levels;for(let It=0;It<St.length;It++){const Rt=St[It],Dt=at.getObjectByProperty("uuid",Rt.object);Dt!==void 0&&at.addLevel(Dt,Rt.distance)}}return at}bindSkeletons(o,g){Object.keys(g).length!==0&&o.traverse(function($){if($.isSkinnedMesh===!0&&$.skeleton!==void 0){const _e=g[$.skeleton];_e===void 0?console.warn("THREE.ObjectLoader: No skeleton found with UUID:",$.skeleton):$.bind(_e,$.bindMatrix)}})}}const bD={UVMapping:fu,CubeReflectionMapping:$a,CubeRefractionMapping:ko,EquirectangularReflectionMapping:Hl,EquirectangularRefractionMapping:Io,CubeUVReflectionMapping:Qu},ZA={RepeatWrapping:Mu,ClampToEdgeWrapping:Lo,MirroredRepeatWrapping:Lp},B0={NearestFilter:na,NearestMipmapNearestFilter:mu,NearestMipmapLinearFilter:ga,LinearFilter:xa,LinearMipmapNearestFilter:km,LinearMipmapLinearFilter:mo};class Yp extends kp{constructor(o){super(o),this.isImageBitmapLoader=!0,typeof createImageBitmap>"u"&&console.warn("THREE.ImageBitmapLoader: createImageBitmap() not supported."),typeof fetch>"u"&&console.warn("THREE.ImageBitmapLoader: fetch() not supported."),this.options={premultiplyAlpha:"none"}}setOptions(o){return this.options=o,this}load(o,g,$,_e){o===void 0&&(o=""),this.path!==void 0&&(o=this.path+o),o=this.manager.resolveURL(o);const rt=this,at=Wv.get(o);if(at!==void 0)return rt.manager.itemStart(o),setTimeout(function(){g&&g(at),rt.manager.itemEnd(o)},0),at;const ct={};ct.credentials=this.crossOrigin==="anonymous"?"same-origin":"include",ct.headers=this.requestHeader,fetch(o,ct).then(function(ft){return ft.blob()}).then(function(ft){return createImageBitmap(ft,Object.assign(rt.options,{colorSpaceConversion:"none"}))}).then(function(ft){Wv.add(o,ft),g&&g(ft),rt.manager.itemEnd(o)}).catch(function(ft){_e&&_e(ft),rt.manager.itemError(o),rt.manager.itemEnd(o)}),rt.manager.itemStart(o)}}let TE;const sw={getContext:function(){return TE===void 0&&(TE=new(window.AudioContext||window.webkitAudioContext)),TE},setContext:function(dt){TE=dt}};class ED extends kp{constructor(o){super(o)}load(o,g,$,_e){const rt=this,at=new sv(this.manager);at.setResponseType("arraybuffer"),at.setPath(this.path),at.setRequestHeader(this.requestHeader),at.setWithCredentials(this.withCredentials),at.load(o,function(ct){try{const ft=ct.slice(0);sw.getContext().decodeAudioData(ft,function(mt){g(mt)})}catch(ft){_e?_e(ft):console.error(ft),rt.manager.itemError(o)}},$,_e)}}class IE extends CE{constructor(o,g,$=1){super(void 0,$),this.isHemisphereLightProbe=!0;const _e=new rs().set(o),rt=new rs().set(g),at=new fn(_e.r,_e.g,_e.b),ct=new fn(rt.r,rt.g,rt.b),ft=Math.sqrt(Math.PI),mt=ft*Math.sqrt(.75);this.sh.coefficients[0].copy(at).add(ct).multiplyScalar(ft),this.sh.coefficients[1].copy(at).sub(ct).multiplyScalar(mt)}}class SD extends CE{constructor(o,g=1){super(void 0,g),this.isAmbientLightProbe=!0;const $=new rs().set(o);this.sh.coefficients[0].set($.r,$.g,$.b).multiplyScalar(2*Math.sqrt(Math.PI))}}const Rx=new Os,VT=new Os,Yv=new Os;class CD{constructor(){this.type="StereoCamera",this.aspect=1,this.eyeSep=.064,this.cameraL=new wu,this.cameraL.layers.enable(1),this.cameraL.matrixAutoUpdate=!1,this.cameraR=new wu,this.cameraR.layers.enable(2),this.cameraR.matrixAutoUpdate=!1,this._cache={focus:null,fov:null,aspect:null,near:null,far:null,zoom:null,eyeSep:null}}update(o){const g=this._cache;if(g.focus!==o.focus||g.fov!==o.fov||g.aspect!==o.aspect*this.aspect||g.near!==o.near||g.far!==o.far||g.zoom!==o.zoom||g.eyeSep!==this.eyeSep){g.focus=o.focus,g.fov=o.fov,g.aspect=o.aspect*this.aspect,g.near=o.near,g.far=o.far,g.zoom=o.zoom,g.eyeSep=this.eyeSep,Yv.copy(o.projectionMatrix);const $=g.eyeSep/2,_e=$*g.near/g.focus,rt=g.near*Math.tan(d0*g.fov*.5)/g.zoom;let at,ct;VT.elements[12]=-$,Rx.elements[12]=$,at=-rt*g.aspect+_e,ct=rt*g.aspect+_e,Yv.elements[0]=2*g.near/(ct-at),Yv.elements[8]=(ct+at)/(ct-at),this.cameraL.projectionMatrix.copy(Yv),at=-rt*g.aspect-_e,ct=rt*g.aspect-_e,Yv.elements[0]=2*g.near/(ct-at),Yv.elements[8]=(ct+at)/(ct-at),this.cameraR.projectionMatrix.copy(Yv)}this.cameraL.matrixWorld.copy(o.matrixWorld).multiply(VT),this.cameraR.matrixWorld.copy(o.matrixWorld).multiply(Rx)}}class Bx{constructor(o=!0){this.autoStart=o,this.startTime=0,this.oldTime=0,this.elapsedTime=0,this.running=!1}start(){this.startTime=kx(),this.oldTime=this.startTime,this.elapsedTime=0,this.running=!0}stop(){this.getElapsedTime(),this.running=!1,this.autoStart=!1}getElapsedTime(){return this.getDelta(),this.elapsedTime}getDelta(){let o=0;if(this.autoStart&&!this.running)return this.start(),0;if(this.running){const g=kx();o=(g-this.oldTime)/1e3,this.oldTime=g,this.elapsedTime+=o}return o}}function kx(){return(typeof performance>"u"?Date:performance).now()}const lv=new fn,DE=new iu,OC=new fn,Xp=new fn;class MD extends no{constructor(){super(),this.type="AudioListener",this.context=sw.getContext(),this.gain=this.context.createGain(),this.gain.connect(this.context.destination),this.filter=null,this.timeDelta=0,this._clock=new Bx}getInput(){return this.gain}removeFilter(){return this.filter!==null&&(this.gain.disconnect(this.filter),this.filter.disconnect(this.context.destination),this.gain.connect(this.context.destination),this.filter=null),this}getFilter(){return this.filter}setFilter(o){return this.filter!==null?(this.gain.disconnect(this.filter),this.filter.disconnect(this.context.destination)):this.gain.disconnect(this.context.destination),this.filter=o,this.gain.connect(this.filter),this.filter.connect(this.context.destination),this}getMasterVolume(){return this.gain.gain.value}setMasterVolume(o){return this.gain.gain.setTargetAtTime(o,this.context.currentTime,.01),this}updateMatrixWorld(o){super.updateMatrixWorld(o);const g=this.context.listener,$=this.up;if(this.timeDelta=this._clock.getDelta(),this.matrixWorld.decompose(lv,DE,OC),Xp.set(0,0,-1).applyQuaternion(DE),g.positionX){const _e=this.context.currentTime+this.timeDelta;g.positionX.linearRampToValueAtTime(lv.x,_e),g.positionY.linearRampToValueAtTime(lv.y,_e),g.positionZ.linearRampToValueAtTime(lv.z,_e),g.forwardX.linearRampToValueAtTime(Xp.x,_e),g.forwardY.linearRampToValueAtTime(Xp.y,_e),g.forwardZ.linearRampToValueAtTime(Xp.z,_e),g.upX.linearRampToValueAtTime($.x,_e),g.upY.linearRampToValueAtTime($.y,_e),g.upZ.linearRampToValueAtTime($.z,_e)}else g.setPosition(lv.x,lv.y,lv.z),g.setOrientation(Xp.x,Xp.y,Xp.z,$.x,$.y,$.z)}}class ow extends no{constructor(o){super(),this.type="Audio",this.listener=o,this.context=o.context,this.gain=this.context.createGain(),this.gain.connect(o.getInput()),this.autoplay=!1,this.buffer=null,this.detune=0,this.loop=!1,this.loopStart=0,this.loopEnd=0,this.offset=0,this.duration=void 0,this.playbackRate=1,this.isPlaying=!1,this.hasPlaybackControl=!0,this.source=null,this.sourceType="empty",this._startedAt=0,this._progress=0,this._connected=!1,this.filters=[]}getOutput(){return this.gain}setNodeSource(o){return this.hasPlaybackControl=!1,this.sourceType="audioNode",this.source=o,this.connect(),this}setMediaElementSource(o){return this.hasPlaybackControl=!1,this.sourceType="mediaNode",this.source=this.context.createMediaElementSource(o),this.connect(),this}setMediaStreamSource(o){return this.hasPlaybackControl=!1,this.sourceType="mediaStreamNode",this.source=this.context.createMediaStreamSource(o),this.connect(),this}setBuffer(o){return this.buffer=o,this.sourceType="buffer",this.autoplay&&this.play(),this}play(o=0){if(this.isPlaying===!0)return void console.warn("THREE.Audio: Audio is already playing.");if(this.hasPlaybackControl===!1)return void console.warn("THREE.Audio: this Audio has no playback control.");this._startedAt=this.context.currentTime+o;const g=this.context.createBufferSource();return g.buffer=this.buffer,g.loop=this.loop,g.loopStart=this.loopStart,g.loopEnd=this.loopEnd,g.onended=this.onEnded.bind(this),g.start(this._startedAt,this._progress+this.offset,this.duration),this.isPlaying=!0,this.source=g,this.setDetune(this.detune),this.setPlaybackRate(this.playbackRate),this.connect()}pause(){if(this.hasPlaybackControl!==!1)return this.isPlaying===!0&&(this._progress+=Math.max(this.context.currentTime-this._startedAt,0)*this.playbackRate,this.loop===!0&&(this._progress=this._progress%(this.duration||this.buffer.duration)),this.source.stop(),this.source.onended=null,this.isPlaying=!1),this;console.warn("THREE.Audio: this Audio has no playback control.")}stop(){if(this.hasPlaybackControl!==!1)return this._progress=0,this.source.stop(),this.source.onended=null,this.isPlaying=!1,this;console.warn("THREE.Audio: this Audio has no playback control.")}connect(){if(this.filters.length>0){this.source.connect(this.filters[0]);for(let o=1,g=this.filters.length;o<g;o++)this.filters[o-1].connect(this.filters[o]);this.filters[this.filters.length-1].connect(this.getOutput())}else this.source.connect(this.getOutput());return this._connected=!0,this}disconnect(){if(this.filters.length>0){this.source.disconnect(this.filters[0]);for(let o=1,g=this.filters.length;o<g;o++)this.filters[o-1].disconnect(this.filters[o]);this.filters[this.filters.length-1].disconnect(this.getOutput())}else this.source.disconnect(this.getOutput());return this._connected=!1,this}getFilters(){return this.filters}setFilters(o){return o||(o=[]),this._connected===!0?(this.disconnect(),this.filters=o.slice(),this.connect()):this.filters=o.slice(),this}setDetune(o){if(this.detune=o,this.source.detune!==void 0)return this.isPlaying===!0&&this.source.detune.setTargetAtTime(this.detune,this.context.currentTime,.01),this}getDetune(){return this.detune}getFilter(){return this.getFilters()[0]}setFilter(o){return this.setFilters(o?[o]:[])}setPlaybackRate(o){if(this.hasPlaybackControl!==!1)return this.playbackRate=o,this.isPlaying===!0&&this.source.playbackRate.setTargetAtTime(this.playbackRate,this.context.currentTime,.01),this;console.warn("THREE.Audio: this Audio has no playback control.")}getPlaybackRate(){return this.playbackRate}onEnded(){this.isPlaying=!1}getLoop(){return this.hasPlaybackControl===!1?(console.warn("THREE.Audio: this Audio has no playback control."),!1):this.loop}setLoop(o){if(this.hasPlaybackControl!==!1)return this.loop=o,this.isPlaying===!0&&(this.source.loop=this.loop),this;console.warn("THREE.Audio: this Audio has no playback control.")}setLoopStart(o){return this.loopStart=o,this}setLoopEnd(o){return this.loopEnd=o,this}getVolume(){return this.gain.gain.value}setVolume(o){return this.gain.gain.setTargetAtTime(o,this.context.currentTime,.01),this}}const Kp=new fn,QT=new iu,cv=new fn,I_=new fn;class k0 extends ow{constructor(o){super(o),this.panner=this.context.createPanner(),this.panner.panningModel="HRTF",this.panner.connect(this.gain)}disconnect(){super.disconnect(),this.panner.disconnect(this.gain)}getOutput(){return this.panner}getRefDistance(){return this.panner.refDistance}setRefDistance(o){return this.panner.refDistance=o,this}getRolloffFactor(){return this.panner.rolloffFactor}setRolloffFactor(o){return this.panner.rolloffFactor=o,this}getDistanceModel(){return this.panner.distanceModel}setDistanceModel(o){return this.panner.distanceModel=o,this}getMaxDistance(){return this.panner.maxDistance}setMaxDistance(o){return this.panner.maxDistance=o,this}setDirectionalCone(o,g,$){return this.panner.coneInnerAngle=o,this.panner.coneOuterAngle=g,this.panner.coneOuterGain=$,this}updateMatrixWorld(o){if(super.updateMatrixWorld(o),this.hasPlaybackControl===!0&&this.isPlaying===!1)return;this.matrixWorld.decompose(Kp,QT,cv),I_.set(0,0,1).applyQuaternion(QT);const g=this.panner;if(g.positionX){const $=this.context.currentTime+this.listener.timeDelta;g.positionX.linearRampToValueAtTime(Kp.x,$),g.positionY.linearRampToValueAtTime(Kp.y,$),g.positionZ.linearRampToValueAtTime(Kp.z,$),g.orientationX.linearRampToValueAtTime(I_.x,$),g.orientationY.linearRampToValueAtTime(I_.y,$),g.orientationZ.linearRampToValueAtTime(I_.z,$)}else g.setPosition(Kp.x,Kp.y,Kp.z),g.setOrientation(I_.x,I_.y,I_.z)}}class GT{constructor(o,g=2048){this.analyser=o.context.createAnalyser(),this.analyser.fftSize=g,this.data=new Uint8Array(this.analyser.frequencyBinCount),o.getOutput().connect(this.analyser)}getFrequencyData(){return this.analyser.getByteFrequencyData(this.data),this.data}getAverageFrequency(){let o=0;const g=this.getFrequencyData();for(let $=0;$<g.length;$++)o+=g[$];return o/g.length}}class PE{constructor(o,g,$){let _e,rt,at;switch(this.binding=o,this.valueSize=$,g){case"quaternion":_e=this._slerp,rt=this._slerpAdditive,at=this._setAdditiveIdentityQuaternion,this.buffer=new Float64Array(6*$),this._workIndex=5;break;case"string":case"bool":_e=this._select,rt=this._select,at=this._setAdditiveIdentityOther,this.buffer=new Array(5*$);break;default:_e=this._lerp,rt=this._lerpAdditive,at=this._setAdditiveIdentityNumeric,this.buffer=new Float64Array(5*$)}this._mixBufferRegion=_e,this._mixBufferRegionAdditive=rt,this._setIdentity=at,this._origIndex=3,this._addIndex=4,this.cumulativeWeight=0,this.cumulativeWeightAdditive=0,this.useCount=0,this.referenceCount=0}accumulate(o,g){const $=this.buffer,_e=this.valueSize,rt=o*_e+_e;let at=this.cumulativeWeight;if(at===0){for(let ct=0;ct!==_e;++ct)$[rt+ct]=$[ct];at=g}else{at+=g;const ct=g/at;this._mixBufferRegion($,rt,0,ct,_e)}this.cumulativeWeight=at}accumulateAdditive(o){const g=this.buffer,$=this.valueSize,_e=$*this._addIndex;this.cumulativeWeightAdditive===0&&this._setIdentity(),this._mixBufferRegionAdditive(g,_e,0,o,$),this.cumulativeWeightAdditive+=o}apply(o){const g=this.valueSize,$=this.buffer,_e=o*g+g,rt=this.cumulativeWeight,at=this.cumulativeWeightAdditive,ct=this.binding;if(this.cumulativeWeight=0,this.cumulativeWeightAdditive=0,rt<1){const ft=g*this._origIndex;this._mixBufferRegion($,_e,ft,1-rt,g)}at>0&&this._mixBufferRegionAdditive($,_e,this._addIndex*g,1,g);for(let ft=g,mt=g+g;ft!==mt;++ft)if($[ft]!==$[ft+g]){ct.setValue($,_e);break}}saveOriginalState(){const o=this.binding,g=this.buffer,$=this.valueSize,_e=$*this._origIndex;o.getValue(g,_e);for(let rt=$,at=_e;rt!==at;++rt)g[rt]=g[_e+rt%$];this._setIdentity(),this.cumulativeWeight=0,this.cumulativeWeightAdditive=0}restoreOriginalState(){const o=3*this.valueSize;this.binding.setValue(this.buffer,o)}_setAdditiveIdentityNumeric(){const o=this._addIndex*this.valueSize,g=o+this.valueSize;for(let $=o;$<g;$++)this.buffer[$]=0}_setAdditiveIdentityQuaternion(){this._setAdditiveIdentityNumeric(),this.buffer[this._addIndex*this.valueSize+3]=1}_setAdditiveIdentityOther(){const o=this._origIndex*this.valueSize,g=this._addIndex*this.valueSize;for(let $=0;$<this.valueSize;$++)this.buffer[g+$]=this.buffer[o+$]}_select(o,g,$,_e,rt){if(_e>=.5)for(let at=0;at!==rt;++at)o[g+at]=o[$+at]}_slerp(o,g,$,_e){iu.slerpFlat(o,g,o,g,o,$,_e)}_slerpAdditive(o,g,$,_e,rt){const at=this._workIndex*rt;iu.multiplyQuaternionsFlat(o,at,o,g,o,$),iu.slerpFlat(o,g,o,g,o,at,_e)}_lerp(o,g,$,_e,rt){const at=1-_e;for(let ct=0;ct!==rt;++ct){const ft=g+ct;o[ft]=o[ft]*at+o[$+ct]*_e}}_lerpAdditive(o,g,$,_e,rt){for(let at=0;at!==rt;++at){const ct=g+at;o[ct]=o[ct]+o[$+at]*_e}}}const Ox=new RegExp("[\\[\\]\\.:\\/]","g"),RE="[^\\[\\]\\.:\\/]",aw="[^"+"\\[\\]\\.:\\/".replace("\\.","")+"]",Lx=new RegExp("^"+/((?:WC+[\/:])*)/.source.replace("WC",RE)+/(WCOD+)?/.source.replace("WCOD",aw)+/(?:\.(WC+)(?:\[(.+)\])?)?/.source.replace("WC",RE)+/\.(WC+)(?:\[(.+)\])?/.source.replace("WC",RE)+"$"),HT=["material","materials","bones","map"];class Xs{constructor(o,g,$){this.path=g,this.parsedPath=$||Xs.parseTrackName(g),this.node=Xs.findNode(o,this.parsedPath.nodeName)||o,this.rootNode=o,this.getValue=this._getValue_unbound,this.setValue=this._setValue_unbound}static create(o,g,$){return o&&o.isAnimationObjectGroup?new Xs.Composite(o,g,$):new Xs(o,g,$)}static sanitizeNodeName(o){return o.replace(/\s/g,"_").replace(Ox,"")}static parseTrackName(o){const g=Lx.exec(o);if(g===null)throw new Error("PropertyBinding: Cannot parse trackName: "+o);const $={nodeName:g[2],objectName:g[3],objectIndex:g[4],propertyName:g[5],propertyIndex:g[6]},_e=$.nodeName&&$.nodeName.lastIndexOf(".");if(_e!==void 0&&_e!==-1){const rt=$.nodeName.substring(_e+1);HT.indexOf(rt)!==-1&&($.nodeName=$.nodeName.substring(0,_e),$.objectName=rt)}if($.propertyName===null||$.propertyName.length===0)throw new Error("PropertyBinding: can not parse propertyName from trackName: "+o);return $}static findNode(o,g){if(g===void 0||g===""||g==="."||g===-1||g===o.name||g===o.uuid)return o;if(o.skeleton){const $=o.skeleton.getBoneByName(g);if($!==void 0)return $}if(o.children){const $=function(rt){for(let at=0;at<rt.length;at++){const ct=rt[at];if(ct.name===g||ct.uuid===g)return ct;const ft=$(ct.children);if(ft)return ft}return null},_e=$(o.children);if(_e)return _e}return null}_getValue_unavailable(){}_setValue_unavailable(){}_getValue_direct(o,g){o[g]=this.targetObject[this.propertyName]}_getValue_array(o,g){const $=this.resolvedProperty;for(let _e=0,rt=$.length;_e!==rt;++_e)o[g++]=$[_e]}_getValue_arrayElement(o,g){o[g]=this.resolvedProperty[this.propertyIndex]}_getValue_toArray(o,g){this.resolvedProperty.toArray(o,g)}_setValue_direct(o,g){this.targetObject[this.propertyName]=o[g]}_setValue_direct_setNeedsUpdate(o,g){this.targetObject[this.propertyName]=o[g],this.targetObject.needsUpdate=!0}_setValue_direct_setMatrixWorldNeedsUpdate(o,g){this.targetObject[this.propertyName]=o[g],this.targetObject.matrixWorldNeedsUpdate=!0}_setValue_array(o,g){const $=this.resolvedProperty;for(let _e=0,rt=$.length;_e!==rt;++_e)$[_e]=o[g++]}_setValue_array_setNeedsUpdate(o,g){const $=this.resolvedProperty;for(let _e=0,rt=$.length;_e!==rt;++_e)$[_e]=o[g++];this.targetObject.needsUpdate=!0}_setValue_array_setMatrixWorldNeedsUpdate(o,g){const $=this.resolvedProperty;for(let _e=0,rt=$.length;_e!==rt;++_e)$[_e]=o[g++];this.targetObject.matrixWorldNeedsUpdate=!0}_setValue_arrayElement(o,g){this.resolvedProperty[this.propertyIndex]=o[g]}_setValue_arrayElement_setNeedsUpdate(o,g){this.resolvedProperty[this.propertyIndex]=o[g],this.targetObject.needsUpdate=!0}_setValue_arrayElement_setMatrixWorldNeedsUpdate(o,g){this.resolvedProperty[this.propertyIndex]=o[g],this.targetObject.matrixWorldNeedsUpdate=!0}_setValue_fromArray(o,g){this.resolvedProperty.fromArray(o,g)}_setValue_fromArray_setNeedsUpdate(o,g){this.resolvedProperty.fromArray(o,g),this.targetObject.needsUpdate=!0}_setValue_fromArray_setMatrixWorldNeedsUpdate(o,g){this.resolvedProperty.fromArray(o,g),this.targetObject.matrixWorldNeedsUpdate=!0}_getValue_unbound(o,g){this.bind(),this.getValue(o,g)}_setValue_unbound(o,g){this.bind(),this.setValue(o,g)}bind(){let o=this.node;const g=this.parsedPath,$=g.objectName,_e=g.propertyName;let rt=g.propertyIndex;if(o||(o=Xs.findNode(this.rootNode,g.nodeName)||this.rootNode,this.node=o),this.getValue=this._getValue_unavailable,this.setValue=this._setValue_unavailable,!o)return void console.error("THREE.PropertyBinding: Trying to update node for track: "+this.path+" but it wasn't found.");if($){let mt=g.objectIndex;switch($){case"materials":if(!o.material)return void console.error("THREE.PropertyBinding: Can not bind to material as node does not have a material.",this);if(!o.material.materials)return void console.error("THREE.PropertyBinding: Can not bind to material.materials as node.material does not have a materials array.",this);o=o.material.materials;break;case"bones":if(!o.skeleton)return void console.error("THREE.PropertyBinding: Can not bind to bones as node does not have a skeleton.",this);o=o.skeleton.bones;for(let bt=0;bt<o.length;bt++)if(o[bt].name===mt){mt=bt;break}break;case"map":if(!o.material)return void console.error("THREE.PropertyBinding: Can not bind to material as node does not have a material.",this);if(!o.material.map)return void console.error("THREE.PropertyBinding: Can not bind to material.map as node.material does not have a map.",this);o=o.material.map;break;default:if(o[$]===void 0)return void console.error("THREE.PropertyBinding: Can not bind to objectName of node undefined.",this);o=o[$]}if(mt!==void 0){if(o[mt]===void 0)return void console.error("THREE.PropertyBinding: Trying to bind to objectIndex of objectName, but is undefined.",this,o);o=o[mt]}}const at=o[_e];if(at===void 0){const mt=g.nodeName;return void console.error("THREE.PropertyBinding: Trying to update property for track: "+mt+"."+_e+" but it wasn't found.",o)}let ct=this.Versioning.None;this.targetObject=o,o.needsUpdate!==void 0?ct=this.Versioning.NeedsUpdate:o.matrixWorldNeedsUpdate!==void 0&&(ct=this.Versioning.MatrixWorldNeedsUpdate);let ft=this.BindingType.Direct;if(rt!==void 0){if(_e==="morphTargetInfluences"){if(!o.geometry)return void console.error("THREE.PropertyBinding: Can not bind to morphTargetInfluences because node does not have a geometry.",this);if(!o.geometry.morphAttributes)return void console.error("THREE.PropertyBinding: Can not bind to morphTargetInfluences because node does not have a geometry.morphAttributes.",this);o.morphTargetDictionary[rt]!==void 0&&(rt=o.morphTargetDictionary[rt])}ft=this.BindingType.ArrayElement,this.resolvedProperty=at,this.propertyIndex=rt}else at.fromArray!==void 0&&at.toArray!==void 0?(ft=this.BindingType.HasFromToArray,this.resolvedProperty=at):Array.isArray(at)?(ft=this.BindingType.EntireArray,this.resolvedProperty=at):this.propertyName=_e;this.getValue=this.GetterByBindingType[ft],this.setValue=this.SetterByBindingTypeAndVersioning[ft][ct]}unbind(){this.node=null,this.getValue=this._getValue_unbound,this.setValue=this._setValue_unbound}}Xs.Composite=class{constructor(dt,o,g){const $=g||Xs.parseTrackName(o);this._targetGroup=dt,this._bindings=dt.subscribe_(o,$)}getValue(dt,o){this.bind();const g=this._targetGroup.nCachedObjects_,$=this._bindings[g];$!==void 0&&$.getValue(dt,o)}setValue(dt,o){const g=this._bindings;for(let $=this._targetGroup.nCachedObjects_,_e=g.length;$!==_e;++$)g[$].setValue(dt,o)}bind(){const dt=this._bindings;for(let o=this._targetGroup.nCachedObjects_,g=dt.length;o!==g;++o)dt[o].bind()}unbind(){const dt=this._bindings;for(let o=this._targetGroup.nCachedObjects_,g=dt.length;o!==g;++o)dt[o].unbind()}},Xs.prototype.BindingType={Direct:0,EntireArray:1,ArrayElement:2,HasFromToArray:3},Xs.prototype.Versioning={None:0,NeedsUpdate:1,MatrixWorldNeedsUpdate:2},Xs.prototype.GetterByBindingType=[Xs.prototype._getValue_direct,Xs.prototype._getValue_array,Xs.prototype._getValue_arrayElement,Xs.prototype._getValue_toArray],Xs.prototype.SetterByBindingTypeAndVersioning=[[Xs.prototype._setValue_direct,Xs.prototype._setValue_direct_setNeedsUpdate,Xs.prototype._setValue_direct_setMatrixWorldNeedsUpdate],[Xs.prototype._setValue_array,Xs.prototype._setValue_array_setNeedsUpdate,Xs.prototype._setValue_array_setMatrixWorldNeedsUpdate],[Xs.prototype._setValue_arrayElement,Xs.prototype._setValue_arrayElement_setNeedsUpdate,Xs.prototype._setValue_arrayElement_setMatrixWorldNeedsUpdate],[Xs.prototype._setValue_fromArray,Xs.prototype._setValue_fromArray_setNeedsUpdate,Xs.prototype._setValue_fromArray_setMatrixWorldNeedsUpdate]];class BE{constructor(){this.isAnimationObjectGroup=!0,this.uuid=Es(),this._objects=Array.prototype.slice.call(arguments),this.nCachedObjects_=0;const o={};this._indicesByUUID=o;for(let $=0,_e=arguments.length;$!==_e;++$)o[arguments[$].uuid]=$;this._paths=[],this._parsedPaths=[],this._bindings=[],this._bindingsIndicesByPath={};const g=this;this.stats={objects:{get total(){return g._objects.length},get inUse(){return this.total-g.nCachedObjects_}},get bindingsPerObject(){return g._bindings.length}}}add(){const o=this._objects,g=this._indicesByUUID,$=this._paths,_e=this._parsedPaths,rt=this._bindings,at=rt.length;let ct,ft=o.length,mt=this.nCachedObjects_;for(let bt=0,Tt=arguments.length;bt!==Tt;++bt){const St=arguments[bt],It=St.uuid;let Rt=g[It];if(Rt===void 0){Rt=ft++,g[It]=Rt,o.push(St);for(let Dt=0,Ft=at;Dt!==Ft;++Dt)rt[Dt].push(new Xs(St,$[Dt],_e[Dt]))}else if(Rt<mt){ct=o[Rt];const Dt=--mt,Ft=o[Dt];g[Ft.uuid]=Rt,o[Rt]=Ft,g[It]=Dt,o[Dt]=St;for(let Nt=0,zt=at;Nt!==zt;++Nt){const Xt=rt[Nt],tn=Xt[Dt];let sn=Xt[Rt];Xt[Rt]=tn,sn===void 0&&(sn=new Xs(St,$[Nt],_e[Nt])),Xt[Dt]=sn}}else o[Rt]!==ct&&console.error("THREE.AnimationObjectGroup: Different objects with the same UUID detected. Clean the caches or recreate your infrastructure when reloading scenes.")}this.nCachedObjects_=mt}remove(){const o=this._objects,g=this._indicesByUUID,$=this._bindings,_e=$.length;let rt=this.nCachedObjects_;for(let at=0,ct=arguments.length;at!==ct;++at){const ft=arguments[at],mt=ft.uuid,bt=g[mt];if(bt!==void 0&&bt>=rt){const Tt=rt++,St=o[Tt];g[St.uuid]=bt,o[bt]=St,g[mt]=Tt,o[Tt]=ft;for(let It=0,Rt=_e;It!==Rt;++It){const Dt=$[It],Ft=Dt[Tt],Nt=Dt[bt];Dt[bt]=Ft,Dt[Tt]=Nt}}}this.nCachedObjects_=rt}uncache(){const o=this._objects,g=this._indicesByUUID,$=this._bindings,_e=$.length;let rt=this.nCachedObjects_,at=o.length;for(let ct=0,ft=arguments.length;ct!==ft;++ct){const mt=arguments[ct].uuid,bt=g[mt];if(bt!==void 0)if(delete g[mt],bt<rt){const Tt=--rt,St=o[Tt],It=--at,Rt=o[It];g[St.uuid]=bt,o[bt]=St,g[Rt.uuid]=Tt,o[Tt]=Rt,o.pop();for(let Dt=0,Ft=_e;Dt!==Ft;++Dt){const Nt=$[Dt],zt=Nt[Tt],Xt=Nt[It];Nt[bt]=zt,Nt[Tt]=Xt,Nt.pop()}}else{const Tt=--at,St=o[Tt];Tt>0&&(g[St.uuid]=bt),o[bt]=St,o.pop();for(let It=0,Rt=_e;It!==Rt;++It){const Dt=$[It];Dt[bt]=Dt[Tt],Dt.pop()}}}this.nCachedObjects_=rt}subscribe_(o,g){const $=this._bindingsIndicesByPath;let _e=$[o];const rt=this._bindings;if(_e!==void 0)return rt[_e];const at=this._paths,ct=this._parsedPaths,ft=this._objects,mt=ft.length,bt=this.nCachedObjects_,Tt=new Array(mt);_e=rt.length,$[o]=_e,at.push(o),ct.push(g),rt.push(Tt);for(let St=bt,It=ft.length;St!==It;++St){const Rt=ft[St];Tt[St]=new Xs(Rt,o,g)}return Tt}unsubscribe_(o){const g=this._bindingsIndicesByPath,$=g[o];if($!==void 0){const _e=this._paths,rt=this._parsedPaths,at=this._bindings,ct=at.length-1,ft=at[ct];g[o[ct]]=$,at[$]=ft,at.pop(),rt[$]=rt[ct],rt.pop(),_e[$]=_e[ct],_e.pop()}}}class D_{constructor(o,g,$=null,_e=g.blendMode){this._mixer=o,this._clip=g,this._localRoot=$,this.blendMode=_e;const rt=g.tracks,at=rt.length,ct=new Array(at),ft={endingStart:Do,endingEnd:Do};for(let mt=0;mt!==at;++mt){const bt=rt[mt].createInterpolant(null);ct[mt]=bt,bt.settings=ft}this._interpolantSettings=ft,this._interpolants=ct,this._propertyBindings=new Array(at),this._cacheIndex=null,this._byClipCacheIndex=null,this._timeScaleInterpolant=null,this._weightInterpolant=null,this.loop=Wu,this._loopCount=-1,this._startTime=null,this.time=0,this.timeScale=1,this._effectiveTimeScale=1,this.weight=1,this._effectiveWeight=1,this.repetitions=1/0,this.paused=!1,this.enabled=!0,this.clampWhenFinished=!1,this.zeroSlopeAtStart=!0,this.zeroSlopeAtEnd=!0}play(){return this._mixer._activateAction(this),this}stop(){return this._mixer._deactivateAction(this),this.reset()}reset(){return this.paused=!1,this.enabled=!0,this.time=0,this._loopCount=-1,this._startTime=null,this.stopFading().stopWarping()}isRunning(){return this.enabled&&!this.paused&&this.timeScale!==0&&this._startTime===null&&this._mixer._isActiveAction(this)}isScheduled(){return this._mixer._isActiveAction(this)}startAt(o){return this._startTime=o,this}setLoop(o,g){return this.loop=o,this.repetitions=g,this}setEffectiveWeight(o){return this.weight=o,this._effectiveWeight=this.enabled?o:0,this.stopFading()}getEffectiveWeight(){return this._effectiveWeight}fadeIn(o){return this._scheduleFading(o,0,1)}fadeOut(o){return this._scheduleFading(o,1,0)}crossFadeFrom(o,g,$){if(o.fadeOut(g),this.fadeIn(g),$){const _e=this._clip.duration,rt=o._clip.duration,at=rt/_e,ct=_e/rt;o.warp(1,at,g),this.warp(ct,1,g)}return this}crossFadeTo(o,g,$){return o.crossFadeFrom(this,g,$)}stopFading(){const o=this._weightInterpolant;return o!==null&&(this._weightInterpolant=null,this._mixer._takeBackControlInterpolant(o)),this}setEffectiveTimeScale(o){return this.timeScale=o,this._effectiveTimeScale=this.paused?0:o,this.stopWarping()}getEffectiveTimeScale(){return this._effectiveTimeScale}setDuration(o){return this.timeScale=this._clip.duration/o,this.stopWarping()}syncWith(o){return this.time=o.time,this.timeScale=o.timeScale,this.stopWarping()}halt(o){return this.warp(this._effectiveTimeScale,0,o)}warp(o,g,$){const _e=this._mixer,rt=_e.time,at=this.timeScale;let ct=this._timeScaleInterpolant;ct===null&&(ct=_e._lendControlInterpolant(),this._timeScaleInterpolant=ct);const ft=ct.parameterPositions,mt=ct.sampleValues;return ft[0]=rt,ft[1]=rt+$,mt[0]=o/at,mt[1]=g/at,this}stopWarping(){const o=this._timeScaleInterpolant;return o!==null&&(this._timeScaleInterpolant=null,this._mixer._takeBackControlInterpolant(o)),this}getMixer(){return this._mixer}getClip(){return this._clip}getRoot(){return this._localRoot||this._mixer._root}_update(o,g,$,_e){if(!this.enabled)return void this._updateWeight(o);const rt=this._startTime;if(rt!==null){const ft=(o-rt)*$;ft<0||$===0?g=0:(this._startTime=null,g=$*ft)}g*=this._updateTimeScale(o);const at=this._updateTime(g),ct=this._updateWeight(o);if(ct>0){const ft=this._interpolants,mt=this._propertyBindings;if(this.blendMode===rp)for(let bt=0,Tt=ft.length;bt!==Tt;++bt)ft[bt].evaluate(at),mt[bt].accumulateAdditive(ct);else for(let bt=0,Tt=ft.length;bt!==Tt;++bt)ft[bt].evaluate(at),mt[bt].accumulate(_e,ct)}}_updateWeight(o){let g=0;if(this.enabled){g=this.weight;const $=this._weightInterpolant;if($!==null){const _e=$.evaluate(o)[0];g*=_e,o>$.parameterPositions[1]&&(this.stopFading(),_e===0&&(this.enabled=!1))}}return this._effectiveWeight=g,g}_updateTimeScale(o){let g=0;if(!this.paused){g=this.timeScale;const $=this._timeScaleInterpolant;$!==null&&(g*=$.evaluate(o)[0],o>$.parameterPositions[1]&&(this.stopWarping(),g===0?this.paused=!0:this.timeScale=g))}return this._effectiveTimeScale=g,g}_updateTime(o){const g=this._clip.duration,$=this.loop;let _e=this.time+o,rt=this._loopCount;const at=$===xy;if(o===0)return rt===-1?_e:at&&(1&rt)==1?g-_e:_e;if($===Sv){rt===-1&&(this._loopCount=0,this._setEndings(!0,!0,!1));e:{if(_e>=g)_e=g;else{if(!(_e<0)){this.time=_e;break e}_e=0}this.clampWhenFinished?this.paused=!0:this.enabled=!1,this.time=_e,this._mixer.dispatchEvent({type:"finished",action:this,direction:o<0?-1:1})}}else{if(rt===-1&&(o>=0?(rt=0,this._setEndings(!0,this.repetitions===0,at)):this._setEndings(this.repetitions===0,!0,at)),_e>=g||_e<0){const ct=Math.floor(_e/g);_e-=g*ct,rt+=Math.abs(ct);const ft=this.repetitions-rt;if(ft<=0)this.clampWhenFinished?this.paused=!0:this.enabled=!1,_e=o>0?g:0,this.time=_e,this._mixer.dispatchEvent({type:"finished",action:this,direction:o>0?1:-1});else{if(ft===1){const mt=o<0;this._setEndings(mt,!mt,at)}else this._setEndings(!1,!1,at);this._loopCount=rt,this.time=_e,this._mixer.dispatchEvent({type:"loop",action:this,loopDelta:ct})}}else this.time=_e;if(at&&(1&rt)==1)return g-_e}return _e}_setEndings(o,g,$){const _e=this._interpolantSettings;$?(_e.endingStart=xp,_e.endingEnd=xp):(_e.endingStart=o?this.zeroSlopeAtStart?xp:Do:Nm,_e.endingEnd=g?this.zeroSlopeAtEnd?xp:Do:Nm)}_scheduleFading(o,g,$){const _e=this._mixer,rt=_e.time;let at=this._weightInterpolant;at===null&&(at=_e._lendControlInterpolant(),this._weightInterpolant=at);const ct=at.parameterPositions,ft=at.sampleValues;return ct[0]=rt,ft[0]=g,ct[1]=rt+o,ft[1]=$,this}}const $A=new Float32Array(1);class O0 extends op{constructor(o){super(),this._root=o,this._initMemoryManager(),this._accuIndex=0,this.time=0,this.timeScale=1}_bindAction(o,g){const $=o._localRoot||this._root,_e=o._clip.tracks,rt=_e.length,at=o._propertyBindings,ct=o._interpolants,ft=$.uuid,mt=this._bindingsByRootAndName;let bt=mt[ft];bt===void 0&&(bt={},mt[ft]=bt);for(let Tt=0;Tt!==rt;++Tt){const St=_e[Tt],It=St.name;let Rt=bt[It];if(Rt!==void 0)++Rt.referenceCount,at[Tt]=Rt;else{if(Rt=at[Tt],Rt!==void 0){Rt._cacheIndex===null&&(++Rt.referenceCount,this._addInactiveBinding(Rt,ft,It));continue}const Dt=g&&g._propertyBindings[Tt].binding.parsedPath;Rt=new PE(Xs.create($,It,Dt),St.ValueTypeName,St.getValueSize()),++Rt.referenceCount,this._addInactiveBinding(Rt,ft,It),at[Tt]=Rt}ct[Tt].resultBuffer=Rt.buffer}}_activateAction(o){if(!this._isActiveAction(o)){if(o._cacheIndex===null){const $=(o._localRoot||this._root).uuid,_e=o._clip.uuid,rt=this._actionsByClip[_e];this._bindAction(o,rt&&rt.knownActions[0]),this._addInactiveAction(o,_e,$)}const g=o._propertyBindings;for(let $=0,_e=g.length;$!==_e;++$){const rt=g[$];rt.useCount++==0&&(this._lendBinding(rt),rt.saveOriginalState())}this._lendAction(o)}}_deactivateAction(o){if(this._isActiveAction(o)){const g=o._propertyBindings;for(let $=0,_e=g.length;$!==_e;++$){const rt=g[$];--rt.useCount==0&&(rt.restoreOriginalState(),this._takeBackBinding(rt))}this._takeBackAction(o)}}_initMemoryManager(){this._actions=[],this._nActiveActions=0,this._actionsByClip={},this._bindings=[],this._nActiveBindings=0,this._bindingsByRootAndName={},this._controlInterpolants=[],this._nActiveControlInterpolants=0;const o=this;this.stats={actions:{get total(){return o._actions.length},get inUse(){return o._nActiveActions}},bindings:{get total(){return o._bindings.length},get inUse(){return o._nActiveBindings}},controlInterpolants:{get total(){return o._controlInterpolants.length},get inUse(){return o._nActiveControlInterpolants}}}}_isActiveAction(o){const g=o._cacheIndex;return g!==null&&g<this._nActiveActions}_addInactiveAction(o,g,$){const _e=this._actions,rt=this._actionsByClip;let at=rt[g];if(at===void 0)at={knownActions:[o],actionByRoot:{}},o._byClipCacheIndex=0,rt[g]=at;else{const ct=at.knownActions;o._byClipCacheIndex=ct.length,ct.push(o)}o._cacheIndex=_e.length,_e.push(o),at.actionByRoot[$]=o}_removeInactiveAction(o){const g=this._actions,$=g[g.length-1],_e=o._cacheIndex;$._cacheIndex=_e,g[_e]=$,g.pop(),o._cacheIndex=null;const rt=o._clip.uuid,at=this._actionsByClip,ct=at[rt],ft=ct.knownActions,mt=ft[ft.length-1],bt=o._byClipCacheIndex;mt._byClipCacheIndex=bt,ft[bt]=mt,ft.pop(),o._byClipCacheIndex=null,delete ct.actionByRoot[(o._localRoot||this._root).uuid],ft.length===0&&delete at[rt],this._removeInactiveBindingsForAction(o)}_removeInactiveBindingsForAction(o){const g=o._propertyBindings;for(let $=0,_e=g.length;$!==_e;++$){const rt=g[$];--rt.referenceCount==0&&this._removeInactiveBinding(rt)}}_lendAction(o){const g=this._actions,$=o._cacheIndex,_e=this._nActiveActions++,rt=g[_e];o._cacheIndex=_e,g[_e]=o,rt._cacheIndex=$,g[$]=rt}_takeBackAction(o){const g=this._actions,$=o._cacheIndex,_e=--this._nActiveActions,rt=g[_e];o._cacheIndex=_e,g[_e]=o,rt._cacheIndex=$,g[$]=rt}_addInactiveBinding(o,g,$){const _e=this._bindingsByRootAndName,rt=this._bindings;let at=_e[g];at===void 0&&(at={},_e[g]=at),at[$]=o,o._cacheIndex=rt.length,rt.push(o)}_removeInactiveBinding(o){const g=this._bindings,$=o.binding,_e=$.rootNode.uuid,rt=$.path,at=this._bindingsByRootAndName,ct=at[_e],ft=g[g.length-1],mt=o._cacheIndex;ft._cacheIndex=mt,g[mt]=ft,g.pop(),delete ct[rt],Object.keys(ct).length===0&&delete at[_e]}_lendBinding(o){const g=this._bindings,$=o._cacheIndex,_e=this._nActiveBindings++,rt=g[_e];o._cacheIndex=_e,g[_e]=o,rt._cacheIndex=$,g[$]=rt}_takeBackBinding(o){const g=this._bindings,$=o._cacheIndex,_e=--this._nActiveBindings,rt=g[_e];o._cacheIndex=_e,g[_e]=o,rt._cacheIndex=$,g[$]=rt}_lendControlInterpolant(){const o=this._controlInterpolants,g=this._nActiveControlInterpolants++;let $=o[g];return $===void 0&&($=new Sl(new Float32Array(2),new Float32Array(2),1,$A),$.__cacheIndex=g,o[g]=$),$}_takeBackControlInterpolant(o){const g=this._controlInterpolants,$=o.__cacheIndex,_e=--this._nActiveControlInterpolants,rt=g[_e];o.__cacheIndex=_e,g[_e]=o,rt.__cacheIndex=$,g[$]=rt}clipAction(o,g,$){const _e=g||this._root,rt=_e.uuid;let at=typeof o=="string"?iv.findByName(_e,o):o;const ct=at!==null?at.uuid:o,ft=this._actionsByClip[ct];let mt=null;if($===void 0&&($=at!==null?at.blendMode:Yl),ft!==void 0){const Tt=ft.actionByRoot[rt];if(Tt!==void 0&&Tt.blendMode===$)return Tt;mt=ft.knownActions[0],at===null&&(at=mt._clip)}if(at===null)return null;const bt=new D_(this,at,g,$);return this._bindAction(bt,mt),this._addInactiveAction(bt,ct,rt),bt}existingAction(o,g){const $=g||this._root,_e=$.uuid,rt=typeof o=="string"?iv.findByName($,o):o,at=rt?rt.uuid:o,ct=this._actionsByClip[at];return ct!==void 0&&ct.actionByRoot[_e]||null}stopAllAction(){const o=this._actions;for(let g=this._nActiveActions-1;g>=0;--g)o[g].stop();return this}update(o){o*=this.timeScale;const g=this._actions,$=this._nActiveActions,_e=this.time+=o,rt=Math.sign(o),at=this._accuIndex^=1;for(let mt=0;mt!==$;++mt)g[mt]._update(_e,o,rt,at);const ct=this._bindings,ft=this._nActiveBindings;for(let mt=0;mt!==ft;++mt)ct[mt].apply(at);return this}setTime(o){this.time=0;for(let g=0;g<this._actions.length;g++)this._actions[g].time=0;return this.update(o)}getRoot(){return this._root}uncacheClip(o){const g=this._actions,$=o.uuid,_e=this._actionsByClip,rt=_e[$];if(rt!==void 0){const at=rt.knownActions;for(let ct=0,ft=at.length;ct!==ft;++ct){const mt=at[ct];this._deactivateAction(mt);const bt=mt._cacheIndex,Tt=g[g.length-1];mt._cacheIndex=null,mt._byClipCacheIndex=null,Tt._cacheIndex=bt,g[bt]=Tt,g.pop(),this._removeInactiveBindingsForAction(mt)}delete _e[$]}}uncacheRoot(o){const g=o.uuid,$=this._actionsByClip;for(const rt in $){const at=$[rt].actionByRoot[g];at!==void 0&&(this._deactivateAction(at),this._removeInactiveAction(at))}const _e=this._bindingsByRootAndName[g];if(_e!==void 0)for(const rt in _e){const at=_e[rt];at.restoreOriginalState(),this._removeInactiveBinding(at)}}uncacheAction(o,g){const $=this.existingAction(o,g);$!==null&&(this._deactivateAction($),this._removeInactiveAction($))}}class Nx{constructor(o){this.value=o}clone(){return new Nx(this.value.clone===void 0?this.value:this.value.clone())}}let Ou=0;class Ux extends op{constructor(){super(),this.isUniformsGroup=!0,Object.defineProperty(this,"id",{value:Ou++}),this.name="",this.usage=Iu,this.uniforms=[]}add(o){return this.uniforms.push(o),this}remove(o){const g=this.uniforms.indexOf(o);return g!==-1&&this.uniforms.splice(g,1),this}setName(o){return this.name=o,this}setUsage(o){return this.usage=o,this}dispose(){return this.dispatchEvent({type:"dispose"}),this}copy(o){this.name=o.name,this.usage=o.usage;const g=o.uniforms;this.uniforms.length=0;for(let $=0,_e=g.length;$<_e;$++)this.uniforms.push(g[$].clone());return this}clone(){return new this.constructor().copy(this)}}class kE extends cx{constructor(o,g,$=1){super(o,g),this.isInstancedInterleavedBuffer=!0,this.meshPerAttribute=$}copy(o){return super.copy(o),this.meshPerAttribute=o.meshPerAttribute,this}clone(o){const g=super.clone(o);return g.meshPerAttribute=this.meshPerAttribute,g}toJSON(o){const g=super.toJSON(o);return g.isInstancedInterleavedBuffer=!0,g.meshPerAttribute=this.meshPerAttribute,g}}class ey{constructor(o,g,$,_e,rt){this.isGLBufferAttribute=!0,this.buffer=o,this.type=g,this.itemSize=$,this.elementSize=_e,this.count=rt,this.version=0}set needsUpdate(o){o===!0&&this.version++}setBuffer(o){return this.buffer=o,this}setType(o,g){return this.type=o,this.elementSize=g,this}setItemSize(o){return this.itemSize=o,this}setCount(o){return this.count=o,this}}class OE{constructor(o,g,$=0,_e=1/0){this.ray=new _0(o,g),this.near=$,this.far=_e,this.camera=null,this.layers=new pA,this.params={Mesh:{},Line:{threshold:1},LOD:{},Points:{threshold:1},Sprite:{}}}set(o,g){this.ray.set(o,g)}setFromCamera(o,g){g.isPerspectiveCamera?(this.ray.origin.setFromMatrixPosition(g.matrixWorld),this.ray.direction.set(o.x,o.y,.5).unproject(g).sub(this.ray.origin).normalize(),this.camera=g):g.isOrthographicCamera?(this.ray.origin.set(o.x,o.y,(g.near+g.far)/(g.near-g.far)).unproject(g),this.ray.direction.set(0,0,-1).transformDirection(g.matrixWorld),this.camera=g):console.error("THREE.Raycaster: Unsupported camera type: "+g.type)}intersectObject(o,g=!0,$=[]){return jx(o,this,$,g),$.sort(Fx),$}intersectObjects(o,g=!0,$=[]){for(let _e=0,rt=o.length;_e<rt;_e++)jx(o[_e],this,$,g);return $.sort(Fx),$}}function Fx(dt,o){return dt.distance-o.distance}function jx(dt,o,g,$){if(dt.layers.test(o.layers)&&dt.raycast(o,g),$===!0){const _e=dt.children;for(let rt=0,at=_e.length;rt<at;rt++)jx(_e[rt],o,g,!0)}}class lw{constructor(o=1,g=0,$=0){return this.radius=o,this.phi=g,this.theta=$,this}set(o,g,$){return this.radius=o,this.phi=g,this.theta=$,this}copy(o){return this.radius=o.radius,this.phi=o.phi,this.theta=o.theta,this}makeSafe(){return this.phi=Math.max(1e-6,Math.min(Math.PI-1e-6,this.phi)),this}setFromVector3(o){return this.setFromCartesianCoords(o.x,o.y,o.z)}setFromCartesianCoords(o,g,$){return this.radius=Math.sqrt(o*o+g*g+$*$),this.radius===0?(this.theta=0,this.phi=0):(this.theta=Math.atan2(o,$),this.phi=Math.acos(As(g/this.radius,-1,1))),this}clone(){return new this.constructor().copy(this)}}class LE{constructor(o=1,g=0,$=0){return this.radius=o,this.theta=g,this.y=$,this}set(o,g,$){return this.radius=o,this.theta=g,this.y=$,this}copy(o){return this.radius=o.radius,this.theta=o.theta,this.y=o.y,this}setFromVector3(o){return this.setFromCartesianCoords(o.x,o.y,o.z)}setFromCartesianCoords(o,g,$){return this.radius=Math.sqrt(o*o+$*$),this.theta=Math.atan2(o,$),this.y=g,this}clone(){return new this.constructor().copy(this)}}const cw=new Sr;class NE{constructor(o=new Sr(1/0,1/0),g=new Sr(-1/0,-1/0)){this.isBox2=!0,this.min=o,this.max=g}set(o,g){return this.min.copy(o),this.max.copy(g),this}setFromPoints(o){this.makeEmpty();for(let g=0,$=o.length;g<$;g++)this.expandByPoint(o[g]);return this}setFromCenterAndSize(o,g){const $=cw.copy(g).multiplyScalar(.5);return this.min.copy(o).sub($),this.max.copy(o).add($),this}clone(){return new this.constructor().copy(this)}copy(o){return this.min.copy(o.min),this.max.copy(o.max),this}makeEmpty(){return this.min.x=this.min.y=1/0,this.max.x=this.max.y=-1/0,this}isEmpty(){return this.max.x<this.min.x||this.max.y<this.min.y}getCenter(o){return this.isEmpty()?o.set(0,0):o.addVectors(this.min,this.max).multiplyScalar(.5)}getSize(o){return this.isEmpty()?o.set(0,0):o.subVectors(this.max,this.min)}expandByPoint(o){return this.min.min(o),this.max.max(o),this}expandByVector(o){return this.min.sub(o),this.max.add(o),this}expandByScalar(o){return this.min.addScalar(-o),this.max.addScalar(o),this}containsPoint(o){return!(o.x<this.min.x||o.x>this.max.x||o.y<this.min.y||o.y>this.max.y)}containsBox(o){return this.min.x<=o.min.x&&o.max.x<=this.max.x&&this.min.y<=o.min.y&&o.max.y<=this.max.y}getParameter(o,g){return g.set((o.x-this.min.x)/(this.max.x-this.min.x),(o.y-this.min.y)/(this.max.y-this.min.y))}intersectsBox(o){return!(o.max.x<this.min.x||o.min.x>this.max.x||o.max.y<this.min.y||o.min.y>this.max.y)}clampPoint(o,g){return g.copy(o).clamp(this.min,this.max)}distanceToPoint(o){return cw.copy(o).clamp(this.min,this.max).sub(o).length()}intersect(o){return this.min.max(o.min),this.max.min(o.max),this}union(o){return this.min.min(o.min),this.max.max(o.max),this}translate(o){return this.min.add(o),this.max.add(o),this}equals(o){return o.min.equals(this.min)&&o.max.equals(this.max)}}const ty=new fn,ny=new fn;class UE{constructor(o=new fn,g=new fn){this.start=o,this.end=g}set(o,g){return this.start.copy(o),this.end.copy(g),this}copy(o){return this.start.copy(o.start),this.end.copy(o.end),this}getCenter(o){return o.addVectors(this.start,this.end).multiplyScalar(.5)}delta(o){return o.subVectors(this.end,this.start)}distanceSq(){return this.start.distanceToSquared(this.end)}distance(){return this.start.distanceTo(this.end)}at(o,g){return this.delta(g).multiplyScalar(o).add(this.start)}closestPointToPointParameter(o,g){ty.subVectors(o,this.start),ny.subVectors(this.end,this.start);const $=ny.dot(ny);let _e=ny.dot(ty)/$;return g&&(_e=As(_e,0,1)),_e}closestPointToPoint(o,g,$){const _e=this.closestPointToPointParameter(o,g);return this.delta($).multiplyScalar(_e).add(this.start)}applyMatrix4(o){return this.start.applyMatrix4(o),this.end.applyMatrix4(o),this}equals(o){return o.start.equals(this.start)&&o.end.equals(this.end)}clone(){return new this.constructor().copy(this)}}const uw=new fn;class LC extends no{constructor(o,g){super(),this.light=o,this.light.updateMatrixWorld(),this.matrix=o.matrixWorld,this.matrixAutoUpdate=!1,this.color=g;const $=new fs,_e=[0,0,0,0,0,1,0,0,0,1,0,1,0,0,0,-1,0,1,0,0,0,0,1,1,0,0,0,0,-1,1];for(let at=0,ct=1,ft=32;at<ft;at++,ct++){const mt=at/ft*Math.PI*2,bt=ct/ft*Math.PI*2;_e.push(Math.cos(mt),Math.sin(mt),1,Math.cos(bt),Math.sin(bt),1)}$.setAttribute("position",new ht(_e,3));const rt=new Ju({fog:!1,toneMapped:!1});this.cone=new _g($,rt),this.add(this.cone),this.update()}dispose(){this.cone.geometry.dispose(),this.cone.material.dispose()}update(){this.light.updateMatrixWorld();const o=this.light.distance?this.light.distance:1e3,g=o*Math.tan(this.light.angle);this.cone.scale.set(g,g,o),uw.setFromMatrixPosition(this.light.target.matrixWorld),this.cone.lookAt(uw),this.color!==void 0?this.cone.material.color.set(this.color):this.cone.material.color.copy(this.light.color)}}const Xv=new fn,Kv=new Os,NC=new Os;class hw extends _g{constructor(o){const g=FE(o),$=new fs,_e=[],rt=[],at=new rs(0,0,1),ct=new rs(0,1,0);for(let ft=0;ft<g.length;ft++){const mt=g[ft];mt.parent&&mt.parent.isBone&&(_e.push(0,0,0),_e.push(0,0,0),rt.push(at.r,at.g,at.b),rt.push(ct.r,ct.g,ct.b))}$.setAttribute("position",new ht(_e,3)),$.setAttribute("color",new ht(rt,3)),super($,new Ju({vertexColors:!0,depthTest:!1,depthWrite:!1,toneMapped:!1,transparent:!0})),this.isSkeletonHelper=!0,this.type="SkeletonHelper",this.root=o,this.bones=g,this.matrix=o.matrixWorld,this.matrixAutoUpdate=!1}updateMatrixWorld(o){const g=this.bones,$=this.geometry,_e=$.getAttribute("position");NC.copy(this.root.matrixWorld).invert();for(let rt=0,at=0;rt<g.length;rt++){const ct=g[rt];ct.parent&&ct.parent.isBone&&(Kv.multiplyMatrices(NC,ct.matrixWorld),Xv.setFromMatrixPosition(Kv),_e.setXYZ(at,Xv.x,Xv.y,Xv.z),Kv.multiplyMatrices(NC,ct.parent.matrixWorld),Xv.setFromMatrixPosition(Kv),_e.setXYZ(at+1,Xv.x,Xv.y,Xv.z),at+=2)}$.getAttribute("position").needsUpdate=!0,super.updateMatrixWorld(o)}}function FE(dt){const o=[];dt.isBone===!0&&o.push(dt);for(let g=0;g<dt.children.length;g++)o.push.apply(o,FE(dt.children[g]));return o}class WT extends Zl{constructor(o,g,$){super(new M_(g,4,2),new gm({wireframe:!0,fog:!1,toneMapped:!1})),this.light=o,this.light.updateMatrixWorld(),this.color=$,this.type="PointLightHelper",this.matrix=this.light.matrixWorld,this.matrixAutoUpdate=!1,this.update()}dispose(){this.geometry.dispose(),this.material.dispose()}update(){this.color!==void 0?this.material.color.set(this.color):this.material.color.copy(this.light.color)}}const TD=new fn,UC=new rs,qT=new rs;class ID extends no{constructor(o,g,$){super(),this.light=o,this.light.updateMatrixWorld(),this.matrix=o.matrixWorld,this.matrixAutoUpdate=!1,this.color=$;const _e=new $y(g);_e.rotateY(.5*Math.PI),this.material=new gm({wireframe:!0,fog:!1,toneMapped:!1}),this.color===void 0&&(this.material.vertexColors=!0);const rt=_e.getAttribute("position"),at=new Float32Array(3*rt.count);_e.setAttribute("color",new Ro(at,3)),this.add(new Zl(_e,this.material)),this.update()}dispose(){this.children[0].geometry.dispose(),this.children[0].material.dispose()}update(){const o=this.children[0];if(this.color!==void 0)this.material.color.set(this.color);else{const g=o.geometry.getAttribute("color");UC.copy(this.light.color),qT.copy(this.light.groundColor);for(let $=0,_e=g.count;$<_e;$++){const rt=$<_e/2?UC:qT;g.setXYZ($,rt.r,rt.g,rt.b)}g.needsUpdate=!0}o.lookAt(TD.setFromMatrixPosition(this.light.matrixWorld).negate())}}class YT extends _g{constructor(o=10,g=10,$=4473924,_e=8947848){$=new rs($),_e=new rs(_e);const rt=g/2,at=o/g,ct=o/2,ft=[],mt=[];for(let Tt=0,St=0,It=-ct;Tt<=g;Tt++,It+=at){ft.push(-ct,0,It,ct,0,It),ft.push(It,0,-ct,It,0,ct);const Rt=Tt===rt?$:_e;Rt.toArray(mt,St),St+=3,Rt.toArray(mt,St),St+=3,Rt.toArray(mt,St),St+=3,Rt.toArray(mt,St),St+=3}const bt=new fs;bt.setAttribute("position",new ht(ft,3)),bt.setAttribute("color",new ht(mt,3)),super(bt,new Ju({vertexColors:!0,toneMapped:!1})),this.type="GridHelper"}}class FC extends _g{constructor(o=10,g=16,$=8,_e=64,rt=4473924,at=8947848){rt=new rs(rt),at=new rs(at);const ct=[],ft=[];if(g>1)for(let bt=0;bt<g;bt++){const Tt=bt/g*(2*Math.PI),St=Math.sin(Tt)*o,It=Math.cos(Tt)*o;ct.push(0,0,0),ct.push(St,0,It);const Rt=1&bt?rt:at;ft.push(Rt.r,Rt.g,Rt.b),ft.push(Rt.r,Rt.g,Rt.b)}for(let bt=0;bt<$;bt++){const Tt=1&bt?rt:at,St=o-o/$*bt;for(let It=0;It<_e;It++){let Rt=It/_e*(2*Math.PI),Dt=Math.sin(Rt)*St,Ft=Math.cos(Rt)*St;ct.push(Dt,0,Ft),ft.push(Tt.r,Tt.g,Tt.b),Rt=(It+1)/_e*(2*Math.PI),Dt=Math.sin(Rt)*St,Ft=Math.cos(Rt)*St,ct.push(Dt,0,Ft),ft.push(Tt.r,Tt.g,Tt.b)}}const mt=new fs;mt.setAttribute("position",new ht(ct,3)),mt.setAttribute("color",new ht(ft,3)),super(mt,new Ju({vertexColors:!0,toneMapped:!1})),this.type="PolarGridHelper"}}const jC=new fn,$s=new fn,au=new fn;class L0 extends no{constructor(o,g,$){super(),this.light=o,this.light.updateMatrixWorld(),this.matrix=o.matrixWorld,this.matrixAutoUpdate=!1,this.color=$,g===void 0&&(g=1);let _e=new fs;_e.setAttribute("position",new ht([-g,g,0,g,g,0,g,-g,0,-g,-g,0,-g,g,0],3));const rt=new Ju({fog:!1,toneMapped:!1});this.lightPlane=new S_(_e,rt),this.add(this.lightPlane),_e=new fs,_e.setAttribute("position",new ht([0,0,0,0,0,1],3)),this.targetLine=new S_(_e,rt),this.add(this.targetLine),this.update()}dispose(){this.lightPlane.geometry.dispose(),this.lightPlane.material.dispose(),this.targetLine.geometry.dispose(),this.targetLine.material.dispose()}update(){jC.setFromMatrixPosition(this.light.matrixWorld),$s.setFromMatrixPosition(this.light.target.matrixWorld),au.subVectors($s,jC),this.lightPlane.lookAt($s),this.color!==void 0?(this.lightPlane.material.color.set(this.color),this.targetLine.material.color.set(this.color)):(this.lightPlane.material.color.copy(this.light.color),this.targetLine.material.color.copy(this.light.color)),this.targetLine.lookAt($s),this.targetLine.scale.z=au.length()}}const N0=new fn,Ko=new xA;class zx extends _g{constructor(o){const g=new fs,$=new Ju({color:16777215,vertexColors:!0,toneMapped:!1}),_e=[],rt=[],at={};function ct(Rt,Dt){ft(Rt),ft(Dt)}function ft(Rt){_e.push(0,0,0),rt.push(0,0,0),at[Rt]===void 0&&(at[Rt]=[]),at[Rt].push(_e.length/3-1)}ct("n1","n2"),ct("n2","n4"),ct("n4","n3"),ct("n3","n1"),ct("f1","f2"),ct("f2","f4"),ct("f4","f3"),ct("f3","f1"),ct("n1","f1"),ct("n2","f2"),ct("n3","f3"),ct("n4","f4"),ct("p","n1"),ct("p","n2"),ct("p","n3"),ct("p","n4"),ct("u1","u2"),ct("u2","u3"),ct("u3","u1"),ct("c","t"),ct("p","c"),ct("cn1","cn2"),ct("cn3","cn4"),ct("cf1","cf2"),ct("cf3","cf4"),g.setAttribute("position",new ht(_e,3)),g.setAttribute("color",new ht(rt,3)),super(g,$),this.type="CameraHelper",this.camera=o,this.camera.updateProjectionMatrix&&this.camera.updateProjectionMatrix(),this.matrix=o.matrixWorld,this.matrixAutoUpdate=!1,this.pointMap=at,this.update();const mt=new rs(16755200),bt=new rs(16711680),Tt=new rs(43775),St=new rs(16777215),It=new rs(3355443);this.setColors(mt,bt,Tt,St,It)}setColors(o,g,$,_e,rt){const at=this.geometry.getAttribute("color");at.setXYZ(0,o.r,o.g,o.b),at.setXYZ(1,o.r,o.g,o.b),at.setXYZ(2,o.r,o.g,o.b),at.setXYZ(3,o.r,o.g,o.b),at.setXYZ(4,o.r,o.g,o.b),at.setXYZ(5,o.r,o.g,o.b),at.setXYZ(6,o.r,o.g,o.b),at.setXYZ(7,o.r,o.g,o.b),at.setXYZ(8,o.r,o.g,o.b),at.setXYZ(9,o.r,o.g,o.b),at.setXYZ(10,o.r,o.g,o.b),at.setXYZ(11,o.r,o.g,o.b),at.setXYZ(12,o.r,o.g,o.b),at.setXYZ(13,o.r,o.g,o.b),at.setXYZ(14,o.r,o.g,o.b),at.setXYZ(15,o.r,o.g,o.b),at.setXYZ(16,o.r,o.g,o.b),at.setXYZ(17,o.r,o.g,o.b),at.setXYZ(18,o.r,o.g,o.b),at.setXYZ(19,o.r,o.g,o.b),at.setXYZ(20,o.r,o.g,o.b),at.setXYZ(21,o.r,o.g,o.b),at.setXYZ(22,o.r,o.g,o.b),at.setXYZ(23,o.r,o.g,o.b),at.setXYZ(24,g.r,g.g,g.b),at.setXYZ(25,g.r,g.g,g.b),at.setXYZ(26,g.r,g.g,g.b),at.setXYZ(27,g.r,g.g,g.b),at.setXYZ(28,g.r,g.g,g.b),at.setXYZ(29,g.r,g.g,g.b),at.setXYZ(30,g.r,g.g,g.b),at.setXYZ(31,g.r,g.g,g.b),at.setXYZ(32,$.r,$.g,$.b),at.setXYZ(33,$.r,$.g,$.b),at.setXYZ(34,$.r,$.g,$.b),at.setXYZ(35,$.r,$.g,$.b),at.setXYZ(36,$.r,$.g,$.b),at.setXYZ(37,$.r,$.g,$.b),at.setXYZ(38,_e.r,_e.g,_e.b),at.setXYZ(39,_e.r,_e.g,_e.b),at.setXYZ(40,rt.r,rt.g,rt.b),at.setXYZ(41,rt.r,rt.g,rt.b),at.setXYZ(42,rt.r,rt.g,rt.b),at.setXYZ(43,rt.r,rt.g,rt.b),at.setXYZ(44,rt.r,rt.g,rt.b),at.setXYZ(45,rt.r,rt.g,rt.b),at.setXYZ(46,rt.r,rt.g,rt.b),at.setXYZ(47,rt.r,rt.g,rt.b),at.setXYZ(48,rt.r,rt.g,rt.b),at.setXYZ(49,rt.r,rt.g,rt.b),at.needsUpdate=!0}update(){const o=this.geometry,g=this.pointMap;Ko.projectionMatrixInverse.copy(this.camera.projectionMatrixInverse),Ll("c",g,o,Ko,0,0,-1),Ll("t",g,o,Ko,0,0,1),Ll("n1",g,o,Ko,-1,-1,-1),Ll("n2",g,o,Ko,1,-1,-1),Ll("n3",g,o,Ko,-1,1,-1),Ll("n4",g,o,Ko,1,1,-1),Ll("f1",g,o,Ko,-1,-1,1),Ll("f2",g,o,Ko,1,-1,1),Ll("f3",g,o,Ko,-1,1,1),Ll("f4",g,o,Ko,1,1,1),Ll("u1",g,o,Ko,.7,1.1,-1),Ll("u2",g,o,Ko,-.7,1.1,-1),Ll("u3",g,o,Ko,0,2,-1),Ll("cf1",g,o,Ko,-1,0,1),Ll("cf2",g,o,Ko,1,0,1),Ll("cf3",g,o,Ko,0,-1,1),Ll("cf4",g,o,Ko,0,1,1),Ll("cn1",g,o,Ko,-1,0,-1),Ll("cn2",g,o,Ko,1,0,-1),Ll("cn3",g,o,Ko,0,-1,-1),Ll("cn4",g,o,Ko,0,1,-1),o.getAttribute("position").needsUpdate=!0}dispose(){this.geometry.dispose(),this.material.dispose()}}function Ll(dt,o,g,$,_e,rt,at){N0.set(_e,rt,at).unproject($);const ct=o[dt];if(ct!==void 0){const ft=g.getAttribute("position");for(let mt=0,bt=ct.length;mt<bt;mt++)ft.setXYZ(ct[mt],N0.x,N0.y,N0.z)}}const Vx=new Xl;class zC extends _g{constructor(o,g=16776960){const $=new Uint16Array([0,1,1,2,2,3,3,0,4,5,5,6,6,7,7,4,0,4,1,5,2,6,3,7]),_e=new Float32Array(24),rt=new fs;rt.setIndex(new Ro($,1)),rt.setAttribute("position",new Ro(_e,3)),super(rt,new Ju({color:g,toneMapped:!1})),this.object=o,this.type="BoxHelper",this.matrixAutoUpdate=!1,this.update()}update(o){if(o!==void 0&&console.warn("THREE.BoxHelper: .update() has no longer arguments."),this.object!==void 0&&Vx.setFromObject(this.object),Vx.isEmpty())return;const g=Vx.min,$=Vx.max,_e=this.geometry.attributes.position,rt=_e.array;rt[0]=$.x,rt[1]=$.y,rt[2]=$.z,rt[3]=g.x,rt[4]=$.y,rt[5]=$.z,rt[6]=g.x,rt[7]=g.y,rt[8]=$.z,rt[9]=$.x,rt[10]=g.y,rt[11]=$.z,rt[12]=$.x,rt[13]=$.y,rt[14]=g.z,rt[15]=g.x,rt[16]=$.y,rt[17]=g.z,rt[18]=g.x,rt[19]=g.y,rt[20]=g.z,rt[21]=$.x,rt[22]=g.y,rt[23]=g.z,_e.needsUpdate=!0,this.geometry.computeBoundingSphere()}setFromObject(o){return this.object=o,this.update(),this}copy(o,g){return super.copy(o,g),this.object=o.object,this}}class jE extends _g{constructor(o,g=16776960){const $=new Uint16Array([0,1,1,2,2,3,3,0,4,5,5,6,6,7,7,4,0,4,1,5,2,6,3,7]),_e=new fs;_e.setIndex(new Ro($,1)),_e.setAttribute("position",new ht([1,1,1,-1,1,1,-1,-1,1,1,-1,1,1,1,-1,-1,1,-1,-1,-1,-1,1,-1,-1],3)),super(_e,new Ju({color:g,toneMapped:!1})),this.box=o,this.type="Box3Helper",this.geometry.computeBoundingSphere()}updateMatrixWorld(o){const g=this.box;g.isEmpty()||(g.getCenter(this.position),g.getSize(this.scale),this.scale.multiplyScalar(.5),super.updateMatrixWorld(o))}}class XT extends S_{constructor(o,g=1,$=16776960){const _e=$,rt=new fs;rt.setAttribute("position",new ht([1,-1,0,-1,1,0,-1,-1,0,1,1,0,-1,1,0,-1,-1,0,1,-1,0,1,1,0],3)),rt.computeBoundingSphere(),super(rt,new Ju({color:_e,toneMapped:!1})),this.type="PlaneHelper",this.plane=o,this.size=g;const at=new fs;at.setAttribute("position",new ht([1,1,0,-1,1,0,-1,-1,0,1,1,0,-1,-1,0,1,-1,0],3)),at.computeBoundingSphere(),this.add(new Zl(at,new gm({color:_e,opacity:.2,transparent:!0,depthWrite:!1,toneMapped:!1})))}updateMatrixWorld(o){this.position.set(0,0,0),this.scale.set(.5*this.size,.5*this.size,1),this.lookAt(this.plane.normal),this.translateZ(-this.plane.constant),super.updateMatrixWorld(o)}}const VC=new fn;let dw,iy;class Al extends no{constructor(o=new fn(0,0,1),g=new fn(0,0,0),$=1,_e=16776960,rt=.2*$,at=.2*rt){super(),this.type="ArrowHelper",dw===void 0&&(dw=new fs,dw.setAttribute("position",new ht([0,0,0,0,1,0],3)),iy=new FA(0,.5,1,5,1),iy.translate(0,-.5,0)),this.position.copy(g),this.line=new S_(dw,new Ju({color:_e,toneMapped:!1})),this.line.matrixAutoUpdate=!1,this.add(this.line),this.cone=new Zl(iy,new gm({color:_e,toneMapped:!1})),this.cone.matrixAutoUpdate=!1,this.add(this.cone),this.setDirection(o),this.setLength($,rt,at)}setDirection(o){if(o.y>.99999)this.quaternion.set(0,0,0,1);else if(o.y<-.99999)this.quaternion.set(1,0,0,0);else{VC.set(o.z,0,-o.x).normalize();const g=Math.acos(o.y);this.quaternion.setFromAxisAngle(VC,g)}}setLength(o,g=.2*o,$=.2*g){this.line.scale.set(1,Math.max(1e-4,o-g),1),this.line.updateMatrix(),this.cone.scale.set($,g,$),this.cone.position.y=o,this.cone.updateMatrix()}setColor(o){this.line.material.color.set(o),this.cone.material.color.set(o)}copy(o){return super.copy(o,!1),this.line.copy(o.line),this.cone.copy(o.cone),this}}class ry extends _g{constructor(o=1){const g=[0,0,0,o,0,0,0,0,0,0,o,0,0,0,0,0,0,o],$=new fs;$.setAttribute("position",new ht(g,3)),$.setAttribute("color",new ht([1,0,0,1,.6,0,0,1,0,.6,1,0,0,0,1,0,.6,1],3)),super($,new Ju({vertexColors:!0,toneMapped:!1})),this.type="AxesHelper"}setColors(o,g,$){const _e=new rs,rt=this.geometry.attributes.color.array;return _e.set(o),_e.toArray(rt,0),_e.toArray(rt,3),_e.set(g),_e.toArray(rt,6),_e.toArray(rt,9),_e.set($),_e.toArray(rt,12),_e.toArray(rt,15),this.geometry.attributes.color.needsUpdate=!0,this}dispose(){this.geometry.dispose(),this.material.dispose()}}class Em{constructor(){this.type="ShapePath",this.color=new rs,this.subPaths=[],this.currentPath=null}moveTo(o,g){return this.currentPath=new Ky,this.subPaths.push(this.currentPath),this.currentPath.moveTo(o,g),this}lineTo(o,g){return this.currentPath.lineTo(o,g),this}quadraticCurveTo(o,g,$,_e){return this.currentPath.quadraticCurveTo(o,g,$,_e),this}bezierCurveTo(o,g,$,_e,rt,at){return this.currentPath.bezierCurveTo(o,g,$,_e,rt,at),this}splineThru(o){return this.currentPath.splineThru(o),this}toShapes(o,g){function $(zt){const Xt=[];for(let tn=0,sn=zt.length;tn<sn;tn++){const ln=zt[tn],kn=new jA;kn.curves=ln.curves,Xt.push(kn)}return Xt}function _e(zt,Xt){const tn=Xt.length;let sn=!1;for(let ln=tn-1,kn=0;kn<tn;ln=kn++){let Ln=Xt[ln],qn=Xt[kn],Kn=qn.x-Ln.x,On=qn.y-Ln.y;if(Math.abs(On)>Number.EPSILON){if(On<0&&(Ln=Xt[kn],Kn=-Kn,qn=Xt[ln],On=-On),zt.y<Ln.y||zt.y>qn.y)continue;if(zt.y===Ln.y){if(zt.x===Ln.x)return!0}else{const _r=On*(zt.x-Ln.x)-Kn*(zt.y-Ln.y);if(_r===0)return!0;if(_r<0)continue;sn=!sn}}else{if(zt.y!==Ln.y)continue;if(qn.x<=zt.x&&zt.x<=Ln.x||Ln.x<=zt.x&&zt.x<=qn.x)return!0}}return sn}const rt=xu.isClockWise,at=this.subPaths;if(at.length===0)return[];if(g===!0)return $(at);let ct,ft,mt;const bt=[];if(at.length===1)return ft=at[0],mt=new jA,mt.curves=ft.curves,bt.push(mt),bt;let Tt=!rt(at[0].getPoints());Tt=o?!Tt:Tt;const St=[],It=[];let Rt,Dt,Ft=[],Nt=0;It[Nt]=void 0,Ft[Nt]=[];for(let zt=0,Xt=at.length;zt<Xt;zt++)ft=at[zt],Rt=ft.getPoints(),ct=rt(Rt),ct=o?!ct:ct,ct?(!Tt&&It[Nt]&&Nt++,It[Nt]={s:new jA,p:Rt},It[Nt].s.curves=ft.curves,Tt&&Nt++,Ft[Nt]=[]):Ft[Nt].push({h:ft,p:Rt[0]});if(!It[0])return $(at);if(It.length>1){let zt=!1,Xt=0;for(let tn=0,sn=It.length;tn<sn;tn++)St[tn]=[];for(let tn=0,sn=It.length;tn<sn;tn++){const ln=Ft[tn];for(let kn=0;kn<ln.length;kn++){const Ln=ln[kn];let qn=!0;for(let Kn=0;Kn<It.length;Kn++)_e(Ln.p,It[Kn].p)&&(tn!==Kn&&Xt++,qn?(qn=!1,St[Kn].push(Ln)):zt=!0);qn&&St[tn].push(Ln)}}Xt>0&&zt===!1&&(Ft=St)}for(let zt=0,Xt=It.length;zt<Xt;zt++){mt=It[zt].s,bt.push(mt),Dt=Ft[zt];for(let tn=0,sn=Dt.length;tn<sn;tn++)mt.holes.push(Dt[tn].h)}return bt}}const Lu=pw();function pw(){const dt=new ArrayBuffer(4),o=new Float32Array(dt),g=new Uint32Array(dt),$=new Uint32Array(512),_e=new Uint32Array(512);for(let ft=0;ft<256;++ft){const mt=ft-127;mt<-27?($[ft]=0,$[256|ft]=32768,_e[ft]=24,_e[256|ft]=24):mt<-14?($[ft]=1024>>-mt-14,$[256|ft]=1024>>-mt-14|32768,_e[ft]=-mt-1,_e[256|ft]=-mt-1):mt<=15?($[ft]=mt+15<<10,$[256|ft]=mt+15<<10|32768,_e[ft]=13,_e[256|ft]=13):mt<128?($[ft]=31744,$[256|ft]=64512,_e[ft]=24,_e[256|ft]=24):($[ft]=31744,$[256|ft]=64512,_e[ft]=13,_e[256|ft]=13)}const rt=new Uint32Array(2048),at=new Uint32Array(64),ct=new Uint32Array(64);for(let ft=1;ft<1024;++ft){let mt=ft<<13,bt=0;for(;!(8388608&mt);)mt<<=1,bt-=8388608;mt&=-8388609,bt+=947912704,rt[ft]=mt|bt}for(let ft=1024;ft<2048;++ft)rt[ft]=939524096+(ft-1024<<13);for(let ft=1;ft<31;++ft)at[ft]=ft<<23;at[31]=1199570944,at[32]=2147483648;for(let ft=33;ft<63;++ft)at[ft]=2147483648+(ft-32<<23);at[63]=3347054592;for(let ft=1;ft<64;++ft)ft!==32&&(ct[ft]=1024);return{floatView:o,uint32View:g,baseTable:$,shiftTable:_e,mantissaTable:rt,exponentTable:at,offsetTable:ct}}var KT=Object.freeze({__proto__:null,toHalfFloat:function(dt){Math.abs(dt)>65504&&console.warn("THREE.DataUtils.toHalfFloat(): Value out of range."),dt=As(dt,-65504,65504),Lu.floatView[0]=dt;const o=Lu.uint32View[0],g=o>>23&511;return Lu.baseTable[g]+((8388607&o)>>Lu.shiftTable[g])},fromHalfFloat:function(dt){const o=dt>>10;return Lu.uint32View[0]=Lu.mantissaTable[Lu.offsetTable[o]+(1023&dt)]+Lu.exponentTable[o],Lu.floatView[0]}});function JT(){console.error("THREE.ImmediateRenderObject has been removed.")}class ZT extends ap{constructor(o,g,$){console.error('THREE.WebGLMultisampleRenderTarget has been removed. Use a normal render target and set the "samples" property to greater 0 to enable multisampling.'),super(o,g,$),this.samples=4}}class $T extends h_{constructor(o,g,$,_e){console.warn("THREE.DataTexture2DArray has been renamed to DataArrayTexture."),super(o,g,$,_e)}}class zE extends d_{constructor(o,g,$,_e){console.warn("THREE.DataTexture3D has been renamed to Data3DTexture."),super(o,g,$,_e)}}class Sm extends E0{constructor(o,g,$,_e,rt,at){console.warn("THREE.BoxBufferGeometry has been renamed to THREE.BoxGeometry."),super(o,g,$,_e,rt,at)}}class VE extends ev{constructor(o,g,$,_e){console.warn("THREE.CapsuleBufferGeometry has been renamed to THREE.CapsuleGeometry."),super(o,g,$,_e)}}class Qx extends Jy{constructor(o,g,$,_e){console.warn("THREE.CircleBufferGeometry has been renamed to THREE.CircleGeometry."),super(o,g,$,_e)}}class Cm extends ro{constructor(o,g,$,_e,rt,at,ct){console.warn("THREE.ConeBufferGeometry has been renamed to THREE.ConeGeometry."),super(o,g,$,_e,rt,at,ct)}}class Gx extends FA{constructor(o,g,$,_e,rt,at,ct,ft){console.warn("THREE.CylinderBufferGeometry has been renamed to THREE.CylinderGeometry."),super(o,g,$,_e,rt,at,ct,ft)}}class Jv extends Zy{constructor(o,g){console.warn("THREE.DodecahedronBufferGeometry has been renamed to THREE.DodecahedronGeometry."),super(o,g)}}class fw extends QA{constructor(o,g){console.warn("THREE.ExtrudeBufferGeometry has been renamed to THREE.ExtrudeGeometry."),super(o,g)}}class QE extends bx{constructor(o,g){console.warn("THREE.IcosahedronBufferGeometry has been renamed to THREE.IcosahedronGeometry."),super(o,g)}}class GE extends Vv{constructor(o,g,$,_e){console.warn("THREE.LatheBufferGeometry has been renamed to THREE.LatheGeometry."),super(o,g,$,_e)}}class QC extends $y{constructor(o,g){console.warn("THREE.OctahedronBufferGeometry has been renamed to THREE.OctahedronGeometry."),super(o,g)}}class mw extends bA{constructor(o,g,$,_e){console.warn("THREE.PlaneBufferGeometry has been renamed to THREE.PlaneGeometry."),super(o,g,$,_e)}}class Hx extends Qv{constructor(o,g,$,_e){console.warn("THREE.PolyhedronBufferGeometry has been renamed to THREE.PolyhedronGeometry."),super(o,g,$,_e)}}class GC extends ew{constructor(o,g,$,_e,rt,at){console.warn("THREE.RingBufferGeometry has been renamed to THREE.RingGeometry."),super(o,g,$,_e,rt,at)}}class eI extends $u{constructor(o,g){console.warn("THREE.ShapeBufferGeometry has been renamed to THREE.ShapeGeometry."),super(o,g)}}class U0 extends M_{constructor(o,g,$,_e,rt,at,ct){console.warn("THREE.SphereBufferGeometry has been renamed to THREE.SphereGeometry."),super(o,g,$,_e,rt,at,ct)}}class tI extends Ex{constructor(o,g){console.warn("THREE.TetrahedronBufferGeometry has been renamed to THREE.TetrahedronGeometry."),super(o,g)}}class nI extends Sx{constructor(o,g,$,_e,rt){console.warn("THREE.TorusBufferGeometry has been renamed to THREE.TorusGeometry."),super(o,g,$,_e,rt)}}class gw extends tw{constructor(o,g,$,_e,rt,at){console.warn("THREE.TorusKnotBufferGeometry has been renamed to THREE.TorusKnotGeometry."),super(o,g,$,_e,rt,at)}}class HC extends _h{constructor(o,g,$,_e,rt){console.warn("THREE.TubeBufferGeometry has been renamed to THREE.TubeGeometry."),super(o,g,$,_e,rt)}}typeof __THREE_DEVTOOLS__<"u"&&__THREE_DEVTOOLS__.dispatchEvent(new CustomEvent("register",{detail:{revision:b}})),typeof window<"u"&&(window.__THREE__?console.warn("WARNING: Multiple instances of Three.js being imported."):window.__THREE__=b)},553:function(j,tt,ot){ot.d(tt,{_:function(){return Et}});var b=ot(988);const yt=new WeakMap;class Et extends b.aNw{constructor(Vt){super(Vt),this.decoderPath="",this.decoderConfig={},this.decoderBinary=null,this.decoderPending=null,this.workerLimit=4,this.workerPool=[],this.workerNextTaskID=1,this.workerSourceURL="",this.defaultAttributeIDs={position:"POSITION",normal:"NORMAL",color:"COLOR",uv:"TEX_COORD"},this.defaultAttributeTypes={position:"Float32Array",normal:"Float32Array",color:"Float32Array",uv:"Float32Array"}}setDecoderPath(Vt){return this.decoderPath=Vt,this}setDecoderConfig(Vt){return this.decoderConfig=Vt,this}setWorkerLimit(Vt){return this.workerLimit=Vt,this}load(Vt,an,Pn,gn){const dn=new b.hH6(this.manager);dn.setPath(this.path),dn.setResponseType("arraybuffer"),dn.setRequestHeader(this.requestHeader),dn.setWithCredentials(this.withCredentials),dn.load(Vt,wn=>{this.decodeDracoFile(wn,an).catch(gn)},Pn,gn)}decodeDracoFile(Vt,an,Pn,gn){const dn={attributeIDs:Pn||this.defaultAttributeIDs,attributeTypes:gn||this.defaultAttributeTypes,useUniqueIDs:!!Pn};return this.decodeGeometry(Vt,dn).then(an)}decodeGeometry(Vt,an){const Pn=JSON.stringify(an);if(yt.has(Vt)){const $t=yt.get(Vt);if($t.key===Pn)return $t.promise;if(Vt.byteLength===0)throw new Error("THREE.DRACOLoader: Unable to re-decode a buffer with different settings. Buffer has already been transferred.")}let gn;const dn=this.workerNextTaskID++,wn=Vt.byteLength,_n=this._getWorker(dn,wn).then($t=>(gn=$t,new Promise((bn,Ut)=>{gn._callbacks[dn]={resolve:bn,reject:Ut},gn.postMessage({type:"decode",id:dn,taskConfig:an,buffer:Vt},[Vt])}))).then($t=>this._createGeometry($t.geometry));return _n.catch(()=>!0).then(()=>{gn&&dn&&this._releaseTask(gn,dn)}),yt.set(Vt,{key:Pn,promise:_n}),_n}_createGeometry(Vt){const an=new b.u9r;Vt.index&&an.setIndex(new b.TlE(Vt.index.array,1));for(let Pn=0;Pn<Vt.attributes.length;Pn++){const gn=Vt.attributes[Pn],dn=gn.name,wn=gn.array,_n=gn.itemSize;an.setAttribute(dn,new b.TlE(wn,_n))}return an}_loadLibrary(Vt,an){const Pn=new b.hH6(this.manager);return Pn.setPath(this.decoderPath),Pn.setResponseType(an),Pn.setWithCredentials(this.withCredentials),new Promise((gn,dn)=>{Pn.load(Vt,gn,void 0,dn)})}preload(){return this._initDecoder(),this}_initDecoder(){if(this.decoderPending)return this.decoderPending;const Vt=typeof WebAssembly!="object"||this.decoderConfig.type==="js",an=[];return Vt?an.push(this._loadLibrary("draco_decoder.js","text")):(an.push(this._loadLibrary("draco_wasm_wrapper.js","text")),an.push(this._loadLibrary("draco_decoder.wasm","arraybuffer"))),this.decoderPending=Promise.all(an).then(Pn=>{const gn=Pn[0];Vt||(this.decoderConfig.wasmBinary=Pn[1]);const dn=kt.toString(),wn=["/* draco decoder */",gn,"","/* worker */",dn.substring(dn.indexOf("{")+1,dn.lastIndexOf("}"))].join(`
`);this.workerSourceURL=URL.createObjectURL(new Blob([wn]))}),this.decoderPending}_getWorker(Vt,an){return this._initDecoder().then(()=>{if(this.workerPool.length<this.workerLimit){const gn=new Worker(this.workerSourceURL);gn._callbacks={},gn._taskCosts={},gn._taskLoad=0,gn.postMessage({type:"init",decoderConfig:this.decoderConfig}),gn.onmessage=function(dn){const wn=dn.data;switch(wn.type){case"decode":gn._callbacks[wn.id].resolve(wn);break;case"error":gn._callbacks[wn.id].reject(wn);break;default:console.error('THREE.DRACOLoader: Unexpected message, "'+wn.type+'"')}},this.workerPool.push(gn)}else this.workerPool.sort(function(gn,dn){return gn._taskLoad>dn._taskLoad?-1:1});const Pn=this.workerPool[this.workerPool.length-1];return Pn._taskCosts[Vt]=an,Pn._taskLoad+=an,Pn})}_releaseTask(Vt,an){Vt._taskLoad-=Vt._taskCosts[an],delete Vt._callbacks[an],delete Vt._taskCosts[an]}debug(){console.log("Task load: ",this.workerPool.map(Vt=>Vt._taskLoad))}dispose(){for(let Vt=0;Vt<this.workerPool.length;++Vt)this.workerPool[Vt].terminate();return this.workerPool.length=0,this}}function kt(){let Gt,Vt;function an(Pn,gn,dn,wn,_n,$t){const bn=$t.num_components(),Ut=dn.num_points()*bn,jt=Ut*_n.BYTES_PER_ELEMENT,Yt=function(Cn,Qt){switch(Qt){case Float32Array:return Cn.DT_FLOAT32;case Int8Array:return Cn.DT_INT8;case Int16Array:return Cn.DT_INT16;case Int32Array:return Cn.DT_INT32;case Uint8Array:return Cn.DT_UINT8;case Uint16Array:return Cn.DT_UINT16;case Uint32Array:return Cn.DT_UINT32}}(Pn,_n),Bn=Pn._malloc(jt);gn.GetAttributeDataArrayForAllPoints(dn,$t,Yt,jt,Bn);const un=new _n(Pn.HEAPF32.buffer,Bn,Ut).slice();return Pn._free(Bn),{name:wn,array:un,itemSize:bn}}onmessage=function(Pn){const gn=Pn.data;switch(gn.type){case"init":Gt=gn.decoderConfig,Vt=new Promise(function(_n){Gt.onModuleLoaded=function($t){_n({draco:$t})},DracoDecoderModule(Gt)});break;case"decode":const dn=gn.buffer,wn=gn.taskConfig;Vt.then(_n=>{const $t=_n.draco,bn=new $t.Decoder,Ut=new $t.DecoderBuffer;Ut.Init(new Int8Array(dn),dn.byteLength);try{const jt=function(Bn,un,Cn,Qt){const Wt=Qt.attributeIDs,Zt=Qt.attributeTypes;let En,pn;const er=un.GetEncodedGeometryType(Cn);if(er===Bn.TRIANGULAR_MESH)En=new Bn.Mesh,pn=un.DecodeBufferToMesh(Cn,En);else{if(er!==Bn.POINT_CLOUD)throw new Error("THREE.DRACOLoader: Unexpected geometry type.");En=new Bn.PointCloud,pn=un.DecodeBufferToPointCloud(Cn,En)}if(!pn.ok()||En.ptr===0)throw new Error("THREE.DRACOLoader: Decoding failed: "+pn.error_msg());const Ir={index:null,attributes:[]};for(const Dr in Wt){const Vr=self[Zt[Dr]];let yr,Hr;if(Qt.useUniqueIDs)Hr=Wt[Dr],yr=un.GetAttributeByUniqueId(En,Hr);else{if(Hr=un.GetAttributeId(En,Bn[Wt[Dr]]),Hr===-1)continue;yr=un.GetAttribute(En,Hr)}Ir.attributes.push(an(Bn,un,En,Dr,Vr,yr))}return er===Bn.TRIANGULAR_MESH&&(Ir.index=function(Dr,Vr,yr){const Hr=3*yr.num_faces(),Xn=4*Hr,ir=Dr._malloc(Xn);Vr.GetTrianglesUInt32Array(yr,Xn,ir);const zn=new Uint32Array(Dr.HEAPF32.buffer,ir,Hr).slice();return Dr._free(ir),{array:zn,itemSize:1}}(Bn,un,En)),Bn.destroy(En),Ir}($t,bn,Ut,wn),Yt=jt.attributes.map(Bn=>Bn.array.buffer);jt.index&&Yt.push(jt.index.array.buffer),self.postMessage({type:"decode",id:gn.id,geometry:jt},Yt)}catch(jt){console.error(jt),self.postMessage({type:"error",id:gn.id,error:jt.message})}finally{$t.destroy(Ut),$t.destroy(bn)}})}}}}},__webpackgi_module_cache__={};function __webpackgi_require__(j){var tt=__webpackgi_module_cache__[j];if(tt!==void 0)return tt.exports;var ot=__webpackgi_module_cache__[j]={id:j,exports:{}};return __webpackgi_modules__[j].call(ot.exports,ot,ot.exports,__webpackgi_require__),ot.exports}__webpackgi_require__.n=function(j){var tt=j&&j.__esModule?function(){return j.default}:function(){return j};return __webpackgi_require__.d(tt,{a:tt}),tt},__webpackgi_require__.d=function(j,tt){for(var ot in tt)__webpackgi_require__.o(tt,ot)&&!__webpackgi_require__.o(j,ot)&&Object.defineProperty(j,ot,{enumerable:!0,get:tt[ot]})},__webpackgi_require__.o=function(j,tt){return Object.prototype.hasOwnProperty.call(j,tt)},__webpackgi_require__.r=function(j){typeof Symbol<"u"&&Symbol.toStringTag&&Object.defineProperty(j,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(j,"__esModule",{value:!0})},__webpackgi_require__.nc=void 0;var __webpackgi_exports__={};(function(){__webpackgi_require__.d(__webpackgi_exports__,{MWW:function(){return ow},LY2:function(){return b.LY2},GYo:function(){return L2},HRj:function(){return u0},li4:function(){return r3},FO5:function(){return s3},Nlh:function(){return n3},QvI:function(){return Ls},JHp:function(){return KS},bGH:function(){return b.bGH},NDo:function(){return b.NDo},gSk:function(){return b.gSk},WMw:function(){return b.WMw},OTo:function(){return b.OTo},Se2:function(){return b.Se2},cum:function(){return b.cum},Mig:function(){return b.Mig},B$7:function(){return FM},i_9:function(){return b.i_9},m7l:function(){return b.m7l},sYA:function(){return b.sYA},Xcj:function(){return b.Xcj},mzJ:function(){return b.mzJ},ZZA:function(){return b.ZZA},$Ph:function(){return Wp},T__:function(){return b.T__},HkE:function(){return b.HkE},tGC:function(){return b.tGC},g1S:function(){return k_},I$C:function(){return tM},QIH:function(){return io},_JE:function(){return Kp},SwW:function(){return hw},ksm:function(){return qr},jl_:function(){return _A},b7R:function(){return Ry},BDV:function(){return Qp},Ea_:function(){return Ww},qff:function(){return _A},tmC:function(){return Fv},BON:function(){return zS},P40:function(){return NS},wLL:function(){return rD},iHO:function(){return B1},BbS:function(){return b.BbS},kqm:function(){return b.kqm},Hmr:function(){return b.Hmr},SJI:function(){return b.SJI},mTL:function(){return b.mTL},y8_:function(){return b.y8_},_Li:function(){return b._Li},g56:function(){return ku},bj3:function(){return Ks},z81:function(){return b.z81},_MY:function(){return b._MY},yEv:function(){return Yx},dFZ:function(){return xx},N$j:function(){return b.N$j},_YM:function(){return b._YM},TUj:function(){return b.TUj},ZzF:function(){return b.ZzF},qzb:function(){return Dr},GQ:function(){return b.GQ},nvb:function(){return b.nvb},DvJ:function(){return b.DvJ},fQA:function(){return b.fQA},cPz:function(){return ox},TlE:function(){return b.TlE},u9r:function(){return b.u9r},s4_:function(){return b.s4_},T95:function(){return b.T95},F5w:function(){return g2},NlP:function(){return O2},$8Z:function(){return dy},YYN:function(){return uy},CtF:function(){return b.CtF},V1s:function(){return b.V1s},jOv:function(){return Wu},Rki:function(){return b.Rki},pzV:function(){return H2},itZ:function(){return Pl},qKx:function(){return Xo},vlJ:function(){return lM},nPO:function(){return j_},zcQ:function(){return kT},GH1:function(){return P0},ROQ:function(){return b.ROQ},YN5:function(){return b.YN5},BVQ:function(){return b.BVQ},YT8:function(){return b.YT8},_DE:function(){return LE},YGz:function(){return b.YGz},trn:function(){return b.trn},zf8:function(){return b.zf8},uWy:function(){return b.uWy},wYQ:function(){return wm},SUY:function(){return b.SUY},Ilk:function(){return b.Ilk},R2R:function(){return b.R2R},epp:function(){return b.epp},xmJ:function(){return cv},GD$:function(){return b0},EB7:function(){return b.EB7},DqL:function(){return b.DqL},_3:function(){return b._3},b_z:function(){return b.b_z},OCn:function(){return z_},_am:function(){return b._am},kB7:function(){return YM},fY$:function(){return b.fY$},vxC:function(){return b.vxC},BtG:function(){return b.BtG},cBK:function(){return b.cBK},g8_:function(){return b.g8_},AXT:function(){return b.AXT},yj7:function(){return b.yj7},dYG:function(){return b.dYG},tm_:function(){return b.tm_},S2y:function(){return b.S2y},B02:function(){return b.B02},PeU:function(){return b.PeU},Hyl:function(){return b.Hyl},Wqd:function(){return b.Wqd},Xaj:function(){return b.Xaj},DUb:function(){return _d},dZ3:function(){return b.dZ3},m_w:function(){return b.m_w},fHI:function(){return b.fHI},LBq:function(){return b.LBq},dHf:function(){return t3},Qww:function(){return m_.Q},CGV:function(){return iS},JUT:function(){return b.JUT},p3g:function(){return b.p3g},IEO:function(){return b.IEO},CN8:function(){return b.CN8},zob:function(){return b.zob},yxD:function(){return b.yxD},CUS:function(){return fI},A5E:function(){return b.A5E},zqG:function(){return mp},PfX:function(){return By},Q1o:function(){return wu},jfJ:function(){return b.jfJ},T_J:function(){return b.T_J},tEQ:function(){return b.tEQ},gb4:function(){return Bo},qkB:function(){return b.qkB},cvk:function(){return T_},HWo:function(){return XA},brP:function(){return b.brP},$YQ:function(){return b.$YQ},X8d:function(){return TM},Zdt:function(){return aR},yNB:function(){return Fo},h7x:function(){return Dl},Ox3:function(){return b.Ox3},qtn:function(){return SA},cBI:function(){return b.cBI},cU9:function(){return b.cU9},DT1:function(){return b.DT1},Kgo:function(){return b.Kgo},ehD:function(){return b.ehD},fhJ:function(){return QM},y1s:function(){return Jw},fSK:function(){return b.fSK},Vdb:function(){return b.Vdb},l8J:function(){return b.l8J},dj0:function(){return b.dj0},QM0:function(){return b.QM0},OIS:function(){return Sn},q8b:function(){return vx},TOt:function(){return b.TOt},xaN:function(){return wn},Ny0:function(){return b.Ny0},NeD:function(){return FP},Zof:function(){return L1},eD:function(){return b.eD},jwo:function(){return b.jwo},dSO:function(){return b.dSO},Bf4:function(){return b.Bf4},USm:function(){return b.USm},pBf:function(){return b.pBf},eBg:function(){return eL},$Vf:function(){return b.$Vf},O7d:function(){return b.O7d},ksq:function(){return qx},gXf:function(){return CC},hH6:function(){return b.hH6},kpi:function(){return ny},DwZ:function(){return ju},kN3:function(){return uR},e62:function(){return b.e62},a$l:function(){return b.a$l},OM3:function(){return b.OM3},VzW:function(){return b.VzW},ybr:function(){return b.ybr},yo9:function(){return b.yo9},$Bt:function(){return ev},Wzm:function(){return b.Wzm},Wl3:function(){return b.Wl3},iWj:function(){return b.iWj},DNz:function(){return M0},m1M:function(){return ho},ylh:function(){return b.ylh},v9Y:function(){return b.v9Y},LSk:function(){return b.LSk},LHE:function(){return El},KE0:function(){return aP},KCF:function(){return KB},a4n:function(){return FD},zIH:function(){return fn},Hfk:function(){return g0},png:function(){return ru},tAj:function(){return Rv},Eb_:function(){return zm},BT2:function(){return JC},_8p:function(){return OR},V5Z:function(){return GT},s5b:function(){return PE},hkn:function(){return x1},GFY:function(){return Am},w$m:function(){return b.w$m},ksN:function(){return b.ksN},j4z:function(){return b.j4z},OAl:function(){return b.OAl},VLJ:function(){return b.VLJ},C73:function(){return gp},ZAu:function(){return b.ZAu},ibP:function(){return yA},_fI:function(){return b0},hUN:function(){return rv},cLu:function(){return b.cLu},vmT:function(){return b.vmT},Qpg:function(){return b.Qpg},So8:function(){return b.So8},eOv:function(){return z2},Wjw:function(){return b.Wjw},cJO:function(){return b.cJO},QRU:function(){return b.QRU},S3k:function(){return b.S3k},PpQ:function(){return b.PpQ},AHu:function(){return b.AHu},q_9:function(){return Wo},ZRs:function(){return b.ZRs},oqc:function(){return b.oqc},T_x:function(){return _l},lb7:function(){return b.lb7},L5s:function(){return b.L5s},$TI:function(){return b.$TI},SPe:function(){return b.SPe},aVm:function(){return b.aVm},j87:function(){return b.j87},RNb:function(){return b.RNb},Kz5:function(){return b.Kz5},vpT:function(){return b.vpT},kB5:function(){return b.kB5},_C8:function(){return b._C8},Syv:function(){return b.Syv},NMF:function(){return b.NMF},pIN:function(){return b.pIN},eMJ:function(){return b.eMJ},rN7:function(){return EE},iUp:function(){return SE},GFd:function(){return Nu},x5V:function(){return b.x5V},tUh:function(){return b.tUh},z8B:function(){return b.z8B},vcl:function(){return Ou},GZb:function(){return b.GZb},p7y:function(){return b.p7y},S9g:function(){return b.S9g},Zr5:function(){return b.Zr5},vCF:function(){return b.vCF},yt0:function(){return b.yt0},uXU:function(){return b.uXU},_kC:function(){return b._kC},lk7:function(){return b.lk7},USc:function(){return V2},x12:function(){return b.x12},Zzh:function(){return b.Zzh},nls:function(){return b.nls},g_z:function(){return b.g_z},U7:function(){return b.U7},FT0:function(){return b.FT0},blk:function(){return b.blk},ejS:function(){return b.ejS},rnI:function(){return b.rnI},wem:function(){return b.wem},lfu:function(){return b.lfu},FDw:function(){return b.FDw},lRj:function(){return b.lRj},D1R:function(){return b.D1R},qyh:function(){return b.qyh},GUF:function(){return b.GUF},EoG:function(){return b.EoG},aNw:function(){return b.aNw},Zp0:function(){return b.Zp0},lLk:function(){return b.lLk},jAl:function(){return b.jAl},uEv:function(){return b.uEv},YKA:function(){return b.YKA},cRx:function(){return b.cRx},Y8D:function(){return b.Y8D},RsA:function(){return b.RsA},Y0m:function(){return hI},F5T:function(){return b.F5T},EDU:function(){return n2},z$Q:function(){return u1},KA8:function(){return Vs},XUj:function(){return p2},Me$:function(){return Sw},u7G:function(){return b.u7G},PEk:function(){return h0},BG4:function(){return fP},M8C:function(){return b.M8C},Vkp:function(){return b.Vkp},yGw:function(){return b.yGw},Sm8:function(){return b.Sm8},Kj0:function(){return b.Kj0},vBJ:function(){return b.vBJ},QfV:function(){return Iu},lRF:function(){return b.lRF},Lun:function(){return b.Lun},YBo:function(){return b.YBo},kaV:function(){return b.kaV},RSm:function(){return b.RSm},xoR:function(){return b.xoR},EJi:function(){return b.EJi},Wid:function(){return b.Wid},iuj:function(){return Tu},IKL:function(){return b.IKL},r_:function(){return b.r_},OoA:function(){return b.OoA},qhX:function(){return b.qhX},qPT:function(){return Zw},M5h:function(){return b.M5h},Ns1:function(){return b.Ns1},TyD:function(){return b.TyD},vZf:function(){return b.vZf},HTd:function(){return b.HTd},aH4:function(){return b.aH4},YLQ:function(){return b.YLQ},BVF:function(){return b.BVF},MyG:function(){return b.MyG},jFi:function(){return b.jFi},aCh:function(){return b.aCh},uL9:function(){return b.uL9},TNj:function(){return _h},IFH:function(){return b.IFH},bdR:function(){return b.bdR},RPs:function(){return s1},kM_:function(){return XM},M6v:function(){return b.M6v},RvT:function(){return b.RvT},dUE:function(){return b.dUE},oe_:function(){return ZE},BuN:function(){return Mm},Tme:function(){return b.Tme},N9P:function(){return Sy},Gql:function(){return b.Gql},$XY:function(){return dA},O9d:function(){return $M},zEO:function(){return c_},qfx:function(){return H_},PA7:function(){return b.PA7},REq:function(){return b.REq},pQR:function(){return b.pQR},ghN:function(){return b.ghN},Hy8:function(){return b.Hy8},Wpd:function(){return b.Wpd},LgZ:function(){return b.LgZ},iWC:function(){return b.iWC},mqn:function(){return HU},SKe:function(){return go},iKG:function(){return b.iKG},rCq:function(){return JI},_iA:function(){return b._iA},ntZ:function(){return b.ntZ},anP:function(){return b.anP},X2e:function(){return ZB},FCo:function(){return W0},y$t:function(){return b.y$t},cPb:function(){return b.cPb},lmx:function(){return ro},JOQ:function(){return b.JOQ},BKK:function(){return b.BKK},_12:function(){return b._12},tJx:function(){return b.tJx},cek:function(){return b.cek},qD0:function(){return HS},xG9:function(){return b.xG9},wI8:function(){return fy},Sgv:function(){return hR},woe:function(){return b.woe},UY4:function(){return b.UY4},aq0:function(){return b.aq0},ujx:function(){return b.ujx},Uol:function(){return b.Uol},JiH:function(){return gM},VYz:function(){return b.VYz},_Pm:function(){return ZA},EsW:function(){return Bu},iUV:function(){return b.iUV},tf:function(){return b.tf},ZQ6:function(){return b.ZQ6},mXe:function(){return b.mXe},_fP:function(){return b._fP},iLg:function(){return b.iLg},zbs:function(){return b.zbs},UZH:function(){return b.UZH},mSO:function(){return b.mSO},wk1:function(){return b.wk1},E2K:function(){return b.E2K},FUD:function(){return b.FUD},pKu:function(){return b.pKu},GG6:function(){return b.GG6},Gih:function(){return b.Gih},iiP:function(){return b.iiP},SvJ:function(){return b.SvJ},ptH:function(){return b.ptH},jZA:function(){return b.jZA},y2t:function(){return b.y2t},gi4:function(){return b.gi4},Djp:function(){return b.Djp},BG$:function(){return b.BG$},NYV:function(){return b.NYV},xJs:function(){return b.xJs},bsb:function(){return b.bsb},ekQ:function(){return b.ekQ},CaW:function(){return b.CaW},eaV:function(){return b.eaV},BFQ:function(){return b.BFQ},v3W:function(){return b.v3W},ILR:function(){return b.ILR},UCm:function(){return b.UCm},Inb:function(){return b.Inb},U1$:function(){return Xn},LgE:function(){return b.LgE},fto:function(){return b.fto},l0P:function(){return b.l0P},vCx:function(){return b.vCx},_AM:function(){return b._AM},wuA:function(){return b.wuA},av9:function(){return b.av9},CtA:function(){return b.CtA},BvQ:function(){return Ax},FZJ:function(){return iv},FIo:function(){return b.FIo},zHn:function(){return b.zHn},iMs:function(){return b.iMs},T_f:function(){return b.T_f},hEm:function(){return b.hEm},D9w:function(){return b.D9w},sHH:function(){return Gv},CdI:function(){return b.CdI},rkc:function(){return my},rpg:function(){return b.rpg},ce8:function(){return b.ce8},rOj:function(){return b.rOj},P6m:function(){return KC},JA6:function(){return uI},V4E:function(){return b.V4E},o8S:function(){return b.o8S},flB:function(){return um},DUH:function(){return MN},KI_:function(){return b.KI_},iLN:function(){return Y1},rz_:function(){return cy},jsw:function(){return xm},srG:function(){return f2},i6Z:function(){return W1},vfv:function(){return ZC},xsS:function(){return b.xsS},or:function(){return Q2},EQj:function(){return Yp},ov0:function(){return nC},WdD:function(){return b.WdD},Vj0:function(){return b.Vj0},jyz:function(){return b.jyz},mTM:function(){return l0},Mn1:function(){return sp},Hlq:function(){return Tl},Fi7:function(){return Bp},Tn7:function(){return b.Tn7},bnF:function(){return b.bnF},HW6:function(){return b.HW6},oa8:function(){return b.oa8},T_1:function(){return b.T_1},zHJ:function(){return gv},iDF:function(){return b.iDF},iAb:function(){return b.iAb},d4E:function(){return qT},lBg:function(){return F2},JeJ:function(){return ID},FKY:function(){return ot},zlZ:function(){return $C},vkg:function(){return op},brh:function(){return DR},kZK:function(){return vv},puG:function(){return j2},OdW:function(){return b.OdW},_YX:function(){return b._YX},TUv:function(){return b.TUv},Hw6:function(){return b.Hw6},aLr:function(){return b.aLr},Aip:function(){return b.Aip},xo$:function(){return b.xo$},bIn:function(){return WU},$V:function(){return b.$V},lDi:function(){return b.lDi},gti:function(){return b.gti},PMe:function(){return b.PMe},iwP:function(){return GS},FvO:function(){return b.FvO},jyi:function(){return b.jyi},xeV:function(){return b.xeV},k74:function(){return b.k74},RlZ:function(){return b.RlZ},KhW:function(){return b.KhW},HgB:function(){return b.HgB},W2J:function(){return b.W2J},JWc:function(){return b.JWc},u37:function(){return b.u37},Z6B:function(){return b.Z6B},QZ1:function(){return b.QZ1},Ir4:function(){return b.Ir4},NwF:function(){return b.NwF},Wbm:function(){return b.Wbm},N4l:function(){return b.N4l},ej9:function(){return Cw},QmN:function(){return b.QmN},IOt:function(){return b.IOt},NOD:function(){return nw},L5g:function(){return b.L5g},H$k:function(){return b.H$k},cuP:function(){return Fu},xEZ:function(){return b.xEZ},dpR:function(){return b.dpR},wOD:function(){return $u},KNb:function(){return zM},IiN:function(){return BE},Cne:function(){return b.Cne},XvJ:function(){return b.XvJ},XZw:function(){return b.XZw},FE5:function(){return b.FE5},lVp:function(){return Qv},CJI:function(){return b.CJI},z$h:function(){return b.z$h},UlW:function(){return b.UlW},WwZ:function(){return b.WwZ},Lcc:function(){return b.Lcc},WXh:function(){return b.WXh},Vjr:function(){return NP},LuM:function(){return vR},LP5:function(){return JO},xfE:function(){return b.xfE},qlB:function(){return b.qlB},lCJ:function(){return b.lCJ},WTc:function(){return b.WTc},rAo:function(){return b.rAo},LZj:function(){return HT},xWb:function(){return b.xWb},gH0:function(){return b.gH0},rBU:function(){return b.rBU},rDY:function(){return b.rDY},ywz:function(){return b.ywz},wJv:function(){return b.wJv},JQ4:function(){return b.JQ4},k0A:function(){return b.k0A},irR:function(){return b.irR},LsT:function(){return b.LsT},q5h:function(){return EA},TKh:function(){return UM},tyg:function(){return F1},Ro5:function(){return ou},dwk:function(){return b.dwk},FM8:function(){return b.FM8},Pa4:function(){return b.Pa4},Ltg:function(){return b.Ltg},yC1:function(){return b.yC1},lHq:function(){return Mx},fO1:function(){return b.fO1},oMA:function(){return Xm},JzW:function(){return j},QEt:function(){return OE},b5g:function(){return b.b5g},Ywn:function(){return b.Ywn},GVz:function(){return b.GVz},oAp:function(){return b.oAp},kFz:function(){return b.kFz},p7A:function(){return b.p7A},dd2:function(){return b.dd2},CP7:function(){return b.CP7},fQK:function(){return b.fQK},Wd$:function(){return UC},t1_:function(){return xR},Uk6:function(){return b.Uk6},_sL:function(){return b._sL},Pnf:function(){return b.Pnf},c8b:function(){return b.c8b},_lf:function(){return b._lf},ad5:function(){return b.ad5},sZV:function(){return sD},TfA:function(){return iD},sKX:function(){return Xw},UdM:function(){return Yw},P0y:function(){return Zl},L_r:function(){return b.L_r},Bve:function(){return FE},UeO:function(){return Qm},$nx:function(){return jD},Bk6:function(){return fm},EER:function(){return Nx},y4l:function(){return Cy},pQ0:function(){return QS},wXW:function(){return A3},r5x:function(){return g3},MSI:function(){return x3},EUu:function(){return YU},jtH:function(){return Xy},T0T:function(){return Ky},gAb:function(){return K2},iwT:function(){return Vv},je_:function(){return tL},wBP:function(){return mE},LU2:function(){return lx},wQL:function(){return XU},Zs7:function(){return l2},sMc:function(){return Nl},x7s:function(){return L3},Mnd:function(){return JU},A0_:function(){return ZU},d73:function(){return s2},HCD:function(){return Cs},RG9:function(){return Gs},G2P:function(){return rE},XLf:function(){return aC},CGN:function(){return oC},RGi:function(){return by},mvg:function(){return lS},Hiy:function(){return jp},XMc:function(){return v3},N7M:function(){return f3},iv:function(){return y3},n55:function(){return xp},IaC:function(){return pv},h9t:function(){return lC},yDW:function(){return cx},gJv:function(){return A_},l$g:function(){return lO},vQi:function(){return HO},$MY:function(){return fp},wJl:function(){return XS},Z7Y:function(){return iE},X7D:function(){return dT},BnX:function(){return sC},uZ5:function(){return RA},zVI:function(){return d3},DpF:function(){return kp},nNb:function(){return Hw},cqZ:function(){return AA},pKN:function(){return XI},d_$:function(){return JM},DdI:function(){return lP},rrX:function(){return KI},KlC:function(){return KM},KVn:function(){return Hr},oau:function(){return MP},aw9:function(){return Gu},Aap:function(){return np},Dxg:function(){return Bn},MjT:function(){return J0},F7Q:function(){return rC},IFq:function(){return MR},IJl:function(){return iC},O5A:function(){return a0},wCn:function(){return rp},gGT:function(){return uT},pEc:function(){return e3},Bi6:function(){return rA},fi_:function(){return j3},TT:function(){return BN},q2Z:function(){return jU},NyK:function(){return Oo},bgu:function(){return Lw},kcS:function(){return r_},rRN:function(){return QP},ivY:function(){return Wt},_s1:function(){return sF},_HO:function(){return Ur},tpL:function(){return kr},DMK:function(){return vC},LjN:function(){return OM},iFs:function(){return qw},qTg:function(){return Ut},Wtl:function(){return Dp},DmK:function(){return Ku},Htt:function(){return sL},Hx7:function(){return to},imt:function(){return Om},US6:function(){return dS},vZs:function(){return ZM},TE$:function(){return $U},lmu:function(){return Do},SvO:function(){return Nm},YQY:function(){return T0},mZN:function(){return ax},VvG:function(){return hT},omp:function(){return oO},utz:function(){return cS},TFV:function(){return zv},hrz:function(){return un},JKM:function(){return EP},jZf:function(){return SR},RjL:function(){return dR},RRI:function(){return k3},RUq:function(){return aO},_t4:function(){return bv},YHh:function(){return o0},R8g:function(){return ir},Bbl:function(){return kS},V9r:function(){return jt},PZ2:function(){return Yt},w7A:function(){return _n},N6S:function(){return $n},Uxp:function(){return Er},tAz:function(){return nr},R$F:function(){return Kt},N33:function(){return Yn},gw2:function(){return WS},KlU:function(){return zn},rfc:function(){return Uw},wo6:function(){return vu},H4P:function(){return Qt},swA:function(){return R1},_Z3:function(){return wA},ivc:function(){return Hw},rZ1:function(){return AA},CpZ:function(){return F3},dyc:function(){return Zt},MxZ:function(){return GN},btp:function(){return HN},mXy:function(){return jP},Ej0:function(){return Av},ep4:function(){return am},DQP:function(){return iA},VNr:function(){return Ay},V7q:function(){return qu},zEk:function(){return tu},qfq:function(){return No},piB:function(){return er},IIc:function(){return qU},rrF:function(){return x0},naq:function(){return jv},sXR:function(){return Wy},p5I:function(){return fE},wps:function(){return J2},wuo:function(){return TR},GpE:function(){return $t},F4b:function(){return qy},t$v:function(){return im},tdn:function(){return GA},Y9t:function(){return LT},GEo:function(){return nE},DH3:function(){return _3},uxM:function(){return a3},zH3:function(){return l3},MLs:function(){return CA},xXG:function(){return Go},YM4:function(){return _x},B3r:function(){return CR},iAx:function(){return cM},lDn:function(){return jn},oaQ:function(){return tE},CD7:function(){return x_},Rc0:function(){return Qy},iPG:function(){return uE},TIc:function(){return Cv},xsC:function(){return b3},zOc:function(){return Yu},r46:function(){return T3},z2C:function(){return pn},_X$:function(){return b1},_yn:function(){return s_},Dyg:function(){return i_},cUc:function(){return a_},zGw:function(){return lE},Ctq:function(){return bP},$ch:function(){return eF},k5b:function(){return uS},kZl:function(){return o2},OCg:function(){return CP},YjH:function(){return O3},Ui8:function(){return LR},YD2:function(){return sE},vi9:function(){return rL},ij3:function(){return m3},YPW:function(){return p3},Bg1:function(){return QU},kon:function(){return Cn},M3g:function(){return PA},F2z:function(){return fv},pJF:function(){return sO},knz:function(){return b.knz},Ejo:function(){return bn},BgY:function(){return Ow},qCG:function(){return Fn},HD9:function(){return ao},fEB:function(){return Wl},Udc:function(){return yp},ZQg:function(){return yy},ofC:function(){return zr},yRy:function(){return Mv},_NL:function(){return WT},LCA:function(){return Ap},j1w:function(){return hm},i8J:function(){return aF},p7C:function(){return Ho},ZAS:function(){return WA},ipH:function(){return tF},$TF:function(){return aL},uZI:function(){return nF},VWG:function(){return pP},pQ7:function(){return Tx},STw:function(){return I0},jc8:function(){return c0},BL_:function(){return l1},S6:function(){return oF},T8U:function(){return N1},TD6:function(){return Ym},akS:function(){return mP},QKE:function(){return c3},dKx:function(){return En},OvX:function(){return nL},VsW:function(){return Vl},YMc:function(){return oL},aPg:function(){return Ao},LFn:function(){return Nw},wey:function(){return nm},MaE:function(){return uo},s4x:function(){return cm},FJA:function(){return eu},vIA:function(){return xv},Spv:function(){return Ys},w8l:function(){return s0},riG:function(){return qs},Kbh:function(){return r0},BFq:function(){return e_},t8K:function(){return ss},Q7n:function(){return ts},KGF:function(){return Up},e5:function(){return rn},Rik:function(){return Oy},GZo:function(){return VS},Bds:function(){return _m},HTu:function(){return xA},cTq:function(){return Yl},X_Y:function(){return MA},dA8:function(){return YS},bwS:function(){return xP},Lks:function(){return iF},Rvq:function(){return iL},P4F:function(){return IN},Pd0:function(){return Xl},Pjo:function(){return wP},Tum:function(){return lp},dRH:function(){return Kl},RX0:function(){return Fm},reQ:function(){return rF},cWm:function(){return w3},NC9:function(){return o3},$Re:function(){return U1},Xo9:function(){return jS},LNO:function(){return E0},iZP:function(){return S0}});var j,tt={};__webpackgi_require__.r(tt),__webpackgi_require__.d(tt,{AsyncCompress:function(){return Ar},AsyncDecompress:function(){return vr},AsyncDeflate:function(){return _r},AsyncGunzip:function(){return ys},AsyncGzip:function(){return Ar},AsyncInflate:function(){return Gr},AsyncUnzipInflate:function(){return lI},AsyncUnzlib:function(){return pr},AsyncZipDeflate:function(){return rI},AsyncZlib:function(){return tr},Compress:function(){return Fr},DecodeUTF8:function(){return xo},Decompress:function(){return Zn},Deflate:function(){return On},EncodeUTF8:function(){return Jp},Gunzip:function(){return Qs},Gzip:function(){return Fr},Inflate:function(){return Or},Unzip:function(){return WE},UnzipInflate:function(){return aI},UnzipPassThrough:function(){return P_},Unzlib:function(){return Wn},Zip:function(){return qC},ZipDeflate:function(){return iI},ZipPassThrough:function(){return vw},Zlib:function(){return yn},compress:function(){return Qr},compressSync:function(){return as},decompress:function(){return Pr},decompressSync:function(){return Jr},deflate:function(){return Tr},deflateSync:function(){return gr},gunzip:function(){return Hs},gunzipSync:function(){return Dn},gzip:function(){return Qr},gzipSync:function(){return as},inflate:function(){return cr},inflateSync:function(){return ur},strFromU8:function(){return bo},strToU8:function(){return Is},unzip:function(){return DD},unzipSync:function(){return qE},unzlib:function(){return Jt},unzlibSync:function(){return or},zip:function(){return sI},zipSync:function(){return oI},zlib:function(){return Hn},zlibSync:function(){return In}}),function(c){c[c.Error=-2]="Error",c[c.Destroyed=-1]="Destroyed",c[c.None=0]="None",c[c.Running=1]="Running",c[c.Paused=2]="Paused"}(j||(j={}));class ot{constructor(){this._eventListeners={},this.dispatchEvent=this.dispatchEvent.bind(this),this.addEventListener=this.addEventListener.bind(this),this.removeEventListener=this.removeEventListener.bind(this),this.hasEventListener=this.hasEventListener.bind(this)}addEventListener(e,i){const s=this._eventListeners;s[e]===void 0&&(s[e]=[]),s[e].includes(i)||s[e].push(i)}hasEventListener(e,i){const s=this._eventListeners;return s[e]!==void 0&&s[e].includes(i)}removeEventListener(e,i){const s=this._eventListeners[e];if(s!==void 0){const a=s.indexOf(i);a!==-1&&s.splice(a,1)}}dispatchEvent(e){const i=this._eventListeners[e.type];if(i!==void 0){e.target=this;const s=i.slice(0);for(let a=0,h=s.length;a<h;a++)s[a].call(this,e)}}}var b=__webpackgi_require__(988);const yt={uniforms:{tDiffuse:{value:null},opacity:{value:1}},vertexShader:`

		varying vec2 vUv;

		void main() {

			vUv = uv;
			gl_Position = projectionMatrix * modelViewMatrix * vec4( position, 1.0 );

		}`,fragmentShader:`

		uniform float opacity;

		uniform sampler2D tDiffuse;

		varying vec2 vUv;

		void main() {

			gl_FragColor = texture2D( tDiffuse, vUv );
			gl_FragColor.a *= opacity;


		}`};class Et{constructor(){this.enabled=!0,this.needsSwap=!0,this.clear=!1,this.renderToScreen=!1}setSize(){}render(){console.error("THREE.Pass: .render() must be implemented in derived pass.")}}const kt=new b.iKG(-1,1,1,-1,0,1),Gt=new b.u9r;Gt.setAttribute("position",new b.a$l([-1,3,0,-1,-1,0,3,-1,0],3)),Gt.setAttribute("uv",new b.a$l([0,2,0,0,2,0],2));class Vt{constructor(e){this._mesh=new b.Kj0(Gt,e)}dispose(){this._mesh.geometry.dispose()}render(e){e.render(this._mesh,kt)}get material(){return this._mesh.material}set material(e){this._mesh.material=e}}class an extends Et{constructor(e,i){super(),this.textureID=i!==void 0?i:"tDiffuse",e instanceof b.jyz?(this.uniforms=e.uniforms,this.material=e):e&&(this.uniforms=b.rDY.clone(e.uniforms),this.material=new b.jyz({defines:Object.assign({},e.defines),uniforms:this.uniforms,vertexShader:e.vertexShader,fragmentShader:e.fragmentShader})),this.fsQuad=new Vt(this.material),this.useExistingRenderTarget=!1}render(e,i,s){this.uniforms[this.textureID]&&(this.uniforms[this.textureID].value=s.texture),this.fsQuad.material=this.material,this.renderToScreen?(e.setRenderTarget(null),this.fsQuad.render(e)):(this.useExistingRenderTarget||e.setRenderTarget(i),this.clear&&e.clear(e.autoClearColor,e.autoClearDepth,e.autoClearStencil),this.fsQuad.render(e))}}class Pn extends Et{constructor(e,i){super(),this.scene=e,this.camera=i,this.clear=!0,this.needsSwap=!1,this.inverse=!1}render(e,i,s){const a=e.getContext(),h=e.state;let d,_;h.buffers.color.setMask(!1),h.buffers.depth.setMask(!1),h.buffers.color.setLocked(!0),h.buffers.depth.setLocked(!0),this.inverse?(d=0,_=1):(d=1,_=0),h.buffers.stencil.setTest(!0),h.buffers.stencil.setOp(a.REPLACE,a.REPLACE,a.REPLACE),h.buffers.stencil.setFunc(a.ALWAYS,d,4294967295),h.buffers.stencil.setClear(_),h.buffers.stencil.setLocked(!0),e.setRenderTarget(s),this.clear&&e.clear(),e.render(this.scene,this.camera),e.setRenderTarget(i),this.clear&&e.clear(),e.render(this.scene,this.camera),h.buffers.color.setLocked(!1),h.buffers.depth.setLocked(!1),h.buffers.stencil.setLocked(!1),h.buffers.stencil.setFunc(a.EQUAL,1,4294967295),h.buffers.stencil.setOp(a.KEEP,a.KEEP,a.KEEP),h.buffers.stencil.setLocked(!0)}}class gn extends Et{constructor(){super(),this.needsSwap=!1}render(e){e.state.buffers.stencil.setLocked(!1),e.state.buffers.stencil.setTest(!1)}}new b.iKG(-1,1,1,-1,0,1);const dn=new b.u9r;dn.setAttribute("position",new b.a$l([-1,3,0,-1,-1,0,3,-1,0],3)),dn.setAttribute("uv",new b.a$l([0,2,0,0,2,0],2));class wn extends class{constructor(e,i){if(this.renderer=e,i===void 0){const s=e.getSize(new b.FM8);this._pixelRatio=e.getPixelRatio(),this._width=s.width,this._height=s.height,(i=new b.dd2(this._width*this._pixelRatio,this._height*this._pixelRatio)).texture.name="EffectComposer.rt1"}else this._pixelRatio=1,this._width=i.width,this._height=i.height;this.renderTarget1=i,this.renderTarget2=i.clone(),this.renderTarget2.texture.name="EffectComposer.rt2",this.writeBuffer=this.renderTarget1,this.readBuffer=this.renderTarget2,this.renderToScreen=!0,this.passes=[],yt===void 0&&console.error("THREE.EffectComposer relies on CopyShader"),an===void 0&&console.error("THREE.EffectComposer relies on ShaderPass"),this.copyPass=new an(yt),this.clock=new b.SUY}swapBuffers(){const e=this.readBuffer;this.readBuffer=this.writeBuffer,this.writeBuffer=e}addPass(e){this.passes.push(e),e.setSize(this._width*this._pixelRatio,this._height*this._pixelRatio)}insertPass(e,i){this.passes.splice(i,0,e),e.setSize(this._width*this._pixelRatio,this._height*this._pixelRatio)}removePass(e){const i=this.passes.indexOf(e);i!==-1&&this.passes.splice(i,1)}isLastEnabledPass(e){for(let i=e+1;i<this.passes.length;i++)if(this.passes[i].enabled)return!1;return!0}render(e){e===void 0&&(e=this.clock.getDelta());const i=this.renderer.getRenderTarget();let s=!1;for(let a=0,h=this.passes.length;a<h;a++){const d=this.passes[a];if(d.enabled!==!1){if(d.renderToScreen=this.renderToScreen&&this.isLastEnabledPass(a),d.render(this.renderer,this.writeBuffer,this.readBuffer,e,s),d.needsSwap){if(s){const _=this.renderer.getContext(),et=this.renderer.state.buffers.stencil;et.setFunc(_.NOTEQUAL,1,4294967295),this.copyPass.render(this.renderer,this.writeBuffer,this.readBuffer,e),et.setFunc(_.EQUAL,1,4294967295)}this.swapBuffers()}Pn!==void 0&&(d instanceof Pn?s=!0:d instanceof gn&&(s=!1))}}this.renderer.setRenderTarget(i)}reset(e){if(e===void 0){const i=this.renderer.getSize(new b.FM8);this._pixelRatio=this.renderer.getPixelRatio(),this._width=i.width,this._height=i.height,(e=this.renderTarget1.clone()).setSize(this._width*this._pixelRatio,this._height*this._pixelRatio)}this.renderTarget1.dispose(),this.renderTarget2.dispose(),this.renderTarget1=e,this.renderTarget2=e.clone(),this.writeBuffer=this.renderTarget1,this.readBuffer=this.renderTarget2}setSize(e,i){this._width=e,this._height=i;const s=this._width*this._pixelRatio,a=this._height*this._pixelRatio;this.renderTarget1.setSize(s,a),this.renderTarget2.setSize(s,a);for(let h=0;h<this.passes.length;h++)this.passes[h].setSize(s,a)}setPixelRatio(e){this._pixelRatio=e,this.setSize(this._width,this._height)}}{constructor(e,i){super(e,i)}setPixelRatio(e,i=!0){const s=this.setSize;i||(this.setSize=()=>{}),super.setPixelRatio(e),i||(this.setSize=s)}}function _n(c,e){let i;do i=Object.getOwnPropertyDescriptor(c,e);while(!i&&(c=Object.getPrototypeOf(c)));return i}function $t(c,e,i=!1,s=!1){const a=_n(c,e);return!!(a!=null&&a.set)||i&&(a==null?void 0:a.writable)!==!1&&(a==null?void 0:a.get)===void 0||s&&!a}function bn(c,e,i,s=!1,a=!1){return!(!c||!$t(c,e,s,a)||(c[e]=i,0))}function Ut(c,e){for(;c.length>0;){if(!e)return;const i=c.splice(0,1)[0];if(!(i.length<1)){if(!(i in e))return console.error("invalid access, check",i,e),e;e=e[i]}}return e}function jt(c,e){return Object.keys(c).find(i=>c[i]===e)}function Yt(c,...e){return typeof c=="function"&&(c=c(...e)),c}function Bn(c,e,i){for(const s of i){const a=c[s];a!==void 0&&bn(e,s,a,!0)}}function un(c){return c.replace(/([.*+?^=!:${}()|[\]/\\])/g,"\\$1")}function Cn(c,e,i){return c.replace(new RegExp(un(e),"g"),i)}const Qt=(c,...e)=>String.raw({raw:c},...e),Wt=(c,...e)=>String.raw({raw:c},...e),Zt=(c,...e)=>String.raw({raw:c},...e),En=(c,...e)=>{let i=String.raw({raw:c},...e);return i=Cn(i,"%","%25"),i=Cn(i,"> <","><"),i=Cn(i,"; }",";}"),i=Cn(i,"<","%3c"),i=Cn(i,">","%3e"),i=Cn(i,'"',"'"),i=Cn(i,"#","%23"),i=Cn(i,"{","%7b"),i=Cn(i,"}","%7d"),i=Cn(i,"|","%7c"),i=Cn(i,"^","%5e"),i=Cn(i,"`","%60"),i=Cn(i,"@","%40"),i=Cn(i,"&","&amp;"),i=Cn(i,`
`,"%0A"),"data:image/svg+xml;charset=UTF-8,"+i};function pn(c){if(!c)throw new Error("onChange: fnKey is undefined, make sure the function exists or provide a string");return(e,i)=>{let s=e[i];Object.defineProperty(e,i,{get:()=>s,set(a){var h;if(s===a)return;s=a;const d=[i,a];if(typeof c=="string")(h=this[c])===null||h===void 0||h.call(this,...d);else if(typeof c=="function"){let _=!1;if(c.name){let et=this;for(;et;){if(et[c.name]===c){c.call(this,...d),_=!0;break}et=Object.getPrototypeOf(et)}}_||(c.name&&this[c.name].name===`bound ${c.name}`?this[c.name](...d):c(...d))}}})}}function er(c,e){for(const i of e)if(!c.includes(i))return!1;return!0}String.prototype.replaceAll||(String.prototype.replaceAll=function(c,e){return Object.prototype.toString.call(c).toLowerCase()==="[object regexp]"?this.replace(c,e):this.replace(new RegExp(c,"g"),e)});class Ir{constructor(e=0,i=0){Ir.prototype.isVector2=!0,this.x=e,this.y=i}get width(){return this.x}set width(e){this.x=e}get height(){return this.y}set height(e){this.y=e}set(e,i){return this.x=e,this.y=i,this}setScalar(e){return this.x=e,this.y=e,this}setX(e){return this.x=e,this}setY(e){return this.y=e,this}setComponent(e,i){switch(e){case 0:this.x=i;break;case 1:this.y=i;break;default:throw new Error("index is out of range: "+e)}return this}getComponent(e){switch(e){case 0:return this.x;case 1:return this.y;default:throw new Error("index is out of range: "+e)}}clone(){return new this.constructor(this.x,this.y)}copy(e){return this.x=e.x,this.y=e.y,this}add(e){return this.x+=e.x,this.y+=e.y,this}addScalar(e){return this.x+=e,this.y+=e,this}addVectors(e,i){return this.x=e.x+i.x,this.y=e.y+i.y,this}addScaledVector(e,i){return this.x+=e.x*i,this.y+=e.y*i,this}sub(e){return this.x-=e.x,this.y-=e.y,this}subScalar(e){return this.x-=e,this.y-=e,this}subVectors(e,i){return this.x=e.x-i.x,this.y=e.y-i.y,this}multiply(e){return this.x*=e.x,this.y*=e.y,this}multiplyScalar(e){return this.x*=e,this.y*=e,this}divide(e){return this.x/=e.x,this.y/=e.y,this}divideScalar(e){return this.multiplyScalar(1/e)}applyMatrix3(e){const i=this.x,s=this.y,a=e.elements;return this.x=a[0]*i+a[3]*s+a[6],this.y=a[1]*i+a[4]*s+a[7],this}min(e){return this.x=Math.min(this.x,e.x),this.y=Math.min(this.y,e.y),this}max(e){return this.x=Math.max(this.x,e.x),this.y=Math.max(this.y,e.y),this}clamp(e,i){return this.x=Math.max(e.x,Math.min(i.x,this.x)),this.y=Math.max(e.y,Math.min(i.y,this.y)),this}clampScalar(e,i){return this.x=Math.max(e,Math.min(i,this.x)),this.y=Math.max(e,Math.min(i,this.y)),this}clampLength(e,i){const s=this.length();return this.divideScalar(s||1).multiplyScalar(Math.max(e,Math.min(i,s)))}floor(){return this.x=Math.floor(this.x),this.y=Math.floor(this.y),this}ceil(){return this.x=Math.ceil(this.x),this.y=Math.ceil(this.y),this}round(){return this.x=Math.round(this.x),this.y=Math.round(this.y),this}roundToZero(){return this.x=this.x<0?Math.ceil(this.x):Math.floor(this.x),this.y=this.y<0?Math.ceil(this.y):Math.floor(this.y),this}negate(){return this.x=-this.x,this.y=-this.y,this}dot(e){return this.x*e.x+this.y*e.y}cross(e){return this.x*e.y-this.y*e.x}lengthSq(){return this.x*this.x+this.y*this.y}length(){return Math.sqrt(this.x*this.x+this.y*this.y)}manhattanLength(){return Math.abs(this.x)+Math.abs(this.y)}normalize(){return this.divideScalar(this.length()||1)}angle(){return Math.atan2(-this.y,-this.x)+Math.PI}distanceTo(e){return Math.sqrt(this.distanceToSquared(e))}distanceToSquared(e){const i=this.x-e.x,s=this.y-e.y;return i*i+s*s}manhattanDistanceTo(e){return Math.abs(this.x-e.x)+Math.abs(this.y-e.y)}setLength(e){return this.normalize().multiplyScalar(e)}lerp(e,i){return this.x+=(e.x-this.x)*i,this.y+=(e.y-this.y)*i,this}lerpVectors(e,i,s){return this.x=e.x+(i.x-e.x)*s,this.y=e.y+(i.y-e.y)*s,this}equals(e){return e.x===this.x&&e.y===this.y}fromArray(e,i=0){return this.x=e[i],this.y=e[i+1],this}toArray(e=[],i=0){return e[i]=this.x,e[i+1]=this.y,e}fromBufferAttribute(e,i){return this.x=e.getX(i),this.y=e.getY(i),this}rotateAround(e,i){const s=Math.cos(i),a=Math.sin(i),h=this.x-e.x,d=this.y-e.y;return this.x=h*s-d*a+e.x,this.y=h*a+d*s+e.y,this}random(){return this.x=Math.random(),this.y=Math.random(),this}*[Symbol.iterator](){yield this.x,yield this.y}}class Dr extends b.ZzF{expandByObject(e,i=!1,s=!1){var a;if(((a=e.userData)===null||a===void 0?void 0:a.bboxVisible)===!1)return this;if(!e.visible&&s)return this;e.updateWorldMatrix(!1,!1);const h=e.geometry;if(h!==void 0)if(i&&h.attributes!=null&&h.attributes.position!==void 0){const _=h.attributes.position;for(let et=0,nt=_.count;et<nt;et++)yr.fromBufferAttribute(_,et).applyMatrix4(e.matrixWorld),this.expandByPoint(yr)}else h.boundingBox===null&&h.computeBoundingBox(),Vr.copy(h.boundingBox),Vr.applyMatrix4(e.matrixWorld),this.union(Vr);const d=e.children;for(let _=0,et=d.length;_<et;_++)this.expandByObject(d[_],i,s);return this}expandByObjects(e,i=!1,s=!1){for(let a=0,h=e.length;a<h;a++)this.expandByObject(e[a],i,s);return this}getPoints(){return[new b.Pa4(this.min.x,this.min.y,this.min.z),new b.Pa4(this.min.x,this.min.y,this.max.z),new b.Pa4(this.min.x,this.max.y,this.min.z),new b.Pa4(this.min.x,this.max.y,this.max.z),new b.Pa4(this.max.x,this.min.y,this.min.z),new b.Pa4(this.max.x,this.min.y,this.max.z),new b.Pa4(this.max.x,this.max.y,this.min.z),new b.Pa4(this.max.x,this.max.y,this.max.z)]}getScreenSpaceBounds(e){const i=this.getPoints(),s=new b.TUj;for(const a of i){const h=a.project(e);s.min.min(h),s.max.max(h)}return s}}const Vr=new Dr,yr=new b.Pa4;function Hr(c,e){let i,s;if(Array.isArray(c))for(const h of c){const d=Hr(h,e);i===void 0||s===void 0?(i=d.min.clone(),s=d.max.clone()):(i.min(d.min),s.max(d.max))}const a=c;if(a.geometry!==void 0){const h=a.geometry.vertices;if(h===void 0&&a.geometry.attributes!==void 0&&"position"in a.geometry.attributes){const d=new b.Pa4,_=a.geometry.attributes.position;for(let et=0;et<_.count*_.itemSize;et+=_.itemSize){d.set(_.array[et],_.array[et+1],_.array[3]);const nt=d.applyMatrix4(c.matrixWorld).project(e),it=new Ir(nt.x,nt.y);i===void 0||s===void 0?(i=it.clone(),s=it.clone()):(i.min(it),s.max(it))}}else for(const d of h){const _=d.clone().applyMatrix4(c.matrixWorld).project(e),et=new Ir(_.x,_.y);i===void 0||s===void 0?(i=et.clone(),s=et.clone()):(i.min(et),s.max(et))}}if(c.children!==void 0)for(const h of c.children){const d=Hr(h,e);i===void 0||s===void 0?(i=d.min.clone(),s=d.max.clone()):(i.min(d.min),s.max(d.max))}return new b.TUj(i,s)}const Xn=3005;function ir(c){switch(c){case b.rnI:return["Linear","( value )"];case b.knz:return["sRGB","( value )"];case Xn:return["RGBM","( value, 16.0 )"];default:return console.warn("utils: Unsupported encoding:",c),["Linear","( value )"]}}function zn(c,e){let i;return c&&c.isTexture?i=c.encoding:c&&c.isWebGLRenderTarget?(console.warn("THREE.WebGLPrograms.getTextureEncodingFromMap: don't use render targets as textures. Use their .texture property instead."),i=c.texture.encoding):i=b.rnI,e&&c&&c.isTexture&&c.format===b.wk1&&c.type===b.ywz&&c.encoding===b.knz&&(i=b.rnI),i}function nr(c,e){const i=ir(e);return"vec4 "+c+"( vec4 value ) { return "+i[0]+"ToLinear"+i[1]+"; }"}function $n(c,e,i){return nr(c+"TexelToLinear",zn(e,i))+`
`}function Er(c,e){return nr(c+"TexelToLinear",e)+`
`}function Yn(c,e){const i=ir(e);return"vec4 "+c+"( vec4 value ) { return LinearTo"+i[0]+i[1]+"; }"}function Kt(c,e,i){return Yn(c,zn(e,i))}function rn({uniforms:c,propKey:e,thisTarget:i=!1}={}){const s=!!c,a=!!e,h=i;return(d,_)=>{const et=nt=>{const it=h?nt:s?c:nt.uniforms||nt._uniforms;let lt=a?e:_;h&&(lt="_"+lt);let ut=it[lt];return ut||(ut={value:null},it[lt]=ut),ut};Object.defineProperty(d,_,{get(){return et(this).value},set(nt){et(this).value=nt,bn(this,"uniformsNeedUpdate",!0,!0)}})}}function jn(c,e,i=!1,s){const a=!!e,h=!!c;return(d,_)=>{const et=nt=>({t:a?e:nt.defines||nt._defines,p:h?c:_});Object.defineProperty(d,_,{get(){const{t:nt,p:it}=et(i?this:this.material);return nt[it]},set(nt){const{t:it,p:lt}=et(i?this:this.material);if(bn(it,lt,nt,!0),typeof s=="function"){const ut=[lt,nt];if(s.name){const pt=this[s.name];pt===s?s.call(this,...ut):pt.name===`bound ${s.name}`?pt(...ut):s(...ut)}else s(...ut)}else bn(i?this:this.material,"needsUpdate",!0,!0)}})}}function Ur(c){const e=new b.IEO(new Uint8Array([Math.floor(255*c.r),Math.floor(255*c.g),Math.floor(255*c.b),255]),1,1,b.wk1,b.ywz);return e.needsUpdate=!0,e.encoding=b.rnI,e}function kr(c){const e=new b.IEO(new Uint8Array([Math.floor(255*c.x),Math.floor(255*c.y),Math.floor(255*c.z),Math.floor(255*c.w)]),1,1,b.wk1,b.ywz);return e.needsUpdate=!0,e}function zr(c,e,i){const s=c.userData,{backgroundRender:a,transparentRender:h,shadowMapRender:d,mainRenderPass:_,opaqueRender:et,transmissionRender:nt,sceneRender:it,screenSpaceRendering:lt}=s;e.backgroundRender!==void 0&&(s.backgroundRender=e.backgroundRender),e.transparentRender!==void 0&&(s.transparentRender=e.transparentRender),e.shadowMapRender!==void 0&&(s.shadowMapRender=e.shadowMapRender),e.mainRenderPass!==void 0&&(s.mainRenderPass=e.mainRenderPass),e.opaqueRender!==void 0&&(s.opaqueRender=e.opaqueRender),e.sceneRender!==void 0&&(s.sceneRender=e.sceneRender),e.transmissionRender!==void 0&&(s.transmissionRender=e.transmissionRender),e.screenSpaceRendering!==void 0&&(s.screenSpaceRendering=e.screenSpaceRendering),i(),s.backgroundRender=a,s.transparentRender=h,s.shadowMapRender=d,s.mainRenderPass=_,s.opaqueRender=et,s.sceneRender=it,s.transmissionRender=nt,s.screenSpaceRendering=lt}function Cs(c){const e=new Dr().expandByObject(c,!0,!0).getCenter(new b.Pa4);c.position.sub(e),c.updateMatrix(),c.userData.autoCentered=!0,c.userData.isCentered=!0}function Gs(c,e){const i=.5*new Dr().expandByObject(c,!0,!0).getSize(new b.Pa4).length();e===void 0&&(e=c.userData.autoScaleRadius||1);const s=e/i;return isFinite(s)&&(c.userData.pseudoCentered?c.children.forEach(a=>{a.scale.multiplyScalar(s)}):c.scale.multiplyScalar(s),c.userData.isCentered&&c.position.multiplyScalar(s),c.traverse(a=>{var h,d;a.isLight&&(!((d=(h=a.shadow)===null||h===void 0?void 0:h.camera)===null||d===void 0)&&d.right)&&(a.shadow.camera.right*=s,a.shadow.camera.left*=s,a.shadow.camera.top*=s,a.shadow.camera.bottom*=s),a.isCamera&&a.right&&(a.right*=s,a.left*=s,a.top*=s,a.bottom*=s)}),c.userData.autoScaled=!0,c.userData.autoScaleRadius=e,c.dispatchEvent({type:"objectUpdate"})),c}function Ao(c,e=-1){return function(i,s=1e-4){const a=s>0;s=Math.max(s,Number.EPSILON);const h={},d=i.getIndex(),_=i.getAttribute("position"),et=d?d.count:_.count;let nt=0;const it=Object.keys(i.attributes),lt={},ut={},pt=[],gt=["getX","getY","getZ","getW"];for(let xt=0,_t=it.length;xt<_t;xt++){const Pt=it[xt];lt[Pt]=[];const Bt=i.morphAttributes[Pt];Bt&&(ut[Pt]=new Array(Bt.length).fill().map(()=>[]))}const vt=Math.log10(1/s),Ct=Math.pow(10,vt);for(let xt=0;xt<et;xt++){const _t=d?d.getX(xt):xt;let Pt="";for(let Bt=0,Ot=it.length;Bt<Ot&&a;Bt++){const Lt=it[Bt],qt=i.getAttribute(Lt),en=qt.itemSize;for(let cn=0;cn<en;cn++)Pt+=~~(qt[gt[cn]](_t)*Ct)+","}if(a&&Pt in h)pt.push(h[Pt]);else{for(let Bt=0,Ot=it.length;Bt<Ot;Bt++){const Lt=it[Bt],qt=i.getAttribute(Lt),en=i.morphAttributes[Lt],cn=qt.itemSize,An=lt[Lt],mn=ut[Lt];for(let Tn=0;Tn<cn;Tn++){const vn=gt[Tn];if(An.push(qt[vn](_t)),en)for(let xn=0,Un=en.length;xn<Un;xn++)mn[xn].push(en[xn][vn](_t))}}a&&(h[Pt]=nt),pt.push(nt),nt++}}const wt=i.clone();for(let xt=0,_t=it.length;xt<_t;xt++){const Pt=it[xt],Bt=i.getAttribute(Pt),Ot=new Bt.array.constructor(lt[Pt]),Lt=new b.TlE(Ot,Bt.itemSize,Bt.normalized);if(wt.setAttribute(Pt,Lt),Pt in ut)for(let qt=0;qt<ut[Pt].length;qt++){const en=i.morphAttributes[Pt][qt],cn=new en.array.constructor(ut[Pt][qt]),An=new b.TlE(cn,en.itemSize,en.normalized);wt.morphAttributes[Pt][qt]=An}}return wt.setIndex(pt),wt}(c,e)}class Ks extends ot{constructor({animationLoop:e,canvas:i,alpha:s=!0,targetOptions:a}){super(),this._isWebGL2=!1,this._trackedTargets=[],this.dirty=!0,this._lastTime=0,this.frameWaitTime=0,this._passes=[],this._pipeline=[],this._passesNeedsUpdate=!0,this._displayCanvasScaling=1,this._renderSize=new b.FM8(512,512),this._frameCount=0,this._tempTargets={},this.maxTempPerKey=5,this._animationLoop=this._animationLoop.bind(this),this._processNewTarget=this._processNewTarget.bind(this),this._processNewTempTarget=this._processNewTempTarget.bind(this),this.trackTarget=this.trackTarget.bind(this),this.disposeTarget=this.disposeTarget.bind(this),this.createTarget=this.createTarget.bind(this),this.createTargetCustom=this.createTargetCustom.bind(this),this._renderer=new b.CP7({canvas:i,antialias:!0,alpha:s,premultipliedAlpha:!1,preserveDrawingBuffer:!0}),this._renderer.baseRenderer=this,this._renderer.setAnimationLoop(this._animationLoop),this._context=this._renderer.getContext(),this._isWebGL2=this._renderer.capabilities.isWebGL2,this._renderSize=new b.FM8(i.clientWidth,i.clientHeight),this._renderer.setSize(this._renderSize.width,this._renderSize.height,!1),this._renderer.setPixelRatio(this._displayCanvasScaling),this._renderer.toneMapping=b.uL9,this._renderer.toneMappingExposure=1,this._renderer.outputEncoding=b.rnI,this._renderer.shadowMap.enabled=!0,this._renderer.shadowMap.type=b._iA,this._renderer.shadowMap.autoUpdate=!1,this.resetShadows(),this._composerTarget=this.createTarget(a,!1),this._composerTarget.texture.name="EffectComposer.rt1",this._composer=new wn(this._renderer,this._composerTarget),e&&this.addEventListener("animationLoop",e)}get composer(){return this._composer}get passes(){return this._passes}get isWebGL2(){return this._isWebGL2}get composerTarget(){return this._composerTarget}get renderSize(){return this._renderSize}get displayCanvasScaling(){return this._displayCanvasScaling}set displayCanvasScaling(e){e!==this._displayCanvasScaling&&(this._displayCanvasScaling=e,this.setSize(void 0,void 0,!0))}get frameCount(){return this._frameCount}set pipeline(e){this._pipeline=e,this._passesNeedsUpdate=!0}get pipeline(){return this._pipeline}refreshPipeline(){var e,i,s;const a=this._passes,h=[],d={};for(const _ of a){if(_.enabled===!1)continue;const et={after:(e=_.after)!==null&&e!==void 0?e:[],before:(i=_.before)!==null&&i!==void 0?i:[],dependencies:new Set((s=_.required)!==null&&s!==void 0?s:[])};d[_.passId]=et}for(const[_,et]of Object.entries(d)){const nt=new Set([...et.after,...et.before]);et.dependencies.forEach(it=>nt.has(it)&&nt.delete(it)),nt.forEach(it=>{const lt=d[it];if(lt){if(lt.dependencies.has(_))throw console.error("cyclic",_,it),"Cyclic dependency";et.dependencies.add(it)}})}for(;;){let _=!1;const et=[...Object.entries(d)];for(const[nt,it]of et)if(!h.includes(nt)&&er(h,it.dependencies.values())){const lt=Math.max(-1,...it.after.map(pt=>h.indexOf(pt))),ut=Math.min(h.length,...it.before.map(pt=>{const gt=h.indexOf(pt);return gt<0?h.length:gt}));if(lt>=ut)throw console.error(it,a,h,lt,ut),"Not possible";h.splice(it.after.length>0?lt+1:ut,0,nt),_=!0,delete d[nt]}if(Object.keys(d).length<1)break;if(!_)throw console.error(et,d,h),"Not possible 2"}return this.pipeline=h,this.pipeline}get context(){return this._context}get rendererObject(){return this._renderer}_animationLoop(e,i){const s=e-this._lastTime;this._lastTime=e,this.frameWaitTime-=s,this.frameWaitTime>0||(this.frameWaitTime=0,this.dispatchEvent({type:"animationLoop",deltaTime:s,time:e,renderer:this,xrFrame:i}))}get clock(){return this._composer.clock}registerPass(e,i=!0){var s;if(i)for(const a of[...this._passes])e.passId===a.passId&&this.unregisterPass(a);this._passes.push(e),(s=e.onRegister)===null||s===void 0||s.call(e,this),this._passesNeedsUpdate=!0,this._updated()}unregisterPass(e){var i;const s=this._passes.indexOf(e);s>=0&&((i=e.onUnregister)===null||i===void 0||i.call(e,this),this._passes.splice(s,1),this._passesNeedsUpdate=!0,this._updated())}setSize(e,i,s=!1){!s&&(e?Math.abs(e-this._renderSize.width):0)+(i?Math.abs(i-this._renderSize.height):0)<.1||(e&&(this._renderSize.width=e),i&&(this._renderSize.height=i),this.rendererObject.xr.enabled||(this._renderer.setSize(this._renderSize.width,this._renderSize.height,!1),this._renderer.setPixelRatio(this._displayCanvasScaling)),this._composer.setPixelRatio(this._displayCanvasScaling,!1),this._composer.setSize(this._renderSize.width,this._renderSize.height),this._trackedTargets.forEach(a=>{const h=a,d=h.sizeMultiplier;if(d){const _=this._renderSize.clone().multiplyScalar(this._displayCanvasScaling*d);h.setSize(_.width,_.height)}}),this.dispatchEvent({type:"resize"}),this._updated(),this.reset())}blit(e,i,{viewport:s,material:a,shader:h,pass:d,clear:_=!0}={}){const et=this._composer.copyPass,{renderToScreen:nt,material:it,uniforms:lt,clear:ut}=et;a&&(et.material=a);const pt=this._renderer.getViewport(new b.Ltg),gt=this._renderer.autoClear,vt=this._renderer.getRenderTarget();s&&this._renderer.setViewport(new b.Ltg().fromArray(s)),this._renderer.autoClear=!1,et.uniforms=et.material.uniforms,et.renderToScreen=!1,et.clear=_,zr(this._renderer,{sceneRender:!0,opaqueRender:!0,shadowMapRender:!1,backgroundRender:!1,transparentRender:!0,transmissionRender:!1},()=>{et.render(this._renderer,i??null,{texture:e},0,!1)}),et.renderToScreen=nt,et.clear=ut,et.material=it,et.uniforms=lt,this._renderer.autoClear=gt,s&&this._renderer.setViewport(pt),this._renderer.setRenderTarget(vt)}clearColor({r:e,g:i,b:s,a,target:h,depth:d=!0,stencil:_=!0}){var et;const nt=this._renderer.getClearColor(new b.Ilk),it=this._renderer.getClearAlpha();this._renderer.setClearAlpha(a??it),this._renderer.setClearColor(new b.Ilk(e??nt.r,i??nt.g,s??nt.b));const lt=this._renderer.getRenderTarget(),ut=this._renderer.getActiveCubeFace(),pt=this._renderer.getActiveMipmapLevel();this._renderer.setRenderTarget((et=h)!==null&&et!==void 0?et:null),this._renderer.clear(!0,d,_),this._renderer.setRenderTarget(lt,ut,pt),this._renderer.setClearColor(nt),this._renderer.setClearAlpha(it)}renderModel(e,i){this._renderer.render(e.modelObject,i.cameraObject)}renderScene(e){const i=e.activeCamera;i&&this.renderModel(e,i)}_updated(){this.dispatchEvent({type:"update"})}render(){var e;this._passesNeedsUpdate&&this.refreshPasses();for(const i of this._passes)i.passObject.enabled&&((e=i.update)===null||e===void 0||e.call(i));this._composer.render(),this._frameCount+=1,this.dirty=!1}updateDirty(){this.dirty=this.dirty||this._passes.findIndex(e=>e.dirty)>=0}reset(){this._frameCount=0,this.dirty=!0}resetShadows(){this._renderer.shadowMap.needsUpdate=!0}refreshPasses(){if(!this._passesNeedsUpdate)return;this._passesNeedsUpdate=!1;const e=[];for(const i of this._pipeline){const s=this._passes.find(a=>a.passId===i);s?e.push(s.passObject):console.warn("Unable to find pass: ",i)}[...this._composer.passes].forEach(i=>this._composer.removePass(i)),e.forEach(i=>this._composer.addPass(i)),this._updated()}dispose(){this._renderer.dispose()}trackTarget(e){this._trackedTargets.push(e)}removeTrackedTarget(e){const i=this._trackedTargets.indexOf(e);i>=0&&this._trackedTargets.splice(i,1)}createTarget({sizeMultiplier:e,samples:i=0,encoding:s=b.rnI,type:a=b.ywz,format:h=b.wk1,depthBuffer:d=!0,depthTexture:_=!1,size:et,textureCount:nt=1,...it}={},lt=!0){this.isWebGL2||(i=0),e!==void 0&&et!==void 0&&console.error("Both sizeMultiplier and size are defined. sizeMultiplier will be ignored."),et=et||this._renderSize.clone().multiplyScalar(this._displayCanvasScaling*(e=e||1));const ut=_?new b.$YQ(et.width,et.height,b.ywz):void 0,pt=this.createTargetCustom(nt>1?{width:et.width,height:et.height,count:nt}:et,{samples:i,encoding:s,type:a,format:h,depthBuffer:d,depthTexture:ut},nt>1?b.kFz:b.dd2);return this._processNewTarget(pt,e,lt),this._setTargetOptions(pt,it),pt}_processNewTarget(e,i,s){return i!==void 0&&(e.sizeMultiplier=i),s&&this.trackTarget(e),e}disposeTarget(e){if(e){if(e.isTemporary)return this.releaseTempTarget(e);this.removeTrackedTarget(e),e.dispose()}}createTargetCustom({width:e,height:i,count:s},a={},h){var d;const _=this._processNewTarget;let et=[e,i];if(s&&s>1&&et.push(s),(h==null?void 0:h.prototype)===b.oAp.prototype){if(e!==i)throw"Width and height of cube render target must be equal";et=[e]}a={format:b.wk1,minFilter:b.wem,magFilter:b.wem,generateMipmaps:!1,type:b.ywz,encoding:b.rnI,...a};const nt=[...et,a];return new class extends((d=h)!==null&&d!==void 0?d:b.dd2){constructor(...it){super(...it),Array.isArray(this.texture)?this.texture.forEach(lt=>{lt.encoding=a.encoding,lt.toJSON=()=>({})}):this.texture.toJSON=()=>({})}clone(it=!0){if(this.isTemporary)throw"Cloning temporary render targets not supported";if(Array.isArray(this.texture))throw"Cloning multiple render targets not supported";const lt=super.clone();return lt.texture.isRenderTargetTexture=!0,_(lt,this.sizeMultiplier||1,it)}}(...nt)}getTempTarget(e={}){var i;const s=Oo(e);let a;return!((i=this._tempTargets[s])===null||i===void 0)&&i.length&&(a=this._tempTargets[s].pop()),a?this._setTargetOptions(a,e):(a=this.createTarget(e),this._processNewTempTarget(a,s)),a}_processNewTempTarget(e,i){return e.isTemporary=!0,e.targetKey=i,this._tempTargets[i]===void 0&&(this._tempTargets[i]=[]),e}releaseTempTarget(e){const i=e.targetKey;if(!i||!e.isTemporary)throw"Not a temp target";this._tempTargets[i].length>this.maxTempPerKey?e.dispose():this._tempTargets[i].push(e)}updateShaderProperties(e){return e.uniforms.frameCount?e.uniforms.frameCount.value=this.frameCount:console.warn("BaseRenderer: no uniform: frameCount"),this}_setTargetOptions(e,i){var s,a,h;e.texture.minFilter=(s=i.minFilter)!==null&&s!==void 0?s:b.wem,e.texture.magFilter=(a=i.magFilter)!==null&&a!==void 0?a:b.wem,e.texture.generateMipmaps=(h=i.generateMipmaps)!==null&&h!==void 0&&h,e.texture.generateMipmaps&&e.texture.minFilter===b.wem&&(e.texture.minFilter=b.FDw),e.texture.generateMipmaps||e.texture.minFilter!==b.FDw||(e.texture.minFilter=b.wem)}}function Oo(c={}){var e,i;return[c.sizeMultiplier,c.samples,c.encoding,c.type,c.format,c.depthBuffer,c.depthTexture,(e=c.size)===null||e===void 0?void 0:e.width,(i=c.size)===null||i===void 0?void 0:i.height].join(";")}const Js=["00","01","02","03","04","05","06","07","08","09","0a","0b","0c","0d","0e","0f","10","11","12","13","14","15","16","17","18","19","1a","1b","1c","1d","1e","1f","20","21","22","23","24","25","26","27","28","29","2a","2b","2c","2d","2e","2f","30","31","32","33","34","35","36","37","38","39","3a","3b","3c","3d","3e","3f","40","41","42","43","44","45","46","47","48","49","4a","4b","4c","4d","4e","4f","50","51","52","53","54","55","56","57","58","59","5a","5b","5c","5d","5e","5f","60","61","62","63","64","65","66","67","68","69","6a","6b","6c","6d","6e","6f","70","71","72","73","74","75","76","77","78","79","7a","7b","7c","7d","7e","7f","80","81","82","83","84","85","86","87","88","89","8a","8b","8c","8d","8e","8f","90","91","92","93","94","95","96","97","98","99","9a","9b","9c","9d","9e","9f","a0","a1","a2","a3","a4","a5","a6","a7","a8","a9","aa","ab","ac","ad","ae","af","b0","b1","b2","b3","b4","b5","b6","b7","b8","b9","ba","bb","bc","bd","be","bf","c0","c1","c2","c3","c4","c5","c6","c7","c8","c9","ca","cb","cc","cd","ce","cf","d0","d1","d2","d3","d4","d5","d6","d7","d8","d9","da","db","dc","dd","de","df","e0","e1","e2","e3","e4","e5","e6","e7","e8","e9","ea","eb","ec","ed","ee","ef","f0","f1","f2","f3","f4","f5","f6","f7","f8","f9","fa","fb","fc","fd","fe","ff"];function Qo(){const c=4294967295*Math.random()|0,e=4294967295*Math.random()|0,i=4294967295*Math.random()|0,s=4294967295*Math.random()|0;return(Js[255&c]+Js[c>>8&255]+Js[c>>16&255]+Js[c>>24&255]+"-"+Js[255&e]+Js[e>>8&255]+"-"+Js[e>>16&15|64]+Js[e>>24&255]+"-"+Js[63&i|128]+Js[i>>8&255]+"-"+Js[i>>16&255]+Js[i>>24&255]+Js[255&s]+Js[s>>8&255]+Js[s>>16&255]+Js[s>>24&255]).toLowerCase()}function yo(c,e,i){return Math.max(e,Math.min(i,c))}function Vu(c,e,i){return(1-i)*c+i*e}const fu=0,$a=1,ko=3,Hl=4,Io=1006,Qu="srgb",Mu="srgb-linear";function Lo(c){return c<.04045?.0773993808*c:Math.pow(.9478672986*c+.0521327014,2.4)}function Lp(c){return c<.0031308?12.92*c:1.055*Math.pow(c,.41666)-.055}const na={[Qu]:{[Mu]:Lo},[Mu]:{[Qu]:Lp}},mu={legacyMode:!0,get workingColorSpace(){return Mu},set workingColorSpace(c){console.warn("THREE.ColorManagement: .workingColorSpace is readonly.")},convert:function(c,e,i){if(this.legacyMode||e===i||!e||!i)return c;if(na[e]&&na[e][i]!==void 0){const s=na[e][i];return c.r=s(c.r),c.g=s(c.g),c.b=s(c.b),c}throw new Error("Unsupported color space conversion.")},fromWorkingColorSpace:function(c,e){return this.convert(c,this.workingColorSpace,e)},toWorkingColorSpace:function(c,e){return this.convert(c,e,this.workingColorSpace)}},y1={aliceblue:15792383,antiquewhite:16444375,aqua:65535,aquamarine:8388564,azure:15794175,beige:16119260,bisque:16770244,black:0,blanchedalmond:16772045,blue:255,blueviolet:9055202,brown:10824234,burlywood:14596231,cadetblue:6266528,chartreuse:8388352,chocolate:13789470,coral:16744272,cornflowerblue:6591981,cornsilk:16775388,crimson:14423100,cyan:65535,darkblue:139,darkcyan:35723,darkgoldenrod:12092939,darkgray:11119017,darkgreen:25600,darkgrey:11119017,darkkhaki:12433259,darkmagenta:9109643,darkolivegreen:5597999,darkorange:16747520,darkorchid:10040012,darkred:9109504,darksalmon:15308410,darkseagreen:9419919,darkslateblue:4734347,darkslategray:3100495,darkslategrey:3100495,darkturquoise:52945,darkviolet:9699539,deeppink:16716947,deepskyblue:49151,dimgray:6908265,dimgrey:6908265,dodgerblue:2003199,firebrick:11674146,floralwhite:16775920,forestgreen:2263842,fuchsia:16711935,gainsboro:14474460,ghostwhite:16316671,gold:16766720,goldenrod:14329120,gray:8421504,green:32768,greenyellow:11403055,grey:8421504,honeydew:15794160,hotpink:16738740,indianred:13458524,indigo:4915330,ivory:16777200,khaki:15787660,lavender:15132410,lavenderblush:16773365,lawngreen:8190976,lemonchiffon:16775885,lightblue:11393254,lightcoral:15761536,lightcyan:14745599,lightgoldenrodyellow:16448210,lightgray:13882323,lightgreen:9498256,lightgrey:13882323,lightpink:16758465,lightsalmon:16752762,lightseagreen:2142890,lightskyblue:8900346,lightslategray:7833753,lightslategrey:7833753,lightsteelblue:11584734,lightyellow:16777184,lime:65280,limegreen:3329330,linen:16445670,magenta:16711935,maroon:8388608,mediumaquamarine:6737322,mediumblue:205,mediumorchid:12211667,mediumpurple:9662683,mediumseagreen:3978097,mediumslateblue:8087790,mediumspringgreen:64154,mediumturquoise:4772300,mediumvioletred:13047173,midnightblue:1644912,mintcream:16121850,mistyrose:16770273,moccasin:16770229,navajowhite:16768685,navy:128,oldlace:16643558,olive:8421376,olivedrab:7048739,orange:16753920,orangered:16729344,orchid:14315734,palegoldenrod:15657130,palegreen:10025880,paleturquoise:11529966,palevioletred:14381203,papayawhip:16773077,peachpuff:16767673,peru:13468991,pink:16761035,plum:14524637,powderblue:11591910,purple:8388736,rebeccapurple:6697881,red:16711680,rosybrown:12357519,royalblue:4286945,saddlebrown:9127187,salmon:16416882,sandybrown:16032864,seagreen:3050327,seashell:16774638,sienna:10506797,silver:12632256,skyblue:8900331,slateblue:6970061,slategray:7372944,slategrey:7372944,snow:16775930,springgreen:65407,steelblue:4620980,tan:13808780,teal:32896,thistle:14204888,tomato:16737095,turquoise:4251856,violet:15631086,wheat:16113331,white:16777215,whitesmoke:16119285,yellow:16776960,yellowgreen:10145074},ga={r:0,g:0,b:0},Np={h:0,s:0,l:0},xa={h:0,s:0,l:0};function km(c,e,i){return i<0&&(i+=1),i>1&&(i-=1),i<1/6?c+6*(e-c)*i:i<.5?e:i<2/3?c+6*(e-c)*(2/3-i):c}function nA(c,e){return e.r=c.r,e.g=c.g,e.b=c.b,e}class mo{constructor(e,i,s){return this.isColor=!0,this.r=1,this.g=1,this.b=1,i===void 0&&s===void 0?this.set(e):this.setRGB(e,i,s)}set(e){return e&&e.isColor?this.copy(e):typeof e=="number"?this.setHex(e):typeof e=="string"&&this.setStyle(e),this}setScalar(e){return this.r=e,this.g=e,this.b=e,this}setHex(e,i="srgb"){return e=Math.floor(e),this.r=(e>>16&255)/255,this.g=(e>>8&255)/255,this.b=(255&e)/255,mu.toWorkingColorSpace(this,i),this}setRGB(e,i,s,a="srgb-linear"){return this.r=e,this.g=i,this.b=s,mu.toWorkingColorSpace(this,a),this}setHSL(e,i,s,a="srgb-linear"){if(e=function(h,d){return(h%d+d)%d}(e,1),i=yo(i,0,1),s=yo(s,0,1),i===0)this.r=this.g=this.b=s;else{const h=s<=.5?s*(1+i):s+i-s*i,d=2*s-h;this.r=km(d,h,e+1/3),this.g=km(d,h,e),this.b=km(d,h,e-1/3)}return mu.toWorkingColorSpace(this,a),this}setStyle(e,i="srgb"){function s(h){h!==void 0&&parseFloat(h)<1&&console.warn("THREE.Color: Alpha component of "+e+" will be ignored.")}let a;if(a=/^((?:rgb|hsl)a?)\(([^\)]*)\)/.exec(e)){let h;const d=a[1],_=a[2];switch(d){case"rgb":case"rgba":if(h=/^\s*(\d+)\s*,\s*(\d+)\s*,\s*(\d+)\s*(?:,\s*(\d*\.?\d+)\s*)?$/.exec(_))return this.r=Math.min(255,parseInt(h[1],10))/255,this.g=Math.min(255,parseInt(h[2],10))/255,this.b=Math.min(255,parseInt(h[3],10))/255,mu.toWorkingColorSpace(this,i),s(h[4]),this;if(h=/^\s*(\d+)\%\s*,\s*(\d+)\%\s*,\s*(\d+)\%\s*(?:,\s*(\d*\.?\d+)\s*)?$/.exec(_))return this.r=Math.min(100,parseInt(h[1],10))/100,this.g=Math.min(100,parseInt(h[2],10))/100,this.b=Math.min(100,parseInt(h[3],10))/100,mu.toWorkingColorSpace(this,i),s(h[4]),this;break;case"hsl":case"hsla":if(h=/^\s*(\d*\.?\d+)\s*,\s*(\d*\.?\d+)\%\s*,\s*(\d*\.?\d+)\%\s*(?:,\s*(\d*\.?\d+)\s*)?$/.exec(_)){const et=parseFloat(h[1])/360,nt=parseFloat(h[2])/100,it=parseFloat(h[3])/100;return s(h[4]),this.setHSL(et,nt,it,i)}}}else if(a=/^\#([A-Fa-f\d]+)$/.exec(e)){const h=a[1],d=h.length;if(d===3)return this.r=parseInt(h.charAt(0)+h.charAt(0),16)/255,this.g=parseInt(h.charAt(1)+h.charAt(1),16)/255,this.b=parseInt(h.charAt(2)+h.charAt(2),16)/255,mu.toWorkingColorSpace(this,i),this;if(d===6)return this.r=parseInt(h.charAt(0)+h.charAt(1),16)/255,this.g=parseInt(h.charAt(2)+h.charAt(3),16)/255,this.b=parseInt(h.charAt(4)+h.charAt(5),16)/255,mu.toWorkingColorSpace(this,i),this}return e&&e.length>0?this.setColorName(e,i):this}setColorName(e,i="srgb"){const s=y1[e.toLowerCase()];return s!==void 0?this.setHex(s,i):console.warn("THREE.Color: Unknown color "+e),this}clone(){return new this.constructor(this.r,this.g,this.b)}copy(e){return this.r=e.r,this.g=e.g,this.b=e.b,this}copySRGBToLinear(e){return this.r=Lo(e.r),this.g=Lo(e.g),this.b=Lo(e.b),this}copyLinearToSRGB(e){return this.r=Lp(e.r),this.g=Lp(e.g),this.b=Lp(e.b),this}convertSRGBToLinear(){return this.copySRGBToLinear(this),this}convertLinearToSRGB(){return this.copyLinearToSRGB(this),this}getHex(e="srgb"){return mu.fromWorkingColorSpace(nA(this,ga),e),yo(255*ga.r,0,255)<<16^yo(255*ga.g,0,255)<<8^yo(255*ga.b,0,255)<<0}getHexString(e="srgb"){return("000000"+this.getHex(e).toString(16)).slice(-6)}getHSL(e,i="srgb-linear"){mu.fromWorkingColorSpace(nA(this,ga),i);const s=ga.r,a=ga.g,h=ga.b,d=Math.max(s,a,h),_=Math.min(s,a,h);let et,nt;const it=(_+d)/2;if(_===d)et=0,nt=0;else{const lt=d-_;switch(nt=it<=.5?lt/(d+_):lt/(2-d-_),d){case s:et=(a-h)/lt+(a<h?6:0);break;case a:et=(h-s)/lt+2;break;case h:et=(s-a)/lt+4}et/=6}return e.h=et,e.s=nt,e.l=it,e}getRGB(e,i="srgb-linear"){return mu.fromWorkingColorSpace(nA(this,ga),i),e.r=ga.r,e.g=ga.g,e.b=ga.b,e}getStyle(e="srgb"){return mu.fromWorkingColorSpace(nA(this,ga),e),e!==Qu?`color(${e} ${ga.r} ${ga.g} ${ga.b})`:`rgb(${255*ga.r|0},${255*ga.g|0},${255*ga.b|0})`}offsetHSL(e,i,s){return this.getHSL(Np),Np.h+=e,Np.s+=i,Np.l+=s,this.setHSL(Np.h,Np.s,Np.l),this}add(e){return this.r+=e.r,this.g+=e.g,this.b+=e.b,this}addColors(e,i){return this.r=e.r+i.r,this.g=e.g+i.g,this.b=e.b+i.b,this}addScalar(e){return this.r+=e,this.g+=e,this.b+=e,this}sub(e){return this.r=Math.max(0,this.r-e.r),this.g=Math.max(0,this.g-e.g),this.b=Math.max(0,this.b-e.b),this}multiply(e){return this.r*=e.r,this.g*=e.g,this.b*=e.b,this}multiplyScalar(e){return this.r*=e,this.g*=e,this.b*=e,this}lerp(e,i){return this.r+=(e.r-this.r)*i,this.g+=(e.g-this.g)*i,this.b+=(e.b-this.b)*i,this}lerpColors(e,i,s){return this.r=e.r+(i.r-e.r)*s,this.g=e.g+(i.g-e.g)*s,this.b=e.b+(i.b-e.b)*s,this}lerpHSL(e,i){this.getHSL(Np),e.getHSL(xa);const s=Vu(Np.h,xa.h,i),a=Vu(Np.s,xa.s,i),h=Vu(Np.l,xa.l,i);return this.setHSL(s,a,h),this}equals(e){return e.r===this.r&&e.g===this.g&&e.b===this.b}fromArray(e,i=0){return this.r=e[i],this.g=e[i+1],this.b=e[i+2],this}toArray(e=[],i=0){return e[i]=this.r,e[i+1]=this.g,e[i+2]=this.b,e}fromBufferAttribute(e,i){return this.r=e.getX(i),this.g=e.getY(i),this.b=e.getZ(i),this}toJSON(){return this.getHex()}*[Symbol.iterator](){yield this.r,yield this.g,yield this.b}}function Go(c,e){const i=e==="map";return{type:"folder",label:e+" Sampler",hidden:()=>!c[e],children:[()=>({type:"vec2",label:"Repeat",hidden:()=>!i&&c.map,bounds:[-100,100],stepSize:.001,property:[c[e],"repeat"],onChange:c==null?void 0:c.setDirty}),()=>({type:"vec2",label:"Offset",hidden:()=>!i&&c.map,bounds:[-2,2],property:[c[e],"offset"],onChange:c==null?void 0:c.setDirty}),()=>({type:"vec2",label:"Center",hidden:()=>!i&&c.map,bounds:[-2,2],property:[c[e],"center"],onChange:c==null?void 0:c.setDirty}),()=>({type:"input",label:"Rotation",hidden:()=>!i&&c.map,bounds:[-Math.PI,Math.PI],property:[c[e],"rotation"],onChange:c==null?void 0:c.setDirty}),()=>({type:"dropdown",label:"Encoding",property:[c[e],"encoding"],children:[["Linear",b.rnI],["sRGB",b.knz]].map(s=>({label:s[0],value:s[1]})),onChange:[()=>{const s=c[e];s&&(s.needsUpdate=!0)},c==null?void 0:c.setDirty]}),()=>({type:"checkbox",label:"Flip Y",getValue:()=>{var s,a;return(a=(s=c[e])===null||s===void 0?void 0:s.flipY)!==null&&a!==void 0&&a},setValue:s=>{var a;const h=c[e];if(h&&h.flipY!==s)if(h.image&&ImageBitmap&&h.image instanceof ImageBitmap){const d=h,_=h.source.data;createImageBitmap(_,{imageOrientation:"flipY"}).then(et=>{var nt;_.close&&_.close(),d.flipY=s,d.source.data=et,d.source.needsUpdate=!0,d.needsUpdate=!0,(nt=c==null?void 0:c.setDirty)===null||nt===void 0||nt.call(c)})}else h.flipY=s,h.needsUpdate=!0,(a=c==null?void 0:c.setDirty)===null||a===void 0||a.call(c)}}),()=>({type:"dropdown",label:"Wrap S",property:[c[e],"wrapS"],children:[["ClampToEdge",b.uWy],["MirroredRepeat",b.OoA],["Repeat",b.rpg]].map(s=>({label:s[0],value:s[1]})),onChange:[()=>{c[e]&&(c[e].needsUpdate=!0)},c==null?void 0:c.setDirty]}),()=>({type:"dropdown",label:"Wrap T",property:[c[e],"wrapT"],children:[["ClampToEdge",b.uWy],["MirroredRepeat",b.OoA],["Repeat",b.rpg]].map(s=>({label:s[0],value:s[1]})),onChange:[()=>{c[e]&&(c[e].needsUpdate=!0)},c==null?void 0:c.setDirty]}),()=>({type:"input",label:"Anisotropy",bounds:[1,6],stepSize:1,property:[c[e],"anisotropy"],onChange:[()=>{c[e]&&(c[e].needsUpdate=!0),c.needsUpdate=!0},c==null?void 0:c.setDirty]}),()=>({type:"dropdown",label:"Min Filter",property:[c[e],"minFilter"],children:[["Linear",Io],["Nearest",b.TyD],["NearestMipmapNearest",b.YLQ],["NearestMipmapLinear",b.vZf],["LinearMipmapNearest",b.qyh],["LinearMipmapLinear",b.D1R]].map(s=>({label:s[0],value:s[1]})),onChange:[()=>{c[e]&&(c[e].needsUpdate=!0)},c==null?void 0:c.setDirty]}),()=>({type:"dropdown",label:"Mag Filter",property:[c[e],"magFilter"],children:[["Linear",Io],["Nearest",b.TyD]].map(s=>({label:s[0],value:s[1]})),onChange:[()=>{c[e]&&(c[e].needsUpdate=!0)},c==null?void 0:c.setDirty]})]}}mo.NAMES=y1;const am=["appliedMeshes","imageLoadAwaiter","inverseModelMatrix","uvTransform","uuid","iMaterial"];function Gu(c,e){if(e)for(const i of Object.keys(e))am.includes(i)||i.startsWith("__")||typeof c[i]!="function"&&typeof e[i]!="function"&&(c[i]=e[i]);return c}const Ay=["appliedMaterials","uuid"];function J0(c,e){if(e)for(const i of Object.keys(e))Ay.includes(i)||i.startsWith("__")||typeof c[i]!="function"&&typeof e[i]!="function"&&(c[i]=e[i]);return c}const Z0=new Map;function Fn(c){return(e,i)=>{const s=e.constructor;if(s===Object)throw new Error("All properties in an object are serialized by default");Z0.has(s)||Z0.set(s,[]),Z0.get(s).push([c||i,i])}}const Wl={obj:(c,e)=>Object.fromEntries(Object.entries(c).map(([i,s])=>[i,ao(s,!1,e)])),vec4:c=>({x:c.x,y:c.y,z:c.z,w:c.w,isVector4:!0}),vec3:c=>({x:c.x,y:c.y,z:c.z,isVector3:!0}),vec2:c=>({x:c.x,y:c.y,isVector2:!0}),color:c=>({r:c.r,g:c.g,b:c.b,isColor:!0}),quat:c=>({x:c.x,y:c.y,z:c.z,w:c.w,isQuaternion:!0}),texture:(c,e)=>{if(!(c!=null&&c.isTexture))throw new Error("Expected a texture");if(c.isRenderTargetTexture)return;if(e!=null&&e.textures[c.uuid])return{uuid:c.uuid,resource:"textures"};const i=c.source.data;c.userData.rootPath&&(c.source.data=null);const s=c.userData;c.userData={};let a=c.toJSON(e);return c.userData=s,a.userData=ao(J0({},s),!1,e),c.userData.rootPath&&(delete e.images[c.source.uuid],c.source.data=i),e!=null&&e.textures&&(e.textures[a.uuid]||(e.textures[a.uuid]=a),a={uuid:a.uuid,resource:"textures"}),a},material:(c,e)=>{var i;if(!(c!=null&&c.isMaterial))throw new Error("Expected a material");if(e!=null&&e.materials[c.uuid])return{uuid:c.uuid,resource:"materials"};c.userData.rootPath&&console.error("TODO: handle material with root path with material inheritance/hierarchy");const s=e??{textures:{},images:{}},a={},h={};for(const[_,et]of Object.entries(c))if(!((i=et)===null||i===void 0)&&i.isTexture&&!_.startsWith("__")){const nt=Wl.texture(et,s);a[_]=nt,h[_]=et,c[_]=nt?{isTexture:!0,toJSON:()=>nt}:null}let d=c.toJSON(e);for(const[_,et]of Object.entries(h))c[_]=et,delete h[_];if(e){for(const[_,et]of Object.entries(a))et&&(d[_]=et);e!=null&&e.materials&&(e.materials[d.uuid]||(e.materials[d.uuid]=d),d={uuid:d.uuid,resource:"materials"})}else{for(const[_,et]of Object.entries(a))d[_]=et.uuid;d.textures=Object.values(s.textures),d.images=Object.values(s.images)}return d}},lm=c=>(e,i)=>{var s,a;return(a=(s=i==null?void 0:i.copy)===null||s===void 0?void 0:s.call(i,e))!==null&&a!==void 0?a:new c().copy(e)},Om={obj:(c,e,i)=>Object.assign(e,Object.fromEntries(Object.entries(c).map(([s,a])=>[s,to(a,e==null?void 0:e[s],!1,i)]))),vec4:lm(b.Ltg),vec3:lm(b.Pa4),vec2:lm(Ir),color:lm(mo),quat:lm(b._fP)};function ao(c,e,i){var s,a;if(typeof c=="function")return;if(Array.isArray(c))return c.map(_=>ao(_,!1,i));if(typeof c!="object"){if(typeof c=="number"){if(c===1/0)return"Infinity";if(c===-1/0)return"-Infinity";if(isNaN(c))return"NaN"}return c}if(!c)return c;let h=(s=c.constructor)!==null&&s!==void 0?s:Object;if(h===Object)return Wl.obj(c,i);if(c.isVector2)return Wl.vec2(c);if(c.isVector3)return Wl.vec3(c);if(c.isVector4)return Wl.vec4(c);if(c.isColor)return Wl.color(c);if(c.isQuaternion)return Wl.quat(c);if(c.isTexture)return Wl.texture(c,i);if(c.isMaterial)return Wl.material(c,i);if(!e&&typeof c.toJSON=="function")return c.toJSON(i);const d={};for(;h&&h!==Object;)(a=Z0.get(h))===null||a===void 0||a.forEach(([_,et])=>{const nt=c[et];d[_]=ao(nt,!1,i)}),h=Object.getPrototypeOf(h);return c.serializableClassId&&(d.serializableClassId=c.serializableClassId),d}function to(c,e,i,s){var a,h,d;let _=e;if(c===void 0)return _;if(typeof e=="number"){if(c==="Infinity")return 1/0;if(c==="-Infinity")return-1/0;if(c==="NaN")return NaN;if(typeof c=="number"||!c)return c}if(Array.isArray(c)){const it=c.length;Array.isArray(_)||(_=[]);for(let lt=0;lt<it;lt++){const ut=c[lt],pt=_.length>lt?to(ut,_[lt],!1,s):to(ut,void 0,!1,s);_.length<=lt?_.push(pt):_[lt]=pt}return _}let et=!1;if(c&&c.resource&&typeof c.resource=="string"&&(c=(a=s[c.resource])===null||a===void 0?void 0:a[c.uuid],et=!0),!_&&c&&!et)if(c.serializableClassId){const it=kw.get(c.serializableClassId);it&&(_=new it)}else typeof c!="object"||c.constructor&&c.constructor!==Object||(_={});if(typeof _=="function")return console.error("cannot deserialize over function",_,c),_;if(c&&typeof c=="object"&&!et){if(c.isVector2)return Om.vec2(c,_);if(c.isVector3)return Om.vec3(c,_);if(c.isVector4)return Om.vec4(c,_);if(c.isColor)return Om.color(c,_);if(c.isQuaternion)return Om.quat(c,_)}if(c==null||_==null||typeof _!="object"||_.isTexture)return et&&(c?c.__useCount=c.__useCount?c.__useCount+1:1:console.warn("probable error deserialize: resource not found.")),c;let nt=(h=_.constructor)!==null&&h!==void 0?h:Object;if(nt===Object)return Om.obj(c,_,s);if(!i&&typeof _.fromJSON=="function")return _.isMaterial&&(Object.entries(c).forEach(([it,lt])=>{var ut;if(!lt||!lt.resource||typeof lt.resource!="string")return;const pt=(ut=s[lt.resource])===null||ut===void 0?void 0:ut[lt.uuid];c[it]=pt||null}),c.userData&&(c.userData=to(c.userData,void 0,!1,s))),_.fromJSON(c,s),_;for(;nt&&nt!==Object;)(d=Z0.get(nt))===null||d===void 0||d.forEach(([it,lt])=>{const ut=_[lt],pt=to(c[it],ut,!1,s);pt!==ut&&bn(_,lt,pt,!0)}),nt=Object.getPrototypeOf(nt);return _}const kw=new Map;function Ow(c){return e=>(e=class extends e{constructor(){super(...arguments),this.serializableClassId=c}},kw.set(c,e),e)}function Hu(c,e){if(c.uiConfig)return c.uiConfig;const i={type:"folder",label:c.name||"unnamed",expanded:!0,limitedUi:!0,children:[{type:"checkbox",label:"Visible",property:[c,"visible"],limitedUi:!0},{type:"button",label:"Pick/Focus",value:()=>{c.dispatchEvent({type:"select",ui:!0,value:c,focusCamera:!0})}},{type:"button",label:"Pick Parent",hidden:()=>!c.parent,value:()=>{const a=c.parent;a&&a.dispatchEvent({type:"select",ui:!0,value:a})}},{type:"input",label:"Name",property:[c,"name"]},{type:"checkbox",label:"Casts Shadow",hidden:()=>!c.isMesh,property:[c,"castShadow"]},{type:"checkbox",label:"Receive Shadow",hidden:()=>!c.isMesh,property:[c,"receiveShadow"]},{type:"vec3",label:"Position",property:[c,"position"],limitedUi:!0},{type:"vec3",label:"Rotation",property:[c,"rotation"],limitedUi:!0},{type:"vec3",label:"Scale",property:[c,"scale"]},{type:"input",label:"Render Order",property:[c,"renderOrder"]},{type:"button",label:"Auto Scale",prompt:["Auto Scale Radius: Object will be scaled to the given radius",c.userData.autoScaleRadius||"2",!0],value:a=>{if(!a)return;const h=parseFloat(a);Math.abs(h)>0&&Gs(c,h)}},c.userData.license!==void 0?{type:"input",label:"License/Credits",property:[c.userData,"license"],limitedUi:!0}:{}]},s=c;if(s!=null&&s.isMesh&&e!==!1){const a=[()=>{var h;return(h=s.geometry)===null||h===void 0?void 0:h.uiConfig},()=>{var h;return Array.isArray(s.material)?s.material.length<1?void 0:{label:"Materials",type:"folder",children:s.material.map(d=>d==null?void 0:d.uiConfig).filter(d=>d)}:(h=s.material)===null||h===void 0?void 0:h.uiConfig}];i.children.push(...a)}if(c!=null&&c.isCamera){const a=[{type:"button",label:"Set View",value:()=>{c.dispatchEvent({type:"setView",ui:!0,camera:c})}},{type:"button",label:"Activate main",hidden:()=>{var h;return(h=c.userData.iCamera)===null||h===void 0?void 0:h.isActiveCamera},value:()=>{c.dispatchEvent({type:"activateMain",ui:!0,camera:c})}},{type:"button",label:"Deactivate main",hidden:()=>{var h;return!(!((h=c.userData.iCamera)===null||h===void 0)&&h.isActiveCamera)},value:()=>{c.dispatchEvent({type:"activateMain",ui:!0,camera:void 0})}}];i.children.push(...a)}return c.uiConfig=i,i}function Ap(c,e,i){var s;if(!c)return void console.warn("setupIModel: object is undefined");if(c.__disposed&&(console.warn("re-init/re-add disposed object, things might not work as intended",c),delete c.__disposed),c.userData||(c.userData={}),c.userData.__iModelSetup&&c.modelObject)return c;c.userData.__iModelSetup=!0;let a=[];a.push(()=>{[...c.children].forEach(gt=>{var vt;(vt=gt==null?void 0:gt.dispose)===null||vt===void 0||vt.call(gt)}),c.children=[],c.parent&&c.removeFromParent()}),c.isLight&&!c.assetType?(c.assetType="light",c.lightObject=c):c.isCamera?(c.assetType="camera",c.cameraObject=c):c.assetType||(c.assetType="model"),c.modelObject||(c.modelObject=c),c.setDirty||(c.setDirty=(gt={})=>{c.dispatchEvent({...gt,type:"objectUpdate",object:c})},c.userData.setDirty&&console.warn("userData.setDirty already defined",c.userData.setDirty,c),c.userData.setDirty=gt=>{var vt;console.warn("userData.setDirty is deprecated, use setDirty directly"),(vt=c.setDirty)===null||vt===void 0||vt.call(c,gt)});const h=gt=>{var vt,Ct,wt;const xt=(Ct=(vt=c.parent)===null||vt===void 0?void 0:vt.userData.parentRoot)!==null&&Ct!==void 0?Ct:c.parent;xt!==c.userData.parentRoot&&c.traverse(_t=>{_t.userData.parentRoot=xt}),(wt=c.setDirty)===null||wt===void 0||wt.call(c,{change:"addedToParent"})},d=()=>{var gt;(gt=c.setDirty)===null||gt===void 0||gt.call(c,{change:"removedFromParent"}),c.userData.parentRoot!==void 0&&c.traverse(vt=>{vt.userData.parentRoot=void 0})};c.addEventListener("added",h),c.addEventListener("removed",d),a.push(()=>{c.removeEventListener("added",h),c.removeEventListener("removed",d)});const _=c.dispose;c.dispose=()=>{c.dispatchEvent({type:"dispose"}),_==null||_.call(c)},c.userData.dispose&&console.warn("userData.dispose already defined"),c.userData.dispose=()=>{var gt;console.warn("userData.dispose is deprecated, use dispose directly"),(gt=c.dispose)===null||gt===void 0||gt.call(c)};const et=c;!et.isMesh&&!et.isLine||et.userData.__meshSetup||(et.userData.__meshSetup=!0,et.setMaterial||(et.setMaterial=gt=>yy(et,gt)),et.setGeometry||(et.setGeometry=(gt,vt=!1)=>yp(et,gt,vt),et.setGeometry(et.geometry,!0)),c.userData.setMaterial&&console.warn("userData.setMaterial already defined"),c.userData.setMaterial=gt=>{var vt;console.warn("userData.setMaterial is deprecated, use setMaterial directly"),(vt=c.setMaterial)===null||vt===void 0||vt.call(c,gt)},c.userData.setGeometry&&console.warn("userData.setGeometry already defined"),c.userData.setGeometry=(gt,...vt)=>{var Ct;console.warn("userData.setGeometry is deprecated, use setGeometry directly"),(Ct=c.setGeometry)===null||Ct===void 0||Ct.call(c,gt,...vt)},c.userData.__keepShadowDef||(c.castShadow=!0,c.receiveShadow=!0,c.userData.__keepShadowDef=!0),a.push(()=>{var gt,vt;const Ct=((gt=et.setMaterial)===null||gt===void 0?void 0:gt.call(et,void 0))||[],wt=(vt=et.setGeometry)===null||vt===void 0?void 0:vt.call(et,void 0);for(const xt of Ct)xt&&xt.userData.__appliedMeshes.size===0&&xt.userData.disposeOnIdle!==!1&&xt.dispose();wt&&wt.userData.__appliedMeshes.size===0&&wt.userData.disposeOnIdle!==!1&&wt.dispose()})),c.uiConfig||c.assetType!=="model"&&c.assetType!=="camera"||(Hu(c),a.push(()=>{c.uiConfig=void 0}));const nt=()=>{var gt,vt;return(vt=(gt=c.uiConfig)===null||gt===void 0?void 0:gt.uiRefresh)===null||vt===void 0?void 0:vt.call(gt,"postFrame",!0,1)};c.addEventListener("objectUpdate",nt),a.push(()=>c.removeEventListener("objectUpdate",nt)),c.userData.__autoParentDispatchEvents?console.warn("object.userData.__autoParentDispatchEvents already set"):(c.userData.__autoParentDispatchEvents=c.userData.__autoParentDispatchEvents||["objectUpdate","materialUpdate","select"],c.isCamera&&c.userData.__autoParentDispatchEvents.push("activateMain","setView")),e&&(c.userData.parentRoot=e),a.push(()=>{delete c.userData.parentRoot});const it=c.dispatchEvent;c.dispatchEvent=gt=>{var vt;!((vt=c.userData.__autoParentDispatchEvents)===null||vt===void 0)&&vt.includes(gt.type)&&(gt.parentDispatch=!0),gt.parentDispatch&&(Ct=>{var wt;const xt=(wt=c.userData.parentRoot)!==null&&wt!==void 0?wt:c.parent;xt!=null&&xt.modelObject&&xt.dispatchEvent(Ct)})(gt),it.call(c,gt)},a.push(()=>{c.dispatchEvent=it});const lt=c.clone;c.clone=(...gt)=>{const vt=c.userData;c.userData={};let Ct=lt.call(c,...gt);c.userData=vt,np(Ct.userData,vt);const wt=c.userData.parentRoot;return wt&&wt.assetType!=="model"&&console.warn("Cloning an object with a parent that is not an IModel is not supported"),Ct=Ap(Ct,wt,i),Ct.userData.cloneParent=c.uuid,Ct},a.push(()=>{c.clone=lt});const ut=c.copy;c.copy=(gt,...vt)=>{const Ct=gt.userData;gt.userData={};const wt=ut.call(c,gt,...vt);return gt.userData=Ct,np(c.userData,gt),wt},a.push(()=>{c.copy=ut});const pt=c.add;return c.add=(...gt)=>(gt.forEach(vt=>Ap(vt,c.userData.parentRoot||c,i)),pt.call(c,...gt)),a.push(()=>{c.add=pt}),c=(s=i==null?void 0:i(c))!==null&&s!==void 0?s:c,a.push(()=>{bn(c,"modelObject",void 0,!0),c.userData={}}),c.addEventListener("dispose",()=>{c.__disposed?console.warn("Object already disposed",c):(c.__disposed=!0,a.forEach(gt=>gt()),a=[])}),[...c.children].forEach(gt=>Ap(gt,c,i)),c}function yy(c,e){var i,s,a,h,d;const _=(Array.isArray(e)?e:[e]).map(it=>it==null?void 0:it.materialObject).filter(it=>it);if(c.material==_||_.length===1&&c.material===_[0])return[];c.userData.__materialUpdater||(c.userData.__materialUpdater=()=>{c.dispatchEvent({type:"materialUpdate"})});const et=Array.isArray(c.material)?[...c.material]:[c.material];for(const it of et)it&&(it.removeEventListener("materialUpdate",c.userData.__materialUpdater),(s=(i=it.userData)===null||i===void 0?void 0:i.__appliedMeshes)===null||s===void 0||s.delete(c));const nt=[];for(const it of _)it.userData.__appliedMeshes||(it.userData.__appliedMeshes=new Set),nt.push(it),it&&(it.addEventListener("materialUpdate",c.userData.__materialUpdater),it.userData.__appliedMeshes.add(c));return c.material=nt.length!==1?nt:(a=nt[0])!==null&&a!==void 0?a:void 0,c.traverseAncestors(it=>{it.isRootScene&&it.refreshEnvMapIntensity(c)}),c.dispatchEvent({type:"materialChanged",material:e}),(d=(h=c.uiConfig)===null||h===void 0?void 0:h.uiRefresh)===null||d===void 0||d.call(h,"postFrame",!0),et}function yp(c,e,i=!1){var s,a,h,d,_,et,nt;c.userData.__objectUpdater||(c.userData.__objectUpdater=ut=>{c.dispatchEvent({...ut,type:"objectUpdate"})});let it=c.geometry;const lt=it;return(it!==e||i)&&(it&&(it.removeEventListener("geometryUpdate",c.userData.__objectUpdater),(a=(s=it.userData)===null||s===void 0?void 0:s.__appliedMeshes)===null||a===void 0||a.delete(c)),it=e,it&&!it.userData.__appliedMeshes&&(it.userData.__appliedMeshes=new Set),c.geometry=(h=it)!==null&&h!==void 0?h:void 0,it&&(it.addEventListener("geometryUpdate",c.userData.__objectUpdater),(_=(d=it.userData)===null||d===void 0?void 0:d.__appliedMeshes)===null||_===void 0||_.add(c))),e&&!e.uiConfig&&(e.uiConfig=function(ut){return{label:"Geometry",type:"folder",children:[{type:"input",property:[ut,"uuid"],disabled:!0},{type:"button",label:"Create uv2 from uv",value:()=>{ut.hasAttribute("uv2")&&!confirm("uv2 already exists, replace with uv data?")||ut.setAttribute("uv2",ut.getAttribute("uv"))}},{type:"input",label:"Mesh count",get value(){var pt,gt,vt;return(vt=(gt=(pt=ut.userData)===null||pt===void 0?void 0:pt.__appliedMeshes)===null||gt===void 0?void 0:gt.size)!==null&&vt!==void 0?vt:0},set value(pt){},disabled:!0}]}}(c.geometry)),c.dispatchEvent({type:"geometryChanged",geometry:e}),(nt=(et=c.uiConfig)===null||et===void 0?void 0:et.uiRefresh)===null||nt===void 0||nt.call(et,"postFrame",!0),lt===it?void 0:lt||void 0}const Av=["appliedMeshes"],iA=["parentRoot","iCamera","iModel"];function np(c,e){if(e)for(const i of Object.keys(e))iA.includes(i)||i.startsWith("__")||typeof c[i]!="function"&&typeof e[i]!="function"&&(c[i]=e[i]);return c}var wy,w1=new Uint8Array(16);function yv(){if(!wy&&!(wy=typeof crypto<"u"&&crypto.getRandomValues&&crypto.getRandomValues.bind(crypto)||typeof msCrypto<"u"&&typeof msCrypto.getRandomValues=="function"&&msCrypto.getRandomValues.bind(msCrypto)))throw new Error("crypto.getRandomValues() not supported. See https://github.com/uuidjs/uuid#getrandomvalues-not-supported");return wy(w1)}for(var ip=/^(?:[0-9a-f]{8}-[0-9a-f]{4}-[1-5][0-9a-f]{3}-[89ab][0-9a-f]{3}-[0-9a-f]{12}|00000000-0000-0000-0000-000000000000)$/i,wv=function(c){return typeof c=="string"&&ip.test(c)},wo=[],wp=0;wp<256;++wp)wo.push((wp+256).toString(16).substr(1));var gu=function(c,e,i){var s=(c=c||{}).random||(c.rng||yv)();if(s[6]=15&s[6]|64,s[8]=63&s[8]|128,e){i=i||0;for(var a=0;a<16;++a)e[i+a]=s[a];return e}return function(h){var d=arguments.length>1&&arguments[1]!==void 0?arguments[1]:0,_=(wo[h[d+0]]+wo[h[d+1]]+wo[h[d+2]]+wo[h[d+3]]+"-"+wo[h[d+4]]+wo[h[d+5]]+"-"+wo[h[d+6]]+wo[h[d+7]]+"-"+wo[h[d+8]]+wo[h[d+9]]+"-"+wo[h[d+10]]+wo[h[d+11]]+wo[h[d+12]]+wo[h[d+13]]+wo[h[d+14]]+wo[h[d+15]]).toLowerCase();if(!wv(_))throw TypeError("Stringified UUID is invalid");return _}(s)};const $0=new Map;function eu(c,e){return(i,s)=>{const a=i.constructor;if(a===Object)throw new Error("All properties in an object are serialized by default");$0.has(a)||$0.set(a,[]);const h=$0.get(a);if(!(h.findIndex(d=>d.propKey===s)<0))throw new Error(`Property ${s} already has a uiConfig decorator`);h.push({params:e||{},propKey:s,uiType:c})}}function ts(c,e){return eu("checkbox",{label:c,params:e})}function r0(c,e){return eu("monitor",{label:c,params:e})}function ss(c,e,i,s){return eu("slider",{label:c,bounds:e,stepSize:i,params:s})}function Up(c,e,i,s){return eu("vec",{label:c,bounds:e,stepSize:i,params:s})}function xv(c,e,i){return eu("dropdown",{label:c,children:e,params:i})}function uo(c,e){return eu("button",{label:c,params:e})}function qs(c,e){return eu("input",{label:c,params:e})}function cm(c,e){return eu("color",{label:c,params:e})}function s0(c,e){return eu("image",{label:c,params:e})}function bv(c){let e=c==null?void 0:c.constructor;if(!c||!e)return[];const i=[],s=[];for(;e&&e!==Object;)s.push(e),e=Object.getPrototypeOf(e);return s.reverse().forEach(a=>{var h;(h=$0.get(a))===null||h===void 0||h.forEach(({params:d,propKey:_,uiType:et})=>{var nt;let it;if(et||(it=(nt=c[_])===null||nt===void 0?void 0:nt.uiConfig),it||(it={property:[c,_],type:et||"input"}),d){const lt=typeof d.params=="function"?d.params(c):d.params||{};delete d.params,Object.assign(it,{...d,...lt})}i.push(it)})}),i}function o0(c,e,i={},s="folder"){return{type:s,label:c,children:bv(e),uuid:gu(),...i}}function Ys(c,e,i="folder"){return s=>class extends s{constructor(){super(...arguments),this.uiConfig=o0(c,this,e||{},i)}}}function e_(c,e){return Ys(c,e,"panel")}const t_={type:"change"},Lm={type:"start"},Ev={type:"end"};class n_ extends b.pBf{constructor(e,i){super(),this.object=e,this.domElement=i,this.domElement.style.touchAction="none",this.enabled=!0,this.target=new b.Pa4,this.minDistance=.01,this.maxDistance=1/0,this.autoPushTarget=!0,this.minZoom=0,this.maxZoom=1/0,this.minPolarAngle=0,this.maxPolarAngle=Math.PI,this.minAzimuthAngle=-1/0,this.maxAzimuthAngle=1/0,this.enableDamping=!1,this.dampingFactor=.05,this.enableZoom=!0,this.zoomSpeed=1,this.maxZoomSpeed=1,this.dollyZoom=!1,this.enableRotate=!0,this.rotateSpeed=1,this.enablePan=!0,this.panSpeed=1,this.screenSpacePanning=!0,this.keyPanSpeed=7,this.autoRotate=!1,this.autoRotateSpeed=2,this.keys={LEFT:"ArrowLeft",UP:"ArrowUp",RIGHT:"ArrowRight",BOTTOM:"ArrowDown"},this.mouseButtons={LEFT:b.RsA.ROTATE,MIDDLE:b.RsA.DOLLY,RIGHT:b.RsA.PAN},this.touches={ONE:b.QmN.ROTATE,TWO:b.QmN.DOLLY_PAN},this.target0=this.target.clone(),this.position0=this.object.position.clone(),this.zoom0=this.object.zoom,this._domElementKeyEvents=null,this.getPolarAngle=function(){return _.phi},this.getAzimuthalAngle=function(){return _.theta},this.getDistance=function(){return this.object.position.distanceTo(this.target)},this.listenToKeyEvents=function(ar){ar.addEventListener("keydown",Us),this._domElementKeyEvents=ar},this.saveState=function(){s.target0.copy(s.target),s.position0.copy(s.object.position),s.zoom0=s.object.zoom},this.reset=function(){s.target.copy(s.target0),s.object.position.copy(s.position0),s.object.zoom=s.zoom0,s.object.updateProjectionMatrix(),s.dispatchEvent(t_),s.update(),h=a.NONE},this.update=function(){const ar=new b.Pa4,Rr=new b._fP().setFromUnitVectors(e.up,new b.Pa4(0,1,0)),Br=Rr.clone().invert(),js=new b.Pa4,Eo=new b._fP,nn=2*Math.PI;return function(){const Nn=s.object.position;ar.copy(Nn).sub(s.target),ar.applyQuaternion(Rr),_.setFromVector3(ar),s.autoRotate&&h===a.NONE&&qt(2*Math.PI/60/60*s.autoRotateSpeed),s.enableDamping?(_.theta+=et.theta*s.dampingFactor,_.phi+=et.phi*s.dampingFactor):(_.theta+=et.theta,_.phi+=et.phi);let on=s.minAzimuthAngle,Qn=s.maxAzimuthAngle;isFinite(on)&&isFinite(Qn)&&(on<-Math.PI?on+=nn:on>Math.PI&&(on-=nn),Qn<-Math.PI?Qn+=nn:Qn>Math.PI&&(Qn-=nn),_.theta=on<=Qn?Math.max(on,Math.min(Qn,_.theta)):_.theta>(on+Qn)/2?Math.max(on,_.theta):Math.min(Qn,_.theta)),_.phi=Math.max(s.minPolarAngle,Math.min(s.maxPolarAngle,_.phi)),_.makeSafe(),Math.abs(et.radius)>0&&(s.dollyZoom&&(s.object.zoom=Math.max(Math.max(s.minZoom,.1),Math.min(Math.min(s.maxZoom,20),s.object.zoom*(1+et.radius*(s.enableDamping?s.dampingFactor:1)))),s.object.updateProjectionMatrix(),(s.object.zoom>=Math.min(s.maxZoom,20)||s.object.zoom<=Math.max(s.minZoom,.1))&&(et.radius=0)),_.radius*=1+et.radius*(s.enableDamping?s.dampingFactor:1)),Math.abs(nt-1)>1e-5&&(s.dollyZoom&&(s.object.zoom=Math.max(Math.max(s.minZoom,.1),Math.min(Math.min(s.maxZoom,20),s.object.zoom*nt)),s.object.updateProjectionMatrix(),(s.object.zoom>=Math.min(s.maxZoom,20)||s.object.zoom<=Math.max(s.minZoom,.1))&&(nt=1)),_.radius*=nt);let Jn=0;s.autoPushTarget&&_.radius<s.minDistance&&(Jn=s.minDistance-_.radius),_.radius=Math.max(s.minDistance,Math.min(s.maxDistance,_.radius)),s.enableDamping===!0?s.target.addScaledVector(it,s.dampingFactor):s.target.add(it),ar.setFromSpherical(_),ar.applyQuaternion(Br),Nn.copy(s.target).add(ar),s.target.add(ar.normalize().multiplyScalar(-Jn)),s.object.lookAt(s.target);let Vn=!1;return s.enableDamping===!0&&Math.abs(et.theta)+Math.abs(et.phi)+Math.abs(et.radius)+it.length()>.001?(et.theta*=1-s.dampingFactor,et.phi*=1-s.dampingFactor,et.radius*=1-s.dampingFactor,it.multiplyScalar(1-s.dampingFactor),Vn=!0):(et.set(0,0,0),it.set(0,0,0)),nt=1,!!(lt||Vn||js.distanceToSquared(s.object.position)>d||8*(1-Eo.dot(s.object.quaternion))>d)&&(s.dispatchEvent(t_),js.copy(s.object.position),Eo.copy(s.object.quaternion),lt=!1,!0)}}(),this.stopDamping=function(){et.set(0,0,0),it.set(0,0,0)},this.dispose=function(){s.domElement.removeEventListener("contextmenu",Ws),s.domElement.removeEventListener("pointerdown",Cr),s.domElement.removeEventListener("pointercancel",ls),s.domElement.removeEventListener("wheel",mr),s.domElement.removeEventListener("pointermove",Mr),s.domElement.removeEventListener("pointerup",Lr),s._domElementKeyEvents!==null&&s._domElementKeyEvents.removeEventListener("keydown",Us)};const s=this,a={NONE:-1,ROTATE:0,DOLLY:1,PAN:2,TOUCH_ROTATE:3,TOUCH_PAN:4,TOUCH_DOLLY_PAN:5,TOUCH_DOLLY_ROTATE:6};let h=a.NONE;const d=1e-6,_=new b.$V,et=new b.$V(0,0,0);let nt=1;const it=new b.Pa4;let lt=!1;const ut=new b.FM8,pt=new b.FM8,gt=new b.FM8,vt=new b.FM8,Ct=new b.FM8,wt=new b.FM8,xt=new b.FM8,_t=new b.FM8,Pt=new b.FM8,Bt=[],Ot={};function Lt(){return s.enableDamping?1:Math.pow(.95,s.zoomSpeed)}function qt(ar){et.theta-=ar}function en(ar){et.phi-=ar}this.rotateUp=en,this.rotateLeft=qt;const cn=function(){const ar=new b.Pa4;return function(Rr,Br){ar.setFromMatrixColumn(Br,0),ar.multiplyScalar(-Rr),it.add(ar)}}(),An=function(){const ar=new b.Pa4;return function(Rr,Br){s.screenSpacePanning===!0?ar.setFromMatrixColumn(Br,1):(ar.setFromMatrixColumn(Br,0),ar.crossVectors(s.object.up,ar)),ar.multiplyScalar(Rr),it.add(ar)}}(),mn=function(){const ar=new b.Pa4;return function(Rr,Br){const js=s.domElement;if(s.object.isPerspectiveCamera){const Eo=s.object.position;ar.copy(Eo).sub(s.target);let nn=ar.length();nn*=Math.tan(s.object.fov/2*Math.PI/180),cn(2*Rr*nn/js.clientHeight,s.object.matrix),An(2*Br*nn/js.clientHeight,s.object.matrix)}else s.object.isOrthographicCamera?(cn(Rr*(s.object.right-s.object.left)/s.object.zoom/js.clientWidth,s.object.matrix),An(Br*(s.object.top-s.object.bottom)/s.object.zoom/js.clientHeight,s.object.matrix)):(console.warn("WARNING: OrbitControls.js encountered an unknown camera type - pan disabled."),s.enablePan=!1)}}();function Tn(ar,Rr=0){s.object.isPerspectiveCamera?(nt/=ar,et.radius=Math.max(-s.maxZoomSpeed,Math.min(s.maxZoomSpeed,et.radius-Rr))):s.object.isOrthographicCamera?(s.object.zoom=Math.max(s.minZoom,Math.min(s.maxZoom,s.object.zoom*ar)),s.object.updateProjectionMatrix(),lt=!0):(console.warn("WARNING: OrbitControls.js encountered an unknown camera type - dolly/zoom disabled."),s.enableZoom=!1)}function vn(ar,Rr=0){s.object.isPerspectiveCamera?(nt*=ar,et.radius=Math.max(-s.maxZoomSpeed,Math.min(s.maxZoomSpeed,et.radius+Rr))):s.object.isOrthographicCamera?(s.object.zoom=Math.max(s.minZoom,Math.min(s.maxZoom,s.object.zoom/ar)),s.object.updateProjectionMatrix(),lt=!0):(console.warn("WARNING: OrbitControls.js encountered an unknown camera type - dolly/zoom disabled."),s.enableZoom=!1)}function xn(ar){ut.set(ar.clientX,ar.clientY)}function Un(ar){vt.set(ar.clientX,ar.clientY)}function Mn(){if(Bt.length===1)ut.set(Bt[0].pageX,Bt[0].pageY);else{const ar=.5*(Bt[0].pageX+Bt[1].pageX),Rr=.5*(Bt[0].pageY+Bt[1].pageY);ut.set(ar,Rr)}}function Gn(){if(Bt.length===1)vt.set(Bt[0].pageX,Bt[0].pageY);else{const ar=.5*(Bt[0].pageX+Bt[1].pageX),Rr=.5*(Bt[0].pageY+Bt[1].pageY);vt.set(ar,Rr)}}function rr(){const ar=Bt[0].pageX-Bt[1].pageX,Rr=Bt[0].pageY-Bt[1].pageY,Br=Math.sqrt(ar*ar+Rr*Rr);xt.set(0,Br)}function dr(ar){if(Bt.length==1)pt.set(ar.pageX,ar.pageY);else{const Br=To(ar),js=.5*(ar.pageX+Br.x),Eo=.5*(ar.pageY+Br.y);pt.set(js,Eo)}gt.subVectors(pt,ut).multiplyScalar(s.rotateSpeed);const Rr=s.domElement;qt(2*Math.PI*gt.x/Rr.clientHeight),en(2*Math.PI*gt.y/Rr.clientHeight),ut.copy(pt)}function _i(ar){if(Bt.length===1)Ct.set(ar.pageX,ar.pageY);else{const Rr=To(ar),Br=.5*(ar.pageX+Rr.x),js=.5*(ar.pageY+Rr.y);Ct.set(Br,js)}wt.subVectors(Ct,vt).multiplyScalar(s.panSpeed),mn(wt.x,wt.y),vt.copy(Ct)}function xr(ar){const Rr=To(ar),Br=ar.pageX-Rr.x,js=ar.pageY-Rr.y,Eo=Math.sqrt(Br*Br+js*js);_t.set(0,Eo),Pt.set(0,Math.pow(_t.y/xt.y,6*s.zoomSpeed)),Tn(Pt.y),xt.copy(_t)}function Cr(ar){s.enabled!==!1&&(Bt.length===0&&(s.domElement.setPointerCapture(ar.pointerId),s.domElement.addEventListener("pointermove",Mr),s.domElement.addEventListener("pointerup",Lr)),function(Rr){Bt.push(Rr)}(ar),ar.pointerType==="touch"?function(Rr){switch(co(Rr),Bt.length){case 1:switch(s.touches.ONE){case b.QmN.ROTATE:if(s.enableRotate===!1)return;Mn(),h=a.TOUCH_ROTATE;break;case b.QmN.PAN:if(s.enablePan===!1)return;Gn(),h=a.TOUCH_PAN;break;default:h=a.NONE}break;case 2:switch(s.touches.TWO){case b.QmN.DOLLY_PAN:if(s.enableZoom===!1&&s.enablePan===!1)return;s.enableZoom&&rr(),s.enablePan&&Gn(),h=a.TOUCH_DOLLY_PAN;break;case b.QmN.DOLLY_ROTATE:if(s.enableZoom===!1&&s.enableRotate===!1)return;s.enableZoom&&rr(),s.enableRotate&&Mn(),h=a.TOUCH_DOLLY_ROTATE;break;default:h=a.NONE}break;default:h=a.NONE}h!==a.NONE&&s.dispatchEvent(Lm)}(ar):function(Rr){let Br;switch(Rr.button){case 0:Br=s.mouseButtons.LEFT;break;case 1:Br=s.mouseButtons.MIDDLE;break;case 2:Br=s.mouseButtons.RIGHT;break;default:Br=-1}switch(Br){case b.RsA.DOLLY:if(s.enableZoom===!1)return;(function(js){xt.set(js.clientX,js.clientY)})(Rr),h=a.DOLLY;break;case b.RsA.ROTATE:if(Rr.ctrlKey||Rr.metaKey||Rr.shiftKey){if(s.enablePan===!1)return;Un(Rr),h=a.PAN}else{if(s.enableRotate===!1)return;xn(Rr),h=a.ROTATE}break;case b.RsA.PAN:if(Rr.ctrlKey||Rr.metaKey||Rr.shiftKey){if(s.enableRotate===!1)return;xn(Rr),h=a.ROTATE}else{if(s.enablePan===!1)return;Un(Rr),h=a.PAN}break;default:h=a.NONE}h!==a.NONE&&s.dispatchEvent(Lm)}(ar))}function Mr(ar){s.enabled!==!1&&(ar.pointerType==="touch"?function(Rr){switch(co(Rr),h){case a.TOUCH_ROTATE:if(s.enableRotate===!1)return;dr(Rr),s.update();break;case a.TOUCH_PAN:if(s.enablePan===!1)return;_i(Rr),s.update();break;case a.TOUCH_DOLLY_PAN:if(s.enableZoom===!1&&s.enablePan===!1)return;(function(Br){s.enableZoom&&xr(Br),s.enablePan&&_i(Br)})(Rr),s.update();break;case a.TOUCH_DOLLY_ROTATE:if(s.enableZoom===!1&&s.enableRotate===!1)return;(function(Br){s.enableZoom&&xr(Br),s.enableRotate&&dr(Br)})(Rr),s.update();break;default:h=a.NONE}}(ar):function(Rr){switch(h){case a.ROTATE:if(s.enableRotate===!1)return;(function(Br){pt.set(Br.clientX,Br.clientY),gt.subVectors(pt,ut).multiplyScalar(s.rotateSpeed);const js=s.domElement;qt(2*Math.PI*gt.x/js.clientHeight),en(2*Math.PI*gt.y/js.clientHeight),ut.copy(pt),s.update()})(Rr);break;case a.DOLLY:if(s.enableZoom===!1)return;(function(Br){_t.set(Br.clientX,Br.clientY),Pt.subVectors(_t,xt),Pt.y>0?Tn(Lt()):Pt.y<0&&vn(Lt()),xt.copy(_t),s.update()})(Rr);break;case a.PAN:if(s.enablePan===!1)return;(function(Br){Ct.set(Br.clientX,Br.clientY),wt.subVectors(Ct,vt).multiplyScalar(s.panSpeed),mn(wt.x,wt.y),vt.copy(Ct),s.update()})(Rr)}}(ar))}function Lr(ar){Fs(ar),Bt.length===0&&(s.domElement.releasePointerCapture(ar.pointerId),s.domElement.removeEventListener("pointermove",Mr),s.domElement.removeEventListener("pointerup",Lr)),s.dispatchEvent(Ev),h=a.NONE}function ls(ar){Fs(ar)}function mr(ar){s.enabled!==!1&&s.enableZoom!==!1&&h===a.NONE&&(ar.preventDefault(),s.dispatchEvent(Lm),function(Rr){let Br=0;switch(Rr.deltaMode){case 2:Br+=1*Rr.deltaY;break;case 1:Br+=.4*Rr.deltaY;break;default:Br+=.01*Rr.deltaY}Rr.deltaY<0?vn(1,Br*s.zoomSpeed):Rr.deltaY>0&&Tn(1,-Br*s.zoomSpeed),s.update()}(ar),s.dispatchEvent(Ev))}function Us(ar){s.enabled!==!1&&s.enablePan!==!1&&function(Rr){let Br=!1;switch(Rr.code){case s.keys.UP:mn(0,s.keyPanSpeed),Br=!0;break;case s.keys.BOTTOM:mn(0,-s.keyPanSpeed),Br=!0;break;case s.keys.LEFT:mn(s.keyPanSpeed,0),Br=!0;break;case s.keys.RIGHT:mn(-s.keyPanSpeed,0),Br=!0}Br&&(Rr.preventDefault(),s.update())}(ar)}function Ws(ar){s.enabled!==!1&&ar.preventDefault()}function Fs(ar){delete Ot[ar.pointerId];for(let Rr=0;Rr<Bt.length;Rr++)if(Bt[Rr].pointerId==ar.pointerId)return void Bt.splice(Rr,1)}function co(ar){let Rr=Ot[ar.pointerId];Rr===void 0&&(Rr=new b.FM8,Ot[ar.pointerId]=Rr),Rr.set(ar.pageX,ar.pageY)}function To(ar){const Rr=ar.pointerId===Bt[0].pointerId?Bt[1]:Bt[0];return Ot[Rr.pointerId]}this.zoomIn=function(ar){Tn(1,ar*s.zoomSpeed)},this.zoomOut=function(ar){vn(1,ar*s.zoomSpeed)},s.domElement.addEventListener("contextmenu",Ws),s.domElement.addEventListener("pointerdown",Cr),s.domElement.addEventListener("pointercancel",ls),s.domElement.addEventListener("wheel",mr,{passive:!1}),this.update()}}var So=function(c,e,i,s){var a,h=arguments.length,d=h<3?e:s===null?s=Object.getOwnPropertyDescriptor(e,i):s;if(typeof Reflect=="object"&&typeof Reflect.decorate=="function")d=Reflect.decorate(c,e,i,s);else for(var _=c.length-1;_>=0;_--)(a=c[_])&&(d=(h<3?a(d):h>3?a(e,i,d):a(e,i))||d);return h>3&&d&&Object.defineProperty(e,i,d),d};let go=class extends n_{constructor(){super(...arguments),this.type="OrbitControls",this.enabled=!0,this.dollyZoom=!1,this.enableDamping=!0,this.dampingFactor=.08,this.autoRotate=!1,this.autoRotateSpeed=2,this.enableZoom=!0,this.zoomSpeed=.15,this.maxZoomSpeed=.2,this.enableRotate=!0,this.rotateSpeed=2,this.enablePan=!0,this.panSpeed=1,this.autoPushTarget=!1,this.minDistance=.35,this.maxDistance=1e3,this.minZoom=.01,this.maxZoom=1e3,this.minPolarAngle=0,this.maxPolarAngle=Math.PI,this.minAzimuthAngle=-1e4,this.maxAzimuthAngle=1e4,this.screenSpacePanning=!0,this.keyPanSpeed=7}zoomIn(c){super.zoomIn(c)}zoomOut(c){super.zoomOut(c)}dispatchEvent(c){super.dispatchEvent(c)}};So([Fn()],go.prototype,"type",void 0),So([ts()],go.prototype,"enabled",void 0),So([ts(),Fn()],go.prototype,"dollyZoom",void 0),So([ts(),Fn()],go.prototype,"enableDamping",void 0),So([qs(),Fn()],go.prototype,"dampingFactor",void 0),So([ts(),Fn()],go.prototype,"autoRotate",void 0),So([qs(),Fn()],go.prototype,"autoRotateSpeed",void 0),So([ts(),Fn()],go.prototype,"enableZoom",void 0),So([qs(),Fn()],go.prototype,"zoomSpeed",void 0),So([qs(),Fn()],go.prototype,"maxZoomSpeed",void 0),So([ts(),Fn()],go.prototype,"enableRotate",void 0),So([qs(),Fn()],go.prototype,"rotateSpeed",void 0),So([ts(),Fn()],go.prototype,"enablePan",void 0),So([qs(),Fn()],go.prototype,"panSpeed",void 0),So([qs(),Fn()],go.prototype,"autoPushTarget",void 0),So([qs(),Fn()],go.prototype,"minDistance",void 0),So([qs(),Fn()],go.prototype,"maxDistance",void 0),So([qs(),Fn()],go.prototype,"minZoom",void 0),So([qs(),Fn()],go.prototype,"maxZoom",void 0),So([qs(),Fn()],go.prototype,"minPolarAngle",void 0),So([qs(),Fn()],go.prototype,"maxPolarAngle",void 0),So([qs(),Fn()],go.prototype,"minAzimuthAngle",void 0),So([qs(),Fn()],go.prototype,"maxAzimuthAngle",void 0),So([Fn()],go.prototype,"screenSpacePanning",void 0),So([Fn()],go.prototype,"keyPanSpeed",void 0),go=So([e_("Orbit Controls")],go);var Sv=function(c,e,i,s){var a,h=arguments.length,d=h<3?e:s===null?s=Object.getOwnPropertyDescriptor(e,i):s;if(typeof Reflect=="object"&&typeof Reflect.decorate=="function")d=Reflect.decorate(c,e,i,s);else for(var _=c.length-1;_>=0;_--)(a=c[_])&&(d=(h<3?a(d):h>3?a(e,i,d):a(e,i))||d);return h>3&&d&&Object.defineProperty(e,i,d),d};class Wu extends ot{constructor(e,i,s){super(),this._controlsMode="",this._isActiveCamera=!1,this.userData={},this._cameraObjectUpdate=d=>{this.setDirty(d)},this._interactionsEnabled=!0,this.autoLookAtTarget=!0,this.near=.01,this.far=50,this._options={type:"PerspectiveCamera",aspect:"auto",focus:10,fov:25,zoom:1,frustumSize:1,top:1,bottom:-1,left:-1,right:1,controlsMode:"orbit",controlsEnabled:!0},this._position=new b.Pa4(0,0,10),this._target=new b.Pa4(0,0,0),this._controlsCtors=new Map([["orbit",(d,_)=>{const et=new go(d,_.ownerDocument?_:_.documentElement);return et.screenSpacePanning=!0,et}]]),this._camUi=[{type:"vec3",label:"Position",property:[this,"position"],onChange:()=>this.positionUpdated(!0)},{type:"vec3",label:"Target",property:[this,"target"],onChange:()=>this.targetUpdated(!0)},{type:"slider",bounds:[1,180],label:"Field Of View",hidden:()=>!this._camera.modelObject.isPerspectiveCamera,property:[this._options,"fov"],onChange:()=>{this.refreshCameraOptions()},limitedUi:!0},{type:"slider",bounds:[.001,20],label:"Zoom",property:[this._options,"zoom"],onChange:()=>{this.refreshCameraOptions()}},()=>({type:"dropdown",label:"Controls Mode",property:[this._options,"controlsMode"],children:["","orbit",...this._controlsCtors.keys()].map(d=>({label:d===""?"none":d,value:d})),onChange:()=>{this.refreshCameraOptions()}})],this.uiConfig={type:"folder",label:"Camera",limitedUi:!0,children:[...this._camUi,()=>{var d;return!((d=this._controls)===null||d===void 0)&&d.zoomIn?{type:"button",label:"Zoom in",value:()=>{var _;(_=this._controls)===null||_===void 0||_.zoomIn(1)}}:{}},()=>{var d;return!((d=this._controls)===null||d===void 0)&&d.zoomOut?{type:"button",label:"Zoom out",value:()=>{var _;(_=this._controls)===null||_===void 0||_.zoomOut(1)}}:{}},()=>{var d;return(d=this._controls)===null||d===void 0?void 0:d.uiConfig}]},this.assetType="model",this.uuid=Qo(),this.setDirty=this.setDirty.bind(this),this.targetUpdated=this.targetUpdated.bind(this),this._refreshCameraOptions=this._refreshCameraOptions.bind(this),this._container=s??document.body;const a=i??this._options;this._camera=this._setCameraObject(e??(a.type==="OrthographicCamera"?new b.iKG(-1,1,1,-1):new b.cPb)),this._camera.modelObject.userData.iCamera=this;const h=e;e&&(h.isPerspectiveCamera?(a.fov=h.fov,a.focus=h.focus,a.aspect=h.aspect<=0||h.userData.autoAspect?"auto":h.aspect,a.zoom=h.zoom):h.isOrthographicCamera&&(a.left=h.left,a.right=h.right,a.top=h.top,a.bottom=h.bottom,a.zoom=h.zoom),a.near=h.near,a.far=h.far,this._position.copy(e.position),this.refreshTarget()),this.positionUpdated(!1),e||this.targetUpdated(!1),this.setCameraOptions(a)}get controls(){return this._controls}getControls(){return this._controls}get isActiveCamera(){return this._isActiveCamera}get target(){return this._target}set target(e){const i=this._target.sub(e).length()>1e-5;this._target.copy(e),i&&this.targetUpdated()}get position(){return this._position}set position(e){const i=this._position.sub(e).length()>1e-5;this._position.copy(e),i&&this.positionUpdated()}get name(){return this._camera.name}set name(e){this._camera.name=e}getCameraOptions(){return{...this._options,position:this._position.toArray(),target:this._target.toArray()}}setCameraOptions(e,i=!0){var s,a;const h={...e};!((s=h.position)===null||s===void 0)&&s.isVector3&&(h.position=[h.position.x,h.position.y,h.position.z]),!((a=h.target)===null||a===void 0)&&a.isVector3&&(h.target=[h.target.x,h.target.y,h.target.z]),Object.keys(h).forEach(d=>d!=="frustumSize"&&h[d]===void 0&&delete h[d]),Object.assign(this._options,h),this._refreshCameraOptions(!1),this.refreshCameraControls(!1),i&&this.setDirty()}_refreshCameraOptions(e=!0){let i=this._camera.modelObject;if(this._options.type!==i.type){const a=this._options.type==="PerspectiveCamera"?new b.cPb:new b.iKG;a.name=this._camera.name,a.near=this._camera.modelObject.near,a.far=this._camera.modelObject.far,a.zoom=this._camera.modelObject.zoom,a.scale.copy(this._camera.modelObject.scale);const h=this._isActiveCamera;h&&this.deactivateMain(),this._camera=this._setCameraObject(a),i=this._camera.modelObject,h&&this.activateMain(),this._camera.modelObject.updateProjectionMatrix()}let s=this._options.aspect;if(s==="auto"&&(s=this._container.clientWidth/this._container.clientHeight),this._options.position&&(this.position.set(...this._options.position),delete this._options.position),this._options.target&&(this.target.set(...this._options.target),delete this._options.target),this.positionTargetUpdated(!1),this._options.type==="PerspectiveCamera"&&(i.fov=this._options.fov,i.focus=this._options.focus,i.aspect=s),this._options.type==="OrthographicCamera"){const a=this._options.frustumSize;a!==void 0?(i.top=a/2,i.bottom=-a/2,i.left=s*a/2,i.right=-s*a/2):(i.top=this._options.top,i.bottom=this._options.bottom,i.left=this._options.left,i.right=this._options.right)}i.zoom=this._options.zoom,this._nearFarChanged(),e&&this.setDirty()}_setCameraObject(e){return this._camera&&this._camera.removeEventListener("objectUpdate",this._cameraObjectUpdate),this._camera=Ap(e),this._camera.addEventListener("objectUpdate",this._cameraObjectUpdate),this._camera}get interactionsEnabled(){return this._interactionsEnabled&&this._isActiveCamera&&this._options.controlsEnabled}set interactionsEnabled(e){this._interactionsEnabled!==e&&(this._interactionsEnabled=e,this.refreshCameraControls(!0))}_nearFarChanged(){this._camera&&(this._camera.modelObject.near=this.near,this._camera.modelObject.far=this.far,this._camera.modelObject.updateProjectionMatrix())}refreshAspect(e=!0){this._options.aspect==="auto"&&this._refreshCameraOptions(e)}refreshTarget(){var e;!((e=this._controls)===null||e===void 0)&&e.enabled&&this._controls.target?this._target.copy(this._controls.target):this._target.set(0,0,-1).applyQuaternion(this._camera.modelObject.getWorldQuaternion(new b._fP))}setControlsCtor(e,i,s=!1){s||!this._controlsCtors.has(e)?this._controlsCtors.set(e,i):console.error(e+" already exists.")}removeControlsCtor(e){this._controlsCtors.delete(e)}_initCameraControls(){var e,i,s;const a=this._options.controlsMode;this._controls=(i=(e=this._controlsCtors.get(a))===null||e===void 0?void 0:e(this._camera.modelObject,this._container))!==null&&i!==void 0?i:void 0,this._controls||console.error("Unable to create controls with mode "+a+". Are you missing a plugin?"),(s=this._controls)===null||s===void 0||s.addEventListener("change",this.setDirty),this._controlsMode=this._controls?a:""}_disposeCameraControls(){var e,i;this._controlsMode,(e=this._controls)===null||e===void 0||e.removeEventListener("change",this.setDirty),(i=this._controls)===null||i===void 0||i.dispose(),this._controlsMode="",this._controls=void 0}refreshCameraControls(e=!0){var i,s;if(this._options.controlsEnabled){const a=this._options.controlsMode;this._controls?this._controlsMode===a&&this._camera.modelObject===this._controls.object||(this._disposeCameraControls(),this._initCameraControls()):this._initCameraControls(),this._controlsMode=a}if(this._controls){const a=this.interactionsEnabled;this._controls.enabled=a,a&&this._camera.modelObject.up.copy(b.Tme.DefaultUp)}e&&this.setDirty(),(s=(i=this.uiConfig).uiRefresh)===null||s===void 0||s.call(i,"postFrame",!0)}setDirty(e){this._position.copy(this._camera.modelObject.position),this._controls&&this._controls.enabled&&this._controls.target&&this._target.copy(this._controls.target),this._camera.modelObject.fov!==void 0&&(this._options.fov=this._camera.modelObject.fov),this._camera.modelObject.focus!==void 0&&(this._options.focus=this._camera.modelObject.focus),this._camera.modelObject.zoom!==void 0&&(this._options.zoom=this._camera.modelObject.zoom),this.dispatchEvent({...e,type:"update"}),this._camUi.forEach(i=>{var s;return(s=i==null?void 0:i.uiRefresh)===null||s===void 0?void 0:s.call(i,"postFrame",!1,1)})}activateMain(e=!0){var i,s;this._isActiveCamera||(this._isActiveCamera=!0,this._camera.modelObject.userData.__lastScale=this._camera.modelObject.scale.clone(),this._camera.modelObject.scale.divide(this._camera.modelObject.getWorldScale(new b.Pa4)),e&&(this.refreshCameraControls(!0),this.refreshAspect()),(s=(i=this._camera).setDirty)===null||s===void 0||s.call(i,{change:"activateMain"}))}deactivateMain(e=!0){this._isActiveCamera&&(this._isActiveCamera=!1,this._camera.modelObject.userData.__lastScale&&(this._camera.modelObject.scale.copy(this._camera.modelObject.userData.__lastScale),delete this._camera.modelObject.userData.__lastScale),e&&this.refreshCameraControls(!0))}get cameraObject(){return this._camera.modelObject}get modelObject(){return this._camera.modelObject}dispose(){this._disposeCameraControls()}targetUpdated(e=!0){var i,s;const a=this.target;(s=(i=this._controls)===null||i===void 0?void 0:i.target)===null||s===void 0||s.set(a.x,a.y,a.z),this._controls&&this._controls.enabled&&this._controls.target?e&&this.setDirty():this._camera&&(this.autoLookAtTarget&&this._camera.modelObject.lookAt(a),e&&this.setDirty())}positionUpdated(e=!0){const i=this.position;this._camera.modelObject.position.set(i.x,i.y,i.z),e&&this.setDirty()}positionTargetUpdated(e=!0){this.positionUpdated(!1),this.targetUpdated(e)}copyFromCamera(e,i=4){e.getWorldPosition(this._position),e.getWorldDirection(this._target).multiplyScalar(i).add(this._position),this.positionTargetUpdated(!1),this.setCameraOptions({fov:e.fov,focus:e.focus,zoom:e.zoom,type:e.type},!0)}updateShaderProperties(e){var i;return!((i=e.uniforms.cameraPositionWorld)===null||i===void 0)&&i.value&&this._camera.modelObject.getWorldPosition(e.uniforms.cameraPositionWorld.value),e.uniforms.cameraNearFar?e.uniforms.cameraNearFar.value.set(this._camera.modelObject.near,this._camera.modelObject.far):console.warn("BaseRenderer: no uniform: cameraNearFar"),e.uniforms.projection&&(e.uniforms.projection.value=this._camera.modelObject.projectionMatrix),e.defines.PERSPECTIVE_CAMERA=this._camera.modelObject.type==="PerspectiveCamera"?"1":"0",e.defines.ORTHOGRAPHIC_CAMERA=this._camera.modelObject.type==="OrthographicCamera"?"1":"0",this}toJSON(e){return Object.assign({},ao(this,!0,e))}fromJSON(e,i){return to(e,this,!0,i),this.positionTargetUpdated(!1),this.refreshCameraOptions(),this.setDirty(),this}refreshCameraOptions(e=!0){this.setCameraOptions(this._options,e)}get visible(){return!0}set visible(e){console.error("Cannot set visible on camera",e)}}Sv([Fn("camControls")],Wu.prototype,"_controls",void 0),Sv([Fn()],Wu.prototype,"userData",void 0),Sv([pn(Wu.prototype._nearFarChanged)],Wu.prototype,"near",void 0),Sv([pn(Wu.prototype._nearFarChanged)],Wu.prototype,"far",void 0),Sv([Fn("camOptions")],Wu.prototype,"_options",void 0),Sv([Fn("position")],Wu.prototype,"_position",void 0),Sv([Fn("target")],Wu.prototype,"_target",void 0);var xy=function(c,e,i,s){var a,h=arguments.length,d=h<3?e:s===null?s=Object.getOwnPropertyDescriptor(e,i):s;if(typeof Reflect=="object"&&typeof Reflect.decorate=="function")d=Reflect.decorate(c,e,i,s);else for(var _=c.length-1;_>=0;_--)(a=c[_])&&(d=(h<3?a(d):h>3?a(e,i,d):a(e,i))||d);return h>3&&d&&Object.defineProperty(e,i,d),d};class um extends b.xsS{constructor(e){super(),this.isRootScene=!0,this.assetType="model",this._sceneBounds=new Dr,this._sceneBoundingRadius=0,this._cameras=[],this._activeCamera=-1,this.envMapIntensity=1,this._dummyCam=new Wu(new b.cPb,{controlsMode:"",controlsEnabled:!1}),this.environment=null,this.background=null,this.minNearDistance=.2,this.setDirty=this.setDirty.bind(this),this.updateScene=this.updateScene.bind(this),this.refreshActiveCameraNearFar=this.refreshActiveCameraNearFar.bind(this),this._activeCameraUpdate=this._activeCameraUpdate.bind(this),this._onSceneMaterialUpdate=this._onSceneMaterialUpdate.bind(this),this._onSceneUpdate=this._onSceneUpdate.bind(this),this.addEventListener("materialUpdate",this._onSceneMaterialUpdate),this.addEventListener("objectUpdate",this._onSceneUpdate),this.defaultCamera=e,this.modelRoot=Ap(new b.ZAu,void 0),this.modelRoot.userData.rootSceneModelRoot=!0,this.modelRoot.name="Scene",this.modelRoot.addEventListener("update",this.setDirty),this.addSceneObject(this.modelRoot,{addToRoot:!0,autoScale:!1}),this.addSceneObject(this.defaultCamera,{addToRoot:!0}),this.activeCamera=this.defaultCamera,this.boxHelper=new b.GQ(this.getBounds())}refreshEnvMapIntensity(e){return e!=null&&e.isObject3D||(e=this),(e??this).traverse(i=>{(Array.isArray(i.material)?i.material:[i.material]).forEach(s=>{s&&s.envMapIntensity!==void 0&&!s.userData.separateEnvMapIntensity&&(s.envMapIntensity=this.envMapIntensity,s.needsUpdate=!0)})}),this.setDirty(),this}get activeCamera(){return this._activeCamera>=0?this._cameras[this._activeCamera]:this._dummyCam}set activeCamera(e){const i=this.activeCamera;if(e||(e=this.defaultCamera),i!==e){if(i&&(i.deactivateMain(),i.removeEventListener("update",this._activeCameraUpdate)),e){e.activateMain(),e.addEventListener("update",this._activeCameraUpdate);let s=this._cameras.indexOf(e);s<0&&(this._cameras.push(e),s=this._cameras.length-1),this._activeCamera=s}else this._activeCamera=-1;this.dispatchEvent({type:"activeCameraChange",lastCamera:i,camera:e}),this.setDirty()}}get modelObject(){return this}addModel(e,i={}){return e.assetType!=="model"&&console.error("Invalid asset type for ",e,", adding anyway"),this.addSceneObject(e,i)}addWidget(e,i={}){e.assetType!=="widget"&&console.warn("Invalid asset type for ",e,", adding anyway"),this.add(e.modelObject)}_addModel(e,i={}){return this._addObject3D(e==null?void 0:e.modelObject,i)}addSceneObject(e,i){if(!e)return e;const s=e.assetType;let a=!1;switch(s){case"model":a=e.modelObject.isCamera,a&&(i={...i,autoScale:!1}),this._addModel(e,i);break;case"material":break;case"texture":this.dispatchEvent({type:"textureAdded",texture:e});break;case"light":this._addLight(e,i);break;default:console.warn("Unknown asset imported",e,s)}return this.dispatchEvent({type:"addSceneObject",object:e}),e}_addObject3D(e,{autoScale:i=!0,autoScaleRadius:s=2,addToRoot:a=!1}={}){const h=e;h?(i&&!h.userData.autoScaled&&Gs(h,h.userData.autoScaleRadius||s),h.traverse(d=>{d.isMesh&&!d.userData.__keepShadowDef&&(d.castShadow=!0,d.receiveShadow=!0,d.userData.__keepShadowDef=!0)}),this.refreshEnvMapIntensity(h),a?this.modelObject.add(h):this.modelRoot.add(h),this.setDirty()):console.error("Invalid Model, cannot add.")}removeSceneModels(){this.modelRoot.clear(),this.modelRoot.children=[],this.setDirty({sceneUpdate:!0})}disposeSceneModels(){this.modelRoot.children.forEach(e=>{var i,s;((i=e.dispose)!==null&&i!==void 0?i:(s=e.modelObject)===null||s===void 0?void 0:s.removeFromParent)()}),this.setDirty({sceneUpdate:!0})}_onEnvironmentChange(){this.dispatchEvent({type:"environmentChanged",environment:this.getEnvironment()}),this._onSceneUpdate()}add(...e){return super.add(...e.map(i=>Ap(i))),this._onSceneUpdate(),this}setEnvironment(e){if(!e)return this.environment=null,this.dispatchEvent({type:"environmentChanged"}),void this._onSceneUpdate();if((e==null?void 0:e.assetType)!=="texture")return void console.error("Unknown Environment type",e);e.mapping===b.xfE&&(e.mapping=b.dSO,e.needsUpdate=!0);const i=e.textureObject||e;this.environment=i,this._onEnvironmentChange()}getEnvironment(){return this.environment}setBackground(e){var i;let s;if(!e||e.assetType==="texture"||e.isColor||e.isVector4)s=((i=e)===null||i===void 0?void 0:i.assetType)==="texture"&&e.textureObject||e;else{if(typeof e!="string"&&typeof e!="number")return void console.error("Unknown Background type",e);s=new b.Ilk(e)}this.background=s,this._onSceneUpdate({geometryChanged:!1})}getBackground(){return this.background}setDirty(e){return e!=null&&e.sceneUpdate?this._onSceneUpdate(e):this.dispatchEvent({type:"update"}),this}updateScene(e){return this._onSceneUpdate(e)}_activeCameraUpdate(){this.setDirty(),this.refreshActiveCameraNearFar(),this.dispatchEvent({type:"activeCameraUpdate"})}_onSceneUpdate(e={}){var i,s,a;return e.sceneUpdate===!1?this.setDirty(e):(this.refreshActiveCameraNearFar(),this._sceneBounds=this.getBounds(!1,!0),(a=(s=(i=this.boxHelper)===null||i===void 0?void 0:i.box)===null||s===void 0?void 0:s.copy)===null||a===void 0||a.call(s,this._sceneBounds),this._sceneBoundingRadius=this._sceneBounds.getSize(new b.Pa4).length()/2,this.dispatchEvent({...e,type:"sceneUpdate",hierarchyChanged:["addedToParent","removedFromParent"].includes(e.change||"")}),this)}_onSceneMaterialUpdate(){this.dispatchEvent({type:"sceneMaterialUpdate"})}dispose(){this.clear()}findObjectsByName(e,i){const s=[];return(i??this.modelObject).traverse(a=>{a.name===e&&s.push(a)}),s}addLight(e,i={}){this.addSceneObject(e,i)}_addLight(e,{addToRoot:i=!1}={}){var s;const a=e.lightObject;a&&((s=a.children)===null||s===void 0||s.length,i?this.add(a):this.modelRoot.add(a))}getBounds(e=!1,i=!0){return new Dr().expandByObject(this.modelObject,e,i)}refreshActiveCameraNearFar(){const e=this.activeCamera;if(!e)return;const i=this.getBounds(!1),s=e.cameraObject.getWorldPosition(new b.Pa4).sub(i.getCenter(new b.Pa4)),a=1.5*i.getSize(new b.Pa4).length()/2,h=s.length(),d=Math.max(this.minNearDistance,h-a),_=Math.max(d+1,h+a);e.near=d,e.far=_}updateShaderProperties(e){return e.uniforms.sceneBoundingRadius?e.uniforms.sceneBoundingRadius.value=this._sceneBoundingRadius:console.warn("BaseRenderer: no uniform: frameCount"),this}toJSON(e){return ao(this,!0,e)}fromJSON(e,i){const s=e.environment;return s!==void 0&&(this.setEnvironment(to(s,this.getEnvironment(),!1,i)),delete e.environment),to(e,this,!0,i),e.environment=s,this}addEventListener(e,i){super.addEventListener(e,i)}removeEventListener(e,i){super.removeEventListener(e,i)}}function a0(){const c=document.createElementNS("http://www.w3.org/1999/xhtml","canvas");return c.style.display="block",c}function i_(c,e){const i=e||"/";return c.join(i)}function Do(c,e){const i=window.URL.createObjectURL(c),s=document.createElement("a");s.style.display="none",s.href=i,s.download=e,document.body.appendChild(s),s.click(),setTimeout(()=>{document.body.removeChild(s),window.URL.revokeObjectURL(i)},1e3)}async function xp(c){return new Promise((e,i)=>{const s=new FileReader;s.onload=a=>e(s.result),s.onerror=a=>i(s.error),s.onabort=a=>i(new Error("Read aborted")),s.readAsDataURL(c)})}function Nm(c,e){return Do(c,e??c.name)}async function Yl(c=!1,e=!1,i){const s=document.createElement("input");s.type="file",s.multiple=c,s.accept=i||"*",s.webkitdirectory=e,s.style.display="none",document.body.appendChild(s),s.click();const a=await new Promise(h=>{s.onchange=d=>{h(Array.from(s.files||[]))}});return document.body.removeChild(s),a}function rp({innerHTML:c="",id:e,classList:i,addToBody:s=!0,elementTag:a="div"}){const h=document.createElement(a);return e&&(h.id=e),h.innerHTML=c,i&&h.classList.add(...i),s&&document.body.appendChild(h),h}async function rA(c){return new Promise((e,i)=>{const s=new Image;s.onload=()=>e(s),s.onerror=i,s.crossOrigin="anonymous",s.decoding="sync",s.src=c})}function r_(c){const e=document.createElement("style");return e.type="text/css",e.innerText=c,document.head.appendChild(e),e}async function Lw(c){return new Promise((e,i)=>{const s=document.createElement("script");s.setAttribute("src",c),s.addEventListener("load",e),s.addEventListener("error",i),document.body.appendChild(s)})}function qu(c,e=8192,i=!1){var s;if(!c.width||!c.height)return"";const a=document.createElement("canvas");a.width=Math.min(e,c.width),a.height=Math.floor(1+a.width*c.height/c.width);const h=c instanceof ImageBitmap,d=h&&i&&Math.abs(a.width-c.width)<.5?a.getContext("bitmaprenderer"):void 0;d?d.transferFromImageBitmap(c):(s=a.getContext("2d"))===null||s===void 0||s.drawImage(c,0,0,a.width,a.height);const _=a.toDataURL("image/png");return a.remove(),h&&i&&c.close(),_}async function No(c){return new Promise((e,i)=>{const s=new Image;s.addEventListener("load",()=>{const a=document.createElement("canvas");a.width=s.width,a.height=s.height;const h=a.getContext("2d");if(!h)return void i(new Error("Could not get 2d context"));h.drawImage(s,0,0,a.width,a.height);const d=h.getImageData(0,0,a.width,a.height);e(d),a.remove(),s.remove()},!1),s.addEventListener("error",a=>{s.remove(),i(a)},!1),s.src=c})}function Yu(){return(typeof performance>"u"?Date:performance).now()}function Cv(){let c=!1;return e=navigator.userAgent||navigator.vendor||window.opera,(/(android|bb\d+|meego).+mobile|avantgo|bada\/|blackberry|blazer|compal|elaine|fennec|hiptop|iemobile|ip(hone|od)|iris|kindle|lge |maemo|midp|mmp|mobile.+firefox|netfront|opera m(ob|in)i|palm( os)?|phone|p(ixi|re)\/|plucker|pocket|psp|series(4|6)0|symbian|treo|up\.(browser|link)|vodafone|wap|windows ce|xda|xiino|android|ipad|playbook|silk/i.test(e)||/1207|6310|6590|3gso|4thp|50[1-6]i|770s|802s|a wa|abac|ac(er|oo|s\-)|ai(ko|rn)|al(av|ca|co)|amoi|an(ex|ny|yw)|aptu|ar(ch|go)|as(te|us)|attw|au(di|\-m|r |s )|avan|be(ck|ll|nq)|bi(lb|rd)|bl(ac|az)|br(e|v)w|bumb|bw\-(n|u)|c55\/|capi|ccwa|cdm\-|cell|chtm|cldc|cmd\-|co(mp|nd)|craw|da(it|ll|ng)|dbte|dc\-s|devi|dica|dmob|do(c|p)o|ds(12|\-d)|el(49|ai)|em(l2|ul)|er(ic|k0)|esl8|ez([4-7]0|os|wa|ze)|fetc|fly(\-|_)|g1 u|g560|gene|gf\-5|g\-mo|go(\.w|od)|gr(ad|un)|haie|hcit|hd\-(m|p|t)|hei\-|hi(pt|ta)|hp( i|ip)|hs\-c|ht(c(\-| |_|a|g|p|s|t)|tp)|hu(aw|tc)|i\-(20|go|ma)|i230|iac( |\-|\/)|ibro|idea|ig01|ikom|im1k|inno|ipaq|iris|ja(t|v)a|jbro|jemu|jigs|kddi|keji|kgt( |\/)|klon|kpt |kwc\-|kyo(c|k)|le(no|xi)|lg( g|\/(k|l|u)|50|54|\-[a-w])|libw|lynx|m1\-w|m3ga|m50\/|ma(te|ui|xo)|mc(01|21|ca)|m\-cr|me(rc|ri)|mi(o8|oa|ts)|mmef|mo(01|02|bi|de|do|t(\-| |o|v)|zz)|mt(50|p1|v )|mwbp|mywa|n10[0-2]|n20[2-3]|n30(0|2)|n50(0|2|5)|n7(0(0|1)|10)|ne((c|m)\-|on|tf|wf|wg|wt)|nok(6|i)|nzph|o2im|op(ti|wv)|oran|owg1|p800|pan(a|d|t)|pdxg|pg(13|\-([1-8]|c))|phil|pire|pl(ay|uc)|pn\-2|po(ck|rt|se)|prox|psio|pt\-g|qa\-a|qc(07|12|21|32|60|\-[2-7]|i\-)|qtek|r380|r600|raks|rim9|ro(ve|zo)|s55\/|sa(ge|ma|mm|ms|ny|va)|sc(01|h\-|oo|p\-)|sdk\/|se(c(\-|0|1)|47|mc|nd|ri)|sgh\-|shar|sie(\-|m)|sk\-0|sl(45|id)|sm(al|ar|b3|it|t5)|so(ft|ny)|sp(01|h\-|v\-|v )|sy(01|mb)|t2(18|50)|t6(00|10|18)|ta(gt|lk)|tcl\-|tdg\-|tel(i|m)|tim\-|t\-mo|to(pl|sh)|ts(70|m\-|m3|m5)|tx\-9|up(\.b|g1|si)|utst|v400|v750|veri|vi(rg|te)|vk(40|5[0-3]|\-v)|vm40|voda|vulc|vx(52|53|60|61|70|80|81|83|85|98)|w3c(\-| )|webc|whit|wi(g |nc|nw)|wmlb|wonu|x700|yas\-|your|zeto|zte\-/i.test(e.substr(0,4)))&&(c=!0),c;var e}function vu(c,e=null){var i;return(i=new URL(window.location.href).searchParams.get(c))!==null&&i!==void 0?i:e}function Mv(c,e,i=!1){const s=new URLSearchParams(location.search);e==null?s.has(c)&&s.delete(c):s.set(c,e),i?window.location.search=s.toString():window.history.replaceState({},"","?"+s.toString())}function Nl(c){if(!window)return console.warn("window is required"),"";let e="";const i=new Uint8Array(c),s=i.byteLength;for(let a=0;a<s;a++)e+=String.fromCharCode(i[a]);return window.btoa(e)}function by(c){if(!window)return console.warn("window is required"),new Uint8Array(0);const e=window.atob(c),i=e.length,s=new Uint8Array(i);for(let a=0;a<i;a++)s[a]=e.charCodeAt(a);return s.buffer}function Nw(c){return c.replace(/\w\S*/g,function(e){return e.charAt(0).toUpperCase()+e.substr(1).toLowerCase()})}function tu(c,{backgroundColor:e="",displayPixelRatio:i=1,width:s=512,height:a=512}){const h=document.createElement("canvas"),d=h.getContext("2d"),_=i,et=s,nt=a;return h.width=et*_,h.height=nt*_,h.style.width=`${et}`,h.style.height=`${nt}`,(e==null?void 0:e.length)>0&&(d.fillStyle=e,d.fillRect(0,0,h.width,h.height)),d.drawImage(c,0,0,h.width,h.height),h}xy([Fn()],um.prototype,"defaultCamera",void 0),xy([pn(um.prototype.refreshEnvMapIntensity),Fn()],um.prototype,"envMapIntensity",void 0),xy([Fn()],um.prototype,"environment",void 0),ArrayBuffer.prototype.slice||(ArrayBuffer.prototype.slice=function(c,e){const i=new Uint8Array(this);e==null&&(e=i.length);const s=new ArrayBuffer(e-c),a=new Uint8Array(s);for(let h=0;h<a.length;h++)a[h]=i[h+c];return s});const vo={Int8Array,Uint8Array,Uint8ClampedArray,Int16Array,Uint16Array,Int32Array,Uint32Array,Float32Array,Float64Array};function Uw(c,e){return new vo[c](e)}class Vs{static ApplyMaterialExtensions(e,i,s,a){for(const h of s)this.ApplyMaterialExtension(e,i,h,a)}static ApplyMaterialExtension(e,i,s,a){var h,d;let _=(h=Yt(s.parsFragmentSnippet,a,e))!==null&&h!==void 0?h:"";_.length&&(i.fragmentShader=i.fragmentShader.replace(this.FragVoidMain,`
${_}
${this.FragVoidMain}`)),_=(d=Yt(s.parsVertexSnippet,a,e))!==null&&d!==void 0?d:"",_.length&&(i.vertexShader=i.vertexShader.replace(this.VertVoidMain,`
${_}
${this.VertVoidMain}`)),s.extraUniforms&&(i.uniforms=Object.assign(i.uniforms,s.extraUniforms)),s.shaderExtender&&s.shaderExtender(i,e,a),e.lastShader=i}static CacheKeyForExtensions(e,i){let s="";for(const a of i)s+=this.CacheKeyForExtension(e,a);return s}static CacheKeyForExtension(e,i){let s="";return i.customCacheKey&&(s+=i.customCacheKey),i.computeCacheKey&&(s+=i.computeCacheKey(e)),s}static RegisterExtensions(e,i){const s=[];if(i)for(const a of i)a.isCompatible&&a.isCompatible(e)&&(s.push(a),a.uuid||(a.uuid=gu()),a.__setDirty||(a.__setDirty=()=>{a.updateVersion||(a.updateVersion=0),a.updateVersion++}),a.setDirty||(a.setDirty=a.__setDirty));return e.materialExtensions=s,e.__ext_beforeRenderListen||(e.__ext_beforeRenderListen=!0,e.addEventListener("beforeRender",a=>function(h,{object:d,renderer:_}){var et;(et=h.materialExtensions)===null||et===void 0||et.forEach(nt=>{var it,lt;(it=nt.onObjectRender)===null||it===void 0||it.call(nt,d,h,_),h.lastShader&&((lt=Yt(nt.updaters))===null||lt===void 0||lt.forEach(ut=>ut==null?void 0:ut.updateShaderProperties(h.lastShader))),nt.updateVersion!==h.materialObject.userData["_"+nt.uuid+"_version"]&&(h.materialObject.userData["_"+nt.uuid+"_version"]=nt.updateVersion,h.materialObject.needsUpdate=!0)})}(e,a))),e.__ext_afterRenderListen||(e.__ext_afterRenderListen=!0,e.addEventListener("afterRender",a=>function(h,{object:d,renderer:_}){var et;(et=h.materialExtensions)===null||et===void 0||et.forEach(nt=>{var it;(it=nt.onAfterRender)===null||it===void 0||it.call(nt,d,h,_)})}(e,a))),s}}Vs.FragVoidMain="void main() {",Vs.VertVoidMain="void main() {";class l0 extends b.jyz{constructor(e){var i;super(e),this.typeSlug="shaderMat",this.assetType="material",this.materialObject=this,this.materialExtensions=[],this.extraUniformsToUpload={},this.materialExtensions=Vs.RegisterExtensions(this,(i=e==null?void 0:e.customMaterialExtensions)!==null&&i!==void 0?i:[])}registerMaterialExtensions(e){this.materialExtensions=[...this.materialExtensions,...Vs.RegisterExtensions(this,e)]}unregisterMaterialExtensions(e){}onBeforeCompile(e,i){Vs.ApplyMaterialExtensions(this,e,this.materialExtensions,i),e.fragmentShader=e.fragmentShader.replaceAll("#glMarker","// "),this.dispatchEvent({type:"beforeCompile",shader:e,renderer:i}),super.onBeforeCompile(e,i)}customProgramCacheKey(){return super.customProgramCacheKey()+Vs.CacheKeyForExtensions(this,this.materialExtensions)+this.userData.inverseAlphaMap}onBeforeRender(e,i,s,a,h){super.onBeforeRender(e,i,s,a,h),this.dispatchEvent({type:"beforeRender",renderer:e,scene:i,camera:s,geometry:a,object:h})}onAfterRender(e,i,s,a,h){super.onAfterRender(e,i,s,a,h),this.dispatchEvent({type:"afterRender",renderer:e,scene:i,camera:s,geometry:a,object:h})}toJSON(e){throw new Error("Method not supported for this material.")}fromJSON(e,i){throw new Error("Method not supported for this material.")}copyProps(e){throw new Error("Method not supported for this material.")}setDirty(e){}}class sp extends l0{constructor(e,i){super(e),this.typeSlug="shaderMat",this.textures=[],this.setTextureIds(i)}setTextureIds(e){this.textures.map(i=>i.id).join(";")!==e.join(";")&&(this.textures=e.map(i=>({id:i,encoding:b.rnI})),this.setDirty())}_setUniformTexSize(e,i){var s,a,h,d;if(!i||!e)return;const _=(a=(s=i.image)===null||s===void 0?void 0:s.width)!==null&&a!==void 0?a:512,et=(d=(h=i.image)===null||h===void 0?void 0:h.height)!==null&&d!==void 0?d:512,nt=e.value;nt.isVector2||console.warn("uniform is not a Vector2"),nt&&Math.abs(nt.x-_)+Math.abs(nt.y-et)>.1&&(nt.x=_,nt.y=et,this.uniformsNeedUpdate=!0)}onBeforeRender(e,i,s,a,h){var d,_;this._setUniformTexSize(this.uniforms.screenSize,(d=e.getRenderTarget())===null||d===void 0?void 0:d.texture);for(const et of this.textures){const nt=et.id,it=(_=this.uniforms[nt])===null||_===void 0?void 0:_.value;it&&(this._setUniformTexSize(this.uniforms[nt+"Size"],it),it.encoding!==et.encoding&&(et.encoding=it.encoding,this.needsUpdate=!0))}super.onBeforeRender(e,i,s,a,h)}onBeforeCompile(e,i){e.fragmentShader=this.textures.map(s=>{var a,h;return`uniform sampler2D ${s.id}; 
`+Er((a=s.id)!==null&&a!==void 0?a:"input",(h=s.encoding)!==null&&h!==void 0?h:b.rnI)}).join(`
`)+e.fragmentShader,super.onBeforeCompile(e,i)}customProgramCacheKey(){return super.customProgramCacheKey()+this.textures.map(e=>e.id+e.encoding).join(";")}toJSON(e){throw new Error("Method not supported for this material.")}fromJSON(e,i){throw new Error("Method not supported for this material.")}copyProps(e){throw new Error("Method not supported for this material.")}setDirty(e){this.needsUpdate=!0,this.dispatchEvent({...e,type:"materialUpdate"})}}function s_(c,...e){const i=c.fragmentShader;return new sp({defines:Object.assign({},c.defines),uniforms:c.uniforms,vertexShader:c.vertexShader,fragmentShader:i},e)}class Tl extends an{constructor(e,...i){super(e.isMaterial?e:s_(e,...i),i.length<1?Tl.DEFAULT_TEX_ID:i[0]),this.onDirty=[],this.isShaderPass2=!0,this.enabled=!0,this.setDirty=this.setDirty.bind(this)}dispose(){var e,i,s,a;(i=(e=this.material)===null||e===void 0?void 0:e.dispose)===null||i===void 0||i.call(e),(a=(s=this.fsQuad)===null||s===void 0?void 0:s.dispose)===null||a===void 0||a.call(s),this.onDirty=[]}setDirty(){this.onDirty.forEach(e=>e())}updateShaderProperties(e){e&&(Array.isArray(e)||(e=[e]),e.forEach(i=>i==null?void 0:i.updateShaderProperties(this.material)))}render(e,i,s,a,h){this.enabled&&super.render(e,i,s,a,h)}}Tl.DEFAULT_TEX_ID="tDiffuse",function(c,e,i,s){var a,h=arguments.length,d=h<3?e:s===null?s=Object.getOwnPropertyDescriptor(e,i):s;if(typeof Reflect=="object"&&typeof Reflect.decorate=="function")d=Reflect.decorate(c,e,i,s);else for(var _=c.length-1;_>=0;_--)(a=c[_])&&(d=(h<3?a(d):h>3?a(e,i,d):a(e,i))||d);h>3&&d&&Object.defineProperty(e,i,d)}([ts("Enabled"),Fn()],Tl.prototype,"enabled",void 0);class o_ extends Et{constructor(e,i,s,a,h){super(),this.scene=e,this.camera=i,this.overrideMaterial=s,this.clearColor=a,this.clearAlpha=h!==void 0?h:0,this.clear=!0,this.clearDepth=!1,this.needsSwap=!1,this._oldClearColor=new b.Ilk}render(e,i,s,a,h,d){const _=e.autoClear;let et,nt;if(e.autoClear=!1,this.overrideMaterial!==void 0&&(nt=this.scene.overrideMaterial,this.scene.overrideMaterial=this.overrideMaterial),this.clearColor&&(e.getClearColor(this._oldClearColor),et=e.getClearAlpha(),e.setClearColor(this.clearColor,this.clearAlpha)),this.clearDepth&&e.clearDepth(),e.setRenderTarget(this.renderToScreen?null:s),d){const it=e.getContext();it.framebufferRenderbuffer(it.FRAMEBUFFER,it.DEPTH_ATTACHMENT,it.RENDERBUFFER,d)}if(this.clear&&e.clear(e.autoClearColor,e.autoClearDepth,e.autoClearStencil),e.render(this.scene,this.camera),d){const it=e.getContext();it.framebufferRenderbuffer(it.FRAMEBUFFER,it.DEPTH_ATTACHMENT,it.RENDERBUFFER,null)}this.clearColor&&e.setClearColor(this._oldClearColor,et),this.overrideMaterial!==void 0&&(this.scene.overrideMaterial=nt),e.autoClear=_}}class x1 extends Tl{constructor(e,i="c = a + b;",s="",a){super({vertexShader:yt.vertexShader,fragmentShader:Qt`
                varying vec2 vUv;
                
                ${s}
                
                void blend(in vec4 a, in vec4 b, inout vec4 c){
                
                ${i}
                
                }
                void main() {
                    vec4 texel = vec4(0);
                    blend(tDiffuseTexelToLinear ( texture2D( tDiffuse, vUv ) ), tDiffuse2TexelToLinear ( texture2D( tDiffuse2, vUv ) ), texel);
                    texel = clamp(texel, vec4(0), vec4(8));
                    gl_FragColor = texel;
                    #include <encodings_fragment>
                }
            `,uniforms:{tDiffuse:{value:null},tDiffuse2:{value:a},...e}},"tDiffuse","tDiffuse2"),this.clear=!1,this.needsSwap=!0}}class BS extends b.jyz{constructor(e=!0){super({vertexShader:`#ifdef USE_ALPHAMAP
#define USE_UV 
#endif
#include <uv_pars_vertex>
#include <normal_pars_vertex>
#include <morphtarget_pars_vertex>
#include <skinning_pars_vertex>
#include <logdepthbuf_pars_vertex>
#include <clipping_planes_pars_vertex>
out vec3 vViewPosition;void main(){
#include <uv_vertex>
#include <beginnormal_vertex>
#include <morphnormal_vertex>
#include <skinbase_vertex>
#include <skinnormal_vertex>
#include <defaultnormal_vertex>
#include <normal_vertex>
#include <begin_vertex>
#include <morphtarget_vertex>
#include <skinning_vertex>
#include <displacementmap_vertex>
#include <project_vertex>
#include <logdepthbuf_vertex>
#include <clipping_planes_vertex>
vViewPosition=-mvPosition.xyz;}`,fragmentShader:`#ifdef USE_ALPHAMAP
#define USE_UV 
#include <packing>
uniform float alphaTest;
#endif
#ifndef gl_FragColor 
layout(location=0)out vec4 A;layout(location=1)out vec4 B;
#endif
#include <uv_pars_fragment>
#include <normal_pars_fragment>
#include <alphamap_pars_fragment>
uniform vec2 cameraNearFar;uniform vec4 flags;in vec3 vViewPosition;vec2 pack16(float value){float sMax=65535.;int v=int(clamp(value,0.,1.)*sMax+0.5);int digit0=v/256;int digit1=v-digit0*256;return vec2(float(digit0)/255.,float(digit1)/255.);}vec2 packNormal(vec3 n){float p=sqrt(n.z*8.+8.);return vec2(n.xy/p+0.5);}float linstep(float edge0,float edge1,float value){return clamp((value-edge0)/(edge1-edge0),0.,1.);}void main(){
#ifdef USE_ALPHAMAP
#ifdef ALPHA_I_RGBA_PACKING
if(1.-unpackRGBAToDepth(texture2D(alphaMap,vUv))<alphaTest)
#else
if(texture2D(alphaMap,vUv).g<alphaTest)
#endif
discard;
#endif
#include <normal_fragment_begin>
#ifdef FORCED_LINEAR_DEPTH
float linearZ=float(FORCED_LINEAR_DEPTH);
#else
float linearZ=linstep(-cameraNearFar.x,-cameraNearFar.y,-vViewPosition.z);
#endif
vec2 packedZ=pack16(pow(linearZ,0.5));vec2 packedNormal=packNormal(normal);
#ifndef gl_FragColor 
A=vec4(packedZ.x,packedZ.y,packedNormal.x,packedNormal.y);B=flags;
#else
gl_FragColor=vec4(packedZ.x,packedZ.y,packedNormal.x,packedNormal.y);
#endif
}`,uniforms:{cameraNearFar:{value:new b.FM8(.1,1e3)},alphaMap:{value:null},alphaTest:{value:null},flags:{value:new b.Ltg(1,1,1,1)}},glslVersion:e?b.LSk:b.v9Y}),this._updaters=[]}onBeforeRender(e,i,s,a,h){var d,_,et;let nt=h.material;Array.isArray(nt)&&(nt=nt[0]),this.uniforms.alphaMap.value=(d=nt==null?void 0:nt.alphaMap)!==null&&d!==void 0?d:null,this.uniforms.alphaTest.value=!nt||!nt.alphaTest||nt.alphaTest<1e-7?.001:nt.alphaTest,this.uniforms.flags.value.z=(nt!=null&&nt.userData.matId?nt==null?void 0:nt.userData.matId:0)/255,this._updaters.forEach(lt=>{lt(h,this.uniforms.flags.value)}),this.uniforms.flags.value.y/=255,this.uniforms.flags.value.w/=255,this.uniformsNeedUpdate=!0;let it=this.uniforms.alphaMap.value?1:void 0;it!==this.defines.USE_ALPHAMAP&&(it===void 0?delete this.defines.USE_ALPHAMAP:this.defines.USE_ALPHAMAP=it,this.needsUpdate=!0),it=nt.userData.ALPHA_I_RGBA_PACKING?1:void 0,it!==this.defines.ALPHA_I_RGBA_PACKING&&(it===void 0?delete this.defines.ALPHA_I_RGBA_PACKING:this.defines.ALPHA_I_RGBA_PACKING=it,this.needsUpdate=!0),it=(_=nt.userData.forcedLinearDepth)!==null&&_!==void 0?_:void 0,it!==this.defines.FORCED_LINEAR_DEPTH&&(it===void 0?delete this.defines.FORCED_LINEAR_DEPTH:this.defines.FORCED_LINEAR_DEPTH=it,this.needsUpdate=!0),this.side=(et=nt.side)!==null&&et!==void 0?et:b.ehD}addGBufferUpdater(e){this._updaters.push(e)}removeGBufferUpdater(e){}}var Fp=`#ifndef UNPACK_GBUFFER_SNIPPET
#define UNPACK_GBUFFER_SNIPPET 
uniform sampler2D tNormalDepth;float unpack16(vec2 value){return(value.x*0.996108949416342426275150501169264316558837890625+value.y*0.00389105058365758760263730664519243873655796051025390625);}vec3 unpackNormal(vec2 enc){vec2 fenc=enc*4.-2.;float f=dot(fenc,fenc);float g=sqrt(1.-f/4.);return vec3(fenc*g,1.-f/2.);}float unpackDepth(vec2 uncodedDepth){float x=unpack16(uncodedDepth.xy);return x*x;}float getDepth(vec2 uv){vec4 uncodedDepth=texture2D(tNormalDepth,uv);return unpackDepth(uncodedDepth.xy);}void getDepthNormal(const in vec2 uv,out float depth,out vec3 normal){vec4 uncodedDepth=texture2D(tNormalDepth,uv);depth=unpackDepth(uncodedDepth.xy);normal=unpackNormal(uncodedDepth.zw);}vec3 getViewNormal(const in vec2 uv){return unpackNormal(texture2D(tNormalDepth,uv).zw);}
#if defined(GBUFFER_HAS_FLAGS) && GBUFFER_HAS_FLAGS == 1
uniform sampler2D tGBufferFlags;
#endif
vec4 getGBufferFlags(const in vec2 uv){
#if defined(GBUFFER_HAS_FLAGS) && GBUFFER_HAS_FLAGS == 1
return texture2D(tGBufferFlags,uv);
#else
return vec4(1.);
#endif
}
#endif
`;const Fw={name:"",fog:!0,blending:b.bdR,side:b.Wl3,vertexColors:!1,opacity:1,transparent:!1,blendSrc:b.k74,blendDst:b.LgZ,blendEquation:b.bGH,blendSrcAlpha:null,blendDstAlpha:null,blendEquationAlpha:null,depthFunc:b.vCF,depthTest:!0,depthWrite:!0,stencilWriteMask:255,stencilFunc:b.cum,stencilRef:0,stencilFuncMask:255,stencilFail:b.x5V,stencilZFail:b.x5V,stencilZPass:b.x5V,stencilWrite:!1,clippingPlanes:null,clipIntersection:!1,clipShadows:!1,shadowSide:null,colorWrite:!0,precision:null,polygonOffset:!1,polygonOffsetFactor:0,polygonOffsetUnits:0,dithering:!1,alphaTest:0,alphaToCoverage:!1,premultipliedAlpha:!1,visible:!0,toneMapped:!0,userData:{},wireframeLinecap:"round",wireframeLinejoin:"round"};function Ho(c,e,i,{replaceAll:s=!1,prepend:a=!1,append:h=!1}={}){if(!c.includes(e))return console.error(`${e} not found in shader`),c;let d=i;return a?d=i+e:h&&(d=e+i),s?c.replaceAll(e,d):c.replace(e,d)}const c0={...Fw,color:"#000000",roughness:0,metalness:0,map:null,lightMap:null,lightMapIntensity:0,aoMap:null,aoMapIntensity:0,emissive:"#000000",emissiveIntensity:0,emissiveMap:null,bumpMap:null,bumpScale:0,normalMap:null,normalMapType:b.IOt,normalScale:new b.FM8(1,1),displacementMap:null,displacementScale:0,displacementBias:0,roughnessMap:null,metalnessMap:null,alphaMap:null,envMap:null,envMapIntensity:0,refractionRatio:0,wireframe:!1,wireframeLinewidth:0,skinning:!1,morphTargets:!1,morphNormals:!1,flatShading:!1,glossiness:0,glossinessMap:null,specularColor:new mo(0),specularColorMap:null},a_={...c0,clearcoat:0,clearcoatMap:null,clearcoatRoughness:0,clearcoatRoughnessMap:null,clearcoatNormalScale:new b.FM8(1,1),clearcoatNormalMap:null,reflectivity:.5,sheen:0,sheenColor:new mo(0),sheenColorMap:null,sheenRoughness:1,sheenRoughnessMap:null,specularIntensity:1,specularIntensityMap:null,specularColor:new mo(1,1,1),specularColorMap:null,transmission:0,transmissionMap:null,thickness:0,thicknessMap:null,attenuationDistance:0,attenuationColor:new mo(1,1,1),iridescenceMap:null,iridescenceIOR:1.3,iridescenceThicknessRange:[100,400],iridescenceThicknessMap:null};class Tu extends b.EJi{constructor(e){var i;super(e),this.typeSlug=Tu.TypeSlug,this.assetType="material",this.materialObject=this,this.isMeshStandardMaterial2=!0,this.extraUniformsToUpload={},this.setDirty=this.setDirty.bind(this),this.userData.setDirty=s=>{console.warn("userData.setDirty is deprecated. Use setDirty instead."),this.setDirty(s)},this.fog=!1,this.materialExtensions=Vs.RegisterExtensions(this,(i=e==null?void 0:e.customMaterialExtensions)!==null&&i!==void 0?i:[])}setDirty(e){var i,s;this.needsUpdate=!0,this.dispatchEvent({...e,type:"materialUpdate"}),(s=(i=this._uiConfig)===null||i===void 0?void 0:i.uiRefresh)===null||s===void 0||s.call(i,"postFrame",!0,1)}registerMaterialExtensions(e){this.materialExtensions=[...this.materialExtensions,...Vs.RegisterExtensions(this,e)]}unregisterMaterialExtensions(e){}get uiConfig(){return this._uiConfigChildren||(this._uiConfigChildren=[{type:"input",property:[this,"name"]},{type:"checkbox",property:[this,"wireframe"]},{type:"color",property:[this,"color"],limitedUi:!0},{type:"image",property:[this,"map"]},Go(this,"map"),{type:"folder",label:"Rough/Metal",limitedUi:!0,children:[{type:"slider",bounds:[0,1],property:[this,"roughness"],limitedUi:!0},{type:"slider",bounds:[0,1],property:[this,"metalness"],limitedUi:!0},{type:"image",property:[this,"roughnessMap"]},Go(this,"roughnessMap"),{type:"image",property:[this,"metalnessMap"]},Go(this,"metalnessMap")]},{type:"folder",label:"Bump/Normal",limitedUi:!0,children:[{type:"slider",bounds:[0,.2],stepSize:.001,property:[this,"bumpScale"],hidden:()=>!this.bumpMap},{type:"image",property:[this,"bumpMap"]},Go(this,"bumpMap"),{type:"image",property:[this,"normalMap"]},{type:"vec2",property:[this,"normalScale"],hidden:()=>!this.normalMap},{type:"dropdown",hidden:()=>!this.normalMap,property:[this,"normalMapType"],children:[["TangentSpace",b.IOt],["ObjectSpace",b.PA7]].map(e=>({label:e[0],value:e[1]}))},Go(this,"normalMap"),{type:"input",property:[this,"displacementScale"],hidden:()=>!this.displacementMap},{type:"image",property:[this,"displacementMap"]},Go(this,"displacementMap")]},{type:"folder",label:"Sheen",children:[{type:"slider",bounds:[0,1],property:[this,"sheen"]},{type:"color",hidden:()=>this.sheen<.001,property:[this,"sheenColor"]},{type:"image",property:[this,"sheenColorMap"]},Go(this,"sheenColorMap"),{type:"slider",bounds:[0,1],property:[this,"sheenRoughness"]},{type:"image",property:[this,"sheenRoughnessMap"]},Go(this,"sheenRoughnessMap")]},{type:"folder",label:"Clearcoat",children:[{type:"slider",bounds:[0,1],property:[this,"clearcoat"]},{type:"slider",bounds:[0,1],hidden:()=>this.clearcoat<.001,property:[this,"clearcoatRoughness"]},{type:"image",property:[this,"clearcoatMap"]},Go(this,"clearcoatMap"),{type:"slider",bounds:[0,1],property:[this,"clearcoatRoughness"]},{type:"image",property:[this,"clearcoatRoughnessMap"]},Go(this,"clearcoatRoughnessMap"),{type:"image",property:[this,"clearcoatNormalMap"]},{type:"vec2",property:[this,"clearcoatNormalScale"],hidden:()=>!this.clearcoatNormalMap},Go(this,"clearcoatNormalMap")]},{type:"folder",label:"Emission",children:[{type:"color",property:[this,"emissive"]},{type:"slider",bounds:[0,10],property:[this,"emissiveIntensity"]},{type:"image",property:[this,"emissiveMap"]},Go(this,"emissiveMap")]},{type:"folder",label:"Refraction",children:[{type:"slider",bounds:[0,1],property:[this,"reflectivity"]},{type:"slider",bounds:[0,1],property:[this,"transmission"],limitedUi:!0},{type:"slider",bounds:[0,1],stepSize:.001,property:[this,"thickness"]},{type:"image",property:[this,"transmissionMap"]},Go(this,"transmissionMap"),{type:"image",property:[this,"thicknessMap"]},Go(this,"thicknessMap")]},{type:"folder",label:"Blending",children:[{type:"slider",bounds:[0,1],property:[this,"opacity"]},{type:"checkbox",property:[this,"transparent"],onChange:this.setDirty},{type:"dropdown",property:[this,"depthFunc"],children:[["Never",b.BVF],["Always",b.Se2],["Less",b.Zr5],["LessEqual",b.vCF],["Equal",b.eD],["GreaterEqual",b.ksN],["Greater",b.w$m],["NotEqual",b.M6v]].map(e=>({label:e[0],value:e[1]}))},{type:"checkbox",property:[this,"depthTest"],onChange:this.setDirty},{type:"checkbox",property:[this,"depthWrite"],onChange:this.setDirty},{type:"slider",bounds:[0,1],property:[this,"alphaTest"]},{type:"checkbox",property:[this,"dithering"]},{type:"dropdown",label:"Blending",property:[this,"blending"],children:[["None",fu],["Normal",$a],["Additive",b.WMw],["Subtractive",ko],["Multiply",Hl]].map(e=>({label:e[0],value:e[1]}))},{type:"image",property:[this,"alphaMap"]},Go(this,"alphaMap"),{type:"checkbox",label:"Render to Depth",getValue:()=>this.userData.renderToDepth===!0,setValue:e=>{this.userData.renderToDepth=e||void 0,this.setDirty()}},{type:"checkbox",label:"Inverse AlphaMap",hidden:()=>!this.transparent,getValue:()=>this.userData.inverseAlphaMap===!0,setValue:e=>{this.userData.inverseAlphaMap=e||void 0,this.setDirty()}},{type:"checkbox",label:"Polygon Offset",property:[this,"polygonOffset"]},{type:"slider",label:"Polygon Offset Factor",bounds:[-10,10],property:[this,"polygonOffsetFactor"]},{type:"slider",label:"Polygon Offset Units",bounds:[-10,10],property:[this,"polygonOffsetUnits"]}]},{type:"folder",label:"AO/Lightmap",children:[{type:"slider",bounds:[0,2],property:[this,"aoMapIntensity"]},{type:"image",property:[this,"aoMap"]},Go(this,"aoMap"),{type:"slider",bounds:[0,2],property:[this,"lightMapIntensity"]},{type:"image",property:[this,"lightMap"]},Go(this,"lightMap")]},{type:"dropdown",label:"Side",property:[this,"side"],children:[["Front",b.Wl3],["Back",b._Li],["Double",b.ehD]].map(e=>({label:e[0],value:e[1]}))},{type:"checkbox",property:[this,"flatShading"]},{type:"input",label:"Mesh count",getValue:()=>{var e,i,s;return(s=(i=(e=this.userData)===null||e===void 0?void 0:e.__appliedMeshes)===null||i===void 0?void 0:i.size)!==null&&s!==void 0?s:0},setValue:e=>{},disabled:!0},{type:"button",label:`Download ${this.typeSlug}`,value:()=>{Do(new Blob([JSON.stringify(this.toJSON(),null,2)],{type:"application/json"}),`physical-material.${this.typeSlug}`)}}]),this._uiConfig||(this._uiConfig={type:"folder",label:"Physical Material",expanded:!0,children:this._uiConfigChildren,uuid:"MSM2_"+this.uuid,limitedUi:!0}),this._uiConfig.children=[...this._uiConfigChildren,...this.materialExtensions.map(e=>{var i;return(i=e.getUiConfig)===null||i===void 0?void 0:i.call(e,this)})].filter(e=>e),this._uiConfig}onBeforeCompile(e,i){const s=[["vec3 totalDiffuse = ","afterModulation"],["#include <aomap_fragment>","beforeModulation"],["#include <lights_physical_fragment>","beforeAccumulation"],["#include <clipping_planes_fragment>","mainStart"]],a=[["#include <uv_vertex>","mainStart"]];for(const h of a)e.vertexShader=Ho(e.vertexShader,h[0],"#glMarker "+h[1]+`
`+h[0]);for(const h of s)e.fragmentShader=Ho(e.fragmentShader,h[0],"#glMarker "+h[1]+`
`+h[0]);Vs.ApplyMaterialExtensions(this,e,this.materialExtensions,i),e.fragmentShader=e.fragmentShader.replaceAll("#glMarker","// "),e.vertexShader=e.vertexShader.replaceAll("#glMarker","// "),e.defines.INVERSE_ALPHAMAP=this.userData.inverseAlphaMap?1:0,super.onBeforeCompile(e,i)}customProgramCacheKey(){return super.customProgramCacheKey()+Vs.CacheKeyForExtensions(this,this.materialExtensions)+this.userData.inverseAlphaMap}onBeforeRender(e,i,s,a,h){super.onBeforeRender(e,i,s,a,h),this.dispatchEvent({type:"beforeRender",renderer:e,scene:i,camera:s,geometry:a,object:h});const d=this.userData.inverseAlphaMap?1:0;d!==this.defines.INVERSE_ALPHAMAP&&(this.defines.INVERSE_ALPHAMAP=d,this.needsUpdate=!0)}copyProps(e,i=!1){if(!i&&!["MeshStandardMaterial",Tu.TYPE,"MeshPhysicalMaterial"].includes(e.type))return console.error("Material type is not supported:",e.type),this;const s={};Bn(e,s,Array.from(Object.keys(a_)));const a=s.userData;delete s.userData;for(const h of Object.keys(s))s[h]===void 0&&delete s[h];return this.setValues(s),a&&Gu(this.userData,a),this.setDirty(),this}toJSON(e){var i,s;const a=this.userData;this.userData={};const h=super.toJSON(e);this.userData=a,h.userData={},Gu(h.userData,a),h.userData.uuid=this.userData.uuid;const d=e||{textures:Object.fromEntries(((i=h.textures)===null||i===void 0?void 0:i.map(_=>[_.uuid,_]))||[]),images:Object.fromEntries(((s=h.images)===null||s===void 0?void 0:s.map(_=>[_.uuid,_]))||[])};h.userData=ao(h.userData,!1,d),e||(Object.keys(d.textures).length>0&&(h.textures=Object.values(d.textures)),Object.keys(d.images).length>0&&(h.images=Object.values(d.images))),h.type=Tu.TYPE;for(const _ of Object.keys(h))h[_]===void 0&&delete h[_];return h}fromJSON(e,i,s=!1){return Array.isArray(e.normalScale)&&(e.normalScale=new b.FM8().fromArray(e.normalScale)),Array.isArray(e.clearcoatNormalScale)&&(e.clearcoatNormalScale=new b.FM8().fromArray(e.clearcoatNormalScale)),this.copyProps(e,s)}clone(){return super.clone()}}Tu.TypeSlug="pmat",Tu.TYPE="MeshStandardMaterial2";const jp={...Fw,color:"#000000",map:null,lightMap:null,lightMapIntensity:1,aoMap:null,aoMapIntensity:1,alphaMap:null,envMap:null,combine:b.Ns1,reflectivity:1,refractionRatio:.98,wireframe:!1,wireframeLinewidth:0,skinning:!1};class Iu extends b.vBJ{constructor(e){var i;super(e),this.typeSlug=Iu.TypeSlug,this.assetType="material",this.materialObject=this,this.isMeshBasicMaterial2=!0,this.extraUniformsToUpload={},this.fog=!1,this.setDirty=this.setDirty.bind(this),this.userData.setDirty=s=>{console.warn("userData.setDirty is deprecated. Use setDirty instead."),this.setDirty(s)},this.materialExtensions=Vs.RegisterExtensions(this,(i=e==null?void 0:e.customMaterialExtensions)!==null&&i!==void 0?i:[])}setDirty(e){var i,s;this.needsUpdate=!0,this.dispatchEvent({...e,type:"materialUpdate"}),(s=(i=this._uiConfig)===null||i===void 0?void 0:i.uiRefresh)===null||s===void 0||s.call(i,"postFrame",!0,1)}registerMaterialExtensions(e){this.materialExtensions=[...this.materialExtensions,...Vs.RegisterExtensions(this,e)]}unregisterMaterialExtensions(e){}get uiConfig(){return this._uiConfigChildren||(this._uiConfigChildren=[{type:"input",property:[this,"name"]},{type:"checkbox",property:[this,"wireframe"]},{type:"color",property:[this,"color"],limitedUi:!0},{type:"image",property:[this,"map"]},Go(this,"map"),{type:"folder",label:"Blending",children:[{type:"slider",bounds:[0,1],property:[this,"opacity"]},{type:"checkbox",property:[this,"transparent"],onChange:this.setDirty},{type:"checkbox",property:[this,"depthWrite"],onChange:this.setDirty},{type:"slider",bounds:[0,1],property:[this,"alphaTest"]},{type:"checkbox",property:[this,"dithering"]},{type:"dropdown",label:"Blending",property:[this,"blending"],children:[["None",fu],["Normal",$a],["Additive",b.WMw],["Subtractive",ko],["Multiply",Hl]].map(e=>({label:e[0],value:e[1]}))},{type:"image",property:[this,"alphaMap"]},Go(this,"alphaMap"),{type:"checkbox",label:"Render to Depth",getValue:()=>this.userData.renderToDepth===!0,setValue:e=>{this.userData.renderToDepth=e||void 0,this.setDirty()}}]},{type:"folder",label:"AO/Lightmap",children:[{type:"slider",bounds:[0,2],property:[this,"aoMapIntensity"]},{type:"image",property:[this,"aoMap"]},Go(this,"aoMap"),{type:"slider",bounds:[0,2],property:[this,"lightMapIntensity"]},{type:"image",property:[this,"lightMap"]},Go(this,"lightMap")]},{type:"dropdown",label:"Side",property:[this,"side"],children:[["Front",b.Wl3],["Back",b._Li],["Double",b.ehD]].map(e=>({label:e[0],value:e[1]}))},{type:"input",label:"Mesh count",getValue:()=>{var e,i,s;return(s=(i=(e=this.userData)===null||e===void 0?void 0:e.__appliedMeshes)===null||i===void 0?void 0:i.size)!==null&&s!==void 0?s:0},setValue:e=>{},disabled:!0},{type:"button",label:`Download ${this.typeSlug}`,value:()=>{Do(new Blob([JSON.stringify(this.toJSON(),null,2)],{type:"application/json"}),`unlit-material.${this.typeSlug}`)}}]),this._uiConfig||(this._uiConfig={type:"folder",label:"Unlit Material",expanded:!0,children:this._uiConfigChildren,uuid:"MBM2_"+this.uuid,limitedUi:!0}),this._uiConfig.children=[...this._uiConfigChildren,...this.materialExtensions.map(e=>{var i;return(i=e.getUiConfig)===null||i===void 0?void 0:i.call(e,this)})].filter(e=>e),this._uiConfig}onBeforeCompile(e,i){const s=[["vec3 outgoingLight = ","afterModulation"],["#include <aomap_fragment>","beforeModulation"],["ReflectedLight reflectedLight = ","beforeAccumulation"],["#include <clipping_planes_fragment>","mainStart"]],a=[["#include <uv_vertex>","mainStart"]];for(const h of a)e.vertexShader=Ho(e.vertexShader,h[0],"#glMarker "+h[1]+`
`+h[0]);for(const h of s)e.fragmentShader=Ho(e.fragmentShader,h[0],"#glMarker "+h[1]+`
`+h[0]);Vs.ApplyMaterialExtensions(this,e,this.materialExtensions,i),e.fragmentShader=e.fragmentShader.replaceAll("#glMarker","// "),e.vertexShader=e.vertexShader.replaceAll("#glMarker","// "),super.onBeforeCompile(e,i)}customProgramCacheKey(){return super.customProgramCacheKey()+Vs.CacheKeyForExtensions(this,this.materialExtensions)+this.userData.inverseAlphaMap}onBeforeRender(e,i,s,a,h){super.onBeforeRender(e,i,s,a,h),this.dispatchEvent({type:"beforeRender",renderer:e,scene:i,camera:s,geometry:a,object:h})}copyProps(e,i=!1){if(!i&&!["MeshBasicMaterial",Iu.TYPE].includes(e.type))return console.error("Material type is not supported:",e.type),this;const s={};Bn(e,s,Array.from(Object.keys(jp)));const a=s.userData;delete s.userData;for(const h of Object.keys(s))s[h]===void 0&&delete s[h];return this.setValues(s),a&&Gu(this.userData,a),this.setDirty(),this}toJSON(e){var i,s;const a=this.userData;this.userData={};const h=super.toJSON(e);this.userData=a,h.userData={},Gu(h.userData,a),h.userData.uuid=this.userData.uuid;const d=e||{textures:Object.fromEntries(((i=h.textures)===null||i===void 0?void 0:i.map(_=>[_.uuid,_]))||[]),images:Object.fromEntries(((s=h.images)===null||s===void 0?void 0:s.map(_=>[_.uuid,_]))||[])};h.userData=ao(h.userData,!1,d),e||(Object.keys(d.textures).length>0&&(h.textures=Object.values(d.textures)),Object.keys(d.images).length>0&&(h.images=Object.values(d.images))),h.type=Iu.TYPE;for(const _ of Object.keys(h))h[_]===void 0&&delete h[_];return h}fromJSON(e,i,s=!1){return this.copyProps(e,s)}clone(){return super.clone()}}Iu.TypeSlug="bmat",Iu.TYPE="MeshBasicMaterial2";const l_={materialType:Tu.TYPE,name:"standard",color:"#ffffff"},sA={materialType:Iu.TYPE,name:"basic",color:"#ffffff"},Ey={[Tu.TYPE]:l_.name,MeshStandardMaterial:l_.name,MeshPhysicalMaterial:l_.name,[Iu.TYPE]:sA.name,MeshBasicMaterial:sA.name};class u0 extends ot{constructor(){super(),this._templates=[l_,sA],this._materials=[],this._disposeMaterial=e=>{const i=e.target;if(!i||i.assetType!=="material")return;this._refreshTextureRefs();const s=this._getMapsForMaterial(i),a=[];s.forEach(h=>{const d=h.userData.__appliedMaterials;d==null||d.delete(i),d&&h.userData.disposeOnIdle!==!1&&d.size===0&&a.push(h)}),a.forEach(h=>{h.dispose()}),this.unregisterMaterial(i)},this._materialExtensions=[],this.processModel=this.processModel.bind(this),this.processMaterial=this.processMaterial.bind(this)}findOrCreate(e,i){let s=this.findMaterial(e);return s||(s=this.generateFromTemplate(e,i)),s}generateFromTemplate(e,i){const s=this.findTemplate(e);if(s)return this._generateFromTemplate(s,i??{})}generateFromTemplateType(e,i){const s=this._templates.find(a=>a.materialType===e);if(s)return this._generateFromTemplate(s,i??{})}findTemplate(e){return this._templates.find(i=>i.name===e)}_refreshTextureRefs(){this.getAllMaterials().forEach(e=>{this._getMapsForMaterial(e).forEach(i=>{let s=i.userData.__appliedMaterials;s||(i.userData.__appliedMaterials=s=new Set),s.add(e)})})}_getMapsForMaterial(e){var i;const s=new Set;for(const a of Object.values(e))a&&a.isTexture&&s.add(a);for(const a of Object.values((i=e.userData)!==null&&i!==void 0?i:{}))a&&a.isTexture&&s.add(a);return s}registerMaterial(e){if(this._materials.includes(e))return;const i=this.findMaterial(e.uuid);i?console.warn("Material UUID already exists",e,i):(e.addEventListener("dispose",this._disposeMaterial),this._materials.push(e))}registerMaterialObject(e){const i=e.materialObject?e:Object.assign(e,{assetType:"material",materialObject:e});return this.registerMaterial(i),i}unregisterMaterial(e){this._materials=this._materials.filter(i=>i.uuid!==e.uuid),e.removeEventListener("dispose",this._disposeMaterial)}registerMaterialTemplate(e){e.templateUUID||(e.templateUUID=gu());const i=this._templates.find(s=>s.templateUUID===e.templateUUID);i?console.warn("MaterialTemplate already exists",e,i):this._templates.push(e)}unregisterMaterialTemplate(e){this._templates=this._templates.filter(i=>i.templateUUID!==e.templateUUID)}dispose(){}findMaterial(e){return e?this._materials.find(i=>i.uuid===e):void 0}findMaterialsByName(e){return this._materials.filter(i=>i.name===e)}getMaterialsOfType(e){return e?this._materials.filter(i=>i.typeSlug===e):[]}getAllMaterials(){return[...this._materials]}processModel(e,i){return bn(e,"modelObject",this._processModel(e,i)),e}_processMaterial(e,i){var s,a,h;if(!e)return;if(!((s=e.materialObject)===null||s===void 0)&&s.isMaterial)return e;let d=e.mmMaterial;if(!d){const _=((a=e.userData)===null||a===void 0?void 0:a.uuid)||e.uuid;if(d=this.findMaterial(_),d)d.copyProps(e);else{const et=i.useSourceMaterial===!1||!e.isMaterial,nt=(h=i.materialTemplate)!==null&&h!==void 0?h:et?"standard":Ey[e.type]||"standard";d=this.generateFromTemplate(nt,et?{}:e)}e.mmMaterial=d}return d}processMaterial(e,i){return i.register!==!1&&this.registerMaterial(e),e.materialObject||(e=this._processMaterial(e,{...i,register:!1})),e}registerMaterialExtension(e){this._materialExtensions.includes(e)||this._materialExtensions.push(e)}unregisterMaterialExtension(e){const i=this._materialExtensions.indexOf(e);i>=0&&this._materialExtensions.splice(i,1)}exportMaterial(e,i,s=!0,a=!1){const h=ao(e,!1),d=JSON.stringify(h,null,s?0:2),_=(i||e.name||"physical_material")+"."+e.typeSlug,et=new File([d],_,{type:"application/json"});return a&&Nm(et),et}}class h0 extends u0{_generateFromTemplate(e,i){var s,a,h,d,_,et;let nt;const it={...e};it.customMaterialExtensions=[...(s=it.customMaterialExtensions)!==null&&s!==void 0?s:[],...this._materialExtensions];let lt={};switch(e.materialType){case"MeshStandardMaterial2":case"standard":i&&Bn(i,it,Array.from(Object.keys(a_))),(i==null?void 0:i.type)==="MeshBasicMaterial"&&(it.roughness=.9,it.metalness=0,!((a=it.userData)===null||a===void 0)&&a.uuid&&delete it.userData.uuid),lt=(h=it.userData)===null||h===void 0?void 0:h.uuid,lt&&delete it.userData.uuid,nt=new Tu({customMaterialExtensions:it.customMaterialExtensions}).fromJSON(it,void 0,!0),lt&&(nt.uuid=lt),nt.userData.uuid=nt.uuid,nt.setDirty(),i!=null&&i.isMaterial&&i.userData!==void 0&&(i.userData.iMaterial=nt);break;case"MeshBasicMaterial2":case"basic":case"unlit":i&&Bn(i,it,Array.from(Object.keys(jp))),lt=(d=it.userData)===null||d===void 0?void 0:d.uuid,lt&&delete it.userData.uuid,nt=new Iu({customMaterialExtensions:it.customMaterialExtensions}).fromJSON(it,void 0,!0),lt&&(nt.uuid=lt),nt.userData.uuid=nt.uuid,nt.setDirty();break;case"shadow":throw"TODO: Not implemented shadow material";default:lt=null,i&&i.userData&&(lt=i.userData,delete i.userData),nt=((_=e.generator)===null||_===void 0?void 0:_.call(e,it,i))||void 0,i&&lt&&(i.userData=lt),lt&&nt&&(Gu(nt.userData,lt),lt!=null&&lt.uuid&&(nt.uuid=lt.uuid),lt=null),nt&&(nt.userData.uuid=nt.uuid)}if(nt){i.runtimeMaterial&&(nt.userData.__runtimeMaterial=!0);const ut=nt;if(nt.clone=()=>{ut.userData.cloneId||(ut.userData.cloneId="0",ut.userData.cloneCount=0),ut.userData.cloneCount+=1;const pt=this.generateFromTemplate(e.name);return pt&&(pt.copyProps(ut),pt.userData.cloneId=pt.userData.cloneId+"_"+ut.userData.cloneCount,pt.userData.cloneCount=0,pt.name=pt.name+"_"+pt.userData.cloneId),pt==null?void 0:pt.materialObject},i){let pt=this.findMaterial(i==null?void 0:i.uuid);pt&&this.unregisterMaterial(pt),pt=this.findMaterial((et=i==null?void 0:i.materialObject)===null||et===void 0?void 0:et.uuid),pt&&this.unregisterMaterial(pt)}return this.registerMaterialObject(ut)}}_processModel(e,i){if(!e.modelObject)return console.error("MaterialManager: No modelObject found for ",e),e;let s=e.material;if(!s&&e.geometry&&(this._defaultMaterial||(this._defaultMaterial=this.generateFromTemplate("standard")),s=this._defaultMaterial,e.material=s),s){let a=!0;Array.isArray(s)||(s=[s],a=!1);const h=[];for(const d of s){const _=this._processMaterial(d,i);h.push(_==null?void 0:_.materialObject)}e.setMaterial&&(e.modelObject.material=null,e.setMaterial(a?h:h[0]))}if(i.recursive!==!1)for(let a=0;a<e.modelObject.children.length;a++)e.modelObject.children[a]=this._processModel(e.modelObject.children[a],i);return e}}class Wo{constructor(e,i,s,a){this.cls=e,this.ext=i,this.root=s,this.onCtor=a}ctor(e){const i=this.cls&&new this.cls(e.loadingManager);return typeof this.onCtor=="function"?this.onCtor(i,e):i}}function b1(c){var e;if(!c||c===""||c.match(/__MACOSX\/.*\._/))return"";const i=(e=(c=c.replace(/\?.*$/,"")).split(/[\\/]/).pop())!==null&&e!==void 0?e:"",s=i.lastIndexOf(".");return i===""||s<1?"":i.slice(s+1)}function kS(c){return c.substring(c.lastIndexOf("/")+1)}class Sy{constructor(e,{pseudoCenter:i=!1,autoCenter:s=!1,autoScale:a=!1,autoScaleRadius:h=2,license:d=""}={}){if(this.assetType="model",this._modelObject=Ap(new b.Tme),this.setDirty=this.setDirty.bind(this),this.updateBounds=this.updateBounds.bind(this),e||(e=this._modelObject),!i||e.userData.pseudoCentered||e.userData.isCentered)!s||e.userData.autoCentered||e.userData.isCentered||e.userData.pseudoCentered?i||s||(e.userData.isCentered=!0):Cs(e),this._modelObject=e;else{s&&console.error("cannot use pseudoCenter and autoCenter at the same time");const _=new Dr().expandByObject(e,!0,!0).getCenter(new b.Pa4);this._modelObject.position.copy(_).negate(),this._modelObject.updateMatrix(),this._modelObject.add(e),this._modelObject.name=e.name+"-centered",this._modelObject.userData.pseudoCentered=!0,this._modelObject.userData.isCentered=!0,e.userData.iModel=this}a&&!this._modelObject.userData.autoScaled?Gs(this._modelObject,e.userData.autoScaleRadius||h):this._modelObject.userData.autoScaled=!0,this._modelObject.addEventListener("dispose",()=>{this.__disposed=!0}),this._modelObject.userData.iModel=this,this.license=d}get visible(){return this._modelObject.visible}set visible(e){this._modelObject.visible=e}get uuid(){return this._modelObject.uuid}get modelObject(){return this._modelObject}get name(){return this._modelObject.name}set name(e){this._modelObject.name=e}get license(){return this._modelObject.userData.license}set license(e){this._modelObject.userData.license=e}addEventListener(e,i){this._modelObject.addEventListener(e,i)}dispatchEvent(e){this._modelObject.dispatchEvent(e)}hasEventListener(e,i){return this._modelObject.hasEventListener(e,i)}removeEventListener(e,i){this._modelObject.removeEventListener(e,i)}traverse(e){this._modelObject.traverse(e)}dispose(){const e=this._modelObject.dispose;e&&typeof e=="function"?e():(console.warn("no dispose in modelObject"),this._modelObject.removeFromParent())}setDirty(e){var i,s,a,h;(s=(i=this._modelObject)===null||i===void 0?void 0:i.setDirty)===null||s===void 0||s.call(i,e),(h=(a=this._uiConfig)===null||a===void 0?void 0:a.uiRefresh)===null||h===void 0||h.call(a,"postFrame",!0)}setMaterial(e){var i,s;return this._modelObject.isMesh?((s=(i=this._modelObject).setMaterial)===null||s===void 0?void 0:s.call(i,e))||[]:(console.error("setMaterial only works on meshes"),[])}get material(){return this._modelObject.material}get geometry(){return this._modelObject.geometry}setGeometry(e,i=!1){var s,a;if(this._modelObject.isMesh)return(a=(s=this._modelObject).setGeometry)===null||a===void 0?void 0:a.call(s,e,i);console.error("setGeometry only works on meshes")}get userData(){return this._modelObject.userData}set userData(e){this._modelObject.userData=e}updateBounds(){console.warn("updateBounds: NOT IMPLEMENTED"),this.setDirty()}get uiConfig(){return this._uiConfig||(this._uiConfig=Hu(this._modelObject,!1)),this._uiConfig}clone(){return new Sy(this._modelObject.clone(),{pseudoCenter:!1,autoScale:!1,autoCenter:!1,license:this.license})}}function hm(c,e){return[c.modelObject,...c.modelObject.children].forEach(i=>{Ap(i,i!==c.modelObject?c:void 0,e)}),c}class c_{constructor(){this._processors=new Map}add(e,i){var s;this._processors.has(e)||this._processors.set(e,[]),(s=this._processors.get(e))===null||s===void 0||s.push(i)}remove(e,i){const s=this._processors.get(e),a=(s==null?void 0:s.indexOf(i))||(s==null?void 0:s.findIndex(h=>h.process&&h.process===i.process||h.processAsync&&h.processAsync===i.processAsync));!s||!a||a<0||s.splice(a,1)}get(e){var i;return(i=this._processors.get(e))!==null&&i!==void 0?i:[]}async process(e,i,s){var a,h,d,_;const et=this.get(e),nt=i.assetType;for(const it of et)it.forAssetType===nt&&(i=(h=(a=it.process)===null||a===void 0?void 0:a.call(it,i,s))!==null&&h!==void 0?h:i,i=(_=await((d=it.processAsync)===null||d===void 0?void 0:d.call(it,i,s)))!==null&&_!==void 0?_:i);return i}dispose(){this._processors.clear()}}class op extends b.hH6{load(e,i,s,a){return super.load(e,h=>{try{if(typeof h!="string")throw new Error("Invalid JSON");i==null||i(JSON.parse(h))}catch(d){a==null||a(d)}},s,a)}}class Il extends b.yxD{constructor(e){super(e),this.type=b.cLu}parse(e){const i=function(et,nt){switch(et){case 1:console.error("THREE.RGBELoader Read Error: "+(nt||""));break;case 2:console.error("THREE.RGBELoader Write Error: "+(nt||""));break;case 3:console.error("THREE.RGBELoader Bad File Format: "+(nt||""));break;default:console.error("THREE.RGBELoader: Error: "+(nt||""))}return-1},s=function(et,nt,it){nt=nt||1024;let lt=et.pos,ut=-1,pt=0,gt="",vt=String.fromCharCode.apply(null,new Uint16Array(et.subarray(lt,lt+128)));for(;0>(ut=vt.indexOf(`
`))&&pt<nt&&lt<et.byteLength;)gt+=vt,pt+=vt.length,lt+=128,vt+=String.fromCharCode.apply(null,new Uint16Array(et.subarray(lt,lt+128)));return-1<ut&&(it!==!1&&(et.pos+=pt+ut+1),gt+vt.slice(0,ut))},a=function(et,nt,it,lt){const ut=et[nt+3],pt=Math.pow(2,ut-128)/255;it[lt+0]=et[nt+0]*pt,it[lt+1]=et[nt+1]*pt,it[lt+2]=et[nt+2]*pt,it[lt+3]=1},h=function(et,nt,it,lt){const ut=et[nt+3],pt=Math.pow(2,ut-128)/255;it[lt+0]=b.A5E.toHalfFloat(Math.min(et[nt+0]*pt,65504)),it[lt+1]=b.A5E.toHalfFloat(Math.min(et[nt+1]*pt,65504)),it[lt+2]=b.A5E.toHalfFloat(Math.min(et[nt+2]*pt,65504)),it[lt+3]=b.A5E.toHalfFloat(1)},d=new Uint8Array(e);d.pos=0;const _=function(et){const nt=/^\s*GAMMA\s*=\s*(\d+(\.\d+)?)\s*$/,it=/^\s*EXPOSURE\s*=\s*(\d+(\.\d+)?)\s*$/,lt=/^\s*FORMAT=(\S+)\s*$/,ut=/^\s*\-Y\s+(\d+)\s+\+X\s+(\d+)\s*$/,pt={valid:0,string:"",comments:"",programtype:"RGBE",format:"",gamma:1,exposure:1,width:0,height:0};let gt,vt;if(et.pos>=et.byteLength||!(gt=s(et)))return i(1,"no header found");if(!(vt=gt.match(/^#\?(\S+)/)))return i(3,"bad initial token");for(pt.valid|=1,pt.programtype=vt[1],pt.string+=gt+`
`;gt=s(et),gt!==!1;)if(pt.string+=gt+`
`,gt.charAt(0)!=="#"){if((vt=gt.match(nt))&&(pt.gamma=parseFloat(vt[1])),(vt=gt.match(it))&&(pt.exposure=parseFloat(vt[1])),(vt=gt.match(lt))&&(pt.valid|=2,pt.format=vt[1]),(vt=gt.match(ut))&&(pt.valid|=4,pt.height=parseInt(vt[1],10),pt.width=parseInt(vt[2],10)),2&pt.valid&&4&pt.valid)break}else pt.comments+=gt+`
`;return 2&pt.valid?4&pt.valid?pt:i(3,"missing image size specifier"):i(3,"missing format specifier")}(d);if(_!==-1){const et=_.width,nt=_.height,it=function(lt,ut,pt){const gt=ut;if(gt<8||gt>32767||lt[0]!==2||lt[1]!==2||128&lt[2])return new Uint8Array(lt);if(gt!==(lt[2]<<8|lt[3]))return i(3,"wrong scanline width");const vt=new Uint8Array(4*ut*pt);if(!vt.length)return i(4,"unable to allocate buffer space");let Ct=0,wt=0;const xt=4*gt,_t=new Uint8Array(4),Pt=new Uint8Array(xt);let Bt=pt;for(;Bt>0&&wt<lt.byteLength;){if(wt+4>lt.byteLength)return i(1);if(_t[0]=lt[wt++],_t[1]=lt[wt++],_t[2]=lt[wt++],_t[3]=lt[wt++],_t[0]!=2||_t[1]!=2||(_t[2]<<8|_t[3])!=gt)return i(3,"bad rgbe scanline format");let Ot,Lt=0;for(;Lt<xt&&wt<lt.byteLength;){Ot=lt[wt++];const en=Ot>128;if(en&&(Ot-=128),Ot===0||Lt+Ot>xt)return i(3,"bad scanline data");if(en){const cn=lt[wt++];for(let An=0;An<Ot;An++)Pt[Lt++]=cn}else Pt.set(lt.subarray(wt,wt+Ot),Lt),Lt+=Ot,wt+=Ot}const qt=gt;for(let en=0;en<qt;en++){let cn=0;vt[Ct]=Pt[en+cn],cn+=gt,vt[Ct+1]=Pt[en+cn],cn+=gt,vt[Ct+2]=Pt[en+cn],cn+=gt,vt[Ct+3]=Pt[en+cn],Ct+=4}Bt--}return vt}(d.subarray(d.pos),et,nt);if(it!==-1){let lt,ut,pt;switch(this.type){case b.VzW:pt=it.length/4;const gt=new Float32Array(4*pt);for(let Ct=0;Ct<pt;Ct++)a(it,4*Ct,gt,4*Ct);lt=gt,ut=b.VzW;break;case b.cLu:pt=it.length/4;const vt=new Uint16Array(4*pt);for(let Ct=0;Ct<pt;Ct++)h(it,4*Ct,vt,4*Ct);lt=vt,ut=b.cLu;break;default:console.error("THREE.RGBELoader: unsupported type: ",this.type)}return{width:et,height:nt,data:lt,header:_.string,gamma:_.gamma,exposure:_.exposure,type:ut}}}return null}setDataType(e){return this.type=e,this}load(e,i,s,a){return super.load(e,function(h,d){switch(h.type){case b.VzW:case b.cLu:h.encoding=b.rnI,h.minFilter=b.wem,h.magFilter=b.wem,h.generateMipmaps=!1,h.flipY=!0}i&&i(h,d)},s,a)}}function Cy(c){io.Importers.push(new Wo(class extends Il{constructor(e){super(e),this.setDataType(WS(c))}},["hdr"],!1))}class d0 extends b.aNw{constructor(e){super(e),this.dracoLoader=null,this.ktx2Loader=null,this.meshoptDecoder=null,this.pluginCallbacks=[],this.register(function(i){return new lA(i)}),this.register(function(i){return new nu(i)}),this.register(function(i){return new E1(i)}),this.register(function(i){return new Du(i)}),this.register(function(i){return new Um(i)}),this.register(function(i){return new Po(i)}),this.register(function(i){return new jw(i)}),this.register(function(i){return new aA(i)}),this.register(function(i){return new Sr(i)}),this.register(function(i){return new Tv(i)}),this.register(function(i){return new As(i)}),this.register(function(i){return new OS(i)})}load(e,i,s,a){const h=this;let d;d=this.resourcePath!==""?this.resourcePath:this.path!==""?this.path:b.Zp0.extractUrlBase(e),this.manager.itemStart(e);const _=function(nt){a?a(nt):console.error(nt),h.manager.itemError(e),h.manager.itemEnd(e)},et=new b.hH6(this.manager);et.setPath(this.path),et.setResponseType("arraybuffer"),et.setRequestHeader(this.requestHeader),et.setWithCredentials(this.withCredentials),et.load(e,function(nt){try{h.parse(nt,d,function(it){i(it),h.manager.itemEnd(e)},_)}catch(it){_(it)}},s,_)}setDRACOLoader(e){return this.dracoLoader=e,this}setDDSLoader(){throw new Error('THREE.GLTFLoader: "MSFT_texture_dds" no longer supported. Please update to "KHR_texture_basisu".')}setKTX2Loader(e){return this.ktx2Loader=e,this}setMeshoptDecoder(e){return this.meshoptDecoder=e,this}register(e){return this.pluginCallbacks.indexOf(e)===-1&&this.pluginCallbacks.push(e),this}unregister(e){return this.pluginCallbacks.indexOf(e)!==-1&&this.pluginCallbacks.splice(this.pluginCallbacks.indexOf(e),1),this}parse(e,i,s,a){let h;const d={},_={};if(typeof e=="string")h=e;else if(b.Zp0.decodeText(new Uint8Array(e,0,4))===Iv){try{d[Es.KHR_BINARY_GLTF]=new p0(e)}catch(it){return void(a&&a(it))}h=d[Es.KHR_BINARY_GLTF].content}else h=b.Zp0.decodeText(new Uint8Array(e));const et=JSON.parse(h);if(et.asset===void 0||et.asset.version[0]<2)return void(a&&a(new Error("THREE.GLTFLoader: Unsupported asset. glTF versions >=2.0 are supported.")));const nt=new d_(et,{path:i||this.resourcePath||"",crossOrigin:this.crossOrigin,requestHeader:this.requestHeader,manager:this.manager,ktx2Loader:this.ktx2Loader,meshoptDecoder:this.meshoptDecoder});nt.fileLoader.setRequestHeader(this.requestHeader);for(let it=0;it<this.pluginCallbacks.length;it++){const lt=this.pluginCallbacks[it](nt);_[lt.name]=lt,d[lt.name]=!0}if(et.extensionsUsed)for(let it=0;it<et.extensionsUsed.length;++it){const lt=et.extensionsUsed[it],ut=et.extensionsRequired||[];switch(lt){case Es.KHR_MATERIALS_UNLIT:d[lt]=new dm;break;case Es.KHR_MATERIALS_PBR_SPECULAR_GLOSSINESS:d[lt]=new bp;break;case Es.KHR_DRACO_MESH_COMPRESSION:d[lt]=new pm(et,this.dracoLoader);break;case Es.KHR_TEXTURE_TRANSFORM:d[lt]=new cA;break;case Es.KHR_MESH_QUANTIZATION:d[lt]=new zw;break;default:ut.indexOf(lt)>=0&&_[lt]===void 0&&console.warn('THREE.GLTFLoader: Unknown extension "'+lt+'".')}}nt.setExtensions(d),nt.setPlugins(_),nt.parse(s,a)}parseAsync(e,i){const s=this;return new Promise(function(a,h){s.parse(e,i,a,h)})}}function oA(){let c={};return{get:function(e){return c[e]},add:function(e,i){c[e]=i},remove:function(e){delete c[e]},removeAll:function(){c={}}}}const Es={KHR_BINARY_GLTF:"KHR_binary_glTF",KHR_DRACO_MESH_COMPRESSION:"KHR_draco_mesh_compression",KHR_LIGHTS_PUNCTUAL:"KHR_lights_punctual",KHR_MATERIALS_CLEARCOAT:"KHR_materials_clearcoat",KHR_MATERIALS_IOR:"KHR_materials_ior",KHR_MATERIALS_PBR_SPECULAR_GLOSSINESS:"KHR_materials_pbrSpecularGlossiness",KHR_MATERIALS_SHEEN:"KHR_materials_sheen",KHR_MATERIALS_SPECULAR:"KHR_materials_specular",KHR_MATERIALS_TRANSMISSION:"KHR_materials_transmission",KHR_MATERIALS_IRIDESCENCE:"KHR_materials_iridescence",KHR_MATERIALS_UNLIT:"KHR_materials_unlit",KHR_MATERIALS_VOLUME:"KHR_materials_volume",KHR_TEXTURE_BASISU:"KHR_texture_basisu",KHR_TEXTURE_TRANSFORM:"KHR_texture_transform",KHR_MESH_QUANTIZATION:"KHR_mesh_quantization",KHR_MATERIALS_EMISSIVE_STRENGTH:"KHR_materials_emissive_strength",EXT_TEXTURE_WEBP:"EXT_texture_webp",EXT_MESHOPT_COMPRESSION:"EXT_meshopt_compression"};class As{constructor(e){this.parser=e,this.name=Es.KHR_LIGHTS_PUNCTUAL,this.cache={refs:{},uses:{}}}_markDefs(){const e=this.parser,i=this.parser.json.nodes||[];for(let s=0,a=i.length;s<a;s++){const h=i[s];h.extensions&&h.extensions[this.name]&&h.extensions[this.name].light!==void 0&&e._addNodeRef(this.cache,h.extensions[this.name].light)}}_loadLight(e){const i=this.parser,s="light:"+e;let a=i.cache.get(s);if(a)return a;const h=i.json,d=((h.extensions&&h.extensions[this.name]||{}).lights||[])[e];let _;const et=new b.Ilk(16777215);d.color!==void 0&&et.fromArray(d.color);const nt=d.range!==void 0?d.range:0;switch(d.type){case"directional":_=new b.Ox3(et),_.target.position.set(0,0,-1),_.add(_.target);break;case"point":_=new b.cek(et),_.distance=nt;break;case"spot":_=new b.PMe(et),_.distance=nt,d.spot=d.spot||{},d.spot.innerConeAngle=d.spot.innerConeAngle!==void 0?d.spot.innerConeAngle:0,d.spot.outerConeAngle=d.spot.outerConeAngle!==void 0?d.spot.outerConeAngle:Math.PI/4,_.angle=d.spot.outerConeAngle,_.penumbra=1-d.spot.innerConeAngle/d.spot.outerConeAngle,_.target.position.set(0,0,-1),_.add(_.target);break;default:throw new Error("THREE.GLTFLoader: Unexpected light type: "+d.type)}return _.position.set(0,0,0),_.decay=2,d.intensity!==void 0&&(_.intensity=d.intensity),_.name=i.createUniqueName(d.name||"light_"+e),a=Promise.resolve(_),i.cache.add(s,a),a}createNodeAttachment(e){const i=this,s=this.parser,a=s.json.nodes[e],h=(a.extensions&&a.extensions[this.name]||{}).light;return h===void 0?null:this._loadLight(h).then(function(d){return s._getNodeRef(i.cache,h,d)})}}class dm{constructor(){this.name=Es.KHR_MATERIALS_UNLIT}getMaterialType(){return b.vBJ}extendParams(e,i,s){const a=[];e.color=new b.Ilk(1,1,1),e.opacity=1;const h=i.pbrMetallicRoughness;if(h){if(Array.isArray(h.baseColorFactor)){const d=h.baseColorFactor;e.color.fromArray(d),e.opacity=d[3]}h.baseColorTexture!==void 0&&a.push(s.assignTexture(e,"map",h.baseColorTexture,b.knz))}return Promise.all(a)}}class aA{constructor(e){this.parser=e,this.name=Es.KHR_MATERIALS_EMISSIVE_STRENGTH}extendMaterialParams(e,i){const s=this.parser.json.materials[e];if(!s.extensions||!s.extensions[this.name])return Promise.resolve();const a=s.extensions[this.name].emissiveStrength;return a!==void 0&&(i.emissiveIntensity=a),Promise.resolve()}}class lA{constructor(e){this.parser=e,this.name=Es.KHR_MATERIALS_CLEARCOAT}getMaterialType(e){const i=this.parser.json.materials[e];return i.extensions&&i.extensions[this.name]?b.EJi:null}extendMaterialParams(e,i){const s=this.parser,a=s.json.materials[e];if(!a.extensions||!a.extensions[this.name])return Promise.resolve();const h=[],d=a.extensions[this.name];if(d.clearcoatFactor!==void 0&&(i.clearcoat=d.clearcoatFactor),d.clearcoatTexture!==void 0&&h.push(s.assignTexture(i,"clearcoatMap",d.clearcoatTexture)),d.clearcoatRoughnessFactor!==void 0&&(i.clearcoatRoughness=d.clearcoatRoughnessFactor),d.clearcoatRoughnessTexture!==void 0&&h.push(s.assignTexture(i,"clearcoatRoughnessMap",d.clearcoatRoughnessTexture)),d.clearcoatNormalTexture!==void 0&&(h.push(s.assignTexture(i,"clearcoatNormalMap",d.clearcoatNormalTexture)),d.clearcoatNormalTexture.scale!==void 0)){const _=d.clearcoatNormalTexture.scale;i.clearcoatNormalScale=new b.FM8(_,_)}return Promise.all(h)}}class Tv{constructor(e){this.parser=e,this.name=Es.KHR_MATERIALS_IRIDESCENCE}getMaterialType(e){const i=this.parser.json.materials[e];return i.extensions&&i.extensions[this.name]?b.EJi:null}extendMaterialParams(e,i){const s=this.parser,a=s.json.materials[e];if(!a.extensions||!a.extensions[this.name])return Promise.resolve();const h=[],d=a.extensions[this.name];return d.iridescenceFactor!==void 0&&(i.iridescence=d.iridescenceFactor),d.iridescenceTexture!==void 0&&h.push(s.assignTexture(i,"iridescenceMap",d.iridescenceTexture)),d.iridescenceIor!==void 0&&(i.iridescenceIOR=d.iridescenceIor),i.iridescenceThicknessRange===void 0&&(i.iridescenceThicknessRange=[100,400]),d.iridescenceThicknessMinimum!==void 0&&(i.iridescenceThicknessRange[0]=d.iridescenceThicknessMinimum),d.iridescenceThicknessMaximum!==void 0&&(i.iridescenceThicknessRange[1]=d.iridescenceThicknessMaximum),d.iridescenceThicknessTexture!==void 0&&h.push(s.assignTexture(i,"iridescenceThicknessMap",d.iridescenceThicknessTexture)),Promise.all(h)}}class Du{constructor(e){this.parser=e,this.name=Es.KHR_MATERIALS_SHEEN}getMaterialType(e){const i=this.parser.json.materials[e];return i.extensions&&i.extensions[this.name]?b.EJi:null}extendMaterialParams(e,i){const s=this.parser,a=s.json.materials[e];if(!a.extensions||!a.extensions[this.name])return Promise.resolve();const h=[];i.sheenColor=new b.Ilk(0,0,0),i.sheenRoughness=0,i.sheen=1;const d=a.extensions[this.name];return d.sheenColorFactor!==void 0&&i.sheenColor.fromArray(d.sheenColorFactor),d.sheenRoughnessFactor!==void 0&&(i.sheenRoughness=d.sheenRoughnessFactor),d.sheenColorTexture!==void 0&&h.push(s.assignTexture(i,"sheenColorMap",d.sheenColorTexture,b.knz)),d.sheenRoughnessTexture!==void 0&&h.push(s.assignTexture(i,"sheenRoughnessMap",d.sheenRoughnessTexture)),a.extras&&a.extras.sheenFactor!==void 0&&(i.sheen=a.extras.sheenFactor,delete a.extras.sheenFactor),Promise.all(h)}}class Um{constructor(e){this.parser=e,this.name=Es.KHR_MATERIALS_TRANSMISSION}getMaterialType(e){const i=this.parser.json.materials[e];return i.extensions&&i.extensions[this.name]?b.EJi:null}extendMaterialParams(e,i){const s=this.parser,a=s.json.materials[e];if(!a.extensions||!a.extensions[this.name])return Promise.resolve();const h=[],d=a.extensions[this.name];return d.transmissionFactor!==void 0&&(i.transmission=d.transmissionFactor),d.transmissionTexture!==void 0&&h.push(s.assignTexture(i,"transmissionMap",d.transmissionTexture)),Promise.all(h)}}class Po{constructor(e){this.parser=e,this.name=Es.KHR_MATERIALS_VOLUME}getMaterialType(e){const i=this.parser.json.materials[e];return i.extensions&&i.extensions[this.name]?b.EJi:null}extendMaterialParams(e,i){const s=this.parser,a=s.json.materials[e];if(!a.extensions||!a.extensions[this.name])return Promise.resolve();const h=[],d=a.extensions[this.name];i.thickness=d.thicknessFactor!==void 0?d.thicknessFactor:0,d.thicknessTexture!==void 0&&h.push(s.assignTexture(i,"thicknessMap",d.thicknessTexture)),i.attenuationDistance=d.attenuationDistance||0;const _=d.attenuationColor||[1,1,1];return i.attenuationColor=new b.Ilk(_[0],_[1],_[2]),Promise.all(h)}}class jw{constructor(e){this.parser=e,this.name=Es.KHR_MATERIALS_IOR}getMaterialType(e){const i=this.parser.json.materials[e];return i.extensions&&i.extensions[this.name]?b.EJi:null}extendMaterialParams(e,i){const s=this.parser.json.materials[e];if(!s.extensions||!s.extensions[this.name])return Promise.resolve();const a=s.extensions[this.name];return i.ior=a.ior!==void 0?a.ior:1.5,Promise.resolve()}}class Sr{constructor(e){this.parser=e,this.name=Es.KHR_MATERIALS_SPECULAR}getMaterialType(e){const i=this.parser.json.materials[e];return i.extensions&&i.extensions[this.name]?b.EJi:null}extendMaterialParams(e,i){const s=this.parser,a=s.json.materials[e];if(!a.extensions||!a.extensions[this.name])return Promise.resolve();const h=[],d=a.extensions[this.name];i.specularIntensity=d.specularFactor!==void 0?d.specularFactor:1,d.specularTexture!==void 0&&h.push(s.assignTexture(i,"specularIntensityMap",d.specularTexture));const _=d.specularColorFactor||[1,1,1];return i.specularColor=new b.Ilk(_[0],_[1],_[2]),d.specularColorTexture!==void 0&&h.push(s.assignTexture(i,"specularColorMap",d.specularColorTexture,b.knz)),Promise.all(h)}}class nu{constructor(e){this.parser=e,this.name=Es.KHR_TEXTURE_BASISU}loadTexture(e){const i=this.parser,s=i.json,a=s.textures[e];if(!a.extensions||!a.extensions[this.name])return null;const h=a.extensions[this.name],d=i.options.ktx2Loader;if(!d){if(s.extensionsRequired&&s.extensionsRequired.indexOf(this.name)>=0)throw new Error("THREE.GLTFLoader: setKTX2Loader must be called before loading KTX2 textures");return null}return i.loadTextureImage(e,h.source,d)}}class E1{constructor(e){this.parser=e,this.name=Es.EXT_TEXTURE_WEBP,this.isSupported=null}loadTexture(e){const i=this.name,s=this.parser,a=s.json,h=a.textures[e];if(!h.extensions||!h.extensions[i])return null;const d=h.extensions[i],_=a.images[d.source];let et=s.textureLoader;if(_.uri){const nt=s.options.manager.getHandler(_.uri);nt!==null&&(et=nt)}return this.detectSupport().then(function(nt){if(nt)return s.loadTextureImage(e,d.source,et);if(a.extensionsRequired&&a.extensionsRequired.indexOf(i)>=0)throw new Error("THREE.GLTFLoader: WebP required by asset but unsupported.");return s.loadTexture(e)})}detectSupport(){return this.isSupported||(this.isSupported=new Promise(function(e){const i=new Image;i.src="data:image/webp;base64,UklGRiIAAABXRUJQVlA4IBYAAAAwAQCdASoBAAEADsD+JaQAA3AAAAAA",i.onload=i.onerror=function(){e(i.height===1)}})),this.isSupported}}class OS{constructor(e){this.name=Es.EXT_MESHOPT_COMPRESSION,this.parser=e}loadBufferView(e){const i=this.parser.json,s=i.bufferViews[e];if(s.extensions&&s.extensions[this.name]){const a=s.extensions[this.name],h=this.parser.getDependency("buffer",a.buffer),d=this.parser.options.meshoptDecoder;if(!d||!d.supported){if(i.extensionsRequired&&i.extensionsRequired.indexOf(this.name)>=0)throw new Error("THREE.GLTFLoader: setMeshoptDecoder must be called before loading compressed files");return null}return h.then(function(_){const et=a.byteOffset||0,nt=a.byteLength||0,it=a.count,lt=a.byteStride,ut=new Uint8Array(_,et,nt);return d.decodeGltfBufferAsync?d.decodeGltfBufferAsync(it,lt,ut,a.mode,a.filter).then(function(pt){return pt.buffer}):d.ready.then(function(){const pt=new ArrayBuffer(it*lt);return d.decodeGltfBuffer(new Uint8Array(pt),it,lt,ut,a.mode,a.filter),pt})})}return null}}const Iv="glTF";class p0{constructor(e){this.name=Es.KHR_BINARY_GLTF,this.content=null,this.body=null;const i=new DataView(e,0,12);if(this.header={magic:b.Zp0.decodeText(new Uint8Array(e.slice(0,4))),version:i.getUint32(4,!0),length:i.getUint32(8,!0)},this.header.magic!==Iv)throw new Error("THREE.GLTFLoader: Unsupported glTF-Binary header.");if(this.header.version<2)throw new Error("THREE.GLTFLoader: Legacy binary file detected.");const s=this.header.length-12,a=new DataView(e,12);let h=0;for(;h<s;){const d=a.getUint32(h,!0);h+=4;const _=a.getUint32(h,!0);if(h+=4,_===1313821514){const et=new Uint8Array(e,12+h,d);this.content=b.Zp0.decodeText(et)}else if(_===5130562){const et=12+h;this.body=e.slice(et,et+d)}h+=d}if(this.content===null)throw new Error("THREE.GLTFLoader: JSON content not found.")}}class pm{constructor(e,i){if(!i)throw new Error("THREE.GLTFLoader: No DRACOLoader instance provided.");this.name=Es.KHR_DRACO_MESH_COMPRESSION,this.json=e,this.dracoLoader=i,this.dracoLoader.preload()}decodePrimitive(e,i){const s=this.json,a=this.dracoLoader,h=e.extensions[this.name].bufferView,d=e.extensions[this.name].attributes,_={},et={},nt={};for(const it in d){const lt=m0[it]||it.toLowerCase();_[lt]=d[it]}for(const it in e.attributes){const lt=m0[it]||it.toLowerCase();if(d[it]!==void 0){const ut=s.accessors[e.attributes[it]],pt=Ep[ut.componentType];nt[lt]=pt.name,et[lt]=ut.normalized===!0}}return i.getDependency("bufferView",h).then(function(it){return new Promise(function(lt){a.decodeDracoFile(it,function(ut){for(const pt in ut.attributes){const gt=ut.attributes[pt],vt=et[pt];vt!==void 0&&(gt.normalized=vt)}lt(ut)},_,nt)})})}}class cA{constructor(){this.name=Es.KHR_TEXTURE_TRANSFORM}extendTexture(e,i){return i.texCoord!==void 0&&console.warn('THREE.GLTFLoader: Custom UV sets in "'+this.name+'" extension not yet supported.'),i.offset===void 0&&i.rotation===void 0&&i.scale===void 0||(e=e.clone(),i.offset!==void 0&&e.offset.fromArray(i.offset),i.rotation!==void 0&&(e.rotation=i.rotation),i.scale!==void 0&&e.repeat.fromArray(i.scale),e.needsUpdate=!0),e}}class Dv extends b.Wid{constructor(e){super(),this.isGLTFSpecularGlossinessMaterial=!0;const i=["#ifdef USE_SPECULARMAP","	uniform sampler2D specularMap;","#endif"].join(`
`),s=["#ifdef USE_GLOSSINESSMAP","	uniform sampler2D glossinessMap;","#endif"].join(`
`),a=["vec3 specularFactor = specular;","#ifdef USE_SPECULARMAP","	vec4 texelSpecular = texture2D( specularMap, vUv );","	// reads channel RGB, compatible with a glTF Specular-Glossiness (RGBA) texture","	specularFactor *= texelSpecular.rgb;","#endif"].join(`
`),h=["float glossinessFactor = glossiness;","#ifdef USE_GLOSSINESSMAP","	vec4 texelGlossiness = texture2D( glossinessMap, vUv );","	// reads channel A, compatible with a glTF Specular-Glossiness (RGBA) texture","	glossinessFactor *= texelGlossiness.a;","#endif"].join(`
`),d=["PhysicalMaterial material;","material.diffuseColor = diffuseColor.rgb * ( 1. - max( specularFactor.r, max( specularFactor.g, specularFactor.b ) ) );","vec3 dxy = max( abs( dFdx( geometryNormal ) ), abs( dFdy( geometryNormal ) ) );","float geometryRoughness = max( max( dxy.x, dxy.y ), dxy.z );","material.roughness = max( 1.0 - glossinessFactor, 0.0525 ); // 0.0525 corresponds to the base mip of a 256 cubemap.","material.roughness += geometryRoughness;","material.roughness = min( material.roughness, 1.0 );","material.specularColor = specularFactor;"].join(`
`),_={specular:{value:new b.Ilk().setHex(16777215)},glossiness:{value:1},specularMap:{value:null},glossinessMap:{value:null}};this._extraUniforms=_,this.onBeforeCompile=function(et){for(const nt in _)et.uniforms[nt]=_[nt];et.fragmentShader=et.fragmentShader.replace("uniform float roughness;","uniform vec3 specular;").replace("uniform float metalness;","uniform float glossiness;").replace("#include <roughnessmap_pars_fragment>",i).replace("#include <metalnessmap_pars_fragment>",s).replace("#include <roughnessmap_fragment>",a).replace("#include <metalnessmap_fragment>",h).replace("#include <lights_physical_fragment>",d)},Object.defineProperties(this,{specular:{get:function(){return _.specular.value},set:function(et){_.specular.value=et}},specularMap:{get:function(){return _.specularMap.value},set:function(et){_.specularMap.value=et,et?this.defines.USE_SPECULARMAP="":delete this.defines.USE_SPECULARMAP}},glossiness:{get:function(){return _.glossiness.value},set:function(et){_.glossiness.value=et}},glossinessMap:{get:function(){return _.glossinessMap.value},set:function(et){_.glossinessMap.value=et,et?(this.defines.USE_GLOSSINESSMAP="",this.defines.USE_UV=""):(delete this.defines.USE_GLOSSINESSMAP,delete this.defines.USE_UV)}}}),delete this.metalness,delete this.roughness,delete this.metalnessMap,delete this.roughnessMap,this.setValues(e)}copy(e){return super.copy(e),this.specularMap=e.specularMap,this.specular.copy(e.specular),this.glossinessMap=e.glossinessMap,this.glossiness=e.glossiness,delete this.metalness,delete this.roughness,delete this.metalnessMap,delete this.roughnessMap,this}}class bp{constructor(){this.name=Es.KHR_MATERIALS_PBR_SPECULAR_GLOSSINESS,this.specularGlossinessParams=["color","map","lightMap","lightMapIntensity","aoMap","aoMapIntensity","emissive","emissiveIntensity","emissiveMap","bumpMap","bumpScale","normalMap","normalMapType","displacementMap","displacementScale","displacementBias","specularMap","specular","glossinessMap","glossiness","alphaMap","envMap","envMapIntensity"]}getMaterialType(){return Dv}extendParams(e,i,s){const a=i.extensions[this.name];e.color=new b.Ilk(1,1,1),e.opacity=1;const h=[];if(Array.isArray(a.diffuseFactor)){const d=a.diffuseFactor;e.color.fromArray(d),e.opacity=d[3]}if(a.diffuseTexture!==void 0&&h.push(s.assignTexture(e,"map",a.diffuseTexture,b.knz)),e.emissive=new b.Ilk(0,0,0),e.glossiness=a.glossinessFactor!==void 0?a.glossinessFactor:1,e.specular=new b.Ilk(1,1,1),Array.isArray(a.specularFactor)&&e.specular.fromArray(a.specularFactor),a.specularGlossinessTexture!==void 0){const d=a.specularGlossinessTexture;h.push(s.assignTexture(e,"glossinessMap",d)),h.push(s.assignTexture(e,"specularMap",d,b.knz))}return Promise.all(h)}createMaterial(e){const i=new Dv(e);return i.fog=!0,i.color=e.color,i.map=e.map===void 0?null:e.map,i.lightMap=null,i.lightMapIntensity=1,i.aoMap=e.aoMap===void 0?null:e.aoMap,i.aoMapIntensity=1,i.emissive=e.emissive,i.emissiveIntensity=e.emissiveIntensity===void 0?1:e.emissiveIntensity,i.emissiveMap=e.emissiveMap===void 0?null:e.emissiveMap,i.bumpMap=e.bumpMap===void 0?null:e.bumpMap,i.bumpScale=1,i.normalMap=e.normalMap===void 0?null:e.normalMap,i.normalMapType=b.IOt,e.normalScale&&(i.normalScale=e.normalScale),i.displacementMap=null,i.displacementScale=1,i.displacementBias=0,i.specularMap=e.specularMap===void 0?null:e.specularMap,i.specular=e.specular,i.glossinessMap=e.glossinessMap===void 0?null:e.glossinessMap,i.glossiness=e.glossiness,i.alphaMap=null,i.envMap=e.envMap===void 0?null:e.envMap,i.envMapIntensity=1,i}}class zw{constructor(){this.name=Es.KHR_MESH_QUANTIZATION}}class ba extends b._C8{constructor(e,i,s,a){super(e,i,s,a)}copySampleValue_(e){const i=this.resultBuffer,s=this.sampleValues,a=this.valueSize,h=e*a*3+a;for(let d=0;d!==a;d++)i[d]=s[h+d];return i}interpolate_(e,i,s,a){const h=this.resultBuffer,d=this.sampleValues,_=this.valueSize,et=2*_,nt=3*_,it=a-i,lt=(s-i)/it,ut=lt*lt,pt=ut*lt,gt=e*nt,vt=gt-nt,Ct=-2*pt+3*ut,wt=pt-ut,xt=1-Ct,_t=wt-ut+lt;for(let Pt=0;Pt!==_;Pt++){const Bt=d[vt+Pt+_],Ot=d[vt+Pt+et]*it,Lt=d[gt+Pt+_],qt=d[gt+Pt]*it;h[Pt]=xt*Bt+_t*Ot+Ct*Lt+wt*qt}return h}}const zp=new b._fP;class My extends ba{interpolate_(e,i,s,a){const h=super.interpolate_(e,i,s,a);return zp.fromArray(h).normalize().toArray(h),h}}const Ep={5120:Int8Array,5121:Uint8Array,5122:Int16Array,5123:Uint16Array,5125:Uint32Array,5126:Float32Array},uA={9728:b.TyD,9729:b.wem,9984:b.YLQ,9985:b.qyh,9986:b.aH4,9987:b.D1R},rs={33071:b.uWy,33648:b.OoA,10497:b.rpg},f0={SCALAR:1,VEC2:2,VEC3:3,VEC4:4,MAT2:4,MAT3:9,MAT4:16},m0={POSITION:"position",NORMAL:"normal",TANGENT:"tangent",TEXCOORD_0:"uv",TEXCOORD_1:"uv2",COLOR_0:"color",WEIGHTS_0:"skinWeight",JOINTS_0:"skinIndex"},Sp={scale:"scale",translation:"position",rotation:"quaternion",weights:"morphTargetInfluences"},hA={CUBICSPLINE:void 0,LINEAR:b.NMF,STEP:b.Syv};function u_(c,e,i){for(const s in i.extensions)c[s]===void 0&&(e.userData.gltfExtensions=e.userData.gltfExtensions||{},e.userData.gltfExtensions[s]=i.extensions[s])}function qo(c,e){e.extras!==void 0&&(typeof e.extras=="object"?Object.assign(c.userData,e.extras):console.warn("THREE.GLTFLoader: Ignoring primitive type .extras, "+e.extras))}function _o(c,e){if(c.updateMorphTargets(),e.weights!==void 0)for(let i=0,s=e.weights.length;i<s;i++)c.morphTargetInfluences[i]=e.weights[i];if(e.extras&&Array.isArray(e.extras.targetNames)){const i=e.extras.targetNames;if(c.morphTargetInfluences.length===i.length){c.morphTargetDictionary={};for(let s=0,a=i.length;s<a;s++)c.morphTargetDictionary[i[s]]=s}else console.warn("THREE.GLTFLoader: Invalid extras.targetNames length. Ignoring names.")}}function ap(c){const e=c.extensions&&c.extensions[Es.KHR_DRACO_MESH_COMPRESSION];let i;return i=e?"draco:"+e.bufferView+":"+e.indices+":"+h_(e.attributes):c.indices+":"+h_(c.attributes)+":"+c.mode,i}function h_(c){let e="";const i=Object.keys(c).sort();for(let s=0,a=i.length;s<a;s++)e+=i[s]+":"+c[i[s]]+";";return e}function Vw(c){switch(c){case Int8Array:return 1/127;case Uint8Array:return 1/255;case Int16Array:return 1/32767;case Uint16Array:return 1/65535;default:throw new Error("THREE.GLTFLoader: Unsupported normalized accessor component type.")}}class d_{constructor(e={},i={}){this.json=e,this.extensions={},this.plugins={},this.options=i,this.cache=new oA,this.associations=new Map,this.primitiveCache={},this.meshCache={refs:{},uses:{}},this.cameraCache={refs:{},uses:{}},this.lightCache={refs:{},uses:{}},this.sourceCache={},this.textureCache={},this.nodeNamesUsed={};const s=/^((?!chrome|android).)*safari/i.test(navigator.userAgent)===!0,a=navigator.userAgent.indexOf("Firefox")>-1,h=a?navigator.userAgent.match(/Firefox\/([0-9]+)\./)[1]:-1;typeof createImageBitmap>"u"||s||a&&h<98?this.textureLoader=new b.dpR(this.options.manager):this.textureLoader=new b.QRU(this.options.manager),this.textureLoader.setCrossOrigin(this.options.crossOrigin),this.textureLoader.setRequestHeader(this.options.requestHeader),this.fileLoader=new b.hH6(this.options.manager),this.fileLoader.setResponseType("arraybuffer"),this.options.crossOrigin==="use-credentials"&&this.fileLoader.setWithCredentials(!0)}setExtensions(e){this.extensions=e}setPlugins(e){this.plugins=e}parse(e,i){const s=this,a=this.json,h=this.extensions;this.cache.removeAll(),this._invokeAll(function(d){return d._markDefs&&d._markDefs()}),Promise.all(this._invokeAll(function(d){return d.beforeRoot&&d.beforeRoot()})).then(function(){return Promise.all([s.getDependencies("scene"),s.getDependencies("animation"),s.getDependencies("camera")])}).then(function(d){const _={scene:d[0][a.scene||0],scenes:d[0],animations:d[1],cameras:d[2],asset:a.asset,parser:s,userData:{}};u_(h,_,a),qo(_,a),Promise.all(s._invokeAll(function(et){return et.afterRoot&&et.afterRoot(_)})).then(function(){e(_)})}).catch(i)}_markDefs(){const e=this.json.nodes||[],i=this.json.skins||[],s=this.json.meshes||[];for(let a=0,h=i.length;a<h;a++){const d=i[a].joints;for(let _=0,et=d.length;_<et;_++)e[d[_]].isBone=!0}for(let a=0,h=e.length;a<h;a++){const d=e[a];d.mesh!==void 0&&(this._addNodeRef(this.meshCache,d.mesh),d.skin!==void 0&&(s[d.mesh].isSkinnedMesh=!0)),d.camera!==void 0&&this._addNodeRef(this.cameraCache,d.camera)}}_addNodeRef(e,i){i!==void 0&&(e.refs[i]===void 0&&(e.refs[i]=e.uses[i]=0),e.refs[i]++)}_getNodeRef(e,i,s){if(e.refs[i]<=1)return s;const a=s.clone(),h=(d,_)=>{const et=this.associations.get(d);et!=null&&this.associations.set(_,et);for(const[nt,it]of d.children.entries())h(it,_.children[nt])};return h(s,a),a.name+="_instance_"+e.uses[i]++,a}_invokeOne(e){const i=Object.values(this.plugins);i.push(this);for(let s=0;s<i.length;s++){const a=e(i[s]);if(a)return a}return null}_invokeAll(e){const i=Object.values(this.plugins);i.unshift(this);const s=[];for(let a=0;a<i.length;a++){const h=e(i[a]);h&&s.push(h)}return s}getDependency(e,i){const s=e+":"+i;let a=this.cache.get(s);if(!a){switch(e){case"scene":a=this.loadScene(i);break;case"node":a=this.loadNode(i);break;case"mesh":a=this._invokeOne(function(h){return h.loadMesh&&h.loadMesh(i)});break;case"accessor":a=this.loadAccessor(i);break;case"bufferView":a=this._invokeOne(function(h){return h.loadBufferView&&h.loadBufferView(i)});break;case"buffer":a=this.loadBuffer(i);break;case"material":a=this._invokeOne(function(h){return h.loadMaterial&&h.loadMaterial(i)});break;case"texture":a=this._invokeOne(function(h){return h.loadTexture&&h.loadTexture(i)});break;case"skin":a=this.loadSkin(i);break;case"animation":a=this._invokeOne(function(h){return h.loadAnimation&&h.loadAnimation(i)});break;case"camera":a=this.loadCamera(i);break;default:throw new Error("Unknown type: "+e)}this.cache.add(s,a)}return a}getDependencies(e){let i=this.cache.get(e);if(!i){const s=this,a=this.json[e+(e==="mesh"?"es":"s")]||[];i=Promise.all(a.map(function(h,d){return s.getDependency(e,d)})),this.cache.add(e,i)}return i}loadBuffer(e){const i=this.json.buffers[e],s=this.fileLoader;if(i.type&&i.type!=="arraybuffer")throw new Error("THREE.GLTFLoader: "+i.type+" buffer type is not supported.");if(i.uri===void 0&&e===0)return Promise.resolve(this.extensions[Es.KHR_BINARY_GLTF].body);const a=this.options;return new Promise(function(h,d){s.load(b.Zp0.resolveURL(i.uri,a.path),h,void 0,function(){d(new Error('THREE.GLTFLoader: Failed to load buffer "'+i.uri+'".'))})})}loadBufferView(e){const i=this.json.bufferViews[e];return this.getDependency("buffer",i.buffer).then(function(s){const a=i.byteLength||0,h=i.byteOffset||0;return s.slice(h,h+a)})}loadAccessor(e){const i=this,s=this.json,a=this.json.accessors[e];if(a.bufferView===void 0&&a.sparse===void 0)return Promise.resolve(null);const h=[];return a.bufferView!==void 0?h.push(this.getDependency("bufferView",a.bufferView)):h.push(null),a.sparse!==void 0&&(h.push(this.getDependency("bufferView",a.sparse.indices.bufferView)),h.push(this.getDependency("bufferView",a.sparse.values.bufferView))),Promise.all(h).then(function(d){const _=d[0],et=f0[a.type],nt=Ep[a.componentType],it=nt.BYTES_PER_ELEMENT,lt=it*et,ut=a.byteOffset||0,pt=a.bufferView!==void 0?s.bufferViews[a.bufferView].byteStride:void 0,gt=a.normalized===!0;let vt,Ct;if(pt&&pt!==lt){const wt=Math.floor(ut/pt),xt="InterleavedBuffer:"+a.bufferView+":"+a.componentType+":"+wt+":"+a.count;let _t=i.cache.get(xt);_t||(vt=new nt(_,wt*pt,a.count*pt/it),_t=new b.vpT(vt,pt/it),i.cache.add(xt,_t)),Ct=new b.kB5(_t,et,ut%pt/it,gt)}else vt=_===null?new nt(a.count*et):new nt(_,ut,a.count*et),Ct=new b.TlE(vt,et,gt);if(a.sparse!==void 0){const wt=f0.SCALAR,xt=Ep[a.sparse.indices.componentType],_t=a.sparse.indices.byteOffset||0,Pt=a.sparse.values.byteOffset||0,Bt=new xt(d[1],_t,a.sparse.count*wt),Ot=new nt(d[2],Pt,a.sparse.count*et);_!==null&&(Ct=new b.TlE(Ct.array.slice(),Ct.itemSize,Ct.normalized));for(let Lt=0,qt=Bt.length;Lt<qt;Lt++){const en=Bt[Lt];if(Ct.setX(en,Ot[Lt*et]),et>=2&&Ct.setY(en,Ot[Lt*et+1]),et>=3&&Ct.setZ(en,Ot[Lt*et+2]),et>=4&&Ct.setW(en,Ot[Lt*et+3]),et>=5)throw new Error("THREE.GLTFLoader: Unsupported itemSize in sparse BufferAttribute.")}}return Ct})}loadTexture(e){const i=this.json,s=this.options,a=i.textures[e].source,h=i.images[a];let d=this.textureLoader;if(h.uri){const _=s.manager.getHandler(h.uri);_!==null&&(d=_)}return this.loadTextureImage(e,a,d)}loadTextureImage(e,i,s){const a=this,h=this.json,d=h.textures[e],_=h.images[i],et=(_.uri||_.bufferView)+":"+d.sampler;if(this.textureCache[et])return this.textureCache[et];const nt=this.loadImageSource(i,s).then(function(it){d.name&&(it.name=d.name);const lt=(h.samplers||{})[d.sampler]||{};return it.magFilter=uA[lt.magFilter]||b.wem,it.minFilter=uA[lt.minFilter]||b.D1R,it.wrapS=rs[lt.wrapS]||b.rpg,it.wrapT=rs[lt.wrapT]||b.rpg,lt.extras&&lt.extras.uuid!==void 0&&(it.uuid=lt.extras.uuid),a.associations.set(it,{textures:e}),it}).catch(function(){return null});return this.textureCache[et]=nt,nt}loadImageSource(e,i){const s=this,a=this.json,h=this.options;if(this.sourceCache[e]!==void 0)return this.sourceCache[e].then(ut=>ut.clone());const d=a.images[e],_=self.URL||self.webkitURL;let et=d.uri||"",nt=!1,it=null;if(d.bufferView!==void 0)et=s.getDependency("bufferView",d.bufferView).then(function(ut){nt=!0;const pt=new Blob([ut],{type:d.mimeType});return et=_.createObjectURL(pt),it=pt,et});else if(d.uri===void 0)throw new Error("THREE.GLTFLoader: Image "+e+" is missing URI and bufferView");const lt=Promise.resolve(et).then(function(ut){return new Promise(function(pt,gt){let vt=pt;i.isImageBitmapLoader===!0&&(vt=function(Ct){const wt=new b.xEZ(Ct);wt.needsUpdate=!0,pt(wt)}),i.load(b.Zp0.resolveURL(ut,h.path),vt,void 0,function(Ct){i.isImageBitmapLoader===!0?(i=new b.dpR(s.options.manager),vt=pt,i.setCrossOrigin(s.options.crossOrigin),i.setRequestHeader(s.options.requestHeader),i.load(b.Zp0.resolveURL(ut,h.path),vt,void 0,gt)):gt(Ct)})})}).then(function(ut){var pt;if(nt===!0&&_.revokeObjectURL(et),ut.userData.mimeType=d.mimeType||((pt=d.uri).search(/\.jpe?g($|\?)/i)>0||pt.search(/^data\:image\/jpeg/)===0?"image/jpeg":pt.search(/\.webp($|\?)/i)>0||pt.search(/^data\:image\/webp/)===0?"image/webp":"image/png"),ut.flipY=!1,d.extras){if(d.extras.flipY!==void 0){if(i.isImageBitmapLoader===!0&&typeof createImageBitmap!==void 0){const gt=ut,vt=d.extras.flipY&&!gt.flipY;createImageBitmap(gt.source.data,{imageOrientation:vt?"flipY":"none"}).then(function(Ct){gt.source.data.close&&gt.source.data.close(),gt.source.data=Ct,gt.source.needsUpdate=!0,gt.needsUpdate=!0})}ut.flipY=d.extras.flipY,ut.needsUpdate=!0,delete d.extras.flipY}d.extras.uuid!==void 0&&(ut.source.uuid=d.extras.uuid),d.extras.t_uuid!==void 0&&(ut.uuid=d.extras.t_uuid)}return d.uri&&typeof d.uri=="string"&&(ut.userData.rootPath=d.uri),it&&(ut.userData.__sourceBlob=it),ut}).catch(function(ut){throw console.error("THREE.GLTFLoader: Couldn't load texture",et),ut});return this.sourceCache[e]=lt,lt}assignTexture(e,i,s,a){const h=this;return this.getDependency("texture",s.index).then(function(d){if(s.texCoord===void 0||s.texCoord==0||i==="aoMap"&&s.texCoord==1||console.warn("THREE.GLTFLoader: Custom UV set "+s.texCoord+" for texture "+i+" not yet supported."),h.extensions[Es.KHR_TEXTURE_TRANSFORM]){const _=s.extensions!==void 0?s.extensions[Es.KHR_TEXTURE_TRANSFORM]:void 0;if(_){const et=h.associations.get(d);d=h.extensions[Es.KHR_TEXTURE_TRANSFORM].extendTexture(d,_),h.associations.set(d,et)}}return a!==void 0&&(d.encoding=a),e[i]=d,d})}assignFinalMaterial(e){const i=e.geometry;let s=e.material;const a=i.attributes.tangent===void 0,h=i.attributes.color!==void 0,d=i.attributes.normal===void 0;if(e.isPoints){const _="PointsMaterial:"+s.uuid;let et=this.cache.get(_);et||(et=new b.UY4,b.F5T.prototype.copy.call(et,s),et.color.copy(s.color),et.map=s.map,et.sizeAttenuation=!1,this.cache.add(_,et)),s=et}else if(e.isLine){const _="LineBasicMaterial:"+s.uuid;let et=this.cache.get(_);et||(et=new b.nls,b.F5T.prototype.copy.call(et,s),et.color.copy(s.color),this.cache.add(_,et)),s=et}if(a||h||d){let _="ClonedMaterial:"+s.uuid+":";s.isGLTFSpecularGlossinessMaterial&&(_+="specular-glossiness:"),a&&(_+="derivative-tangents:"),h&&(_+="vertex-colors:"),d&&(_+="flat-shading:");let et=this.cache.get(_);et||(et=s.clone(),h&&(et.vertexColors=!0),d&&(et.flatShading=!0),a&&(et.normalScale&&(et.normalScale.y*=-1),et.clearcoatNormalScale&&(et.clearcoatNormalScale.y*=-1)),this.cache.add(_,et),this.associations.set(et,this.associations.get(s))),s=et}s.aoMap&&i.attributes.uv2===void 0&&i.attributes.uv!==void 0&&i.setAttribute("uv2",i.attributes.uv),e.material=s}getMaterialType(){return b.Wid}loadMaterial(e){const i=this,s=this.json,a=this.extensions,h=s.materials[e];let d;const _={},et=h.extensions||{},nt=[];if(et[Es.KHR_MATERIALS_PBR_SPECULAR_GLOSSINESS]){const lt=a[Es.KHR_MATERIALS_PBR_SPECULAR_GLOSSINESS];d=lt.getMaterialType(),nt.push(lt.extendParams(_,h,i))}else if(et[Es.KHR_MATERIALS_UNLIT]){const lt=a[Es.KHR_MATERIALS_UNLIT];d=lt.getMaterialType(),nt.push(lt.extendParams(_,h,i))}else{const lt=h.pbrMetallicRoughness||{};if(_.color=new b.Ilk(1,1,1),_.opacity=1,Array.isArray(lt.baseColorFactor)){const ut=lt.baseColorFactor;_.color.fromArray(ut),_.opacity=ut[3]}lt.baseColorTexture!==void 0&&nt.push(i.assignTexture(_,"map",lt.baseColorTexture,b.knz)),_.metalness=lt.metallicFactor!==void 0?lt.metallicFactor:1,_.roughness=lt.roughnessFactor!==void 0?lt.roughnessFactor:1,lt.metallicRoughnessTexture!==void 0&&(nt.push(i.assignTexture(_,"metalnessMap",lt.metallicRoughnessTexture)),nt.push(i.assignTexture(_,"roughnessMap",lt.metallicRoughnessTexture))),d=this._invokeOne(function(ut){return ut.getMaterialType&&ut.getMaterialType(e)}),nt.push(Promise.all(this._invokeAll(function(ut){return ut.extendMaterialParams&&ut.extendMaterialParams(e,_)})))}h.doubleSided===!0&&(_.side=b.ehD);const it=h.alphaMode||"OPAQUE";if(it==="BLEND"?(_.transparent=!0,_.depthWrite=!1):(_.transparent=!1,it==="MASK"&&(_.alphaTest=h.alphaCutoff!==void 0?h.alphaCutoff:.5)),h.normalTexture!==void 0&&d!==b.vBJ&&(nt.push(i.assignTexture(_,"normalMap",h.normalTexture)),_.normalScale=new b.FM8(1,1),h.normalTexture.scale!==void 0)){const lt=h.normalTexture.scale;_.normalScale.set(lt,lt)}return h.occlusionTexture!==void 0&&d!==b.vBJ&&(nt.push(i.assignTexture(_,"aoMap",h.occlusionTexture)),h.occlusionTexture.strength!==void 0&&(_.aoMapIntensity=h.occlusionTexture.strength)),h.emissiveFactor!==void 0&&d!==b.vBJ&&(_.emissive=new b.Ilk().fromArray(h.emissiveFactor)),h.emissiveTexture!==void 0&&d!==b.vBJ&&nt.push(i.assignTexture(_,"emissiveMap",h.emissiveTexture,b.knz)),Promise.all(nt).then(function(){let lt;return lt=d===Dv?a[Es.KHR_MATERIALS_PBR_SPECULAR_GLOSSINESS].createMaterial(_):new d(_),h.name&&(lt.name=h.name),qo(lt,h),i.associations.set(lt,{materials:e}),h.extensions&&u_(a,lt,h),lt})}createUniqueName(e){const i=b.iUV.sanitizeNodeName(e||"");let s=i;for(let a=1;this.nodeNamesUsed[s];++a)s=i+"_"+a;return this.nodeNamesUsed[s]=!0,s}loadGeometries(e){const i=this,s=this.extensions,a=this.primitiveCache;function h(_){return s[Es.KHR_DRACO_MESH_COMPRESSION].decodePrimitive(_,i).then(function(et){return C1(et,_,i)})}const d=[];for(let _=0,et=e.length;_<et;_++){const nt=e[_],it=ap(nt),lt=a[it];if(lt)d.push(lt.promise);else{let ut;ut=nt.extensions&&nt.extensions[Es.KHR_DRACO_MESH_COMPRESSION]?h(nt):C1(new b.u9r,nt,i),a[it]={primitive:nt,promise:ut},d.push(ut)}}return Promise.all(d)}loadMesh(e){const i=this,s=this.json,a=this.extensions,h=s.meshes[e],d=h.primitives,_=[];for(let nt=0,it=d.length;nt<it;nt++){const lt=d[nt].material===void 0?((et=this.cache).DefaultMaterial===void 0&&(et.DefaultMaterial=new b.Wid({color:16777215,emissive:0,metalness:1,roughness:1,transparent:!1,depthTest:!0,side:b.Wl3})),et.DefaultMaterial):this.getDependency("material",d[nt].material);_.push(lt)}var et;return _.push(i.loadGeometries(d)),Promise.all(_).then(function(nt){const it=nt.slice(0,nt.length-1),lt=nt[nt.length-1],ut=[];for(let gt=0,vt=lt.length;gt<vt;gt++){const Ct=lt[gt],wt=d[gt];let xt;const _t=it[gt];if(wt.mode===4||wt.mode===5||wt.mode===6||wt.mode===void 0)xt=h.isSkinnedMesh===!0?new b.TUv(Ct,_t):new b.Kj0(Ct,_t),xt.isSkinnedMesh!==!0||xt.geometry.attributes.skinWeight.normalized||xt.normalizeSkinWeights(),wt.mode===5?xt.geometry=iu(xt.geometry,b.UlW):wt.mode===6&&(xt.geometry=iu(xt.geometry,b.z$h));else if(wt.mode===1)xt=new b.ejS(Ct,_t);else if(wt.mode===3)xt=new b.x12(Ct,_t);else if(wt.mode===2)xt=new b.blk(Ct,_t);else{if(wt.mode!==0)throw new Error("THREE.GLTFLoader: Primitive mode unsupported: "+wt.mode);xt=new b.woe(Ct,_t)}Object.keys(xt.geometry.morphAttributes).length>0&&_o(xt,h),xt.name=i.createUniqueName(h.name||"mesh_"+e),qo(xt,h),wt.extensions&&u_(a,xt,wt),i.assignFinalMaterial(xt),ut.push(xt)}h.extensions&&ut.forEach(gt=>u_(a,gt,h));for(let gt=0,vt=ut.length;gt<vt;gt++)i.associations.set(ut[gt],{meshes:e,primitives:gt});if(ut.length===1)return ut[0];const pt=new b.ZAu;i.associations.set(pt,{meshes:e});for(let gt=0,vt=ut.length;gt<vt;gt++)pt.add(ut[gt]);return pt})}loadCamera(e){let i;const s=this.json.cameras[e],a=s[s.type];if(a)return s.type==="perspective"?i=new b.cPb(b.M8C.radToDeg(a.yfov),a.aspectRatio||1,a.znear||1,a.zfar||2e6):s.type==="orthographic"&&(i=new b.iKG(-a.xmag,a.xmag,a.ymag,-a.ymag,a.znear,a.zfar)),s.name&&(i.name=this.createUniqueName(s.name)),qo(i,s),Promise.resolve(i);console.warn("THREE.GLTFLoader: Missing camera parameters.")}loadSkin(e){const i=this.json.skins[e],s={joints:i.joints};return i.inverseBindMatrices===void 0?Promise.resolve(s):this.getDependency("accessor",i.inverseBindMatrices).then(function(a){return s.inverseBindMatrices=a,s})}loadAnimation(e){const i=this.json.animations[e],s=[],a=[],h=[],d=[],_=[];for(let et=0,nt=i.channels.length;et<nt;et++){const it=i.channels[et],lt=i.samplers[it.sampler],ut=it.target,pt=ut.node,gt=i.parameters!==void 0?i.parameters[lt.input]:lt.input,vt=i.parameters!==void 0?i.parameters[lt.output]:lt.output;s.push(this.getDependency("node",pt)),a.push(this.getDependency("accessor",gt)),h.push(this.getDependency("accessor",vt)),d.push(lt),_.push(ut)}return Promise.all([Promise.all(s),Promise.all(a),Promise.all(h),Promise.all(d),Promise.all(_)]).then(function(et){const nt=et[0],it=et[1],lt=et[2],ut=et[3],pt=et[4],gt=[];for(let Ct=0,wt=nt.length;Ct<wt;Ct++){const xt=nt[Ct],_t=it[Ct],Pt=lt[Ct],Bt=ut[Ct],Ot=pt[Ct];if(xt===void 0)continue;let Lt;switch(xt.updateMatrix(),Sp[Ot.path]){case Sp.weights:Lt=b.dUE;break;case Sp.rotation:Lt=b.iLg;break;default:Lt=b.yC1}const qt=xt.name?xt.name:xt.uuid,en=Bt.interpolation!==void 0?hA[Bt.interpolation]:b.NMF,cn=[];Sp[Ot.path]===Sp.weights?xt.traverse(function(mn){mn.morphTargetInfluences&&cn.push(mn.name?mn.name:mn.uuid)}):cn.push(qt);let An=Pt.array;if(Pt.normalized){const mn=Vw(An.constructor),Tn=new Float32Array(An.length);for(let vn=0,xn=An.length;vn<xn;vn++)Tn[vn]=An[vn]*mn;An=Tn}for(let mn=0,Tn=cn.length;mn<Tn;mn++){const vn=new Lt(cn[mn]+"."+Sp[Ot.path],_t.array,An,en);Bt.interpolation==="CUBICSPLINE"&&(vn.createInterpolant=function(xn){return new(this instanceof b.iLg?My:ba)(this.times,this.values,this.getValueSize()/3,xn)},vn.createInterpolant.isInterpolantFactoryMethodGLTFCubicSpline=!0),gt.push(vn)}}const vt=i.name?i.name:"animation_"+e;return new b.m7l(vt,void 0,gt)})}createNodeMesh(e){const i=this.json,s=this,a=i.nodes[e];return a.mesh===void 0?null:s.getDependency("mesh",a.mesh).then(function(h){const d=s._getNodeRef(s.meshCache,a.mesh,h);return a.weights!==void 0&&d.traverse(function(_){if(_.isMesh)for(let et=0,nt=a.weights.length;et<nt;et++)_.morphTargetInfluences[et]=a.weights[et]}),d})}loadNode(e){const i=this.json,s=this.extensions,a=this,h=i.nodes[e],d=h.name?a.createUniqueName(h.name):"";return function(){const _=[],et=a._invokeOne(function(nt){return nt.createNodeMesh&&nt.createNodeMesh(e)});return et&&_.push(et),h.camera!==void 0&&_.push(a.getDependency("camera",h.camera).then(function(nt){return a._getNodeRef(a.cameraCache,h.camera,nt)})),a._invokeAll(function(nt){return nt.createNodeAttachment&&nt.createNodeAttachment(e)}).forEach(function(nt){_.push(nt)}),Promise.all(_)}().then(function(_){let et;if(et=h.isBone===!0?new b.N$j:_.length>1?new b.ZAu:_.length===1?_[0]:new b.Tme,et!==_[0])for(let nt=0,it=_.length;nt<it;nt++)et.add(_[nt]);if(h.name&&(et.userData.name=h.name,et.name=d),qo(et,h),h.extensions&&u_(s,et,h),h.matrix!==void 0){const nt=new b.yGw;nt.fromArray(h.matrix),et.applyMatrix4(nt)}else h.translation!==void 0&&et.position.fromArray(h.translation),h.rotation!==void 0&&et.quaternion.fromArray(h.rotation),h.scale!==void 0&&et.scale.fromArray(h.scale);return a.associations.has(et)||a.associations.set(et,{}),a.associations.get(et).nodes=e,et})}loadScene(e){const i=this.json,s=this.extensions,a=this.json.scenes[e],h=this,d=new b.ZAu;a.name&&(d.name=h.createUniqueName(a.name)),qo(d,a),a.extensions&&u_(s,d,a);const _=a.nodes||[],et=[];for(let nt=0,it=_.length;nt<it;nt++)et.push(S1(_[nt],d,i,h));return Promise.all(et).then(function(){return h.associations=(nt=>{const it=new Map;for(const[lt,ut]of h.associations)(lt instanceof b.F5T||lt instanceof b.xEZ)&&it.set(lt,ut);return nt.traverse(lt=>{const ut=h.associations.get(lt);ut!=null&&it.set(lt,ut)}),it})(d),d})}}function S1(c,e,i,s){const a=i.nodes[c];return s.getDependency("node",c).then(function(h){if(a.skin===void 0)return h;let d;return s.getDependency("skin",a.skin).then(function(_){d=_;const et=[];for(let nt=0,it=d.joints.length;nt<it;nt++)et.push(s.getDependency("node",d.joints[nt]));return Promise.all(et)}).then(function(_){return h.traverse(function(et){if(!et.isMesh)return;const nt=[],it=[];for(let lt=0,ut=_.length;lt<ut;lt++){const pt=_[lt];if(pt){nt.push(pt);const gt=new b.yGw;d.inverseBindMatrices!==void 0&&gt.fromArray(d.inverseBindMatrices.array,16*lt),it.push(gt)}else console.warn('THREE.GLTFLoader: Joint "%s" could not be found.',d.joints[lt])}et.bind(new b.OdW(nt,it),et.matrixWorld)}),h})}).then(function(h){e.add(h);const d=[];if(a.children){const _=a.children;for(let et=0,nt=_.length;et<nt;et++){const it=_[et];d.push(S1(it,h,i,s))}}return Promise.all(d)})}function C1(c,e,i){const s=e.attributes,a=[];function h(d,_){return i.getDependency("accessor",d).then(function(et){c.setAttribute(_,et)})}for(const d in s){const _=m0[d]||d.toLowerCase();_ in c.attributes||a.push(h(s[d],_))}if(e.indices!==void 0&&!c.index){const d=i.getDependency("accessor",e.indices).then(function(_){c.setIndex(_)});a.push(d)}return qo(c,e),function(d,_,et){const nt=_.attributes,it=new b.ZzF;if(nt.POSITION===void 0)return;{const pt=et.json.accessors[nt.POSITION],gt=pt.min,vt=pt.max;if(gt===void 0||vt===void 0)return void console.warn("THREE.GLTFLoader: Missing min/max properties for accessor POSITION.");if(it.set(new b.Pa4(gt[0],gt[1],gt[2]),new b.Pa4(vt[0],vt[1],vt[2])),pt.normalized){const Ct=Vw(Ep[pt.componentType]);it.min.multiplyScalar(Ct),it.max.multiplyScalar(Ct)}}const lt=_.targets;if(lt!==void 0){const pt=new b.Pa4,gt=new b.Pa4;for(let vt=0,Ct=lt.length;vt<Ct;vt++){const wt=lt[vt];if(wt.POSITION!==void 0){const xt=et.json.accessors[wt.POSITION],_t=xt.min,Pt=xt.max;if(_t!==void 0&&Pt!==void 0){if(gt.setX(Math.max(Math.abs(_t[0]),Math.abs(Pt[0]))),gt.setY(Math.max(Math.abs(_t[1]),Math.abs(Pt[1]))),gt.setZ(Math.max(Math.abs(_t[2]),Math.abs(Pt[2]))),xt.normalized){const Bt=Vw(Ep[xt.componentType]);gt.multiplyScalar(Bt)}pt.max(gt)}else console.warn("THREE.GLTFLoader: Missing min/max properties for accessor POSITION.")}}it.expandByVector(pt)}d.boundingBox=it;const ut=new b.aLr;it.getCenter(ut.center),ut.radius=it.min.distanceTo(it.max)/2,d.boundingSphere=ut}(c,e,i),Promise.all(a).then(function(){return e.targets!==void 0?function(d,_,et){let nt=!1,it=!1,lt=!1;for(let vt=0,Ct=_.length;vt<Ct;vt++){const wt=_[vt];if(wt.POSITION!==void 0&&(nt=!0),wt.NORMAL!==void 0&&(it=!0),wt.COLOR_0!==void 0&&(lt=!0),nt&&it&&lt)break}if(!nt&&!it&&!lt)return Promise.resolve(d);const ut=[],pt=[],gt=[];for(let vt=0,Ct=_.length;vt<Ct;vt++){const wt=_[vt];if(nt){const xt=wt.POSITION!==void 0?et.getDependency("accessor",wt.POSITION):d.attributes.position;ut.push(xt)}if(it){const xt=wt.NORMAL!==void 0?et.getDependency("accessor",wt.NORMAL):d.attributes.normal;pt.push(xt)}if(lt){const xt=wt.COLOR_0!==void 0?et.getDependency("accessor",wt.COLOR_0):d.attributes.color;gt.push(xt)}}return Promise.all([Promise.all(ut),Promise.all(pt),Promise.all(gt)]).then(function(vt){const Ct=vt[0],wt=vt[1],xt=vt[2];return nt&&(d.morphAttributes.position=Ct),it&&(d.morphAttributes.normal=wt),lt&&(d.morphAttributes.color=xt),d.morphTargetsRelative=!0,d})}(c,e.targets,i):c})}function iu(c,e){let i=c.getIndex();if(i===null){const d=[],_=c.getAttribute("position");if(_===void 0)return console.error("THREE.GLTFLoader.toTrianglesDrawMode(): Undefined position attribute. Processing not possible."),c;for(let et=0;et<_.count;et++)d.push(et);c.setIndex(d),i=c.getIndex()}const s=i.count-2,a=[];if(e===b.z$h)for(let d=1;d<=s;d++)a.push(i.getX(0)),a.push(i.getX(d)),a.push(i.getX(d+1));else for(let d=0;d<s;d++)d%2==0?(a.push(i.getX(d)),a.push(i.getX(d+1)),a.push(i.getX(d+2))):(a.push(i.getX(d+2)),a.push(i.getX(d+1)),a.push(i.getX(d)));a.length/3!==s&&console.error("THREE.GLTFLoader.toTrianglesDrawMode(): Unable to generate correct amount of triangles.");const h=c.clone();return h.setIndex(a),h}class fn extends d0{constructor(e){super(e),this.isGLTFLoader2=!0}async loadAsync(e,i){const s=await super.loadAsync(e,i),a=s?s.scene||s.scenes&&s.scenes.length>0&&s.scenes[0]:void 0;return a&&s.animations.length>0&&(a.animations=s.animations),a.traverse(h=>{h.userData.gltfUUID&&(h.uuid=h.userData.gltfUUID,delete h.userData.gltfUUID)}),a}register(e){return super.register(e)}}class Ty extends b.hH6{constructor(e){super(e),this.type=b.cLu}async loadAsync(e,i){const s=await this.parseAsync(e,i,!1),a=new b.IEO(s.data,s.width,s.height,b.wk1,this.type);return a.needsUpdate=!0,a.flipY=!0,a.encoding=b.rnI,a.minFilter=b.wem,a.magFilter=b.wem,a.source.data.complete=!0,a}async parseAsync(e,i,s=!1){if(!e.startsWith("data:")){this.responseType="blob";const _=await super.loadAsync(e,i);e=(e=await xp(_)).replace("application/octet-stream","image/png")}const a=await No(e);let h=Uint8Array;return this.type===b.cLu?h=Uint16Array:this.type===b.VzW&&(h=Uint32Array),{data:function(_,et=3,nt=Uint16Array,it=!1){let lt;const ut=_.byteLength>>2,pt=new nt(ut*et);for(let gt=0;gt<ut;gt++)lt=Math.pow(2,_[4*gt+3]-136),it?(pt[gt*et]=Math.min(_[4*gt]*lt,65504),pt[gt*et+1]=Math.min(_[4*gt+1]*lt,65504),pt[gt*et+2]=Math.min(_[4*gt+2]*lt,65504)):(pt[gt*et]=b.A5E.toHalfFloat(Math.min(_[4*gt]*lt,65504)),pt[gt*et+1]=b.A5E.toHalfFloat(Math.min(_[4*gt+1]*lt,65504)),pt[gt*et+2]=b.A5E.toHalfFloat(Math.min(_[4*gt+2]*lt,65504))),et===4&&(pt[gt*et+3]=b.A5E.toHalfFloat(1));return pt}(a.data,4,h,s),width:a.width,height:a.height}}setDataType(e){return this.type=e,this}}class dA extends b.Gql{constructor(e){super(e),this._imageLoader=new b.S3k(e)}parseTextures2(e,i,s){var a;for(const h of e){const d=(a=h==null?void 0:h.userData)===null||a===void 0?void 0:a.rootPath;if(d&&(!h.image||!i[h.image])){const _=new b.Hw6(this._imageLoader.load(d,s));if(!_)continue;h.image&&(_.uuid=h.image),i[_.uuid]=_,h.image=_.uuid}h.userData=to(h.userData,void 0,!1,{images:i})}return super.parseTextures(e,i)}parseMaterials2(e,i,s){const a={};return e.forEach(h=>{if(!h)return;const d={...h},_=Object.keys(d);for(const nt of _)if(nt==="map"||nt.endsWith("Map")){const it=d[nt];typeof it=="string"&&(i[it]?d[nt]=i[it]:(console.warn(`Texture ${it} not found`),delete d[nt]))}d.userData&&(d.userData=to(d.userData,void 0,!1,{textures:i}));const et=s.generateFromTemplateType(d.type,d);et&&(a[h.uuid]=et)}),a}}const Xl="WEBGI_viewer";function fm(c){io.Importers.push(new Wo(fn,["gltf","glb","data:model/gltf"],!0,(e,i)=>{if(!e)return e;const s=e,a=new dA(i.loadingManager);return s.register(f_(a,c)),s.register(p_()),s.register(Pv(a)),s.register(h=>new v0(h)),s.register(h=>new Qw(h)),s.register(h=>new LS(h)),s.register(h=>new Vm(h)),s.register(h=>{var d,_,et,nt,it,lt,ut,pt,gt;const vt=gu()+".drc",Ct=gu()+".ktx2",wt=(et=(_=(d=h.json)===null||d===void 0?void 0:d.extensionsRequired)===null||_===void 0?void 0:_.includes)===null||et===void 0?void 0:et.call(_,"KHR_draco_mesh_compression");if(wt){const _t=i.registerFile(vt);_t&&s.setDRACOLoader(_t)}!((lt=(it=(nt=h.json)===null||nt===void 0?void 0:nt.extensionsUsed)===null||it===void 0?void 0:it.includes)===null||lt===void 0)&&lt.call(it,"EXT_meshopt_compression")&&(window.MeshoptDecoder?(s.setMeshoptDecoder(window.MeshoptDecoder),h.options.meshoptDecoder=window.MeshoptDecoder):console.error("Add GLTFMeshOptPlugin to viewer to enable EXT_meshopt_compression decode"));const xt=(gt=(pt=(ut=h.json)===null||ut===void 0?void 0:ut.extensionsUsed)===null||pt===void 0?void 0:pt.includes)===null||gt===void 0?void 0:gt.call(pt,"KHR_texture_basisu");if(xt){const _t=i.registerFile(Ct);_t&&(s.setKTX2Loader(_t),h.options.ktx2Loader=_t)}return{name:"GLTF2_HELPER_PLUGIN",afterRoot:async _t=>{wt&&i.unregisterFile(vt),xt&&i.unregisterFile(Ct);const Pt=await jm(h,c,a);_t.scene.__importedViewerConfig=Pt}}}),s}))}const lp="WEBGI_light_extras",Fm="WEBGI_object3d_extras",Kl="WEBGI_material_extras",p_=c=>e=>({name:"__"+Fm,afterRoot:async i=>{(i.scenes||(i.scene?[i.scene]:[])).forEach(s=>{s.traverse(a=>{var h,d;if(!a.isObject3D)return;const _=(d=(h=a.userData)===null||h===void 0?void 0:h.gltfExtensions)===null||d===void 0?void 0:d[Fm];if(!_)return void(a.isLight&&!a.isAmbientLight&&(a.castShadow=!0));const et=_.castShadow!==void 0||_.receiveShadow!==void 0;_.castShadow!==void 0&&(a.castShadow=_.castShadow),_.receiveShadow!==void 0&&(a.receiveShadow=_.receiveShadow),_.visible!==void 0&&(a.visible=_.visible),_.frustumCulled!==void 0&&(a.frustumCulled=_.frustumCulled),_.renderOrder!==void 0&&(a.renderOrder=_.renderOrder),_.layers!==void 0&&(a.layers.mask=_.layers),et&&(a.userData.__keepShadowDef=!0),delete a.userData.gltfExtensions[Fm]})})}}),f_=(c,e)=>i=>({name:"__"+Kl,afterRoot:async s=>{var a,h,d;const _=s.scenes||(s.scene?[s.scene]:[]);for(const et of _){const nt=(h=(a=et.userData)===null||a===void 0?void 0:a.gltfExtensions)===null||h===void 0?void 0:h[Kl],it=nt&&await((d=e.getPlugin(qr))===null||d===void 0?void 0:d.importConfigResources(nt.resources||{}))||{};et.traverse(lt=>{var ut,pt;const gt=lt==null?void 0:lt.material;if(!(gt!=null&&gt.isMaterial))return;const vt=(pt=(ut=gt.userData)===null||ut===void 0?void 0:ut.gltfExtensions)===null||pt===void 0?void 0:pt[Kl];vt&&(vt.emissiveIntensity!==void 0&&(gt.emissiveIntensity=vt.emissiveIntensity),vt.fog!==void 0&&(gt.fog=vt.fog),vt.flatShading!==void 0&&(gt.flatShading=vt.flatShading),vt.blending!==void 0&&(gt.blending=vt.blending),vt.side!==void 0&&(gt.side=vt.side),vt.shadowSide!==void 0&&(gt.shadowSide=vt.shadowSide),vt.depthFunc!==void 0&&(gt.depthFunc=vt.depthFunc),vt.depthTest!==void 0&&(gt.depthTest=vt.depthTest),vt.depthWrite!==void 0&&(gt.depthWrite=vt.depthWrite),vt.colorWrite!==void 0&&(gt.colorWrite=vt.colorWrite),vt.wireframe!==void 0&&(gt.wireframe=vt.wireframe),vt.wireframeLinewidth!==void 0&&(gt.wireframeLinewidth=vt.wireframeLinewidth),vt.wireframeLinecap!==void 0&&(gt.wireframeLinecap=vt.wireframeLinecap),vt.wireframeLinejoin!==void 0&&(gt.wireframeLinejoin=vt.wireframeLinejoin),vt.rotation!==void 0&&(gt.rotation=vt.rotation),vt.polygonOffset!==void 0&&(gt.polygonOffset=vt.polygonOffset),vt.polygonOffsetFactor!==void 0&&(gt.polygonOffsetFactor=vt.polygonOffsetFactor),vt.polygonOffsetUnits!==void 0&&(gt.polygonOffsetUnits=vt.polygonOffsetUnits),vt.dithering!==void 0&&(gt.dithering=vt.dithering),vt.alphaToCoverage!==void 0&&(gt.alphaToCoverage=vt.alphaToCoverage),vt.premultipliedAlpha!==void 0&&(gt.premultipliedAlpha=vt.premultipliedAlpha),vt.toneMapped!==void 0&&(gt.toneMapped=vt.toneMapped),vt.reflectivity!==void 0&&(gt.reflectivity=vt.reflectivity),Object.entries(vt).forEach(([Ct,wt])=>{Ct.startsWith("_")||wt&&wt.resource&&typeof wt.resource=="string"&&(gt[Ct]=to(wt,gt[Ct],!1,it))}),delete gt.userData.gltfExtensions[Kl])}),nt&&delete et.userData.gltfExtensions[Kl]}}}),Pv=c=>e=>({name:"__"+lp,afterRoot:async i=>{(i.scenes||(i.scene?[i.scene]:[])).forEach(s=>{s.traverse(a=>{var h,d;if(!a.isLight)return;const _=(d=(h=a.userData)===null||h===void 0?void 0:h.gltfExtensions)===null||d===void 0?void 0:d[lp];_&&(!a.shadow&&_.shadow&&console.error("Light has no shadow, cannot import",a,_),_.shadow&&a.shadow&&(_.shadow.bias!==void 0&&(a.shadow.bias=_.shadow.bias),_.shadow.normalBias!==void 0&&(a.shadow.normalBias=_.shadow.normalBias),_.shadow.radius!==void 0&&(a.shadow.radius=_.shadow.radius),_.shadow.mapSize!==void 0&&a.shadow.mapSize.fromArray(_.shadow.mapSize),_.shadow.camera!==void 0&&(a.shadow.camera=c.parseObject(_.shadow.camera))),delete a.userData.gltfExtensions[lp])})})}});async function jm(c,e,i,s){var a;if(!s){const et=c.json.scenes||[];if(et.length!==1){for(const nt of et)await jm(c,e,nt);return}s=et[0]}const h=(a=s.extensions)===null||a===void 0?void 0:a[Xl];if(!h)return;const d=[];Object.values(h.resources).forEach(et=>{Object.values(et).forEach(nt=>{nt.url&&(nt.url.type==="Uint16Array"&&nt.url.data&&d.push(nt.url),nt.url.type==="Uint8Array"&&nt.url.data&&d.push(nt.url))})});for(const et of d){const nt=et.data.image,it=c.json.images[nt],lt=await c.getDependency("bufferView",it.bufferView);if(it.mimeType.startsWith("image/")&&et.type==="Uint16Array"&&et.encoding==="rgbe"){const ut=new Blob([lt],{type:it.mimeType}),pt="data:image/png;base64,"+btoa(await ut.text());et.data=(await new Ty().parseAsync(pt,void 0,!0)).data,delete et.encoding}else et.data=lt}const _={textures:{}};if(h.resources.textures&&c.json.textures)for(const[et,nt]of Object.entries(h.resources.textures)){if(nt.uuid||!et)continue;delete h.resources.textures[et];const it=c.json.textures.findIndex(lt=>{var ut,pt,gt,vt,Ct,wt,xt;return((ut=lt.extras)===null||ut===void 0?void 0:ut.uuid)===et||((vt=(gt=(pt=c.json.samplers)===null||pt===void 0?void 0:pt[lt.sampler])===null||gt===void 0?void 0:gt.extras)===null||vt===void 0?void 0:vt.uuid)===et||((xt=(wt=(Ct=c.json.images)===null||Ct===void 0?void 0:Ct[lt.source])===null||wt===void 0?void 0:wt.extras)===null||xt===void 0?void 0:xt.t_uuid)===et});it>=0&&(_.textures[et]=await c.getDependency("texture",it))}if(h.resources.materials&&c.json.materials)for(const[et,nt]of Object.entries(h.resources.materials)){if(nt.uuid||!et)continue;delete h.resources.materials[et];const it=c.json.materials.findIndex(lt=>{var ut;return((ut=lt.extras)===null||ut===void 0?void 0:ut.uuid)===et});it>=0&&(_.materials[et]=await c.getDependency("material",it))}return h.resources=await e.getPlugin(qr).importConfigResources(h.resources||{},i,_),h}const ru="WEBGI_materials_bumpmap",Rv="WEBGI_materials_displacementmap",g0="WEBGI_materials_alphamap",zm="WEBGI_materials_lightmap";class v0{constructor(e){this.parser=e,this.name=ru}async extendMaterialParams(e,i){const s=this.parser,a=s.json.materials[e];if(!a.extensions||!a.extensions[this.name])return Promise.resolve();const h=[],d=a.extensions[this.name];return d.bumpScale!==void 0&&(i.bumpScale=d.bumpScale),d.bumpTexture!==void 0&&h.push(s.assignTexture(i,"bumpMap",d.bumpTexture)),Promise.all(h)}}class Qw{constructor(e){this.parser=e,this.name=Rv}async extendMaterialParams(e,i){const s=this.parser,a=s.json.materials[e];if(!a.extensions||!a.extensions[this.name])return Promise.resolve();const h=[],d=a.extensions[this.name];return d.displacementScale!==void 0&&(i.displacementScale=d.displacementScale),d.displacementBias!==void 0&&(i.displacementBias=d.displacementBias),d.displacementTexture!==void 0&&h.push(s.assignTexture(i,"displacementMap",d.displacementTexture)),Promise.all(h)}}class LS{constructor(e){this.parser=e,this.name=zm}async extendMaterialParams(e,i){const s=this.parser,a=s.json.materials[e];if(!a.extensions||!a.extensions[this.name])return Promise.resolve();const h=[],d=a.extensions[this.name];return d.lightMapIntensity!==void 0&&(i.lightMapIntensity=d.lightMapIntensity),d.lightMapTexture!==void 0&&h.push(s.assignTexture(i,"lightMap",d.lightMapTexture)),Promise.all(h)}}class Vm{constructor(e){this.parser=e,this.name=g0}async extendMaterialParams(e,i){const s=this.parser,a=s.json.materials[e];if(!a.extensions||!a.extensions[this.name])return Promise.resolve();const h=[],d=a.extensions[this.name];return d.alphaTexture!==void 0&&h.push(s.assignTexture(i,"alphaMap",d.alphaTexture)),Promise.all(h)}}var m_=__webpackgi_require__(23);function Qm(){io.Importers.push(new Wo(m_.Q,["drc"],!0))}var Bv={},Ss=Uint8Array,Ol=Uint16Array,Cp=Uint32Array,cp=new Ss([0,0,0,0,0,0,0,0,1,1,1,1,2,2,2,2,3,3,3,3,4,4,4,4,5,5,5,5,0,0,0,0]),kv=new Ss([0,0,0,0,1,1,2,2,3,3,4,4,5,5,6,6,7,7,8,8,9,9,10,10,11,11,12,12,13,13,0,0]),Ov=new Ss([16,17,18,0,8,7,9,6,10,5,11,4,12,3,13,2,14,1,15]),Iy=function(c,e){for(var i=new Ol(31),s=0;s<31;++s)i[s]=e+=1<<c[s-1];var a=new Cp(i[30]);for(s=1;s<30;++s)for(var h=i[s];h<i[s+1];++h)a[h]=h-i[s]<<5|s;return[i,a]},_0=Iy(cp,2),Os=_0[0],Gm=_0[1];Os[28]=258,Gm[258]=28;for(var up=Iy(kv,0),M1=up[0],Gw=up[1],su=new Ol(32768),Co=0;Co<32768;++Co){var Ul=(43690&Co)>>>1|(21845&Co)<<1;Ul=(61680&(Ul=(52428&Ul)>>>2|(13107&Ul)<<2))>>>4|(3855&Ul)<<4,su[Co]=((65280&Ul)>>>8|(255&Ul)<<8)>>>1}var hp=function(c,e,i){for(var s=c.length,a=0,h=new Ol(e);a<s;++a)++h[c[a]-1];var d,_=new Ol(e);for(a=0;a<e;++a)_[a]=_[a-1]+h[a-1]<<1;if(i){d=new Ol(1<<e);var et=15-e;for(a=0;a<s;++a)if(c[a])for(var nt=a<<4|c[a],it=e-c[a],lt=_[c[a]-1]++<<it,ut=lt|(1<<it)-1;lt<=ut;++lt)d[su[lt]>>>et]=nt}else for(d=new Ol(s),a=0;a<s;++a)c[a]&&(d[a]=su[_[c[a]-1]++]>>>15-c[a]);return d},Mp=new Ss(288);for(Co=0;Co<144;++Co)Mp[Co]=8;for(Co=144;Co<256;++Co)Mp[Co]=9;for(Co=256;Co<280;++Co)Mp[Co]=7;for(Co=280;Co<288;++Co)Mp[Co]=8;var dp=new Ss(32);for(Co=0;Co<32;++Co)dp[Co]=5;var pA=hp(Mp,9,0),A0=hp(Mp,9,1),Dy=hp(dp,5,0),y0=hp(dp,5,1),Tp=function(c){for(var e=c[0],i=1;i<c.length;++i)c[i]>e&&(e=c[i]);return e},Jl=function(c,e,i){var s=e/8|0;return(c[s]|c[s+1]<<8)>>(7&e)&i},Lv=function(c,e){var i=e/8|0;return(c[i]|c[i+1]<<8|c[i+2]<<16)>>(7&e)},fA=function(c){return(c/8|0)+(7&c&&1)},_u=function(c,e,i){(e==null||e<0)&&(e=0),(i==null||i>c.length)&&(i=c.length);var s=new(c instanceof Ol?Ol:c instanceof Cp?Cp:Ss)(i-e);return s.set(c.subarray(e,i)),s},w0=function(c,e,i){var s=c.length;if(!s||i&&!i.l&&s<5)return e||new Ss(0);var a=!e||i,h=!i||i.i;i||(i={}),e||(e=new Ss(3*s));var d=function(ls){var mr=e.length;if(ls>mr){var Us=new Ss(Math.max(2*mr,ls));Us.set(e),e=Us}},_=i.f||0,et=i.p||0,nt=i.b||0,it=i.l,lt=i.d,ut=i.m,pt=i.n,gt=8*s;do{if(!it){i.f=_=Jl(c,et,1);var vt=Jl(c,et+1,3);if(et+=3,!vt){var Ct=c[(An=fA(et)+4)-4]|c[An-3]<<8,wt=An+Ct;if(wt>s){if(h)throw"unexpected EOF";break}a&&d(nt+Ct),e.set(c.subarray(An,wt),nt),i.b=nt+=Ct,i.p=et=8*wt;continue}if(vt==1)it=A0,lt=y0,ut=9,pt=5;else{if(vt!=2)throw"invalid block type";var xt=Jl(c,et,31)+257,_t=Jl(c,et+10,15)+4,Pt=xt+Jl(c,et+5,31)+1;et+=14;for(var Bt=new Ss(Pt),Ot=new Ss(19),Lt=0;Lt<_t;++Lt)Ot[Ov[Lt]]=Jl(c,et+3*Lt,7);et+=3*_t;var qt=Tp(Ot),en=(1<<qt)-1,cn=hp(Ot,qt,1);for(Lt=0;Lt<Pt;){var An,mn=cn[Jl(c,et,en)];if(et+=15&mn,(An=mn>>>4)<16)Bt[Lt++]=An;else{var Tn=0,vn=0;for(An==16?(vn=3+Jl(c,et,3),et+=2,Tn=Bt[Lt-1]):An==17?(vn=3+Jl(c,et,7),et+=3):An==18&&(vn=11+Jl(c,et,127),et+=7);vn--;)Bt[Lt++]=Tn}}var xn=Bt.subarray(0,xt),Un=Bt.subarray(xt);ut=Tp(xn),pt=Tp(Un),it=hp(xn,ut,1),lt=hp(Un,pt,1)}if(et>gt){if(h)throw"unexpected EOF";break}}a&&d(nt+131072);for(var Mn=(1<<ut)-1,Gn=(1<<pt)-1,rr=et;;rr=et){var dr=(Tn=it[Lv(c,et)&Mn])>>>4;if((et+=15&Tn)>gt){if(h)throw"unexpected EOF";break}if(!Tn)throw"invalid length/literal";if(dr<256)e[nt++]=dr;else{if(dr==256){rr=et,it=null;break}var _i=dr-254;if(dr>264){var xr=cp[Lt=dr-257];_i=Jl(c,et,(1<<xr)-1)+Os[Lt],et+=xr}var Cr=lt[Lv(c,et)&Gn],Mr=Cr>>>4;if(!Cr)throw"invalid distance";if(et+=15&Cr,Un=M1[Mr],Mr>3&&(xr=kv[Mr],Un+=Lv(c,et)&(1<<xr)-1,et+=xr),et>gt){if(h)throw"unexpected EOF";break}a&&d(nt+131072);for(var Lr=nt+_i;nt<Lr;nt+=4)e[nt]=e[nt-Un],e[nt+1]=e[nt+1-Un],e[nt+2]=e[nt+2-Un],e[nt+3]=e[nt+3-Un];nt=Lr}}i.l=it,i.p=rr,i.b=nt,it&&(_=1,i.m=ut,i.d=lt,i.n=pt)}while(!_);return nt==e.length?e:_u(e,0,nt)},Vp=function(c,e,i){i<<=7&e;var s=e/8|0;c[s]|=i,c[s+1]|=i>>>8},Hm=function(c,e,i){i<<=7&e;var s=e/8|0;c[s]|=i,c[s+1]|=i>>>8,c[s+2]|=i>>>16},mA=function(c,e){for(var i=[],s=0;s<c.length;++s)c[s]&&i.push({s,f:c[s]});var a=i.length,h=i.slice();if(!a)return[Xu,0];if(a==1){var d=new Ss(i[0].s+1);return d[i[0].s]=1,[d,1]}i.sort(function(Bt,Ot){return Bt.f-Ot.f}),i.push({s:-1,f:25001});var _=i[0],et=i[1],nt=0,it=1,lt=2;for(i[0]={s:-1,f:_.f+et.f,l:_,r:et};it!=a-1;)_=i[i[nt].f<i[lt].f?nt++:lt++],et=i[nt!=it&&i[nt].f<i[lt].f?nt++:lt++],i[it++]={s:-1,f:_.f+et.f,l:_,r:et};var ut=h[0].s;for(s=1;s<a;++s)h[s].s>ut&&(ut=h[s].s);var pt=new Ol(ut+1),gt=gA(i[it-1],pt,0);if(gt>e){s=0;var vt=0,Ct=gt-e,wt=1<<Ct;for(h.sort(function(Bt,Ot){return pt[Ot.s]-pt[Bt.s]||Bt.f-Ot.f});s<a;++s){var xt=h[s].s;if(!(pt[xt]>e))break;vt+=wt-(1<<gt-pt[xt]),pt[xt]=e}for(vt>>>=Ct;vt>0;){var _t=h[s].s;pt[_t]<e?vt-=1<<e-pt[_t]++-1:++s}for(;s>=0&&vt;--s){var Pt=h[s].s;pt[Pt]==e&&(--pt[Pt],++vt)}gt=e}return[new Ss(pt),gt]},gA=function(c,e,i){return c.s==-1?Math.max(gA(c.l,e,i+1),gA(c.r,e,i+1)):e[c.s]=i},no=function(c){for(var e=c.length;e&&!c[--e];);for(var i=new Ol(++e),s=0,a=c[0],h=1,d=function(et){i[s++]=et},_=1;_<=e;++_)if(c[_]==a&&_!=e)++h;else{if(!a&&h>2){for(;h>138;h-=138)d(32754);h>2&&(d(h>10?h-11<<5|28690:h-3<<5|12305),h=0)}else if(h>3){for(d(a),--h;h>6;h-=6)d(8304);h>2&&(d(h-3<<5|8208),h=0)}for(;h--;)d(a);h=1,a=c[_]}return[i.subarray(0,s),e]},Au=function(c,e){for(var i=0,s=0;s<e.length;++s)i+=c[s]*e[s];return i},pp=function(c,e,i){var s=i.length,a=fA(e+2);c[a]=255&s,c[a+1]=s>>>8,c[a+2]=255^c[a],c[a+3]=255^c[a+1];for(var h=0;h<s;++h)c[a+h+4]=i[h];return 8*(a+4+s)},Ip=function(c,e,i,s,a,h,d,_,et,nt,it){Vp(e,it++,i),++a[256];for(var lt=mA(a,15),ut=lt[0],pt=lt[1],gt=mA(h,15),vt=gt[0],Ct=gt[1],wt=no(ut),xt=wt[0],_t=wt[1],Pt=no(vt),Bt=Pt[0],Ot=Pt[1],Lt=new Ol(19),qt=0;qt<xt.length;++qt)Lt[31&xt[qt]]++;for(qt=0;qt<Bt.length;++qt)Lt[31&Bt[qt]]++;for(var en=mA(Lt,7),cn=en[0],An=en[1],mn=19;mn>4&&!cn[Ov[mn-1]];--mn);var Tn,vn,xn,Un,Mn=nt+5<<3,Gn=Au(a,Mp)+Au(h,dp)+d,rr=Au(a,ut)+Au(h,vt)+d+14+3*mn+Au(Lt,cn)+(2*Lt[16]+3*Lt[17]+7*Lt[18]);if(Mn<=Gn&&Mn<=rr)return pp(e,it,c.subarray(et,et+nt));if(Vp(e,it,1+(rr<Gn)),it+=2,rr<Gn){Tn=hp(ut,pt,0),vn=ut,xn=hp(vt,Ct,0),Un=vt;var dr=hp(cn,An,0);for(Vp(e,it,_t-257),Vp(e,it+5,Ot-1),Vp(e,it+10,mn-4),it+=14,qt=0;qt<mn;++qt)Vp(e,it+3*qt,cn[Ov[qt]]);it+=3*mn;for(var _i=[xt,Bt],xr=0;xr<2;++xr){var Cr=_i[xr];for(qt=0;qt<Cr.length;++qt){var Mr=31&Cr[qt];Vp(e,it,dr[Mr]),it+=cn[Mr],Mr>15&&(Vp(e,it,Cr[qt]>>>5&127),it+=Cr[qt]>>>12)}}}else Tn=pA,vn=Mp,xn=Dy,Un=dp;for(qt=0;qt<_;++qt)if(s[qt]>255){Mr=s[qt]>>>18&31,Hm(e,it,Tn[Mr+257]),it+=vn[Mr+257],Mr>7&&(Vp(e,it,s[qt]>>>23&31),it+=cp[Mr]);var Lr=31&s[qt];Hm(e,it,xn[Lr]),it+=Un[Lr],Lr>3&&(Hm(e,it,s[qt]>>>5&8191),it+=kv[Lr])}else Hm(e,it,Tn[s[qt]]),it+=vn[s[qt]];return Hm(e,it,Tn[256]),it+vn[256]},mm=new Cp([65540,131080,131088,131104,262176,1048704,1048832,2114560,2117632]),Xu=new Ss(0),Wm=function(c,e,i,s,a,h){var d=c.length,_=new Ss(s+d+5*(1+Math.ceil(d/7e3))+a),et=_.subarray(s,_.length-a),nt=0;if(!e||d<8)for(var it=0;it<=d;it+=65535){var lt=it+65535;lt<d?nt=pp(et,nt,c.subarray(it,lt)):(et[it]=h,nt=pp(et,nt,c.subarray(it,d)))}else{for(var ut=mm[e-1],pt=ut>>>13,gt=8191&ut,vt=(1<<i)-1,Ct=new Ol(32768),wt=new Ol(vt+1),xt=Math.ceil(i/3),_t=2*xt,Pt=function(To){return(c[To]^c[To+1]<<xt^c[To+2]<<_t)&vt},Bt=new Cp(25e3),Ot=new Ol(288),Lt=new Ol(32),qt=0,en=0,cn=(it=0,0),An=0,mn=0;it<d;++it){var Tn=Pt(it),vn=32767&it,xn=wt[Tn];if(Ct[vn]=xn,wt[Tn]=vn,An<=it){var Un=d-it;if((qt>7e3||cn>24576)&&Un>423){nt=Ip(c,et,0,Bt,Ot,Lt,en,cn,mn,it-mn,nt),cn=qt=en=0,mn=it;for(var Mn=0;Mn<286;++Mn)Ot[Mn]=0;for(Mn=0;Mn<30;++Mn)Lt[Mn]=0}var Gn=2,rr=0,dr=gt,_i=vn-xn&32767;if(Un>2&&Tn==Pt(it-_i))for(var xr=Math.min(pt,Un)-1,Cr=Math.min(32767,it),Mr=Math.min(258,Un);_i<=Cr&&--dr&&vn!=xn;){if(c[it+Gn]==c[it+Gn-_i]){for(var Lr=0;Lr<Mr&&c[it+Lr]==c[it+Lr-_i];++Lr);if(Lr>Gn){if(Gn=Lr,rr=_i,Lr>xr)break;var ls=Math.min(_i,Lr-2),mr=0;for(Mn=0;Mn<ls;++Mn){var Us=it-_i+Mn+32768&32767,Ws=Us-Ct[Us]+32768&32767;Ws>mr&&(mr=Ws,xn=Us)}}}_i+=(vn=xn)-(xn=Ct[vn])+32768&32767}if(rr){Bt[cn++]=268435456|Gm[Gn]<<18|Gw[rr];var Fs=31&Gm[Gn],co=31&Gw[rr];en+=cp[Fs]+kv[co],++Ot[257+Fs],++Lt[co],An=it+Gn,++qt}else Bt[cn++]=c[it],++Ot[c[it]]}}nt=Ip(c,et,h,Bt,Ot,Lt,en,cn,mn,it-mn,nt),!h&&7&nt&&(nt=pp(et,nt+1,Xu))}return _u(_,0,s+fA(nt)+a)},Py=function(){for(var c=new Int32Array(256),e=0;e<256;++e){for(var i=e,s=9;--s;)i=(1&i&&-306674912)^i>>>1;c[e]=i}return c}(),Nv=function(){var c=-1;return{p:function(e){for(var i=c,s=0;s<e.length;++s)i=Py[255&i^e[s]]^i>>>8;c=i},d:function(){return~c}}},vA=function(){var c=1,e=0;return{p:function(i){for(var s=c,a=e,h=i.length,d=0;d!=h;){for(var _=Math.min(d+2655,h);d<_;++d)a+=s+=i[d];s=(65535&s)+15*(s>>16),a=(65535&a)+15*(a>>16)}c=s,e=a},d:function(){return(255&(c%=65521))<<24|c>>>8<<16|(255&(e%=65521))<<8|e>>>8}}},qm=function(c,e,i,s,a){return Wm(c,e.level==null?6:e.level,e.mem==null?Math.ceil(1.5*Math.max(8,Math.min(13,Math.log(c.length)))):12+e.mem,i,s,!a)},yu=function(c,e){var i={};for(var s in c)i[s]=c[s];for(var s in e)i[s]=e[s];return i},T1=function(c,e,i){for(var s=c(),a=c.toString(),h=a.slice(a.indexOf("[")+1,a.lastIndexOf("]")).replace(/ /g,"").split(","),d=0;d<s.length;++d){var _=s[d],et=h[d];if(typeof _=="function"){e+=";"+et+"=";var nt=_.toString();if(_.prototype)if(nt.indexOf("[native code]")!=-1){var it=nt.indexOf(" ",8)+1;e+=nt.slice(it,nt.indexOf("(",it))}else for(var lt in e+=nt,_.prototype)e+=";"+et+".prototype."+lt+"="+_.prototype[lt].toString();else e+=nt}else i[et]=_}return[e,i]},Fl=[],gm=function(c,e,i,s){var a;if(!Fl[i]){for(var h="",d={},_=c.length-1,et=0;et<_;++et)h=(a=T1(c[et],h,d))[0],d=a[1];Fl[i]=T1(c[_],h,d)}var nt=yu({},Fl[i][1]);return function(it,lt,ut,pt,gt){var vt=new Worker(Bv[lt]||(Bv[lt]=URL.createObjectURL(new Blob([it],{type:"text/javascript"}))));return vt.onerror=function(Ct){return gt(Ct.error,null)},vt.onmessage=function(Ct){return gt(null,Ct.data)},vt.postMessage(ut,pt),vt}(Fl[i][0]+";onmessage=function(e){for(var k in e.data)self[k]=e.data[k];onmessage="+e.toString()+"}",i,nt,function(it){var lt=[];for(var ut in it)(it[ut]instanceof Ss||it[ut]instanceof Ol||it[ut]instanceof Cp)&&lt.push((it[ut]=new it[ut].constructor(it[ut])).buffer);return lt}(nt),s)},Uo=function(){return[Ss,Ol,Cp,cp,kv,Ov,Os,M1,A0,y0,su,hp,Tp,Jl,Lv,fA,_u,w0,jv,Uv,g_]},vm=function(){return[Ss,Ol,Cp,cp,kv,Ov,Gm,Gw,pA,Mp,Dy,dp,su,mm,Xu,hp,Vp,Hm,mA,gA,no,Au,pp,Ip,fA,_u,Wm,qm,Ku,Uv]},Ro=function(){return[Rn,ds,hn,Nv,Py]},I1=function(){return[lr,Nr]},D1=function(){return[ws,hn,vA]},P1=function(){return[fs]},Uv=function(c){return postMessage(c,[c.buffer])},g_=function(c){return c&&c.size&&new Ss(c.size)},v_=function(c,e,i,s,a,h){var d=gm(i,s,a,function(_,et){d.terminate(),h(_,et)});return d.postMessage([c,e],e.consume?[c.buffer]:[]),function(){d.terminate()}},At=function(c){return c.ondata=function(e,i){return postMessage([e,i],[e.buffer])},function(e){return c.push(e.data[0],e.data[1])}},st=function(c,e,i,s,a){var h,d=gm(c,s,a,function(_,et){_?(d.terminate(),e.ondata.call(e,_)):(et[1]&&d.terminate(),e.ondata.call(e,_,et[0],et[1]))});d.postMessage(i),e.push=function(_,et){if(h)throw"stream finished";if(!e.ondata)throw"no stream handler";d.postMessage([_,h=et],[_.buffer])},e.terminate=function(){d.terminate()}},ht=function(c,e){return c[e]|c[e+1]<<8},Mt=function(c,e){return(c[e]|c[e+1]<<8|c[e+2]<<16|c[e+3]<<24)>>>0},Ht=function(c,e){return Mt(c,e)+4294967296*Mt(c,e+4)},hn=function(c,e,i){for(;i;++e)c[e]=i,i>>>=8},Rn=function(c,e){var i=e.filename;if(c[0]=31,c[1]=139,c[2]=8,c[8]=e.level<2?4:e.level==9?2:0,c[9]=3,e.mtime!=0&&hn(c,4,Math.floor(new Date(e.mtime||Date.now())/1e3)),i){c[3]=8;for(var s=0;s<=i.length;++s)c[s+10]=i.charCodeAt(s)}},lr=function(c){if(c[0]!=31||c[1]!=139||c[2]!=8)throw"invalid gzip data";var e=c[3],i=10;4&e&&(i+=c[10]|2+(c[11]<<8));for(var s=(e>>3&1)+(e>>4&1);s>0;s-=!c[i++]);return i+(2&e)},Nr=function(c){var e=c.length;return(c[e-4]|c[e-3]<<8|c[e-2]<<16|c[e-1]<<24)>>>0},ds=function(c){return 10+(c.filename&&c.filename.length+1||0)},ws=function(c,e){var i=e.level,s=i==0?0:i<6?1:i==9?3:2;c[0]=120,c[1]=s<<6|(s?32-2*s:1)},fs=function(c){if((15&c[0])!=8||c[0]>>>4>7||(c[0]<<8|c[1])%31)throw"invalid zlib data";if(32&c[1])throw"invalid zlib data: preset dictionaries not supported"};function Pu(c,e){return e||typeof c!="function"||(e=c,c={}),this.ondata=e,c}var Bo=function(){function c(e,i){i||typeof e!="function"||(i=e,e={}),this.ondata=i,this.o=e||{}}return c.prototype.p=function(e,i){this.ondata(qm(e,this.o,0,0,!i),i)},c.prototype.push=function(e,i){if(this.d)throw"stream finished";if(!this.ondata)throw"no stream handler";this.d=i,this.p(e,i||!1)},c}(),Qp=function(){return function(c,e){st([vm,function(){return[At,Bo]}],this,Pu.call(this,c,e),function(i){var s=new Bo(i.data);onmessage=At(s)},6)}}();function Dp(c,e,i){if(i||(i=e,e={}),typeof i!="function")throw"no callback";return v_(c,e,[vm],function(s){return Uv(Ku(s.data[0],s.data[1]))},0,i)}function Ku(c,e){return qm(c,e||{},0,0)}var _l=function(){function c(e){this.s={},this.p=new Ss(0),this.ondata=e}return c.prototype.e=function(e){if(this.d)throw"stream finished";if(!this.ondata)throw"no stream handler";var i=this.p.length,s=new Ss(i+e.length);s.set(this.p),s.set(e,i),this.p=s},c.prototype.c=function(e){this.d=this.s.i=e||!1;var i=this.s.b,s=w0(this.p,this.o,this.s);this.ondata(_u(s,i,this.s.b),this.d),this.o=_u(s,this.s.b-32768),this.s.b=this.o.length,this.p=_u(this.p,this.s.p/8|0),this.s.p&=7},c.prototype.push=function(e,i){this.e(e),this.c(i)},c}(),Fv=function(){return function(c){this.ondata=c,st([Uo,function(){return[At,_l]}],this,0,function(){var e=new _l;onmessage=At(e)},7)}}();function x0(c,e,i){if(i||(i=e,e={}),typeof i!="function")throw"no callback";return v_(c,e,[Uo],function(s){return Uv(jv(s.data[0],g_(s.data[1])))},1,i)}function jv(c,e){return w0(c,e)}var b0=function(){function c(e,i){this.c=Nv(),this.l=0,this.v=1,Bo.call(this,e,i)}return c.prototype.push=function(e,i){Bo.prototype.push.call(this,e,i)},c.prototype.p=function(e,i){this.c.p(e),this.l+=e.length;var s=qm(e,this.o,this.v&&ds(this.o),i&&8,!i);this.v&&(Rn(s,this.o),this.v=0),i&&(hn(s,s.length-8,this.c.d()),hn(s,s.length-4,this.l)),this.ondata(s,i)},c}(),_A=function(){return function(c,e){st([vm,Ro,function(){return[At,Bo,b0]}],this,Pu.call(this,c,e),function(i){var s=new b0(i.data);onmessage=At(s)},8)}}();function Hw(c,e,i){if(i||(i=e,e={}),typeof i!="function")throw"no callback";return v_(c,e,[vm,Ro,function(){return[AA]}],function(s){return Uv(AA(s.data[0],s.data[1]))},2,i)}function AA(c,e){e||(e={});var i=Nv(),s=c.length;i.p(c);var a=qm(c,e,ds(e),8),h=a.length;return Rn(a,e),hn(a,h-8,i.d()),hn(a,h-4,s),a}var yA=function(){function c(e){this.v=1,_l.call(this,e)}return c.prototype.push=function(e,i){if(_l.prototype.e.call(this,e),this.v){var s=this.p.length>3?lr(this.p):4;if(s>=this.p.length&&!i)return;this.p=this.p.subarray(s),this.v=0}if(i){if(this.p.length<8)throw"invalid gzip stream";this.p=this.p.subarray(0,-8)}_l.prototype.c.call(this,i)},c}(),Ww=function(){return function(c){this.ondata=c,st([Uo,I1,function(){return[At,_l,yA]}],this,0,function(){var e=new yA;onmessage=At(e)},9)}}();function R1(c,e,i){if(i||(i=e,e={}),typeof i!="function")throw"no callback";return v_(c,e,[Uo,I1,function(){return[wA]}],function(s){return Uv(wA(s.data[0]))},3,i)}function wA(c,e){return w0(c.subarray(lr(c),-8),e||new Ss(Nr(c)))}var Zl=function(){function c(e,i){this.c=vA(),this.v=1,Bo.call(this,e,i)}return c.prototype.push=function(e,i){Bo.prototype.push.call(this,e,i)},c.prototype.p=function(e,i){this.c.p(e);var s=qm(e,this.o,this.v&&2,i&&4,!i);this.v&&(ws(s,this.o),this.v=0),i&&hn(s,s.length-4,this.c.d()),this.ondata(s,i)},c}(),B1=function(){return function(c,e){st([vm,D1,function(){return[At,Bo,Zl]}],this,Pu.call(this,c,e),function(i){var s=new Zl(i.data);onmessage=At(s)},10)}}();function E0(c,e,i){if(i||(i=e,e={}),typeof i!="function")throw"no callback";return v_(c,e,[vm,D1,function(){return[S0]}],function(s){return Uv(S0(s.data[0],s.data[1]))},4,i)}function S0(c,e){e||(e={});var i=vA();i.p(c);var s=qm(c,e,2,4);return ws(s,e),hn(s,s.length-4,i.d()),s}var ou=function(){function c(e){this.v=1,_l.call(this,e)}return c.prototype.push=function(e,i){if(_l.prototype.e.call(this,e),this.v){if(this.p.length<2&&!i)return;this.p=this.p.subarray(2),this.v=0}if(i){if(this.p.length<4)throw"invalid zlib stream";this.p=this.p.subarray(0,-4)}_l.prototype.c.call(this,i)},c}(),NS=function(){return function(c){this.ondata=c,st([Uo,P1,function(){return[At,_l,ou]}],this,0,function(){var e=new ou;onmessage=At(e)},11)}}();function _m(c,e,i){if(i||(i=e,e={}),typeof i!="function")throw"no callback";return v_(c,e,[Uo,P1,function(){return[xA]}],function(s){return Uv(xA(s.data[0],g_(s.data[1])))},5,i)}function xA(c,e){return w0((fs(c),c.subarray(2,-4)),e)}var wu=function(){function c(e){this.G=yA,this.I=_l,this.Z=ou,this.ondata=e}return c.prototype.push=function(e,i){if(!this.ondata)throw"no stream handler";if(this.s)this.s.push(e,i);else{if(this.p&&this.p.length){var s=new Ss(this.p.length+e.length);s.set(this.p),s.set(e,this.p.length)}else this.p=e;if(this.p.length>2){var a=this,h=function(){a.ondata.apply(a,arguments)};this.s=this.p[0]==31&&this.p[1]==139&&this.p[2]==8?new this.G(h):(15&this.p[0])!=8||this.p[0]>>4>7||(this.p[0]<<8|this.p[1])%31?new this.I(h):new this.Z(h),this.s.push(this.p,i),this.p=null}}},c}(),Ry=function(){function c(e){this.G=Ww,this.I=Fv,this.Z=NS,this.ondata=e}return c.prototype.push=function(e,i){wu.prototype.push.call(this,e,i)},c}();function OM(c,e,i){if(i||(i=e,e={}),typeof i!="function")throw"no callback";return c[0]==31&&c[1]==139&&c[2]==8?R1(c,e,i):(15&c[0])!=8||c[0]>>4>7||(c[0]<<8|c[1])%31?x0(c,e,i):_m(c,e,i)}function qw(c,e){return c[0]==31&&c[1]==139&&c[2]==8?wA(c,e):(15&c[0])!=8||c[0]>>4>7||(c[0]<<8|c[1])%31?jv(c,e):xA(c,e)}var k1=function(c,e,i,s){for(var a in c){var h=c[a],d=e+a;h instanceof Ss?i[d]=[h,s]:Array.isArray(h)?i[d]=[h[0],yu(s,h[1])]:k1(h,d+"/",i,s)}},O1=typeof TextEncoder<"u"&&new TextEncoder,US=typeof TextDecoder<"u"&&new TextDecoder,LM=0;try{US.decode(Xu,{stream:!0}),LM=1}catch{}var C0=function(c){for(var e="",i=0;;){var s=c[i++],a=(s>127)+(s>223)+(s>239);if(i+a>c.length)return[e,_u(c,i-1)];a?a==3?(s=((15&s)<<18|(63&c[i++])<<12|(63&c[i++])<<6|63&c[i++])-65536,e+=String.fromCharCode(55296|s>>10,56320|1023&s)):e+=1&a?String.fromCharCode((31&s)<<6|63&c[i++]):String.fromCharCode((15&s)<<12|(63&c[i++])<<6|63&c[i++]):e+=String.fromCharCode(s)}},By=function(){function c(e){this.ondata=e,LM?this.t=new TextDecoder:this.p=Xu}return c.prototype.push=function(e,i){if(!this.ondata)throw"no callback";if(i=!!i,this.t){if(this.ondata(this.t.decode(e,{stream:!0}),i),i){if(this.t.decode().length)throw"invalid utf-8 data";this.t=null}}else{if(!this.p)throw"stream finished";var s=new Ss(this.p.length+e.length);s.set(this.p),s.set(e,this.p.length);var a=C0(s),h=a[0],d=a[1];if(i){if(d.length)throw"invalid utf-8 data";this.p=null}else this.p=d;this.ondata(h,i)}},c}(),L1=function(){function c(e){this.ondata=e}return c.prototype.push=function(e,i){if(!this.ondata)throw"no callback";if(this.d)throw"stream finished";this.ondata(Ym(e),this.d=i||!1)},c}();function Ym(c,e){if(e){for(var i=new Ss(c.length),s=0;s<c.length;++s)i[s]=c.charCodeAt(s);return i}if(O1)return O1.encode(c);var a=c.length,h=new Ss(c.length+(c.length>>1)),d=0,_=function(it){h[d++]=it};for(s=0;s<a;++s){if(d+5>h.length){var et=new Ss(d+8+(a-s<<1));et.set(h),h=et}var nt=c.charCodeAt(s);nt<128||e?_(nt):nt<2048?(_(192|nt>>6),_(128|63&nt)):nt>55295&&nt<57344?(_(240|(nt=65536+(1047552&nt)|1023&c.charCodeAt(++s))>>18),_(128|nt>>12&63),_(128|nt>>6&63),_(128|63&nt)):(_(224|nt>>12),_(128|nt>>6&63),_(128|63&nt))}return _u(h,0,d)}function N1(c,e){if(e){for(var i="",s=0;s<c.length;s+=16384)i+=String.fromCharCode.apply(null,c.subarray(s,s+16384));return i}if(US)return US.decode(c);var a=C0(c),h=a[0];if(a[1].length)throw"invalid utf-8 data";return h}var NM=function(c){return c==1?3:c<6?2:c==9?1:0},bA=function(c,e){return e+30+ht(c,e+26)+ht(c,e+28)},Zs=function(c,e,i){var s=ht(c,e+28),a=N1(c.subarray(e+46,e+46+s),!(2048&ht(c,e+8))),h=e+46+s,d=Mt(c,e+20),_=i&&d==4294967295?Xr(c,h):[d,Mt(c,e+24),Mt(c,e+42)],et=_[0],nt=_[1],it=_[2];return[ht(c,e+10),et,nt,a,h+ht(c,e+30)+ht(c,e+32),it]},Xr=function(c,e){for(;ht(c,e)!=1;e+=4+ht(c,e+2));return[Ht(c,e+12),Ht(c,e+4),Ht(c,e+20)]},zl=function(c){var e=0;if(c)for(var i in c){var s=c[i].length;if(s>65535)throw"extra field too long";e+=s+4}return e},ky=function(c,e,i,s,a,h,d,_){var et=s.length,nt=i.extra,it=_&&_.length,lt=zl(nt);hn(c,e,d!=null?33639248:67324752),e+=4,d!=null&&(c[e++]=20,c[e++]=i.os),c[e]=20,e+=2,c[e++]=i.flag<<1|(h==null&&8),c[e++]=a&&8,c[e++]=255&i.compression,c[e++]=i.compression>>8;var ut=new Date(i.mtime==null?Date.now():i.mtime),pt=ut.getFullYear()-1980;if(pt<0||pt>119)throw"date not in range 1980-2099";if(hn(c,e,pt<<25|ut.getMonth()+1<<21|ut.getDate()<<16|ut.getHours()<<11|ut.getMinutes()<<5|ut.getSeconds()>>>1),e+=4,h!=null&&(hn(c,e,i.crc),hn(c,e+4,h),hn(c,e+8,i.size)),hn(c,e+12,et),hn(c,e+14,lt),e+=16,d!=null&&(hn(c,e,it),hn(c,e+6,i.attrs),hn(c,e+10,d),e+=14),c.set(s,e),e+=et,lt)for(var gt in nt){var vt=nt[gt],Ct=vt.length;hn(c,e,+gt),hn(c,e+2,Ct),c.set(vt,e+4),e+=4+Ct}return it&&(c.set(_,e),e+=it),e},FS=function(c,e,i,s,a){hn(c,e,101010256),hn(c,e+8,i),hn(c,e+10,i),hn(c,e+12,s),hn(c,e+16,a)},Yw=function(){function c(e){this.filename=e,this.c=Nv(),this.size=0,this.compression=0}return c.prototype.process=function(e,i){this.ondata(null,e,i)},c.prototype.push=function(e,i){if(!this.ondata)throw"no callback - add to ZIP archive before pushing";this.c.p(e),this.size+=e.length,i&&(this.crc=this.c.d()),this.process(e,i||!1)},c}(),iD=function(){function c(e,i){var s=this;i||(i={}),Yw.call(this,e),this.d=new Bo(i,function(a,h){s.ondata(null,a,h)}),this.compression=8,this.flag=NM(i.level)}return c.prototype.process=function(e,i){try{this.d.push(e,i)}catch(s){this.ondata(s,null,i)}},c.prototype.push=function(e,i){Yw.prototype.push.call(this,e,i)},c}(),rD=function(){function c(e,i){var s=this;i||(i={}),Yw.call(this,e),this.d=new Qp(i,function(a,h,d){s.ondata(a,h,d)}),this.compression=8,this.flag=NM(i.level),this.terminate=this.d.terminate}return c.prototype.process=function(e,i){this.d.push(e,i)},c.prototype.push=function(e,i){Yw.prototype.push.call(this,e,i)},c}(),sD=function(){function c(e){this.ondata=e,this.u=[],this.d=1}return c.prototype.add=function(e){var i=this;if(2&this.d)throw"stream finished";var s=Ym(e.filename),a=s.length,h=e.comment,d=h&&Ym(h),_=a!=e.filename.length||d&&h.length!=d.length,et=a+zl(e.extra)+30;if(a>65535)throw"filename too long";var nt=new Ss(et);ky(nt,0,e,s,_);var it=[nt],lt=function(){for(var Ct=0,wt=it;Ct<wt.length;Ct++){var xt=wt[Ct];i.ondata(null,xt,!1)}it=[]},ut=this.d;this.d=0;var pt=this.u.length,gt=yu(e,{f:s,u:_,o:d,t:function(){e.terminate&&e.terminate()},r:function(){if(lt(),ut){var Ct=i.u[pt+1];Ct?Ct.r():i.d=1}ut=1}}),vt=0;e.ondata=function(Ct,wt,xt){if(Ct)i.ondata(Ct,wt,xt),i.terminate();else if(vt+=wt.length,it.push(wt),xt){var _t=new Ss(16);hn(_t,0,134695760),hn(_t,4,e.crc),hn(_t,8,vt),hn(_t,12,e.size),it.push(_t),gt.c=vt,gt.b=et+vt+16,gt.crc=e.crc,gt.size=e.size,ut&&gt.r(),ut=1}else ut&&lt()},this.u.push(gt)},c.prototype.end=function(){var e=this;if(2&this.d)throw 1&this.d?"stream finishing":"stream finished";this.d?this.e():this.u.push({r:function(){1&e.d&&(e.u.splice(-1,1),e.e())},t:function(){}}),this.d=3},c.prototype.e=function(){for(var e=0,i=0,s=0,a=0,h=this.u;a<h.length;a++)s+=46+(nt=h[a]).f.length+zl(nt.extra)+(nt.o?nt.o.length:0);for(var d=new Ss(s+22),_=0,et=this.u;_<et.length;_++){var nt=et[_];ky(d,e,nt,nt.f,nt.u,nt.c,i,nt.o),e+=46+nt.f.length+zl(nt.extra)+(nt.o?nt.o.length:0),i+=nt.b}FS(d,e,this.u.length,s,i),this.ondata(null,d,!0),this.d=2},c.prototype.terminate=function(){for(var e=0,i=this.u;e<i.length;e++)i[e].t();this.d=2},c}();function U1(c,e,i){if(i||(i=e,e={}),typeof i!="function")throw"no callback";var s={};k1(c,"",s,e);var a=Object.keys(s),h=a.length,d=0,_=0,et=h,nt=new Array(h),it=[],lt=function(){for(var vt=0;vt<it.length;++vt)it[vt]()},ut=function(){var vt=new Ss(_+22),Ct=d,wt=_-d;_=0;for(var xt=0;xt<et;++xt){var _t=nt[xt];try{var Pt=_t.c.length;ky(vt,_,_t,_t.f,_t.u,Pt);var Bt=30+_t.f.length+zl(_t.extra),Ot=_+Bt;vt.set(_t.c,Ot),ky(vt,d,_t,_t.f,_t.u,Pt,_,_t.m),d+=16+Bt+(_t.m?_t.m.length:0),_=Ot+Pt}catch(Lt){return i(Lt,null)}}FS(vt,d,nt.length,wt,Ct),i(null,vt)};h||ut();for(var pt=function(vt){var Ct=a[vt],wt=s[Ct],xt=wt[0],_t=wt[1],Pt=Nv(),Bt=xt.length;Pt.p(xt);var Ot=Ym(Ct),Lt=Ot.length,qt=_t.comment,en=qt&&Ym(qt),cn=en&&en.length,An=zl(_t.extra),mn=_t.level==0?0:8,Tn=function(vn,xn){if(vn)lt(),i(vn,null);else{var Un=xn.length;nt[vt]=yu(_t,{size:Bt,crc:Pt.d(),c:xn,f:Ot,m:en,u:Lt!=Ct.length||en&&qt.length!=cn,compression:mn}),d+=30+Lt+An+Un,_+=76+2*(Lt+An)+(cn||0)+Un,--h||ut()}};if(Lt>65535&&Tn("filename too long",null),mn)if(Bt<16e4)try{Tn(null,Ku(xt,_t))}catch(vn){Tn(vn,null)}else it.push(Dp(xt,_t,Tn));else Tn(null,xt)},gt=0;gt<et;++gt)pt(gt);return lt}function jS(c,e){e||(e={});var i={},s=[];k1(c,"",i,e);var a=0,h=0;for(var d in i){var _=i[d],et=_[0],nt=_[1],it=nt.level==0?0:8,lt=(Lt=Ym(d)).length,ut=nt.comment,pt=ut&&Ym(ut),gt=pt&&pt.length,vt=zl(nt.extra);if(lt>65535)throw"filename too long";var Ct=it?Ku(et,nt):et,wt=Ct.length,xt=Nv();xt.p(et),s.push(yu(nt,{size:et.length,crc:xt.d(),c:Ct,f:Lt,m:pt,u:lt!=d.length||pt&&ut.length!=gt,o:a,compression:it})),a+=30+lt+vt+wt,h+=76+2*(lt+vt)+(gt||0)+wt}for(var _t=new Ss(h+22),Pt=a,Bt=h-a,Ot=0;Ot<s.length;++Ot){var Lt=s[Ot];ky(_t,Lt.o,Lt,Lt.f,Lt.u,Lt.c.length);var qt=30+Lt.f.length+zl(Lt.extra);_t.set(Lt.c,Lt.o+qt),ky(_t,a,Lt,Lt.f,Lt.u,Lt.c.length,Lt.o,Lt.m),a+=16+qt+(Lt.m?Lt.m.length:0)}return FS(_t,a,s.length,Bt,Pt),_t}var F1=function(){function c(){}return c.prototype.push=function(e,i){this.ondata(null,e,i)},c.compression=0,c}(),UM=function(){function c(){var e=this;this.i=new _l(function(i,s){e.ondata(null,i,s)})}return c.prototype.push=function(e,i){try{this.i.push(e,i)}catch(s){this.ondata(s,e,i)}},c.compression=8,c}(),zS=function(){function c(e,i){var s=this;i<32e4?this.i=new _l(function(a,h){s.ondata(null,a,h)}):(this.i=new Fv(function(a,h,d){s.ondata(a,h,d)}),this.terminate=this.i.terminate)}return c.prototype.push=function(e,i){this.i.terminate&&(e=_u(e,0)),this.i.push(e,i)},c.compression=8,c}(),EA=function(){function c(e){this.onfile=e,this.k=[],this.o={0:F1},this.p=Xu}return c.prototype.push=function(e,i){var s=this;if(!this.onfile)throw"no callback";if(!this.p)throw"stream finished";if(this.c>0){var a=Math.min(this.c,e.length),h=e.subarray(0,a);if(this.c-=a,this.d?this.d.push(h,!this.c):this.k[0].push(h),(e=e.subarray(a)).length)return this.push(e,i)}else{var d=0,_=0,et=void 0,nt=void 0;this.p.length?e.length?((nt=new Ss(this.p.length+e.length)).set(this.p),nt.set(e,this.p.length)):nt=this.p:nt=e;for(var it=nt.length,lt=this.c,ut=lt&&this.d,pt=function(){var Ct,wt=Mt(nt,_);if(wt==67324752){d=1,et=_,gt.d=null,gt.c=0;var xt=ht(nt,_+6),_t=ht(nt,_+8),Pt=2048&xt,Bt=8&xt,Ot=ht(nt,_+26),Lt=ht(nt,_+28);if(it>_+30+Ot+Lt){var qt=[];gt.k.unshift(qt),d=2;var en,cn=Mt(nt,_+18),An=Mt(nt,_+22),mn=N1(nt.subarray(_+30,_+=30+Ot),!Pt);cn==4294967295?(Ct=Bt?[-2]:Xr(nt,_),cn=Ct[0],An=Ct[1]):Bt&&(cn=-1),_+=Lt,gt.c=cn;var Tn={name:mn,compression:_t,start:function(){if(!Tn.ondata)throw"no callback";if(cn){var vn=s.o[_t];if(!vn)throw"unknown compression type "+_t;(en=cn<0?new vn(mn):new vn(mn,cn,An)).ondata=function(Gn,rr,dr){Tn.ondata(Gn,rr,dr)};for(var xn=0,Un=qt;xn<Un.length;xn++){var Mn=Un[xn];en.push(Mn,!1)}s.k[0]==qt&&s.c?s.d=en:en.push(Xu,!0)}else Tn.ondata(null,Xu,!0)},terminate:function(){en&&en.terminate&&en.terminate()}};cn>=0&&(Tn.size=cn,Tn.originalSize=An),gt.onfile(Tn)}return"break"}if(lt){if(wt==134695760)return et=_+=12+(lt==-2&&8),d=3,gt.c=0,"break";if(wt==33639248)return et=_-=4,d=3,gt.c=0,"break"}},gt=this;_<it-4&&pt()!=="break";++_);if(this.p=Xu,lt<0){var vt=d?nt.subarray(0,et-12-(lt==-2&&8)-(Mt(nt,et-16)==134695760&&4)):nt.subarray(0,_);ut?ut.push(vt,!!d):this.k[+(d==2)].push(vt)}if(2&d)return this.push(nt.subarray(_),i);this.p=nt.subarray(_)}if(i){if(this.c)throw"invalid zip file";this.p=null}},c.prototype.register=function(e){this.o[e.compression]=e},c}();function Oy(c,e){if(typeof e!="function")throw"no callback";for(var i=[],s=function(){for(var ut=0;ut<i.length;++ut)i[ut]()},a={},h=c.length-22;Mt(c,h)!=101010256;--h)if(!h||c.length-h>65558)return void e("invalid zip file",null);var d=ht(c,h+8);d||e(null,{});var _=d,et=Mt(c,h+16),nt=et==4294967295;if(nt){if(h=Mt(c,h-12),Mt(c,h)!=101075792)return void e("invalid zip file",null);_=d=Mt(c,h+32),et=Mt(c,h+48)}for(var it=function(ut){var pt=Zs(c,et,nt),gt=pt[0],vt=pt[1],Ct=pt[2],wt=pt[3],xt=pt[4],_t=pt[5],Pt=bA(c,_t);et=xt;var Bt=function(Lt,qt){Lt?(s(),e(Lt,null)):(a[wt]=qt,--d||e(null,a))};if(gt)if(gt==8){var Ot=c.subarray(Pt,Pt+vt);if(vt<32e4)try{Bt(null,jv(Ot,new Ss(Ct)))}catch(Lt){Bt(Lt,null)}else i.push(x0(Ot,{size:Ct},Bt))}else Bt("unknown compression type "+gt,null);else Bt(null,_u(c,Pt,Pt+vt))},lt=0;lt<_;++lt)it();return s}function VS(c){for(var e={},i=c.length-22;Mt(c,i)!=101010256;--i)if(!i||c.length-i>65558)throw"invalid zip file";var s=ht(c,i+8);if(!s)return{};var a=Mt(c,i+16),h=a==4294967295;if(h){if(i=Mt(c,i-12),Mt(c,i)!=101075792)throw"invalid zip file";s=Mt(c,i+32),a=Mt(c,i+48)}for(var d=0;d<s;++d){var _=Zs(c,a,h),et=_[0],nt=_[1],it=_[2],lt=_[3],ut=_[4],pt=_[5],gt=bA(c,pt);if(a=ut,et){if(et!=8)throw"unknown compression type "+et;e[lt]=jv(c.subarray(gt,gt+nt),new Ss(it))}else e[lt]=_u(c,gt,gt+nt)}return e}class Xw extends b.hH6{load(e,i,s,a){return this.setResponseType("arraybuffer"),super.load(e,h=>{const d=VS(new Uint8Array(h)),_=new Map(Object.entries(d).map(([et,nt])=>[et,new File([nt],et)]));i==null||i(_)},s,a)}}function QS(){io.Importers.push(new Wo(Xw,["zip"],!0))}class SA extends b.Ox3{constructor(e,i){super(),this.assetType="light",this.isDirectionalLight2=!0,this.color=new b.Ilk(e),this.intensity=i||1,this.target.position.set(0,0,-1),this.add(this.target)}get lightObject(){return this}get modelObject(){return this}copy(e,i){const s=this.target,a=e.userData;return e.userData={},super.copy(e,i),np(this.userData,a),s.position.copy(this.target.position),s.updateMatrixWorld(),this.target=s,this}get uiConfig(){return this._uiConfig?this._uiConfig:this._uiConfig={type:"folder",label:"Directional Light",children:[{type:"checkbox",label:"Enabled",property:[this,"visible"]},{type:"color",label:"Color",property:[this,"color"]},{type:"slider",label:"Intensity",bounds:[0,20],property:[this,"intensity"]},{type:"vec3",label:"Rotation",property:[this,"rotation"]},{type:"vec3",label:"Position",property:[this,"position"]},{type:"checkbox",label:"Shadow Enabled",property:[this,"castShadow"]},{type:"vec2",label:"Shadow Map Size",property:[this==null?void 0:this.shadow,"mapSize"],onChange:()=>{var e,i;(e=this.shadow.map)===null||e===void 0||e.dispose(),(i=this.shadow.mapPass)===null||i===void 0||i.dispose(),this.shadow.map=null,this.shadow.mapPass=null}},{type:"slider",bounds:[-.001,.001],stepSize:2e-5,label:"Shadow Bias",property:[this==null?void 0:this.shadow,"bias"],onChange:this.setDirty},{type:"slider",bounds:[-.1,.1],stepSize:.005,label:"Shadow Normal Bias",property:[this==null?void 0:this.shadow,"normalBias"],onChange:this.setDirty},{type:"slider",bounds:[0,5],label:"Shadow radius",property:[this==null?void 0:this.shadow,"radius"],onChange:this.setDirty},{type:"slider",bounds:[.1,50],label:"Shadow frustum",getValue:()=>2*this.shadow.camera.right,setValue:e=>{this.shadow.camera.left=-e/2,this.shadow.camera.right=e/2,this.shadow.camera.top=e/2,this.shadow.camera.bottom=-e/2},onChange:this.setDirty}]}}toJSON(e){const{userData:i,children:s}=this;this.userData={},this.children=[];const a=super.toJSON(e);return a.userData=ao(np({},i),!1),this.userData={},this.children=s,a.type="DirectionalLight2",a.target=this.target.position.toArray(),Object.assign(a,ao(this,!0,e))}fromJSON(e,i){if(e.type!=="DirectionalLight2")return null;const s=e.target,a=e.object;return e.target&&(this.target.position.fromArray(e.target),this.target.updateMatrixWorld(),delete e.target),e.object&&delete e.object,to(e,this,!0,i),s&&(e.target=s),a&&(a.color!==void 0&&this.color.set(a.color),a.intensity!==void 0&&(this.intensity=a.intensity),e.object=a),this}}class GS extends b.PMe{constructor(e,i,s,a,h,d){super(e,i,s,a,h,d),this.assetType="light",this.target.position.set(0,0,-1),this.add(this.target)}get lightObject(){return this}get modelObject(){return this}copy(e,i){const s=this.target,a=e.userData;return e.userData={},super.copy(e,i),np(this.userData,a),s.position.copy(this.target.position),s.updateMatrixWorld(),this.target=s,this}get uiConfig(){return this._uiConfig?this._uiConfig:this._uiConfig={type:"folder",label:"Spot Light",children:[{type:"checkbox",label:"Enabled",property:[this,"visible"]},{type:"color",label:"Color",property:[this,"color"]},{type:"slider",label:"Intensity",bounds:[0,30],property:[this,"intensity"]},{type:"slider",bounds:[0,2],property:[this,"angle"]},{type:"slider",bounds:[0,.9999],property:[this,"penumbra"]},{type:"vec3",label:"Rotation",property:[this,"rotation"]},{type:"vec3",label:"Position",property:[this,"position"]},{type:"checkbox",label:"Shadow Enabled",property:[this,"castShadow"]},{type:"vec2",label:"Shadow Map Size",property:[this==null?void 0:this.shadow,"mapSize"],onChange:()=>{var e,i;(e=this.shadow.map)===null||e===void 0||e.dispose(),(i=this.shadow.mapPass)===null||i===void 0||i.dispose(),this.shadow.map=null,this.shadow.mapPass=null}},{type:"slider",bounds:[-.001,.001],stepSize:2e-5,label:"Shadow Bias",property:[this==null?void 0:this.shadow,"bias"],onChange:this.setDirty},{type:"slider",bounds:[0,5],label:"Shadow radius",property:[this==null?void 0:this.shadow,"radius"],onChange:this.setDirty}]}}toJSON(e){const{userData:i,children:s}=this;this.userData={},this.children=[];const a=super.toJSON(e);return a.userData=ao(np({},i),!1),this.userData={},this.children=s,a.type="SpotLight2",a.target=this.target.position.toArray(),Object.assign(a,ao(this,!0,e))}fromJSON(e,i){return e.type!=="SpotLight2"?null:(e.target&&(this.target.position.fromArray(e.target),this.target.updateMatrixWorld()),e.object?(e.object.color!==void 0&&this.color.set(e.object.color),e.object.intensity!==void 0&&(this.intensity=e.object.intensity),e.object.distance!==void 0&&(this.distance=e.object.distance),e.object.angle!==void 0&&(this.angle=e.object.angle),e.object.decay!==void 0&&(this.decay=e.object.decay),e.object.penumbra!==void 0&&(this.penumbra=e.object.penumbra),to(e,this,!0,i),this):this)}}class HS extends b.cek{constructor(e,i,s,a){super(e,i,s,a),this.assetType="light"}get lightObject(){return this}get modelObject(){return this}copy(e,i){const s=e.userData;return e.userData={},super.copy(e,i),np(this.userData,s),this}get uiConfig(){return this._uiConfig?this._uiConfig:this._uiConfig={type:"folder",label:"Point Light",children:[{type:"checkbox",label:"Enabled",property:[this,"visible"]},{type:"color",label:"Color",property:[this,"color"]},{type:"slider",label:"Intensity",property:[this,"intensity"]},{type:"input",label:"Distance",property:[this,"distance"]},{type:"input",property:[this,"decay"]},{type:"vec3",label:"Position",property:[this,"position"]},{type:"checkbox",label:"Shadow Enabled",property:[this,"castShadow"]},{type:"vec2",label:"Shadow Map Size",property:[this==null?void 0:this.shadow,"mapSize"],onChange:()=>{var e,i;(e=this.shadow.map)===null||e===void 0||e.dispose(),(i=this.shadow.mapPass)===null||i===void 0||i.dispose(),this.shadow.map=null,this.shadow.mapPass=null}},{type:"slider",bounds:[-.001,.001],stepSize:2e-5,label:"Shadow Bias",property:[this==null?void 0:this.shadow,"bias"],onChange:this.setDirty},{type:"slider",bounds:[0,5],label:"Shadow radius",property:[this==null?void 0:this.shadow,"radius"],onChange:this.setDirty}]}}toJSON(e){const{userData:i}=this;this.userData={};const s=super.toJSON(e);return s.userData=ao(np({},i),!1),this.userData={},s.type="PointLight2",Object.assign(s,ao(this,!0,e))}fromJSON(e,i){return e.type!=="PointLight2"?null:e.object?(e.object.color!==void 0&&this.color.set(e.object.color),e.object.intensity!==void 0&&(this.intensity=e.object.intensity),e.object.distance!==void 0&&(this.distance=e.object.distance),e.object.decay!==void 0&&(this.decay=e.object.decay),to(e,this,!0,i),this):this}}class FM extends b.Mig{constructor(e,i){super(e,i),this.assetType="light"}get lightObject(){return this}get modelObject(){return this}copy(e,i){const s=e.userData;return e.userData={},super.copy(e,i),np(this.userData,s),this}get uiConfig(){return this._uiConfig?this._uiConfig:this._uiConfig={type:"folder",label:"Ambient Light",children:[{type:"checkbox",label:"Enabled",property:[this,"visible"]},{type:"color",label:"Color",property:[this,"color"]},{type:"slider",label:"Intensity",bounds:[0,20],property:[this,"intensity"]}]}}toJSON(e){const{userData:i}=this;this.userData={};const s=super.toJSON(e);return s.userData=ao(np({},i),!1),this.userData={},s.type="AmbientLight2",Object.assign(s,ao(this,!0,e))}fromJSON(e,i){return e.type!=="AmbientLight2"?null:e.object?(e.object.color!==void 0&&this.color.set(e.object.color),e.object.intensity!==void 0&&(this.intensity=e.object.intensity),to(e,this,!0,i),this):this}}class oD extends b.aNw{load(e,i,s,a){const h=new b.hH6(this.manager);h.setPath(this.path),h.setResponseType("text"),h.load(e,d=>{try{i(this.parse(d))}catch(_){a?a(_):console.error(_),this.manager.itemError(e)}},s,a)}parse(e){e=e.replace(/^#.*?(\n|\r)/gm,"").replace(/^\s*?(\n|\r)/gm,"").trim();let i=null,s=null;const a=new b.Pa4(0,0,0),h=new b.Pa4(1,1,1),d=e.split(/[\n\r]+/g);let _=null,et=0;for(let lt=0,ut=d.length;lt<ut;lt++){const pt=d[lt].trim(),gt=pt.split(/\s/g);switch(gt[0]){case"TITLE":i=pt.substring(7,pt.length-1);break;case"LUT_3D_SIZE":const vt=gt[1];s=parseFloat(vt),_=new Uint8Array(s*s*s*4);break;case"DOMAIN_MIN":a.x=parseFloat(gt[1]),a.y=parseFloat(gt[2]),a.z=parseFloat(gt[3]);break;case"DOMAIN_MAX":h.x=parseFloat(gt[1]),h.y=parseFloat(gt[2]),h.z=parseFloat(gt[3]);break;default:const Ct=parseFloat(gt[0]),wt=parseFloat(gt[1]),xt=parseFloat(gt[2]);if(Ct>1||Ct<0||wt>1||wt<0||xt>1||xt<0)throw new Error("LUTCubeLoader : Non normalized values not supported.");_[et+0]=255*Ct,_[et+1]=255*wt,_[et+2]=255*xt,_[et+3]=255,et+=4}}const nt=new b.IEO;nt.image.data=_,nt.image.width=s,nt.image.height=s*s,nt.type=b.ywz,nt.magFilter=b.wem,nt.minFilter=b.wem,nt.wrapS=b.uWy,nt.wrapT=b.uWy,nt.generateMipmaps=!1,nt.needsUpdate=!0;const it=new b.JUT;return it.image.data=_,it.image.width=s,it.image.height=s,it.image.depth=s,it.type=b.ywz,it.magFilter=b.wem,it.minFilter=b.wem,it.wrapS=b.uWy,it.wrapT=b.uWy,it.wrapR=b.uWy,it.generateMipmaps=!1,it.needsUpdate=!0,{title:i,size:s,domainMin:a,domainMax:h,texture:nt,texture3D:it}}}class aD{constructor({domainMax:e,domainMin:i,size:s,texture:a,texture3D:h,title:d}){this.userData={},this.type="LUTCubeTextureWrapper",this.assetType="lutTexture",this.domainMax=e,this.domainMin=i,this.size=s,this.texture=a,this.texture3D=h,this.title=d,this.uuid=Qo(),this.userData.__needsSourceBuffer=!0}fromJSON(e,i){return e.type!==this.type&&console.warn("type mismatch while import",e,this),console.error("not supported"),this}toJSON(e){var i;if(e!=null&&e.textures[this.uuid])return{uuid:this.uuid,resource:"extras"};let s="";if(this.userData.__sourceBuffer){const h=new Uint8Array(this.userData.__sourceBuffer);s={data:Array.from(h),type:h.constructor.name,path:((i=this.userData.__sourceBlob)===null||i===void 0?void 0:i.name)||this.userData.rootPath}}else this.userData.rootPath?s=this.userData.rootPath:console.error("Unable to serialize LUT texture, not loaded through asset manager.");const a={uuid:this.uuid,url:s,userData:J0({},this.userData),type:this.type,name:this.texture.name};return e!=null&&e.extras?(e.extras[this.uuid]=a,{uuid:this.uuid,resource:"extras"}):a}}class io extends ot{constructor(e,i=!1){super(),this._processors=new c_,this._logger=console.log,this._loaderCache=[],this._fileDatabase=new Map,this._cachedAssets=[],i||(this._logger=()=>{}),this._viewer=e,this._onLoad=this._onLoad.bind(this),this._onProgress=this._onProgress.bind(this),this._onError=this._onError.bind(this),this._onStart=this._onStart.bind(this),this._urlModifier=this._urlModifier.bind(this),this._loadingManager=new b.lLk(this._onLoad,this._onProgress,this._onError),this._loadingManager.onStart=this._onStart,this._loadingManager.setURLModifier(this._urlModifier),QS(),Cy(e.renderer.rendererObject),fm(e),Qm()}get processors(){return this._processors}get loadingManager(){return this._loadingManager}_onLoad(){this.dispatchEvent({type:"onLoad"})}_onProgress(e,i,s){this.dispatchEvent({type:"onProgress",url:e,loaded:i,total:s})}_onError(e){this.dispatchEvent({type:"onError",url:e})}_onStart(e,i,s){this.dispatchEvent({type:"onStart",url:e,loaded:i,total:s})}_urlModifier(e){var i;let s=decodeURI(e);const a=(i=this._rootContext)===null||i===void 0?void 0:i.rootUrl;s.includes("://")||!a||s.startsWith(a)||(s=a+s),s=s.replace("./",""),s=s.replace(/^(\/\/)/,"/"),s=s.replace(/\?.*$/,"");const h=this._fileDatabase.get(s);return h?h.ext?(h.objectUrl||(h.objectUrl=URL.createObjectURL(h)+"#"+s),h.objectUrl):(console.error("Unable to determine file extension",h),e):e}_createLoader(e){const i=this._getImporter(e),s=i==null?void 0:i.ctor(this);return s&&(i==null||i.ext.forEach(a=>{const h=new RegExp(a.startsWith("data:")?"^"+a+"\\/":"\\."+a+"$","i");this._loadingManager.addHandler(h,s)})),s&&(this._loaderCache.push({loader:s,files:[]}),this.dispatchEvent({type:"loaderCreate",loader:s})),s}async importFiles(e,i={}){const s=new Map;let{allowedExtensions:a}=i;if(a&&a.length<1&&(a=void 0),e.size===0)return s;this.dispatchEvent({type:"importFiles",files:Object.keys(e),state:"start"});const h=[],d=[];if(e.forEach((_,et)=>{var nt;this.registerFile(et,_);const it=_.ext;it&&((nt=a==null?void 0:a.includes(it.toLowerCase()))===null||nt===void 0||nt)&&(this._isRootFileExtension(it)?h.push(et):d.push(et))}),h.length>0)for(const _ of h){let et=await this._importFile(_,void 0,i);et&&(et=await this.processImported(et,i)),s.set(_,et)}else for(const _ of d){let et=await this._importFile(_,void 0,i);et&&(et=await this.processImported(et,i)),s.set(_,et)}return this.dispatchEvent({type:"importFiles",files:Object.keys(e),state:"end"}),e.forEach((_,et)=>{this.unregisterFile(et)}),s}registerFile(e,i){var s,a,h;e=e.replace(/\?.*$/,"");const d=(s=i==null?void 0:i.ext)!==null&&s!==void 0?s:(h=b1((a=i==null?void 0:i.name)!==null&&a!==void 0?a:e))===null||h===void 0?void 0:h.toLowerCase();i&&(i.ext||(i.ext=d),this._fileDatabase.set(e,i));let _=this._getLoader(e);if(_||(_=this._createLoader(i??{name:e,ext:d})),_){for(const et of this._loaderCache)if(et.loader===_){et.files.push(e);break}}return _}unregisterFile(e){e=e.replace(/\?.*$/,"");const i=this._fileDatabase.get(e);i!=null&&i.objectUrl&&(URL.revokeObjectURL(i.objectUrl),i.objectUrl=void 0),i&&this._fileDatabase.delete(e)}_isRootFileExtension(e){return io.Importers.find(i=>i.root&&i.ext.includes(e.toLowerCase()))!=null}resolveURL(e){return this._loadingManager.resolveURL(e)}async _importFile(e,i,s={},a){var h,d;if(!((h=i)===null||h===void 0)&&h.__imported)return i.__imported;let _;this.dispatchEvent({type:"importFile",path:e,state:"downloading",progress:0});try{this.registerFile(e,i);const et=this.resolveURL(e),nt=e.replace(/\?.*$/,""),it=(d=s.fileHandler)!==null&&d!==void 0?d:await this._loadingManager.getHandler(nt)||(i?await this._loadingManager.getHandler(i.name||i.ext||""):void 0);if(!it)throw new Error("AssetImporter: Unable to find loader for "+e);this._rootContext={path:e,url:et,rootUrl:b.Zp0.extractUrlBase(e),baseUrl:b.Zp0.extractUrlBase(et)},_=await it.loadAsync(e+(s.queryString?(e.includes("?")?"&":"?")+s.queryString:""),lt=>{a&&a(lt),this.dispatchEvent({type:"importFile",path:e,state:"downloading",progress:lt.loaded/lt.total})}),this._rootContext=void 0,this.dispatchEvent({type:"importFile",path:e,state:"downloading",progress:1}),this.dispatchEvent({type:"importFile",path:e,state:"adding"}),i?this._logger("AssetImporter: loaded",e):this._logger("AssetImporter: downloaded",e),i&&this.unregisterFile(e)}catch(et){return console.error("AssetImporter: Unable to import file",e,i),console.error(et),console.error(et==null?void 0:et.stack),this.dispatchEvent({type:"importFile",path:e,state:"error",error:et}),i&&this.unregisterFile(e),[]}return this.dispatchEvent({type:"importFile",path:e,state:"done"}),i&&(i.__imported=_),_&&typeof _=="object"&&(_.__rootPath=e,i&&(_.__rootBlob=i)),_}_getImporter(e,i=!1){return io.Importers.find(s=>{if(i&&!s.root)return!1;const a=s.ext.find(h=>{var d,_,et;return e.ext&&h===e.ext.toLowerCase()||((_=(d=e.name)===null||d===void 0?void 0:d.toLowerCase())===null||_===void 0?void 0:_.endsWith("."+h.toLowerCase()))||(h==null?void 0:h.startsWith("data:"))&&((et=e.name)===null||et===void 0?void 0:et.startsWith(h))});return!!a&&(e.ext=a,!0)})}_getLoader(e){var i;return(i=this._loadingManager.getHandler(e))!==null&&i!==void 0?i:void 0}async importAsset(e,i={},s){var a;if(!e)return[];if(!this._cachedAssets.includes(e)){if(Object.entries(e).length===1&&e.path){const _=this._cachedAssets.find(et=>et.path===e.path);_&&Object.assign(e,_)}const d=this._cachedAssets.findIndex(_=>_.path===e.path);d>=0&&this._cachedAssets.splice(d,1),this._cachedAssets.push(e)}let h;if(e!=null&&e.preImported&&(h=await e.preImported),!i.forceImport&&h){const d=await this.processImported(h,i);let _=!1;for(const et of d)if(et.__disposed){_=!0;break}if(!_||i.reimportDisposed===!1)return d}return e.preImported=this._importFile(i.pathOverride||e.path,typeof((a=e.file)===null||a===void 0?void 0:a.arrayBuffer)=="function"?e.file:void 0,i,s),h=await e.preImported,h&&(h=await this.processImported(h,i)),h}async importSingle(e,i={}){var s;return(s=await this.importAsset(e,i))===null||s===void 0?void 0:s[0]}async importSinglePath(e,i){var s;return(s=await this.importPath(e,i))===null||s===void 0?void 0:s[0]}async importPath(e,i={}){const s={...i};delete s.pathOverride,delete s.forceImport,delete s.reimportDisposed;const a=JSON.stringify(s);let h;return h=this._cachedAssets.find(d=>d.path===e&&d._options===a)||{path:e},h._options=a,await this.importAsset(h,i)}async processImportedSingle(e,i={}){return(await this.processImported(e,i))[0]}async processImported(e,i={}){var s,a,h,d,_,et,nt,it;let lt=e;if(!lt)return[];if(i.processImported===!1)return[lt];if(Array.isArray(lt)){const gt=[];for(const vt of lt)gt.push(...await this.processImported(vt,i));return gt}if(!((s=lt.userData)===null||s===void 0)&&s.rootSceneModelRoot){if(i._rootSceneImported=!0,lt.__processedChildren&&!i.forceImporterReprocess)return lt.__processedChildren;if(!(lt.children.length<1))return lt.animations&&(lt.children[0].animations||(lt.children[0].animations=[]),lt.children[0].animations.push(...lt.animations)),lt.__importedViewerConfig&&(lt.children[0].__importedViewerConfig=lt.__importedViewerConfig),lt.__processedChildren=await this.processImported([...lt.children],i),lt.__processedChildren;if(((a=lt.animations)===null||a===void 0?void 0:a.length)>0&&console.error("AssetImporter: animations in empty scene not supported yet. animations will be ignored",lt.animations),!lt.__importedViewerConfig)return[];lt=lt.__importedViewerConfig}if(!((h=lt.userData)===null||h===void 0)&&h.iModel&&(lt=lt.userData.iModel),!((d=lt.userData)===null||d===void 0)&&d.iMaterial&&(lt=lt.userData.iMaterial),lt.assetImporterProcessed&&!i.forceImporterReprocess)return[lt];const ut=lt.__rootPath,pt=lt.__rootBlob;if(!lt.assetType){if(lt.isBufferGeometry&&(lt=new b.Kj0(lt,new b.Wid)),lt.isObject3D)if(lt.isLight)lt=jM(lt);else{const gt=[];lt.traverse(vt=>{vt!==lt&&vt.isLight&&gt.push(vt)});for(const vt of gt)jM(vt);lt=new Sy(lt,i)}lt.isTexture&&(lt.assetType="texture",i._testDataTextureComplete&&(lt.isDataTexture&&(!((_=lt.image)===null||_===void 0)&&_.data)&&(lt.image.complete=!0),!((et=lt.image)===null||et===void 0)&&et.complete&&(lt.needsUpdate=!0)),i.generateMipmaps!==void 0&&(lt.generateMipmaps=i.generateMipmaps),lt.generateMipmaps||lt.isRenderTargetTexture||(lt.minFilter=lt.minFilter===b.D1R?b.wem:lt.minFilter,lt.magFilter=lt.magFilter===b.D1R?b.wem:lt.magFilter)),lt.isMaterial&&(lt.assetType="material")}if(lt.assetType!=null)return lt.userData&&(lt.userData.rootPath||!ut||ut.startsWith("blob:")||ut.startsWith("/")||(lt.userData.rootPath=ut),pt&&(lt.userData.__sourceBlob=pt,lt.userData.__needsSourceBuffer&&(lt.userData.__sourceBuffer=await pt.arrayBuffer(),delete lt.userData.__needsSourceBuffer))),lt=await this._processors.process(lt.assetType,lt,{}),lt.assetImporterProcessed=!0,[lt];if(lt instanceof Map)return[...(await this.importFiles(lt,i)).values()].flat();if(lt.type){const gt=this._viewer.getPluginByType(lt.type);if(gt){let vt=lt._importedResources||{};return lt.resources&&(vt=await((nt=this._viewer.getManager())===null||nt===void 0?void 0:nt.importConfigResources(lt.resources)),delete lt.resources,lt._importedResources=vt),typeof gt.fromJSON=="function"&&(await Promise.resolve(gt.fromJSON(lt,vt)),lt.assetImporterProcessed=!1),[]}}else if(lt.plugins)return lt.resources=await((it=this._viewer.getManager())===null||it===void 0?void 0:it.importConfigResources(lt.resources)),await this._viewer.getManager().importViewerConfig(lt),lt.assetImporterProcessed=!1,[];return console.warn("unknown/null asset type: ",lt),[lt]}dispose(){var e;(e=this._processors)===null||e===void 0||e.dispose()}}function WS(c){if(!c)return b.ywz;const e=c.extensions.has("EXT_color_buffer_half_float")||c.capabilities.isWebGL2&&c.extensions.has("EXT_color_buffer_float"),i=c.capabilities.isWebGL2||c.extensions.has("OES_texture_float")||c.extensions.has("WEBGL_color_buffer_float");return e?b.cLu:i?b.VzW:b.ywz}function jM(c){var e,i,s;if(!c.isLight||c.assetType==="light")return c;if(c.uiConfig)return console.warn("ui config already exists, not supported",c),c;let a;if(c.children.length,c.isDirectionalLight&&(a=new SA),c.isAmbientLight&&(a=new FM),c.isSpotLight&&(a=new GS),c.isPointLight&&(a=new HS),a){(i=(e=a.lightObject).copy)===null||i===void 0||i.call(e,c);const h=c.parent;!((s=h)===null||s===void 0)&&s.isObject3D&&(h.remove(c),c.dispose(),c.userData.iModel=a,h.add(a.lightObject),a.uuid=c.uuid),Ap(a.lightObject,h)}else console.warn("unknown light type: ",c);return a}io.Importers=[new Wo(op,["json"],!1),new Wo(b.hH6,["txt"],!1),new Wo(Ty,["rgbe.png","hdr.png","hdrpng"],!1),new Wo(b.dpR,["webp","png","jpeg","jpg","svg","data:image"],!1),new Wo(class extends oD{parse(c){const e=super.parse(c);return new aD(e)}},["cube"],!1)];class zM extends b.u7G{constructor(e){super(e)}async loadAsync(e,i){var s;const a=new b.hH6(this.manager);a.setPath(this.path),a.setRequestHeader(this.requestHeader),a.setWithCredentials(this.withCredentials);const h=await a.loadAsync(e,i);try{const d=JSON.parse(h);if(d.images&&this.importer){const _={};let et=d.images;Array.isArray(et)||(et=Object.values(et));for(const nt of d.images){if(!nt.url||!nt.uuid)continue;const it=(s=await this.importer.importPath(nt.url,{processImported:!1}))===null||s===void 0?void 0:s[0],lt=it==null?void 0:it.source;if(!it||!lt)continue;const ut=new b.Hw6(lt.data);ut.uuid=nt.uuid,_[ut.uuid]=ut,it.dispose()}return this.parse(d,_)}return this.parse(d)}catch(d){throw console.error(d),this.manager.itemError(e),d}}parse(e,i){var s,a;let h;const d={p:new Promise(it=>{h=it})};if(e.images||e.textures){const it=new dA(this.manager);let lt={};const ut=Ct=>{h(),d.p=void 0,Object.values(lt).forEach(wt=>{var xt;wt.isTexture&&(!((xt=wt.image)===null||xt===void 0)&&xt.complete)&&(wt.needsUpdate=!0)})};let pt=e.images||[];Array.isArray(pt)||(pt=Object.values(pt));const gt=i||it.parseImages(pt,ut);let vt=e.textures;Array.isArray(vt)||(vt=Object.values(vt)),lt=it.parseTextures2(vt,gt,ut),this.setTextures(lt)}this.materials||console.warn("A Material Manager is not set to import three materials, trying standard materials");const _={...e};if(Object.entries(_).forEach(([it,lt])=>{lt&&typeof lt=="string"&&this.textures[lt]&&(_[it]=this.textures[lt])}),e.vertexColors!==void 0&&(typeof e.vertexColors=="number"?_.vertexColors=e.vertexColors>0:_.vertexColors=e.vertexColors),e.normalScale!==void 0){let it=e.normalScale;Array.isArray(it)===!1&&(it=[it,it]),_.normalScale=new b.FM8().fromArray(it)}let et=e.type;et!=="MeshPhysicalMaterial"&&et!=="MeshStandardMaterial"||(et=Tu.TYPE),_.userData=to(_.userData,void 0,!1,this);const nt=(a=(s=this.materials)===null||s===void 0?void 0:s.generateFromTemplateType(et,_))!==null&&a!==void 0?a:super.parse(e);return this.setTextures({}),nt.userData.imageLoadAwaiter=d,nt}}class qr extends ot{constructor(e,i,{simpleCache:s=!1,storage:a}={}){if(super(),this._sceneUpdated=this._sceneUpdated.bind(this),this.addAsset=this.addAsset.bind(this),this.addProcessedAssets=this.addProcessedAssets.bind(this),this.addImported=this.addImported.bind(this),(s||a)&&(s&&(b.CtF.enabled=!0),a&&window.Cache&&typeof window.Cache=="function"&&a instanceof window.Cache)){const h={...b.CtF};b.CtF.get=(d,_,et)=>_?d.startsWith("data:")||d.startsWith("blob")||d.startsWith("chrome-extension")?Promise.resolve(void 0):a.match(d).then(nt=>{if(nt)switch(_){case"arraybuffer":return nt.arrayBuffer();case"blob":return nt.blob();case"document":return nt.text().then(it=>new DOMParser().parseFromString(it,et??"text/html"));case"json":return nt.json();default:if(et===void 0)return nt.text();{const it=/charset="?([^;"\s]*)"?/i.exec(et),lt=it&&it[1]?it[1].toLowerCase():void 0,ut=new TextDecoder(lt);return nt.arrayBuffer().then(pt=>ut.decode(pt))}}}):h.get(d),b.CtF.add=(d,_,et)=>{et||h.add(d,_),d.startsWith("data:")||d.startsWith("blob")||d.startsWith("chrome-extension")||a.put(d,new Response(_,{status:200}))},b.CtF.remove=(d,_)=>{_||h.remove(d),a.delete(d)}}this._importer=e,this._materials=i}async addAsset(e,i={}){if(!this._importer||!this._viewer)return[];const s=await this._importer.importAsset(e,i);return s?(this.addProcessedAssets(s,i),s):(console.warn("Unable to import",e,s),[])}async addFromPath(e,i={}){if(!this._importer||!this._viewer)return[];const s=await this._importer.importPath(e,i);return s?(this.addProcessedAssets(s,i),s):(console.warn("Unable to import",e,s),[])}addProcessedAssets(e,i){return e.map(s=>{var a;return(a=this._viewer)===null||a===void 0?void 0:a.scene.addSceneObject(s,i)})}async addAssetSingle(e,i={}){var s;return e?(s=await(typeof e=="string"?this.addFromPath:this.addAsset)(e,i))===null||s===void 0?void 0:s[0]:void 0}async addImported(e,i={}){var s;return(s=this._importer)===null||s===void 0?void 0:s.processImported(e,i).then(a=>(this.addProcessedAssets(a,i),a))}async addImportedSingle(e,i={}){return this.addImported(e,i).then(s=>s==null?void 0:s[0])}_sceneUpdated(e){var i;if(e.type==="addSceneObject"){const s=e.object;s.assetType==="material"&&((i=this._materials)===null||i===void 0||i.processMaterial(s,{}))}else console.error("Unexpected")}async onAdded(e){this._viewer=e,this._materials||(this._materials=new h0,this._viewer.scene.addEventListener("addSceneObject",this._sceneUpdated)),this._importer||(this._importer=new io(e,!!e.getPluginByType("debug")),this._importer.processors.add("model",{forAssetType:"model",process:(s,a)=>(hm(s,h=>{var d;return(d=this._materials)===null||d===void 0?void 0:d.processModel(h,{recursive:!1})}),s)}),this._importer.processors.add("model",{forAssetType:"model",process:this._materials.processModel}),this._importer.processors.add("material",{forAssetType:"material",process:(s,a)=>{var h;return!((h=this.materials)===null||h===void 0)&&h.findMaterial(s.uuid)&&(console.warn("imported material uuid already exists, creating new uuid"),s.uuid=Qo(),s.userData.uuid&&(s.userData.uuid=s.uuid)),this._materials.processMaterial(s,a)}})),io.Importers.push(new Wo(zM,[Tu.TypeSlug],!1,s=>(s&&(s.materials=this._materials),s&&(s.importer=this._importer),s)));const i=this.importViewerConfig.bind(this);io.Importers.push(new Wo(class extends op{async loadAsync(s,a){return i(await super.loadAsync(s,a))}},[qr.ViewerTypeSlug],!0))}async onDispose(e){}async onRemove(e){var i,s;e===this._viewer&&((i=this._importer)===null||i===void 0||i.dispose(),this._importer=void 0,this._viewer.scene.removeEventListener("addSceneObject",this._sceneUpdated),(s=this._materials)===null||s===void 0||s.dispose(),this._materials=void 0)}get importer(){return this._importer}get exporter(){var e,i;return(i=(e=this._viewer)===null||e===void 0?void 0:e.getPluginByType("AssetExporterPlugin"))===null||i===void 0?void 0:i.exporter}get materials(){return this._materials}exportViewerConfig(e=!0,i){if(!this._viewer)return{};const s={geometries:{},materials:{},textures:{},images:{},shapes:{},skeletons:{},animations:{},extras:{},...i},a=this._viewer.toJSON(s);return e||Object.values(s).forEach(h=>{h&&Object.values(h).forEach(d=>{d.url&&(console.log(d.url),(d.url.data instanceof ArrayBuffer||Array.isArray(d.url.data))&&(d.url.type==="Uint16Array"?(d.url.data instanceof Uint16Array||(d.url.data=new Uint16Array(d.url.data)),d.url.data="data:application/octet-stream;base64,"+Nl(d.url.data.buffer)):d.url.type==="Uint8Array"?(d.url.data instanceof Uint8Array||(d.url.data=new Uint8Array(d.url.data)),d.url.data="data:application/octet-stream;base64,"+Nl(d.url.data.buffer)):d.url.data instanceof ArrayBuffer?d.url.data="data:application/octet-stream;base64,"+Nl(d.url.data.buffer):console.warn("Unsupported buffer type",d.url.type)))})}),a.resources=s,a}exportPluginPresets(e){var i;const s={geometries:{},materials:{},textures:{},images:{},shapes:{},skeletons:{},animations:{},extras:{}};return{plugins:(i=this._viewer)===null||i===void 0?void 0:i.serializePlugins(s,e),resources:s}}exportPluginPreset(e){if(!e.toJSON)return;const i={geometries:{},materials:{},textures:{},images:{},shapes:{},skeletons:{},animations:{}},s=e.toJSON(i);return s.resources=i,s}async importPluginPreset(e,i){var s;const a=e.type;if(!(i=i||((s=this._viewer)===null||s===void 0?void 0:s.getPluginByType(a))))return void console.warn(`No plugin found for type ${a} to import preset`);if(!i.fromJSON)return void console.warn(`Plugin ${a} does not support importing presets`);const h=e.resources||{};return e.resources&&delete e.resources,await i.fromJSON(e,h),h&&(e.resources=h),i}async importViewerConfig(e,i){if(!this._viewer||!this._importer)return void console.warn("No viewer or importer");const s=await this.importConfigResources(e.resources||{},i);this.applyViewerConfig(e,s)}applyViewerConfig(e,i){var s;if(this._viewer&&this._importer)if((i=i||e.resources).__isLoadedResources){this._viewer.fromJSON(e,i);for(const a of Object.values(i.materials))a.__useCount?delete a.__useCount:(s=this._materials)===null||s===void 0||s.unregisterMaterial(a);for(const a of Object.values(i.textures))a.__useCount&&delete a.__useCount}else console.error("Cannot load viewer config: resources not loaded",e);else console.warn("No viewer or importer")}async importConfigResources(e,i,s){var a,h,d,_,et;if(!this._importer)throw"Importer not initialized yet.";if(e.__isLoadedResources)return e;const nt={};Object.values(e).forEach(lt=>{lt&&Object.values(lt).forEach(ut=>{if(!ut||!ut.url||typeof ut.url.data!="string")return;const pt=ut.url.data.match(/^data:.*;base64,(.*)$/);pt!=null&&pt[1]?ut.url.data=by(pt==null?void 0:pt[1]):(ut.url.type!=="Uint8Array"&&console.error("Unsupported buffer type string for ",ut.url.type,"use base64"),ut.url.data=new TextEncoder().encode(ut.url.data).buffer)})}),i=i??new dA(this._importer.loadingManager),nt.animations=e.animations?i.parseAnimations(e.animations):{},s&&s.animations&&(nt.animations={...nt.animations,...s.animations}),nt.shapes=e.shapes?i.parseShapes(e.shapes):{},s&&s.shapes&&(nt.shapes={...nt.shapes,...s.shapes}),nt.geometries=e.geometries?i.parseGeometries(e.geometries,nt.shapes):{},s&&s.geometries&&(nt.geometries={...nt.geometries,...s.geometries}),nt.images=e.images?await i.parseImagesAsync(Object.values(e.images)):{},s&&s.images&&(nt.images={...nt.images,...s.images});for(const lt of Object.values(e.textures)){const ut=(a=lt==null?void 0:lt.userData)===null||a===void 0?void 0:a.rootPath;if(ut&&(!lt.image||!nt.images[lt.image])){const pt=(h=await this._importer.importPath(ut,{processImported:!1}))===null||h===void 0?void 0:h[0],gt=pt==null?void 0:pt.source;if(!pt||!gt)continue;const vt=new b.Hw6(gt.data);lt.image&&(vt.uuid=lt.image),nt.images[vt.uuid]=vt,lt.image=vt.uuid,pt.dispose()}}nt.textures=e.textures?i.parseTextures2(Object.values(e.textures),nt.images,()=>{Object.values(nt.textures).forEach(lt=>{var ut;lt.isTexture&&(!((ut=lt.image)===null||ut===void 0)&&ut.complete)&&(lt.needsUpdate=!0)})}):{};for(const lt of Object.entries(nt.textures))lt[1]=(d=await this._importer.processImported(lt[1],{}))===null||d===void 0?void 0:d[0],lt[1]?nt.textures[lt[0]]=lt[1]:delete nt.textures[lt[0]];s&&s.textures&&(nt.textures={...nt.textures,...s.textures});const it=e.materials?Object.values(e.materials):[];for(const lt of it)Object.entries(lt).forEach(([ut,pt])=>{pt&&pt.resource&&pt.uuid&&pt.resource==="textures"&&(lt[ut]=pt.uuid)});if(nt.materials=i.parseMaterials2(it,nt.textures,this._materials),s&&s.materials&&(nt.materials={...nt.materials,...s.materials}),e.object&&(nt.object=i.parseObject(e.object,nt.geometries,nt.materials,nt.textures,nt.animations),e.skeletons&&(nt.skeletons=i.parseSkeletons(e.skeletons,nt.object),i.bindSkeletons(nt.object,nt.skeletons))),e.extras){nt.extras=e.extras;for(const lt of Object.values(e.extras))if(lt.uuid&&lt.url)if(typeof lt.url=="string"){const ut=await((_=this._importer)===null||_===void 0?void 0:_.importPath(lt.url));(ut==null?void 0:ut.length)>0&&(nt.extras[lt.uuid]=ut[0])}else if(lt.url.data){const ut=new File([Uw(lt.url.type,lt.url.data)],lt.url.path),pt=await((et=this._importer)===null||et===void 0?void 0:et.importAsset({path:ut.name,file:ut}));(pt==null?void 0:pt.length)>0&&(nt.extras[lt.uuid]=pt[0])}else console.warn("invalid URL type while loading extra resource")}return s&&s.extras&&(nt.extras={...nt.extras,...s.extras}),nt.__isLoadedResources=!0,nt}}qr.PluginType="AssetManager",qr.ViewerTypeSlug="vjson";class Ls extends ot{constructor(){super(...arguments),this._dirty=!1}get dirty(){return this._dirty}set dirty(e){this._dirty=e}async onAdded(e){this._viewer=e}async onDispose(e){}async onRemove(e){this._viewer!==e&&console.error("Wrong viewer"),this._viewer=void 0}toJSON(e){const i=ao(this,!0,e);return i.type=this.constructor.PluginType,this.dispatchEvent({type:"serialize",data:i}),i}fromJSON(e,i){return e.type!==this.constructor.PluginType?null:(to(e,this,!0,i),this.dispatchEvent({type:"deserialize",data:e}),this)}}function CA(c,e,i){return{...e,get dirty(){return e.dirty||!1},set dirty(s){bn(e,"dirty",s,!0)},update(){var s,a,h;this.passObject.enabled&&((a=(s=this.passObject).updateShaderProperties)===null||a===void 0||a.call(s,Yt(i)),(h=e.update)===null||h===void 0||h.call(this))},onRegister(s){var a,h,d;this.passObject.materialExtension&&((h=(a=c.getPlugin(qr))===null||a===void 0?void 0:a.materials)===null||h===void 0||h.registerMaterialExtension(this.passObject.materialExtension)),(d=e.onRegister)===null||d===void 0||d.call(this,s)},onUnregister(s){var a,h,d;this.passObject.materialExtension&&((h=(a=c.getPlugin(qr))===null||a===void 0?void 0:a.materials)===null||h===void 0||h.unregisterMaterialExtension(this.passObject.materialExtension)),(d=e.onUnregister)===null||d===void 0||d.call(this,s)},dispose(){var s,a,h;(a=(s=this.passObject).dispose)===null||a===void 0||a.call(s),(h=e.dispose)===null||h===void 0||h.call(this)}}}class Am extends Ls{constructor(){super(),this._enabledTemp=!0}_update(e){var i;return((i=this._pass)===null||i===void 0?void 0:i.enabled)&&this.enabled||!1}get enabled(){var e,i;return((i=(e=this._pass)===null||e===void 0?void 0:e.passObject)===null||i===void 0?void 0:i.enabled)||this._enabledTemp}set enabled(e){var i;!((i=this._pass)===null||i===void 0)&&i.passObject&&(this._pass.passObject.enabled=e),this._enabledTemp=e}async onAdded(e){await super.onAdded(e);const i={enabled:!0,passId:this.passId,passObject:this.passCtor(e),after:this._afterFilters,before:this._beforeFilters,required:this._requiredFilters,set dirty(s){s&&e.setDirty()},get dirty(){return!1},update:()=>this._update(e)};this._pass=CA(e,i),i.passObject.onDirty!==void 0&&i.passObject.onDirty.push(()=>i.dirty=!0),e.renderer.registerPass(this._pass),this.enabled=this._enabledTemp}async onRemove(e){var i,s;this._pass&&e.renderer.unregisterPass(this._pass),(s=(i=this._pass)===null||i===void 0?void 0:i.dispose)===null||s===void 0||s.call(i),this._pass=void 0,await super.onRemove(e)}get pass(){return this._pass}toJSON(e){var i,s;const a=super.toJSON(e);if(!a.type)return a;const h=this.pass;return h&&(a.pass=ao((s=(i=h)===null||i===void 0?void 0:i.passObject)!==null&&s!==void 0?s:h,!1,e)),a}fromJSON(e,i){var s,a;if(!super.fromJSON(e,i))return null;if(e.pass){const h=this.pass;h&&to(e.pass,(a=(s=h)===null||s===void 0?void 0:s.passObject)!==null&&a!==void 0?a:h,!1,i)}return this}}(function(c,e,i,s){var a,h=arguments.length,d=h<3?e:s===null?s=Object.getOwnPropertyDescriptor(e,i):s;if(typeof Reflect=="object"&&typeof Reflect.decorate=="function")d=Reflect.decorate(c,e,i,s);else for(var _=c.length-1;_>=0;_--)(a=c[_])&&(d=(h<3?a(d):h>3?a(e,i,d):a(e,i))||d);h>3&&d&&Object.defineProperty(e,i,d)})([Fn()],Am.prototype,"enabled",null);const j1=new Set,z1=new Set;class qS extends o_{constructor(e,i,s=new mo(1,1,1),a=1){super(void 0,void 0,i,s,a),this.target=e}render(e,i,s,a,h){const d=e.getRenderTarget(),_=e.getActiveCubeFace(),et=e.getActiveMipmapLevel();this.scene.traverse(({material:nt})=>{nt&&((nt.transparent&&nt.userData.renderToDepth||!nt.transparent&&nt.transmission===0&&nt.userData.renderToDepth===!1)&&(j1.add(nt),nt.transparent=!nt.transparent),Math.abs(nt.transmission||0)>0&&nt.userData.renderToDepth&&(z1.add([nt,nt.transmission]),nt.transmission=0))}),zr(e,{shadowMapRender:!1,backgroundRender:!1,opaqueRender:!0,transparentRender:!1,transmissionRender:!1,mainRenderPass:!1},()=>super.render(e,i,this.target,a,h)),j1.forEach(nt=>nt.transparent=!nt.transparent),j1.clear(),z1.forEach(([nt,it])=>nt.transmission=it),z1.clear(),e.setRenderTarget(d,_,et)}}class ho extends Am{constructor(e=!0){super(),this.renderFlagsBuffer=e,this.passId="gbuffer",this._beforeFilters=["render"],this._afterFilters=[],this._requiredFilters=["render"],this._gbufferTextures=[]}passCtor(e){var i,s;const a=((i=this._viewer)===null||i===void 0?void 0:i.renderer.isWebGL2)&&this.renderFlagsBuffer,h=e.renderer.createTarget({depthBuffer:!0,type:b.ywz,textureCount:a?2:1});Array.isArray(h.texture)?(h.texture[0].name="gbufferDepthNormal",h.texture[1].name="gbufferFlags",this._gbufferTextures=h.texture):(h.texture.name="gbufferDepthNormal",this._gbufferTextures.push(h.texture)),this._gbufferTarget=h;const d=(s=this._viewer)===null||s===void 0?void 0:s.getPluginByType("debug");return d&&(d.addTexture("gbuffer depth normal",()=>this.getDepthNormal(),[40,110,300,200]),this._gbufferTextures.length>1&&d.addTexture("gbuffer flags",()=>this.getFlagsTexture(),[40,310,200,100])),this._material=new BS(a),new qS(h,this._material)}_update(e){if(!super._update(e))return!1;const i=this.pass.passObject;return i.scene=e.scene.modelObject,e.scene.activeCamera.updateShaderProperties(i.overrideMaterial),i.camera=e.scene.activeCamera.cameraObject,!0}getDepthNormal(){return this._gbufferTextures.length>0?this._gbufferTextures[0]:void 0}getFlagsTexture(){return this._gbufferTextures.length>1?this._gbufferTextures[1]:void 0}async onDispose(e){}async onRemove(e){return this._gbufferTarget&&(e.renderer.disposeTarget(this._gbufferTarget),this._gbufferTarget=void 0),super.onRemove(e)}getTarget(){return this._gbufferTarget}getUnpackSnippet(){return Fp}updateShaderProperties(e){var i,s;if(e.uniforms.tNormalDepth?e.uniforms.tNormalDepth.value=(i=this.getDepthNormal())!==null&&i!==void 0?i:void 0:console.warn("BaseRenderer: no uniform: tNormalDepth"),e.uniforms.tGBufferFlags){e.uniforms.tGBufferFlags.value=(s=this.getFlagsTexture())!==null&&s!==void 0?s:void 0;const a=e.uniforms.tGBufferFlags.value?1:0;a!==e.defines.GBUFFER_HAS_FLAGS&&(e.defines.GBUFFER_HAS_FLAGS=a,e.needsUpdate=!0)}return this}registerGBufferUpdater(e){this._material&&this._material.addGBufferUpdater(e)}}ho.PluginType="GBuffer";class VM extends o_{constructor(e,i=!0){super(),this.blurTransmissionTarget=!1,this._viewer=e,this._doTransmissionFix=i,this.clear=!0,this.clearColor=new mo(0,0,0),this.clearAlpha=0,this.clearDepth=!1,this._blendPass=new x1({},"c = vec4(a.rgb * (1. - b.a) + b.rgb * b.a, 1.);")}get transparentTarget(){return this._transparentTarget||(this._transparentTarget=this._viewer.renderer.getTempTarget({sizeMultiplier:1,samples:this._viewer.renderer.composerTarget.samples||0,encoding:b.rnI,type:b.cLu,format:b.wk1,minFilter:b.wem,magFilter:b.wem,depthBuffer:!1})),this._transparentTarget}_releaseTransparentTarget(){this._transparentTarget&&this._viewer.renderer.releaseTempTarget(this._transparentTarget),this._transparentTarget=void 0}render(e,i,s,a,h){var d;let _=!1;if(e.userData.mainRenderPass=!0,!this._doTransmissionFix)return super.render(e,i,s,a,h),this.needsSwap=_,void(e.userData.mainRenderPass=void 0);const et=e.userData;et||console.error("threejs is not patched?");const nt=this._viewer.useGBufferDepth;let it;if(nt){const ut=(d=this._viewer.getPlugin(ho))===null||d===void 0?void 0:d.getTarget();if(ut){const pt=e.properties.get(ut);it=pt.__webglDepthRenderbuffer||pt.__webglDepthbuffer}else console.warn("No Gbuffer present for depth prepass.")}let lt=()=>{super.render(e,void 0,s,a,h,it)};if(this._viewer.useRgbm){if(this._viewer.useRgbm){if(_=!1,!e.info.autoReset)throw"renderer.info.autoReset must be true";{const ut=e.autoClearDepth;e.autoClearDepth=!nt,zr(e,{shadowMapRender:!0,backgroundRender:!0,opaqueRender:!0,transparentRender:!1,transmissionRender:!1},lt),e.autoClearDepth=ut}if(!nt){const ut=e.properties.get(s);it=ut.__webglDepthRenderbuffer||ut.__webglDepthbuffer}lt=()=>{super.render(e,void 0,this.transparentTarget,a,h,it)};{const ut=this.clear,pt=e.autoClearDepth;e.autoClearDepth=!1,this.clear=!0,zr(e,{shadowMapRender:!1,backgroundRender:!1,opaqueRender:!1,transparentRender:!0,transmissionRender:!1},lt),this.clear=ut,e.autoClearDepth=pt}e.info.render.calls>0&&(this._blendPass.uniforms.tDiffuse2.value=this.transparentTarget.texture,this._blendPass.render(e,i,s,a,h),_=!0);{const ut=this.clear;this.clear=!1,et.transmissionRenderTarget=_?i:s,et.blurTransmissionTarget=this.blurTransmissionTarget,zr(e,{shadowMapRender:!1,backgroundRender:!1,opaqueRender:!1,transparentRender:!1,transmissionRender:!0},lt),et.blurTransmissionTarget=void 0,et.transmissionRenderTarget=void 0,this.clear=ut}e.info.render.calls>0&&(this._blendPass.uniforms.tDiffuse2.value=this.transparentTarget.texture,this._blendPass.render(e,i,s,a,h),_=!0)}}else{{const ut=this.clear,pt=e.autoClearDepth;e.autoClearDepth=!nt,this.clear=!0,zr(e,{shadowMapRender:!0,backgroundRender:!0,opaqueRender:!0,transparentRender:!0,transmissionRender:!1},lt),this.clear=ut,e.autoClearDepth=pt}{this._viewer.renderer.blit(s.texture,i,{clear:!0});const ut=this.clear;this.clear=!1,et.transmissionRenderTarget=i,et.blurTransmissionTarget=this.blurTransmissionTarget,zr(e,{shadowMapRender:!1,backgroundRender:!1,opaqueRender:!1,transparentRender:!1,transmissionRender:!0},lt),et.blurTransmissionTarget=void 0,et.transmissionRenderTarget=void 0,this.clear=ut}_=!1}this._releaseTransparentTarget(),this.needsSwap=_,e.userData.mainRenderPass=void 0}}function YS(c,e){return c.multiplyScalar(c.w*e),c.w=1,c}function XS(c,e){return YS(c,e),new mo(c.x,c.y,c.z)}function MA(c,e){const i=Math.max(c.x,Math.max(c.y,c.z));let s=Math.max(Math.min(i/e,1),0);return s=Math.ceil(255*s)/255,c.divideScalar(s*e),c.w=s,c}function fp(c,e){return MA(new b.Ltg(c.r,c.g,c.b,1),e)}var Ru=function(c,e,i,s){var a,h=arguments.length,d=h<3?e:s===null?s=Object.getOwnPropertyDescriptor(e,i):s;if(typeof Reflect=="object"&&typeof Reflect.decorate=="function")d=Reflect.decorate(c,e,i,s);else for(var _=c.length-1;_>=0;_--)(a=c[_])&&(d=(h<3?a(d):h>3?a(e,i,d):a(e,i))||d);return h>3&&d&&Object.defineProperty(e,i,d),d};function Kw(c){return Object.getPrototypeOf(c).constructor.PluginType}b.Vj0.background.fragmentShader=b.Vj0.background.fragmentShader.replace("uniform sampler2D t2D;",`uniform sampler2D t2D;
uniform float intensity;`),b.Vj0.background.fragmentShader=b.Vj0.background.fragmentShader.replace("texture2D( t2D, vUv )","texture2D( t2D, vUv )*intensity");class Xm extends ot{constructor({isAntialiased:e=!1,useRgbm:i=!0,useGBufferDepth:s=!1,screenShader:a="",...h}){var d;super(),this.console=console,this._state=j.None,this.plugins={},this._needsResize=!1,this.resizeObserver=window.ResizeObserver?new window.ResizeObserver(ut=>this.resize()):void 0,this._lastSize=new b.FM8,this._onContextRestore=ut=>{this.enabled=!0,this._canvas.width=this._lastSize.width,this._canvas.height=this._lastSize.height,this.resize(),this.scene.setDirty({sceneUpdate:!0,frameFade:!1})},this._onContextLost=ut=>{this._lastSize.set(this._canvas.width,this._canvas.height),this._canvas.width=2,this._canvas.height=2,this.resize(),this.enabled=!1},this.resize=()=>{this._needsResize=!0,this.setDirty()},this._needsReset=!0,this.enabled=!0,this.renderEnabled=!0,this._isRenderingFrame=!1,this.maxFramePerLoop=1,this._rawBackground=null,this.backgroundIntensity=1,this._sceneEnvironmentChanged=()=>{this._rawBackground===zv&&this.scene.setBackground(this.scene.getEnvironment())},this._addSceneObject=ut=>{var pt;if(!ut||!ut.object)return;const gt=ut.object.__importedViewerConfig||((pt=ut.object.modelObject)===null||pt===void 0?void 0:pt.__importedViewerConfig);if(!gt)return;const vt=this.getManager();vt?vt.applyViewerConfig(gt,gt.resources):this.fromJSON(gt,gt.resources)},this.alert=async ut=>alert(ut),this.confirm=async ut=>confirm(ut),this.prompt=async(ut,pt,gt=!0)=>prompt(ut,pt),this._useRgbm=i,this._useGBufferDepth=s,this._screenShader=a,this._canvas=h.canvas||a0();let _=h.container;if(_&&!h.canvas&&_.appendChild(this._canvas),_||(_=(d=this._canvas.parentElement)!==null&&d!==void 0?d:void 0),!_)throw new Error("No container.");this._container=_,this._animationLoop=this._animationLoop.bind(this),this.setDirty=this.setDirty.bind(this),this._setActiveCameraView=this._setActiveCameraView.bind(this),window.webGiViewers||(window.webGiViewers=[]),window.webGiViewers.push(this),async function(){var ut;const pt=window.location.href,gt="https://dev-sandbox.pixotronics.com/webgi/";if(!pt.startsWith(gt)||vu("noUpdate")!==null)return!0;const vt=(ut=pt.match(/\/webgi\/([0-9.a-zA-Z]+)/))===null||ut===void 0?void 0:ut[1],Ct=(await(await fetch(gt+"version.txt")).text()).split(`
`)[0];if(vt&&vt!==Ct){if(confirm(`New version ${Ct} is available, do you want to open?`)){const wt=window.location.href.replace(vt,Ct);return window.location.href=wt,!1}window.location.href.includes("noUpdate")||(window.location.href+=(window.location.href.includes("?")?"&":"?")+"noUpdate")}}();const et=new Wu(void 0,void 0,this._canvas);this.addEventListener("postFrame",()=>{var ut,pt;const gt=it.scene.activeCamera;if(gt&&gt.interactionsEnabled){if(((ut=this.getPluginByType("Progressive"))===null||ut===void 0?void 0:ut.postFrameConvergedRecordingDelta())===0)return;(pt=gt.controls)===null||pt===void 0||pt.update()}}),this.scene=new um(et),this.scene.addEventListener("environmentChanged",this._sceneEnvironmentChanged),this.scene.addEventListener("addSceneObject",this._addSceneObject),this.scene.addEventListener("setView",this._setActiveCameraView),this.scene.addEventListener("activateMain",this._setActiveCameraView),this._renderer=new Ks({canvas:this._canvas,animationLoop:this._animationLoop,targetOptions:{samples:e?4:0,encoding:i?Xn:b.rnI,type:i?b.ywz:b.cLu,depthBuffer:!s}}),this._isAntialiased=e&&this._renderer.isWebGL2;let nt=!0;this._renderer.rendererObject.userData||(nt=!1,this._renderer.rendererObject.userData={}),this._renderer.rendererObject.userData.renderTransmissionPass=!nt;const it=this;this.renderFilter={passId:"render",passObject:new VM(this,nt),update(){const ut=this.passObject;ut.scene=it.scene.modelObject,ut.camera=it.scene.activeCamera.cameraObject}};const lt={passId:"screen",after:["render"],required:["render"],passObject:lD(a)};[this.renderFilter,lt].forEach(ut=>this._renderer.registerPass(ut)),this._renderer.pipeline=["render","screen"],this.scene.addEventListener("sceneMaterialUpdate",ut=>this.setDirty(this.scene,ut)),this.scene.addEventListener("sceneUpdate",ut=>{this.setDirty(this.scene,ut),ut.geometryChanged!==!1&&this.renderer.resetShadows()}),this.scene.addEventListener("update",ut=>this.setDirty(this.scene,ut)),this._renderer.addEventListener("update",ut=>this.setDirty(this._renderer,ut)),this.resizeObserver&&this.resizeObserver.observe(this._canvas),window&&window.addEventListener("resize",this.resize),this._canvas.addEventListener("webglcontextrestored",this._onContextRestore,!1),this._canvas.addEventListener("webglcontextlost",this._onContextLost,!1),this.renderer.addEventListener("resize",()=>{this.scene.activeCamera.refreshAspect()}),this.setBackground("#ffffff"),this.console.log("WebGi Viewer instance initialized, version: ",Xm.VERSION)}get useRgbm(){return this._useRgbm}get screenShader(){return this._screenShader}get useGBufferDepth(){return this._useGBufferDepth}get isAntialiased(){return this._isAntialiased}setDirty(e,i){this._needsReset=!0,e=e??this,this.dispatchEvent({...i??{},type:"update",source:e})}get renderer(){return this._renderer}dispose(){var e;this._canvas.removeEventListener("webglcontextrestored",this._onContextRestore,!1),this._canvas.removeEventListener("webglcontextlost",this._onContextLost,!1),(e=window.webGiViewers)===null||e===void 0||e.splice(window.webGiViewers.indexOf(this),1),this.resizeObserver?this.resizeObserver.unobserve(this._canvas):window.removeEventListener("resize",this.resize),this.dispatchEvent({type:"dispose"})}_animationLoop({time:e,deltaTime:i,xrFrame:s}){var a,h;if(this.enabled&&this.renderEnabled)if(this._isRenderingFrame)this.console.warn("animation loop: frame skip");else{this._isRenderingFrame=!0;for(let d=0;d<this.maxFramePerLoop;d++){if(this._needsReset&&(this._renderer.reset(),this._needsReset=!1),this._needsResize){const nt=[this._canvas.clientWidth,this._canvas.clientHeight];if(s){const it=(h=(a=this._renderer.rendererObject.xr.getCamera())===null||a===void 0?void 0:a.cameras[0])===null||h===void 0?void 0:h.viewport;it?(it.x===0&&it.y===0||this.console.warn("x and y must be 0?"),nt[0]=it.width,nt[1]=it.height,this.console.log("resize for xr",nt)):this._needsResize=!1}this._needsResize&&(this._renderer.setSize(...nt),this._needsResize=!1)}this.dispatchEvent({type:"preFrame",target:this,time:e,deltaTime:i,xrFrame:s});const _=Object.values(this.plugins).filter(nt=>nt.dirty);_.length>0&&this.setDirty(_),this._needsReset&&(this._renderer.reset(),this._needsReset=!1),this._renderer.updateDirty();const et=this._renderer.dirty;if(et){this.dispatchEvent({type:"preRender",target:this});try{this._renderer.render()}catch(nt){this.console.error(nt),this.enabled=!1}this.dispatchEvent({type:"postRender",target:this})}if(this.dispatchEvent({type:"postFrame",target:this}),!et)break}this._isRenderingFrame=!1}}get state(){return this._state}get container(){return this._container}get canvas(){return this._canvas}getPlugin(e){return this.plugins[e.PluginType]}getPluginByType(e){return this.plugins[e]}async addPlugin(e,...i){var s;let a;a=e.prototype?new e(...i):e;const h=Kw(a);return h?((s=a.dependencies)===null||s===void 0||s.forEach(d=>{this.getPlugin(d)||this.addPlugin(d)}),this.plugins[h]&&this.console.error(`Plugin of type ${h} already exists`,this.plugins[h],a),this.plugins[h]=a,await a.onAdded(this),this.dispatchEvent({type:"addPlugin",target:this,plugin:a}),this.setDirty(a),a):(this.console.error("PluginType is not defined for",a),a)}async removePlugin(e,i=!0){const s=Kw(e);this.plugins[s]&&(await e.onRemove(this),delete this.plugins[s],i&&await e.onDispose(this),this.setDirty(e))}createCamera(e){var i;const s=(i=e.userData.iCamera)!==null&&i!==void 0?i:new Wu(e,{controlsMode:"",controlsEnabled:!1},this._canvas);return s.autoLookAtTarget=!1,s}setSize(e){this._canvas.style.width=e!=null&&e.width?e.width+"px":"100%",this._canvas.style.height=e!=null&&e.height?e.height+"px":"100%",this.resize()}_backgroundIntensityChanged(){var e,i,s,a;const h=(a=(s=(i=(e=this._renderer)===null||e===void 0?void 0:e.rendererObject)===null||i===void 0?void 0:i.background.getPlaneMesh())===null||s===void 0?void 0:s.material.uniforms)!==null&&a!==void 0?a:b.Vj0.background.uniforms;h.intensity||(h.intensity={value:1}),h.intensity.value=this.backgroundIntensity,this.setDirty()}setBackgroundColor(e){const i=new mo().set(e).convertSRGBToLinear();return this.setBackground(i)}setBackground(e){if(this._rawBackground=e,e!=null&&(typeof e=="string"||typeof e=="number"||e.isVector4||e.isColor)){if(e===zv)return this._sceneEnvironmentChanged();const i=e.isVector4?kr(e):Ur(e.isColor?e:new mo(e));return i.assetType="texture",this.scene.setBackground(i)}return!e&&this.useRgbm&&this.console.error("Transparent background not supported with HDR RGBM rendering mode"),this.scene.setBackground(e)}getBackground(e=!1){var i,s,a;if(e)return this._rawBackground;let h=(i=this._rawBackground)!==null&&i!==void 0?i:this.scene.getBackground();return h?(!((s=h)===null||s===void 0)&&s.isVector4&&(h=XS(h,7).getHexString()),!((a=h)===null||a===void 0)&&a.isColor?h.getHexString():this._rawBackground===zv?this.scene.getEnvironment():h):null}getManager(){return this.getPluginByType("AssetManager")}resetCamera({rootObject:e,centerOffset:i=new b.Pa4(1,1,1),targetOffset:s=new b.Pa4(0,0,0),...a}={}){if(this.scene.activeCamera){this.scene.matrixWorldNeedsUpdate=!0,this.scene.updateMatrixWorld(!0);const h=e?new Dr().expandByObject(e,!0,!0):this.scene.getBounds(!0),d=h.getCenter(new b.Pa4),_=.5*h.getSize(new b.Pa4).length();d.add(s.clone().multiplyScalar(_)),this.scene.activeCamera.position=new b.Pa4(d.x+i.x*_,d.y+i.y*_,d.z+i.z*_),this.scene.activeCamera.target=d,this.setDirty()}}async createObject3D(e){var i;return(i=this.getManager())===null||i===void 0?void 0:i.addImportedSingle(e||new b.Tme,{autoScale:!1,pseudoCenter:!1})}createPhysicalMaterial(e){return this.createMaterial("standard",e)}createMaterial(e,i){var s,a,h,d,_;if(!((s=i)===null||s===void 0)&&s.isMaterial){const et=(h=(a=this.getManager())===null||a===void 0?void 0:a.materials)===null||h===void 0?void 0:h.findMaterial(i.uuid);if(et)return et}return(_=(d=this.getManager())===null||d===void 0?void 0:d.materials)===null||_===void 0?void 0:_.generateFromTemplate(e,i)}serializePlugins(e,i){return Object.entries(this.plugins).map(s=>{var a,h;if(!i||i.includes(s[1].constructor.PluginType))return s[1].serializeWithViewer!==!1?(h=(a=s[1]).toJSON)===null||h===void 0?void 0:h.call(a,e):void 0}).filter(s=>!!s)}deserializePlugins(e,i){return e.forEach(s=>{var a;if(!s.type)return void this.console.warn("Invalid plugin to import ",s);const h=this.getPluginByType(s.type);h&&((a=h.fromJSON)===null||a===void 0||a.call(h,s,i))}),this}traverseSceneObjects(e){this.scene.modelRoot.modelObject.traverse(e)}toJSON(e,i){return Object.assign({version:Xm.VERSION,plugins:this.serializePlugins(e,i)},ao(this,!0,e))}fromJSON(e,i){return to(e,this,!0,i),Array.isArray(e.plugins)&&this.deserializePlugins(e.plugins,i),this.setBackground(this._rawBackground),this}_setActiveCameraView(e={}){if(e.type==="setView"){if(!e.camera)return void console.warn("Cannot find camera",e);this.scene.activeCamera.copyFromCamera(e.camera)}else e.type==="activateMain"&&(this.scene.activeCamera=e.camera?this.createCamera(e.camera):void 0)}}Xm.VERSION="0.5.8",Ru([Fn()],Xm.prototype,"scene",void 0),Ru([Fn("background")],Xm.prototype,"_rawBackground",void 0),Ru([Fn(),pn(Xm.prototype._backgroundIntensityChanged)],Xm.prototype,"backgroundIntensity",void 0);const zv="envMapBackground";function lD(c){var e,i,s;return!((e=c)===null||e===void 0)&&e.isShaderPass2?c:new Tl({...yt,fragmentShader:`
                       varying vec2 vUv;
                       
                       ${Array.isArray(c)?c[0]:((i=c)===null||i===void 0?void 0:i.pars)||""}
                       
                       void main() {

                            gl_FragColor = tDiffuseTexelToLinear (texture2D(tDiffuse, vUv));
                            
                            ${Array.isArray(c)?c[1]:typeof c=="string"?c:((s=c)===null||s===void 0?void 0:s.main)||""}
                            
                        }`,uniforms:{tDiffuse:{value:null}}},"tDiffuse")}var V1=function(c,e,i,s){var a,h=arguments.length,d=h<3?e:s===null?s=Object.getOwnPropertyDescriptor(e,i):s;if(typeof Reflect=="object"&&typeof Reflect.decorate=="function")d=Reflect.decorate(c,e,i,s);else for(var _=c.length-1;_>=0;_--)(a=c[_])&&(d=(h<3?a(d):h>3?a(e,i,d):a(e,i))||d);return h>3&&d&&Object.defineProperty(e,i,d),d};let M0=class extends Ls{constructor(){super(),this.toJSON=void 0,this.enabled=!0,this._lastSize=["100%","100%"],this._lastFsElement=null,this._fsChangeHandler=c=>{var e;if(this.isFullScreen())this.dispatchEvent({type:"enter"});else{const i=this._lastFsElement||((e=this._viewer)===null||e===void 0?void 0:e.canvas);i&&(i.style.width=this._lastSize[0],i.style.height=this._lastSize[1]),document.removeEventListener("webkitfullscreenchange",this._fsChangeHandler,!1),document.removeEventListener("mozfullscreenchange",this._fsChangeHandler,!1),document.removeEventListener("fullscreenchange",this._fsChangeHandler,!1),document.removeEventListener("MSFullscreenChange",this._fsChangeHandler,!1),this.dispatchEvent({type:"exit"})}},this.enter=this.enter.bind(this),this.exit=this.exit.bind(this)}async enter(c){var e;if(this.isFullScreen())return;const i=c||((e=this._viewer)===null||e===void 0?void 0:e.canvas);return i?(this._lastFsElement=i,document.addEventListener&&(document.addEventListener("webkitfullscreenchange",this._fsChangeHandler,!1),document.addEventListener("mozfullscreenchange",this._fsChangeHandler,!1),document.addEventListener("fullscreenchange",this._fsChangeHandler,!1),document.addEventListener("MSFullscreenChange",this._fsChangeHandler,!1)),this._lastSize=[i.style.width,i.style.height],i.style.width="100%",i.style.height="100%",i.requestFullscreen?i.requestFullscreen():i.mozRequestFullScreen?i.mozRequestFullScreen():i.webkitRequestFullscreen?i.webkitRequestFullscreen():i.msRequestFullscreen?i.msRequestFullscreen():void 0):void 0}async exit(){return document.exitFullscreen?document.exitFullscreen():document.mozCancelFullScreen?document.mozCancelFullScreen():document.webkitExitFullscreen?document.webkitExitFullscreen():document.msExitFullscreen?document.msExitFullscreen():void 0}async toggle(c){return this.isFullScreen()?this.exit():this.enter(c)}isFullScreen(){return document.webkitIsFullScreen||document.mozFullScreen||document.msFullscreenElement!==void 0}};M0.PluginType="FullScreenPlugin",V1([uo("Enter FullScreen")],M0.prototype,"enter",null),V1([uo("Exit FullScreen")],M0.prototype,"exit",null),V1([uo("Toggle FullScreen")],M0.prototype,"toggle",null),M0=V1([Ys("Full Screen")],M0);class QM{constructor(e,i,s){this._el=e,this._inputEl=i,this._listeners={drop:[],dropstart:[],droperror:[]},this._onDragover=this._onDragover.bind(this),this._onDrop=this._onDrop.bind(this),this._onSelect=this._onSelect.bind(this),e==null||e.addEventListener("dragover",this._onDragover,!1),e==null||e.addEventListener("drop",this._onDrop,!1),i==null||i.addEventListener("change",this._onSelect),s&&Object.entries(s).forEach(([a,h])=>h&&this.on(a,h))}get inputEl(){return this._inputEl}get el(){return this._el}on(e,i){return this._listeners[e].push(i),this}_emit(e,i){return this._listeners[e].forEach(s=>s(i)),this}destroy(){const e=this._el,i=this._inputEl;e==null||e.removeEventListener("dragover",this._onDragover),e==null||e.removeEventListener("drop",this._onDrop),i==null||i.removeEventListener("change",this._onSelect)}_onDrop(e){var i,s;e.stopPropagation(),e.preventDefault(),this._emit("dropstart");const a=Array.from(((i=e.dataTransfer)===null||i===void 0?void 0:i.files)||[]),h=Array.from(((s=e.dataTransfer)===null||s===void 0?void 0:s.items)||[]);if(a.length!==0||h.length!==0)if(h.length>0){const d=h.map(_=>_.webkitGetAsEntry());this._loadNextEntry(new Map,d)}else this._emit("drop",{files:new Map(a.map(d=>(d.filePath=d.name,[d.filePath,d])))});else this._fail("Required drag-and-drop APIs are not supported in this browser.")}_onDragover(e){e.stopPropagation(),e.preventDefault(),e.dataTransfer&&(e.dataTransfer.dropEffect="copy")}_onSelect(e){var i;if(!this._inputEl)return void console.warn("Invalid Dropzone event ",e);this._emit("dropstart");const s=[].slice.call((i=this._inputEl.files)!==null&&i!==void 0?i:new FileList),a=new Map;s.forEach(h=>{h.filePath=h.webkitRelativePath||h.name,a.set(h.filePath,h)}),this._emit("drop",{files:a})}_loadNextEntry(e,i){const s=i.pop();if(s)if(s.isFile)s.file(a=>{a.filePath=s.fullPath,e.set(s.fullPath,a),this._loadNextEntry(e,i)},()=>console.error("Could not load file: %s",s.fullPath));else if(s.isDirectory){const a=s.createReader(),h=d=>{d.length?(i=i.concat(d),a.readEntries(h)):this._loadNextEntry(e,i)};a.readEntries(h)}else console.warn("Unknown asset type: "+s.fullPath),this._loadNextEntry(e,i);else this._emit("drop",{files:e})}_fail(e){this._emit("droperror",{message:e})}}class Jw extends ot{constructor(e){super(),this._domElement=e,this._allowedExtensions=void 0,this.importerParams={autoScale:!0,autoScaleRadius:2,pseudoCenter:!1,autoCenter:!0,autoImport:!0,autoAdd:!0,centerOffset:new b.Pa4(.5,.5,3)},this.dependencies=[qr],this.uiConfig={type:"folder",label:"Drop Options",children:[{label:"Auto Center",type:"checkbox",property:[this.importerParams,"autoCenter"],limitedUi:!0},{label:"Auto Scale",type:"checkbox",property:[this.importerParams,"autoScale"],limitedUi:!0},{label:"Auto scale radius",type:"slider",bounds:[.5,100],property:[this.importerParams,"autoScaleRadius"]}]}}async onAdded(e){this._inputEl=document.createElement("input"),this._viewer=e,this._inputEl.type="file",this._dropzone=new QM(this._domElement||e.canvas,this._inputEl,{drop:this._onFileDrop.bind(this)})}async _onFileDrop({files:e}){var i,s,a,h,d,_;if(!e)return;const et=this._viewer;if(!et)return;if(this._allowedExtensions!==void 0)for(const lt of e.keys())this._allowedExtensions.includes((s=(i=lt.split(".").pop())===null||i===void 0?void 0:i.toLowerCase())!==null&&s!==void 0?s:"")||e.delete(lt);if(e.size<1)return;const nt=et.getPlugin(qr),it={type:"drop",files:e};if(this.importerParams.autoImport){const lt={allowedExtensions:this.allowedExtensions,...this.importerParams};if(it.imported=await((a=nt.importer)===null||a===void 0?void 0:a.importFiles(e,lt)),this.importerParams.autoAdd){const ut=(_=[...(d=(h=it.imported)===null||h===void 0?void 0:h.values())!==null&&d!==void 0?d:[]].flat(2).filter(pt=>!!pt))!==null&&_!==void 0?_:[];if(it.assets=nt.addProcessedAssets(ut,{...this.importerParams}),!lt._rootSceneImported)for(const pt of it.assets)pt.modelObject&&pt.modelObject.dispatchEvent({type:"select",value:pt.modelObject})}}this.dispatchEvent(it)}promptForFile(){var e;(e=this._inputEl)===null||e===void 0||e.click()}async onDispose(e){}async onRemove(e){var i;(i=this._dropzone)===null||i===void 0||i.destroy(),this._dropzone=void 0,this._viewer=void 0}get allowedExtensions(){return this._allowedExtensions}set allowedExtensions(e){this._allowedExtensions=e,this._inputEl&&(this._inputEl.accept=e?e.map(i=>"."+i).join(", "):"")}}Jw.PluginType="Dropzone";class KS extends Tl{constructor(e){super({vertexShader:yt.vertexShader,fragmentShader:Qt`
                uniform vec4 weight;
                uniform vec4 weight2;
                varying vec2 vUv;
                void main() {
                    vec4 texel = clamp(weight * tDiffuseTexelToLinear ( texture2D( tDiffuse, vUv ) ) + weight2 * tDiffuse2TexelToLinear ( texture2D( tDiffuse2, vUv ) ), vec4(0), vec4(8));
                    gl_FragColor = texel;
                    #include <encodings_fragment>
                }
            `,uniforms:{tDiffuse:{value:null},tDiffuse2:{value:e},weight:{value:new b.Ltg(1,1,1,1)},weight2:{value:new b.Ltg(1,1,1,1)}}},"tDiffuse","tDiffuse2"),this.clear=!1,this.needsSwap=!0}set weights2(e){this.uniforms.weight2.value.copy(e)}get weights2(){return this.uniforms.weight2.value}set weights1(e){this.uniforms.weight.value.copy(e)}get weights1(){return this.uniforms.weight.value}set blendTexture(e){this.uniforms.tDiffuse2.value=e}}class Zw extends Ls{constructor(){super(),this._pipeline=[]}get passes(){if(!this._passes)throw"Plugin not yet added to the viewer";return this._passes}get pipeline(){return this._pipeline}set pipeline(e){this._pipeline=e}async onAdded(e){await super.onAdded(e);const i=this.createPasses(e);this._passes=Object.fromEntries(i.map(s=>(s.passId||(console.warn("no id found for pass",s),s.passId=gu()),e.renderer.registerPass(s,!0),[s.passId,s])))}async onRemove(e){var i;if(this._passes){for(const s of[...Object.values(this._passes)]){const a=s;e.renderer.unregisterPass(a),(i=a==null?void 0:a.dispose)===null||i===void 0||i.call(a)}this._passes=void 0}await super.onRemove(e)}toJSON(e){var i,s;const a=super.toJSON(e);if(!a.type)return a;const h=Object.entries(this.passes);a.passes={};for(const[d,_]of h)a.passes[d]=ao((s=(i=_)===null||i===void 0?void 0:i.passObject)!==null&&s!==void 0?s:_,!1,e);return a}fromJSON(e,i){var s,a;if(!super.fromJSON(e,i))return null;if(e.passes){const h=Object.entries(this.passes);for(const[d,_]of h)to(e.passes[d],(a=(s=_)===null||s===void 0?void 0:s.passObject)!==null&&a!==void 0?a:_,!1,i)}return this}}var GM=function(c,e,i,s){var a,h=arguments.length,d=h<3?e:s===null?s=Object.getOwnPropertyDescriptor(e,i):s;if(typeof Reflect=="object"&&typeof Reflect.decorate=="function")d=Reflect.decorate(c,e,i,s);else for(var _=c.length-1;_>=0;_--)(a=c[_])&&(d=(h<3?a(d):h>3?a(e,i,d):a(e,i))||d);return h>3&&d&&Object.defineProperty(e,i,d),d};const JS=[{x:0,y:0},{x:-.5,y:0},{x:-.375,y:-.25},{x:-.1875,y:-.125},{x:-.125,y:-.375},{x:.0625,y:-.0625},{x:.125,y:-.3125},{x:.375,y:-.4375},{x:.3125,y:-.1875},{x:.25,y:.0625},{x:.4375,y:.25},{x:.1875,y:.3125},{x:0,y:.4375},{x:-.0625,y:.1875},{x:-.25,y:.375},{x:-.4375,y:.5},{x:-.3125,y:.125}];class Bu extends Zw{constructor(e=2*JS.length){super(),this.enabled=!0,this.jitter=!0,this._hasSetOffset=!1,this.trackedJitterCameras=new Set,this._addSceneObject=i=>{const s=i.object;(s.modelObject||s.lightObject)&&(s.modelObject||s.lightObject).traverse(a=>{var h;!((h=a==null?void 0:a.shadow)===null||h===void 0)&&h.camera&&a.shadow.mapSize&&this.trackedJitterCameras.add([a.shadow.camera,a.shadow.mapSize])})},this._jitterCamera=i=>{var s;const a=i.target;if(this.jitter&&a.renderer.frameCount>2){const h=(_,et)=>{const nt={...JS[a.renderer.frameCount%JS.length]};_.setViewOffset(et.width,et.height,nt.x,nt.y,et.width,et.height)},d=a.scene.activeCamera.cameraObject;h(d,{width:a.canvas.clientWidth*a.renderer.displayCanvasScaling,height:a.canvas.clientHeight*a.renderer.displayCanvasScaling}),this.trackedJitterCameras.forEach(_=>h(..._)),this._hasSetOffset=!0,(s=this._viewer)===null||s===void 0||s.renderer.resetShadows()}},this._resetCameraJitter=i=>{const s=i.target;this._hasSetOffset&&(s.scene.activeCamera.cameraObject.clearViewOffset(),this._hasSetOffset=!1)},this.uiConfig=o0("Progressive",this),this.maxFrameCount=e}async onAdded(e){return this._lastFrame=e.renderer.composerTarget.clone(!0),await super.onAdded(e)}async onRemove(e){e.removeEventListener("preRender",this._jitterCamera),e.removeEventListener("postRender",this._resetCameraJitter),e.scene.removeEventListener("addSceneObject",this._addSceneObject),this._lastFrame&&e.renderer.disposeTarget(this._lastFrame),this._lastFrame=void 0,await super.onRemove(e)}get lastFrame(){return this._lastFrame}createPasses(e){e.addEventListener("preRender",this._jitterCamera),e.addEventListener("postRender",this._resetCameraJitter),e.scene.addEventListener("addSceneObject",this._addSceneObject);const i=this;return[CA(e,{passId:"progressive",get dirty(){var a;return i.jitter&&(((a=i._viewer)===null||a===void 0?void 0:a.renderer.frameCount)||0)<i.maxFrameCount},after:["render"],before:["combinedPost","screen"],required:["render"],passObject:new class extends KS{render(a,h,d,_,et){if(e.renderer.frameCount<1)return this.needsSwap=!1,void((d==null?void 0:d.texture)&&e.renderer.blit(d.texture,i.lastFrame,{}));this.needsSwap=!0,super.render(a,h,d,_,et),e.renderer.blit(h.texture,i.lastFrame,{})}},update(){if(!i.lastFrame)return void console.error("lastFrame render target undefined");let a=1/(Math.max(e.renderer.frameCount,0)+1);this.passObject.weights1.set(a,a,a,a),a=1-a,this.passObject.weights2.set(a,a,a,a),this.passObject.blendTexture=i.lastFrame.texture,this.passObject.material.uniformsNeedUpdate=!0}})]}isConverged(e=!1){var i;return(((i=this._viewer)===null||i===void 0?void 0:i.renderer.frameCount)||0)>=this.maxFrameCount-1+(e?1:0)}updateShaderProperties(e){var i,s;return e.uniforms.tLastFrame&&(e.uniforms.tLastFrame.value=(s=(i=this.lastFrame)===null||i===void 0?void 0:i.texture)!==null&&s!==void 0?s:void 0),this}postFrameConvergedRecordingDelta(e="CanvasRecorder"){const i=this._viewer.getPluginByType(e);return i&&i.isRecording()&&i.convergeMode?this.isConverged(!0)?1/i.videoFrameRate:0:-1}}Bu.PluginType="Progressive",GM([Fn(),qs("Frame count")],Bu.prototype,"maxFrameCount",void 0),GM([Fn(),ts("Jitter")],Bu.prototype,"jitter",void 0);var Km="varying vec2 vUv;void main(){vUv=uv;gl_Position=projectionMatrix*modelViewMatrix*vec4(position,1.);}",$w=`#ifndef BASIC_CAMERA_HELPERS
#define BASIC_CAMERA_HELPERS 
uniform vec2 cameraNearFar;uniform vec3 cameraPositionWorld;uniform mat4 projection;
#ifndef THREE_PACKING_INCLUDED
#define THREE_PACKING_INCLUDED 
#include <packing>
#endif
float linstep(float edge0,float edge1,float value){return clamp((value-edge0)/(edge1-edge0),0.,1.);}float depthToViewZ(const in float depth){return(depth>0.999)?-cameraNearFar.y*1000.:-mix(cameraNearFar.x,cameraNearFar.y,depth);}float viewZToDepth(const in float viewZ){return linstep(-cameraNearFar.x,-cameraNearFar.y,viewZ);}vec4 viewToScreen3(const in vec3 pos){vec4 projected=projection*vec4(pos,1.);projected.z=pos.z;projected.w=1./projected.w;projected.xyz*=projected.w;projected.xy=0.5+0.5*projected.xy;return projected;}vec3 screenToView(const in vec2 uv,const in float viewZ){vec2 uv_=2.*uv-1.;float xe=-(uv_.x+projection[2][0])*viewZ/projection[0][0];float ye=-(uv_.y+projection[2][1])*viewZ/projection[1][1];return vec3(xe,ye,viewZ);}
#endif
`,Q1=`#ifndef BASIC_HELPERS
#define BASIC_HELPERS 
float saturate2(float v,float mx){return max(0.,min(mx,v));}vec3 saturate2(vec3 v){return max(vec3(0.),min(vec3(1.),v));}
#endif
`,Jm=`#ifndef BASIC_RANDOM_HELPERS
#define BASIC_RANDOM_HELPERS 
uniform float frameCount;float random(float n){return fract(sin(n)*43758.5453123);}float random2(vec2 n,float x){n+=x;return fract(sin(dot(n.xy,vec2(12.9898,78.233)))*43758.5453);}float random3(vec3 v){v=fract(v*443.8975);v+=dot(v,v.yzx+19.19);return fract((v.x+v.y)*v.z);}float interleavedGradientNoise(const in vec2 fragCoord,const in float seed){vec3 magic=vec3(0.06711056,0.00583715,52.9829189);return fract(magic.z*fract(dot(fragCoord.xy+seed*vec2(2.083,4.867),magic.xy)));}vec3 hash3(vec2 p){vec3 q=vec3(dot(p,vec2(127.1,311.7)),dot(p,vec2(269.5,183.3)),dot(p,vec2(419.2,371.9)));return fract(sin(q)*43758.5453);}
#endif
`,ZS=`#define PI  3.141592653589793
mat3 GetTangentBasis(vec3 TangentZ){vec3 up=vec3(0.,0.,1.);vec3 TangentX=normalize(cross(dot(TangentZ,up)<0.8?up:vec3(1.,0.,0.),TangentZ));vec3 TangentY=cross(TangentZ,TangentX);return mat3(TangentX,TangentY,TangentZ);}vec4 CosineSampleHemisphere(vec2 E){float Phi=2.*PI*E.x;float CosTheta=sqrt(E.y);float SinTheta=sqrt(1.-CosTheta*CosTheta);vec3 H;H.x=SinTheta*cos(Phi);H.y=SinTheta*sin(Phi);H.z=CosTheta;float PDF=CosTheta*(1./PI);return vec4(H,PDF);}vec4 UniformSampleHemisphere(vec2 E){float Phi=2.*PI*E.x;float CosTheta=E.y;float SinTheta=sqrt(1.-CosTheta*CosTheta);vec3 H;H.x=SinTheta*cos(Phi);H.y=SinTheta*sin(Phi);H.z=CosTheta;float PDF=1./(2.*PI);return vec4(H,PDF);}vec2 UniformSampleDiskConcentric(vec2 E){vec2 p=2.*E-1.;float Radius;float Phi;if(abs(p.x)>abs(p.y)){Radius=p.x;Phi=(PI/4.)*(p.y/p.x);}else{Radius=p.y;Phi=(PI/2.)-(PI/4.)*(p.x/p.y);}return vec2(Radius*cos(Phi),Radius*sin(Phi));}vec2 UniformSampleDiskConcentricApprox(vec2 E){vec2 sf=E*sqrt(2.)-sqrt(0.5);vec2 sq=sf*sf;float root=sqrt(2.*max(sq.x,sq.y)-min(sq.x,sq.y));if(sq.x>sq.y){sf.x=sf.x>0.?root:-root;}else{sf.y=sf.y>0.?root:-root;}return sf;}`,G1=`#ifndef SSRT_PARS_SNIP
#define SSRT_PARS_SNIP 
#define pow2(a)a*a
float getDepth2(const in vec2 uv,const in float lod){float viewDepth=getDepth(uv);return depthToViewZ(viewDepth);}
#define LOD_DEPTH  1.0
#define LOD_COLOR  5.0
void _traceRay(in vec4 ray_origin,in vec4 ray_dir,in float tolerance,inout vec3 state,in int loopMax,in float iStepCount){vec4 sample_uv;float d,hit;float dLod=0.;
#pragma unroll_loop_start
for(int i=0;i<8;i++){if(UNROLLED_LOOP_INDEX<loopMax){sample_uv=ray_origin+ray_dir*state.y;d=getDepth2(sample_uv.xy,dLod);d=sample_uv.z/sample_uv.w-d;if(abs(d+tolerance)<tolerance){hit=clamp(state.x/(state.x-d),0.,1.)-1.;hit=(state.y+hit*iStepCount);state.z=min(state.z,hit);}state.x=d;state.y+=1.*iStepCount;}}
#pragma unroll_loop_end
}vec3 traceRay(in vec3 ray_origin_view,in vec3 ray_dir_view,in float tolerance,inout vec3 state,in int _STEP_COUNT){vec4 sample_uv;vec4 ray_origin=viewToScreen3(ray_origin_view);vec3 ray_end_view=ray_origin_view+ray_dir_view;vec4 ray_dir=viewToScreen3(ray_end_view);vec2 clamp_end=clamp(ray_dir.xy,vec2(0.),vec2(1.));vec2 correction=abs(ray_dir.xy-clamp_end);correction=(step(0.01,correction)*correction/(abs(clamp_end-ray_origin.xy)+0.01))+1.;correction.x=1./min(max(correction.y,correction.x),10.);ray_dir=ray_dir-ray_origin;ray_dir.xyw*=correction.x;float iStepCount=1./float(_STEP_COUNT);tolerance*=0.125;_traceRay(ray_origin,ray_dir,tolerance,state,_STEP_COUNT,iStepCount);if(_STEP_COUNT>8&&state.z>0.98)_traceRay(ray_origin,ray_dir,tolerance,state,_STEP_COUNT-8,iStepCount);if(_STEP_COUNT>15&&state.z>0.98)_traceRay(ray_origin,ray_dir,tolerance,state,_STEP_COUNT-16,iStepCount);if(_STEP_COUNT>23&&state.z>0.98)_traceRay(ray_origin,ray_dir,tolerance,state,_STEP_COUNT-16,iStepCount);sample_uv=ray_origin+ray_dir*state.z;sample_uv.z/=sample_uv.w;state.z=state.z<0.999?state.z:9999999.;return sample_uv.xyz;}
#endif
`,HM=`uniform float objectRadius;uniform float radius;uniform float tolerance;uniform bool autoRadius;
#ifndef D_sceneBoundingRadius
#define D_sceneBoundingRadius 
uniform float sceneBoundingRadius;
#endif
vec3 ComputeReflectionL(vec3 N,vec2 E,vec3 V,float rough){float rough4=rough*rough*rough*rough;float phi=2.*PI*E.x;float cos_theta=pow(max(E.y,0.000001),rough4/(2.-rough4));float sin_theta=sqrt(max(0.,1.-cos_theta*cos_theta));vec3 half_vec=vec3(sin_theta*cos(phi),sin_theta*sin(phi),cos_theta);vec3 tangentX=normalize(cross(abs(N.z)<0.999?vec3(0.,0.,1.):vec3(1.,0.,0.),N));vec3 tangentY=cross(N,tangentX);half_vec=half_vec.x*tangentX+half_vec.y*tangentY+half_vec.z*N;vec3 ray_dir=(2.*dot(V,half_vec))*half_vec-V;return ray_dir;}vec2 GetRandomE(float seed){vec2 rand_e;rand_e.x=interleavedGradientNoise(gl_FragCoord.xy,frameCount*117.);rand_e.y=fract(rand_e.x*38.65435);rand_e.y=mix(rand_e.y,1.,0.7);return rand_e;}vec4 calculateSSR(in float seed,in vec3 screenPos,in vec3 normal,in float radiusFactor,in float roughness){vec3 viewPos=screenToView(screenPos.xy,screenPos.z);normal=normalize(normal);vec2 E=GetRandomE(seed);vec3 L=ComputeReflectionL(normal,E,-normalize(viewPos),roughness);L=normalize(L);float cameraDist=length(cameraPositionWorld);float rayLen=autoRadius?mix((cameraDist+objectRadius*sceneBoundingRadius)+viewPos.z,-viewPos.z-max(0.,cameraDist-objectRadius*sceneBoundingRadius),L.z*0.5+0.5):objectRadius*sceneBoundingRadius;rayLen*=radiusFactor;float r=interleavedGradientNoise(gl_FragCoord.xy,frameCount+seed);rayLen=max(rayLen,0.001);int steps=SSR_STEP_COUNT/(frameCount<float(SSR_LOW_QUALITY_FRAMES)?2:1);vec3 state=vec3(0.,(r+0.5)/float(steps),2.);viewPos+=normal*max(-0.0001*viewPos.z,0.001);vec3 screenHitP=traceRay(viewPos,L*rayLen,tolerance*rayLen,state,steps);if(state.z<0.99){vec3 hitColor=(tLastFrameTexelToLinear(texture2D(tLastFrame,screenHitP.xy))).rgb;float ssrWeight=1.;return vec4(hitColor*ssrWeight,1.);}return vec4(0.);}`,H1=`#ifndef SIMPLE_CAMERA_HELPERS
#define SIMPLE_CAMERA_HELPERS 
#ifndef USE_TRANSMISSION
uniform mat4 projectionMatrix;
#endif
vec3 viewToScreen(const in vec3 pos){vec4 projected=projectionMatrix*vec4(pos,1.);return vec3(0.5+0.5*projected.xy/projected.w,projected.w);}
#endif
`,Zm=function(c,e,i,s){var a,h=arguments.length,d=h<3?e:s===null?s=Object.getOwnPropertyDescriptor(e,i):s;if(typeof Reflect=="object"&&typeof Reflect.decorate=="function")d=Reflect.decorate(c,e,i,s);else for(var _=c.length-1;_>=0;_--)(a=c[_])&&(d=(h<3?a(d):h>3?a(e,i,d):a(e,i))||d);return h>3&&d&&Object.defineProperty(e,i,d),d};let Gp=class extends Tl{constructor(c,e,i,s=!0){super({vertexShader:Km,fragmentShader:`

varying vec2 vUv;

${Q1}
${$w}
${Jm}
${ZS}
${i}

${G1}

${HM}

uniform sampler2D tLastThis;void main(){vec4 texel=tDiffuseTexelToLinear(texture2D(tDiffuse,vUv));vec4 lastAO=tLastThisTexelToLinear(texture2D(tLastThis,vUv));float depth;vec3 normal;getDepthNormal(vUv,depth,normal);if(depth>=0.999){discard;}float viewZ=depthToViewZ(depth);vec3 screenPos=vec3(vUv.x,vUv.y,viewZ);vec3 viewPos=screenToView(screenPos.xy,screenPos.z);viewPos.z=viewZ/viewPos.z;vec4 ao=vec4(0.);ao+=calculateSSR(8.,screenPos,normal,1.,0.1);ao.rgb=min(vec3(3.),ao.rgb);ao.rgb=max(vec3(0.),ao.rgb);if(frameCount<1.){gl_FragColor=ao;return;}if(ao.a<0.01){gl_FragColor.rgb=lastAO.rgb;gl_FragColor.a=(((lastAO.a)*frameCount)/(frameCount+1.));}else{gl_FragColor=((ao+(lastAO)*frameCount)/(frameCount+1.));}
#include <encodings_fragment>
}


            `,uniforms:{tLastThis:{value:null},tDiffuse:{value:null},tNormalDepth:{value:null},tLastFrame:{value:null},opacity:{value:1},intensity:{value:0},boost:{value:new b.Pa4(0,0,0)},objectRadius:{value:0},autoRadius:{value:!1},power:{value:0},maskFrontFactor:{value:-.1},tolerance:{value:0},frameCount:{value:0},projection:{value:new b.yGw},cameraPositionWorld:{value:new b.Pa4},cameraNearFar:{value:new b.FM8(.1,1e3)},sceneBoundingRadius:{value:0}},defines:{PERSPECTIVE_CAMERA:1,SSR_STEP_COUNT:16,SSR_LOW_QUALITY_FRAMES:2,SSR_MASK_FRONT_RAYS:!0,SSR_INLINE:s?"1":"0",SSR_NON_PHYSICAL:"0"}},"tDiffuse","tLastThis","tLastFrame"),this.uiConfig=void 0,this.materialExtension={shaderExtender:(a,h,d)=>{if(!a.defines.SSR_ENABLED)return;const _="#glMarker beforeModulation";a.fragmentShader=a.fragmentShader.replace(_,`

            
            #if defined(SSR_ENABLED) && SSR_ENABLED > 0
vec3 screenPos=viewToScreen(geometry.position);vec4 ssrColor=vec4(0,0,0,0);float alphaModifier=1.-clamp(material.roughness*.3,0.,1.);alphaModifier*=ssrIntensity;
#if defined(SSR_MASK_FRONT_RAYS) && SSR_MASK_FRONT_RAYS > 0
alphaModifier*=clamp(-4.*dot(geometry.viewDir,normal)+(4.+ssrMaskFrontFactor),0.,1.);
#endif
#ifdef USE_TRANSMISSION
alphaModifier*=1.-transmission;
#endif
float vignette=1.;if(true){float fadeStrength=0.1;float dist=min(min(1.-screenPos.x,1.-screenPos.y),min(screenPos.x,screenPos.y));float fade=dist*dist/(fadeStrength+0.001);fade=clamp(fade,0.,1.);fade=pow(fade,0.3);vignette=fade;}alphaModifier*=vignette;vec3 specularColor=EnvironmentBRDF(geometry.normal,geometry.viewDir,material.specularColor.rgb,material.specularF90,material.roughness);if(length(specularColor.rgb)*alphaModifier>0.01&&roughnessFactor<0.9){
#if defined(SSR_INLINE) && SSR_INLINE > 0
ssrColor=calculateSSR(8.,vec3(screenPos.xy,geometry.position.z),geometry.normal,1.,material.roughness);
#else
ssrColor=tSSRMapTexelToLinear(texture2D(tSSRMap,screenPos.xy));
#endif 
}ssrColor.rgb*=ssrBoost;ssrColor.a*=alphaModifier;ssrColor.a=min(ssrColor.a,1.);
#if defined(SSR_NON_PHYSICAL) && SSR_NON_PHYSICAL > 0
diffuseColor.a=max(ssrColor.a,diffuseColor.a*diffuseColor.a);reflectedLight.indirectSpecular=mix(reflectedLight.indirectSpecular,saturate(diffuseColor.rgb*ssrColor.rgb),1.);reflectedLight.indirectDiffuse=diffuseColor.rgb*(1.-ssrColor.a);reflectedLight.directDiffuse=vec3(0.);reflectedLight.directSpecular=vec3(0.);
#else
reflectedLight.indirectSpecular=mix(reflectedLight.indirectSpecular,saturate(specularColor.rgb*ssrColor.rgb),ssrColor.a);
#endif
#endif

            
            // reflectedLight.directDiffuse = vec3(0.);
            // reflectedLight.indirectDiffuse = vec3(0.);
            // reflectedLight.directSpecular = vec3(0.);
            // reflectedLight.indirectSpecular = vec3(0.);
            
            
${_}`)},onObjectRender:(a,h,d)=>{var _,et,nt,it;let lt=this.enabled&&d.userData.screenSpaceRendering!==!1&&!(!((_=h.materialObject.userData)===null||_===void 0)&&_.ssreflDisabled)?1:0;h.materialObject.defines.SSR_ENABLED!==lt&&(h.materialObject.defines.SSR_ENABLED=lt,h.materialObject.needsUpdate=!0),lt=this.material.defines.SSR_STEP_COUNT,h.materialObject.defines.SSR_STEP_COUNT!==lt&&(h.materialObject.defines.SSR_STEP_COUNT=lt,h.materialObject.needsUpdate=!0),lt=this.material.defines.SSR_LOW_QUALITY_FRAMES,h.materialObject.defines.SSR_LOW_QUALITY_FRAMES!==lt&&(h.materialObject.defines.SSR_LOW_QUALITY_FRAMES=lt,h.materialObject.needsUpdate=!0),lt=this.material.defines.PERSPECTIVE_CAMERA,h.materialObject.defines.PERSPECTIVE_CAMERA!==lt&&(h.materialObject.defines.PERSPECTIVE_CAMERA=lt,h.materialObject.needsUpdate=!0),lt=this.material.defines.SSR_INLINE,h.materialObject.defines.SSR_INLINE!==lt&&(h.materialObject.defines.SSR_INLINE=lt,h.materialObject.needsUpdate=!0),lt=this.material.defines.SSR_MASK_FRONT_RAYS?1:0,h.materialObject.defines.SSR_MASK_FRONT_RAYS!==lt&&(h.materialObject.defines.SSR_MASK_FRONT_RAYS=lt,h.materialObject.needsUpdate=!0),lt=!((et=h.materialObject.userData)===null||et===void 0)&&et.ssreflNonPhysical?"1":"0",h.materialObject.defines.SSR_NON_PHYSICAL!==lt&&(h.materialObject.defines.SSR_NON_PHYSICAL=lt,h.materialObject.needsUpdate=!0),lt=(it=(nt=this._target)===null||nt===void 0?void 0:nt.texture)!==null&&it!==void 0?it:null,this.materialExtension.extraUniforms.tSSRMap.value!==lt&&(this.materialExtension.extraUniforms.tSSRMap.value=lt,h.materialObject.needsUpdate=!0)},parsFragmentSnippet:a=>{var h;return`
uniform float ssrPower;
uniform float ssrIntensity;
uniform float ssrMaskFrontFactor;
uniform vec3 ssrBoost;
uniform sampler2D tSSRMap;
uniform sampler2D tLastFrame;
`+$n("tSSRMap",(h=this._target)===null||h===void 0?void 0:h.texture,a.capabilities.isWebGL2)+$n("tLastFrame",this.materialExtension.extraUniforms.tLastFrame.value,a.capabilities.isWebGL2)+(this._inline?`
#if 1
// #if SSR_INLINE
    ${Q1}
    
    #define THREE_PACKING_INCLUDED
    ${$w}
    
    ${Jm}
    ${ZS}
    ${Fp}
    
    ${G1}
    
    ${HM}
// #endif // SSR_INLINE
#endif
`:"")+`

${H1}

        `},extraUniforms:{tSSRMap:{value:null},ssrPower:this.material.uniforms.power,ssrIntensity:this.material.uniforms.intensity,ssrMaskFrontFactor:this.material.uniforms.maskFrontFactor,ssrBoost:this.material.uniforms.boost,tNormalDepth:this.material.uniforms.tNormalDepth,tLastFrame:this.material.uniforms.tLastFrame,objectRadius:this.material.uniforms.objectRadius,autoRadius:this.material.uniforms.autoRadius,tolerance:this.material.uniforms.tolerance,frameCount:this.material.uniforms.frameCount,projection:this.material.uniforms.projection,cameraPositionWorld:this.material.uniforms.cameraPositionWorld,cameraNearFar:this.material.uniforms.cameraNearFar,sceneBoundingRadius:this.material.uniforms.sceneBoundingRadius},computeCacheKey:a=>{var h,d;return this.enabled?"1":"0"+((d=(h=this._target)===null||h===void 0?void 0:h.texture)===null||d===void 0?void 0:d.encoding)},isCompatible:a=>{var h;return!(!((h=a.materialObject.userData)===null||h===void 0)&&h.ssreflDisabled)&&a.isMeshStandardMaterial2}},this.intensity=1,this.boost=new b.Pa4(1,1,1),this.objectRadius=1,this.autoRadius=!0,this.power=1.1,this.tolerance=.5,this.stepCount=16,this.lowQualityFrames=0,this.maskFrontRays=!0,this.maskFrontFactor=-.2,this._renderer=c,this._target=e,this.needsSwap=!1,this._inline=s}render(c,e,i,s,a){if(this._inline)this.needsSwap=!1;else{if(!this._target)throw"Target must be set when inline = false";this._renderer.blit(this._target.texture,e,{}),this.uniforms.tLastThis.value=e.texture,super.render(c,this._target,i,s,a),this.needsSwap=!1}}};Zm([ss("Intensity",[0,4]),Fn(),rn()],Gp.prototype,"intensity",void 0),Zm([Up("Boost"),Fn(),rn()],Gp.prototype,"boost",void 0),Zm([ss("Object Radius",[.01,2]),Fn(),rn()],Gp.prototype,"objectRadius",void 0),Zm([ts("Auto radius"),Fn(),rn()],Gp.prototype,"autoRadius",void 0),Zm([ss("Power",[0,3]),Fn(),rn()],Gp.prototype,"power",void 0),Zm([ss("Tolerance",[.1,5]),Fn(),rn()],Gp.prototype,"tolerance",void 0),Zm([ss("Step count",[1,32],1),Fn(),jn("SSR_STEP_COUNT")],Gp.prototype,"stepCount",void 0),Zm([ss("Low Quality Frames",[0,4],1),Fn(),jn("SSR_LOW_QUALITY_FRAMES")],Gp.prototype,"lowQualityFrames",void 0),Zm([ts("Ignore front rays"),Fn(),jn("SSR_MASK_FRONT_RAYS")],Gp.prototype,"maskFrontRays",void 0),Zm([ss("Mask front rays factor",[-1,1],.01,c=>({hidden:()=>!c.maskFrontRays})),Fn(),rn()],Gp.prototype,"maskFrontFactor",void 0),Gp=Zm([Ys("Screen Space Reflections")],Gp);class W1 extends Zw{constructor(){super(),this.dependencies=[qr,ho,Bu],this.inlineSSR=!0,this.setDirty=this.setDirty.bind(this)}get ssrTarget(){return this._ssrTarget}get enabled(){var e,i;return((i=(e=this.passes.ssr)===null||e===void 0?void 0:e.passObject)===null||i===void 0?void 0:i.enabled)||!1}set enabled(e){var i;!((i=this.passes.ssr)===null||i===void 0)&&i.passObject&&(this.passes.ssr.passObject.enabled=e)}async onAdded(e){var i,s;e.getPluginByType("Ground")&&console.error("GroundPlugin must be added after SSRPlugin"),await super.onAdded(e),(s=(i=this.uiConfig).uiRefresh)===null||s===void 0||s.call(i,"postFrame",!0)}createPasses(e){var i,s;return this._ssrTarget=this.inlineSSR?void 0:e.renderer.createTarget({sizeMultiplier:1}),[CA(e,{passId:"ssr",after:["gbuffer"],before:["render"],required:["render","gbuffer","progressive"],passObject:new Gp(e.renderer,this._ssrTarget,(s=(i=e.getPlugin(ho))===null||i===void 0?void 0:i.getUnpackSnippet())!==null&&s!==void 0?s:"",this.inlineSSR)},()=>[e.getPlugin(ho),e.getPlugin(Bu),e.scene.activeCamera,e.renderer,e.scene])]}async onRemove(e){return this._ssrTarget&&e.renderer.disposeTarget(this._ssrTarget),super.onRemove(e)}setDirty(){var e;(e=this._viewer)===null||e===void 0||e.setDirty()}get uiConfig(){var e,i,s,a,h;const d=(s=(i=(e=this.passes.ssr)===null||e===void 0?void 0:e.passObject)===null||i===void 0?void 0:i.uiConfig)!==null&&s!==void 0?s:{};return(h=(a=d.children)===null||a===void 0?void 0:a.map(_=>Yt(_)))===null||h===void 0||h.flat(2).forEach(_=>_&&(_.onChange=this.setDirty)),d}}W1.PluginType="SSReflection";var WM=function(c,e,i,s){var a,h=arguments.length,d=h<3?e:s===null?s=Object.getOwnPropertyDescriptor(e,i):s;if(typeof Reflect=="object"&&typeof Reflect.decorate=="function")d=Reflect.decorate(c,e,i,s);else for(var _=c.length-1;_>=0;_--)(a=c[_])&&(d=(h<3?a(d):h>3?a(e,i,d):a(e,i))||d);return h>3&&d&&Object.defineProperty(e,i,d),d};class q1 extends Tl{constructor(e,i,s="rgba"){super({vertexShader:yt.vertexShader,fragmentShader:i+`uniform vec2 tDiffuseSize;uniform vec2 bilDirection;varying vec2 vUv;uniform bool smoothEnabled;uniform float edgeSharpness;vec4 bilaterialAO(){vec4 color=clamp((texture2D(tDiffuse,vUv.xy)).B_SRC_ACCESSOR,0.,5.);if(!smoothEnabled)return color;float depth;vec3 normal;getDepthNormal(vUv.xy,depth,normal);float gaussianWeights[4];gaussianWeights[0]=0.153170;gaussianWeights[1]=0.144893;gaussianWeights[2]=0.122649;gaussianWeights[3]=0.092902;float Z=gaussianWeights[0]+0.03;vec4 final_colour=Z*color;vec2 nuv;vec4 cc;float dp;vec3 nor;vec2 direction=bilDirection/tDiffuseSize.xy;
#pragma unroll_loop_start
for(int i=0;i<6;i++){direction*=-1.;nuv=vUv+2.*direction*float(UNROLLED_LOOP_INDEX/2+1);getDepthNormal(nuv,dp,nor);if(dp<0.999){float normalCloseness=dot(normal,nor);normalCloseness*=normalCloseness;float normalError=(1.-normalCloseness)*8.;float normalWeight=max((1.-normalError*edgeSharpness),0.00);float depthWeight=max(0.,1.-edgeSharpness*4000.*abs(depth-dp));float kernelWeight=gaussianWeights[UNROLLED_LOOP_INDEX/2]+0.03;float bilateralWeight=kernelWeight*depthWeight*normalWeight;Z+=bilateralWeight;cc=clamp((texture2D(tDiffuse,nuv)).B_SRC_ACCESSOR,0.,5.);final_colour+=bilateralWeight*cc;}}
#pragma unroll_loop_end
final_colour/=Z;return final_colour;}void main(){vec4 ao=clamp(bilaterialAO(),vec4(0.),vec4(1.));gl_FragColor=ao;}`,uniforms:{bilDirection:{value:new b.FM8(1,0)},tNormalDepth:{value:null},tDiffuse:{value:e.texture},tDiffuseSize:{value:new b.FM8}},defines:{B_SRC_ACCESSOR:s}},"tDiffuse"),this.smoothEnabled=!0,this.edgeSharpness=.1,this._target=e,this.clear=!1,this.needsSwap=!1}render(e,i,s,a,h){var d,_,et,nt;this.enabled&&(this.uniforms.bilDirection.value.set(1,0),this.uniforms.tDiffuse.value=this._target.texture,this.uniforms.tDiffuseSize.value.set(((d=this.uniforms.tDiffuse.value)===null||d===void 0?void 0:d.image.width)||0,((_=this.uniforms.tDiffuse.value)===null||_===void 0?void 0:_.image.height)||0),super.render(e,i,this._target,a,h),this.uniforms.bilDirection.value.set(0,1),this.uniforms.tDiffuse.value=i.texture,this.uniforms.tDiffuseSize.value.set(((et=this.uniforms.tDiffuse.value)===null||et===void 0?void 0:et.image.width)||0,((nt=this.uniforms.tDiffuse.value)===null||nt===void 0?void 0:nt.image.height)||0),super.render(e,this._target,i,a,h))}}WM([Fn(),rn()],q1.prototype,"smoothEnabled",void 0),WM([Fn(),rn()],q1.prototype,"edgeSharpness",void 0);var qM=function(c,e,i,s){var a,h=arguments.length,d=h<3?e:s===null?s=Object.getOwnPropertyDescriptor(e,i):s;if(typeof Reflect=="object"&&typeof Reflect.decorate=="function")d=Reflect.decorate(c,e,i,s);else for(var _=c.length-1;_>=0;_--)(a=c[_])&&(d=(h<3?a(d):h>3?a(e,i,d):a(e,i))||d);return h>3&&d&&Object.defineProperty(e,i,d),d};class $S extends Tl{constructor(e,i,s){super({defines:{LINEAR_DEPTH:1,NUM_SAMPLES:11,NUM_SPIRAL_TURNS:3,DEPTH_NORMAL_TEXTURE:1,DEPTH_PACKING_MODE:2,PERSPECTIVE_CAMERA:1},uniforms:{tLastThis:{value:null},tNormalDepth:{value:null},screenSize:{value:new b.FM8(512,512)},saoData:{value:new b.Ltg},frameCount:{value:0},cameraNearFar:{value:new b.FM8(.1,1e3)},projection:{value:new b.yGw},saoBiasEpsilon:{value:new b.Pa4(1,1,1)}},vertexShader:Km,fragmentShader:`

${Jm}

${s}

#include <common>
#include <packing>
varying vec2 vUv;uniform vec2 cameraNearFar;uniform mat4 projection;uniform sampler2D tLastThis;uniform vec4 saoData;uniform vec3 saoBiasEpsilon;uniform vec2 screenSize;const float INV_NUM_SAMPLES=1./float(NUM_SAMPLES);float getViewZFromNDCZ(const in float depth){
#if PERSPECTIVE_CAMERA == 1
return perspectiveDepthToViewZ(depth,cameraNearFar.x,cameraNearFar.y);
#else
return orthographicDepthToViewZ(depth,cameraNearFar.x,cameraNearFar.y);
#endif
}vec3 packFloatToRGB(const in float x){const vec3 code=vec3(1.,255.,65025.);vec3 pack=vec3(code*x);pack.gb=fract(pack.gb);pack.rg-=pack.gb*(1./256.);return pack;}vec3 getViewPositionFromViewZ(const in vec2 uv,const in float viewDepth){vec2 uv_=2.*uv-1.;float xe=-(uv_.x+projection[2][0])*viewDepth/projection[0][0];float ye=-(uv_.y+projection[2][1])*viewDepth/projection[1][1];return vec3(xe,ye,viewDepth);}float decodeDepth(const in vec2 uv){vec4 uncodedDepth;
#if DEPTH_PACKING_MODE == 2
uncodedDepth=texture2D(tNormalDepth,uv);
#else
uncodedDepth=texture2D(tDepth,uv);
#endif
#if DEPTH_PACKING_MODE == 0
return uncodedDepth.x;
#elif DEPTH_PACKING_MODE == 1
#if LINEAR_DEPTH == 1
return pow2(unpackRGBAToDepth(uncodedDepth));
#else
return unpackRGBAToDepth(uncodedDepth);
#endif
#else
return pow2(unpack16(uncodedDepth.xy));
#endif
}vec3 getPositionFromOffset(const in vec2 uv,const in vec2 offset,const in float screenSpaceRadius){vec2 uvOffset=uv+floor(screenSpaceRadius*offset)/screenSize;float d=decodeDepth(uvOffset);
#if LINEAR_DEPTH == 0
float centerViewZ=getViewZFromNDCZ(d);return getViewPositionFromViewZ(uvOffset,centerViewZ);
#else
d=mix(-cameraNearFar.x,-cameraNearFar.y,d);return getViewPositionFromViewZ(uvOffset,d);
#endif
}float getOcclusion(const in vec2 uv,const in int id,const in float randomAngle,const in float occlusionSphereRadius,const in vec3 centerPosition,const in vec3 centerNormal){float screenSpaceRadius=(float(id)+mod(randomAngle,1.)+0.5)*INV_NUM_SAMPLES;float angle=screenSpaceRadius*(float(NUM_SPIRAL_TURNS)*6.28)+randomAngle;screenSpaceRadius=(screenSpaceRadius*occlusionSphereRadius);vec2 offset=vec2(cos(angle),sin(angle));vec3 samplePosition=getPositionFromOffset(uv,offset,screenSpaceRadius);vec3 direction=samplePosition-centerPosition;float d2=dot(direction,direction);float ao=max((dot(centerNormal,direction)+centerPosition.z*saoBiasEpsilon.x)/(saoBiasEpsilon.z*d2+saoBiasEpsilon.y),0.);return ao;}void main(){float centerDepth;vec3 centerNormal;getDepthNormal(vUv,centerDepth,centerNormal);
#if LINEAR_DEPTH == 0
float centerViewZ=getViewZFromNDCZ(centerDepth);
#else
float centerViewZ=mix(-cameraNearFar.x,-cameraNearFar.y,centerDepth);
#endif
vec3 centerPosition=getViewPositionFromViewZ(vUv,centerViewZ);float occlusionSphereScreenRadius=200.*saoData.z/(-centerPosition.z);float randomAngle=6.2*random3(vec3(vUv,frameCount*0.1));float sum=0.;sum+=getOcclusion(vUv,0,randomAngle,occlusionSphereScreenRadius,centerPosition,centerNormal);
#if NUM_SAMPLES > 1
sum+=getOcclusion(vUv,1,randomAngle,occlusionSphereScreenRadius,centerPosition,centerNormal);
#endif
#if NUM_SAMPLES > 2
sum+=getOcclusion(vUv,2,randomAngle,occlusionSphereScreenRadius,centerPosition,centerNormal);
#endif
#if NUM_SAMPLES > 3
sum+=getOcclusion(vUv,3,randomAngle,occlusionSphereScreenRadius,centerPosition,centerNormal);
#endif
#if NUM_SAMPLES > 4
sum+=getOcclusion(vUv,4,randomAngle,occlusionSphereScreenRadius,centerPosition,centerNormal);
#endif
#if NUM_SAMPLES > 5
sum+=getOcclusion(vUv,5,randomAngle,occlusionSphereScreenRadius,centerPosition,centerNormal);
#endif
#if NUM_SAMPLES > 6
sum+=getOcclusion(vUv,6,randomAngle,occlusionSphereScreenRadius,centerPosition,centerNormal);
#endif
#if NUM_SAMPLES > 7
sum+=getOcclusion(vUv,7,randomAngle,occlusionSphereScreenRadius,centerPosition,centerNormal);
#endif
#if NUM_SAMPLES > 8
sum+=getOcclusion(vUv,8,randomAngle,occlusionSphereScreenRadius,centerPosition,centerNormal);
#endif
#if NUM_SAMPLES > 9
sum+=getOcclusion(vUv,9,randomAngle,occlusionSphereScreenRadius,centerPosition,centerNormal);
#endif
#if NUM_SAMPLES > 10
sum+=getOcclusion(vUv,10,randomAngle,occlusionSphereScreenRadius,centerPosition,centerNormal);
#endif
float aoValue=sum*saoData.y*INV_NUM_SAMPLES;aoValue=clamp(1.-max(aoValue,0.),0.,1.);gl_FragColor.gba=packFloatToRGB(centerDepth);gl_FragColor.r=(vec4(aoValue)).r;}

            `},"tDiffuse"),this.parameters={intensity:.25,occlusionWorldRadius:1,bias:.001,falloff:1,edgeSharpness:.3,blurEnabled:!0},this._smoothEnabled=!0,this.materialExtension={shaderExtender:(a,h,d)=>{a.defines.SSAO_ENABLED&&(a.fragmentShader=a.fragmentShader.replace("#include <aomap_fragment>",`#ifndef USE_TRANSMISSION
#if defined(SSAO_ENABLED) && SSAO_ENABLED > 0
float ambientOcclusion=tSSAOMapTexelToLinear(texture2D(tSSAOMap,viewToScreen(vViewPosition.xyz).xy)).r;reflectedLight.indirectDiffuse*=ambientOcclusion;
#if defined( USE_ENVMAP )
float dotNV=saturate(dot(geometry.normal,geometry.viewDir));reflectedLight.indirectSpecular*=computeSpecularOcclusion(dotNV,ambientOcclusion,material.roughness);
#endif
#endif
#endif
`))},onObjectRender:(a,h,d)=>{var _,et;this.materialExtension.extraUniforms.tSSAOMap.value=(_=this._target)===null||_===void 0?void 0:_.texture;const nt=h.materialObject,it=!nt.transparent&&nt.transmission<.001;let lt=this.enabled&&it&&d.userData.screenSpaceRendering!==!1&&!(!((et=h.materialObject.userData)===null||et===void 0)&&et.ssaoDisabled)?1:0;nt.defines.SSAO_ENABLED!==lt&&(nt.defines.SSAO_ENABLED=lt,nt.needsUpdate=!0),lt=this._target.texture,this.materialExtension.extraUniforms.tSSAOMap.value!==lt&&(this.materialExtension.extraUniforms.tSSAOMap.value=lt,nt.needsUpdate=!0)},parsFragmentSnippet:a=>{var h;return Qt`
             uniform sampler2D tSSAOMap;
             ${$n("tSSAOMap",(h=this._target)===null||h===void 0?void 0:h.texture,a.capabilities.isWebGL2)}
            ${H1}
        `},extraUniforms:{tSSAOMap:{value:null}},computeCacheKey:a=>{var h,d;return this.enabled?"1":"0"+((d=(h=this._target)===null||h===void 0?void 0:h.texture)===null||d===void 0?void 0:d.encoding)},isCompatible:a=>{var h;return!(!((h=a.materialObject.userData)===null||h===void 0)&&h.ssaoDisabled)&&a.isMeshStandardMaterial2}},this._renderer=e,this._target=i,this.needsSwap=!1,this.clear=!0,this.bilateralPass=new q1(this._target,s,"rrrr")}get smoothEnabled(){return this._smoothEnabled}set smoothEnabled(e){this._smoothEnabled=e,this.bilateralPass.enabled=e,this.bilateralPass.uniforms.smoothEnabled.value=e}render(e,i,s,a,h){this.enabled&&(this._updateParameters(),this._renderer.blit(this._target.texture,i,{}),this.uniforms.tLastThis.value=i.texture,super.render(e,this._target,s,a,h),this._smoothEnabled&&this.bilateralPass.render(e,i,s,a,h))}_updateParameters(){const e=this.material.uniforms.saoData.value;e.y=this.parameters.intensity,e.z=this.parameters.occlusionWorldRadius;const i=this.material.uniforms.saoBiasEpsilon.value;i.x=this.parameters.bias,i.y=.001,i.z=this.parameters.falloff}}qM([Fn()],$S.prototype,"bilateralPass",void 0),qM([Fn()],$S.prototype,"parameters",void 0);class Y1 extends Zw{constructor(){super(),this.dependencies=[qr,ho],this.setDirty=this.setDirty.bind(this)}get aoTarget(){return this._aoTarget}async onAdded(e){return e.getPluginByType("Ground")&&console.error("GroundPlugin must be added after SSAOPlugin"),super.onAdded(e)}createPasses(e){var i,s;return this._aoTarget=e.renderer.createTarget({sizeMultiplier:1}),[CA(e,{passId:"ssao",after:["gbuffer"],before:["render"],required:["render","gbuffer"],passObject:new $S(e.renderer,this._aoTarget,(s=(i=e.getPlugin(ho))===null||i===void 0?void 0:i.getUnpackSnippet())!==null&&s!==void 0?s:""),update(){this.passObject.bilateralPass.updateShaderProperties([e.getPlugin(ho)])}},()=>[e.getPlugin(ho),e.scene.activeCamera,e.renderer])]}async onRemove(e){return e.renderer.disposeTarget(this._aoTarget),super.onRemove(e)}setDirty(){var e;(e=this._viewer)===null||e===void 0||e.setDirty()}get enabled(){var e,i;return((i=(e=this.passes.ssao)===null||e===void 0?void 0:e.passObject)===null||i===void 0?void 0:i.enabled)||!1}set enabled(e){var i;!((i=this.passes.ssao)===null||i===void 0)&&i.passObject&&(this.passes.ssao.passObject.enabled=e)}get uiConfig(){var e;if(this._uiConfig)return this._uiConfig;const i=this,s=i.passes.ssao.passObject;return this._uiConfig={type:"folder",label:"SS Ambient Occlusion",children:[{type:"checkbox",label:"Enabled",property:[s,"enabled"],onChange:i.setDirty},{type:"slider",label:"Intensity",bounds:[0,4],property:[s.parameters,"intensity"],onChange:i.setDirty},{type:"slider",label:"Radius",bounds:[.1,8],property:[s.parameters,"occlusionWorldRadius"],onChange:i.setDirty},{type:"slider",label:"Bias",bounds:[1e-5,.01],property:[s.parameters,"bias"],onChange:i.setDirty},{type:"slider",label:"Falloff",bounds:[.01,3],property:[s.parameters,"falloff"],onChange:i.setDirty},{type:"slider",label:"Num samples",stepSize:1,bounds:[1,11],property:[(e=s.material)===null||e===void 0?void 0:e.defines,"NUM_SAMPLES"],onChange:[()=>s.material.needsUpdate=!0,i.setDirty]},{type:"checkbox",property:[s.bilateralPass,"smoothEnabled"],onChange:i.setDirty},{type:"vec4",property:[s.bilateralPass,"edgeSharpness"],onChange:i.setDirty}]}}}Y1.PluginType="SSAO";class YM{constructor(e){this._normalsCache={},this._renderer=e,this._scene=new b.xsS,this._mesh=new b.Kj0,this._mesh.frustumCulled=!1,this._scene.add(this._mesh),this._mesh.position.set(0,0,0),this._mesh.material=new XM}dispose(){this._mesh.material.dispose()}captureNormalMap(e,i,s=512){if(!e)throw"No geometry";if(e.userData._normalsCaptureMap)return!1;const a=i==null?void 0:i.split(";").find(et=>this._normalsCache[et]);if(a){const et=this._normalsCache[a];return i==null||i.split(";").forEach(nt=>nt!==a&&(this._normalsCache[nt]=et)),et.width!==s&&console.warn("last cacheKey normalMapRes mismatch, check model",s),e.userData._normalsCaptureMap=et,!1}const h=this._renderer.createTargetCustom({width:s,height:s},{minFilter:b.TyD,magFilter:b.TyD,generateMipmaps:!1,type:b.cLu},b.oAp);if(!h)throw"Unable to create render target";i==null||i.split(";").forEach(et=>this._normalsCache[et]=h),h.addEventListener("dispose",()=>delete this._normalsCache[i]);const d=new b._am(1e-4,100,h);this._scene.add(d);const _=e.userData._normalsCaptureOffsets;return _.center!==void 0&&this._mesh.material.uniforms.offsetCenter.value.copy(_.center),_.offsetMatrixInv!==void 0&&this._mesh.material.uniforms.offsetMatrixInv.value.copy(_.offsetMatrixInv),_.radius!==void 0&&(this._mesh.material.uniforms.radius.value=_.radius),this._mesh.geometry=e,d.update(this._renderer.rendererObject,this._scene),this._scene.remove(d),this._mesh.geometry=void 0,e.userData._normalsCaptureMap=h,!0}}class XM extends b.jyz{constructor(){super({vertexShader:"varying vec3 vNormal;varying vec3 vecPosition;uniform mat4 offsetMatrixInv;uniform vec3 offsetCenter;void main(){vNormal=normalize((offsetMatrixInv*vec4(normal,0.)).xyz);vecPosition=(modelMatrix*offsetMatrixInv*vec4(position-offsetCenter,1.)).xyz;gl_Position=projectionMatrix*modelViewMatrix*offsetMatrixInv*vec4(position-offsetCenter,1.);}",fragmentShader:"varying vec3 vNormal;varying vec3 vecPosition;uniform float radius;void main(){vec3 color=normalize(vNormal);color=color*0.5+0.5;gl_FragColor=vec4(color.x,color.y,color.z,length(vecPosition)/radius);}",side:b.ehD,clipping:!1,uniforms:{radius:{value:1},offsetMatrixInv:{value:new b.yGw().identity()},offsetCenter:{value:new b.Pa4}}})}}var cD=__webpackgi_require__(654);function KM(c){const e=new b.Pa4(0,0,0),i=new b.Pa4(0,0,0),s=new b.Pa4(0,0,0),a=new b.Pa4(0,0,0),h=c.getAttribute("position"),d=c.index;if(d)for(let ut=Math.max(0,c.drawRange.start),pt=Math.min(d.count,c.drawRange.start+c.drawRange.count)-1;ut<pt/3;ut+=3){const gt=d.getX(ut),vt=d.getX(ut+1),Ct=d.getX(ut+2);i.set(h.getX(gt),h.getY(gt),h.getZ(gt)),s.set(h.getX(vt),h.getY(vt),h.getZ(vt)),a.set(h.getX(Ct),h.getY(Ct),h.getZ(Ct)),s.sub(i),a.sub(i),a.cross(s),a.normalize(),e.add(a)}else for(let ut=0;ut<h.count;ut+=3)i.set(h.getX(ut),h.getY(ut),h.getZ(ut)),s.set(h.getX(ut+1),h.getY(ut+1),h.getZ(ut+1)),a.set(h.getX(ut+2),h.getY(ut+2),h.getZ(ut+2)),s.sub(i),a.sub(i),a.cross(s),a.normalize(),e.add(a);e.normalize();let _=!1,et=0;for(;!_;){const ut=et/3,pt=d?d.getX(ut):ut,gt=d?d.getX(ut+1):ut+1;i.set(h.getX(pt),h.getY(pt),h.getZ(pt)),s.set(h.getX(gt),h.getY(gt),h.getZ(gt)),i.sub(s),i.normalize();const vt=e.dot(i);Math.abs(vt-1)>.001&&i.length()>.5&&(_=!0),et+=3}s.crossVectors(i,e),s.normalize(),i.crossVectors(e,s),i.normalize();const nt=new b.yGw;nt.elements[0]=i.x,nt.elements[1]=i.y,nt.elements[2]=i.z,nt.elements[3]=0,nt.elements[4]=e.x,nt.elements[5]=e.y,nt.elements[6]=e.z,nt.elements[7]=0,nt.elements[8]=s.x,nt.elements[9]=s.y,nt.elements[10]=s.z,nt.elements[11]=0,nt.elements[12]=0,nt.elements[13]=0,nt.elements[14]=0,nt.elements[15]=1,c.computeBoundingSphere();const it=c.boundingSphere.radius,lt=new b.yGw().makeScale(it,it,it);return nt.multiply(lt),nt}function JM(c){const e=c.getAttribute("position");if(e.count>0)return KM(c);const i=new b.Pa4(0,0,0),s=new b.Pa4(0,0,0),a=new b.Pa4(0,0,0),h=c.index,d=[];if(h)for(let lt=Math.max(0,c.drawRange.start),ut=Math.min(h.count,c.drawRange.start+c.drawRange.count)-1;lt<ut/3;lt+=3){const pt=h.getX(lt),gt=h.getX(lt+1),vt=h.getX(lt+2);i.set(e.getX(pt),e.getY(pt),e.getZ(pt)),s.set(e.getX(gt),e.getY(gt),e.getZ(gt)),a.set(e.getX(vt),e.getY(vt),e.getZ(vt)),d.push(i.toArray(),s.toArray(),a.toArray())}else for(let lt=0;lt<e.count;lt++)i.set(e.getX(lt),e.getY(lt),e.getZ(lt)),d.push(i.toArray());const _=(0,cD.getEigenVectors)(d),et=new b.yGw;et.elements[0]=_[0].vector[0],et.elements[1]=_[0].vector[1],et.elements[2]=_[0].vector[2],et.elements[3]=0,et.elements[4]=_[1].vector[0],et.elements[5]=_[1].vector[1],et.elements[6]=_[1].vector[2],et.elements[7]=0,et.elements[8]=_[2].vector[0],et.elements[9]=_[2].vector[1],et.elements[10]=_[2].vector[2],et.elements[11]=0,et.elements[12]=0,et.elements[13]=0,et.elements[14]=0,et.elements[15]=1,console.log(et.determinant()),c.computeBoundingSphere();const nt=c.boundingSphere.radius,it=new b.yGw().makeScale(nt,nt,nt);return et.multiply(it),et}const ZM={...Fw,color:new mo(1,1,1),envMapIntensity:1,envMapRotation:0,dispersion:.012,squashFactor:.98,geometryFactor:.5,gammaFactor:1,absorptionFactor:1,reflectivity:.5,refractiveIndex:2.4,boostFactors:new b.Pa4(.892,.892,.98595025),envMap:null,wireframe:!1,wireframeLinewidth:0,skinning:!1,transmission:0,morphTargets:!1,morphNormals:!1,rayBounces:1,diamondOrientedEnvMap:0};var Pp=function(c,e,i,s){var a,h=arguments.length,d=h<3?e:s===null?s=Object.getOwnPropertyDescriptor(e,i):s;if(typeof Reflect=="object"&&typeof Reflect.decorate=="function")d=Reflect.decorate(c,e,i,s);else for(var _=c.length-1;_>=0;_--)(a=c[_])&&(d=(h<3?a(d):h>3?a(e,i,d):a(e,i))||d);return h>3&&d&&Object.defineProperty(e,i,d),d};class Fo extends b.jyz{constructor(e){super({side:b.ehD,defines:{DIA_ORIENT_ENVMAP:0,RAY_BOUNCES:5,ENV_MAP_TYPE:0,PI:3.1428},vertexShader:`#ifndef USE_ENVMAP
#define USE_ENVMAP  
#endif
varying vec3 vWorldPosition;varying vec3 vWorldNormal;void main(){vWorldNormal=(modelMatrix*vec4(normal,0.)).xyz;
#include <begin_vertex>
#include <project_vertex>
#include <worldpos_vertex>
vWorldPosition=worldPosition.xyz;}`,fragmentShader:`varying vec3 vWorldNormal;varying vec3 vWorldPosition;uniform samplerCube tCubeMapNormals;
#if ENV_MAP_TYPE == 0
uniform samplerCube envMap;
#elif ENV_MAP_TYPE == 1
uniform sampler2D envMap;
#endif
uniform float envMapIntensity;uniform mat4 modelMatrix;uniform mat4 inverseModelMatrix;uniform mat4 offsetMatrixInv;uniform mat4 offsetMatrix;uniform float transmission;uniform vec2 transmissionSamplerSize;uniform sampler2D transmissionSamplerMap;uniform float refractiveIndex;uniform float radius;uniform float rIndexDelta;uniform float squashFactor;uniform float geometryFactor;uniform vec3 color;uniform vec3 colorCorrection;uniform vec3 boostFactors;uniform vec3 centerOffset;uniform float gammaFactor;uniform float absorptionFactor;uniform float envMapRotation;uniform float reflectivity;vec3 BRDF_Specular_GGX_Environment(const in vec3 viewDir,const in vec3 normal,const in vec3 specularColor,const in float roughness){float dotNV=abs(dot(normal,viewDir));const vec4 c0=vec4(-1,-0.0275,-0.572,0.022);const vec4 c1=vec4(1,0.0425,1.04,-0.04);vec4 r=roughness*c0+c1;float a004=min(r.x*r.x,exp2(-9.28*dotNV))*r.x+r.y;vec2 AB=vec2(-1.04,1.04)*a004+r.zw;return specularColor*AB.x+AB.y;}vec2 cartesianToPolar(vec3 n){vec2 uv;uv.x=atan(n.z,n.x)/(PI*2.)+0.5;uv.y=asin(n.y)/PI+0.5;return uv;}vec4 sampleEnvMap(vec3 direction){
#if !defined(USE_ENVMAP)
return vec4(direction,1);
#else
float cs=cos(envMapRotation);float sn=sin(envMapRotation);float temp=cs*direction.x+sn*direction.z;direction.z=-sn*direction.x+cs*direction.z;direction.x=temp;direction.x*=-1.;direction.z*=-1.;
#if ENV_MAP_TYPE == 0
return(textureCube(envMap,direction));
#elif ENV_MAP_TYPE == 1
return(texture2D(envMap,cartesianToPolar(direction)));
#endif
return vec4(1,0,1,1);
#endif
}vec4 SampleSpecularReflection(vec3 direction){return envMapIntensity*(sampleEnvMap(direction));}uniform mat4 projectionMatrix;vec4 SampleSpecularContribution(vec3 direction){direction=normalize(direction);direction.x*=-1.;direction.z*=-1.;return envMapIntensity*(sampleEnvMap(direction));}vec4 SampleSpecularContributionRef(vec3 origin,int i){vec4 ndcPos=projectionMatrix*viewMatrix*vec4(origin,1.);vec2 refractionCoords=ndcPos.xy/ndcPos.w;refractionCoords+=1.;refractionCoords/=2.;return transmissionSamplerMapTexelToLinear(texture2D(transmissionSamplerMap,refractionCoords));}vec3 intersectSphere(vec3 origin,vec3 direction){origin-=centerOffset;direction.y/=squashFactor;float A=dot(direction,direction);float B=2.*dot(origin,direction);float C=dot(origin,origin)-radius*radius;float disc=B*B-4.*A*C;if(disc>0.){disc=sqrt(disc);float t1=(-B+disc)*geometryFactor/A;float t2=(-B-disc)*geometryFactor/A;float t=(t1>t2)?t1:t2;direction.y*=squashFactor;return vec3(origin+centerOffset+direction*t);}return vec3(0.);}vec3 linePlaneIntersect(in vec3 pointOnLine,in vec3 lineDirection,in vec3 pointOnPlane,in vec3 planeNormal){return lineDirection*(dot(planeNormal,pointOnPlane-pointOnLine)/dot(planeNormal,lineDirection))+pointOnLine;}vec4 getNormalDistance(vec3 d){return textureCube(tCubeMapNormals,d);}vec3 getSurfaceNormal(vec4 surfaceInfos){vec3 surfaceNormal=surfaceInfos.rgb;surfaceNormal=surfaceNormal*2.-1.;return-normalize(surfaceNormal);}vec3 intersect(vec3 rayOrigin,vec3 rayDirection){vec3 sphereHitPoint=intersectSphere(rayOrigin,rayDirection);vec3 direction1=normalize(sphereHitPoint-centerOffset);vec4 normalDistanceData1=getNormalDistance(direction1);float distance1=normalDistanceData1.a*radius;vec3 pointOnPlane1=centerOffset+direction1*distance1;vec3 planeNormal1=getSurfaceNormal(normalDistanceData1);vec3 hitPoint1=linePlaneIntersect(rayOrigin,rayDirection,pointOnPlane1,planeNormal1);vec3 direction2=normalize(hitPoint1-centerOffset);vec4 normalDistanceData2=getNormalDistance(direction2);float distance2=normalDistanceData2.a*radius;vec3 pointOnPlane2=centerOffset+direction2*distance2;vec3 hitPoint=hitPoint1;vec3 planeNormal2=getSurfaceNormal(normalDistanceData2);hitPoint=linePlaneIntersect(rayOrigin,rayDirection,pointOnPlane2,planeNormal2);return hitPoint;}vec3 debugBounces(int count){vec3 color=vec3(1.,1.,1.);if(count==1)color=vec3(0.,1.,0.);else if(count==2)color=vec3(0.,0.,1.);else if(count==3)color=vec3(1.,1.,0.);else if(count==4)color=vec3(0.,1.,1.);else color=vec3(0.,1.,0.);if(count==0)color=vec3(1.,0.,0.);return color;}vec3 traceRay(vec3 origin,vec3 direction,vec3 normal){vec3 outColor=vec3(0.);const float n1=1.;const float epsilon=1e-4;float f0=(2.4-n1)/(2.4+n1);f0*=f0;vec3 attenuationFactor=vec3(1.);vec3 newDirection=refract(direction,normal,n1/refractiveIndex);vec3 reflectedDirection=reflect(direction,normal);vec3 brdfReflected=BRDF_Specular_GGX_Environment(reflectedDirection,normal,vec3(f0),0.);vec3 brdfRefracted=BRDF_Specular_GGX_Environment(newDirection,-normal,vec3(f0),0.);attenuationFactor*=(vec3(1.)-brdfRefracted);outColor+=SampleSpecularReflection(reflectedDirection).rgb*brdfReflected*reflectivity*2.;int count=0;newDirection=(offsetMatrixInv*inverseModelMatrix*vec4(newDirection,0.)).xyz;newDirection=normalize(newDirection);origin=(offsetMatrixInv*inverseModelMatrix*vec4(origin,1.)).xyz;vec3 origin2=origin;origin2=(modelMatrix*offsetMatrix*vec4(origin2,1.)).xyz;for(int i=0;i<RAY_BOUNCES;i++){vec3 intersectedPos=intersect(origin,newDirection);vec3 dist=intersectedPos-origin;vec3 d=normalize(intersectedPos-centerOffset);vec3 mappedNormal=getNormalDistance(d).rgb;mappedNormal=2.*mappedNormal-1.;mappedNormal=-normalize(mappedNormal);float r=length(dist)/radius*absorptionFactor;attenuationFactor*=exp(-r*(1.-color));origin=intersectedPos;origin2=(modelMatrix*offsetMatrix*vec4(intersectedPos,1.)).xyz;vec3 oldDir=newDirection;newDirection=refract(newDirection,mappedNormal,refractiveIndex/n1);if(dot(newDirection,newDirection)<epsilon){newDirection=reflect(oldDir,mappedNormal);if(i==RAY_BOUNCES-1){vec3 brdfReflected=BRDF_Specular_GGX_Environment(-oldDir,mappedNormal,vec3(f0),0.);vec3 d1=(modelMatrix*offsetMatrix*vec4(oldDir,0.)).xyz;d1=normalize(d1);float cosT=1.-dot(direction,d1);outColor+=((transmission>0.&&cosT<transmission)?SampleSpecularContributionRef(origin2+0.5*d1*cosT,i).rgb:SampleSpecularContribution(DIA_ORIENT_ENVMAP<1?d1:newDirection).rgb)*attenuationFactor*colorCorrection*boostFactors*(vec3(1.)-brdfReflected);}}else{vec3 brdfRefracted=vec3(1.)-BRDF_Specular_GGX_Environment(newDirection,-mappedNormal,vec3(f0),0.);vec3 d1=(modelMatrix*offsetMatrix*vec4(newDirection,0.)).xyz;d1=normalize(d1);float cosT=1.-dot(direction,d1);if(transmission>0.&&cosT<transmission){outColor+=SampleSpecularContributionRef(origin2+0.5*d1*cosT,i).rgb*brdfRefracted*attenuationFactor*colorCorrection*boostFactors;}else{vec3 dir0=newDirection;vec3 dir1=refract(oldDir,mappedNormal,(refractiveIndex+rIndexDelta)/n1);vec3 dir2=refract(oldDir,mappedNormal,(refractiveIndex-rIndexDelta)/n1);
#if DIA_ORIENT_ENVMAP < 1
dir0=d1;dir1=(modelMatrix*offsetMatrix*vec4(dir1,0.)).xyz;dir2=(modelMatrix*offsetMatrix*vec4(dir2,0.)).xyz;
#endif
outColor+=vec3(SampleSpecularContribution(dir1).r,SampleSpecularContribution(dir0).g,SampleSpecularContribution(dir2).b)*brdfRefracted*attenuationFactor*colorCorrection*boostFactors;}newDirection=reflect(oldDir,mappedNormal);vec3 brdfReflected=BRDF_Specular_GGX_Environment(newDirection,mappedNormal,vec3(f0),0.);attenuationFactor*=brdfReflected*boostFactors;count++;}}return outColor;}void main(){vec3 normalizedNormal=normalize(vWorldNormal);vec3 viewVector=normalize(vWorldPosition-cameraPosition);vec3 color=traceRay(vWorldPosition,viewVector,normalizedNormal);gl_FragColor=vec4(color.rgb,1.);
#include <encodings_fragment>
}`,uniforms:{envMap:{value:e.envMap||null},envMapRotation:{value:0},transmission:{value:0},transmissionSamplerMap:{value:null},transmissionSamplerSize:{value:new b.FM8},normalOffset:{value:0},distanceOffset:{value:0},colorCorrection:{value:new b.Pa4(1,1,1)}}}),this.typeSlug=Fo.TypeSlug,this.assetType="material",this.__envMap=null,this.isDiamondMaterial=!0,this.color=new mo(1,1,1),this.envMapIntensity=1,this.dispersion=.012,this.absorptionFactor=1,this.refractiveIndex=2.4,this.squashFactor=.98,this.geometryFactor=.5,this.gammaFactor=1,this.boostFactors=new b.Pa4(.892,.892,.98595025),this.transmission=0,this.reflectivity=.5,this.rayBounces=5,this.diamondOrientedEnvMap=0,this.normalsCaptureMap=null,this.extraUniformsToUpload={inverseModelMatrix:{value:new b.yGw().identity()},radius:{value:1},centerOffset:{value:new b.Pa4(0,0,0)},offsetMatrix:{value:new b.yGw().identity()},offsetMatrixInv:{value:new b.yGw().identity()}},this.setDirty=this.setDirty.bind(this),this.userData.setDirty=i=>{console.warn("userData.setDirty is deprecated. Use setDirty instead."),this.setDirty(i)},this.userData.separateEnvMapIntensity=!0,this.setValues(e)}get mmMaterial(){return this}get materialObject(){return this}onBeforeRender(e,i,s,a,h){var d,_;super.onBeforeRender(e,i,s,a,h),this.uniforms.envMapRotation.value=((d=this.envMap)===null||d===void 0?void 0:d.rotation)||0,this.extraUniformsToUpload.inverseModelMatrix.value.copy(h.matrixWorld).invert();const et=a.userData._normalsCaptureOffsets;et&&(this.extraUniformsToUpload.centerOffset.value.copy(et.centerOffset),this.extraUniformsToUpload.offsetMatrix.value.copy(et.offsetMatrix),this.extraUniformsToUpload.offsetMatrixInv.value.copy(et.offsetMatrixInv),this.extraUniformsToUpload.radius.value=et.radius);const nt=(_=a.userData._normalsCaptureMap)===null||_===void 0?void 0:_.texture;this.normalsCaptureMap!==nt&&(this.normalsCaptureMap=nt)}setDirty(e){var i,s;this.needsUpdate=!0,this.dispatchEvent({...e,type:"materialUpdate"}),(s=(i=this._uiConfig)===null||i===void 0?void 0:i.uiRefresh)===null||s===void 0||s.call(i,"postFrame",!0,1)}set envMap(e){var i;this.__envMap=e,this.uniforms.envMap.value=this.__envMap,!((i=this.__envMap)===null||i===void 0)&&i.isCubeTexture?(this.defines.ENV_MAP_TYPE=0,this.needsUpdate=!0):(this.defines.ENV_MAP_TYPE=1,this.needsUpdate=!0)}get envMap(){return this.__envMap}clone(){return super.clone()}toJSON(e){const i={};return i.name=this.name,i.uuid=this.uuid,i.color=this.color.getHex(),i.envMapIntensity=this.envMapIntensity,i.dispersion=this.dispersion,i.squashFactor=this.squashFactor,i.geometryFactor=this.geometryFactor,i.gammaFactor=this.gammaFactor,i.absorptionFactor=this.absorptionFactor,i.reflectivity=this.reflectivity,i.refractiveIndex=this.refractiveIndex,i.rayBounces=this.rayBounces,i.diamondOrientedEnvMap=this.diamondOrientedEnvMap,i.boostFactors={x:this.boostFactors.x,y:this.boostFactors.y,z:this.boostFactors.z,isVector3:!0},i.transmission=this.transmission,i.isDiamondMaterialParameters=!0,i.type=Fo.TYPE,i.userData={},Gu(i.userData,this.userData),i.userData.uuid=this.userData.uuid,i}get uiConfig(){const e=this;return this._uiConfigChildren||(this._uiConfigChildren=[{type:"input",property:[this,"name"]},{type:"checkbox",property:[this,"wireframe"]},...bv(this),{type:"input",label:"Mesh count",get value(){var i,s,a;return(a=(s=(i=e.userData)===null||i===void 0?void 0:i.__appliedMeshes)===null||s===void 0?void 0:s.size)!==null&&a!==void 0?a:0},set value(i){},disabled:!0},{type:"input",label:"uuid",get value(){return e.uuid},set value(i){},disabled:!0},{type:"checkbox",label:"Render to Depth",hidden:()=>this.transmission===0,get value(){return e.userData.renderToDepth===!0},set value(i){e.userData.renderToDepth=i||void 0}},{type:"button",label:"Download .dmat",value:()=>{Do(new Blob([JSON.stringify(e.toJSON(),null,2)],{type:"application/json"}),"diamond-material.dmat")}}]),this._uiConfig||(this._uiConfig={type:"folder",label:"Diamond Material",expanded:!0,children:this._uiConfigChildren,limitedUi:!0}),this._uiConfig}copyProps(e){if(!e.isDiamondMaterialParameters&&!e.isDiamondMaterial&&!e.isDiamond&&e.type!==Fo.TYPE)return console.warn("Material type is not supported",e),this;const i={};Bn(e,i,Array.from(Object.keys(ZM)));const s=i.userData;return delete i.userData,this.setValues(i),Gu(this.userData,s),this.setDirty(),this}fromJSON(e,i){return this.copyProps(e)}}Fo.TypeSlug="dmat",Fo.TYPE="DiamondMaterial",Pp([cm("Color",{limitedUi:!0}),rn()],Fo.prototype,"color",void 0),Pp([ss("Env Intensity",[0,5],.01,{limitedUi:!0}),rn()],Fo.prototype,"envMapIntensity",void 0),Pp([ss("Dispersion",[0,.1],1e-4,{limitedUi:!0}),rn({propKey:"rIndexDelta"})],Fo.prototype,"dispersion",void 0),Pp([ss("Absorption",[0,15],.01,{limitedUi:!0}),rn()],Fo.prototype,"absorptionFactor",void 0),Pp([ss("Refractive Index",[0,4],.01,{limitedUi:!0}),rn()],Fo.prototype,"refractiveIndex",void 0),Pp([rn()],Fo.prototype,"squashFactor",void 0),Pp([rn()],Fo.prototype,"geometryFactor",void 0),Pp([rn()],Fo.prototype,"gammaFactor",void 0),Pp([Up("RGB Boost",void 0,void 0,{limitedUi:!0}),rn()],Fo.prototype,"boostFactors",void 0),Pp([ss("Transmission",[0,1],.01,{limitedUi:!0}),rn()],Fo.prototype,"transmission",void 0),Pp([ss("Reflectivity",[0,2],.01,{limitedUi:!0}),rn()],Fo.prototype,"reflectivity",void 0),Pp([jn("RAY_BOUNCES",void 0,!0),ss("Ray Bounces",[1,16],1)],Fo.prototype,"rayBounces",void 0),Pp([jn("DIA_ORIENT_ENVMAP",void 0,!0),ss("Diamond Oriented Lighting",[0,1],1)],Fo.prototype,"diamondOrientedEnvMap",void 0),Pp([rn({propKey:"tCubeMapNormals"})],Fo.prototype,"normalsCaptureMap",void 0);class $M extends ot{constructor(e,i,s,a){super(),this._scene=e,this._camera=s??this._scene.activeCamera,this.domElement=i,this._time=this.time,this._mouseDownTime=0,this._mouseUpTime=1,this.selectionCondition=a??(h=>h.userData.userSelectable!==!1&&h.userData.bboxVisible!==!1&&h.material!=null&&h.material.type!=="ShadowMaterial"),this.raycaster=new b.iMs,this.mouse=new b.FM8,this._selected=[],this._hovering=[],this.cursorStyles={default:"grab",down:"grabbing"},this._activeCameraChange=this._activeCameraChange.bind(this),this._scene.addEventListener("activeCameraChange",this._activeCameraChange),this.domElement.style.touchAction="none",this.domElement.style.cursor=this.cursorStyles.default,this.domElement.addEventListener("pointermove",h=>this.onPointerMove(h)),this.domElement.addEventListener("pointerleave",h=>this.onPointerLeave(h)),this.domElement.addEventListener("pointerout",h=>this.onPointerLeave(h)),this.domElement.addEventListener("pointercancel",h=>this.onPointerCancel(h)),this.domElement.addEventListener("pointerenter",h=>this.onPointerEnter(h)),this.domElement.addEventListener("pointerdown",h=>this.onPointerDown(h)),this.domElement.addEventListener("pointerup",h=>this.onPointerUp(h))}get scene(){return this._scene}set scene(e){var i;(i=this._scene)===null||i===void 0||i.removeEventListener("activeCameraChange",this._activeCameraChange),this._scene=e,this._scene.addEventListener("activeCameraChange",this._activeCameraChange)}_activeCameraChange(){this.camera=this._scene.activeCamera}get camera(){return this._camera}set camera(e){this._camera=e}get selectedObject(){return this._selected.length>0?this._selected[0]:null}set selectedObject(e){this._selected.length===1&&this._selected[0]===e||(this._selected=e?Array.isArray(e)?[...e]:[e]:[],this.refreshOutlinePass(),this.dispatchEvent({type:"selectedObjectChanged",object:this.selectedObject}))}get hoverObject(){return this._hovering.length>0?this._hovering[0]:null}set hoverObject(e){this._hovering=e?Array.isArray(e)?[...e]:[e]:[],this.refreshOutlinePass(),this.dispatchEvent({type:"hoverObjectChanged",object:this.hoverObject})}get time(){return this._time=Yu(),this._time}get isMouseDown(){return this.mouseDownDeltaTime<0}get mouseDownDeltaTime(){return this._mouseUpTime-this._mouseDownTime}onPointerMove(e){e.isPrimary!==!1&&this.updateMouseFromEvent(e)}onPointerLeave(e){e.isPrimary!==!1&&(this.domElement.style.cursor=this.cursorStyles.default,this.hoverObject=null)}onPointerEnter(e){}onPointerCancel(e){}updateMouseFromEvent(e){const i=this.domElement.getBoundingClientRect();this.mouse.x=(e.clientX-i.x)/i.width*2-1,this.mouse.y=-(e.clientY-i.y)/i.height*2+1}onPointerDown(e){e.isPrimary!==!1&&(this.domElement.style.cursor=this.cursorStyles.down,this._mouseDownTime=this.time)}onPointerUp(e){e.isPrimary!==!1&&(this.domElement.style.cursor=this.cursorStyles.default,this._mouseUpTime=this.time,this.mouseDownDeltaTime<200&&this.onPointerClick(e))}onPointerClick(e){if(e.isPrimary===!1)return;this.updateMouseFromEvent(e);const i=this.checkIntersection();i&&this.dispatchEvent({type:"hitObject",time:this._mouseUpTime,intersects:i}),this.selectedObject=(i==null?void 0:i.selectedObject)||null}addPasses(){}checkIntersection(){var e;const i=(e=this._camera)===null||e===void 0?void 0:e.cameraObject;if(!i)return null;this.raycaster.setFromCamera(this.mouse,i);const s=this.raycaster.intersectObject(this._scene.modelRoot.modelObject,!0);let a,h=null;if(s.length>0){if(h=s[0].object,a=s[0],this._firstHit&&h.id!==this._firstHit.id)h=a.object;else for(let d=0;d<s.length;d++)if(this.selectedObject&&this.selectedObject.id===s[d].object.id){const _=d+1;if(!(_<s.length))return null;a=s[_],h=a.object}this._firstHit=s[0].object}if(h&&a){for(;!(h==null||h.visible&&this.selectionCondition(h));)h=h.parent;return h?{selectedObject:h,intersect:a,intersects:s,mouse:this.mouse.toArray()}:null}return null}refreshOutlinePass(){var e;(e=this.hoverObject)!==null&&e!==void 0||this.selectedObject}isHovering(){return this.hoverObject!=null}isSelected(){return this.selectedObject!=null}}const TA=new b.iMs,Rp=new b.Pa4,__=new b.Pa4,xl=new b._fP,X1={X:new b.Pa4(1,0,0),Y:new b.Pa4(0,1,0),Z:new b.Pa4(0,0,1)},K1={type:"change"},eT={type:"mouseDown"},ex={type:"mouseUp",mode:null},eC={type:"objectChange"};class uD extends b.Tme{constructor(e,i){super(),i===void 0&&(console.warn('THREE.TransformControls: The second parameter "domElement" is now mandatory.'),i=document),this.isTransformControls=!0,this.visible=!1,this.domElement=i,this.domElement.style.touchAction="none";const s=new fD;this._gizmo=s,this.add(s);const a=new mD;this._plane=a,this.add(a);const h=this;function d(wt,xt){let _t=xt;Object.defineProperty(h,wt,{get:function(){return _t!==void 0?_t:xt},set:function(Pt){_t!==Pt&&(_t=Pt,a[wt]=Pt,s[wt]=Pt,h.dispatchEvent({type:wt+"-changed",value:Pt}),h.dispatchEvent(K1))}}),h[wt]=xt,a[wt]=xt,s[wt]=xt}d("camera",e),d("object",void 0),d("enabled",!0),d("axis",null),d("mode","translate"),d("translationSnap",null),d("rotationSnap",null),d("scaleSnap",null),d("space","world"),d("size",1),d("dragging",!1),d("showX",!0),d("showY",!0),d("showZ",!0);const _=new b.Pa4,et=new b.Pa4,nt=new b._fP,it=new b._fP,lt=new b.Pa4,ut=new b._fP,pt=new b.Pa4,gt=new b.Pa4,vt=new b.Pa4,Ct=new b.Pa4;d("worldPosition",_),d("worldPositionStart",et),d("worldQuaternion",nt),d("worldQuaternionStart",it),d("cameraPosition",lt),d("cameraQuaternion",ut),d("pointStart",pt),d("pointEnd",gt),d("rotationAxis",vt),d("rotationAngle",0),d("eye",Ct),this._offset=new b.Pa4,this._startNorm=new b.Pa4,this._endNorm=new b.Pa4,this._cameraScale=new b.Pa4,this._parentPosition=new b.Pa4,this._parentQuaternion=new b._fP,this._parentQuaternionInv=new b._fP,this._parentScale=new b.Pa4,this._worldScaleStart=new b.Pa4,this._worldQuaternionInv=new b._fP,this._worldScale=new b.Pa4,this._positionStart=new b.Pa4,this._quaternionStart=new b._fP,this._scaleStart=new b.Pa4,this._getPointer=tT.bind(this),this._onPointerDown=hD.bind(this),this._onPointerHover=nT.bind(this),this._onPointerMove=dD.bind(this),this._onPointerUp=pD.bind(this),this.domElement.addEventListener("pointerdown",this._onPointerDown),this.domElement.addEventListener("pointermove",this._onPointerHover),this.domElement.addEventListener("pointerup",this._onPointerUp)}updateMatrixWorld(){this.object!==void 0&&(this.object.updateMatrixWorld(),this.object.parent===null?console.error("TransformControls: The attached 3D object must be a part of the scene graph."):this.object.parent.matrixWorld.decompose(this._parentPosition,this._parentQuaternion,this._parentScale),this.object.matrixWorld.decompose(this.worldPosition,this.worldQuaternion,this._worldScale),this._parentQuaternionInv.copy(this._parentQuaternion).invert(),this._worldQuaternionInv.copy(this.worldQuaternion).invert()),this.camera.updateMatrixWorld(),this.camera.matrixWorld.decompose(this.cameraPosition,this.cameraQuaternion,this._cameraScale),this.camera.isOrthographicCamera?this.camera.getWorldDirection(this.eye):this.eye.copy(this.cameraPosition).sub(this.worldPosition).normalize(),super.updateMatrixWorld(this)}pointerHover(e){if(this.object===void 0||this.dragging===!0)return;TA.setFromCamera(e,this.camera);const i=IA(this._gizmo.picker[this.mode],TA);this.axis=i?i.object.name:null}pointerDown(e){if(this.object!==void 0&&this.dragging!==!0&&e.button===0&&this.axis!==null){TA.setFromCamera(e,this.camera);const i=IA(this._plane,TA,!0);i&&(this.object.updateMatrixWorld(),this.object.parent.updateMatrixWorld(),this._positionStart.copy(this.object.position),this._quaternionStart.copy(this.object.quaternion),this._scaleStart.copy(this.object.scale),this.object.matrixWorld.decompose(this.worldPositionStart,this.worldQuaternionStart,this._worldScaleStart),this.pointStart.copy(i.point).sub(this.worldPositionStart)),this.dragging=!0,eT.mode=this.mode,this.dispatchEvent(eT)}}pointerMove(e){const i=this.axis,s=this.mode,a=this.object;let h=this.space;if(s==="scale"?h="local":i!=="E"&&i!=="XYZE"&&i!=="XYZ"||(h="world"),a===void 0||i===null||this.dragging===!1||e.button!==-1)return;TA.setFromCamera(e,this.camera);const d=IA(this._plane,TA,!0);if(d){if(this.pointEnd.copy(d.point).sub(this.worldPositionStart),s==="translate")this._offset.copy(this.pointEnd).sub(this.pointStart),h==="local"&&i!=="XYZ"&&this._offset.applyQuaternion(this._worldQuaternionInv),i.indexOf("X")===-1&&(this._offset.x=0),i.indexOf("Y")===-1&&(this._offset.y=0),i.indexOf("Z")===-1&&(this._offset.z=0),h==="local"&&i!=="XYZ"?this._offset.applyQuaternion(this._quaternionStart).divide(this._parentScale):this._offset.applyQuaternion(this._parentQuaternionInv).divide(this._parentScale),a.position.copy(this._offset).add(this._positionStart),this.translationSnap&&(h==="local"&&(a.position.applyQuaternion(xl.copy(this._quaternionStart).invert()),i.search("X")!==-1&&(a.position.x=Math.round(a.position.x/this.translationSnap)*this.translationSnap),i.search("Y")!==-1&&(a.position.y=Math.round(a.position.y/this.translationSnap)*this.translationSnap),i.search("Z")!==-1&&(a.position.z=Math.round(a.position.z/this.translationSnap)*this.translationSnap),a.position.applyQuaternion(this._quaternionStart)),h==="world"&&(a.parent&&a.position.add(Rp.setFromMatrixPosition(a.parent.matrixWorld)),i.search("X")!==-1&&(a.position.x=Math.round(a.position.x/this.translationSnap)*this.translationSnap),i.search("Y")!==-1&&(a.position.y=Math.round(a.position.y/this.translationSnap)*this.translationSnap),i.search("Z")!==-1&&(a.position.z=Math.round(a.position.z/this.translationSnap)*this.translationSnap),a.parent&&a.position.sub(Rp.setFromMatrixPosition(a.parent.matrixWorld))));else if(s==="scale"){if(i.search("XYZ")!==-1){let _=this.pointEnd.length()/this.pointStart.length();this.pointEnd.dot(this.pointStart)<0&&(_*=-1),__.set(_,_,_)}else Rp.copy(this.pointStart),__.copy(this.pointEnd),Rp.applyQuaternion(this._worldQuaternionInv),__.applyQuaternion(this._worldQuaternionInv),__.divide(Rp),i.search("X")===-1&&(__.x=1),i.search("Y")===-1&&(__.y=1),i.search("Z")===-1&&(__.z=1);a.scale.copy(this._scaleStart).multiply(__),this.scaleSnap&&(i.search("X")!==-1&&(a.scale.x=Math.round(a.scale.x/this.scaleSnap)*this.scaleSnap||this.scaleSnap),i.search("Y")!==-1&&(a.scale.y=Math.round(a.scale.y/this.scaleSnap)*this.scaleSnap||this.scaleSnap),i.search("Z")!==-1&&(a.scale.z=Math.round(a.scale.z/this.scaleSnap)*this.scaleSnap||this.scaleSnap))}else if(s==="rotate"){this._offset.copy(this.pointEnd).sub(this.pointStart);const _=20/this.worldPosition.distanceTo(Rp.setFromMatrixPosition(this.camera.matrixWorld));i==="E"?(this.rotationAxis.copy(this.eye),this.rotationAngle=this.pointEnd.angleTo(this.pointStart),this._startNorm.copy(this.pointStart).normalize(),this._endNorm.copy(this.pointEnd).normalize(),this.rotationAngle*=this._endNorm.cross(this._startNorm).dot(this.eye)<0?1:-1):i==="XYZE"?(this.rotationAxis.copy(this._offset).cross(this.eye).normalize(),this.rotationAngle=this._offset.dot(Rp.copy(this.rotationAxis).cross(this.eye))*_):i!=="X"&&i!=="Y"&&i!=="Z"||(this.rotationAxis.copy(X1[i]),Rp.copy(X1[i]),h==="local"&&Rp.applyQuaternion(this.worldQuaternion),this.rotationAngle=this._offset.dot(Rp.cross(this.eye).normalize())*_),this.rotationSnap&&(this.rotationAngle=Math.round(this.rotationAngle/this.rotationSnap)*this.rotationSnap),h==="local"&&i!=="E"&&i!=="XYZE"?(a.quaternion.copy(this._quaternionStart),a.quaternion.multiply(xl.setFromAxisAngle(this.rotationAxis,this.rotationAngle)).normalize()):(this.rotationAxis.applyQuaternion(this._parentQuaternionInv),a.quaternion.copy(xl.setFromAxisAngle(this.rotationAxis,this.rotationAngle)),a.quaternion.multiply(this._quaternionStart).normalize())}this.dispatchEvent(K1),this.dispatchEvent(eC)}}pointerUp(e){e.button===0&&(this.dragging&&this.axis!==null&&(ex.mode=this.mode,this.dispatchEvent(ex)),this.dragging=!1,this.axis=null)}dispose(){this.domElement.removeEventListener("pointerdown",this._onPointerDown),this.domElement.removeEventListener("pointermove",this._onPointerHover),this.domElement.removeEventListener("pointermove",this._onPointerMove),this.domElement.removeEventListener("pointerup",this._onPointerUp),this.traverse(function(e){e.geometry&&e.geometry.dispose(),e.material&&e.material.dispose()})}attach(e){return this.object=e,this.visible=!0,this}detach(){return this.object=void 0,this.visible=!1,this.axis=null,this}reset(){this.enabled&&this.dragging&&(this.object.position.copy(this._positionStart),this.object.quaternion.copy(this._quaternionStart),this.object.scale.copy(this._scaleStart),this.dispatchEvent(K1),this.dispatchEvent(eC),this.pointStart.copy(this.pointEnd))}getRaycaster(){return TA}getMode(){return this.mode}setMode(e){this.mode=e}setTranslationSnap(e){this.translationSnap=e}setRotationSnap(e){this.rotationSnap=e}setScaleSnap(e){this.scaleSnap=e}setSize(e){this.size=e}setSpace(e){this.space=e}}function tT(c){if(this.domElement.ownerDocument.pointerLockElement)return{x:0,y:0,button:c.button};{const e=this.domElement.getBoundingClientRect();return{x:(c.clientX-e.left)/e.width*2-1,y:-(c.clientY-e.top)/e.height*2+1,button:c.button}}}function nT(c){if(this.enabled)switch(c.pointerType){case"mouse":case"pen":this.pointerHover(this._getPointer(c))}}function hD(c){this.enabled&&(document.pointerLockElement||this.domElement.setPointerCapture(c.pointerId),this.domElement.addEventListener("pointermove",this._onPointerMove),this.pointerHover(this._getPointer(c)),this.pointerDown(this._getPointer(c)))}function dD(c){this.enabled&&this.pointerMove(this._getPointer(c))}function pD(c){this.enabled&&(this.domElement.releasePointerCapture(c.pointerId),this.domElement.removeEventListener("pointermove",this._onPointerMove),this.pointerUp(this._getPointer(c)))}function IA(c,e,i){const s=e.intersectObject(c,!0);for(let a=0;a<s.length;a++)if(s[a].object.visible||i)return s[a];return!1}const tx=new b.USm,jo=new b.Pa4(0,1,0),iT=new b.Pa4(0,0,0),J1=new b.yGw,Z1=new b._fP,$1=new b._fP,$m=new b.Pa4,rT=new b.yGw,Ly=new b.Pa4(1,0,0),DA=new b.Pa4(0,1,0),nx=new b.Pa4(0,0,1),eE=new b.Pa4,ix=new b.Pa4,rx=new b.Pa4;class fD extends b.Tme{constructor(){super(),this.isTransformControlsGizmo=!0,this.type="TransformControlsGizmo";const e=new b.vBJ({depthTest:!1,depthWrite:!1,fog:!1,toneMapped:!1,transparent:!0}),i=new b.nls({depthTest:!1,depthWrite:!1,fog:!1,toneMapped:!1,transparent:!0}),s=e.clone();s.opacity=.15;const a=i.clone();a.opacity=.5;const h=e.clone();h.color.setHex(16711680);const d=e.clone();d.color.setHex(65280);const _=e.clone();_.color.setHex(255);const et=e.clone();et.color.setHex(16711680),et.opacity=.5;const nt=e.clone();nt.color.setHex(65280),nt.opacity=.5;const it=e.clone();it.color.setHex(255),it.opacity=.5;const lt=e.clone();lt.opacity=.25;const ut=e.clone();ut.color.setHex(16776960),ut.opacity=.25,e.clone().color.setHex(16776960);const pt=e.clone();pt.color.setHex(7895160);const gt=new b.fHI(0,.04,.1,12);gt.translate(0,.05,0);const vt=new b.DvJ(.08,.08,.08);vt.translate(0,.04,0);const Ct=new b.u9r;Ct.setAttribute("position",new b.a$l([0,0,0,1,0,0],3));const wt=new b.fHI(.0075,.0075,.5,3);function xt(Tn,vn){const xn=new b.XvJ(Tn,.0075,3,64,vn*Math.PI*2);return xn.rotateY(Math.PI/2),xn.rotateX(Math.PI/2),xn}wt.translate(0,.25,0);const _t={X:[[new b.Kj0(gt,h),[.5,0,0],[0,0,-Math.PI/2]],[new b.Kj0(gt,h),[-.5,0,0],[0,0,Math.PI/2]],[new b.Kj0(wt,h),[0,0,0],[0,0,-Math.PI/2]]],Y:[[new b.Kj0(gt,d),[0,.5,0]],[new b.Kj0(gt,d),[0,-.5,0],[Math.PI,0,0]],[new b.Kj0(wt,d)]],Z:[[new b.Kj0(gt,_),[0,0,.5],[Math.PI/2,0,0]],[new b.Kj0(gt,_),[0,0,-.5],[-Math.PI/2,0,0]],[new b.Kj0(wt,_),null,[Math.PI/2,0,0]]],XYZ:[[new b.Kj0(new b.pQR(.1,0),lt.clone()),[0,0,0]]],XY:[[new b.Kj0(new b.DvJ(.15,.15,.01),it.clone()),[.15,.15,0]]],YZ:[[new b.Kj0(new b.DvJ(.15,.15,.01),et.clone()),[0,.15,.15],[0,Math.PI/2,0]]],XZ:[[new b.Kj0(new b.DvJ(.15,.15,.01),nt.clone()),[.15,0,.15],[-Math.PI/2,0,0]]]},Pt={X:[[new b.Kj0(new b.fHI(.2,0,.6,4),s),[.3,0,0],[0,0,-Math.PI/2]],[new b.Kj0(new b.fHI(.2,0,.6,4),s),[-.3,0,0],[0,0,Math.PI/2]]],Y:[[new b.Kj0(new b.fHI(.2,0,.6,4),s),[0,.3,0]],[new b.Kj0(new b.fHI(.2,0,.6,4),s),[0,-.3,0],[0,0,Math.PI]]],Z:[[new b.Kj0(new b.fHI(.2,0,.6,4),s),[0,0,.3],[Math.PI/2,0,0]],[new b.Kj0(new b.fHI(.2,0,.6,4),s),[0,0,-.3],[-Math.PI/2,0,0]]],XYZ:[[new b.Kj0(new b.pQR(.2,0),s)]],XY:[[new b.Kj0(new b.DvJ(.2,.2,.01),s),[.15,.15,0]]],YZ:[[new b.Kj0(new b.DvJ(.2,.2,.01),s),[0,.15,.15],[0,Math.PI/2,0]]],XZ:[[new b.Kj0(new b.DvJ(.2,.2,.01),s),[.15,0,.15],[-Math.PI/2,0,0]]]},Bt={START:[[new b.Kj0(new b.pQR(.01,2),a),null,null,null,"helper"]],END:[[new b.Kj0(new b.pQR(.01,2),a),null,null,null,"helper"]],DELTA:[[new b.x12(function(){const Tn=new b.u9r;return Tn.setAttribute("position",new b.a$l([0,0,0,1,1,1],3)),Tn}(),a),null,null,null,"helper"]],X:[[new b.x12(Ct,a.clone()),[-1e3,0,0],null,[1e6,1,1],"helper"]],Y:[[new b.x12(Ct,a.clone()),[0,-1e3,0],[0,0,Math.PI/2],[1e6,1,1],"helper"]],Z:[[new b.x12(Ct,a.clone()),[0,0,-1e3],[0,-Math.PI/2,0],[1e6,1,1],"helper"]]},Ot={XYZE:[[new b.Kj0(xt(.5,1),pt),null,[0,Math.PI/2,0]]],X:[[new b.Kj0(xt(.5,.5),h)]],Y:[[new b.Kj0(xt(.5,.5),d),null,[0,0,-Math.PI/2]]],Z:[[new b.Kj0(xt(.5,.5),_),null,[0,Math.PI/2,0]]],E:[[new b.Kj0(xt(.75,1),ut),null,[0,Math.PI/2,0]]]},Lt={AXIS:[[new b.x12(Ct,a.clone()),[-1e3,0,0],null,[1e6,1,1],"helper"]]},qt={XYZE:[[new b.Kj0(new b.xo$(.25,10,8),s)]],X:[[new b.Kj0(new b.XvJ(.5,.1,4,24),s),[0,0,0],[0,-Math.PI/2,-Math.PI/2]]],Y:[[new b.Kj0(new b.XvJ(.5,.1,4,24),s),[0,0,0],[Math.PI/2,0,0]]],Z:[[new b.Kj0(new b.XvJ(.5,.1,4,24),s),[0,0,0],[0,0,-Math.PI/2]]],E:[[new b.Kj0(new b.XvJ(.75,.1,2,24),s)]]},en={X:[[new b.Kj0(vt,h),[.5,0,0],[0,0,-Math.PI/2]],[new b.Kj0(wt,h),[0,0,0],[0,0,-Math.PI/2]],[new b.Kj0(vt,h),[-.5,0,0],[0,0,Math.PI/2]]],Y:[[new b.Kj0(vt,d),[0,.5,0]],[new b.Kj0(wt,d)],[new b.Kj0(vt,d),[0,-.5,0],[0,0,Math.PI]]],Z:[[new b.Kj0(vt,_),[0,0,.5],[Math.PI/2,0,0]],[new b.Kj0(wt,_),[0,0,0],[Math.PI/2,0,0]],[new b.Kj0(vt,_),[0,0,-.5],[-Math.PI/2,0,0]]],XY:[[new b.Kj0(new b.DvJ(.15,.15,.01),it),[.15,.15,0]]],YZ:[[new b.Kj0(new b.DvJ(.15,.15,.01),et),[0,.15,.15],[0,Math.PI/2,0]]],XZ:[[new b.Kj0(new b.DvJ(.15,.15,.01),nt),[.15,0,.15],[-Math.PI/2,0,0]]],XYZ:[[new b.Kj0(new b.DvJ(.1,.1,.1),lt.clone())]]},cn={X:[[new b.Kj0(new b.fHI(.2,0,.6,4),s),[.3,0,0],[0,0,-Math.PI/2]],[new b.Kj0(new b.fHI(.2,0,.6,4),s),[-.3,0,0],[0,0,Math.PI/2]]],Y:[[new b.Kj0(new b.fHI(.2,0,.6,4),s),[0,.3,0]],[new b.Kj0(new b.fHI(.2,0,.6,4),s),[0,-.3,0],[0,0,Math.PI]]],Z:[[new b.Kj0(new b.fHI(.2,0,.6,4),s),[0,0,.3],[Math.PI/2,0,0]],[new b.Kj0(new b.fHI(.2,0,.6,4),s),[0,0,-.3],[-Math.PI/2,0,0]]],XY:[[new b.Kj0(new b.DvJ(.2,.2,.01),s),[.15,.15,0]]],YZ:[[new b.Kj0(new b.DvJ(.2,.2,.01),s),[0,.15,.15],[0,Math.PI/2,0]]],XZ:[[new b.Kj0(new b.DvJ(.2,.2,.01),s),[.15,0,.15],[-Math.PI/2,0,0]]],XYZ:[[new b.Kj0(new b.DvJ(.2,.2,.2),s),[0,0,0]]]},An={X:[[new b.x12(Ct,a.clone()),[-1e3,0,0],null,[1e6,1,1],"helper"]],Y:[[new b.x12(Ct,a.clone()),[0,-1e3,0],[0,0,Math.PI/2],[1e6,1,1],"helper"]],Z:[[new b.x12(Ct,a.clone()),[0,0,-1e3],[0,-Math.PI/2,0],[1e6,1,1],"helper"]]};function mn(Tn){const vn=new b.Tme;for(const xn in Tn)for(let Un=Tn[xn].length;Un--;){const Mn=Tn[xn][Un][0].clone(),Gn=Tn[xn][Un][1],rr=Tn[xn][Un][2],dr=Tn[xn][Un][3],_i=Tn[xn][Un][4];Mn.name=xn,Mn.tag=_i,Gn&&Mn.position.set(Gn[0],Gn[1],Gn[2]),rr&&Mn.rotation.set(rr[0],rr[1],rr[2]),dr&&Mn.scale.set(dr[0],dr[1],dr[2]),Mn.updateMatrix();const xr=Mn.geometry.clone();xr.applyMatrix4(Mn.matrix),Mn.geometry=xr,Mn.renderOrder=1/0,Mn.position.set(0,0,0),Mn.rotation.set(0,0,0),Mn.scale.set(1,1,1),vn.add(Mn)}return vn}this.gizmo={},this.picker={},this.helper={},this.add(this.gizmo.translate=mn(_t)),this.add(this.gizmo.rotate=mn(Ot)),this.add(this.gizmo.scale=mn(en)),this.add(this.picker.translate=mn(Pt)),this.add(this.picker.rotate=mn(qt)),this.add(this.picker.scale=mn(cn)),this.add(this.helper.translate=mn(Bt)),this.add(this.helper.rotate=mn(Lt)),this.add(this.helper.scale=mn(An)),this.picker.translate.visible=!1,this.picker.rotate.visible=!1,this.picker.scale.visible=!1}updateMatrixWorld(e){const i=(this.mode==="scale"?"local":this.space)==="local"?this.worldQuaternion:$1;this.gizmo.translate.visible=this.mode==="translate",this.gizmo.rotate.visible=this.mode==="rotate",this.gizmo.scale.visible=this.mode==="scale",this.helper.translate.visible=this.mode==="translate",this.helper.rotate.visible=this.mode==="rotate",this.helper.scale.visible=this.mode==="scale";let s=[];s=s.concat(this.picker[this.mode].children),s=s.concat(this.gizmo[this.mode].children),s=s.concat(this.helper[this.mode].children);for(let a=0;a<s.length;a++){const h=s[a];let d;h.visible=!0,h.rotation.set(0,0,0),h.position.copy(this.worldPosition),d=this.camera.isOrthographicCamera?(this.camera.top-this.camera.bottom)/this.camera.zoom:this.worldPosition.distanceTo(this.cameraPosition)*Math.min(1.9*Math.tan(Math.PI*this.camera.fov/360)/this.camera.zoom,7),h.scale.set(1,1,1).multiplyScalar(d*this.size/4),h.tag!=="helper"?(h.quaternion.copy(i),this.mode==="translate"||this.mode==="scale"?(h.name==="X"&&Math.abs(jo.copy(Ly).applyQuaternion(i).dot(this.eye))>.99&&(h.scale.set(1e-10,1e-10,1e-10),h.visible=!1),h.name==="Y"&&Math.abs(jo.copy(DA).applyQuaternion(i).dot(this.eye))>.99&&(h.scale.set(1e-10,1e-10,1e-10),h.visible=!1),h.name==="Z"&&Math.abs(jo.copy(nx).applyQuaternion(i).dot(this.eye))>.99&&(h.scale.set(1e-10,1e-10,1e-10),h.visible=!1),h.name==="XY"&&Math.abs(jo.copy(nx).applyQuaternion(i).dot(this.eye))<.2&&(h.scale.set(1e-10,1e-10,1e-10),h.visible=!1),h.name==="YZ"&&Math.abs(jo.copy(Ly).applyQuaternion(i).dot(this.eye))<.2&&(h.scale.set(1e-10,1e-10,1e-10),h.visible=!1),h.name==="XZ"&&Math.abs(jo.copy(DA).applyQuaternion(i).dot(this.eye))<.2&&(h.scale.set(1e-10,1e-10,1e-10),h.visible=!1)):this.mode==="rotate"&&(Z1.copy(i),jo.copy(this.eye).applyQuaternion(xl.copy(i).invert()),h.name.search("E")!==-1&&h.quaternion.setFromRotationMatrix(J1.lookAt(this.eye,iT,DA)),h.name==="X"&&(xl.setFromAxisAngle(Ly,Math.atan2(-jo.y,jo.z)),xl.multiplyQuaternions(Z1,xl),h.quaternion.copy(xl)),h.name==="Y"&&(xl.setFromAxisAngle(DA,Math.atan2(jo.x,jo.z)),xl.multiplyQuaternions(Z1,xl),h.quaternion.copy(xl)),h.name==="Z"&&(xl.setFromAxisAngle(nx,Math.atan2(jo.y,jo.x)),xl.multiplyQuaternions(Z1,xl),h.quaternion.copy(xl))),h.visible=h.visible&&(h.name.indexOf("X")===-1||this.showX),h.visible=h.visible&&(h.name.indexOf("Y")===-1||this.showY),h.visible=h.visible&&(h.name.indexOf("Z")===-1||this.showZ),h.visible=h.visible&&(h.name.indexOf("E")===-1||this.showX&&this.showY&&this.showZ),h.material._color=h.material._color||h.material.color.clone(),h.material._opacity=h.material._opacity||h.material.opacity,h.material.color.copy(h.material._color),h.material.opacity=h.material._opacity,this.enabled&&this.axis&&(h.name===this.axis||this.axis.split("").some(function(_){return h.name===_}))&&(h.material.color.setHex(16776960),h.material.opacity=1)):(h.visible=!1,h.name==="AXIS"?(h.position.copy(this.worldPositionStart),h.visible=!!this.axis,this.axis==="X"&&(xl.setFromEuler(tx.set(0,0,0)),h.quaternion.copy(i).multiply(xl),Math.abs(jo.copy(Ly).applyQuaternion(i).dot(this.eye))>.9&&(h.visible=!1)),this.axis==="Y"&&(xl.setFromEuler(tx.set(0,0,Math.PI/2)),h.quaternion.copy(i).multiply(xl),Math.abs(jo.copy(DA).applyQuaternion(i).dot(this.eye))>.9&&(h.visible=!1)),this.axis==="Z"&&(xl.setFromEuler(tx.set(0,Math.PI/2,0)),h.quaternion.copy(i).multiply(xl),Math.abs(jo.copy(nx).applyQuaternion(i).dot(this.eye))>.9&&(h.visible=!1)),this.axis==="XYZE"&&(xl.setFromEuler(tx.set(0,Math.PI/2,0)),jo.copy(this.rotationAxis),h.quaternion.setFromRotationMatrix(J1.lookAt(iT,jo,DA)),h.quaternion.multiply(xl),h.visible=this.dragging),this.axis==="E"&&(h.visible=!1)):h.name==="START"?(h.position.copy(this.worldPositionStart),h.visible=this.dragging):h.name==="END"?(h.position.copy(this.worldPosition),h.visible=this.dragging):h.name==="DELTA"?(h.position.copy(this.worldPositionStart),h.quaternion.copy(this.worldQuaternionStart),Rp.set(1e-10,1e-10,1e-10).add(this.worldPositionStart).sub(this.worldPosition).multiplyScalar(-1),Rp.applyQuaternion(this.worldQuaternionStart.clone().invert()),h.scale.copy(Rp),h.visible=this.dragging):(h.quaternion.copy(i),this.dragging?h.position.copy(this.worldPositionStart):h.position.copy(this.worldPosition),this.axis&&(h.visible=this.axis.search(h.name)!==-1)))}super.updateMatrixWorld(e)}}class mD extends b.Kj0{constructor(){super(new b._12(1e5,1e5,2,2),new b.vBJ({visible:!1,wireframe:!0,side:b.ehD,transparent:!0,opacity:.1,toneMapped:!1})),this.isTransformControlsPlane=!0,this.type="TransformControlsPlane"}updateMatrixWorld(e){let i=this.space;switch(this.position.copy(this.worldPosition),this.mode==="scale"&&(i="local"),eE.copy(Ly).applyQuaternion(i==="local"?this.worldQuaternion:$1),ix.copy(DA).applyQuaternion(i==="local"?this.worldQuaternion:$1),rx.copy(nx).applyQuaternion(i==="local"?this.worldQuaternion:$1),jo.copy(ix),this.mode){case"translate":case"scale":switch(this.axis){case"X":jo.copy(this.eye).cross(eE),$m.copy(eE).cross(jo);break;case"Y":jo.copy(this.eye).cross(ix),$m.copy(ix).cross(jo);break;case"Z":jo.copy(this.eye).cross(rx),$m.copy(rx).cross(jo);break;case"XY":$m.copy(rx);break;case"YZ":$m.copy(eE);break;case"XZ":jo.copy(rx),$m.copy(ix);break;case"XYZ":case"E":$m.set(0,0,0)}break;default:$m.set(0,0,0)}$m.length()===0?this.quaternion.copy(this.cameraQuaternion):(rT.lookAt(Rp.set(0,0,0),$m,jo),this.quaternion.setFromRotationMatrix(rT)),super.updateMatrixWorld(e)}}const tC=new b.ZzF,sx=new b.Pa4;class sT extends b.L5s{constructor(){super(),this.isLineSegmentsGeometry=!0,this.type="LineSegmentsGeometry",this.setIndex([0,2,1,2,3,1,2,4,3,4,5,3,4,6,5,6,7,5]),this.setAttribute("position",new b.a$l([-1,2,0,1,2,0,-1,1,0,1,1,0,-1,0,0,1,0,0,-1,-1,0,1,-1,0],3)),this.setAttribute("uv",new b.a$l([-1,2,1,2,-1,1,1,1,-1,-1,1,-1,-1,-2,1,-2],2))}applyMatrix4(e){const i=this.attributes.instanceStart,s=this.attributes.instanceEnd;return i!==void 0&&(i.applyMatrix4(e),s.applyMatrix4(e),i.needsUpdate=!0),this.boundingBox!==null&&this.computeBoundingBox(),this.boundingSphere!==null&&this.computeBoundingSphere(),this}setPositions(e){let i;e instanceof Float32Array?i=e:Array.isArray(e)&&(i=new Float32Array(e));const s=new b.$TI(i,6,1);return this.setAttribute("instanceStart",new b.kB5(s,3,0)),this.setAttribute("instanceEnd",new b.kB5(s,3,3)),this.computeBoundingBox(),this.computeBoundingSphere(),this}setColors(e){let i;e instanceof Float32Array?i=e:Array.isArray(e)&&(i=new Float32Array(e));const s=new b.$TI(i,6,1);return this.setAttribute("instanceColorStart",new b.kB5(s,3,0)),this.setAttribute("instanceColorEnd",new b.kB5(s,3,3)),this}fromWireframeGeometry(e){return this.setPositions(e.attributes.position.array),this}fromEdgesGeometry(e){return this.setPositions(e.attributes.position.array),this}fromMesh(e){return this.fromWireframeGeometry(new b.Uk6(e.geometry)),this}fromLineSegments(e){const i=e.geometry;return this.setPositions(i.attributes.position.array),this}computeBoundingBox(){this.boundingBox===null&&(this.boundingBox=new b.ZzF);const e=this.attributes.instanceStart,i=this.attributes.instanceEnd;e!==void 0&&i!==void 0&&(this.boundingBox.setFromBufferAttribute(e),tC.setFromBufferAttribute(i),this.boundingBox.union(tC))}computeBoundingSphere(){this.boundingSphere===null&&(this.boundingSphere=new b.aLr),this.boundingBox===null&&this.computeBoundingBox();const e=this.attributes.instanceStart,i=this.attributes.instanceEnd;if(e!==void 0&&i!==void 0){const s=this.boundingSphere.center;this.boundingBox.getCenter(s);let a=0;for(let h=0,d=e.count;h<d;h++)sx.fromBufferAttribute(e,h),a=Math.max(a,s.distanceToSquared(sx)),sx.fromBufferAttribute(i,h),a=Math.max(a,s.distanceToSquared(sx));this.boundingSphere.radius=Math.sqrt(a),isNaN(this.boundingSphere.radius)&&console.error("THREE.LineSegmentsGeometry.computeBoundingSphere(): Computed radius is NaN. The instanced position data is likely to have NaN values.",this)}}toJSON(){}applyMatrix(e){return console.warn("THREE.LineSegmentsGeometry: applyMatrix() has been renamed to applyMatrix4()."),this.applyMatrix4(e)}}class gD extends sT{constructor(e){super(),this.isWireframeGeometry2=!0,this.type="WireframeGeometry2",this.fromWireframeGeometry(new b.Uk6(e))}}b.rBU.line={worldUnits:{value:1},linewidth:{value:1},resolution:{value:new b.FM8(1,1)},dashOffset:{value:0},dashScale:{value:1},dashSize:{value:1},gapSize:{value:1}},b.Vj0.line={uniforms:b.rDY.merge([b.rBU.common,b.rBU.fog,b.rBU.line]),vertexShader:`
		#include <common>
		#include <color_pars_vertex>
		#include <fog_pars_vertex>
		#include <logdepthbuf_pars_vertex>
		#include <clipping_planes_pars_vertex>

		uniform float linewidth;
		uniform vec2 resolution;

		attribute vec3 instanceStart;
		attribute vec3 instanceEnd;

		attribute vec3 instanceColorStart;
		attribute vec3 instanceColorEnd;

		#ifdef WORLD_UNITS

			varying vec4 worldPos;
			varying vec3 worldStart;
			varying vec3 worldEnd;

			#ifdef USE_DASH

				varying vec2 vUv;

			#endif

		#else

			varying vec2 vUv;

		#endif

		#ifdef USE_DASH

			uniform float dashScale;
			attribute float instanceDistanceStart;
			attribute float instanceDistanceEnd;
			varying float vLineDistance;

		#endif

		void trimSegment( const in vec4 start, inout vec4 end ) {

			// trim end segment so it terminates between the camera plane and the near plane

			// conservative estimate of the near plane
			float a = projectionMatrix[ 2 ][ 2 ]; // 3nd entry in 3th column
			float b = projectionMatrix[ 3 ][ 2 ]; // 3nd entry in 4th column
			float nearEstimate = - 0.5 * b / a;

			float alpha = ( nearEstimate - start.z ) / ( end.z - start.z );

			end.xyz = mix( start.xyz, end.xyz, alpha );

		}

		void main() {

			#ifdef USE_COLOR

				vColor.xyz = ( position.y < 0.5 ) ? instanceColorStart : instanceColorEnd;

			#endif

			#ifdef USE_DASH

				vLineDistance = ( position.y < 0.5 ) ? dashScale * instanceDistanceStart : dashScale * instanceDistanceEnd;
				vUv = uv;

			#endif

			float aspect = resolution.x / resolution.y;

			// camera space
			vec4 start = modelViewMatrix * vec4( instanceStart, 1.0 );
			vec4 end = modelViewMatrix * vec4( instanceEnd, 1.0 );

			#ifdef WORLD_UNITS

				worldStart = start.xyz;
				worldEnd = end.xyz;

			#else

				vUv = uv;

			#endif

			// special case for perspective projection, and segments that terminate either in, or behind, the camera plane
			// clearly the gpu firmware has a way of addressing this issue when projecting into ndc space
			// but we need to perform ndc-space calculations in the shader, so we must address this issue directly
			// perhaps there is a more elegant solution -- WestLangley

			bool perspective = ( projectionMatrix[ 2 ][ 3 ] == - 1.0 ); // 4th entry in the 3rd column

			if ( perspective ) {

				if ( start.z < 0.0 && end.z >= 0.0 ) {

					trimSegment( start, end );

				} else if ( end.z < 0.0 && start.z >= 0.0 ) {

					trimSegment( end, start );

				}

			}

			// clip space
			vec4 clipStart = projectionMatrix * start;
			vec4 clipEnd = projectionMatrix * end;

			// ndc space
			vec3 ndcStart = clipStart.xyz / clipStart.w;
			vec3 ndcEnd = clipEnd.xyz / clipEnd.w;

			// direction
			vec2 dir = ndcEnd.xy - ndcStart.xy;

			// account for clip-space aspect ratio
			dir.x *= aspect;
			dir = normalize( dir );

			#ifdef WORLD_UNITS

				// get the offset direction as perpendicular to the view vector
				vec3 worldDir = normalize( end.xyz - start.xyz );
				vec3 offset;
				if ( position.y < 0.5 ) {

					offset = normalize( cross( start.xyz, worldDir ) );

				} else {

					offset = normalize( cross( end.xyz, worldDir ) );

				}

				// sign flip
				if ( position.x < 0.0 ) offset *= - 1.0;

				float forwardOffset = dot( worldDir, vec3( 0.0, 0.0, 1.0 ) );

				// don't extend the line if we're rendering dashes because we
				// won't be rendering the endcaps
				#ifndef USE_DASH

					// extend the line bounds to encompass  endcaps
					start.xyz += - worldDir * linewidth * 0.5;
					end.xyz += worldDir * linewidth * 0.5;

					// shift the position of the quad so it hugs the forward edge of the line
					offset.xy -= dir * forwardOffset;
					offset.z += 0.5;

				#endif

				// endcaps
				if ( position.y > 1.0 || position.y < 0.0 ) {

					offset.xy += dir * 2.0 * forwardOffset;

				}

				// adjust for linewidth
				offset *= linewidth * 0.5;

				// set the world position
				worldPos = ( position.y < 0.5 ) ? start : end;
				worldPos.xyz += offset;

				// project the worldpos
				vec4 clip = projectionMatrix * worldPos;

				// shift the depth of the projected points so the line
				// segments overlap neatly
				vec3 clipPose = ( position.y < 0.5 ) ? ndcStart : ndcEnd;
				clip.z = clipPose.z * clip.w;

			#else

				vec2 offset = vec2( dir.y, - dir.x );
				// undo aspect ratio adjustment
				dir.x /= aspect;
				offset.x /= aspect;

				// sign flip
				if ( position.x < 0.0 ) offset *= - 1.0;

				// endcaps
				if ( position.y < 0.0 ) {

					offset += - dir;

				} else if ( position.y > 1.0 ) {

					offset += dir;

				}

				// adjust for linewidth
				offset *= linewidth;

				// adjust for clip-space to screen-space conversion // maybe resolution should be based on viewport ...
				offset /= resolution.y;

				// select end
				vec4 clip = ( position.y < 0.5 ) ? clipStart : clipEnd;

				// back to clip space
				offset *= clip.w;

				clip.xy += offset;

			#endif

			gl_Position = clip;

			vec4 mvPosition = ( position.y < 0.5 ) ? start : end; // this is an approximation

			#include <logdepthbuf_vertex>
			#include <clipping_planes_vertex>
			#include <fog_vertex>

		}
		`,fragmentShader:`
		uniform vec3 diffuse;
		uniform float opacity;
		uniform float linewidth;

		#ifdef USE_DASH

			uniform float dashOffset;
			uniform float dashSize;
			uniform float gapSize;

		#endif

		varying float vLineDistance;

		#ifdef WORLD_UNITS

			varying vec4 worldPos;
			varying vec3 worldStart;
			varying vec3 worldEnd;

			#ifdef USE_DASH

				varying vec2 vUv;

			#endif

		#else

			varying vec2 vUv;

		#endif

		#include <common>
		#include <color_pars_fragment>
		#include <fog_pars_fragment>
		#include <logdepthbuf_pars_fragment>
		#include <clipping_planes_pars_fragment>

		vec2 closestLineToLine(vec3 p1, vec3 p2, vec3 p3, vec3 p4) {

			float mua;
			float mub;

			vec3 p13 = p1 - p3;
			vec3 p43 = p4 - p3;

			vec3 p21 = p2 - p1;

			float d1343 = dot( p13, p43 );
			float d4321 = dot( p43, p21 );
			float d1321 = dot( p13, p21 );
			float d4343 = dot( p43, p43 );
			float d2121 = dot( p21, p21 );

			float denom = d2121 * d4343 - d4321 * d4321;

			float numer = d1343 * d4321 - d1321 * d4343;

			mua = numer / denom;
			mua = clamp( mua, 0.0, 1.0 );
			mub = ( d1343 + d4321 * ( mua ) ) / d4343;
			mub = clamp( mub, 0.0, 1.0 );

			return vec2( mua, mub );

		}

		void main() {

			#include <clipping_planes_fragment>

			#ifdef USE_DASH

				if ( vUv.y < - 1.0 || vUv.y > 1.0 ) discard; // discard endcaps

				if ( mod( vLineDistance + dashOffset, dashSize + gapSize ) > dashSize ) discard; // todo - FIX

			#endif

			float alpha = opacity;

			#ifdef WORLD_UNITS

				// Find the closest points on the view ray and the line segment
				vec3 rayEnd = normalize( worldPos.xyz ) * 1e5;
				vec3 lineDir = worldEnd - worldStart;
				vec2 params = closestLineToLine( worldStart, worldEnd, vec3( 0.0, 0.0, 0.0 ), rayEnd );

				vec3 p1 = worldStart + lineDir * params.x;
				vec3 p2 = rayEnd * params.y;
				vec3 delta = p1 - p2;
				float len = length( delta );
				float norm = len / linewidth;

				#ifndef USE_DASH

					#ifdef USE_ALPHA_TO_COVERAGE

						float dnorm = fwidth( norm );
						alpha = 1.0 - smoothstep( 0.5 - dnorm, 0.5 + dnorm, norm );

					#else

						if ( norm > 0.5 ) {

							discard;

						}

					#endif

				#endif

			#else

				#ifdef USE_ALPHA_TO_COVERAGE

					// artifacts appear on some hardware if a derivative is taken within a conditional
					float a = vUv.x;
					float b = ( vUv.y > 0.0 ) ? vUv.y - 1.0 : vUv.y + 1.0;
					float len2 = a * a + b * b;
					float dlen = fwidth( len2 );

					if ( abs( vUv.y ) > 1.0 ) {

						alpha = 1.0 - smoothstep( 1.0 - dlen, 1.0 + dlen, len2 );

					}

				#else

					if ( abs( vUv.y ) > 1.0 ) {

						float a = vUv.x;
						float b = ( vUv.y > 0.0 ) ? vUv.y - 1.0 : vUv.y + 1.0;
						float len2 = a * a + b * b;

						if ( len2 > 1.0 ) discard;

					}

				#endif

			#endif

			vec4 diffuseColor = vec4( diffuse, alpha );

			#include <logdepthbuf_fragment>
			#include <color_fragment>

			gl_FragColor = vec4( diffuseColor.rgb, alpha );

			#include <tonemapping_fragment>
			#include <encodings_fragment>
			#include <fog_fragment>
			#include <premultiplied_alpha_fragment>

		}
		`};class oT extends b.jyz{constructor(e){super({type:"LineMaterial",uniforms:b.rDY.clone(b.Vj0.line.uniforms),vertexShader:b.Vj0.line.vertexShader,fragmentShader:b.Vj0.line.fragmentShader,clipping:!0}),this.isLineMaterial=!0,Object.defineProperties(this,{color:{enumerable:!0,get:function(){return this.uniforms.diffuse.value},set:function(i){this.uniforms.diffuse.value=i}},worldUnits:{enumerable:!0,get:function(){return"WORLD_UNITS"in this.defines},set:function(i){i===!0?this.defines.WORLD_UNITS="":delete this.defines.WORLD_UNITS}},linewidth:{enumerable:!0,get:function(){return this.uniforms.linewidth.value},set:function(i){this.uniforms.linewidth.value=i}},dashed:{enumerable:!0,get:function(){return Boolean("USE_DASH"in this.defines)},set(i){Boolean(i)!==Boolean("USE_DASH"in this.defines)&&(this.needsUpdate=!0),i===!0?this.defines.USE_DASH="":delete this.defines.USE_DASH}},dashScale:{enumerable:!0,get:function(){return this.uniforms.dashScale.value},set:function(i){this.uniforms.dashScale.value=i}},dashSize:{enumerable:!0,get:function(){return this.uniforms.dashSize.value},set:function(i){this.uniforms.dashSize.value=i}},dashOffset:{enumerable:!0,get:function(){return this.uniforms.dashOffset.value},set:function(i){this.uniforms.dashOffset.value=i}},gapSize:{enumerable:!0,get:function(){return this.uniforms.gapSize.value},set:function(i){this.uniforms.gapSize.value=i}},opacity:{enumerable:!0,get:function(){return this.uniforms.opacity.value},set:function(i){this.uniforms.opacity.value=i}},resolution:{enumerable:!0,get:function(){return this.uniforms.resolution.value},set:function(i){this.uniforms.resolution.value.copy(i)}},alphaToCoverage:{enumerable:!0,get:function(){return Boolean("USE_ALPHA_TO_COVERAGE"in this.defines)},set:function(i){Boolean(i)!==Boolean("USE_ALPHA_TO_COVERAGE"in this.defines)&&(this.needsUpdate=!0),i===!0?(this.defines.USE_ALPHA_TO_COVERAGE="",this.extensions.derivatives=!0):(delete this.defines.USE_ALPHA_TO_COVERAGE,this.extensions.derivatives=!1)}}}),this.setValues(e)}}const aT=new b.Pa4,lT=new b.Pa4;class cT extends b.Kj0{constructor(e=new sT,i=new oT({color:16777215*Math.random()})){super(e,i),this.isWireframe=!0,this.type="Wireframe"}computeLineDistances(){const e=this.geometry,i=e.attributes.instanceStart,s=e.attributes.instanceEnd,a=new Float32Array(2*i.count);for(let d=0,_=0,et=i.count;d<et;d++,_+=2)aT.fromBufferAttribute(i,d),lT.fromBufferAttribute(s,d),a[_]=_===0?0:a[_-1],a[_+1]=a[_]+aT.distanceTo(lT);const h=new b.$TI(a,2,1);return e.setAttribute("instanceDistanceStart",new b.kB5(h,1,0)),e.setAttribute("instanceDistanceEnd",new b.kB5(h,1,1)),this}}class nC extends b.ZAu{constructor(){super(),this.assetType="widget",this.modelObject=this,this._object=null,this.boundingScaleMultiplier=1,this.position.set(0,0,0),this.visible=!1,this.renderOrder=1,this.userData.bboxVisible=!1,this._updater=this._updater.bind(this)}_updater(){const e=this._object;if(e){const i=new Dr().expandByObject(e,!1);i.getCenter(this.position);const s=i.getBoundingSphere(new b.aLr).radius;this.scale.setScalar(s*this.boundingScaleMultiplier),this.setVisible(!0)}else this.setVisible(!1)}_initGeometry(e){if(this._geometry)return;const i=new gD(e);this._geometry=i;const s=new oT({color:"#ff2222",transparent:!0,opacity:.9,linewidth:5,resolution:new b.FM8(1024,1024),dashed:!1,toneMapped:!1}),a=new cT(i,s);a.computeLineDistances(),a.scale.set(1,1,1),a.visible=!0,this.add(a)}setVisible(e){var i;e!==this.visible&&(this.visible=e,(i=this.setDirty)===null||i===void 0||i.call(this,{sceneUpdate:!1}))}attach(e){return this.detach(),e?(this._object=e,this._object.addEventListener("objectUpdate",this._updater),this._updater(),this):this}detach(){var e;return this._object?((e=this._object)===null||e===void 0||e.removeEventListener("objectUpdate",this._updater),this._object=null,this._updater(),this):this}get object(){return this._object}}class ox extends nC{constructor(){super(),this.boundingScaleMultiplier=1/1.7,this._initGeometry(new b.DvJ(2,2,2,1,1,1))}_updater(){super._updater();const e=this.object;e&&(new Dr().expandByObject(e,!1).getSize(this.scale).multiplyScalar(this.boundingScaleMultiplier).clampScalar(.1,100),this.setVisible(!0))}}var PA=function(c){return function(e){return 1-c(1-e)}},tE=function(c){return function(e){return e<=.5?c(2*e)/2:(2-c(2*(1-e)))/2}},uT=function(c){return function(e){return Math.pow(e,c)}},iC=function(c){return function(e){return e*e*((c+1)*e-c)}},rC=function(c){var e=iC(c);return function(i){return(i*=2)<1?.5*e(i):.5*(2-Math.pow(2,-10*(i-1)))}},nE=function(c){return c},T0=uT(2),hT=PA(T0),ax=tE(T0),iE=function(c){return 1-Math.sin(Math.acos(c))},sC=PA(iE),dT=tE(sC),rE=iC(1.525),oC=PA(rE),aC=tE(rE),lx=rC(1.525),A_=function(c){if(c===1||c===0)return c;var e=c*c;return c<.36363636363636365?7.5625*e:c<.7272727272727273?9.075*e-9.9*c+3.4:c<.9?12.066481994459833*e-19.63545706371191*c+8.898060941828255:10.8*c*c-20.52*c+10.72},lC=PA(A_),cx=function(c){return c<.5?.5*(1-A_(1-2*c)):.5*A_(2*c-1)+.5},lo=function(){return lo=Object.assign||function(c){for(var e,i=1,s=arguments.length;i<s;i++)for(var a in e=arguments[i])Object.prototype.hasOwnProperty.call(e,a)&&(c[a]=e[a]);return c},lo.apply(this,arguments)};function y_(c,e){var i={};for(var s in c)Object.prototype.hasOwnProperty.call(c,s)&&e.indexOf(s)<0&&(i[s]=c[s]);if(c!=null&&typeof Object.getOwnPropertySymbols=="function"){var a=0;for(s=Object.getOwnPropertySymbols(c);a<s.length;a++)e.indexOf(s[a])<0&&Object.prototype.propertyIsEnumerable.call(c,s[a])&&(i[s[a]]=c[s[a]])}return i}var RA=function(c,e,i){return Math.min(Math.max(i,c),e)};function w_(c,e){return c*Math.sqrt(1-e*e)}var ux=["duration","bounce"],Ny=["stiffness","damping","mass"];function BA(c,e){return e.some(function(i){return c[i]!==void 0})}function I0(c){var e=c.from,i=e===void 0?0:e,s=c.to,a=s===void 0?1:s,h=c.restSpeed,d=h===void 0?2:h,_=c.restDelta,et=y_(c,["from","to","restSpeed","restDelta"]),nt={done:!1,value:i},it=function(Pt){var Bt=lo({velocity:0,stiffness:100,damping:10,mass:1,isResolvedFromDuration:!1},Pt);if(!BA(Pt,Ny)&&BA(Pt,ux)){var Ot=function(Lt){var qt,en,cn=Lt.duration,An=cn===void 0?800:cn,mn=Lt.bounce,Tn=mn===void 0?.25:mn,vn=Lt.velocity,xn=vn===void 0?0:vn,Un=Lt.mass,Mn=Un===void 0?1:Un,Gn=1-Tn;Gn=RA(.05,1,Gn),An=RA(.01,10,An/1e3),Gn<1?(qt=function(_i){var xr=_i*Gn,Cr=xr*An;return .001-(xr-xn)/w_(_i,Gn)*Math.exp(-Cr)},en=function(_i){var xr=_i*Gn*An,Cr=xr*xn+xn,Mr=Math.pow(Gn,2)*Math.pow(_i,2)*An,Lr=Math.exp(-xr),ls=w_(Math.pow(_i,2),Gn);return(.001-qt(_i)>0?-1:1)*((Cr-Mr)*Lr)/ls}):(qt=function(_i){return Math.exp(-_i*An)*((_i-xn)*An+1)-.001},en=function(_i){return Math.exp(-_i*An)*(An*An*(xn-_i))});var rr=function(_i,xr,Cr){for(var Mr=Cr,Lr=1;Lr<12;Lr++)Mr-=_i(Mr)/xr(Mr);return Mr}(qt,en,5/An);if(An*=1e3,isNaN(rr))return{stiffness:100,damping:10,duration:An};var dr=Math.pow(rr,2)*Mn;return{stiffness:dr,damping:2*Gn*Math.sqrt(Mn*dr),duration:An}}(Pt);(Bt=lo(lo(lo({},Bt),Ot),{velocity:0,mass:1})).isResolvedFromDuration=!0}return Bt}(et),lt=it.stiffness,ut=it.damping,pt=it.mass,gt=it.velocity,vt=it.duration,Ct=it.isResolvedFromDuration,wt=Uy,xt=Uy;function _t(){var Pt=gt?-gt/1e3:0,Bt=a-i,Ot=ut/(2*Math.sqrt(lt*pt)),Lt=Math.sqrt(lt/pt)/1e3;if(_!=null||(_=Math.abs(a-i)<=1?.01:.4),Ot<1){var qt=w_(Lt,Ot);wt=function(cn){var An=Math.exp(-Ot*Lt*cn);return a-An*((Pt+Ot*Lt*Bt)/qt*Math.sin(qt*cn)+Bt*Math.cos(qt*cn))},xt=function(cn){var An=Math.exp(-Ot*Lt*cn);return Ot*Lt*An*(Math.sin(qt*cn)*(Pt+Ot*Lt*Bt)/qt+Bt*Math.cos(qt*cn))-An*(Math.cos(qt*cn)*(Pt+Ot*Lt*Bt)-qt*Bt*Math.sin(qt*cn))}}else if(Ot===1)wt=function(cn){return a-Math.exp(-Lt*cn)*(Bt+(Pt+Lt*Bt)*cn)};else{var en=Lt*Math.sqrt(Ot*Ot-1);wt=function(cn){var An=Math.exp(-Ot*Lt*cn),mn=Math.min(en*cn,300);return a-An*((Pt+Ot*Lt*Bt)*Math.sinh(mn)+en*Bt*Math.cosh(mn))/en}}}return _t(),{next:function(Pt){var Bt=wt(Pt);if(Ct)nt.done=Pt>=vt;else{var Ot=1e3*xt(Pt),Lt=Math.abs(Ot)<=d,qt=Math.abs(a-Bt)<=_;nt.done=Lt&&qt}return nt.value=nt.done?a:Bt,nt},flipTarget:function(){var Pt;gt=-gt,i=(Pt=[a,i])[0],a=Pt[1],_t()}}}I0.needsInterpolation=function(c,e){return typeof c=="string"||typeof e=="string"};var Uy=function(c){return 0},sE=function(c,e,i){var s=e-c;return s===0?1:(i-c)/s},x_=function(c,e,i){return-i*c+i*e+c},Fy=function(c,e){return function(i){return Math.max(Math.min(i,e),c)}},b_=function(c){return c%1?Number(c.toFixed(5)):c},hx=/(-)?([\d]*\.?[\d])+/g,dx=/(#[0-9a-f]{6}|#[0-9a-f]{3}|#(?:[0-9a-f]{2}){2,4}|(rgb|hsl)a?\((-?[\d\.]+%?[,\s]+){2,3}\s*\/*\s*[\d\.]+%?\))/gi,pT=/^(#[0-9a-f]{3}|#(?:[0-9a-f]{2}){2,4}|(rgb|hsl)a?\((-?[\d\.]+%?[,\s]+){2,3}\s*\/*\s*[\d\.]+%?\))$/i;function jy(c){return typeof c=="string"}var kA={test:function(c){return typeof c=="number"},parse:parseFloat,transform:function(c){return c}},px=lo(lo({},kA),{transform:Fy(0,1)}),oE=(lo(lo({},kA),{default:1}),function(c,e){return function(i){return Boolean(jy(i)&&pT.test(i)&&i.startsWith(c)||e&&Object.prototype.hasOwnProperty.call(i,e))}}),cC=function(c,e,i){return function(s){var a;if(!jy(s))return s;var h=s.match(hx),d=h[0],_=h[1],et=h[2],nt=h[3];return(a={})[c]=parseFloat(d),a[e]=parseFloat(_),a[i]=parseFloat(et),a.alpha=nt!==void 0?parseFloat(nt):1,a}},fT=Fy(0,255),aE=lo(lo({},kA),{transform:function(c){return Math.round(fT(c))}}),OA={test:oE("rgb","red"),parse:cC("red","green","blue"),transform:function(c){var e=c.red,i=c.green,s=c.blue,a=c.alpha,h=a===void 0?1:a;return"rgba("+aE.transform(e)+", "+aE.transform(i)+", "+aE.transform(s)+", "+b_(px.transform(h))+")"}},uC={test:oE("#"),parse:function(c){var e="",i="",s="",a="";return c.length>5?(e=c.substr(1,2),i=c.substr(3,2),s=c.substr(5,2),a=c.substr(7,2)):(e=c.substr(1,1),i=c.substr(2,1),s=c.substr(3,1),a=c.substr(4,1),e+=e,i+=i,s+=s,a+=a),{red:parseInt(e,16),green:parseInt(i,16),blue:parseInt(s,16),alpha:a?parseInt(a,16)/255:1}},transform:OA.transform},mT=function(c){return{test:function(e){return jy(e)&&e.endsWith(c)&&e.split(" ").length===1},parse:parseFloat,transform:function(e){return""+e+c}}},zy=mT("%"),E_=(lo(lo({},zy),{parse:function(c){return zy.parse(c)/100},transform:function(c){return zy.transform(100*c)}}),{test:oE("hsl","hue"),parse:cC("hue","saturation","lightness"),transform:function(c){var e=c.hue,i=c.saturation,s=c.lightness,a=c.alpha,h=a===void 0?1:a;return"hsla("+Math.round(e)+", "+zy.transform(b_(i))+", "+zy.transform(b_(s))+", "+b_(px.transform(h))+")"}}),Vy=function(c,e,i){var s=c*c,a=e*e;return Math.sqrt(Math.max(0,i*(a-s)+s))},gT=[uC,OA,E_],vT=function(c){return gT.find(function(e){return e.test(c)})},Qy=function(c,e){var i=vT(c),s=vT(e);i.transform,s.transform;var a=i.parse(c),h=s.parse(e),d=lo({},a),_=i===E_?x_:Vy;return function(et){for(var nt in d)nt!=="alpha"&&(d[nt]=_(a[nt],h[nt],et));return d.alpha=x_(a.alpha,h.alpha,et),i.transform(d)}},LA=function(c){return OA.test(c)||uC.test(c)||E_.test(c)},_T=function(c){return OA.test(c)?OA.parse(c):E_.test(c)?E_.parse(c):uC.parse(c)},AT=function(c){return jy(c)?c:c.hasOwnProperty("red")?OA.transform(c):E_.transform(c)},fx="${c}",Gy="${n}";function hC(c){var e=[],i=0,s=c.match(dx);s&&(i=s.length,c=c.replace(dx,fx),e.push.apply(e,s.map(_T)));var a=c.match(hx);return a&&(c=c.replace(hx,Gy),e.push.apply(e,a.map(kA.parse))),{values:e,numColors:i,tokenised:c}}function Ju(c){return hC(c).values}function dC(c){var e=hC(c),i=e.values,s=e.numColors,a=e.tokenised,h=i.length;return function(d){for(var _=a,et=0;et<h;et++)_=_.replace(et<s?fx:Gy,et<s?AT(d[et]):b_(d[et]));return _}}var yT=function(c){return typeof c=="number"?0:c},pC={test:function(c){var e,i,s,a;return isNaN(c)&&jy(c)&&((i=(e=c.match(hx))===null||e===void 0?void 0:e.length)!==null&&i!==void 0?i:0)+((a=(s=c.match(dx))===null||s===void 0?void 0:s.length)!==null&&a!==void 0?a:0)>0},parse:Ju,createTransformer:dC,getAnimatableNone:function(c){var e=Ju(c);return dC(c)(e.map(yT))}},fC={x:0,y:0,z:0},Hy=function(c){return typeof c=="number"},S_=function(c,e){return function(i){return e(c(i))}},lE=function(){for(var c=[],e=0;e<arguments.length;e++)c[e]=arguments[e];return c.reduce(S_)};function mC(c,e){return Hy(c)?function(i){return x_(c,e,i)}:LA(c)?Qy(c,e):uE(c,e)}var _g=function(c,e){var i=function(h,d){for(var _=0,et=d.length,nt=h.length;_<et;_++,nt++)h[nt]=d[_];return h}([],c),s=i.length,a=c.map(function(h,d){return mC(h,e[d])});return function(h){for(var d=0;d<s;d++)i[d]=a[d](h);return i}},wT=function(c,e){var i=lo(lo({},c),e),s={};for(var a in i)c[a]!==void 0&&e[a]!==void 0&&(s[a]=mC(c[a],e[a]));return function(h){for(var d in s)i[d]=s[d](h);return i}};function cE(c){for(var e=pC.parse(c),i=e.length,s=0,a=0,h=0,d=0;d<i;d++)s||typeof e[d]=="number"?s++:e[d].hue!==void 0?h++:a++;return{parsed:e,numNumbers:s,numRGB:a,numHSL:h}}var uE=function(c,e){var i=pC.createTransformer(e),s=cE(c),a=cE(e);return lE(_g(s.parsed,a.parsed),i)},gC=function(c,e){return function(i){return x_(c,e,i)}};function Wy(c,e,i){var s=i===void 0?{}:i,a=s.clamp,h=a===void 0||a,d=s.ease,_=s.mixer,et=c.length;e.length,!d||!Array.isArray(d)||d.length,c[0]>c[et-1]&&(c=[].concat(c),e=[].concat(e),c.reverse(),e.reverse());var nt=function(lt,ut,pt){for(var gt=[],vt=pt||(typeof(Pt=lt[0])=="number"?gC:typeof Pt=="string"?LA(Pt)?Qy:uE:Array.isArray(Pt)?_g:typeof Pt=="object"?wT:void 0),Ct=lt.length-1,wt=0;wt<Ct;wt++){var xt=vt(lt[wt],lt[wt+1]);if(ut){var _t=Array.isArray(ut)?ut[wt]:ut;xt=lE(_t,xt)}gt.push(xt)}var Pt;return gt}(e,d,_),it=et===2?function(lt,ut){var pt=lt[0],gt=lt[1],vt=ut[0];return function(Ct){return vt(sE(pt,gt,Ct))}}(c,nt):function(lt,ut){var pt=lt.length,gt=pt-1;return function(vt){var Ct=0,wt=!1;if(vt<=lt[0]?wt=!0:vt>=lt[gt]&&(Ct=gt-1,wt=!0),!wt){for(var xt=1;xt<pt&&!(lt[xt]>vt||xt===gt);xt++);Ct=xt-1}var _t=sE(lt[Ct],lt[Ct+1],vt);return ut[Ct](_t)}}(c,nt);return h?function(lt){return it(RA(c[0],c[et-1],lt))}:it}function hE(c,e){return c.map(function(){return e||ax}).splice(0,c.length-1)}function qy(c){var e=c.from,i=e===void 0?0:e,s=c.to,a=s===void 0?1:s,h=c.ease,d=c.offset,_=c.duration,et=_===void 0?300:_,nt={done:!1,value:i},it=Array.isArray(a)?a:[i,a],lt=function(gt,vt){return gt.map(function(Ct){return Ct*vt})}(d&&d.length===it.length?d:function(gt){var vt=gt.length;return gt.map(function(Ct,wt){return wt!==0?wt/(vt-1):0})}(it),et);function ut(){return Wy(lt,it,{ease:Array.isArray(h)?h:hE(it,h)})}var pt=ut();return{next:function(gt){return nt.value=pt(gt),nt.done=gt>=et,nt},flipTarget:function(){it.reverse(),pt=ut()}}}function vC(c){var e=c.velocity,i=e===void 0?0:e,s=c.from,a=s===void 0?0:s,h=c.power,d=h===void 0?.8:h,_=c.timeConstant,et=_===void 0?350:_,nt=c.restDelta,it=nt===void 0?.5:nt,lt=c.modifyTarget,ut={done:!1,value:a},pt=d*i,gt=a+pt,vt=lt===void 0?gt:lt(gt);return vt!==gt&&(pt=vt-a),{next:function(Ct){var wt=-pt*Math.exp(-Ct/et);return ut.done=!(wt>it||wt<-it),ut.value=ut.done?vt:vt+wt,ut},flipTarget:function(){}}}var xT={keyframes:qy,spring:I0,decay:vC},bT=1/60*1e3,ET=typeof performance<"u"?function(){return performance.now()}:function(){return Date.now()},ST=typeof window<"u"?function(c){return window.requestAnimationFrame(c)}:function(c){return setTimeout(function(){return c(ET())},bT)},Hp=!0,C_=!1,dE=!1,NA={delta:0,timestamp:0},UA=["read","update","preRender","render","postRender"],mx=UA.reduce(function(c,e){return c[e]=function(i){var s=[],a=[],h=0,d=!1,_=new WeakSet,et={schedule:function(nt,it,lt){it===void 0&&(it=!1),lt===void 0&&(lt=!1);var ut=lt&&d,pt=ut?s:a;return it&&_.add(nt),pt.indexOf(nt)===-1&&(pt.push(nt),ut&&d&&(h=s.length)),nt},cancel:function(nt){var it=a.indexOf(nt);it!==-1&&a.splice(it,1),_.delete(nt)},process:function(nt){var it;if(d=!0,s=(it=[a,s])[0],(a=it[1]).length=0,h=s.length)for(var lt=0;lt<h;lt++){var ut=s[lt];ut(nt),_.has(ut)&&(et.schedule(ut),i())}d=!1}};return et}(function(){return C_=!0}),c},{}),_C=UA.reduce(function(c,e){var i=mx[e];return c[e]=function(s,a,h){return a===void 0&&(a=!1),h===void 0&&(h=!1),C_||gx(),i.schedule(s,a,h)},c},{}),AC=UA.reduce(function(c,e){return c[e]=mx[e].cancel,c},{}),CT=function(c){return mx[c].process(NA)},yC=function(c){C_=!1,NA.delta=Hp?bT:Math.max(Math.min(c-NA.timestamp,40),1),NA.timestamp=c,dE=!0,UA.forEach(CT),dE=!1,C_&&(Hp=!1,ST(yC))},gx=function(){C_=!0,Hp=!0,dE||ST(yC)},Yy=function(){return NA},wC=_C;function xC(c,e,i){return i===void 0&&(i=0),c-e-i}var pE=function(c){var e=function(i){var s=i.delta;return c(s)};return{start:function(){return wC.update(e,!0)},stop:function(){return AC.update(e)}}};function Xy(c){var e,i,s,a,h,d=c.from,_=c.autoplay,et=_===void 0||_,nt=c.driver,it=nt===void 0?pE:nt,lt=c.elapsed,ut=lt===void 0?0:lt,pt=c.repeat,gt=pt===void 0?0:pt,vt=c.repeatType,Ct=vt===void 0?"loop":vt,wt=c.repeatDelay,xt=wt===void 0?0:wt,_t=c.onPlay,Pt=c.onStop,Bt=c.onComplete,Ot=c.onRepeat,Lt=c.onUpdate,qt=y_(c,["from","autoplay","driver","elapsed","repeat","repeatType","repeatDelay","onPlay","onStop","onComplete","onRepeat","onUpdate"]),en=qt.to,cn=0,An=qt.duration,mn=!1,Tn=!0,vn=function(Un){if(Array.isArray(Un.to))return qy;if(xT[Un.type])return xT[Un.type];var Mn=new Set(Object.keys(Un));return Mn.has("ease")||Mn.has("duration")&&!Mn.has("dampingRatio")?qy:Mn.has("dampingRatio")||Mn.has("stiffness")||Mn.has("mass")||Mn.has("damping")||Mn.has("restSpeed")||Mn.has("restDelta")?I0:qy}(qt);!((i=(e=vn).needsInterpolation)===null||i===void 0)&&i.call(e,d,en)&&(h=Wy([0,100],[d,en],{clamp:!1}),d=0,en=100);var xn=vn(lo(lo({},qt),{from:d,to:en}));return et&&(_t==null||_t(),(s=it(function(Un){if(Tn||(Un=-Un),ut+=Un,!mn){var Mn=xn.next(Math.max(0,ut));a=Mn.value,h&&(a=h(a)),mn=Tn?Mn.done:ut<=0}Lt==null||Lt(a),mn&&(cn===0&&(An!=null||(An=ut)),cn<gt?function(Gn,rr,dr,_i){return _i?Gn>=rr+dr:Gn<=-dr}(ut,An,xt,Tn)&&(cn++,Ct==="reverse"?ut=function(Gn,rr,dr,_i){return dr===void 0&&(dr=0),_i===void 0&&(_i=!0),_i?xC(rr+-Gn,rr,dr):rr-(Gn-rr)+dr}(ut,An,xt,Tn=cn%2==0):(ut=xC(ut,An,xt),Ct==="mirror"&&xn.flipTarget()),mn=!1,Ot&&Ot()):(s.stop(),Bt&&Bt()))})).start()),{stop:function(){Pt==null||Pt(),s.stop()}}}const vx={linear:nE,easeIn:T0,easeOut:hT,easeInOut:ax,circIn:iE,circOut:sC,circInOut:dT,backIn:rE,backOut:oC,backInOut:aC,anticipate:lx,bounceOut:A_,bounceIn:lC,bounceInOut:cx,easeInOutSine:function(c){return-(Math.cos(Math.PI*c)-1)/2}};async function Vl(c){return new Promise(e=>setTimeout(e,Math.max(0,c)))}function _x(c,e,i){const s=c[e],a=()=>{typeof(c==null?void 0:c.setDirty)=="function"&&c.setDirty(),i==null||i()};return s.isVector3||s.isVector2||s.isVector4?h=>{s.copy(h),a()}:h=>{c[e]=h,a()}}function fE(c){return typeof c!="boolean"}async function mE(c,e,i){e in c||console.error("invalid key",e,c);const s=_x(c,e),a=c[e],h=d=>{var _;s(d),(_=i.onUpdate)===null||_===void 0||_.call(i,d)};if(fE(a))return typeof i.to=="function"&&(i={...i,to:i.to(a,c)}),Ky({...i,from:a,onUpdate:h});{const{duration:d}=i;return Vl(d??0).then(()=>h(i.to))}}async function Ky(c){return new Promise((e,i)=>{Xy({onComplete:()=>{var s;(s=c.onComplete)===null||s===void 0||s.call(c),e()},onStop:()=>{var s;(s=c.onStop)===null||s===void 0||s.call(c),e()},...c})})}async function Vv(c,e){const i=c.onComplete,s=c.onStop;return c={...c},new Promise((a,h)=>{c.onComplete=()=>{i==null||i(),a()},c.onStop=()=>{s==null||s(),a()};const d=Xy(c);e.push(d)})}class ev extends Am{constructor(){super(),this.passId="frameFade",this._fadeTime=0,this._fadeTimeState=0,this._toSaveFrame=!1,this._beforeFilters=["progressive","taa"],this._afterFilters=["render"],this._requiredFilters=["render","progressive"],this.dependencies=[Bu],this.fadeOnActiveCameraChange=!0,this.fadeOnMaterialUpdate=!0,this.fadeOnSceneUpdate=!0,this.pointerEnabled=!0,this._fadeCam=e=>e.frameFade!==!1&&this.fadeOnActiveCameraChange&&this.startTransition(1e3),this._fadeMat=e=>{e.frameFade!==!1&&this.fadeOnMaterialUpdate&&this.startTransition(200)},this._fadeScene=e=>{e.frameFade!==!1&&this.fadeOnSceneUpdate&&this.startTransition(500)},this._onPointerMove=e=>{var i;const s=(i=this._viewer)===null||i===void 0?void 0:i.canvas;if(!s)return void(this.pointerEnabled=!1);if(!e.buttons||e.target!==s)return void(this.pointerEnabled=!0);const a=s.getBoundingClientRect(),h=(e.clientX-a.left)/a.width,d=(e.clientY-a.top)/a.height;this.pointerEnabled=h<0||h>1||d<0||d>1},this._disabledBy=[],this.startTransition=this.startTransition.bind(this),this.stopTransition=this.stopTransition.bind(this),this._fadeCam=this._fadeCam.bind(this),this._fadeMat=this._fadeMat.bind(this)}async startTransition(e){this._viewer&&this._pass&&!this.isDisabled()&&(this._target||(this._target=this._viewer.renderer.getTempTarget({sizeMultiplier:1,minFilter:b.wem,magFilter:b.wem,encoding:this._viewer.renderer.composerTarget.texture.encoding})),this._fadeTimeState=Math.max(e,this._fadeTimeState),this._fadeTime=this._fadeTimeState,this._toSaveFrame=!0,this.setDirty(),await Vl(e))}stopTransition(){this._fadeTimeState=0}async onAdded(e){await super.onAdded(e),e.scene.addEventListener("activeCameraChange",this._fadeCam),e.scene.addEventListener("activeCameraUpdate",this.stopTransition),e.scene.addEventListener("sceneMaterialUpdate",this._fadeMat),e.scene.addEventListener("sceneUpdate",this._fadeScene),window.addEventListener("pointermove",this._onPointerMove)}async onRemove(e){return e.scene.removeEventListener("activeCameraChange",this._fadeCam),e.scene.removeEventListener("activeCameraUpdate",this.stopTransition),e.scene.removeEventListener("sceneMaterialUpdate",this._fadeMat),e.scene.removeEventListener("sceneUpdate",this._fadeScene),window.removeEventListener("pointermove",this._onPointerMove),super.onRemove(e)}passCtor(e){const i=this,s=e.getPlugin(Bu),a=new class extends KS{constructor(){super(...arguments),this._lastTime=0,this.uiConfig=o0("Frame Fade",this)}render(h,d,_,et,nt){this.needsSwap=!1;const it=i._target;if(!it||!i.pointerEnabled||!this.enabled||!i.dirty||i._fadeTimeState<.001)return;i._toSaveFrame&&s.lastFrame&&(e.renderer.blit(s.lastFrame.texture,it),this._lastTime=0,i._toSaveFrame=!1),this.blendTexture=it==null?void 0:it.texture;const lt=i._fadeTimeState/i._fadeTime;this.weights2.setScalar(lt),this.weights2.w=1,this.weights1.setScalar(1-lt),this.weights1.w=1,super.render(h,d,_,et,nt),this.needsSwap=!0;const ut=Yu();this._lastTime<10&&(this._lastTime=ut-10);const pt=ut-this._lastTime;this._lastTime=ut,i._fadeTimeState-=pt}};return a.enabled=!0,a}setDirty(){var e;this.enabled&&((e=this._viewer)===null||e===void 0||e.setDirty())}get dirty(){return this.enabled&&this._fadeTimeState>0}set dirty(e){console.warn("FrameFadePlugin.dirty is readonly")}_update(e){return!!super._update(e)&&(this.isDisabled()&&this.stopTransition(),this._fadeTimeState<.001&&(this._toSaveFrame=!1,this._target&&this._viewer&&(this._viewer.renderer.releaseTempTarget(this._target),this._target=void 0)),!0)}get uiConfig(){var e,i;return(i=(e=this.pass)===null||e===void 0?void 0:e.passObject)===null||i===void 0?void 0:i.uiConfig}disable(e){this._disabledBy.includes(e)||this._disabledBy.push(e)}enable(e){const i=this._disabledBy.indexOf(e);i>=0&&this._disabledBy.splice(i,1)}isDisabled(){return!this.pointerEnabled||this._disabledBy.length>0||!this.enabled}}ev.PluginType="FrameFade";var Jy=function(c,e,i,s){var a,h=arguments.length,d=h<3?e:s===null?s=Object.getOwnPropertyDescriptor(e,i):s;if(typeof Reflect=="object"&&typeof Reflect.decorate=="function")d=Reflect.decorate(c,e,i,s);else for(var _=c.length-1;_>=0;_--)(a=c[_])&&(d=(h<3?a(d):h>3?a(e,i,d):a(e,i))||d);return h>3&&d&&Object.defineProperty(e,i,d),d},FA=b.M8C.degToRad;class ro extends Ls{constructor(e=ox,i=!1,s=!0,a=!1){super(),this.enabled=!0,this._enableWidget=!1,this.autoFocus=!1,this._onObjectHit=h=>{this._viewer&&(this.enabled?this.dispatchEvent(h):h.intersects.selectedObject=null)},this._uiConfigChildren=[{label:"Enabled",type:"checkbox",property:[this,"enabled"]},{label:"AutoFocus",type:"checkbox",property:[this,"autoFocus"],onChange:()=>{const h=this.getSelectedObject();this.autoFocus&&h&&this.setSelectedObject(h,!0)}}],e&&(this._widget=new e),this._controls=i,this._pickUi=s,this.autoFocus=a}get picker(){return this._picker}setDirty(){var e;(e=this._viewer)===null||e===void 0||e.setDirty()}getSelectedObject(){var e;if(this.enabled)return((e=this._picker)===null||e===void 0?void 0:e.selectedObject)||void 0}setSelectedObject(e,i=!1){if(!this.enabled||!this._picker)return;const s=this.autoFocus;this.autoFocus=!1,this._picker.selectedObject=e||null,this.autoFocus=s,(s||i)&&this.focusObject(e)}async onAdded(e){await super.onAdded(e),this._picker=new $M(e.scene,e.canvas,void 0,i=>{var s,a;if(!i.material)return!1;let h=i,d=!1;for(;h;){if(!h.visible||(((s=h.userData.iModel)!==null&&s!==void 0?s:h).assetType==="model"&&(d=!0),((a=h.userData.iModel)!==null&&a!==void 0?a:h).assetType==="widget")||h.userData.userSelectable===!1||h.userData.bboxVisible===!1)return!1;h=h.parent}return d}),this._widget&&e.scene.addWidget(this._widget),this._transformControls=new Qv(e),this._transformControls.enabled=this._controls,this._picker.addEventListener("selectedObjectChanged",i=>{var s,a,h,d;this.dispatchEvent(i);const _=((s=this._picker)===null||s===void 0?void 0:s.selectedObject)||void 0;if(this._pickUi){const it=(a=_)===null||a===void 0?void 0:a.uiConfig,lt=this.uiConfig;lt.children=[...this._uiConfigChildren],it&&lt.children.push(it),(h=lt.uiRefresh)===null||h===void 0||h.call(lt)}const et=this._widget;et&&this._enableWidget&&(_?et.attach(_):et.detach());const nt=this._transformControls;nt&&(!((d=this._viewer)===null||d===void 0)&&d.scene.activeCamera.controls)&&(_&&nt.enabled?nt.attach(_):nt.detach()),e.setDirty(),this.autoFocus&&this.focusObject(_)}),this._picker.addEventListener("hoverObjectChanged",this.dispatchEvent),this._picker.addEventListener("hitObject",this._onObjectHit),e.scene.addEventListener("select",i=>{i.value===void 0?console.warn("e.value must be set for picking, can be null to unselect"):this.setSelectedObject(i.value,this.autoFocus||i.focusCamera)}),e.scene.addEventListener("addSceneObject",async i=>{var s,a,h;const d=i.object,_=this.getSelectedObject();if(_&&(d==null?void 0:d.assetType)==="material"&&typeof(_==null?void 0:_.setMaterial)=="function"&&(!((s=_==null?void 0:_.modelObject)===null||s===void 0)&&s.isMesh)&&await e.confirm("Applying material: Apply material to the selected object?")){const et=_.material;if(Array.isArray(et))console.warn("Dropping on material array not yet fully supported."),_.setMaterial(d);else{let nt=Array.from((a=et==null?void 0:et.userData.__appliedMeshes)!==null&&a!==void 0?a:[]);(nt.length>1?!await e.confirm("Applying material: Apply to all objects using this material?"):nt.length<1)&&(nt=[_]);for(const it of nt)it&&((h=it.setMaterial)===null||h===void 0||h.call(it,d))}}}),e.scene.addEventListener("sceneUpdate",i=>{if(!i.hierarchyChanged)return;const s=this.getSelectedObject();let a=!1;s==null||s.traverseAncestors(h=>{h===e.scene.modelObject&&(a=!0)}),a||this.setSelectedObject(void 0)})}async focusObject(e){var i,s,a,h;const d=(i=this._viewer)===null||i===void 0?void 0:i.getPluginByType("CameraViews");await(d==null?void 0:d.animateToObject(e,4,1e3,"easeOut",{min:((h=(a=(s=this._viewer)===null||s===void 0?void 0:s.scene.activeCamera.getControls())===null||a===void 0?void 0:a.minDistance)!==null&&h!==void 0?h:.5)+.5,max:5}))}enableWidget(e){var i,s,a;if(this._enableWidget=e,e){const h=((i=this._picker)===null||i===void 0?void 0:i.selectedObject)||void 0;h&&((s=this._widget)===null||s===void 0||s.attach(h))}else(a=this._widget)===null||a===void 0||a.detach()}get uiConfig(){return this._pickUi?this._uiConfig?this._uiConfig:this._uiConfig={type:"panel",label:"Picker",expanded:!0,children:[...this._uiConfigChildren]}:{}}get transformControls(){return this._transformControls}get widget(){return this._widget}}ro.PluginType="Picking",Jy([Fn()],ro.prototype,"enabled",void 0),Jy([Fn()],ro.prototype,"autoFocus",void 0);class Qv extends uD{constructor(e){super(e.scene.activeCamera.cameraObject,e.canvas),this.modelObject=this,this.assetType="widget",this._activeCameraChange=this._activeCameraChange.bind(this),this._scene=e.scene,this._scene.addEventListener("activeCameraChange",this._activeCameraChange),this.visible=!1,this.userData.bboxVisible=!1,this.addEventListener("objectChange",()=>{var i;(i=this==null?void 0:this.object)===null||i===void 0||i.dispatchEvent({type:"objectUpdate",fadeFrame:!1})}),this.addEventListener("dragging-changed",i=>{const s=e==null?void 0:e.getPlugin(ev);s&&(s.enabled=!i.value),this._scene.activeCamera.interactionsEnabled=!i.value}),this._keyDownListener=this._keyDownListener.bind(this),window.addEventListener("keydown",this._keyDownListener),window.addEventListener("keyup",this._keyUpListener),this._scene.addWidget(this)}_keyDownListener(e){if(this.enabled&&this.object){switch(e.keyCode){case 81:this.setSpace(this.space==="local"?"world":"local");break;case 16:this.setTranslationSnap(100),this.setRotationSnap(FA(15)),this.setScaleSnap(.25);break;case 87:this.setMode("translate");break;case 69:this.setMode("rotate");break;case 82:this.setMode("scale");break;case 187:case 107:this.setSize(this.size+.1);break;case 189:case 109:this.setSize(Math.max(this.size-.1,.1));break;case 88:this.showX=!this.showX;break;case 89:this.showY=!this.showY;break;case 90:this.showZ=!this.showZ;break;case 32:this.enabled=!this.enabled;break;default:return}this._scene.setDirty({sceneUpdate:!0,frameFade:!0})}}_keyUpListener(e){this.enabled&&(e.keyCode===16&&(this.setTranslationSnap(null),this.setRotationSnap(null),this.setScaleSnap(null)),this.object&&e.keyCode)}_activeCameraChange(){this.camera=this._scene.activeCamera.cameraObject}dispose(){window.removeEventListener("keydown",this._keyDownListener),window.removeEventListener("keyup",this._keyUpListener),this._scene.removeEventListener("activeCameraChange",this._activeCameraChange),this._scene.modelObject.remove(this),super.dispose()}}var Zy=function(c,e,i,s){var a,h=arguments.length,d=h<3?e:s===null?s=Object.getOwnPropertyDescriptor(e,i):s;if(typeof Reflect=="object"&&typeof Reflect.decorate=="function")d=Reflect.decorate(c,e,i,s);else for(var _=c.length-1;_>=0;_--)(a=c[_])&&(d=(h<3?a(d):h>3?a(e,i,d):a(e,i))||d);return h>3&&d&&Object.defineProperty(e,i,d),d};class Dl extends Ls{constructor(){super(),this.offsetCache={},this.enabled=!0,this.envMap=null,this.forceSceneEnvMap=!1,this.getEnvMap=()=>{var e;return!this.forceSceneEnvMap&&this.envMap?this.envMap:((e=this._viewer)===null||e===void 0?void 0:e.scene.getEnvironment())||null},this._modelProcessor={forAssetType:"model",processAsync:async(e,i)=>{const s=[];return e.modelObject.traverse(a=>{var h,d,_,et;const nt=(d=(h=a.userData)===null||h===void 0?void 0:h.gltfExtensions)===null||d===void 0?void 0:d[Dl.DIAMOND_GLTF_EXTENSION];nt&&a.geometry&&(this.prepareDiamondMesh(a,nt),delete a.userData.gltfExtensions[Dl.DIAMOND_GLTF_EXTENSION]),a.material&&!s.includes(a.material)&&(!((et=(_=a.material.userData)===null||_===void 0?void 0:_.gltfExtensions)===null||et===void 0)&&et[Dl.DIAMOND_GLTF_EXTENSION])&&(a.material.materialObject||console.warn("material not processed",a.material),s.push(a.material))}),s.forEach(a=>{const h=a.userData.gltfExtensions[Dl.DIAMOND_GLTF_EXTENSION];h&&this._convertToDiamondMaterial(a,h)}),e}},this.uiConfig={type:"folder",label:"Diamonds",children:[{type:"toggle",label:"Use Scene Environment",property:[this,"forceSceneEnvironment"],limitedUi:!0},{type:"image",label:"Environment",hidden:()=>this.forceSceneEnvMap,property:[this,"envMap"],limitedUi:!0},{type:"slider",bounds:[0,2*Math.PI],hidden:()=>this.forceSceneEnvMap,label:"Env Rotation",property:[this,"envMapRotation"],limitedUi:!0},{type:"button",label:"Make Diamond",hidden:()=>{var e,i,s;const a=(s=(i=(e=this._viewer)===null||e===void 0?void 0:e.getPlugin(ro))===null||i===void 0?void 0:i.getSelectedObject())===null||s===void 0?void 0:s.material;return!!Array.isArray(a)||(a==null?void 0:a.typeSlug)!==Tu.TypeSlug},value:async()=>{var e,i,s,a,h,d;const _=(i=(e=this._viewer)===null||e===void 0?void 0:e.getPlugin(ro))===null||i===void 0?void 0:i.getSelectedObject();if(!(_!=null&&_.material))return;const et=await((s=this._viewer)===null||s===void 0?void 0:s.prompt("Cache key: Enter optional cache key unique to the diamond shape.","",!1));let nt=parseInt(await((a=this._viewer)===null||a===void 0?void 0:a.prompt("Cache size: Enter size of the cache [64-1024]","512",!1))||"512");isFinite(nt)||(nt=512),nt<64&&(nt=64),((h=_.material.userData)===null||h===void 0?void 0:h.__appliedMeshes.size)>1&&await((d=this._viewer)===null||d===void 0?void 0:d.confirm("Convert all: Apply diamond material to all the meshes with the same material?"))?this.makeDiamond(_.material,{cacheKey:et||void 0,normalMapRes:nt},{}):this.makeDiamondMesh(_,{cacheKey:et||void 0,normalMapRes:nt},{}),this.refreshUi()},limitedUi:!0},{type:"button",label:"Make Standard",hidden:()=>{var e,i,s;const a=(s=(i=(e=this._viewer)===null||e===void 0?void 0:e.getPlugin(ro))===null||i===void 0?void 0:i.getSelectedObject())===null||s===void 0?void 0:s.material;return!!Array.isArray(a)||(a==null?void 0:a.typeSlug)!==Fo.TypeSlug},value:async()=>{var e,i,s,a,h,d,_,et;const nt=(i=(e=this._viewer)===null||e===void 0?void 0:e.getPlugin(ro))===null||i===void 0?void 0:i.getSelectedObject(),it=nt==null?void 0:nt.material;if(!it)return;const lt=it.userData._baseMaterial;let ut=(h=(a=(s=this._viewer)===null||s===void 0?void 0:s.getManager())===null||a===void 0?void 0:a.materials)===null||h===void 0?void 0:h.findMaterial(lt);if(ut&&!ut.isDiamondMaterial||(ut=(d=this._viewer)===null||d===void 0?void 0:d.createPhysicalMaterial({color:it.color})),ut){const pt=it.userData.__appliedMeshes.size>1&&await((_=this._viewer)===null||_===void 0?void 0:_.confirm("Convert all with this material?"))?Array.from(it.userData.__appliedMeshes):[nt];for(const gt of pt)(et=gt==null?void 0:gt.setMaterial)===null||et===void 0||et.call(gt,ut)}this.refreshUi()},limitedUi:!0}]},this.refreshEnvMaps=this.refreshEnvMaps.bind(this),this.refreshUi=this.refreshUi.bind(this)}get envMapRotation(){var e,i;return(i=(e=this.envMap)===null||e===void 0?void 0:e.rotation)!==null&&i!==void 0?i:0}set envMapRotation(e){var i;const s=this.envMap;s&&(s.rotation=e,(i=this._viewer)===null||i===void 0||i.scene.setDirty())}refreshEnvMaps(){var e,i,s;if(!this._viewer)return;const a=this.getEnvMap(),h=((i=(e=this._viewer.getPlugin(qr))===null||e===void 0?void 0:e.materials)===null||i===void 0?void 0:i.getMaterialsOfType(Fo.TypeSlug))||[];for(const d of h)d&&d.envMap!==a&&(d.envMap=a,d.needsUpdate=!0);(s=this._viewer)===null||s===void 0||s.scene.setDirty()}refreshUi(){var e,i,s;(e=this._viewer)===null||e===void 0||e.setDirty(),(s=(i=this.uiConfig)===null||i===void 0?void 0:i.uiRefresh)===null||s===void 0||s.call(i,"postFrame",!0)}async onAdded(e){var i,s,a,h,d,_;this._normalCapture=new YM(e.renderer),this.offsetCache={},e.scene.addEventListener("environmentChanged",this.refreshEnvMaps);const et=e.getPlugin(qr);(i=et==null?void 0:et.importer)===null||i===void 0||i.processors.add("model",this._modelProcessor),(s=e.getPlugin(ro))===null||s===void 0||s.addEventListener("selectedObjectChanged",this.refreshUi);const nt=this.getEnvMap,it=new Wo(class extends op{async loadAsync(lt,ut){var pt;const gt=await super.loadAsync(lt,ut);return gt.type===Fo.TYPE||gt.isDiamondMaterialParameters?(gt.envMap=nt(),(pt=et==null?void 0:et.materials)===null||pt===void 0?void 0:pt.generateFromTemplate("diamond",gt)):(console.error("Invalid material type for Diamond Material.",gt),null)}},[Fo.TypeSlug],!1);return io.Importers.push(it),(d=(h=(a=et==null?void 0:et.exporter)===null||a===void 0?void 0:a.getExporter("gltf","glb"))===null||h===void 0?void 0:h.extensions)===null||d===void 0||d.push(gE),(_=et==null?void 0:et.materials)===null||_===void 0||_.registerMaterialTemplate({name:"diamond",materialType:Fo.TYPE,isDiamondMaterialParameters:!0,generator:(lt,ut)=>{const pt=new Fo(lt);return pt.envMap=nt(),ut&&ut!=={}&&pt.copyProps(ut),pt}}),super.onAdded(e)}async onRemove(e){var i,s,a,h;return(i=this._normalCapture)===null||i===void 0||i.dispose(),this._normalCapture=void 0,this.offsetCache={},(a=(s=e.getPlugin(qr))===null||s===void 0?void 0:s.importer)===null||a===void 0||a.processors.remove("model",this._modelProcessor),(h=e.getPlugin(ro))===null||h===void 0||h.removeEventListener("selectedObjectChanged",this.refreshUi),super.onRemove(e)}prepareDiamondMesh(e,{cacheKey:i,normalMapRes:s}){var a,h,d;e.userData._diamondCacheKey=i??e.userData._diamondCacheKey,e.userData._diamondNormalMapRes=s??e.userData._diamondNormalMapRes,i=i&&i.length>0?i.includes(";"+e.geometry.uuid)?i:i+";"+e.geometry.uuid:e.geometry.uuid,this._computeOffsets(e.geometry,e.geometry.uuid);const _=(h=(a=this._normalCapture)===null||a===void 0?void 0:a.captureNormalMap(e.geometry,i,s))!==null&&h!==void 0?h:[void 0,!1],et=(d=this._viewer)===null||d===void 0?void 0:d.getPluginByType("debug");et&&_&&(et.counters.normalsCapture||(et.counters.normalsCapture=0),et.counters.normalsCapture++,console.log("DEBUG: new normal map captured",et.counters.normalsCapture,i),et.addTexture("normal"+et.counters.normalsCapture,()=>{var nt;return(nt=e.geometry.userData._normalsCaptureMap)===null||nt===void 0?void 0:nt.texture},[40,110*et.counters.normalsCapture-100,200,100],void 0,void 0,"postRender",!0))}makeDiamond(e,i,s){var a,h;Array.from((a=e==null?void 0:e.userData.__appliedMeshes)!==null&&a!==void 0?a:[]).forEach(d=>{d!=null&&d.isMesh&&d.geometry&&this.prepareDiamondMesh(d,i)}),this._convertToDiamondMaterial(e,s),(h=this._viewer)===null||h===void 0||h.setDirty()}makeDiamondMesh(e,i,s){if(!e.modelObject.isMesh||!e.geometry||!e.setMaterial)return;this.prepareDiamondMesh(e.modelObject,i);const a=Array.isArray(e.material)?e.material[0]:e.material,h=this._convertToDiamondMaterial(a,s,!1);e.setMaterial(h)}_convertToDiamondMaterial(e,i={isDiamond:!0},s=!0){var a,h,d,_,et,nt,it;let lt={...i??{}};lt.isDiamond||lt.isDiamondMaterialParameters?Array.isArray(lt.boostFactors)&&(lt.boostFactors=new b.Pa4().fromArray(lt.boostFactors)):lt={isDiamondMaterialParameters:!0},lt.color=(d=(a=lt.color)!==null&&a!==void 0?a:(h=e==null?void 0:e.materialObject)===null||h===void 0?void 0:h.color)!==null&&d!==void 0?d:new mo(1,1,1);const ut=(nt=(et=(_=this._viewer)===null||_===void 0?void 0:_.getManager())===null||et===void 0?void 0:et.materials)===null||nt===void 0?void 0:nt.generateFromTemplate("diamond",lt);if(ut&&e&&!e.isDiamondMaterial&&(ut.userData._baseMaterial=e.uuid),s){const pt=gt=>{var vt;return(vt=gt.setMaterial)!==null&&vt!==void 0?vt:Ct=>{gt.material=Ct.materialObject}};Array.from((it=e==null?void 0:e.userData.__appliedMeshes)!==null&&it!==void 0?it:[]).forEach(gt=>{pt(gt)(ut),this.prepareDiamondMesh(gt,i)})}return ut}_computeOffsets(e,i,s=!1){const a=i.split(";").find(nt=>this.offsetCache[nt]);if(a&&!s){const nt=this.offsetCache[a];return i.split(";").forEach(it=>it!==a&&(this.offsetCache[it]=nt)),e.userData._normalsCaptureOffsets=nt,nt}e.computeBoundingBox();const h=e.boundingBox.getCenter(new b.Pa4),d=JM(e),_=d.clone().invert(),et={center:h,offsetMatrix:d,offsetMatrixInv:_,radius:1,centerOffset:new b.Pa4().copy(h).applyMatrix4(_)};return i.split(";").forEach(nt=>this.offsetCache[nt]=et),e.userData._normalsCaptureOffsets=et,et}}Dl.PluginType="Diamond",Dl.DIAMOND_GLTF_EXTENSION="WEBGI_materials_diamond",Zy([pn(Dl.prototype.refreshEnvMaps),Fn()],Dl.prototype,"envMap",void 0),Zy([pn(Dl.prototype.refreshEnvMaps),Fn()],Dl.prototype,"forceSceneEnvMap",void 0);const gE=c=>({writeMaterial:(e,i)=>{e.isDiamondMaterial&&(i.extensions=i.extensions||{},i.extensions[Dl.DIAMOND_GLTF_EXTENSION]=e.toJSON(),c.extensionsUsed[Dl.DIAMOND_GLTF_EXTENSION]=!0)},writeMesh:(e,i)=>{var s,a;if(!(e!=null&&e.material.isDiamondMaterial))return;i.extensions=i.extensions||{};const h={};(a=(s=e.userData)===null||s===void 0?void 0:s.gltfExtensions)===null||a===void 0||delete a[Dl.DIAMOND_GLTF_EXTENSION],e.userData._diamondNormalMapRes&&(h.normalMapRes=e.userData._diamondNormalMapRes),e.userData._diamondCacheKey&&(h.cacheKey=e.userData._diamondCacheKey),i.extensions[Dl.DIAMOND_GLTF_EXTENSION]=h,c.extensionsUsed[Dl.DIAMOND_GLTF_EXTENSION]=!0}});var tv,Zu=function(c,e,i,s){var a,h=arguments.length,d=h<3?e:s===null?s=Object.getOwnPropertyDescriptor(e,i):s;if(typeof Reflect=="object"&&typeof Reflect.decorate=="function")d=Reflect.decorate(c,e,i,s);else for(var _=c.length-1;_>=0;_--)(a=c[_])&&(d=(h<3?a(d):h>3?a(e,i,d):a(e,i))||d);return h>3&&d&&Object.defineProperty(e,i,d),d};let El=tv=class extends Ls{constructor(){super(),this.enabled=!0,this.animations=[],this.loopAnimations=!0,this.loopRepetitions=1/0,this.timeScale=0,this.animateOnScroll=!1,this.animationSpeed=1,this._scrollAnimationState=0,this.scrollAnimationDamping=.1,this.dependencies=[qr],this._lastFrameTime=0,this._fadeDisabled=!1,this._objectAdded=c=>{const e=c.object;e.assetType==="model"&&e.modelObject&&this._viewer&&e.modelObject.traverse(i=>{const s=i.animations;if(s.length<1)return;const a=Math.max(...s.map(_=>_.duration));s.forEach(_=>_.duration=a);const h=new b.Xcj(this._viewer.scene.modelRoot.modelObject),d=s.map(_=>h.clipAction(_).setLoop(this.loopAnimations?b.YKA:b.jAl,this.loopRepetitions));this.animations.push({mixer:h,clips:s,actions:d,duration:a}),this.onPropertyChange()})},this._animationTime=0,this._animationDuration=0,this._animationState="none",this.uiConfig=void 0,this._lastAnimId="",this.timelineMarkers=[],this._postFrame=this._postFrame.bind(this),this._wheel=this._wheel.bind(this),this.playClips=this.playClips.bind(this),this.playClip=this.playClip.bind(this),this.playAnimation=this.playAnimation.bind(this),this.playPauseAnimation=this.playPauseAnimation.bind(this),this.pauseAnimation=this.pauseAnimation.bind(this),this.stopAnimation=this.stopAnimation.bind(this),this.resetAnimation=this.resetAnimation.bind(this),this.onPropertyChange=this.onPropertyChange.bind(this),this._loaderCreate=this._loaderCreate.bind(this)}get animationState(){return this._animationState}get animationTime(){return this._animationTime}get animationDuration(){return this._animationDuration}_wheel({deltaY:c}){this.enabled&&Math.abs(c)>.001&&(this._scrollAnimationState=-1*Math.sign(c))}_postFrame(){var c,e;if(!this._viewer)return;const i=this._viewer,s=this.animateOnScroll;if(!this.enabled||this.animations.length<1||this._animationState!=="playing"&&!s)return this._lastFrameTime=0,void(this._fadeDisabled&&((c=this._viewer.getPluginByType("FrameFade"))===null||c===void 0||c.enable(tv.PluginType),this._fadeDisabled=!1));this._animationTime<1e-4&&this.dispatchEvent({type:"checkpointBegin"});const a=Yu()/1e3;this._lastFrameTime<1&&(this._lastFrameTime=a-1/30);let h=a-this._lastFrameTime;if(h*=this.animationSpeed,this._lastFrameTime=a,s&&(h*=this._scrollAnimationState),Math.abs(h)<1e-4)return;const d=(e=this._viewer.getPluginByType("Progressive"))===null||e===void 0?void 0:e.postFrameConvergedRecordingDelta();if(d&&d>0&&(h=d),d!==0){if(this.animations.map(_=>_.mixer.update(h)),this._animationTime+=h,this._scrollAnimationState<.001?this._scrollAnimationState=0:this._scrollAnimationState*=1-this.scrollAnimationDamping,i.scene.activeCamera.cameraObject.userData.__animatingCamera&&i.scene.activeCamera.setDirty(),i.renderer.resetShadows(),i.setDirty(),!this._fadeDisabled){const _=this._viewer.getPluginByType("FrameFade");_&&(_.disable(tv.PluginType),this._fadeDisabled=!0)}this._animationTime>=this._animationDuration&&this.dispatchEvent({type:"checkpointEnd"})}}_loaderCreate({loader:c}){c.isGLTFLoader2&&c.register(e=>new jA(e,this))}async onAdded(c){var e,i,s,a,h,d;(i=(e=c.getPlugin(qr))===null||e===void 0?void 0:e.importer)===null||i===void 0||i.addEventListener("loaderCreate",this._loaderCreate),c.scene.addEventListener("addSceneObject",this._objectAdded),(d=(h=(a=(s=c.getPlugin(qr))===null||s===void 0?void 0:s.exporter)===null||a===void 0?void 0:a.getExporter("gltf","glb"))===null||h===void 0?void 0:h.extensions)===null||d===void 0||d.push(MT),c.addEventListener("postFrame",this._postFrame),window.addEventListener("wheel",this._wheel);let _=-1;return Object.defineProperty(c.scene.modelRoot,"currentTimelineMarker",{get:()=>_,set:et=>c.scene.modelRoot.dispatchEvent({type:"animationTimelineMarker",marker:this.timelineMarkers[_=et]})}),c.scene.modelRoot.addEventListener("animationTimelineMarker",({marker:et})=>{var nt;if(!this._viewer)return;if(!et)return this._viewer.scene.activeCamera=(nt=this._viewer)===null||nt===void 0?void 0:nt.scene.defaultCamera,void this._viewer.setDirty();const it=et.camera;it&&(it.userData.__animatingCamera=!0,this._viewer.scene.activeCamera=this._viewer.createCamera(it))}),super.onAdded(c)}async onRemove(c){for(var e,i;this.animations.length;)this.animations.pop();return c.scene.removeEventListener("addSceneObject",this._objectAdded),(i=(e=c.getPlugin(qr))===null||e===void 0?void 0:e.importer)===null||i===void 0||i.addEventListener("loaderCreate",this._loaderCreate),c.removeEventListener("postFrame",this._postFrame),window.removeEventListener("wheel",this._wheel),super.onRemove(c)}onPropertyChange(){this._animationState==="playing"&&this.playAnimation(),this._animationDuration=Math.max(...this.animations.map(({duration:c})=>c))*(this.loopAnimations?this.loopRepetitions:1)}onStateChange(){var c,e;(e=(c=this.uiConfig)===null||c===void 0?void 0:c.children)===null||e===void 0||e.map(i=>i&&Yt(i)).flat(2).forEach(i=>{var s;return(s=i==null?void 0:i.uiRefresh)===null||s===void 0?void 0:s.call(i)})}playPauseAnimation(){this._animationState==="playing"?this.pauseAnimation():this.playAnimation()}async playClip(c,e=!1){return this.playClips([c],e)}async playClips(c,e=!1){const i=[];return this.animations.forEach(({actions:s})=>{s.forEach(a=>{c.includes(a.getClip().name)&&i.push(a)})}),this.playAnimation(e,i)}async playAnimation(c=!1,e){var i;if(!this.enabled)return;this._animationState==="playing"&&this.stopAnimation(!1);let s=0;const a=!e;e||(e=[],this.animations.forEach(({mixer:d,actions:_,clips:et})=>{e.push(..._)})),this._animationState!=="paused"&&this.resetAnimation();const h=gu();this._lastAnimId=h;for(const d of e)this.timeScale>0&&(d.timeScale=this.timeScale),d.setLoop(this.loopAnimations?b.YKA:b.jAl,this.loopRepetitions),d.play(),s=Math.max(s,d.getClip().duration/d.timeScale);if(this._animationState="playing",(i=this._viewer)===null||i===void 0||i.setDirty(),a){if(!isFinite(this._animationDuration))return;await new Promise((d,_)=>{const et=()=>{this.removeEventListener("checkpointEnd",et),d()};this.addEventListener("checkpointEnd",et)})}else{if(s*=this.loopAnimations?this.loopRepetitions:1,s/=this.animationSpeed,!isFinite(s))return;const d=1e3*s-this._animationTime/this.animationSpeed+.01;d>0&&await Vl(d)}h===this._lastAnimId&&this.stopAnimation(c)}pauseAnimation(){var c;this._animationState="paused",(c=this._viewer)===null||c===void 0||c.setDirty()}stopAnimation(c=!1){var e,i;this._animationState="stopped",c?this.resetAnimation():(e=this._viewer)===null||e===void 0||e.setDirty(),this._lastAnimId="",this._viewer&&this._fadeDisabled&&((i=this._viewer.getPluginByType("FrameFade"))===null||i===void 0||i.enable(tv.PluginType),this._fadeDisabled=!1)}resetAnimation(){var c;this._animationState==="stopped"||this._animationState==="none"?(this.animations.forEach(({mixer:e,actions:i,clips:s})=>{e.stopAllAction(),e.setTime(0)}),this._animationTime=0,(c=this._viewer)===null||c===void 0||c.setDirty()):this.stopAnimation(!0)}};El.PluginType="GLTFAnimation",El.AnimationMarkersExtension="WEBGI_animation_markers",Zu([r0()],El.prototype,"animationState",null),Zu([r0()],El.prototype,"animationTime",null),Zu([r0()],El.prototype,"animationDuration",null),Zu([pn(tv.prototype.onPropertyChange),ts("Loop",{limitedUi:!0})],El.prototype,"loopAnimations",void 0),Zu([pn(tv.prototype.onPropertyChange)],El.prototype,"loopRepetitions",void 0),Zu([pn(tv.prototype.onPropertyChange)],El.prototype,"timeScale",void 0),Zu([ts(),Fn()],El.prototype,"animateOnScroll",void 0),Zu([ss("Speed",[.1,4],.1,{limitedUi:!0}),Fn()],El.prototype,"animationSpeed",void 0),Zu([pn(tv.prototype.onStateChange)],El.prototype,"_animationState",void 0),Zu([uo("Play/Pause",c=>({label:()=>c.animationState==="playing"?"Pause":"Play",limitedUi:!0}))],El.prototype,"playPauseAnimation",null),Zu([uo("Stop",{limitedUi:!0})],El.prototype,"stopAnimation",null),Zu([uo("Reset",{limitedUi:!0})],El.prototype,"resetAnimation",null),El=tv=Zu([Ys("GLTF Animations")],El);class jA{constructor(e,i){this.parser=e,this.name=El.AnimationMarkersExtension,this.plugin=i}async afterRoot(e){var i;let s=[];for(const ut of this.parser.json.scenes){if(!ut.extensions)continue;const pt=ut.extensions[this.name];for(const gt of(pt==null?void 0:pt.markers)||[]){const vt=gt.camera!==void 0?await this.parser.getDependency("camera",gt.camera):void 0;gt.time===void 0&&(gt.time=gt.frame/30,console.error("Update timeline markers plugin for correct times.")),s.push({name:gt.name,frame:gt.frame,time:gt.time,camera:vt})}}if(s.length<1)return;s=s.sort((ut,pt)=>ut.frame-pt.frame);const a=(i=e.scene)!==null&&i!==void 0?i:e.scenes[0];if(!a)return;a.userData.__markers=s;const h=this.plugin.timelineMarkers,d=s.map(ut=>ut.time);let _=h.length;const et=s.map(ut=>_++),nt=Math.max(...d)+.01;h.push(...s);const it=new b.dUE(".currentTimelineMarker",d,et,2300),lt=new b.m7l("animationTimelineMarker",nt,[it]);lt.__gltfExport=!1,e.animations.push(lt)}}const MT=c=>({afterParse(e){const i=c.json.scenes[c.json.scene||0];i.extensions=i.extensions||{};const s={markers:[]},a=[];if((Array.isArray(e)?e:[e]).forEach(h=>h.traverse(d=>{d.userData.__markers&&a.push(...d.userData.__markers)})),a.sort((h,d)=>h.frame-d.frame),!(a.length<1)){for(const h of a){const d=h.camera;if(d){const _=c.nodeMap.get(d);if(_===void 0){console.warn("Camera not found in gltf export",d,c.nodeMap);continue}const et=c.json.nodes[_].camera;h.camera=et,s.markers.push(h)}}i.extensions[El.AnimationMarkersExtension]=s,c.extensionsUsed[El.AnimationMarkersExtension]=!0}}});class mp extends ot{constructor(){super(...arguments),this.dirty=!1,this.counters={},this._generators=new Map,this._preRender=()=>this._showDebug("preRender"),this._postRender=()=>this._showDebug("postRender")}async onAdded(e){this._viewer=e,e.addEventListener("preRender",this._preRender),e.addEventListener("postRender",this._postRender)}addTexture(e,i,s,a,h,d="postRender",_=!1){var et;this._generators.has(d)||this._generators.set(d,[]),(et=this._generators.get(d))===null||et===void 0||et.push({key:e,fn:i,rect:s?[...s]:void 0,frag:h||a||_?new b.jyz({vertexShader:yt.vertexShader,uniforms:{tDiffuse:{value:null},opacity:{value:1}},fragmentShader:h??`
        #include <common>
        #include <packing>
        uniform float opacity;
		uniform ${_?"samplerCube":"sampler2D"} tDiffuse;
		varying vec2 vUv;
		void main() {
			vec4 texel = ${_?"textureCube( tDiffuse, vec3(cos(vUv.y * PI2) * cos(vUv.x * PI2), sin(vUv.y * PI2), cos(vUv.y * PI2) * sin(vUv.x * PI2)) )":"texture2D( tDiffuse, vUv )"};
			${a??""}
			gl_FragColor = opacity * texel;
		}
            `}):void 0})}removeTexture(e,i="postRender"){var s,a;this._generators.set(i,(a=(s=this._generators.get(i))===null||s===void 0?void 0:s.filter(h=>h.key!==e))!==null&&a!==void 0?a:[])}async onDispose(e){return Promise.resolve(void 0)}async onRemove(e){return e.removeEventListener("preRender",this._preRender),e.removeEventListener("postRender",this._postRender),this._viewer=void 0,Promise.resolve(void 0)}_showDebug(e){var i;const s=this._viewer,a=s==null?void 0:s.renderer;a&&s&&((i=this._generators.get(e))===null||i===void 0||i.forEach(({key:h,fn:d,rect:_,frag:et})=>{const nt=d(s);if(nt){if(nt.image&&_){const it=nt.image.width/nt.image.height;_[2]<1&&_[3]<1&&(_[2]=200),_[2]<1&&(_[2]=_[3]*it),_[3]<1&&(_[3]=_[2]/it)}a.blit(nt,void 0,{viewport:_,clear:!1,material:et})}}))}}mp.PluginType="debug";var zA=function(c,e){return zA=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(i,s){i.__proto__=s}||function(i,s){for(var a in s)Object.prototype.hasOwnProperty.call(s,a)&&(i[a]=s[a])},zA(c,e)};function bC(c,e){if(typeof e!="function"&&e!==null)throw new TypeError("Class extends value "+String(e)+" is not a constructor or null");function i(){this.constructor=c}zA(c,e),c.prototype=e===null?Object.create(e):(i.prototype=e.prototype,new i)}var EC,SC=function(){function c(){}return c._xfnv1a=function(e){for(var i=2166136261,s=0;s<e.length;s++)i=Math.imul(i^e.charCodeAt(s),16777619);return function(){return i+=i<<13,i^=i>>>7,i+=i<<3,i^=i>>>17,(i+=i<<5)>>>0}},c}(),vD=function(c){function e(i){var s=c.call(this)||this;return s.a=e._xfnv1a(i)(),s}return bC(e,c),e.prototype.next=function(){var i=this.a+=1831565813;return i=Math.imul(i^i>>>15,1|i),(((i^=i+Math.imul(i^i>>>7,61|i))^i>>>14)>>>0)/4294967296},e}(SC),_D=function(c){function e(i){var s=c.call(this)||this,a=e._xfnv1a(i);return s.a=a(),s.b=a(),s.c=a(),s.d=a(),s}return bC(e,c),e.prototype.next=function(){this.a>>>=0,this.b>>>=0,this.c>>>=0,this.d>>>=0;var i=this.a+this.b|0;return this.a=this.b^this.b>>>9,this.b=this.c+(this.c<<3)|0,this.c=this.c<<21|this.c>>>11,this.d=this.d+1|0,i=i+this.d|0,this.c=this.c+i|0,(i>>>0)/4294967296},e}(SC),AD=function(c){function e(i){var s=c.call(this)||this,a=e._xfnv1a(i);return s.a=a(),s.b=a(),s.c=a(),s.d=a(),s}return bC(e,c),e.prototype.next=function(){var i=this.b<<9,s=5*this.a;return s=s<<7|9*(s>>>25),this.c^=this.a,this.d^=this.b,this.b^=this.c,this.a^=this.d,this.c^=i,this.d=this.d<<11|this.d>>>21,(s>>>0)/4294967296},e}(SC);(function(c){c.sfc32="sfc32",c.mulberry32="mulberry32",c.xoshiro128ss="xoshiro128ss"})(EC||(EC={}));var yD=function(){function c(e,i){i===void 0&&(i=EC.sfc32),this.str=e,this.prng=i,this.generator=this._initializeGenerator()}return c.prototype.next=function(){return this.generator.next()},c.prototype._initializeGenerator=function(){if(function(i){return i===null}(e=this.str)||function(i){return i===void 0}(e))return this.wrap();var e;switch(this.prng){case"sfc32":return new _D(this.str);case"mulberry32":return new vD(this.str);case"xoshiro128ss":return new AD(this.str);default:return this.wrap()}},c.prototype.wrap=function(){return{next:function(){return Math.random()}}},c}(),vE=function(c,e,i,s){var a,h=arguments.length,d=h<3?e:s===null?s=Object.getOwnPropertyDescriptor(e,i):s;if(typeof Reflect=="object"&&typeof Reflect.decorate=="function")d=Reflect.decorate(c,e,i,s);else for(var _=c.length-1;_>=0;_--)(a=c[_])&&(d=(h<3?a(d):h>3?a(e,i,d):a(e,i))||d);return h>3&&d&&Object.defineProperty(e,i,d),d};class Ax extends SA{constructor(e,i,s,a){super(e,i),this._shadowParams={enabled:!0,radius:2,width:1024,height:1024,bias:-.001,normalBias:0,near:1.5,far:4,frustumSize:4},this._randomParams={focus:1,spread:.01,distanceScale:50,minDistanceScale:new b.Pa4(10,10,10),normalDirection:new b.Pa4(.01,.98,.01).normalize(),direction:new b.Pa4(-.9,.5,-1)},this.isRandomizedDirectionalLight=!0,this.shadowParams=s??{},this.randomParams=a??{},this.updateShadowParams=this.updateShadowParams.bind(this)}get shadowParams(){return this._shadowParams}set shadowParams(e){Object.keys(e).forEach(i=>e[i]===void 0&&delete e[i]),this._shadowParams={...this._shadowParams,...e},this.updateShadowParams()}get randomParams(){return this._randomParams}set randomParams(e){Object.keys(e).forEach(i=>e[i]===void 0&&delete e[i]),Object.assign(this._randomParams,e)}updateShadowParams(){this.castShadow=this._shadowParams.enabled,this.shadow.mapSize.x=this._shadowParams.width,this.shadow.mapSize.y=this._shadowParams.height,this.shadow.bias=this._shadowParams.bias,this.shadow.normalBias=this._shadowParams.normalBias,this.refreshShadowCamNearFar(),this.shadow.radius=this._shadowParams.radius,this.shadow.camera.right=this._shadowParams.frustumSize/2,this.shadow.camera.left=-this._shadowParams.frustumSize/2,this.shadow.camera.top=this._shadowParams.frustumSize/2,this.shadow.camera.bottom=-this._shadowParams.frustumSize/2,this.shadow.camera.updateProjectionMatrix(),this.matrixWorldNeedsUpdate=!0}randomizePosition(e,i=null,s=null){const a=new yD(e.toString()),h=new b.FM8(a.next()*Math.PI*2,Math.asin(2*a.next()-1));let d=new b.Pa4(Math.cos(h.x)*Math.cos(h.y),Math.sin(h.y),Math.sin(h.x)*Math.cos(h.y));const _=new b.FM8;for(let et=0;et<5;et++){_.set(a.next(),a.next()),d=VA(_,this._randomParams.normalDirection,.4),a.next()<Math.sqrt(i??this._randomParams.focus)&&(_.set(a.next(),a.next()),d=VA(_,this._randomParams.direction,Math.pow((s??this._randomParams.spread)/2,2)));const nt=d.dot(this._randomParams.normalDirection);if(nt>0&&nt<.4)break}d.normalize(),d.multiplyScalar(this._randomParams.distanceScale),this.position.set(0,0,0),this.target.position.copy(d.normalize().negate()),this.target.updateMatrixWorld(),this.refreshShadowCamNearFar(),this.updateMatrixWorld()}refreshShadowCamNearFar(){const e=new b.Pa4().subVectors(this.target.position,this.shadow.camera.position).length();this.shadow.camera.near=e-this._shadowParams.near*this._shadowParams.frustumSize/2,this.shadow.camera.far=e+this._shadowParams.far*this._shadowParams.frustumSize/2}dispose(){}get uiConfig(){if(this._uiConfig)return this._uiConfig}fromJSON(e,i){return super.fromJSON(e,i)?(this.updateShadowParams(),this):null}}function VA(c,e,i){e=e.clone().normalize();const s=new b.Pa4(0,-e.z,e.y).normalize(),a=new b.Pa4().crossVectors(e,s).normalize(),h=c;h.x=2*h.x*Math.PI,h.y=1-h.y*i;const d=Math.sqrt(1-h.y*h.y);return s.multiplyScalar(Math.cos(h.x)*d).add(a.multiplyScalar(Math.sin(h.x)*d)).add(e.multiplyScalar(h.y))}vE([Fn("shadowParams")],Ax.prototype,"_shadowParams",void 0),vE([Fn("randomParams")],Ax.prototype,"_randomParams",void 0);class CC extends b.Tn7{constructor(){super(...arguments),this.typeSlug="fsShadow",this.assetType="material",this._uniforms={},this.lastFrameTexture=null}get materialObject(){return this}onBeforeCompile(e,i){e.vertexShader=e.vertexShader.replace("#include <project_vertex>",`
#include <project_vertex>
gl_Position = vec4(uv*2.-1., 0, 1.); 
        `),e.vertexShader=e.vertexShader.replace("void main() {",`
varying vec2 vUv;
void main() {
    vUv = uv;
        `),e.fragmentShader=e.fragmentShader.replace("void main() {",`
varying vec2 vUv;
uniform sampler2D tLastThis;
void main() {
        `),e.fragmentShader=e.fragmentShader.replace("gl_FragColor = vec4( color, opacity * ( 1.0 - getShadowMask() ) );",Qt`
float shadow = getShadowMask();

//shift the color by dither_shift
shadow = clamp(shadow + mix(-1./512., 1./512., rand( gl_FragCoord.xy )), 0., 1.);

float last = unpackRGBAToDepth(texture2D(tLastThis, vUv));
gl_FragColor = packDepthToRGBA(mix(last, shadow, opacity));
//if not useMovingAverage:
//gl_FragColor = packDepthToRGBA(shadow * opacity + last);
        `),Object.assign(e.uniforms,this._uniforms),super.onBeforeCompile(e,i)}customProgramCacheKey(){return super.customProgramCacheKey()}toJSON(e){throw new Error("Method not supported for this material.")}fromJSON(e,i){throw new Error("Method not supported for this material.")}copyProps(e){throw new Error("Method not supported for this material.")}setDirty(e){this.needsUpdate=!0,this.dispatchEvent({...e,type:"materialUpdate"})}}(function(c,e,i,s){var a,h=arguments.length,d=h<3?e:s===null?s=Object.getOwnPropertyDescriptor(e,i):s;if(typeof Reflect=="object"&&typeof Reflect.decorate=="function")d=Reflect.decorate(c,e,i,s);else for(var _=c.length-1;_>=0;_--)(a=c[_])&&(d=(h<3?a(d):h>3?a(e,i,d):a(e,i))||d);h>3&&d&&Object.defineProperty(e,i,d)})([rn({propKey:"tLastThis"})],CC.prototype,"lastFrameTexture",void 0);var Yo=function(c,e,i,s){var a,h=arguments.length,d=h<3?e:s===null?s=Object.getOwnPropertyDescriptor(e,i):s;if(typeof Reflect=="object"&&typeof Reflect.decorate=="function")d=Reflect.decorate(c,e,i,s);else for(var _=c.length-1;_>=0;_--)(a=c[_])&&(d=(h<3?a(d):h>3?a(e,i,d):a(e,i))||d);return h>3&&d&&Object.defineProperty(e,i,d),d};class Bp{constructor(e){this.enabled=!0,this._lightLayer=5,this._frameNumber=0,this.maxFrameNumber=400,this.groundMapMode="aoMap",this.alphaVignette=!0,this.alphaVignetteAxis="xy",this.shadowAutoUpdate=!0,this.materialExtension={shaderExtender:(s,a,h)=>{this.groundMapMode==="aoMap"?s.fragmentShader=Ho(s.fragmentShader,"#include <aomap_fragment>",Ho(b.WdD.aomap_fragment,"float ambientOcclusion = ( texture2D( aoMap, vUv2 ).r - 1.0 ) * aoMapIntensity + 1.0;","float ambientOcclusion = ( unpackRGBAToDepth(texture2D( aoMap, vUv2 ) ) - 1.0) * aoMapIntensity + 1.0;")):this.groundMapMode==="map"?s.fragmentShader=Ho(s.fragmentShader,"#include <map_fragment>",Ho(b.WdD.map_fragment,"diffuseColor *= sampledDiffuseColor;","float groundShadow = unpackRGBAToDepth(sampledDiffuseColor); diffuseColor.rgb *= groundShadow; diffuseColor.a *= max(0., 1.-groundShadow);")):this.groundMapMode==="alphaMap"&&(s.fragmentShader=Ho(s.fragmentShader,"#include <alphamap_fragment>",Ho(b.WdD.alphamap_fragment,"texture2D( alphaMap, vUv ).g","1. - unpackRGBAToDepth( texture2D( alphaMap, vUv ) )",{replaceAll:!0}))),this.alphaVignette&&h.capabilities.isWebGL2&&(s.fragmentShader=Ho(s.fragmentShader,"#include <output_fragment>",Qt`#include <output_fragment>
                    #ifndef OPAQUE
                    float weight = 0.;
                    #ifdef USE_UV
                    weight = 2.*abs(length(0.5 - vUv.${this.alphaVignetteAxis}));
                    #endif
                    #if defined(USE_LIGHTMAP) || defined(USE_AOMAP)
                    weight = 2.*abs(length(0.5 - vUv2.${this.alphaVignetteAxis}));
                    #endif
                    weight = min(1., max(0., weight))-0.5;
                    weight = min(1., max(0., 1.0-2.*weight));
                    weight = pow(weight, 1.5);
                    gl_FragColor.a *= weight;
                    //gl_FragColor.rgb /= max(0.01, weight);
                    gl_FragColor = saturate(gl_FragColor);
                    //gl_FragColor.a = 0.5;
                    #endif
                    `))},computeCacheKey:()=>this.groundMapMode+"."+this.alphaVignette+"."+this.alphaVignetteAxis,onObjectRender:(s,a)=>{a.materialObject.userData.gMapMode!==this.groundMapMode&&(a.materialObject.userData.gMapMode=this.groundMapMode,a.materialObject.needsUpdate=!0)},isCompatible:s=>s.isMeshStandardMaterial2},this._viewer=e;const i=new Ax(16777215,10,{near:1.5,far:20,bias:0,frustumSize:4,width:1024,height:1024,enabled:!0,radius:10,normalBias:0},{direction:new b.Pa4(.2,1,.2).normalize(),spread:.9,focus:1,distanceScale:20,minDistanceScale:new b.Pa4(10,10,10),normalDirection:new b.Pa4(0,1,0)});i.shadow.camera.updateProjectionMatrix(),i.layers.disableAll(),i.layers.set(this._lightLayer),this._light=i,e.scene.addLight(this._light,{addToRoot:!0}),this._shadowMat=new CC({color:"#ffffff",toneMapped:!1,depthWrite:!1,depthTest:!1,premultipliedAlpha:!1,opacity:1,transparent:!1,blending:b.jFi})}get attachedMesh(){return this._attachedMesh}set attachedMesh(e){this._attachedMesh!==e&&(this._attachedMesh&&this.cleanupMaterial(),this._attachedMesh=e,this._attachedMesh&&this._updateMaterial())}get target(){return this._target}get light(){return this._light}dispose(){this._shadowMat.dispose(),this._target=void 0,this.reset()}cleanupMaterial(){this._updateMaterial(!0)}_groundMapModeChanged(){this._attachedMesh&&(this.cleanupMaterial(),this._updateMaterial(),this.groundMapMode==="alphaMap"?this._attachedMesh.material.transparent=!0:this._attachedMesh.material.transparent=!1),this.reset()}_alphaVignetteChanged(){var e,i,s;(i=(e=this.materialExtension)===null||e===void 0?void 0:e.setDirty)===null||i===void 0||i.call(e),(s=this._viewer)===null||s===void 0||s.setDirty()}fromJSON(e,i){return to(e,this,!0,i),this.reset(),this}reset(){this._frameNumber=0}autoUpdateShadow(){this.shadowAutoUpdate&&this.updateShadow()}updateShadow(){if(!this.enabled)return!1;const e=this._attachedMesh;if(++this._frameNumber>this.maxFrameNumber||!e)return!1;const i=1024;this._target||(this._target=this._viewer.renderer.createTarget({type:b.ywz,depthBuffer:!1,size:new b.FM8(i,i),sizeMultiplier:void 0,encoding:b.rnI,format:b.wk1})),this._frameNumber<3?this._light.randomizePosition(0,1,0):this._light.randomizePosition(this._frameNumber),e.castShadow=!1;const s=this._viewer.renderer.rendererObject,a=s.shadowMap,h=a.type,d=a.needsUpdate,_=a.autoUpdate;a.type=b._MY,a.needsUpdate=!0,a.autoUpdate=!1;const et=this._viewer.scene,nt=new b.S9g;nt.disableAll(),et.modelObject.traverse(gt=>{gt.isLight&&gt!==this._light.lightObject&&(gt.userData.__gp_layers=gt.layers,gt.layers=nt)});const it=et.activeCamera.cameraObject;if(it.layers.mask&1<<this._lightLayer)throw"Camera can render pseudo directional light, check layers";it.layers.enable(this._lightLayer),e.layers.disable(this._lightLayer),zr(s,{shadowMapRender:!0,backgroundRender:!1,sceneRender:!1},()=>this._viewer.renderer.renderScene(et)),it.layers.disable(this._lightLayer);const lt=it.layers.mask;it.layers.set(this._lightLayer),e.layers.enable(this._lightLayer);const ut=this._viewer.renderer.getTempTarget({type:b.ywz,depthBuffer:!1,size:new b.FM8(i,i),encoding:b.rnI,format:b.wk1}),pt=ut.texture.encoding;ut.texture.encoding=b.rnI,this._viewer.renderer.blit(this._target.texture,ut,{clear:!0});{const gt=et.modelObject.environment,vt=et.modelObject.background,Ct=e.material,wt=e.frustumCulled,xt=s.getRenderTarget(),_t=s.getActiveCubeFace(),Pt=s.getActiveMipmapLevel();et.modelObject.background=null,et.modelObject.environment=null,e.material=this._shadowMat,e.frustumCulled=!1,s.setRenderTarget(this._target),this._shadowMat.opacity=Math.max(1/this.maxFrameNumber,1/this._frameNumber),this._shadowMat.lastFrameTexture=ut.texture,this._shadowMat.needsUpdate=!0,zr(s,{shadowMapRender:!1,backgroundRender:!1,opaqueRender:!0,transparentRender:!1,transmissionRender:!1},()=>this._viewer.renderer.renderScene(et)),s.setRenderTarget(xt,_t,Pt),e.frustumCulled=wt,e.material=Ct,et.modelObject.environment=gt,et.modelObject.background=vt}return ut.texture.encoding=pt,this._viewer.renderer.releaseTempTarget(ut),e.layers.disable(this._lightLayer),it.layers.mask=lt,et.modelObject.traverse(gt=>{gt.isLight&&gt!==this._light.lightObject&&(gt.layers=gt.userData.__gp_layers,delete gt.userData.__gp_layers)}),a.type=h,a.needsUpdate=d,a.autoUpdate=_,e.castShadow=!0,(this._frameNumber<2||this._frameNumber>Math.min(30,this.maxFrameNumber)&&this._frameNumber%150==0)&&(this._updateMaterial(),this._viewer.setDirty(),e.dispatchEvent({type:"materialUpdate"})),!0}_updateMaterial(e=!1){var i,s,a;this._attachedMesh&&(e?(this._attachedMesh.material.alphaMap===((i=this._target)===null||i===void 0?void 0:i.texture)&&(this._attachedMesh.material.alphaMap=null),this._attachedMesh.material.aoMap===((s=this._target)===null||s===void 0?void 0:s.texture)&&(this._attachedMesh.material.aoMap=null),this._attachedMesh.material.map===((a=this._target)===null||a===void 0?void 0:a.texture)&&(this._attachedMesh.material.map=null)):this._target&&(this.groundMapMode==="alphaMap"&&(this._attachedMesh.material.alphaMap=this._target.texture),this.groundMapMode==="aoMap"&&(this._attachedMesh.material.aoMap=this._target.texture),this.groundMapMode==="map"&&(this._attachedMesh.material.map=this._target.texture)),this._attachedMesh.material&&(this._attachedMesh.material.userData.ALPHA_I_RGBA_PACKING=!e&&this.groundMapMode==="alphaMap",this._attachedMesh.material.alphaTest=e||this.groundMapMode!=="alphaMap"?0:.001,this._attachedMesh.material.needsUpdate=!0))}}Yo([Fn("randomizedLight")],Bp.prototype,"_light",void 0),Yo([pn(Bp.prototype.reset),Fn()],Bp.prototype,"maxFrameNumber",void 0),Yo([pn(Bp.prototype._groundMapModeChanged),Fn()],Bp.prototype,"groundMapMode",void 0),Yo([Fn(),pn(Bp.prototype._alphaVignetteChanged)],Bp.prototype,"alphaVignette",void 0),Yo([Fn(),pn(Bp.prototype._alphaVignetteChanged)],Bp.prototype,"alphaVignetteAxis",void 0);var MC="vec2 poisson_disk_samples[16];void setPds(){poisson_disk_samples[0]=vec2(-0.399691779231,0.728591545584);poisson_disk_samples[1]=vec2(-0.48622557676,-0.84016533712);poisson_disk_samples[2]=vec2(0.770309468987,-0.24906070432);poisson_disk_samples[3]=vec2(0.556596796154,0.820359876432);poisson_disk_samples[4]=vec2(-0.933902004071,0.0600539051593);poisson_disk_samples[5]=vec2(0.330144964342,0.207477293384);poisson_disk_samples[6]=vec2(0.289013230975,-0.686749271417);poisson_disk_samples[7]=vec2(-0.0832470893559,-0.187351643125);poisson_disk_samples[8]=vec2(-0.296314525615,0.254474834305);poisson_disk_samples[9]=vec2(-0.850977666059,0.484642744689);poisson_disk_samples[10]=vec2(0.829287915319,0.2345063545);poisson_disk_samples[11]=vec2(-0.773042143899,-0.543741521254);poisson_disk_samples[12]=vec2(0.0561133030864,0.928419742597);poisson_disk_samples[13]=vec2(-0.205799249508,-0.562072714492);poisson_disk_samples[14]=vec2(-0.526991665882,-0.193690188118);poisson_disk_samples[15]=vec2(-0.051789270667,-0.935374050821);}",yx=function(c,e,i,s){var a,h=arguments.length,d=h<3?e:s===null?s=Object.getOwnPropertyDescriptor(e,i):s;if(typeof Reflect=="object"&&typeof Reflect.decorate=="function")d=Reflect.decorate(c,e,i,s);else for(var _=c.length-1;_>=0;_--)(a=c[_])&&(d=(h<3?a(d):h>3?a(e,i,d):a(e,i))||d);return h>3&&d&&Object.defineProperty(e,i,d),d};class Gv extends b.Kj0{constructor(e,i,s=0){super(e),this.type="Reflector",this.isReflector2=!0,this.enabled=!0,this.reflectorModePhysical=!0,this.reflectionTargetNeedsUpdate=!0,this.transparentReflectionBackground=!0,this.materialExtension={extraUniforms:{tRefDiffuse:{value:null},tRefDiffuseSize:{value:new b.FM8},refTextureMatrix:{value:null},frameCount:{value:0},sceneBoundingRadius:{value:0}},updaters:[],shaderExtender:(Ct,wt,xt)=>{if(this.enabled){Ct.vertexShader=Ct.vertexShader.replace("void main() {",`void main() {
vRefUv = refTextureMatrix * vec4( position, 1.0 );`);const _t="#glMarker beforeModulation";Ct.fragmentShader=Ct.fragmentShader.replace(_t,`
                    if(roughnessFactor < 0.95) {
                        float d = 0.;//textureProj(tRefDepth, vRefUv).r;
                        // d = min(2., max(0., (d-0.06) * ((7./3.-ior)) * sceneBoundingRadius));
                        vec4 refBaseColor = getReflectionColor(material.roughness, material.roughness * d);
                        // refBaseColor.rgb = vec3(refBaseColor.a);
                        // refBaseColor.a *= 1.0 - clamp(material.roughness * .3, 0., 1.);
                        `+(this.reflectorModePhysical?`
                        #if !defined(SSR_ENABLED) || SSR_ENABLED < 1 
                        vec3 specularColor = EnvironmentBRDF(geometry.normal, geometry.viewDir, material.specularColor.rgb, material.specularF90, material.roughness);
                        #endif
                        reflectedLight.indirectSpecular = mix(vec3(reflectedLight.indirectSpecular), saturate(specularColor.rgb * refBaseColor.rgb), refBaseColor.a);
                        `:`
                        reflectedLight.indirectSpecular = saturate(diffuseColor.rgb * refBaseColor.rgb);
                        diffuseColor.a *= refBaseColor.a;
                        `)+`}
`+_t),Ct.vertexUvs=!0}},parsVertexSnippet:()=>this.enabled?`
		uniform mat4 refTextureMatrix;
		varying vec4 vRefUv;
`:"",parsFragmentSnippet:()=>this.enabled?MC+`
`+Jm+`
#ifndef D_sceneBoundingRadius
#define D_sceneBoundingRadius 
uniform float sceneBoundingRadius;
#endif
varying vec4 vRefUv;uniform sampler2D tRefDiffuse;uniform vec2 tRefDiffuseSize;float getSpecularMIPLevel(const in float roughness,const in float maxMIPLevel){float sigma=PI*roughness*roughness/(1.+roughness);float desiredMIPLevel=maxMIPLevel+log2(sigma);return clamp(desiredMIPLevel,0.,maxMIPLevel);}vec4 getReflectionColor(const in float roughness,const in float depthModifier){float mip=getSpecularMIPLevel(roughness+depthModifier,5.);vec4 color=texture2D(tRefDiffuse,vRefUv.xy/vRefUv.w,mip);float blurDist=saturate(2./(1.+pow(abs(vViewPosition.z),0.25)))*mip*32.*color.a;float rnd=PI2*interleavedGradientNoise(vUv.xy,frameCount);vec4 rotationMatrix=vec4(cos(rnd),-sin(rnd),0.,0.);rotationMatrix.z=-rotationMatrix.y;rotationMatrix.w=rotationMatrix.x;vec3 colorSum=color.rgb*color.a;float weightSum=0.001+color.a;vec2 ofs;setPds();
#pragma unroll_loop_start
for(int i=0;i<16;i++){ofs=poisson_disk_samples[UNROLLED_LOOP_INDEX];ofs=vec2(dot(ofs,rotationMatrix.xy),dot(ofs,rotationMatrix.zw));ofs=vRefUv.xy+vRefUv.w*blurDist*ofs/tRefDiffuseSize.xy;color=texture2D(tRefDiffuse,ofs/vRefUv.w,mip);colorSum+=color.rgb*color.a;weightSum+=color.a;}
#pragma unroll_loop_end
return vec4(colorSum/weightSum,1.);}`:"",computeCacheKey:Ct=>this.enabled+" "+Ct.materialObject.transparent+" "+this.reflectorModePhysical+" ",onObjectRender:(Ct,{materialObject:wt})=>{wt.userData.__lastTransparent!==wt.transparent&&(wt.needsUpdate=!0,wt.userData.__lastTransparent=wt.transparent)},isCompatible:Ct=>Ct.isMeshStandardMaterial2},this.material=void 0,this._renderTarget=i;const a=new b.JOQ,h=new b.Pa4,d=new b.Pa4,_=new b.Pa4,et=new b.yGw,nt=new b.Pa4(0,0,-1),it=new b.Ltg,lt=new b.Pa4,ut=new b.Pa4,pt=new b.Ltg,gt=new b.yGw,vt=new b.cPb;b.M8C.isPowerOfTwo(i.texture.image.width)&&b.M8C.isPowerOfTwo(i.texture.image.height)||(this._renderTarget.texture.generateMipmaps=!1),this.onBeforeRender=(Ct,wt,xt)=>{if(!this.enabled||!Ct.userData.mainRenderPass||!this.reflectionTargetNeedsUpdate)return;const _t=xt.view?Object.assign({},xt.view):null;if(_t&&xt.clearViewOffset&&xt.clearViewOffset(),d.setFromMatrixPosition(this.matrixWorld),_.setFromMatrixPosition(xt.matrixWorld),et.extractRotation(this.matrixWorld),h.set(0,0,1),h.applyMatrix4(et),lt.subVectors(d,_),lt.dot(h)>0)return;lt.reflect(h).negate(),lt.add(d),et.extractRotation(xt.matrixWorld),nt.set(0,0,-1),nt.applyMatrix4(et),nt.add(_),ut.subVectors(d,nt),ut.reflect(h).negate(),ut.add(d),vt.position.copy(lt),vt.up.set(0,1,0),vt.up.applyMatrix4(et),vt.up.reflect(h),vt.lookAt(ut),vt.far=2,vt.near=0,vt.updateMatrixWorld(),vt.projectionMatrix.copy(xt.projectionMatrix),gt.set(.5,0,0,.5,0,.5,0,.5,0,0,.5,.5,0,0,0,1),gt.multiply(vt.projectionMatrix),gt.multiply(vt.matrixWorldInverse),gt.multiply(this.matrixWorld),a.setFromNormalAndCoplanarPoint(h,d),a.applyMatrix4(vt.matrixWorldInverse),it.set(a.normal.x,a.normal.y,a.normal.z,a.constant);const Pt=vt.projectionMatrix;pt.x=(Math.sign(it.x)+Pt.elements[8])/Pt.elements[0],pt.y=(Math.sign(it.y)+Pt.elements[9])/Pt.elements[5],pt.z=-1,pt.w=(1+Pt.elements[10])/Pt.elements[14],it.multiplyScalar(2/it.dot(pt)),Pt.elements[2]=it.x,Pt.elements[6]=it.y,Pt.elements[10]=it.z+1-s,Pt.elements[14]=it.w,this.visible=!1;const Bt=Ct.getRenderTarget(),Ot=Ct.xr.enabled,Lt=Ct.shadowMap.autoUpdate;Ct.xr.enabled=!1,Ct.shadowMap.autoUpdate=!1,Ct.setRenderTarget(this._renderTarget),Ct.state.buffers.depth.setMask(!0),Ct.autoClear===!1&&Ct.clear();const qt=wt.background;this.transparentReflectionBackground&&(wt.background=null);const en=!this.transparentReflectionBackground;qt&&en&&(qt.userData.flipX=!qt.userData.flipX),zr(Ct,{shadowMapRender:!1,backgroundRender:en,opaqueRender:!0,transparentRender:!0,transmissionRender:!1,screenSpaceRendering:!1},()=>Ct.render(wt,vt)),qt&&en&&(qt.userData.flipX=!qt.userData.flipX||void 0),this.transparentReflectionBackground&&(wt.background=qt),Ct.xr.enabled=Ot,Ct.shadowMap.autoUpdate=Lt,Ct.setRenderTarget(Bt),_t!=null&&_t.enabled&&xt.setViewOffset&&xt.setViewOffset(_t.fullWidth,_t.fullHeight,_t.offsetX,_t.offsetY,_t.width,_t.height);const cn=xt.viewport;cn!==void 0&&Ct.state.viewport(cn),this.visible=!0,this.reflectionTargetNeedsUpdate=!1},this.textureMatrix=gt,this.materialExtension.extraUniforms.tRefDiffuse.value=this._renderTarget.texture,this.materialExtension.extraUniforms.tRefDiffuseSize.value=new b.FM8(this._renderTarget.width,this._renderTarget.height),this.materialExtension.extraUniforms.refTextureMatrix.value=gt}_updateExtension(){var e,i;this.transparentReflectionBackground=this.reflectorModePhysical,(i=(e=this.materialExtension)===null||e===void 0?void 0:e.setDirty)===null||i===void 0||i.call(e)}getRenderTarget(){return this._renderTarget}}yx([pn(Gv.prototype._updateExtension)],Gv.prototype,"enabled",void 0),yx([pn(Gv.prototype._updateExtension)],Gv.prototype,"reflectorModePhysical",void 0),Gv.prototype.isReflector=!0;var nv=function(c,e,i,s){var a,h=arguments.length,d=h<3?e:s===null?s=Object.getOwnPropertyDescriptor(e,i):s;if(typeof Reflect=="object"&&typeof Reflect.decorate=="function")d=Reflect.decorate(c,e,i,s);else for(var _=c.length-1;_>=0;_--)(a=c[_])&&(d=(h<3?a(d):h>3?a(e,i,d):a(e,i))||d);return h>3&&d&&Object.defineProperty(e,i,d),d};class ku extends Ls{constructor(e={}){super(),this._transformNeedRefresh=!0,this.dependencies=[qr],this.visible=!0,this.size=8,this.yOffset=0,this.renderToDepth=!0,this.tonemapGround=!0,this.limitCameraAboveGround=!1,this._cameraLimitsSet=!1,this._cameraLastMaxPolarAngle=Math.PI,this._refreshMaterial=this._refreshMaterial.bind(this),this._refreshTransform=this._refreshTransform.bind(this),this._refreshCameraLimits=this._refreshCameraLimits.bind(this),this.refreshOptions=this.refreshOptions.bind(this),this._refreshOptions2=this._refreshOptions2.bind(this),this._onSceneUpdate=this._onSceneUpdate.bind(this),this._preRender=this._preRender.bind(this),this._postFrame=this._postFrame.bind(this),this._geometry=new b._12(1,1,1,1),this._geometry.attributes.uv2=this._geometry.attributes.uv.clone(),this._geometry.attributes.uv2.needsUpdate=!0,this._options={shape:"",up:[0,100,0],autoAdjustTransform:!0},this.setOptions(e)}get enabled(){return this.visible}set enabled(e){this.visible=e}get material(){return this._material}get mesh(){return this._iMesh}_createMesh(){return new b.Kj0(this._geometry)}async onAdded(e){var i,s;await super.onAdded(e),e.getPluginByType("TweakpaneUi")&&console.error("TweakpaneUiPlugin must be added after Ground Plugin"),this._manager=e.getPlugin(qr);const a=this._createMesh();a.userData.physicsMass=0,this._iMesh=await((i=this._manager)===null||i===void 0?void 0:i.addImportedSingle(a,{pseudoCenter:!1,autoScale:!1,addToRoot:!0})),this._mesh=(s=this._iMesh)===null||s===void 0?void 0:s.modelObject,this._mesh&&(this._mesh.userData.userSelectable=!1,this._mesh.castShadow=!0,this._mesh.receiveShadow=!0,this._mesh.name="Ground Plane"),e.scene.addEventListener("sceneUpdate",this._onSceneUpdate),e.scene.addEventListener("addSceneObject",this._onSceneUpdate),e.addEventListener("preRender",this._preRender),e.addEventListener("postFrame",this._postFrame),this.refreshOptions()}_postFrame(){this._transformNeedRefresh&&this._refreshTransform(),this._viewer}_preRender(){this._viewer}async onDispose(e){var i,s;return this._geometry.dispose(),(s=(i=this._iMesh)===null||i===void 0?void 0:i.dispose)===null||s===void 0||s.call(i),super.onDispose(e)}async onRemove(e){return this._removeMaterial(),e.scene.removeEventListener("sceneUpdate",this._onSceneUpdate),e.scene.removeEventListener("addSceneObject",this._onSceneUpdate),e.removeEventListener("postFrame",this._postFrame),e.removeEventListener("preRender",this._preRender),this._manager=void 0,super.onRemove(e)}_removeMaterial(){var e,i;this._material&&((i=(e=this._manager)===null||e===void 0?void 0:e.materials)===null||i===void 0||i.unregisterMaterial(this._material),this._material.userData.renderToDepth=this._material.userData.__renderToDepth,this._material.userData.__renderToDepth=void 0,this._material=void 0)}_onSceneUpdate(e){e.geometryChanged!==!1&&e.updateGround!==!1&&this.refreshTransform()}refreshTransform(){this._transformNeedRefresh=!0}_refreshOptions2(){this.refreshOptions()}refreshOptions(){this._viewer&&(this._refreshMaterial(),this.refreshTransform(),this._refreshCameraLimits())}_refreshCameraLimits(){var e;const i=(e=this._viewer)===null||e===void 0?void 0:e.scene.activeCamera.controls;i&&(i.maxPolarAngle!==void 0?this.limitCameraAboveGround?(this._cameraLimitsSet||(this._cameraLastMaxPolarAngle=i.maxPolarAngle),i.maxPolarAngle=Math.PI/2,this._cameraLimitsSet=!0):this._cameraLimitsSet&&(i.maxPolarAngle=this._cameraLastMaxPolarAngle,this._cameraLimitsSet=!1):console.warn("refreshCameraLimits only available with orbit controls."))}_refreshTransform(){var e,i,s;if(!this._mesh||!this._viewer)return;let a=!1;if(this.visible!==this._mesh.visible&&(this._mesh.visible=this.visible,a=!0),this.enabled){if(this._options.autoAdjustTransform){this._mesh.userData.bboxVisible=!1;const h=this._viewer.scene.getBounds(!0);this._mesh.userData.bboxVisible=!0;const d=h.getCenter(new b.Pa4).sub(new b.Pa4(0,h.getSize(new b.Pa4).y/2+this.yOffset,0));a=a||d.clone().sub(this._mesh.position).length()>1e-4,a&&this._mesh.position.copy(d)}a=a||Math.abs(this._mesh.scale.x-this.size)>1e-4,a&&(this._mesh.scale.setScalar(this.size),this._mesh.setRotationFromEuler(new b.USm(-Math.PI/2,0,0)),this._mesh.matrixWorldNeedsUpdate=!0,(s=(i=this._mesh).setDirty)===null||s===void 0||s.call(i)),this._transformNeedRefresh=!1}else a&&((e=this._viewer)===null||e===void 0||e.scene.setDirty())}_refreshMaterial(){var e,i,s,a,h,d,_,et;if(!this._viewer||!this.enabled)return!1;this._manager||console.error("GroundPlugin requires asset manager");const nt=(i=(e=this._manager)===null||e===void 0?void 0:e.materials)===null||i===void 0?void 0:i.findOrCreate((a=(s=this._material)===null||s===void 0?void 0:s.uuid)!==null&&a!==void 0?a:"standard",{name:"BaseGroundMaterial",runtimeMaterial:!0,color:16777215});let it=!1;return(nt==null?void 0:nt.uuid)!==((h=this._material)===null||h===void 0?void 0:h.uuid)&&(this._removeMaterial(),nt&&(this._material=nt),!((d=this._material)===null||d===void 0)&&d.uuid||console.warn("No material found for ground"),this._viewer.scene.setDirty(),this._mesh&&this._material&&(this._material.roughness=.2,this._material.metalness=.5,((et=(_=this._mesh)===null||_===void 0?void 0:_.setMaterial)!==null&&et!==void 0?et:lt=>{this._mesh&&(this._mesh.material=lt.materialObject)})(this._material)),it=!0),this._material&&(this._material.userData.__renderToDepth===void 0&&(this._material.userData.__renderToDepth=this._material.userData.renderToDepth),this._material.userData.renderToDepth!==this.renderToDepth&&(this._material.userData.renderToDepth=this.renderToDepth),this._material.userData.__postTonemap===void 0&&(this._material.userData.__postTonemap=this._material.userData.postTonemap),this._material.userData.postTonemap!==this.tonemapGround&&(this._material.userData.postTonemap=this.tonemapGround),this._material.materialObject.userData.ssaoDisabled=!0,this._material.materialObject.userData.sscsDisabled=!0),this._viewer.setDirty(this),it}setOptions(e){Object.assign(this._options,e),this.refreshOptions()}fromJSON(e,i){return super.fromJSON(e,i)?(this.refreshOptions(),this):null}_extraUiConfig(){return[()=>{var e;return(e=this._material)===null||e===void 0?void 0:e.uiConfig}]}get uiConfig(){return this._uiConfig?this._uiConfig:this._uiConfig={type:"folder",label:"Ground",children:[{label:"Visible",type:"checkbox",property:[this,"visible"],limitedUi:!0},{label:"Size",type:"input",property:[this,"size"],limitedUi:!0},{label:"Render to Depth",type:"checkbox",property:[this,"renderToDepth"]},{label:"Limit Camera",type:"checkbox",property:[this,"limitCameraAboveGround"]},{label:"Tonemap",type:"checkbox",property:[this,"tonemapGround"]},{label:"Height",type:"slider",bounds:[-2,2],property:[this,"yOffset"]},...this._extraUiConfig()]}}}nv([Fn("material")],ku.prototype,"_material",void 0),nv([pn(ku.prototype.refreshTransform),Fn()],ku.prototype,"visible",void 0),nv([pn(ku.prototype._onSceneUpdate),Fn()],ku.prototype,"size",void 0),nv([pn(ku.prototype._onSceneUpdate),Fn()],ku.prototype,"yOffset",void 0),nv([pn(ku.prototype._refreshOptions2),Fn()],ku.prototype,"renderToDepth",void 0),nv([pn(ku.prototype._refreshOptions2),Fn()],ku.prototype,"tonemapGround",void 0),nv([pn(ku.prototype._refreshCameraLimits),Fn()],ku.prototype,"limitCameraAboveGround",void 0);var wx=function(c,e,i,s){var a,h=arguments.length,d=h<3?e:s===null?s=Object.getOwnPropertyDescriptor(e,i):s;if(typeof Reflect=="object"&&typeof Reflect.decorate=="function")d=Reflect.decorate(c,e,i,s);else for(var _=c.length-1;_>=0;_--)(a=c[_])&&(d=(h<3?a(d):h>3?a(e,i,d):a(e,i))||d);return h>3&&d&&Object.defineProperty(e,i,d),d};class gp extends ku{constructor(e={},i=!1){super(e),this.bakedShadows=!0,this.groundReflection=!1,this.physicalReflections=!1,this._showDebug=i,i&&this.dependencies.push(mp),this._onSceneUpdate=this._onSceneUpdate.bind(this)}get shadowBaker(){return this._shadowBaker}_createMesh(){const e=new Gv(this._geometry,this._viewer.renderer.createTarget({type:b.ywz,format:b.wk1,encoding:b.rnI,size:{width:1024,height:1024},generateMipmaps:!0,depthBuffer:!0,minFilter:b.D1R,magFilter:b.wem})),i=e.onBeforeRender;return e.onBeforeRender=(...s)=>{var a,h,d,_,et;let nt=(h=(a=this._viewer)===null||a===void 0?void 0:a.getPluginByType("SSReflection"))===null||h===void 0?void 0:h.passes.ssr.passObject;nt&&!nt.enabled&&(nt=void 0),nt&&(nt.enabled=!1);let it=(et=(_=(d=this._viewer)===null||d===void 0?void 0:d.getPluginByType("SSBevelPlugin"))===null||_===void 0?void 0:_.pass)===null||et===void 0?void 0:et.passObject;it&&!it.enabled&&(it=void 0),it&&(it.enabled=!1),i(...s),nt&&(nt.enabled=!0),it&&(it.enabled=!0)},e}async onAdded(e){var i,s;await super.onAdded(e),this._showDebug&&((i=e.getPlugin(mp))===null||i===void 0||i.addTexture("bake_ground_1",()=>{var a,h;return(h=(a=this._shadowBaker)===null||a===void 0?void 0:a.light.shadow.map)===null||h===void 0?void 0:h.texture},[100,100,200,200]),(s=e.getPlugin(mp))===null||s===void 0||s.addTexture("bake_ground_2",()=>{var a,h;return(h=(a=this._shadowBaker)===null||a===void 0?void 0:a.target)===null||h===void 0?void 0:h.texture},[100,400,400,400],"texel = vec4(vec3(unpackRGBAToDepth(texel)), 1.0);"))}_postFrame(){var e;super._postFrame(),this._viewer&&this.enabled&&this.bakedShadows&&((e=this._shadowBaker)===null||e===void 0||e.autoUpdateShadow())}_preRender(){super._preRender(),this._viewer&&(this._mesh.reflectionTargetNeedsUpdate=this._viewer.renderer.frameCount<1)}async onDispose(e){return super.onDispose(e)}async onRemove(e){return super.onRemove(e)}_removeMaterial(){var e,i,s,a;if(this._material){if(this._shadowBaker&&this._material.groundMatExtension&&((i=(e=this._material).unregisterMaterialExtensions)===null||i===void 0||i.call(e,[this._shadowBaker.materialExtension]),delete this._material.groundMatExtension),this._material.reflectorMatExtension){const h=this._mesh.materialExtension;h||console.warn("unable to find the extension to unregister"),(a=(s=this._material).unregisterMaterialExtensions)===null||a===void 0||a.call(s,[h]),delete this._material.reflectorMatExtension}super._removeMaterial()}}_onSceneUpdate(e){var i;super._onSceneUpdate(e),e.geometryChanged!==!1&&((i=this._shadowBaker)===null||i===void 0||i.reset())}refreshOptions(){if(!this._viewer)return;this.bakedShadows&&!this._shadowBaker?(this._shadowBaker=new Bp(this._viewer),this._shadowBaker.attachedMesh=this._mesh):!this.bakedShadows&&this._shadowBaker&&(this._shadowBaker.reset(),this._shadowBaker.cleanupMaterial());const e=this._mesh;e.isReflector2&&(e.enabled=this.groundReflection,e.reflectorModePhysical=this.physicalReflections),super.refreshOptions(),this._viewer.setDirty(this)}_refreshMaterial(){var e,i,s,a;if(!this._viewer)return!1;const h=super._refreshMaterial();if(!this._material)return h;if(this.groundReflection&&this._mesh.isReflector2&&!this._material.reflectorMatExtension){const d=this._mesh.materialExtension;d.updaters=[this._viewer.scene,this._viewer.renderer],(i=(e=this._material).registerMaterialExtensions)===null||i===void 0||i.call(e,[d]),this._material.reflectorMatExtension=!0}return this.bakedShadows&&this._shadowBaker&&!this._material.groundMatExtension&&((a=(s=this._material).registerMaterialExtensions)===null||a===void 0||a.call(s,[this._shadowBaker.materialExtension]),this._material.groundMatExtension=!0),this._material.materialObject.userData.ssreflDisabled=this.groundReflection,this._material.materialObject.userData.ssreflNonPhysical=!this.physicalReflections,this._viewer.setDirty(this),h}_extraUiConfig(){var e,i,s,a,h,d,_,et,nt,it,lt,ut,pt,gt,vt,Ct,wt,xt,_t,Pt,Bt,Ot,Lt,qt,en,cn,An,mn,Tn,vn;return[{label:"Baked Shadows",type:"checkbox",property:[this,"bakedShadows"]},{label:"Shadow Frames",type:"input",hidden:()=>!this._shadowBaker,stepSize:1,bounds:[1,1e3],property:[this._shadowBaker,"maxFrameNumber"]},{label:"Alpha Vignette",type:"checkbox",hidden:()=>!this._material||this._material.transmission<1e-4&&!this._material.transparent,property:[this._shadowBaker,"alphaVignette"],limitedUi:!0,onChange:()=>{var xn,Un;return(Un=(xn=this._uiConfig)===null||xn===void 0?void 0:xn.uiRefresh)===null||Un===void 0?void 0:Un.call(xn,"postFrame",!0)}},{label:"Alpha Vignette Axis",type:"dropdown",hidden:()=>{var xn;return!(!((xn=this._shadowBaker)===null||xn===void 0)&&xn.alphaVignette)||!this._material||this._material.transmission<1e-4&&!this._material.transparent},property:[this._shadowBaker,"alphaVignetteAxis"],children:["x","y","xy"].map(xn=>({label:xn,value:xn})),limitedUi:!0},{label:"Planar Reflections",type:"checkbox",property:[this,"groundReflection"],limitedUi:!0},{label:"Physical Reflections",type:"checkbox",property:[this,"physicalReflections"],limitedUi:!0},{label:"Shadow type",type:"dropdown",hidden:()=>!this._shadowBaker,property:[this._shadowBaker,"groundMapMode"],children:[{label:"aoMap"},{label:"map"},{label:"alphaMap"}],limitedUi:!0},{type:"folder",label:"Randomized Light",hidden:()=>!this._shadowBaker,limitedUi:!0,children:[{type:"color",label:"Color",property:[(e=this._shadowBaker)===null||e===void 0?void 0:e.light,"color"]},{type:"slider",label:"Intensity",bounds:[0,100],property:[(i=this._shadowBaker)===null||i===void 0?void 0:i.light,"intensity"]},{type:"checkbox",label:"Shadow Enabled",property:[(a=(s=this._shadowBaker)===null||s===void 0?void 0:s.light)===null||a===void 0?void 0:a.shadowParams,"enabled"],onChange:[(d=(h=this._shadowBaker)===null||h===void 0?void 0:h.light)===null||d===void 0?void 0:d.updateShadowParams,this._onSceneUpdate]},{type:"slider",bounds:[0,1],property:[(et=(_=this._shadowBaker)===null||_===void 0?void 0:_.light)===null||et===void 0?void 0:et.randomParams,"focus"],onChange:[this._onSceneUpdate]},{type:"slider",bounds:[0,1],property:[(it=(nt=this._shadowBaker)===null||nt===void 0?void 0:nt.light)===null||it===void 0?void 0:it.randomParams,"spread"],onChange:[this._onSceneUpdate],limitedUi:!0},{type:"slider",bounds:[.01,60],property:[(ut=(lt=this._shadowBaker)===null||lt===void 0?void 0:lt.light)===null||ut===void 0?void 0:ut.randomParams,"distanceScale"],onChange:[(gt=(pt=this._shadowBaker)===null||pt===void 0?void 0:pt.light)===null||gt===void 0?void 0:gt.updateShadowParams,this._onSceneUpdate]},{type:"vec3",bounds:[-1,1],property:[(Ct=(vt=this._shadowBaker)===null||vt===void 0?void 0:vt.light)===null||Ct===void 0?void 0:Ct.randomParams,"direction"],onChange:[this._onSceneUpdate],limitedUi:!0},{type:"vec3",bounds:[-1,1],property:[(xt=(wt=this._shadowBaker)===null||wt===void 0?void 0:wt.light)===null||xt===void 0?void 0:xt.randomParams,"normalDirection"],onChange:[this._onSceneUpdate],limitedUi:!0},{type:"slider",bounds:[.01,10],property:[(Pt=(_t=this._shadowBaker)===null||_t===void 0?void 0:_t.light)===null||Pt===void 0?void 0:Pt.shadowParams,"radius"],onChange:[(Ot=(Bt=this._shadowBaker)===null||Bt===void 0?void 0:Bt.light)===null||Ot===void 0?void 0:Ot.updateShadowParams,this._onSceneUpdate]},{type:"input",property:[(qt=(Lt=this._shadowBaker)===null||Lt===void 0?void 0:Lt.light)===null||qt===void 0?void 0:qt.shadowParams,"frustumSize"],onChange:[(cn=(en=this._shadowBaker)===null||en===void 0?void 0:en.light)===null||cn===void 0?void 0:cn.updateShadowParams,this._onSceneUpdate]},{type:"slider",bounds:[-.1,.1],property:[(mn=(An=this._shadowBaker)===null||An===void 0?void 0:An.light)===null||mn===void 0?void 0:mn.shadowParams,"bias"],onChange:[(vn=(Tn=this._shadowBaker)===null||Tn===void 0?void 0:Tn.light)===null||vn===void 0?void 0:vn.updateShadowParams,this._onSceneUpdate]}]},...super._extraUiConfig()]}}gp.PluginType="Ground",wx([pn(gp.prototype.refreshOptions),Fn()],gp.prototype,"bakedShadows",void 0),wx([pn(gp.prototype.refreshOptions),Fn()],gp.prototype,"groundReflection",void 0),wx([pn(gp.prototype.refreshOptions),Fn()],gp.prototype,"physicalReflections",void 0),wx([Fn("shadowBaker")],gp.prototype,"_shadowBaker",void 0);var D0,xu=function(c,e,i,s){var a,h=arguments.length,d=h<3?e:s===null?s=Object.getOwnPropertyDescriptor(e,i):s;if(typeof Reflect=="object"&&typeof Reflect.decorate=="function")d=Reflect.decorate(c,e,i,s);else for(var _=c.length-1;_>=0;_--)(a=c[_])&&(d=(h<3?a(d):h>3?a(e,i,d):a(e,i))||d);return h>3&&d&&Object.defineProperty(e,i,d),d};let ym=D0=class extends Tl{constructor(){super({vertexShader:yt.vertexShader,defines:{PASS_STEP:1},uniforms:{tSource:{value:null},tDiffuse:{value:null},opacity:{value:1},tDiffuseSize:{value:new b.FM8},weight:{value:1},tNormalDepth:{value:null}},fragmentShader:Fp+`
uniform float intensity;uniform float opacity;uniform vec2 tDiffuseSize;varying vec2 vUv;uniform float weight;
#if PASS_STEP == 0
uniform vec4 prefilter;vec4 Prefilter(vec4 c){if(getDepth(vUv)>0.999){return vec4(0.);}float brightness=max(c.r,max(c.g,c.b));float soft=brightness+prefilter.x*(prefilter.y-1.);soft=clamp(soft,0.,prefilter.z);soft=soft*soft*prefilter.w;float contribution=max(soft,brightness-prefilter.x);contribution/=max(brightness,0.001);return vec4(c.rgb*contribution,c.a);}
#endif
vec4 Sample(vec2 uv){return tDiffuseTexelToLinear(texture2D(tDiffuse,uv));}vec4 SampleBox(vec2 uv,float delta){vec4 o=vec2(-delta,delta).xxyy/tDiffuseSize.xyxy;vec4 s=Sample(uv+o.xy)+Sample(uv+o.zy)+Sample(uv+o.xw)+Sample(uv+o.zw);return s*0.25;}void main(){
#if PASS_STEP == 0 
gl_FragColor=weight*Prefilter(SampleBox(vUv,1.));gl_FragColor.a=1.;
#elif PASS_STEP == 1 
gl_FragColor=weight*(SampleBox(vUv,1.));gl_FragColor.a=1.;
#elif PASS_STEP == 2 
gl_FragColor=(SampleBox(vUv,0.5));gl_FragColor.a=1.;
#elif PASS_STEP == 3 
vec4 texel=tSourceTexelToLinear(texture2D(tSource,vUv));vec4 bloom=intensity*SampleBox(vUv,0.5).rgba;float brightness=max(bloom.r,max(bloom.g,bloom.b));texel.rgb+=bloom.rgb;texel.a=min(1.,texel.a+brightness);gl_FragColor=texel;
#elif PASS_STEP == 4 
vec4 texel=vec4(0.);texel.rgb+=intensity*SampleBox(vUv,0.5).rgb;texel.a=1.;gl_FragColor=texel;
#endif
#include <encodings_fragment>
}`},"tDiffuse","tSource"),this.uiConfig=void 0,this.prefilter=new b.Ltg(2,.5,0,0),this.threshold=2,this.softThreshold=.5,this.intensity=.5,this.bloomIterations=4,this.radius=.6,this.power=1,this.bloomDebug=!1,this._weights=[],this._updateWeights=this._updateWeights.bind(this),this._thresholdsUpdated=this._thresholdsUpdated.bind(this),this._updateWeights(),this._thresholdsUpdated(),this.clear=!0,this.userData={setDirty:()=>{this.setDirty()}}}_thresholdsUpdated(){this.prefilter.x=this.threshold,this.prefilter.y=this.softThreshold,this.prefilter.z=2*this.prefilter.x*this.prefilter.y,this.prefilter.w=.125/(this.uniforms.prefilter.value.z+1e-5)}render(c,e,i,s,a){const h=c.baseRenderer;this.material.defines.PASS_STEP=0,this.clear=!0;const d=i;let _=.5,et=d.width*_,nt=d.height*_;const it=[];let lt=h.getTempTarget({sizeMultiplier:.5,type:b.cLu});it.push(lt);let ut=d;this.material.needsUpdate=!0,this.material.uniforms.weight.value=this._weights[0],super.render(c,lt,ut,s,a),ut=lt;let pt=1;for(;pt<this.bloomIterations&&(et/=2,nt/=2,_/=2,!(nt<2||et<2));pt++){lt=h.getTempTarget({sizeMultiplier:_,type:b.cLu}),it.push(lt),this.material.defines.PASS_STEP=1;let vt=this._weights[pt];vt=this._weights[pt-1]!==0?this._weights[pt]/this._weights[pt-1]:this._weights[pt],this.material.uniforms.weight.value=vt,this.material.needsUpdate=!0,super.render(c,lt,ut,s,a),ut=lt}this.clear=!1;const gt=c.autoClear;for(c.autoClear=!1,pt-=2;pt>=0;pt--)lt=it[pt],it[pt]=void 0,this.material.defines.PASS_STEP=2,this.material.transparent=!0,this.material.blending=b.WMw,this.material.needsUpdate=!0,c.autoClear=!1,super.render(c,lt,ut,s,a),this.material.blending=b.jFi,h.releaseTempTarget(ut),ut=lt;this.clear=!0,c.autoClear=gt,c.autoClear=!0,this.bloomDebug?(this.material.defines.PASS_STEP=4,this.material.needsUpdate=!0,super.render(c,e,ut,s,a)):(this.uniforms.tSource.value=d.texture,this.material.defines.PASS_STEP=3,this.material.needsUpdate=!0,super.render(c,e,ut,s,a),this.uniforms.tSource.value=null),h.releaseTempTarget(ut)}_updateWeights(){if(!this._weights)return;const c=Math.max(Math.min(this.radius,1),0),e=1/(this.bloomIterations-1);for(let i=0;i<this.bloomIterations;i++){let s=i*e+.1,a=1.2-s;s=Math.pow(s,this.power),a=Math.pow(a,this.power),this._weights[i]=a*(1-c)+s*c}this.setDirty()}};xu([rn()],ym.prototype,"prefilter",void 0),xu([ss("Threshold",[0,2]),pn(D0.prototype._thresholdsUpdated),Fn()],ym.prototype,"threshold",void 0),xu([ss("Soft Threshold",[0,1]),pn(D0.prototype._thresholdsUpdated),Fn()],ym.prototype,"softThreshold",void 0),xu([ss("Intensity",[0,3]),Fn(),rn()],ym.prototype,"intensity",void 0),xu([ss("Iterations",[0,7],1),pn(D0.prototype._updateWeights),Fn()],ym.prototype,"bloomIterations",void 0),xu([ss("Radius",[0,1],.01),pn(D0.prototype._updateWeights),Fn()],ym.prototype,"radius",void 0),xu([ss("Power",[.2,10],.01),pn(D0.prototype._updateWeights),Fn()],ym.prototype,"power",void 0),xu([ts("Debug")],ym.prototype,"bloomDebug",void 0),ym=D0=xu([Ys("Bloom")],ym);class xx extends Am{constructor(){super(...arguments),this.passId="bloom",this._beforeFilters=["combinedPost","screen"],this._afterFilters=["render","progressive"],this._requiredFilters=["render"]}passCtor(e){return new ym}_update(e){var i,s;return(i=e.getPlugin(ho))===null||i===void 0||i.updateShaderProperties((s=this.pass)===null||s===void 0?void 0:s.passObject.material),super._update(e)}get uiConfig(){var e;return(e=this.pass)===null||e===void 0?void 0:e.passObject.uiConfig}}xx.PluginType="Bloom";var QA=function(c,e,i,s){var a,h=arguments.length,d=h<3?e:s===null?s=Object.getOwnPropertyDescriptor(e,i):s;if(typeof Reflect=="object"&&typeof Reflect.decorate=="function")d=Reflect.decorate(c,e,i,s);else for(var _=c.length-1;_>=0;_--)(a=c[_])&&(d=(h<3?a(d):h>3?a(e,i,d):a(e,i))||d);return h>3&&d&&Object.defineProperty(e,i,d),d};let Wp=class extends Ls{constructor(){super(),this.enabled=!0,this.dependencies=[qr],this._defines={ANISOTROPY_DEBUG:!1},this._uniforms={anisotropyFactor:{value:1},anisotropyNoise:{value:1},anisotropyDirection:{value:1},anisotropyDirectionMap:{value:null},frameCount:{value:0}},this.materialExtension={shaderExtender:(c,e,i)=>{var s;if(!this.enabled||!e.materialObject.userData._isAnisotropic)return;const a=(s=e.materialObject.userData)===null||s===void 0?void 0:s._anisotropyDirectionMap,h=Qt`
                #include <bsdfs>
                //#if ANISOTROPY_ENABLED
                ${Jm}
                ${`uniform float anisotropyFactor;uniform float anisotropyNoise;
#if ANISOTROPY_TEX_MODE == 0
uniform float anisotropyDirection;
#else
uniform sampler2D anisotropyDirectionMap;
#endif
const float MIN_ROUGHNESS=0.05;float D_GGX_Anisotropy(float at,float ab,float ToH,float BoH,float NoH){float a2=at*ab;highp vec3 d=vec3(ab*ToH,at*BoH,a2*NoH);highp float d2=dot(d,d);float b2=a2/d2;return a2*b2*b2*(1./PI);}float V_GGX_SmithCorrelated_Anisotropy(float at,float ab,float ToV,float BoV,float ToL,float BoL,float NoV,float NoL){float lambdaV=NoL*length(vec3(at*ToV,ab*BoV,NoV));float lambdaL=NoV*length(vec3(at*ToL,ab*BoL,NoL));float v=0.5/(lambdaV+lambdaL);return saturate(v);}vec3 indirectAnisotropyBentNormal(const in vec3 normal,const in vec3 viewDir,const in float roughness,const in vec3 anisotropicT,const in vec3 anisotropicB){vec3 aDirection=anisotropyFactor>=0.?anisotropicB:anisotropicT;vec3 aTangent=cross(aDirection,viewDir);vec3 aNormal=cross(aTangent,aDirection);float bendFactor=abs(anisotropyFactor)*saturate(5.*max(roughness,MIN_ROUGHNESS));return normalize(mix(normal,aNormal,bendFactor));}vec3 BRDF_GGX_Anisotropy(const in vec3 lightDir,const in vec3 viewDir,const in vec3 normal,const in vec3 f0,const in float f90,const in float roughness,const in vec3 anisotropicT,const in vec3 anisotropicB){float alpha=pow2(roughness);vec3 halfDir=normalize(lightDir+viewDir);float dotNL=saturate(dot(normal,lightDir));float dotNV=saturate(dot(normal,viewDir));float dotNH=saturate(dot(normal,halfDir));float dotVH=saturate(dot(viewDir,halfDir));float dotTV=dot(anisotropicT,viewDir);float dotBV=dot(anisotropicB,viewDir);float dotTL=dot(anisotropicT,lightDir);float dotBL=dot(anisotropicB,lightDir);float dotTH=dot(anisotropicT,halfDir);float dotBH=dot(anisotropicB,halfDir);float aspect=sqrt(1.-min(1.-MIN_ROUGHNESS,abs(anisotropyFactor)*0.9));if(anisotropyFactor>0.)aspect=1./aspect;float at=roughness*aspect;float ab=roughness/aspect;vec3 F=F_Schlick(f0,f90,dotVH);float V=V_GGX_SmithCorrelated_Anisotropy(at,ab,dotTV,dotBV,dotTL,dotBL,dotNV,dotNL);float D=D_GGX_Anisotropy(at,ab,dotTH,dotBH,dotNH);return F*(V*D);}`}
            `+(a?$n("anisotropyDirectionMap",a,i.capabilities.isWebGL2):"");c.fragmentShader=c.fragmentShader.replace("#include <bsdfs>",h),c.fragmentShader=c.fragmentShader.replace("#include <lights_fragment_begin>",b.WdD.lights_fragment_begin),c.fragmentShader=c.fragmentShader.replace("IncidentLight directLight;",`float rnd=(random2(vUv.xy,frameCount)-0.5)*anisotropyNoise*material.roughness;
#if ANISOTROPY_TEX_MODE < 2
#if ANISOTROPY_TEX_MODE == 0 
float rot=saturate(anisotropyDirection);
#else 
float rot=(anisotropyDirectionMapTexelToLinear(texture2D(anisotropyDirectionMap,vUv)).r);
#endif
rot=rot*2.*PI+rnd;vec2 rot2=vec2(sin(rot),cos(rot));
#else 
vec2 rot2=(anisotropyDirectionMapTexelToLinear(texture2D(anisotropyDirectionMap,vUv)).rg*2.-1.)+vec2(rnd,rnd);rot2=normalize(rot2);const float anisoSpecMultiplier=0.25;float matSpecAniso=(length(material.specularColor.rgb))*2.*PI;rot2=mix(rot2,vec2(sin(matSpecAniso),cos(matSpecAniso)),anisoSpecMultiplier);rot2=normalize(rot2);
#endif
vec3 anisotropicT=(tangent*rot2.x+bitangent*rot2.y);anisotropicT=normalize(anisotropicT-normal*dot(anisotropicT,normal));vec3 anisotropicB=normalize(cross(normal,anisotropicT));IncidentLight directLight;`).replaceAll("RE_Direct( directLight, geometry, material, reflectedLight )","RE_Direct( directLight, geometry, material, reflectedLight, anisotropicT, anisotropicB )");const d=b.WdD.lights_physical_pars_fragment.replace("void RE_Direct_Physical( const in IncidentLight directLight, const in GeometricContext geometry, const in PhysicalMaterial material, inout ReflectedLight reflectedLight ) {","void RE_Direct_Physical( const in IncidentLight directLight, const in GeometricContext geometry, const in PhysicalMaterial material, inout ReflectedLight reflectedLight, const in vec3 anisotropicT, const in vec3 anisotropicB ) {").replace("BRDF_GGX( directLight.direction, geometry.viewDir, geometry.normal, material.specularColor, material.specularF90, material.roughness )","BRDF_GGX_Anisotropy( directLight.direction, geometry.viewDir, geometry.normal, material.specularColor, material.specularF90, material.roughness, anisotropicT, anisotropicB )");c.fragmentShader=c.fragmentShader.replace("#include <lights_physical_pars_fragment>",d);const _=Qt`
                #if defined( USE_ENVMAP )
                vec3 anisotropyBentNormal = indirectAnisotropyBentNormal(geometry.normal, geometry.viewDir, material.roughness, anisotropicT, anisotropicB);
                #endif
            `+b.WdD.lights_fragment_maps.replace("getIBLIrradiance( geometry.normal )","getIBLIrradiance( anisotropyBentNormal )").replace("getIBLRadiance( geometry.viewDir, geometry.normal, material.roughness )","getIBLRadiance( geometry.viewDir, anisotropyBentNormal, material.roughness )");c.fragmentShader=c.fragmentShader.replace("#include <lights_fragment_maps>",_),c.vertexUvs=!0,c.vertexTangents=!0},onObjectRender:(c,e)=>{var i;const s=e.materialObject.userData;if(!(s!=null&&s._isAnisotropic))return;const a=c;if(!a.isMesh||!a.geometry)return;if(!a.geometry.attributes.tangent)throw new Error("No tangents on the geometry");this._uniforms.anisotropyFactor.value=s._anisotropyFactor,this._uniforms.anisotropyNoise.value=s._anisotropyNoise,this._uniforms.anisotropyDirectionMap.value=!((i=s._anisotropyDirectionMap)===null||i===void 0)&&i.isTexture?s._anisotropyDirectionMap:null,this._uniforms.anisotropyDirection.value=s._anisotropyDirection;let h=this.enabled?1:0;e.materialObject.defines.ANISOTROPY_ENABLED!==h&&(e.materialObject.defines.ANISOTROPY_ENABLED=h,e.materialObject.needsUpdate=!0),h=+this._defines.ANISOTROPY_DEBUG,e.materialObject.defines.ANISOTROPY_DEBUG!==h&&(e.materialObject.defines.ANISOTROPY_DEBUG=h,e.materialObject.needsUpdate=!0),h=s._anisotropyDirectionMode,this._uniforms.anisotropyDirectionMap.value||(h="CONSTANT"),h=h==="DIRECTION"?2:h==="ROTATION"?1:0,e.materialObject.defines.ANISOTROPY_TEX_MODE!==h&&(e.materialObject.defines.ANISOTROPY_TEX_MODE=h,e.materialObject.needsUpdate=!0)},extraUniforms:{...this._uniforms},computeCacheKey:c=>{var e,i,s;return(this.enabled?"1":"0")+(!((e=c.materialObject.userData)===null||e===void 0)&&e._isAnisotropic?"1":"0")+((s=(i=c.materialObject.userData)===null||i===void 0?void 0:i._anisotropyDirectionMap)===null||s===void 0?void 0:s.uuid)},isCompatible:c=>c.isMeshStandardMaterial2,updaters:()=>{var c;return[(c=this._viewer)===null||c===void 0?void 0:c.renderer]},getUiConfig:c=>{const e=this._viewer,i=this.makeAnisotropic,s={type:"folder",label:"Anisotropy",children:[{type:"checkbox",label:"Enabled",get value(){return c.materialObject.userData._isAnisotropic||!1},set value(a){var h;a!==c.materialObject.userData._isAnisotropic&&(a?i(c)||e.alert("One or more geometries cannot be made anisotropic."):(c.materialObject.userData._isAnisotropic=!1,c.materialObject.needsUpdate=!0),(h=s.uiRefresh)===null||h===void 0||h.call(s,"postFrame",!0))},onChange:this.setDirty},{type:"slider",label:"Factor",bounds:[-2,2],hidden:()=>!c.materialObject.userData._isAnisotropic,property:[c.materialObject.userData,"_anisotropyFactor"],onChange:this.setDirty},{type:"slider",label:"Noise",bounds:[0,2],hidden:()=>!c.materialObject.userData._isAnisotropic,property:[c.materialObject.userData,"_anisotropyNoise"],onChange:this.setDirty},{type:"image",label:"Texture",hidden:()=>!c.materialObject.userData._isAnisotropic,property:[c.materialObject.userData,"_anisotropyDirectionMap"],onChange:()=>{c.materialObject.needsUpdate=!0,this.setDirty()}},{type:"dropdown",label:"Mode",hidden:()=>!c.materialObject.userData._isAnisotropic,property:[c.materialObject.userData,"_anisotropyDirectionMode"],children:["CONSTANT","ROTATION","DIRECTION"].map(a=>({label:a})),onChange:()=>{c.materialObject.needsUpdate=!0,this.setDirty()}}]};return s}},this.setDirty=()=>{var c;(c=this._viewer)===null||c===void 0||c.setDirty()},this.makeSelectedAnisotropic=()=>{var c,e,i;const s=(i=(e=(c=this._viewer)===null||c===void 0?void 0:c.getPlugin(ro))===null||e===void 0?void 0:e.getSelectedObject())===null||i===void 0?void 0:i.material;return(s==null?void 0:s.assetType)==="material"&&this.makeAnisotropic(s)},this._loaderCreate=this._loaderCreate.bind(this)}makeAnisotropic(c){var e;const i=(e=c.materialObject)===null||e===void 0?void 0:e.userData;if(!i)return!1;if(i._isAnisotropic===void 0){const s=i.__appliedMeshes;let a=!0;if(s)for(const{geometry:h}of s)!h||h.index&&h.attributes.position&&h.attributes.normal&&h.attributes.uv||(a=!1),a&&!h.attributes.tangent&&h.computeTangents();if(!a)return!1}return i._isAnisotropic=!0,i._anisotropyFactor===void 0&&(i._anisotropyFactor=1),i._anisotropyNoise===void 0&&(i._anisotropyNoise=0),i._anisotropyDirectionMode===void 0&&(i._anisotropyDirectionMode="DIRECTION"),c.materialObject.needsUpdate=!0,!0}_loaderCreate({loader:c}){c.isGLTFLoader2&&c.register(e=>new bx(e))}async onAdded(c){var e,i,s,a,h;await super.onAdded(c);const d=c.getPlugin(qr);(e=d==null?void 0:d.materials)===null||e===void 0||e.registerMaterialExtension(this.materialExtension),(i=d==null?void 0:d.importer)===null||i===void 0||i.addEventListener("loaderCreate",this._loaderCreate),(h=(a=(s=d==null?void 0:d.exporter)===null||s===void 0?void 0:s.getExporter("gltf","glb"))===null||a===void 0?void 0:a.extensions)===null||h===void 0||h.push($y)}async onRemove(c){var e,i,s,a;return(i=(e=c.getPlugin(qr))===null||e===void 0?void 0:e.materials)===null||i===void 0||i.unregisterMaterialExtension(this.materialExtension),(a=(s=c.getPlugin(qr))===null||s===void 0?void 0:s.importer)===null||a===void 0||a.removeEventListener("loaderCreate",this._loaderCreate),super.onRemove(c)}};Wp.PluginType="AnisotropyPlugin",Wp.ANISOTROPY_GLTF_EXTENSION="WEBGI_materials_anisotropy",QA([ts("Enabled",c=>({onChange:c.setDirty})),Fn()],Wp.prototype,"enabled",void 0),QA([uo("Make Anisotropy",c=>({hidden:()=>{var e;return!(!((e=c._viewer)===null||e===void 0)&&e.getPlugin(ro))}}))],Wp.prototype,"makeSelectedAnisotropic",void 0),Wp=QA([Ys("Anisotropy Materials")],Wp);class bx{constructor(e){this.parser=e,this.name=Wp.ANISOTROPY_GLTF_EXTENSION}async extendMaterialParams(e,i){var s,a,h;const d=this.parser,_=d.json.materials[e];if(!_.extensions||!_.extensions[this.name])return Promise.resolve();const et=[],nt=_.extensions[this.name];i.userData||(i.userData={}),i.userData._isAnisotropic=!0,i.userData._anisotropyFactor=(s=nt.anisotropyFactor)!==null&&s!==void 0?s:0,i.userData._anisotropyNoise=(h=(a=nt.anisotropyNoiseFactor)!==null&&a!==void 0?a:nt.anisotropyNoise)!==null&&h!==void 0?h:0;let{anisotropyDirectionMode:it,anisotropyDirection:lt}=nt;return it||(it=nt.anisotropyTextureMode),lt||(lt=nt.anisotropyRotation),i.userData._anisotropyDirectionMode=it&&typeof(lt==null?void 0:lt.index)=="number"?it:"CONSTANT",it==="ROTATION"||it==="DIRECTION"?et.push(d.assignTexture(i.userData,"_anisotropyDirectionMap",lt).then(ut=>{ut.encoding=b.knz})):i.userData._anisotropyDirection=lt??0,Promise.all(et)}afterRoot(e){return e.scene.traverse(i=>{var s,a;if(!(!((a=(s=i.material)===null||s===void 0?void 0:s.userData)===null||a===void 0)&&a._isAnisotropic))return;const h=i.geometry;h.attributes.tangent||(h.computeTangents(),h.attributes.tangent.needsUpdate=!0)}),null}}const $y=c=>({writeMaterial:(e,i)=>{if(!e.isMeshStandardMaterial||!e.userData._isAnisotropic||(e.userData._anisotropyFactor||0)<.001)return;i.extensions=i.extensions||{};const s={};if(s.anisotropyFactor=e.userData._anisotropyFactor||1,s.anisotropyNoiseFactor=e.userData._anisotropyNoise||0,s.anisotropyDirectionMode=e.userData._anisotropyDirectionMode||"CONSTANT",e.userData._anisotropyDirectionMap&&s.anisotropyDirectionMode!=="CONSTANT"){const a={index:c.processTexture(e.userData._anisotropyDirectionMap)};c.applyTextureTransform(a,e.userData._anisotropyDirectionMap),s.anisotropyDirection=a}else s.anisotropyDirectionMode="CONSTANT",s.anisotropyDirection=e.userData._anisotropyDirection||0;i.extensions[Wp.ANISOTROPY_GLTF_EXTENSION]=s,c.extensionsUsed[Wp.ANISOTROPY_GLTF_EXTENSION]=!0}});var ew=function(c,e,i,s){var a,h=arguments.length,d=h<3?e:s===null?s=Object.getOwnPropertyDescriptor(e,i):s;if(typeof Reflect=="object"&&typeof Reflect.decorate=="function")d=Reflect.decorate(c,e,i,s);else for(var _=c.length-1;_>=0;_--)(a=c[_])&&(d=(h<3?a(d):h>3?a(e,i,d):a(e,i))||d);return h>3&&d&&Object.defineProperty(e,i,d),d};let $u=class extends Ls{constructor(){super(),this.enabled=!0,this.dependencies=[qr],this._defines={},this._uniforms={thinBaseLayerFactors:{value:new b.Ltg},thinNoiseLayerFactors:{value:new b.Ltg},thinColorNoiseParams:{value:new b.Ltg},thinFilmFactor:{value:.8}},this.materialExtension={parsFragmentSnippet:(c,e)=>{var i;return this.enabled&&(!((i=e==null?void 0:e.materialObject.userData._thinFilmLayer)===null||i===void 0)&&i.hasThinFilm)?Jm+`
#ifndef VORONOISE_HELPER
#define VORONOISE_HELPER 
float voronoise(in vec2 p,float u,float v){float k=1.+63.*pow(1.-v,6.);vec2 i=floor(p);vec2 f=fract(p);vec2 a=vec2(0.,0.);for(int y=-2;y<=2;y++)for(int x=-2;x<=2;x++){vec2 g=vec2(x,y);vec3 o=hash3(i+g)*vec3(u,u,1.);vec2 d=g-f+o.xy;float w=pow(1.-smoothstep(0.,1.414,length(d)),k);a+=vec2(o.z*w,w);}return a.x/a.y;}vec3 voronoise3(vec2 p,float u,float v){return vec3(voronoise(p,u,v),voronoise(p+vec2(0.435,0.23),u,v),voronoise(p-vec2(0.83,0.45),u,v));}vec3 voronoiseNormal(vec2 p,float u,float v){return vec3(voronoise(p,u,v),voronoise(p+vec2(0.435,0.23),u,v),1.);}
#endif

#ifndef HSV_HELPERS
#define HSV_HELPERS 
vec3 hsv2rgb(vec3 c){vec4 K=vec4(1.,2./3.,1./3.,3.);vec3 p=abs(fract(c.xxx+K.xyz)*6.-K.www);return c.z*mix(K.xxx,clamp(p-K.xxx,0.,1.),c.y);}vec3 rgb2hsv(vec3 c){vec4 K=vec4(0.,-1./3.,2./3.,-1.);vec4 p=c.g<c.b?vec4(c.bg,K.wz):vec4(c.gb,K.xy);vec4 q=c.r<p.x?vec4(p.xyw,c.r):vec4(c.r,p.yzx);float d=q.x-min(q.w,q.y);float e=1.0e-10;return vec3(abs(q.z+(q.w-q.y)/(6.*d+e)),d/(q.x+e),q.x);}
#endif 

uniform vec4 thinBaseLayerFactors;
uniform vec4 thinNoiseLayerFactors;
uniform vec4 thinColorNoiseParams;
uniform float thinFilmFactor;
        `:""},shaderExtender:(c,e,i)=>{var s;if(!this.enabled||!(!((s=e.materialObject.userData._thinFilmLayer)===null||s===void 0)&&s.hasThinFilm))return;const a="#glMarker beforeAccumulation";c.fragmentShader=c.fragmentShader.replace(a,"vec3 incident=normalize(vViewPosition.xyz);float hWeight=1.-dot(normal,incident);vec3 noiseV=voronoise3(vUv.xy*thinColorNoiseParams.xy*60.,thinColorNoiseParams.z,thinColorNoiseParams.w);float hWeight2=1.-dot(normalize(noiseV),incident);vec3 film=hsv2rgb(vec3(fract(hWeight+thinBaseLayerFactors.x),thinBaseLayerFactors.y,thinBaseLayerFactors.z))*thinBaseLayerFactors.a;vec3 film2=hsv2rgb(vec3(fract(hWeight2+thinNoiseLayerFactors.x),thinNoiseLayerFactors.y,thinNoiseLayerFactors.z))*thinNoiseLayerFactors.a;film=(film+film2)/(thinBaseLayerFactors.a+thinNoiseLayerFactors.a);diffuseColor.rgb=mix(diffuseColor.rgb,film,thinFilmFactor);"+a),c.vertexUvs=!0},onObjectRender:(c,e)=>{var i;const s=(i=e.materialObject.userData)===null||i===void 0?void 0:i._thinFilmLayer;if(!(s!=null&&s.hasThinFilm))return;this._uniforms.thinBaseLayerFactors.value.fromArray(s.baseLayerFactors),this._uniforms.thinNoiseLayerFactors.value.fromArray(s.noiseLayerFactors),this._uniforms.thinColorNoiseParams.value.fromArray(s.colorNoiseParams),this._uniforms.thinFilmFactor.value=s.filmFactor;const a=this.enabled?1:0;e.materialObject.defines.THIN_FILM_LAYER_ENABLED!==a&&(e.materialObject.defines.THIN_FILM_LAYER_ENABLED=a,e.materialObject.needsUpdate=!0)},extraUniforms:{...this._uniforms},computeCacheKey:c=>{var e,i;return(this.enabled?"1":"0")+(!((i=(e=c.materialObject.userData)===null||e===void 0?void 0:e._thinFilmLayer)===null||i===void 0)&&i.hasThinFilm?"1":"0")},isCompatible:c=>c.isMeshStandardMaterial2,updaters:()=>[],getUiConfig:c=>{const e=this._viewer,i={type:"folder",label:"ThinFilmLayer",children:[{type:"checkbox",label:"Enabled",get value(){var s;return((s=c.materialObject.userData._thinFilmLayer)===null||s===void 0?void 0:s.hasThinFilm)||!1},set value(s){var a,h;s!==((a=c.materialObject.userData._thinFilmLayer)===null||a===void 0?void 0:a.hasThinFilm)&&(s?M_(c.materialObject)||e.alert("Cannot add thin film."):(c.materialObject.userData._thinFilmLayer.hasThinFilm=!1,c.materialObject.needsUpdate=!0),(h=i.uiRefresh)===null||h===void 0||h.call(i,"postFrame",!0))},onChange:this.setDirty},()=>({type:"slider",bounds:[0,1],label:"Intensity",hidden:()=>{var s;return!(!((s=c.materialObject.userData._thinFilmLayer)===null||s===void 0)&&s.hasThinFilm)},property:[c.materialObject.userData._thinFilmLayer,"filmFactor"],onChange:this.setDirty}),()=>({type:"vec4",label:"Base Layer",bounds:[0,1],hidden:()=>{var s;return!(!((s=c.materialObject.userData._thinFilmLayer)===null||s===void 0)&&s.hasThinFilm)},property:[c.materialObject.userData._thinFilmLayer,"baseLayerFactors"],onChange:this.setDirty}),()=>({type:"vec4",label:"Noise Layer",bounds:[0,1],hidden:()=>{var s;return!(!((s=c.materialObject.userData._thinFilmLayer)===null||s===void 0)&&s.hasThinFilm)},property:[c.materialObject.userData._thinFilmLayer,"noiseLayerFactors"],onChange:this.setDirty}),()=>({type:"vec4",label:"Noise Params",bounds:[0,1],hidden:()=>{var s;return!(!((s=c.materialObject.userData._thinFilmLayer)===null||s===void 0)&&s.hasThinFilm)},property:[c.materialObject.userData._thinFilmLayer,"colorNoiseParams"],onChange:this.setDirty})]};return i}},this.setDirty=()=>{var c;(c=this._viewer)===null||c===void 0||c.setDirty()},this._loaderCreate=this._loaderCreate.bind(this)}addThinFilmLayer(c){return M_(c.materialObject)}_loaderCreate({loader:c}){c.isGLTFLoader2&&c.register(e=>new Ex(e))}async onAdded(c){var e,i,s,a,h;await super.onAdded(c);const d=c.getPlugin(qr);(e=d==null?void 0:d.materials)===null||e===void 0||e.registerMaterialExtension(this.materialExtension),(i=d==null?void 0:d.importer)===null||i===void 0||i.addEventListener("loaderCreate",this._loaderCreate),(h=(a=(s=d==null?void 0:d.exporter)===null||s===void 0?void 0:s.getExporter("gltf","glb"))===null||a===void 0?void 0:a.extensions)===null||h===void 0||h.push(Sx)}async onRemove(c){var e,i,s,a;return(i=(e=c.getPlugin(qr))===null||e===void 0?void 0:e.materials)===null||i===void 0||i.unregisterMaterialExtension(this.materialExtension),(a=(s=c.getPlugin(qr))===null||s===void 0?void 0:s.importer)===null||a===void 0||a.removeEventListener("loaderCreate",this._loaderCreate),super.onRemove(c)}};function M_(c){const e=c==null?void 0:c.userData;if(!e)return!1;e._thinFilmLayer||(e._thinFilmLayer={});const i=e._thinFilmLayer;return i.hasThinFilm=!0,i.baseLayerFactors===void 0&&(i.baseLayerFactors=[.3,.6,1,.9]),i.noiseLayerFactors===void 0&&(i.noiseLayerFactors=[.7,.5,.9,.7]),i.colorNoiseParams===void 0&&(i.colorNoiseParams=[.5,.5,.5,.7]),i.filmFactor===void 0&&(i.filmFactor=.3),c.isMaterial&&(c.needsUpdate=!0),!0}$u.PluginType="ThinFilmLayerPlugin",$u.THIN_FILM_LAYER_GLTF_EXTENSION="WEBGI_materials_thin_film_layer",ew([ts("Enabled",c=>({onChange:c.setDirty})),Fn()],$u.prototype,"enabled",void 0),$u=ew([Ys("ThinFilmLayer Materials")],$u);class Ex{constructor(e){this.parser=e,this.name=$u.THIN_FILM_LAYER_GLTF_EXTENSION}async extendMaterialParams(e,i){const s=this.parser.json.materials[e];if(!s.extensions||!s.extensions[this.name])return Promise.resolve();const a=s.extensions[this.name];return i.userData||(i.userData={}),M_(i),i.userData._thinFilmLayer=to(a,i.userData._thinFilmLayer,!1,{}),Promise.resolve()}}const Sx=c=>({writeMaterial:(e,i)=>{if(!e.isMeshStandardMaterial||!e.userData._thinFilmLayer||!e.userData._thinFilmLayer.hasThinFilm)return;i.extensions=i.extensions||{};const s=ao(e.userData._thinFilmLayer,!1);i.extensions[$u.THIN_FILM_LAYER_GLTF_EXTENSION]=s,c.extensionsUsed[$u.THIN_FILM_LAYER_GLTF_EXTENSION]=!0}});var tw=function(c,e,i,s){var a,h=arguments.length,d=h<3?e:s===null?s=Object.getOwnPropertyDescriptor(e,i):s;if(typeof Reflect=="object"&&typeof Reflect.decorate=="function")d=Reflect.decorate(c,e,i,s);else for(var _=c.length-1;_>=0;_--)(a=c[_])&&(d=(h<3?a(d):h>3?a(e,i,d):a(e,i))||d);return h>3&&d&&Object.defineProperty(e,i,d),d};let _h=class extends Ls{constructor(){super(),this.enabled=!0,this.dependencies=[qr],this._defines={},this._uniforms={noiseBumpParams:{value:new b.FM8},noiseBumpScale:{value:.05},noiseBumpFlakeScale:{value:1e3},noiseFlakeClamp:{value:1},noiseFlakeRadius:{value:.5},noiseFlakeRoughnessMod:{value:1}},this.materialExtension={parsFragmentSnippet:(c,e)=>{var i;return this.enabled&&(!((i=e==null?void 0:e.materialObject.userData._noiseBumpMat)===null||i===void 0)&&i.hasBump)?Jm+`
#ifndef VORONOI_HELPER
#define VORONOI_HELPER 
float voronoi_distance(vec2 a,vec2 b,float metric){return distance(a,b);}float voronoi_f1_2d(in vec2 coord,in float randomness,in float flakeClamp,in float flakeRadius,inout vec3 outColor){vec2 cellPosition=floor(coord);vec2 localPosition=coord-cellPosition;float minDistance=8.;vec2 targetOffset,targetPosition;for(int j=-1;j<=1;j++){for(int i=-1;i<=1;i++){vec2 cellOffset=vec2(i,j);vec2 pointPosition=cellOffset+hash3(cellPosition+cellOffset).xy*randomness;float distanceToPoint=voronoi_distance(pointPosition,localPosition,1.);if(distanceToPoint<minDistance){targetOffset=cellOffset;minDistance=distanceToPoint;targetPosition=pointPosition;}}}float outDistance=minDistance;float dist=step(flakeRadius,outDistance);outColor=hash3(cellPosition+hash3(cellPosition+targetOffset).xy*randomness+targetOffset);vec3 outColor1=minDistance<flakeRadius?outColor:vec3(0.5,0.5,1.);outDistance=mix(dist,minDistance,flakeClamp);outColor=mix(outColor1,outColor,flakeClamp);return outDistance;}
#endif

uniform vec2 noiseBumpParams;uniform float noiseBumpScale;uniform float noiseBumpFlakeScale;uniform float noiseFlakeClamp;uniform float noiseFlakeRadius;uniform float noiseFlakeRoughnessMod;vec3 perturbNormalArb_nb(vec3 surf_pos,vec3 surf_norm,vec2 dHdxy,float faceDirection){vec3 vSigmaX=dFdx(surf_pos.xyz);vec3 vSigmaY=dFdy(surf_pos.xyz);vec3 vN=surf_norm;vec3 R1=cross(vSigmaY,vN);vec3 R2=cross(vN,vSigmaX);float fDet=dot(vSigmaX,R1)*faceDirection;vec3 vGrad=sign(fDet)*(dHdxy.x*R1+dHdxy.y*R2);return normalize(abs(fDet)*surf_norm-vGrad);}
`:""},shaderExtender:(c,e,i)=>{var s;if(!this.enabled||!(!((s=e.materialObject.userData._noiseBumpMat)===null||s===void 0)&&s.hasBump))return;const a="#glMarker beforeAccumulation";c.fragmentShader=c.fragmentShader.replace(a,`
            vec3 outColor; 
            float voronoiDist = clamp(voronoi_f1_2d( noiseBumpFlakeScale * noiseBumpParams.xy * vUv, 1., noiseFlakeClamp, noiseFlakeRadius, outColor ), 0.0, 1.0);
            normal = perturbNormalArb_nb( - vViewPosition, normal, (2. * outColor.xy - 1.) * noiseBumpScale, faceDirection ); 
            float avg = (outColor.r + outColor.g)*0.5; 
            diffuseColor *= (clamp(avg+0.5, 0.3, 1.));
            float roughnessModifier = mix(1. - avg, 1., noiseFlakeRoughnessMod);
            roughnessFactor *= roughnessModifier;
            
`+a),c.vertexUvs=!0,c.extensionDerivatives=!0},onObjectRender:(c,e)=>{var i;const s=(i=e.materialObject.userData)===null||i===void 0?void 0:i._noiseBumpMat;if(!(s!=null&&s.hasBump))return;this._uniforms.noiseBumpParams.value.fromArray(s.bumpNoiseParams),this._uniforms.noiseBumpScale.value=s.bumpScale,this._uniforms.noiseBumpFlakeScale.value=s.flakeScale,this._uniforms.noiseFlakeClamp.value=s.flakeClamp,this._uniforms.noiseFlakeRadius.value=s.flakeRadius,this._uniforms.noiseFlakeRoughnessMod.value=s.flakeRoughnessMod;const a=this.enabled?1:0;e.materialObject.defines.NOISE_BUMP_MATERIAL_ENABLED!==a&&(e.materialObject.defines.NOISE_BUMP_MATERIAL_ENABLED=a,e.materialObject.needsUpdate=!0)},extraUniforms:{...this._uniforms},computeCacheKey:c=>{var e,i;return(this.enabled?"1":"0")+(!((i=(e=c.materialObject.userData)===null||e===void 0?void 0:e._noiseBumpMat)===null||i===void 0)&&i.hasBump?"1":"0")},isCompatible:c=>c.isMeshStandardMaterial2,updaters:()=>[],getUiConfig:c=>{const e=this._viewer,i={type:"folder",label:"NoiseBumpMaterial",children:[{type:"checkbox",label:"Enabled",get value(){var s;return((s=c.materialObject.userData._noiseBumpMat)===null||s===void 0?void 0:s.hasBump)||!1},set value(s){var a,h;s!==((a=c.materialObject.userData._noiseBumpMat)===null||a===void 0?void 0:a.hasBump)&&(s?_E(c.materialObject)||e.alert("Cannot add noise bump."):(c.materialObject.userData._noiseBumpMat.hasBump=!1,c.materialObject.needsUpdate=!0),(h=i.uiRefresh)===null||h===void 0||h.call(i,"postFrame",!0))},onChange:this.setDirty},()=>({type:"vec4",label:"Bump Noise Params",bounds:[0,1],hidden:()=>{var s;return!(!((s=c.materialObject.userData._noiseBumpMat)===null||s===void 0)&&s.hasBump)},property:[c.materialObject.userData._noiseBumpMat,"bumpNoiseParams"],onChange:this.setDirty}),()=>({type:"slider",label:"Bump Scale",bounds:[0,.01],stepSize:1e-5,hidden:()=>{var s;return!(!((s=c.materialObject.userData._noiseBumpMat)===null||s===void 0)&&s.hasBump)},property:[c.materialObject.userData._noiseBumpMat,"bumpScale"],onChange:this.setDirty}),()=>({type:"slider",label:"Flake Scale",bounds:[100,1e4],stepSize:1e-4,hidden:()=>{var s;return!(!((s=c.materialObject.userData._noiseBumpMat)===null||s===void 0)&&s.hasBump)},property:[c.materialObject.userData._noiseBumpMat,"flakeScale"],onChange:this.setDirty}),()=>({type:"slider",label:"Flake Clamp",bounds:[0,1],stepSize:1,hidden:()=>{var s;return!(!((s=c.materialObject.userData._noiseBumpMat)===null||s===void 0)&&s.hasBump)},property:[c.materialObject.userData._noiseBumpMat,"flakeClamp"],onChange:this.setDirty}),()=>({type:"slider",label:"Flake Radius",bounds:[.1,1],stepSize:.01,hidden:()=>{var s;return!(!((s=c.materialObject.userData._noiseBumpMat)===null||s===void 0)&&s.hasBump)},property:[c.materialObject.userData._noiseBumpMat,"flakeRadius"],onChange:this.setDirty}),()=>({type:"slider",label:"Flake Roughness Modifier",bounds:[0,1],stepSize:1,hidden:()=>{var s;return!(!((s=c.materialObject.userData._noiseBumpMat)===null||s===void 0)&&s.hasBump)},property:[c.materialObject.userData._noiseBumpMat,"flakeRoughnessMod"],onChange:this.setDirty})]};return i}},this.setDirty=()=>{var c;(c=this._viewer)===null||c===void 0||c.setDirty()},this._loaderCreate=this._loaderCreate.bind(this)}addNoiseBumpMaterial(c){return _E(c.materialObject)}_loaderCreate({loader:c}){c.isGLTFLoader2&&c.register(e=>new TT(e))}async onAdded(c){var e,i,s,a,h;await super.onAdded(c);const d=c.getPlugin(qr);(e=d==null?void 0:d.materials)===null||e===void 0||e.registerMaterialExtension(this.materialExtension),(i=d==null?void 0:d.importer)===null||i===void 0||i.addEventListener("loaderCreate",this._loaderCreate),(h=(a=(s=d==null?void 0:d.exporter)===null||s===void 0?void 0:s.getExporter("gltf","glb"))===null||a===void 0?void 0:a.extensions)===null||h===void 0||h.push(IT)}async onRemove(c){var e,i,s,a;return(i=(e=c.getPlugin(qr))===null||e===void 0?void 0:e.materials)===null||i===void 0||i.unregisterMaterialExtension(this.materialExtension),(a=(s=c.getPlugin(qr))===null||s===void 0?void 0:s.importer)===null||a===void 0||a.removeEventListener("loaderCreate",this._loaderCreate),super.onRemove(c)}};function _E(c){const e=c==null?void 0:c.userData;if(!e)return!1;e._noiseBumpMat||(e._noiseBumpMat={});const i=e._noiseBumpMat;return i.hasBump=!0,i.bumpNoiseParams===void 0&&(i.bumpNoiseParams=[.5,.5]),i.bumpScale===void 0&&(i.bumpScale=.05),i.flakeScale===void 0&&(i.flakeScale=.05),i.flakeClamp===void 0&&(i.flakeClamp=1),i.flakeRadius===void 0&&(i.flakeRadius=.3),i.flakeRoughnessMod===void 0&&(i.flakeRoughnessMod=1),c.isMaterial&&(c.needsUpdate=!0),!0}_h.PluginType="NoiseBumpMaterialPlugin",_h.NOISE_BUMP_MATERIAL_GLTF_EXTENSION="WEBGI_materials_noise_bump",tw([ts("Enabled",c=>({onChange:c.setDirty})),Fn()],_h.prototype,"enabled",void 0),_h=tw([Ys("NoiseBumpMaterial Materials")],_h);class TT{constructor(e){this.parser=e,this.name=_h.NOISE_BUMP_MATERIAL_GLTF_EXTENSION}async extendMaterialParams(e,i){const s=this.parser.json.materials[e];if(!s.extensions||!s.extensions[this.name])return Promise.resolve();const a=s.extensions[this.name];return i.userData||(i.userData={}),_E(i),i.userData._noiseBumpMat=to(a,i.userData._noiseBumpMat,!1,{}),Promise.resolve()}}const IT=c=>({writeMaterial:(e,i)=>{if(!e.isMeshStandardMaterial||!e.userData._noiseBumpMat||!e.userData._noiseBumpMat.hasBump)return;i.extensions=i.extensions||{};const s=ao(e.userData._noiseBumpMat,!1);i.extensions[_h.NOISE_BUMP_MATERIAL_GLTF_EXTENSION]=s,c.extensionsUsed[_h.NOISE_BUMP_MATERIAL_GLTF_EXTENSION]=!0}});var AE,Cx=function(c,e,i,s){var a,h=arguments.length,d=h<3?e:s===null?s=Object.getOwnPropertyDescriptor(e,i):s;if(typeof Reflect=="object"&&typeof Reflect.decorate=="function")d=Reflect.decorate(c,e,i,s);else for(var _=c.length-1;_>=0;_--)(a=c[_])&&(d=(h<3?a(d):h>3?a(e,i,d):a(e,i))||d);return h>3&&d&&Object.defineProperty(e,i,d),d};let _d=AE=class extends Ls{constructor(){super(),this.enabled=!0,this.dependencies=[qr],this.bicubicFiltering=!0,this._defines={CUSTOM_BUMP_MAP_DEBUG:!1,CUSTOM_BUMP_MAP_BICUBIC:!0},this._uniforms={customBumpUvTransform:{value:new b.Vkp},customBumpScale:{value:.001},customBumpMap:{value:null}},this.materialExtension={parsFragmentSnippet:(c,e)=>this.enabled&&(e!=null&&e.materialObject.userData._hasCustomBump)?`#if defined(CUSTOM_BUMP_MAP_ENABLED) && CUSTOM_BUMP_MAP_ENABLED > 0
#if CUSTOM_BUMP_MAP_BICUBIC > 0  
vec4 cubic(float v){vec4 n=vec4(1.,2.,3.,4.)-v;vec4 s=n*n*n;float x=s.x;float y=s.y-4.*s.x;float z=s.z-4.*s.y+6.*s.x;float w=6.-x-y-z;return vec4(x,y,z,w)*(1./6.);}vec4 textureBicubic(sampler2D sampler,vec2 texCoords){vec2 texSize=vec2(textureSize(sampler,0));vec2 invTexSize=1./texSize;texCoords=texCoords*texSize-0.5;vec2 fxy=fract(texCoords);texCoords-=fxy;vec4 xcubic=cubic(fxy.x);vec4 ycubic=cubic(fxy.y);vec4 c=texCoords.xxyy+vec2(-0.5,+1.5).xyxy;vec4 s=vec4(xcubic.xz+xcubic.yw,ycubic.xz+ycubic.yw);vec4 offset=c+vec4(xcubic.yw,ycubic.yw)/s;offset*=invTexSize.xxyy;vec4 sample0=texture(sampler,offset.xz);vec4 sample1=texture(sampler,offset.yz);vec4 sample2=texture(sampler,offset.xw);vec4 sample3=texture(sampler,offset.yw);float sx=s.x/(s.x+s.y);float sy=s.z/(s.z+s.w);return mix(mix(sample3,sample2,sx),mix(sample1,sample0,sx),sy);}
#endif
varying vec2 vCustomBumpUv;uniform sampler2D customBumpMap;uniform float customBumpScale;vec2 dHdxy_fwd_cb(){vec2 dSTdx=dFdx(vCustomBumpUv);vec2 dSTdy=dFdy(vCustomBumpUv);
#if CUSTOM_BUMP_MAP_BICUBIC > 0
float Hll=customBumpScale*textureBicubic(customBumpMap,vCustomBumpUv).x;float dBx=customBumpScale*textureBicubic(customBumpMap,vCustomBumpUv+dSTdx).x-Hll;float dBy=customBumpScale*textureBicubic(customBumpMap,vCustomBumpUv+dSTdy).x-Hll;
#else
float Hll=customBumpScale*texture2D(customBumpMap,vCustomBumpUv).x;float dBx=customBumpScale*texture2D(customBumpMap,vCustomBumpUv+dSTdx).x-Hll;float dBy=customBumpScale*texture2D(customBumpMap,vCustomBumpUv+dSTdy).x-Hll;
#endif
return vec2(dBx,dBy);}
#ifndef USE_BUMPMAP
vec3 perturbNormalArb(vec3 surf_pos,vec3 surf_norm,vec2 dHdxy,float faceDirection){vec3 vSigmaX=dFdx(surf_pos.xyz);vec3 vSigmaY=dFdy(surf_pos.xyz);vec3 vN=surf_norm;vec3 R1=cross(vSigmaY,vN);vec3 R2=cross(vN,vSigmaX);float fDet=dot(vSigmaX,R1)*faceDirection;vec3 vGrad=sign(fDet)*(dHdxy.x*R1+dHdxy.y*R2);return normalize(abs(fDet)*surf_norm-vGrad);}
#endif
#endif
`:"",shaderExtender:(c,e,i)=>{var s;this.enabled&&e.materialObject.userData._hasCustomBump&&(!((s=e.materialObject.userData)===null||s===void 0)&&s._customBumpMap)&&(c.fragmentShader=Ho(c.fragmentShader,"#glMarker beforeAccumulation",`
#if defined(CUSTOM_BUMP_MAP_ENABLED) && CUSTOM_BUMP_MAP_ENABLED > 0
    normal = perturbNormalArb( - vViewPosition, normal, dHdxy_fwd_cb(), faceDirection );
#endif
                `,{prepend:!0}),c.vertexShader=Ho(c.vertexShader,"#include <uv_pars_vertex>",`
#if defined(CUSTOM_BUMP_MAP_ENABLED) && CUSTOM_BUMP_MAP_ENABLED > 0
                varying vec2 vCustomBumpUv;
                uniform mat3 customBumpUvTransform;
#endif
                `,{prepend:!0}),c.vertexShader=Ho(c.vertexShader,"#include <uv_vertex>",`
#if defined(CUSTOM_BUMP_MAP_ENABLED) && CUSTOM_BUMP_MAP_ENABLED > 0
                vCustomBumpUv = ( customBumpUvTransform * vec3( uv, 1 ) ).xy;
#endif
                `,{prepend:!0}),c.vertexUvs=!0)},onObjectRender:(c,e)=>{var i;const s=e.materialObject.userData;if(!(s!=null&&s._hasCustomBump))return;const a=c;if(!a.isMesh||!a.geometry)return;const h=!((i=s._customBumpMap)===null||i===void 0)&&i.isTexture?s._customBumpMap:null;this._uniforms.customBumpMap.value=h,this._uniforms.customBumpScale.value=h?s._customBumpScale:0,h&&(h.updateMatrix(),this._uniforms.customBumpUvTransform.value.copy(h.matrix));let d=this.enabled&&h?1:0;e.materialObject.defines.CUSTOM_BUMP_MAP_ENABLED!==d&&(e.materialObject.defines.CUSTOM_BUMP_MAP_ENABLED=d,e.materialObject.needsUpdate=!0),d=+this._defines.CUSTOM_BUMP_MAP_DEBUG,e.materialObject.defines.CUSTOM_BUMP_MAP_DEBUG!==d&&(e.materialObject.defines.CUSTOM_BUMP_MAP_DEBUG=d,e.materialObject.needsUpdate=!0),d=+this._defines.CUSTOM_BUMP_MAP_BICUBIC,e.materialObject.defines.CUSTOM_BUMP_MAP_BICUBIC!==d&&(e.materialObject.defines.CUSTOM_BUMP_MAP_BICUBIC=d,e.materialObject.needsUpdate=!0)},extraUniforms:{...this._uniforms},computeCacheKey:c=>{var e,i,s;return(this.enabled?"1":"0")+(!((e=c.materialObject.userData)===null||e===void 0)&&e._hasCustomBump?"1":"0")+((s=(i=c.materialObject.userData)===null||i===void 0?void 0:i._customBumpMap)===null||s===void 0?void 0:s.uuid)},isCompatible:c=>c.isMeshStandardMaterial2,updaters:()=>[],getUiConfig:c=>{const e=this._viewer,i=this.enableCustomBump,s={type:"folder",label:"CustomBumpMap",children:[{type:"checkbox",label:"Enabled",get value(){return c.materialObject.userData._hasCustomBump||!1},set value(a){var h;a!==c.materialObject.userData._hasCustomBump&&(a?i(c)||e.alert("One or more geometries cannot be made anisotropic."):(c.materialObject.userData._hasCustomBump=!1,c.materialObject.needsUpdate=!0),(h=s.uiRefresh)===null||h===void 0||h.call(s,"postFrame",!0))},onChange:this.setDirty},{type:"slider",label:"Bump Scale",hidden:()=>!c.materialObject.userData._hasCustomBump,property:[c.materialObject.userData,"_customBumpScale"],onChange:this.setDirty},{type:"image",label:"Bump Map",hidden:()=>!c.materialObject.userData._hasCustomBump,property:[c.materialObject.userData,"_customBumpMap"],onChange:()=>{c.materialObject.needsUpdate=!0,this.setDirty()}},Go(c.materialObject.userData,"_customBumpMap")]};return s}},this.setDirty=()=>{var c,e,i;(e=(c=this.materialExtension).setDirty)===null||e===void 0||e.call(c),(i=this._viewer)===null||i===void 0||i.setDirty()},this.enableCustomBumpSelected=()=>{var c,e,i;const s=(i=(e=(c=this._viewer)===null||c===void 0?void 0:c.getPlugin(ro))===null||e===void 0?void 0:e.getSelectedObject())===null||i===void 0?void 0:i.material;return(s==null?void 0:s.assetType)==="material"&&this.enableCustomBump(s)},this._loaderCreate=this._loaderCreate.bind(this)}enableCustomBump(c,e,i){var s,a;const h=(s=c.materialObject)===null||s===void 0?void 0:s.userData;if(!h)return!1;if(h._hasCustomBump===void 0){const d=h.__appliedMeshes;let _=!0;if(d)for(const{geometry:et}of d)!et||et.attributes.position&&et.attributes.normal&&et.attributes.uv||(_=!1);if(!_)return!1}return h._hasCustomBump=!0,h._customBumpScale=(a=i??h._customBumpScale)!==null&&a!==void 0?a:.001,h._customBumpMap=e??h._customBumpMap,c.materialObject.needsUpdate=!0,!0}_loaderCreate({loader:c}){c.isGLTFLoader2&&c.register(e=>new DT(e))}async onAdded(c){var e,i,s,a,h;await super.onAdded(c);const d=c.getPlugin(qr);(e=d==null?void 0:d.materials)===null||e===void 0||e.registerMaterialExtension(this.materialExtension),(i=d==null?void 0:d.importer)===null||i===void 0||i.addEventListener("loaderCreate",this._loaderCreate),(h=(a=(s=d==null?void 0:d.exporter)===null||s===void 0?void 0:s.getExporter("gltf","glb"))===null||a===void 0?void 0:a.extensions)===null||h===void 0||h.push(PT)}async onRemove(c){var e,i,s,a;return(i=(e=c.getPlugin(qr))===null||e===void 0?void 0:e.materials)===null||i===void 0||i.unregisterMaterialExtension(this.materialExtension),(a=(s=c.getPlugin(qr))===null||s===void 0?void 0:s.importer)===null||a===void 0||a.removeEventListener("loaderCreate",this._loaderCreate),super.onRemove(c)}};_d.PluginType="CustomBumpMapPlugin",_d.CUSTOM_BUMP_MAP_GLTF_EXTENSION="WEBGI_materials_custom_bump_map",Cx([ts("Enabled",c=>({onChange:c.setDirty})),Fn()],_d.prototype,"enabled",void 0),Cx([ts("Bicubic",c=>({onChange:c.setDirty})),jn("CUSTOM_BUMP_MAP_BICUBIC",void 0,!0,AE.prototype.setDirty),Fn()],_d.prototype,"bicubicFiltering",void 0),Cx([uo("Enable CustomBumpMap",c=>({hidden:()=>{var e;return!(!((e=c._viewer)===null||e===void 0)&&e.getPlugin(ro))}}))],_d.prototype,"enableCustomBumpSelected",void 0),_d=AE=Cx([Ys("CustomBumpMap Materials")],_d);class DT{constructor(e){this.parser=e,this.name=_d.CUSTOM_BUMP_MAP_GLTF_EXTENSION}async extendMaterialParams(e,i){var s;const a=this.parser,h=a.json.materials[e];if(!h.extensions||!h.extensions[this.name])return Promise.resolve();const d=[],_=h.extensions[this.name];i.userData||(i.userData={}),i.userData._hasCustomBump=!0,i.userData._customBumpScale=(s=_.customBumpScale)!==null&&s!==void 0?s:0;const et=_.customBumpMap;return et&&d.push(a.assignTexture(i.userData,"_customBumpMap",et).then(nt=>{nt.encoding=b.knz})),Promise.all(d)}}const PT=c=>({writeMaterial:(e,i)=>{if(!e.isMeshStandardMaterial||!e.userData._hasCustomBump||(e.userData._customBumpScale||0)<.001)return;i.extensions=i.extensions||{};const s={};if(s.customBumpScale=e.userData._customBumpScale||1,e.userData._customBumpMap){const a={index:c.processTexture(e.userData._customBumpMap)};c.applyTextureTransform(a,e.userData._customBumpMap),s.customBumpMap=a}i.extensions[_d.CUSTOM_BUMP_MAP_GLTF_EXTENSION]=s,c.extensionsUsed[_d.CUSTOM_BUMP_MAP_GLTF_EXTENSION]=!0}});var TC=function(c,e,i,s){var a,h=arguments.length,d=h<3?e:s===null?s=Object.getOwnPropertyDescriptor(e,i):s;if(typeof Reflect=="object"&&typeof Reflect.decorate=="function")d=Reflect.decorate(c,e,i,s);else for(var _=c.length-1;_>=0;_--)(a=c[_])&&(d=(h<3?a(d):h>3?a(e,i,d):a(e,i))||d);return h>3&&d&&Object.defineProperty(e,i,d),d};let wm=class extends Ls{constructor(){super(),this.enabled=!0,this.dependencies=[qr],this._defines={},this._uniforms={ccTintColor:{value:new mo},ccThickness:{value:0},ccIor:{value:0}},this.materialExtension={parsFragmentSnippet:(c,e)=>{var i;return this.enabled&&(!((i=e==null?void 0:e.materialObject.userData._clearcoatTint)===null||i===void 0)&&i.enableTint)&&e.materialObject.clearcoat>0?`
uniform vec3 ccTintColor;
uniform float ccThickness;
uniform float ccIor;
vec3 clearcoatTint(const in float dotNV, const in float dotNL, const in float clearcoat) {
    vec3 tint = ( ccThickness > 0. ? 1. - ccTintColor : ccTintColor); // Set thickness < 0 for glow.
    tint = exp(tint * -(ccThickness * ((dotNL + dotNV) / max(dotNL * dotNV, 1e-3)))); // beer's law
    return mix(vec3(1.0), tint, clearcoat);
}
        `:""},shaderExtender:(c,e,i)=>{var s;if(!(this.enabled&&(!((s=e==null?void 0:e.materialObject.userData._clearcoatTint)===null||s===void 0)&&s.enableTint)&&e.materialObject.clearcoat>0))return;const a="outgoingLight = outgoingLight * ( 1.0 - material.clearcoat * Fcc ) + clearcoatSpecular * material.clearcoat;",h="float dotNVcc = saturate( dot( geometry.clearcoatNormal, geometry.viewDir ) );";c.fragmentShader.includes(h)&&c.fragmentShader.includes(a)||console.error("ClearcoatTintPlugin: shaderExtender cannot patch shader, version changed?"),c.fragmentShader=c.fragmentShader.replace(h,`
            float dotNVcc = saturate( dot( geometry.clearcoatNormal, -refract(geometry.viewDir, geometry.clearcoatNormal, 1./ccIor) ) );
            `),c.fragmentShader=c.fragmentShader.replace(a,`
            outgoingLight *= clearcoatTint(dotNVcc, dotNVcc, material.clearcoat);
            `+a),c.vertexUvs=!0},onObjectRender:(c,e)=>{var i;const s=(i=e.materialObject.userData)===null||i===void 0?void 0:i._clearcoatTint;if(!(s!=null&&s.enableTint))return;this._uniforms.ccTintColor.value.set(s.tintColor),this._uniforms.ccThickness.value=s.thickness,this._uniforms.ccIor.value=s.ior;const a=this.enabled?1:0;e.materialObject.defines.CLEARCOAT_TINT_ENABLED!==a&&(e.materialObject.defines.CLEARCOAT_TINT_ENABLED=a,e.materialObject.needsUpdate=!0)},extraUniforms:{...this._uniforms},computeCacheKey:c=>{var e,i;return(this.enabled?"1":"0")+(!((i=(e=c.materialObject.userData)===null||e===void 0?void 0:e._clearcoatTint)===null||i===void 0)&&i.enableTint?"1":"0")+(c.materialObject.clearcoat>0?"1":"0")},isCompatible:c=>c.isMeshStandardMaterial2,updaters:()=>[],getUiConfig:c=>{const e=this._viewer,i={type:"folder",label:"ClearcoatTint",children:[{type:"checkbox",label:"Enabled",get value(){var s;return((s=c.materialObject.userData._clearcoatTint)===null||s===void 0?void 0:s.enableTint)||!1},set value(s){var a,h;s!==((a=c.materialObject.userData._clearcoatTint)===null||a===void 0?void 0:a.enableTint)&&(s?yE(c.materialObject)||e.alert("Cannot add clearcoat tint."):(c.materialObject.userData._clearcoatTint.enableTint=!1,c.materialObject.needsUpdate=!0),(h=i.uiRefresh)===null||h===void 0||h.call(i,"postFrame",!0))},onChange:this.setDirty},()=>({type:"color",label:"Tint color",hidden:()=>{var s;return!(!((s=c.materialObject.userData._clearcoatTint)===null||s===void 0)&&s.enableTint)},property:[c.materialObject.userData._clearcoatTint,"tintColor"],onChange:this.setDirty}),()=>({type:"input",label:"Thickness",hidden:()=>{var s;return!(!((s=c.materialObject.userData._clearcoatTint)===null||s===void 0)&&s.enableTint)},property:[c.materialObject.userData._clearcoatTint,"thickness"],onChange:this.setDirty}),()=>({type:"slider",bounds:[.8,2.5],label:"IOR",hidden:()=>{var s;return!(!((s=c.materialObject.userData._clearcoatTint)===null||s===void 0)&&s.enableTint)},property:[c.materialObject.userData._clearcoatTint,"ior"],onChange:this.setDirty})]};return i}},this.setDirty=()=>{var c;(c=this._viewer)===null||c===void 0||c.setDirty()},this._loaderCreate=this._loaderCreate.bind(this)}addClearcoatTint(c){return yE(c.materialObject)}_loaderCreate({loader:c}){c.isGLTFLoader2&&c.register(e=>new RT(e))}async onAdded(c){var e,i,s,a,h;await super.onAdded(c);const d=c.getPlugin(qr);(e=d==null?void 0:d.materials)===null||e===void 0||e.registerMaterialExtension(this.materialExtension),(i=d==null?void 0:d.importer)===null||i===void 0||i.addEventListener("loaderCreate",this._loaderCreate),(h=(a=(s=d==null?void 0:d.exporter)===null||s===void 0?void 0:s.getExporter("gltf","glb"))===null||a===void 0?void 0:a.extensions)===null||h===void 0||h.push(BT)}async onRemove(c){var e,i,s,a;return(i=(e=c.getPlugin(qr))===null||e===void 0?void 0:e.materials)===null||i===void 0||i.unregisterMaterialExtension(this.materialExtension),(a=(s=c.getPlugin(qr))===null||s===void 0?void 0:s.importer)===null||a===void 0||a.removeEventListener("loaderCreate",this._loaderCreate),super.onRemove(c)}};function yE(c){const e=c==null?void 0:c.userData;if(!e)return!1;e._clearcoatTint||(e._clearcoatTint={});const i=e._clearcoatTint;return i.enableTint=!0,i.tintColor===void 0&&(i.tintColor=16777215),i.thickness===void 0&&(i.thickness=.1),i.ior===void 0&&(i.ior=1.5),c.isMaterial&&(c.needsUpdate=!0),!0}wm.PluginType="ClearcoatTintPlugin",wm.CLEARCOAT_TINT_GLTF_EXTENSION="WEBGI_materials_clearcoat_tint",TC([ts("Enabled",c=>({onChange:c.setDirty})),Fn()],wm.prototype,"enabled",void 0),wm=TC([Ys("ClearcoatTint Materials")],wm);class RT{constructor(e){this.parser=e,this.name=wm.CLEARCOAT_TINT_GLTF_EXTENSION}async extendMaterialParams(e,i){const s=this.parser.json.materials[e];if(!s.extensions||!s.extensions[this.name])return Promise.resolve();const a=s.extensions[this.name];return i.userData||(i.userData={}),yE(i),i.userData._clearcoatTint=to(a,i.userData._clearcoatTint,!1,{}),Promise.resolve()}}const BT=c=>({writeMaterial:(e,i)=>{if(!e.isMeshStandardMaterial||!e.userData._clearcoatTint||!e.userData._clearcoatTint.enableTint)return;i.extensions=i.extensions||{};const s=ao(e.userData._clearcoatTint,!1);i.extensions[wm.CLEARCOAT_TINT_GLTF_EXTENSION]=s,c.extensionsUsed[wm.CLEARCOAT_TINT_GLTF_EXTENSION]=!0}});var qp=function(c,e,i,s){var a,h=arguments.length,d=h<3?e:s===null?s=Object.getOwnPropertyDescriptor(e,i):s;if(typeof Reflect=="object"&&typeof Reflect.decorate=="function")d=Reflect.decorate(c,e,i,s);else for(var _=c.length-1;_>=0;_--)(a=c[_])&&(d=(h<3?a(d):h>3?a(e,i,d):a(e,i))||d);return h>3&&d&&Object.defineProperty(e,i,d),d};let Hv=class extends o_{constructor(c,e,i){super(c,e,i??new IC,new mo(0,0,0),1),this.enabled=!0,this._firstCall=!0}render(c,e,i,s,a){if(!this.enabled)return;const h=this.overrideMaterial;h.uniforms.currentProjectionViewMatrix.value.copy(this.camera.projectionMatrix).multiply(this.camera.matrixWorldInverse),this._firstCall&&(h.uniforms.lastProjectionViewMatrix.value.copy(h.uniforms.currentProjectionViewMatrix.value),this._firstCall=!1),super.render(c,e,i,s,a),h.uniforms.lastProjectionViewMatrix.value.copy(h.uniforms.currentProjectionViewMatrix.value)}};qp([ts("Enabled")],Hv.prototype,"enabled",void 0),Hv=qp([Ys("Velocity Buffer (TAA)")],Hv);class IC extends b.jyz{constructor(){super({vertexShader:`#ifdef USE_ALPHAMAP
#define USE_UV 
#endif
#include <uv_pars_vertex>
#include <morphtarget_pars_vertex>
#include <skinning_pars_vertex>
#include <logdepthbuf_pars_vertex>
#include <clipping_planes_pars_vertex>
varying vec3 vWorldPosition;varying vec3 vWorldPositionPrevious;uniform mat4 modelMatrixPrevious;void main(){
#include <uv_vertex>
#include <skinbase_vertex>
#include <begin_vertex>
#include <morphtarget_vertex>
#include <skinning_vertex>
#include <displacementmap_vertex>
vec4 mvPosition=vec4(transformed,1.);
#ifdef USE_INSTANCING
mvPosition=instanceMatrix*mvPosition;
#endif
vWorldPosition=(modelMatrix*mvPosition).xyz;vWorldPositionPrevious=(modelMatrixPrevious*mvPosition).xyz;mvPosition=modelViewMatrix*mvPosition;gl_Position=projectionMatrix*mvPosition;
#include <logdepthbuf_vertex>
#include <clipping_planes_vertex>
}`,fragmentShader:"varying vec3 vWorldPosition;varying vec3 vWorldPositionPrevious;uniform mat4 currentProjectionViewMatrix;uniform mat4 lastProjectionViewMatrix;vec2 computeScreenSpaceVelocity2(){vec4 currentPositionClip=currentProjectionViewMatrix*vec4(vWorldPosition,1.);vec4 prevPositionClip=lastProjectionViewMatrix*vec4(vWorldPositionPrevious,1.);vec2 currentPositionNDC=currentPositionClip.xy/currentPositionClip.w;vec2 prevPositionNDC=prevPositionClip.xy/prevPositionClip.w;if(prevPositionNDC.x>=1.||prevPositionNDC.x<=-1.||prevPositionNDC.x>=1.||prevPositionNDC.y<=-1.){return vec2(0.);}return 0.5*(currentPositionNDC-prevPositionNDC);}void main(){vec2 velocity=clamp(computeScreenSpaceVelocity2(),-1.,1.);velocity=sign(velocity)*pow(abs(velocity),vec2(1./4.));velocity=velocity*0.5+0.5;gl_FragColor=vec4(velocity.x,velocity.y,1.,1.);}",uniforms:{cameraNearFar:{value:new b.FM8(.1,1e3)},alphaMap:{value:null},alphaTest:{value:null},currentProjectionViewMatrix:{value:new b.yGw},lastProjectionViewMatrix:{value:new b.yGw}}}),this.extraUniformsToUpload={modelMatrixPrevious:{value:new b.yGw().identity()}},this._previousWorldMatrices={}}onBeforeRender(e,i,s,a,h){var d,_;const et=this._previousWorldMatrices[h.uuid];this.extraUniformsToUpload.modelMatrixPrevious.value.copy(et??h.matrixWorld),et?et.copy(h.matrixWorld):this._previousWorldMatrices[h.uuid]=h.matrixWorld.clone();let nt=h.material;Array.isArray(nt)&&(nt=nt[0]),this.uniforms.alphaMap.value=(d=nt==null?void 0:nt.alphaMap)!==null&&d!==void 0?d:null,this.uniforms.alphaTest.value=!nt||!nt.alphaTest||nt.alphaTest<1e-7?.001:nt.alphaTest;let it=this.uniforms.alphaMap.value?1:void 0;it!==this.defines.USE_ALPHAMAP&&(it===void 0?delete this.defines.USE_ALPHAMAP:this.defines.USE_ALPHAMAP=it,this.needsUpdate=!0),it=nt.userData.ALPHA_I_RGBA_PACKING?1:void 0,it!==this.defines.ALPHA_I_RGBA_PACKING&&(it===void 0?delete this.defines.ALPHA_I_RGBA_PACKING:this.defines.ALPHA_I_RGBA_PACKING=it,this.needsUpdate=!0),this.side=(_=nt.side)!==null&&_!==void 0?_:b.ehD}}class Mx extends Am{constructor(e=!0){super(),this.passId="velocityBuffer",this._beforeFilters=["render"],this._afterFilters=[],this._requiredFilters=["render"],this._velocityBuffers=[],this.enabled=e}passCtor(e){const i=e.renderer.createTarget({depthBuffer:!0,type:b.ywz});i.texture.name="velocityBuffer",this._velocityBuffers.push(i),e.getPluginByType("debug");const s=new Set,a=new Set;return new class extends Hv{render(h,d,_,et,nt){if(e.renderer.frameCount>0)return;const it=h.getRenderTarget(),lt=h.getActiveCubeFace(),ut=h.getActiveMipmapLevel();this.scene.traverse(({material:pt})=>{pt&&((pt.transparent&&pt.userData.renderToDepth||!pt.transparent&&pt.transmission===0&&pt.userData.renderToDepth===!1)&&(s.add(pt),pt.transparent=!pt.transparent),Math.abs(pt.transmission||0)>0&&pt.userData.renderToDepth&&(a.add([pt,pt.transmission]),pt.transmission=0))}),zr(h,{shadowMapRender:!1,backgroundRender:!1,opaqueRender:!0,transparentRender:!1,transmissionRender:!1,mainRenderPass:!1},()=>super.render(h,d,i,et,nt)),s.forEach(pt=>pt.transparent=!pt.transparent),s.clear(),a.forEach(([pt,gt])=>pt.transmission=gt),a.clear(),h.setRenderTarget(it,lt,ut)}}}_update(e){if(!super._update(e)||e.renderer.frameCount>0)return!1;const i=this.pass.passObject;return i.scene=e.scene.modelObject,e.scene.activeCamera.updateShaderProperties(i.overrideMaterial),i.camera=e.scene.activeCamera.cameraObject,!0}getVelocityBuffer(){return this._velocityBuffers.length>0?this._velocityBuffers[0]:void 0}async onDispose(e){}async onRemove(e){return this._velocityBuffers.forEach(i=>{var s;return e.renderer.disposeTarget((s=i==null?void 0:i.dispose)===null||s===void 0?void 0:s.call(i))}),super.onRemove(e)}updateShaderProperties(e){var i,s;return e.uniforms.tVelocity?e.uniforms.tVelocity.value=this.enabled&&(s=(i=this.getVelocityBuffer())===null||i===void 0?void 0:i.texture)!==null&&s!==void 0?s:null:console.warn("BaseRenderer: no uniform: tVelocity"),this}get uiConfig(){var e;return(e=this.pass)===null||e===void 0?void 0:e.passObject.uiConfig}}Mx.PluginType="VelocityBuffer";class wE extends Tl{constructor(e,i){super({vertexShader:yt.vertexShader,fragmentShader:i+`
`+$w+`
#include <common>
varying vec2 vUv;uniform vec2 previousRTSize;uniform mat4 lastProjectionViewMatrix;uniform mat4 currentProjectionViewMatrix;uniform mat4 inverseViewMatrix;uniform vec2 jitterSample;uniform vec2 feedBack;uniform bool firstFrame;
#if HAS_VELOCITY_BUFFER == 1
uniform sampler2D tVelocity;
#endif
vec3 find_closest_fragment_3x3(const in vec2 uv){const vec3 offset=vec3(-1.,1.,0.);vec2 texelSize=1./previousRTSize;vec3 dtr=vec3(-1,1,getDepth(uv+offset.yx*texelSize));vec3 dtc=vec3(0,1,getDepth(uv+offset.zx*texelSize));vec3 dtl=vec3(1,1,getDepth(uv+offset.xx*texelSize));vec3 dml=vec3(-1,0,getDepth(uv+offset.yz*texelSize));vec3 dmc=vec3(0,0,getDepth(uv));vec3 dmr=vec3(1,0,getDepth(uv+offset.xz*texelSize));vec3 dbl=vec3(-1,-1,getDepth(uv+offset.yy*texelSize));vec3 dbc=vec3(0,-1,getDepth(uv+offset.zy*texelSize));vec3 dbr=vec3(1,-1,getDepth(uv+offset.xy*texelSize));vec3 dmin=dtl;if(dmin.z>dtc.z)dmin=dtc;if(dmin.z>dtr.z)dmin=dtr;if(dmin.z>dml.z)dmin=dml;if(dmin.z>dmc.z)dmin=dmc;if(dmin.z>dmr.z)dmin=dmr;if(dmin.z>dbl.z)dmin=dbl;if(dmin.z>dbc.z)dmin=dbc;if(dmin.z>dbr.z)dmin=dbr;return vec3(uv+texelSize.xy*dmin.xy,dmin.z);}vec3 find_closest_fragment_5tap(const in vec2 uv){vec2 texelSize=1./previousRTSize;vec2 offset=vec2(1.,-1.);vec3 dtl=vec3(-1,1,getDepth(uv+offset.yx*texelSize));vec3 dtr=vec3(1,1,getDepth(uv+offset.xx*texelSize));vec3 dmc=vec3(0,0,getDepth(uv));vec3 dbl=vec3(-1,-1,getDepth(uv+offset.yy*texelSize));vec3 dbr=vec3(1,-1,getDepth(uv+offset.xy*texelSize));vec3 dmin=dtl;if(dmin.z>dtr.z)dmin=dtr;if(dmin.z>dmc.z)dmin=dmc;if(dmin.z>dbl.z)dmin=dbl;if(dmin.z>dbr.z)dmin=dbr;return vec3(uv+dmin.xy*texelSize,dmin.z);}vec4 clip_aabb(const in vec4 aabb_min,const in vec4 aabb_max,vec4 p){const float FLT_EPS=1e-8;vec4 p_clip=0.5*(aabb_max+aabb_min);vec4 e_clip=0.5*(aabb_max-aabb_min)+FLT_EPS;vec4 v_clip=p-p_clip;vec4 v_unit=abs(v_clip/e_clip);float ma_unit=max(v_unit.x,max(v_unit.y,v_unit.z));if(ma_unit>1.)return p_clip+v_clip/ma_unit;else return p;}
#if HAS_VELOCITY_BUFFER == 0
vec2 computeScreenSpaceVelocity(const in vec3 worldPosition){vec4 currentPositionClip=currentProjectionViewMatrix*vec4(worldPosition,1.);vec4 prevPositionClip=lastProjectionViewMatrix*vec4(worldPosition,1.);vec2 currentPositionNDC=currentPositionClip.xy/currentPositionClip.w;vec2 prevPositionNDC=prevPositionClip.xy/prevPositionClip.w;if(prevPositionNDC.x>=1.||prevPositionNDC.x<=-1.||prevPositionNDC.x>=1.||prevPositionNDC.y<=-1.){return vec2(0.);}return 0.5*(currentPositionNDC-prevPositionNDC);}
#endif
vec4 computeTAA(const in vec2 uv,const in vec2 screenSpaceVelocity){vec2 jitterOffset=jitterSample/previousRTSize;vec2 uvUnJitter=uv;vec4 currentColor=currentRTTexelToLinear(texture2D(currentRT,uvUnJitter));vec4 previousColor=previousRTTexelToLinear(texture2D(previousRT,uv-screenSpaceVelocity));const vec3 offset=vec3(1.,-1.,0.);vec2 texelSize=1./previousRTSize;float texelSpeed=length(screenSpaceVelocity);vec4 tl=currentRTTexelToLinear(texture2D(currentRT,uvUnJitter+offset.yx*texelSize));vec4 tc=currentRTTexelToLinear(texture2D(currentRT,uvUnJitter+offset.zx*texelSize));vec4 tr=currentRTTexelToLinear(texture2D(currentRT,uvUnJitter+offset.xx*texelSize));vec4 ml=currentRTTexelToLinear(texture2D(currentRT,uvUnJitter+offset.yz*texelSize));vec4 mc=currentColor;vec4 mr=currentRTTexelToLinear(texture2D(currentRT,uvUnJitter+offset.xz*texelSize));vec4 bl=currentRTTexelToLinear(texture2D(currentRT,uvUnJitter+offset.yy*texelSize));vec4 bc=currentRTTexelToLinear(texture2D(currentRT,uvUnJitter+offset.zy*texelSize));vec4 br=currentRTTexelToLinear(texture2D(currentRT,uvUnJitter+offset.xy*texelSize));vec4 corners=2.*(tr+bl+br+tl)-2.*mc;mc+=(mc-(corners*0.166667))*2.718282*0.3;mc=max(vec4(0.),mc);vec4 min5=min(tc,min(ml,min(mc,min(mr,bc))));vec4 max5=max(tc,max(ml,max(mc,max(mr,bc))));vec4 cmin=min(min5,min(tl,min(tr,min(bl,br))));vec4 cmax=max(min5,max(tl,max(tr,max(bl,br))));;cmin=0.5*(cmin+min5);cmax=0.5*(cmax+max5);previousColor=clip_aabb(cmin,cmax,previousColor);float lum0=luminance(currentColor.rgb);float lum1=luminance(previousColor.rgb);float unbiased_diff=abs(lum0-lum1)/max(lum0,max(lum1,0.2));float unbiased_weight=1.-unbiased_diff;float unbiased_weight_sqr=unbiased_weight*unbiased_weight;float k_feedback=mix(feedBack.x,feedBack.y,unbiased_weight_sqr);return mix(currentColor,previousColor,k_feedback);}vec3 getWorldPositionFromViewZ(const in vec2 uv,const in float viewDepth){vec2 uv_=2.*uv-1.;float xe=-(uv_.x+projection[2][0])*viewDepth/projection[0][0];float ye=-(uv_.y+projection[2][1])*viewDepth/projection[1][1];return(inverseViewMatrix*vec4(xe,ye,viewDepth,1.)).xyz;}void main(){vec2 jitterOffset=jitterSample/previousRTSize;
#if QUALITY == 1
vec3 c_frag=find_closest_fragment_3x3(vUv);
#else
vec3 c_frag=find_closest_fragment_5tap(vUv);
#endif
if(c_frag.z>=0.999){gl_FragColor=currentRTTexelToLinear(texture2D(currentRT,vUv-jitterOffset));}else{float sampleViewZ=mix(-cameraNearFar.x,-cameraNearFar.y,c_frag.z);vec3 worldPosition=getWorldPositionFromViewZ(c_frag.xy,sampleViewZ);
#if HAS_VELOCITY_BUFFER == 0
vec2 screenSpaceVelocity=computeScreenSpaceVelocity(worldPosition);
#else
vec2 screenSpaceVelocity=(texture2D(tVelocity,vUv).xy*2.-1.);screenSpaceVelocity=sign(screenSpaceVelocity)*pow(abs(screenSpaceVelocity),vec2(4.));
#endif
gl_FragColor=firstFrame?currentRTTexelToLinear(texture2D(currentRT,vUv)):computeTAA(vUv,screenSpaceVelocity);}
#include <encodings_fragment>
}`,uniforms:{currentRT:{value:null},previousRT:{value:null},previousRTSize:{value:new b.FM8},cameraNearFar:{value:new b.FM8},lastProjectionViewMatrix:{value:new b.yGw},currentProjectionViewMatrix:{value:new b.yGw},projection:{value:new b.yGw},inverseViewMatrix:{value:new b.yGw},jitterSample:{value:new b.FM8},firstFrame:{value:!0},tNormalDepth:{value:null},tVelocity:{value:null}},defines:{HAS_VELOCITY_BUFFER:0,QUALITY:1,UNJITTER:0}},"currentRT","previousRT"),this.taaEnabled=!0,this.feedBack=new b.FM8(.88,.97),this.uiConfig={type:"folder",label:"Temporal AA",children:[{type:"checkbox",label:"Enabled",property:[this,"enabled"],onChange:()=>this.onSizeUpdate()},{type:"input",label:"Feedback",property:[this,"feedBack"],onChange:this.setDirty}]},this.onSizeUpdate=this.onSizeUpdate.bind(this),this.target=e,this.clear=!1,this.needsSwap=!0}render(e,i,s,a,h){if(!this.taaEnabled||!this.enabled)return void(this.needsSwap=!1);this.needsSwap=!0;const d=this.uniforms.tVelocity.value?1:0;d!==this.material.defines.HAS_VELOCITY_BUFFER&&(this.material.defines.HAS_VELOCITY_BUFFER=d,this.material.needsUpdate=!0),this.uniforms.previousRT.value=this.target.texture,super.render(e,i,s,a,h),this.uniforms.lastProjectionViewMatrix.value.copy(this.uniforms.currentProjectionViewMatrix.value),this.uniforms.firstFrame.value=!1}updateCameraProperties(e){e&&(this.uniforms.currentProjectionViewMatrix.value.multiplyMatrices(e.projectionMatrix,e.matrixWorldInverse),this.uniforms.inverseViewMatrix.value.copy(e.matrixWorld))}onSizeUpdate(){this.uniforms.firstFrame.value=!0,this.setDirty()}setSize(e,i){super.setSize(e,i),this.onSizeUpdate()}}(function(c,e,i,s){var a,h=arguments.length,d=h<3?e:s===null?s=Object.getOwnPropertyDescriptor(e,i):s;if(typeof Reflect=="object"&&typeof Reflect.decorate=="function")d=Reflect.decorate(c,e,i,s);else for(var _=c.length-1;_>=0;_--)(a=c[_])&&(d=(h<3?a(d):h>3?a(e,i,d):a(e,i))||d);h>3&&d&&Object.defineProperty(e,i,d)})([Fn(),rn()],wE.prototype,"feedBack",void 0);class nw extends Am{constructor(){super(...arguments),this.passId="taa",this._beforeFilters=["progressive"],this._afterFilters=[],this._requiredFilters=["render","progressive"],this.dependencies=[ho]}passCtor(e){if(!e.getPlugin(Bu))throw"Add ProgressivePlugin before TAA";const i=new wE(e.getPlugin(Bu).lastFrame,e.getPlugin(ho).getUnpackSnippet());return e.renderer.addEventListener("resize",i.onSizeUpdate),i}setDirty(){var e;(e=this._viewer)===null||e===void 0||e.setDirty()}async onDispose(e){return this.pass&&e.renderer.removeEventListener("resize",this.pass.passObject.onSizeUpdate),super.onDispose(e)}_update(e){if(!super._update(e))return!1;const i=e.renderer.frameCount,s=this._pass.passObject;if(s.taaEnabled=i<1,!s.taaEnabled)return!1;const a=e.scene.activeCamera;return s.updateShaderProperties([e.getPlugin(ho),a,e.getPluginByType("VelocityBuffer")]),s.target=e.getPlugin(Bu).lastFrame,s.updateCameraProperties(a==null?void 0:a.cameraObject),!0}get uiConfig(){var e;return(e=this.pass)===null||e===void 0?void 0:e.passObject.uiConfig}}nw.PluginType="TAA";class kT{static async GetDataUrl(e,{mimeType:i="image/png",rect:s={x:0,y:0,width:e.width,height:e.height,assumeClientRect:!1},displayPixelRatio:a=1,scale:h=1}){var d,_,et;const nt=document.createElementNS("http://www.w3.org/1999/xhtml","canvas");nt.width=s.width*h*a,nt.height=s.height*h*a,s.assumeClientRect&&(s.x*=e.width/(a*e.clientWidth),s.y*=e.height/(a*e.clientHeight),s.width*=e.width/(a*e.clientWidth),s.height*=e.height/(a*e.clientHeight));const it=nt.getContext("2d");if(!it)return console.error("snapshot: cannot create context"),"";const lt=e.style.background||((d=e.parentElement)===null||d===void 0?void 0:d.style.background)||"";if(lt.includes("url")){const pt=(_=/url\("(.*)"\)/gi.exec(lt))===null||_===void 0?void 0:_[1];if(pt){const gt=new Image;gt.src=pt,await new Promise((vt,Ct)=>{gt.onload=()=>vt(),gt.onerror=()=>Ct(),gt.complete&&vt()}),it.drawImage(gt,gt.width*s.x*a/e.width,gt.height*s.y*a/e.height,gt.width*s.width*a/e.width,gt.height*s.height*a/e.height,0,0,nt.width,nt.height)}}else it.fillStyle=e.style.background||((et=e.parentElement)===null||et===void 0?void 0:et.style.backgroundColor)||"#00000000",it.fillRect(0,0,nt.width,nt.height);it==null||it.drawImage(e,s.x*a,s.y*a,s.width*a,s.height*a,0,0,nt.width,nt.height);const ut=it.canvas.toDataURL(i);return nt.remove(),ut}static async GetImage(e,i={}){const s=await this.GetDataUrl(e,i);return new Promise((a,h)=>{const d=new Image;d.onload=()=>{a(d)},d.src=s})}static async GetBlob(e,i={}){return await(await fetch(await this.GetDataUrl(e,i))).blob()}static async GetFile(e,i="image.png",s={}){var a;return s.getDataUrl?await this.GetDataUrl(e,s):new File([await this.GetBlob(e,s)],i,{type:(a=s.mimeType)!==null&&a!==void 0?a:"image/png",lastModified:Yu()})}}var iw=function(c,e,i,s){var a,h=arguments.length,d=h<3?e:s===null?s=Object.getOwnPropertyDescriptor(e,i):s;if(typeof Reflect=="object"&&typeof Reflect.decorate=="function")d=Reflect.decorate(c,e,i,s);else for(var _=c.length-1;_>=0;_--)(a=c[_])&&(d=(h<3?a(d):h>3?a(e,i,d):a(e,i))||d);return h>3&&d&&Object.defineProperty(e,i,d),d};let P0=class extends Ls{constructor(){super(),this.enabled=!0,this.downloadSnapshot=this.downloadSnapshot.bind(this)}async getFile(c,e={}){return e.getDataUrl=!1,await this._getFile(c,e)}async getDataUrl(c={}){var e;return c.getDataUrl=!0,(e=await this._getFile("",c))!==null&&e!==void 0?e:""}async _getFile(c,e={}){var i,s,a;const h=(i=this._viewer)===null||i===void 0?void 0:i.canvas;if(h){const d=this._viewer.renderer.displayCanvasScaling;e.displayPixelRatio!==void 0&&e.displayPixelRatio!==d&&(this._viewer.renderer.displayCanvasScaling=e.displayPixelRatio);const _=(s=this._viewer)===null||s===void 0?void 0:s.getPlugin(Bu);if(e.waitForProgressive&&_&&e.timeout===void 0)for(;!_.isConverged(!0);)await Vl(64);else await Vl((a=e.timeout)!==null&&a!==void 0?a:200);e.displayPixelRatio=1;const et=await kT.GetFile(h,c,e);return e.displayPixelRatio=this._viewer.renderer.displayCanvasScaling,this._viewer.renderer.displayCanvasScaling=d,et}}async downloadSnapshot(c="snapshot.png",e={}){const i=await this.getFile(c,e);i&&Nm(i)}};P0.PluginType="CanvasSnipper",iw([uo("Download .png",{limitedUi:!0})],P0.prototype,"downloadSnapshot",null),P0=iw([Ys("Image Export")],P0);var Sl=function(c,e,i,s){var a,h=arguments.length,d=h<3?e:s===null?s=Object.getOwnPropertyDescriptor(e,i):s;if(typeof Reflect=="object"&&typeof Reflect.decorate=="function")d=Reflect.decorate(c,e,i,s);else for(var _=c.length-1;_>=0;_--)(a=c[_])&&(d=(h<3?a(d):h>3?a(e,i,d):a(e,i))||d);return h>3&&d&&Object.defineProperty(e,i,d),d};let OT=1,Pl=class{constructor(c,e,i,s,a){this.position=new b.Pa4,this.target=new b.Pa4,this.quaternion=new b._fP,this.up=new b.Pa4,this.name="Camera View",this.snap="",this.focusView=()=>{},this.deleteView=()=>{},this.uiConfig=o0(this.name,this),c&&(this.position=c),e&&(this.target=e),i&&(this.up=i),s&&(this.quaternion=s),a&&(this.snap=a),this.name="Camera View"+OT++}_nameChanged(){var c,e;this.uiConfig&&(this.uiConfig.label=this.name,(e=(c=this.uiConfig).uiRefresh)===null||e===void 0||e.call(c))}};Sl([Fn(),Up()],Pl.prototype,"position",void 0),Sl([Fn(),Up()],Pl.prototype,"target",void 0),Sl([Fn(),Up()],Pl.prototype,"quaternion",void 0),Sl([Fn(),Up()],Pl.prototype,"up",void 0),Sl([Fn(),qs()],Pl.prototype,"name",void 0),Sl([s0()],Pl.prototype,"snap",void 0),Sl([uo()],Pl.prototype,"focusView",void 0),Sl([uo()],Pl.prototype,"deleteView",void 0),Pl=Sl([Ow("CameraView")],Pl);class Xo extends Ls{constructor(){super(),this.enabled=!0,this._cameraViews=[],this.viewLooping=!1,this.viewPauseTime=200,this.animEase="easeInOutSine",this.animDuration=1e3,this.rotationOffset=.25,this.interpolateMode="spherical",this.animateOnScroll=!1,this.seekOnScroll=!1,this._animating=!1,this.dependencies=[],this._scrollAnimationState=0,this.scrollAnimationDamping=.1,this._updaters=[],this._lastFrameTime=0,this._fadeDisabled=!1,this._viewQueue=[],this._animationLooping=!1,this._infiniteLooping=!0,this._driver=e=>({start:()=>this._updaters.push({u:e,time:0}),stop:()=>this._updaters.splice(this._updaters.findIndex(i=>i.u===e),1)}),this.focusNext=(e=!0)=>{if(this._animating||this._cameraViews.length<2)return;let i=this._cameraViews.findIndex(s=>s===this._currentView);i<0&&(i=-1),i+=1,e?i%=this._cameraViews.length:i=Math.min(i,this._cameraViews.length-1),this.focusView(this._cameraViews[i])},this.focusPrevious=(e=!0)=>{if(this._animating||this._cameraViews.length<2||!this._currentView)return;let i=this._cameraViews.findIndex(s=>s===this._currentView);i<0&&(i=0),i-=1,i=e?(i+this._cameraViews.length)%this._cameraViews.length:Math.max(i,0),this.focusView(this._cameraViews[i])},this._popAnimations=[],this.uiConfig={type:"folder",label:"Camera Views",children:[()=>[...this._cameraViews.map(e=>e.uiConfig)],...bv(this)]},this.addCurrentView=this.addCurrentView.bind(this),this.animateAllViews=this.animateAllViews.bind(this),this.recordAllViews=this.recordAllViews.bind(this),this.resetToFirstView=this.resetToFirstView.bind(this),this._wheel=this._wheel.bind(this),this._pointerMove=this._pointerMove.bind(this),this._postFrame=this._postFrame.bind(this)}get animationLooping(){return this._animationLooping}get animating(){return this._animating}get camViews(){return this._cameraViews}_wheel(e){this.enabled&&(this.seekOnScroll&&!this._animating||Math.abs(e.deltaY)>.001&&(this._scrollAnimationState=-1*Math.sign(e.deltaY)))}_pointerMove(e){var i;if(this.enabled&&!this._animating&&this.seekOnScroll){const s=(i=this._viewer)===null||i===void 0?void 0:i.scene.activeCamera;if(!s)return;const a=new b.$V,h=s.position,d=s.target,_=new b._fP().setFromUnitVectors(s.cameraObject.up,new b.Pa4(0,1,0)),et=_.clone().invert(),nt=h.clone().sub(d);nt.applyQuaternion(_),a.setFromVector3(nt),a.theta+=this.rotationOffset*e.movementX/this._viewer.canvas.clientWidth,a.phi+=this.rotationOffset*e.movementY/this._viewer.canvas.clientHeight,a.makeSafe(),nt.setFromSpherical(a),nt.applyQuaternion(et),h.copy(d).add(nt),s.positionUpdated(!1),s.targetUpdated()}}async onAdded(e){await super.onAdded(e);let i=!1;e.addEventListener("preFrame",s=>{this.seekOnScroll||this._animating?this._viewer.scene.activeCamera.interactionsEnabled&&(this._viewer.scene.activeCamera.interactionsEnabled=!1,i=!0):i&&(this._viewer.scene.activeCamera.interactionsEnabled=!0,i=!1)}),e.addEventListener("postFrame",this._postFrame),window.addEventListener("wheel",this._wheel),window.addEventListener("pointermove",this._pointerMove)}_postFrame(){var e,i;if(!this._viewer)return;if(!this.enabled||!this._animating)return this._lastFrameTime=0,void(this._fadeDisabled&&((e=this._viewer.getPluginByType("FrameFade"))===null||e===void 0||e.enable(Xo.PluginType),this._fadeDisabled=!1));const s=Yu()/1e3;this._lastFrameTime<1&&(this._lastFrameTime=s-1/60);let a=s-this._lastFrameTime;this._lastFrameTime=s,a*=this.animateOnScroll?this._scrollAnimationState:1;const h=(i=this._viewer.getPluginByType("Progressive"))===null||i===void 0?void 0:i.postFrameConvergedRecordingDelta();if(h&&h>0&&(a=h),h!==0&&(a*=1e3,!(a<=0||(this._updaters.forEach(d=>{let _=a;d.time+_<0&&(_=-d.time),d.time+=_,Math.abs(_)>.001&&d.u(_)}),this._scrollAnimationState<.001?this._scrollAnimationState=0:this._scrollAnimationState*=1-this.scrollAnimationDamping,this._fadeDisabled)))){const d=this._viewer.getPluginByType("FrameFade");d&&(d.disable(Xo.PluginType),this._fadeDisabled=!0)}}async onRemove(e){return e.removeEventListener("postFrame",this._postFrame),window.removeEventListener("wheel",this._wheel),window.removeEventListener("pointermove",this._pointerMove),super.onRemove(e)}async _animationLoop(){if(!this._animationLooping){for(this._animationLooping=!0;(this.viewLooping||!this._infiniteLooping)&&this.enabled&&!(this._cameraViews.length<1);){if(this._viewQueue.length===0){if(!this._infiniteLooping)break;this._viewQueue.push(...this._cameraViews)}await this.animateToView(this._viewQueue.shift()),await Vl(2+this.viewPauseTime)}this._animationLooping=!1}}async animateAllViews(){if(this.enabled&&!(this.viewLooping||this._cameraViews.length<2)){for(;this._viewQueue.length>0;)this._viewQueue.pop();this._viewQueue.push(...this._cameraViews),this._viewQueue.push(this._viewQueue.shift()),this._infiniteLooping=!1,await this._animationLoop(),this._infiniteLooping=!0}}async resetToFirstView(e=100){this.enabled&&(this._currentView=void 0,await this.animateToView(this._cameraViews[0],e),await Vl(2))}async recordAllViews(e){var i;if(!this.enabled)return;const s=(i=this._viewer)===null||i===void 0?void 0:i.getPluginByType("CanvasRecorder");return s&&s.enabled&&!(this._cameraViews.length<1)&&(await this.resetToFirstView(),s.startRecording())?new Promise((a,h)=>{const d=()=>{s.removeEventListener("start",_),s.removeEventListener("stop",d),s.removeEventListener("error",et)},_=async()=>{d(),e==null||e(),await this.animateAllViews();const nt=await s.stopRecording();nt&&Do(nt,"recording.mp4"),a()},et=async()=>{d(),h()};s.addEventListener("start",_),s.addEventListener("stop",d),s.addEventListener("error",et)}):void 0}async addCurrentView(){var e,i,s,a,h;if(!this.enabled)return;const d=(e=this._viewer)===null||e===void 0?void 0:e.scene.activeCamera;if(!d)return;const _=this.getCurrentCameraView(d);_.snap=await((s=(i=this._viewer)===null||i===void 0?void 0:i.getPlugin(P0))===null||s===void 0?void 0:s.getDataUrl({displayPixelRatio:.25,mimeType:"image/jpg"}))||"",this._cameraViews.push(_),(h=(a=this.uiConfig).uiRefresh)===null||h===void 0||h.call(a)}getCurrentCameraView(e){var i;if(e||(e=(i=this._viewer)===null||i===void 0?void 0:i.scene.activeCamera),!e)return new Pl;const s=new b.Pa4,a=e.cameraObject.matrixWorld;s.x=a.elements[4],s.y=a.elements[5],s.z=a.elements[6];const h=new Pl(e.position.clone(),e.target.clone(),s.normalize(),e.cameraObject.quaternion.clone(),"");return h.focusView=async()=>this.focusView(h),h.deleteView=()=>this.deleteView(h),h}async focusView(e){return this.animateToView(e)}deleteView(e){var i,s;const a=this._cameraViews.indexOf(e);a>=0&&this._cameraViews.splice(a,1),(s=(i=this.uiConfig).uiRefresh)===null||s===void 0||s.call(i)}async stopAllAnimations(){for(this.viewLooping=!1,this._popAnimations.forEach(e=>{var i;return(i=e==null?void 0:e.stop)===null||i===void 0?void 0:i.call(e)}),this._popAnimations=[];this._animating||this._animationLooping;)await Vl(100)}async animateToView(e,i,s){var a;const h=(a=this._viewer)===null||a===void 0?void 0:a.scene.activeCamera;if(!h)return;if(this._animating&&(this._popAnimations.forEach(it=>{var lt;return(lt=it==null?void 0:it.stop)===null||lt===void 0?void 0:lt.call(it)}),await Vl(100),this._animating))return void console.warn("todo: still animating?");this._currentView=e,this._animating=!0,this.dispatchEvent({type:"startViewChange",view:e}),i===void 0&&(i=this.animDuration);const d=typeof s=="function"?s:vx[s||this.animEase],_=this._driver,et=[];this._popAnimations=[];const nt=this._popAnimations;if(this.interpolateMode==="spherical")et.push(async function(it,lt,ut,pt,gt,vt){const Ct=it.target.clone(),wt=new b.Pa4,xt=new b.Pa4,_t=Tx(it.cameraObject,Ct),Pt=Tx(lt,lt.target),Bt=new b.$V;return Vv({from:0,to:1,duration:ut,ease:pt,driver:gt,onUpdate:Ot=>{Bt.phi=GA(_t.phi,Pt.phi,Ot),Bt.theta=GA(_t.theta,Pt.theta,Ot),Bt.radius=Vu(_t.radius,Pt.radius,Ot),wt.copy(Ct).lerp(lt.target,Ot),xt.setFromSpherical(Bt),xt.add(wt),it.position=xt,it.target=wt,it.positionUpdated(!1),it.targetUpdated()},onComplete:()=>{it.position=lt.position,it.target=lt.target,it.positionUpdated(!1),it.targetUpdated()}},vt)}(h,e,i,d,_,nt));else if(this.interpolateMode==="linear"){et.push(Vv({from:h.position.clone(),to:e.position.clone(),duration:i,ease:d,driver:_,onUpdate:ut=>h.position=ut,onComplete:()=>h.position=e.position},nt)),et.push(Vv({from:h.target.clone(),to:e.target.clone(),duration:i,ease:d,driver:_,onUpdate:ut=>{h.target=ut,h.targetUpdated()},onComplete:()=>{h.target=e.target,h.targetUpdated()}},nt));const it=h.cameraObject.quaternion.clone(),lt=new b._fP;et.push(Vv({from:0,to:1,duration:i,ease:d,driver:_,onUpdate:ut=>{lt.copy(it).slerp(e.quaternion,ut),h.cameraObject.quaternion.copy(lt),h.cameraObject.updateProjectionMatrix()},onComplete:()=>{h.cameraObject.quaternion.copy(e.quaternion),h.cameraObject.updateProjectionMatrix()}},nt))}await Promise.all(et),this._animating=!1,this.dispatchEvent({type:"viewChange",view:e}),await Vl(10)}fromJSON(e,i){var s,a;return this._cameraViews.forEach(h=>this.deleteView(h)),super.fromJSON(e,i)?(this._cameraViews.forEach(h=>h.focusView=async()=>this.focusView(h)),this._cameraViews.forEach(h=>h.deleteView=()=>this.deleteView(h)),(a=(s=this.uiConfig).uiRefresh)===null||a===void 0||a.call(s),this):null}async animateToObject(e,i=4,s,a,h={min:.5,max:5}){if(!this._viewer)return;const d=new Dr().expandByObject(e||this._viewer.scene.modelRoot.modelObject,!1,!0),_=d.getCenter(new b.Pa4),et=d.getSize(new b.Pa4).length()/2;await this.animateToTarget(Math.min(h.max,Math.max(h.min,et*i)),_,s,a)}async animateToTarget(e,i,s,a){const h=this.getCurrentCameraView();h.target.copy(i);const d=new b.Pa4().subVectors(h.target,h.position).normalize();h.position.copy(d.multiplyScalar(-e).add(h.target)),await this.animateToView(h,s,a)}}function Tx(c,e){const i=c.position.clone();i.sub(e);const s=new b.$V().setFromVector3(i);return s.makeSafe(),s}function GA(c,e,i){const s=e-c;return s>=Math.PI?c+(s-2*Math.PI)*i:s<=-Math.PI?c+(s+2*Math.PI)*i:c+s*i}function LT(c,e,i){const s=(1-i)*Math.cos(c)+i*Math.cos(e),a=(1-i)*Math.sin(c)+i*Math.sin(e);return Math.atan2(a,s)}Xo.PluginType="CameraViews",Sl([Fn("cameraViews")],Xo.prototype,"_cameraViews",void 0),Sl([pn(Xo.prototype._animationLoop),Fn(),ts("Loop All Views",{limitedUi:!0})],Xo.prototype,"viewLooping",void 0),Sl([Fn(),qs("View Pause Time")],Xo.prototype,"viewPauseTime",void 0),Sl([Fn(),xv("Ease",Object.keys(vx).map(c=>({label:c})))],Xo.prototype,"animEase",void 0),Sl([Fn(),ss("Duration",[10,1e4],10,{limitedUi:!0})],Xo.prototype,"animDuration",void 0),Sl([Fn(),ss("RotationOffset",[.2,.75],.01)],Xo.prototype,"rotationOffset",void 0),Sl([Fn(),xv("Interpolation",["spherical","linear"].map(c=>({label:c})))],Xo.prototype,"interpolateMode",void 0),Sl([ts(),Fn()],Xo.prototype,"seekOnScroll",void 0),Sl([uo("Animate All Views",{limitedUi:!0})],Xo.prototype,"animateAllViews",null),Sl([uo("Record All Views")],Xo.prototype,"recordAllViews",null),Sl([uo("Add Current View")],Xo.prototype,"addCurrentView",null),Sl([uo("Focus Next")],Xo.prototype,"focusNext",void 0),Sl([uo("Focus Previous")],Xo.prototype,"focusPrevious",void 0);const HA=new b.Pa4;function WA(c,e,i){let s=c.dot(e);s=Math.min(Math.max(s,-1),1);const a=Math.acos(s)*i;return HA.copy(c).multiplyScalar(s).sub(e).negate().normalize(),c.multiplyScalar(Math.cos(a)).add(HA.multiplyScalar(Math.sin(a)))}var qA=function(c,e,i,s){var a,h=arguments.length,d=h<3?e:s===null?s=Object.getOwnPropertyDescriptor(e,i):s;if(typeof Reflect=="object"&&typeof Reflect.decorate=="function")d=Reflect.decorate(c,e,i,s);else for(var _=c.length-1;_>=0;_--)(a=c[_])&&(d=(h<3?a(d):h>3?a(e,i,d):a(e,i))||d);return h>3&&d&&Object.defineProperty(e,i,d),d};class iv extends Ls{constructor(e=!0){super(),this.enabled=!0,this.light=new Ax("#cceeff",1),this.lightLayers=1,this._preRender=()=>{var i,s,a;if(!this.enabled)return void(this.light.layers.mask=0);const h=(s=(i=this._viewer)===null||i===void 0?void 0:i.renderer.frameCount)!==null&&s!==void 0?s:0;(h<1||h>5)&&this.light.randomizePosition(h<5?0:h),this.light.layers.mask=this.lightLayers,this.light.updateShadowParams(),(a=this._cameraHelper)===null||a===void 0||a.update()},this._setDirty=this._setDirty.bind(this),this.enabled=e}get cameraHelper(){return this._cameraHelper}async onAdded(e){await super.onAdded(e),this._cameraHelper=new b.Rki(this.light.shadow.camera),this._cameraHelper.visible=!1,this._cameraHelper.userData.bboxVisible=!1,e.scene.add(this._cameraHelper),e.scene.addLight(this.light,{addToRoot:!0}),e.addEventListener("preRender",this._preRender)}async onRemove(e){return e.removeEventListener("preRender",this._preRender),this.light.removeFromParent(),super.onRemove(e)}_setDirty(e=!1){var i,s;e?(i=this._viewer)===null||i===void 0||i.scene.setDirty():(s=this._viewer)===null||s===void 0||s.setDirty()}get uiConfig(){return this._uiConfig?this._uiConfig:this._uiConfig={type:"folder",label:"Progressive Shadow",children:[{type:"checkbox",label:"Enabled",property:[this,"enabled"],onChange:this._setDirty},{type:"folder",label:"Directional Light",children:[{type:"checkbox",label:"Visible",property:[this.light,"visible"],onChange:this._setDirty},{type:"slider",label:"Intensity",bounds:[0,10],property:[this.light,"intensity"],onChange:this._setDirty},{type:"color",label:"Color",property:[this.light,"color"],onChange:this._setDirty},{type:"checkbox",label:"Shadow Enabled",property:[this.light.shadowParams,"enabled"],onChange:[this.light.updateShadowParams,this._setDirty]},{type:"slider",bounds:[0,1],property:[this.light.randomParams,"focus"],onChange:this._setDirty},{type:"slider",bounds:[0,1],property:[this.light.randomParams,"spread"],onChange:this._setDirty},{type:"slider",bounds:[.01,60],property:[this.light.randomParams,"distanceScale"],onChange:this._setDirty},{type:"vec3",bounds:[-5,5],property:[this.light.randomParams,"direction"],onChange:this._setDirty},{type:"slider",bounds:[.01,10],property:[this.light.shadowParams,"radius"],onChange:[this.light.updateShadowParams,this._setDirty]},{type:"slider",bounds:[.01,30],property:[this.light.shadowParams,"frustumSize"],onChange:[this.light.updateShadowParams,this._setDirty]},{type:"slider",bounds:[-.01,.01],property:[this.light.shadowParams,"bias"],onChange:[this.light.updateShadowParams,this._setDirty]}]}]}}}iv.PluginType="RandomizedDirectionalLight",qA([Fn()],iv.prototype,"enabled",void 0),qA([Fn("rdLight")],iv.prototype,"light",void 0),qA([Fn()],iv.prototype,"lightLayers",void 0);var Ix,Wv=function(c,e,i,s){var a,h=arguments.length,d=h<3?e:s===null?s=Object.getOwnPropertyDescriptor(e,i):s;if(typeof Reflect=="object"&&typeof Reflect.decorate=="function")d=Reflect.decorate(c,e,i,s);else for(var _=c.length-1;_>=0;_--)(a=c[_])&&(d=(h<3?a(d):h>3?a(e,i,d):a(e,i))||d);return h>3&&d&&Object.defineProperty(e,i,d),d};let rv=Ix=class extends Ls{constructor(c=!1){super(),this.enabled=!1,this.worldRadius=100,this.tripodHeight=10,this._paramsChanged=this._paramsChanged.bind(this),this.enabled=c}_paramsChanged(){var c,e,i,s,a,h,d,_,et,nt,it;const lt=(c=this._viewer)===null||c===void 0?void 0:c.getBackground(!0);if(this.enabled&&lt&&lt!==zv)if(lt.isDataTexture)lt.mapping=b.dSO;else if(confirm("Background must be same as environment, do you want to change it?")){const gt=(e=this._viewer)===null||e===void 0?void 0:e.getPluginByType("SimpleBackgroundEnvUiPlugin1");gt?(gt.envmapBg=!0,(s=(i=gt.uiConfig).uiRefresh)===null||s===void 0||s.call(i,"postFrame",!0)):(a=this._viewer)===null||a===void 0||a.setBackground(zv)}else this.enabled=!1;const ut=(et=(_=(d=(h=this._viewer)===null||h===void 0?void 0:h.renderer)===null||d===void 0?void 0:d.rendererObject)===null||_===void 0?void 0:_.background.getBoxMesh2())===null||et===void 0?void 0:et.material,pt=(nt=ut==null?void 0:ut.uniforms)!==null&&nt!==void 0?nt:b.Vj0.cube.uniforms;pt.tripodHeight||(pt.tripodHeight={value:1}),pt.worldRadius||(pt.worldRadius={value:1}),pt.tripodHeight.value=this.tripodHeight,pt.worldRadius.value=this.worldRadius,ut&&(!this.enabled&&ut.defines.HDRi_GROUND_PROJ?delete ut.defines.HDRi_GROUND_PROJ:this.enabled&&(ut.defines.HDRi_GROUND_PROJ="1"),ut.needsUpdate=!0),(it=this._viewer)===null||it===void 0||it.setDirty()}async onAdded(c){var e,i,s;await super.onAdded(c),!((s=(i=(e=this._viewer)===null||e===void 0?void 0:e.renderer)===null||i===void 0?void 0:i.rendererObject)===null||s===void 0)&&s.background.getBoxMesh()&&console.error("HDRi Ground Plugin must be added before setting any cube or env map"),b.Vj0.cube.fragmentShader=b.Vj0.cube.fragmentShader.replace("void main() {",`
#ifdef HDRi_GROUND_PROJ
float intersectPlane1(const in vec3 r0,const in vec3 rd,const in vec3 n,const in vec3 p0){float t=dot(p0-r0,n)/(dot(n,rd)+1e-6);return t<0.?1000.:t;}float intersectSphere1(in vec3 ro,in vec3 rd,in vec3 sph,in float rad){vec3 oc=ro-sph;float b=dot(oc,rd);float c=dot(oc,oc)-rad*rad;float t=b*b-c;return t<0.?t:-b+sqrt(t);}
#define PI_HALF  1.5707963267948966
uniform float worldRadius;uniform float tripodHeight;vec3 hdriProject(){vec3 p=normalize(vWorldDirection);vec3 camPos=cameraPosition;camPos.y-=tripodHeight;float t=intersectSphere1(camPos,p,vec3(0.,0.,0.),worldRadius);if(t>0.){float t2=intersectPlane1(camPos,p,vec3(0,-1,0),vec3(0.,-tripodHeight,0.));p=(camPos+min(t,t2)*p)/worldRadius;}else p=vec3(0.,1.,0.);return p;}
#endif

void main() {`),b.Vj0.cube.fragmentShader=b.Vj0.cube.fragmentShader.replace("vec3 vReflect = vWorldDirection;",`
vec3 vReflect = 
#ifdef HDRi_GROUND_PROJ
hdriProject()
#else
vWorldDirection
#endif
;
`),c.scene.addEventListener("environmentChanged",this._paramsChanged)}};rv.PluginType="HDRiGroundPlugin",Wv([Fn(),pn(Ix.prototype._paramsChanged),ts("Enabled")],rv.prototype,"enabled",void 0),Wv([Fn(),pn(Ix.prototype._paramsChanged),ss("World Radius",[1,1e3])],rv.prototype,"worldRadius",void 0),Wv([Fn(),pn(Ix.prototype._paramsChanged),ss("Tripod height",[0,50])],rv.prototype,"tripodHeight",void 0),rv=Ix=Wv([Ys("HDRi Ground")],rv);var YA=function(c,e,i,s){var a,h=arguments.length,d=h<3?e:s===null?s=Object.getOwnPropertyDescriptor(e,i):s;if(typeof Reflect=="object"&&typeof Reflect.decorate=="function")d=Reflect.decorate(c,e,i,s);else for(var _=c.length-1;_>=0;_--)(a=c[_])&&(d=(h<3?a(d):h>3?a(e,i,d):a(e,i))||d);return h>3&&d&&Object.defineProperty(e,i,d),d};const kp={uniforms:{colorTexture:{value:null},tNormalDepth:{value:null},blurTexture:{value:null},cocTexture:{value:null},cocTextureSize:{value:new b.FM8},cameraNearFar:{value:new b.FM8}},vertexShader:Km,fragmentShader:Fp+`
#include <common>
#include <packing>
varying vec2 vUv;uniform vec2 cocTextureSize;uniform vec2 nearFarBlurScale;uniform vec2 cameraNearFar;uniform vec2 focalDepthRange;uniform vec2 crossCenter;uniform float crossRadius;uniform float crossAlpha;uniform vec3 crossColor;float smoothBoundary(float d,float smooothFactor){smooothFactor*=0.5;float value=smoothstep(-smooothFactor,smooothFactor,d);return value;}float circle(vec2 p,float r){return min((length(p)-r),-(length(p)-r-0.01));}float computeCoc(){float depth=getDepth(vUv);if(depth>1.-0.01)return max(nearFarBlurScale.x,nearFarBlurScale.y);depth=mix(cameraNearFar.x,cameraNearFar.y,depth);float coc=(depth-focalDepthRange.x)/focalDepthRange.y;coc=clamp(coc,-1.,1.);return(coc>0.?coc*nearFarBlurScale.y:coc*nearFarBlurScale.x);}void main(){vec4 blur=blurTextureTexelToLinear(texture2D(blurTexture,vUv));float scale=0.5;blur+=blurTextureTexelToLinear(texture2D(blurTexture,vUv+scale*vec2(1.,1.)/cocTextureSize));blur+=blurTextureTexelToLinear(texture2D(blurTexture,vUv+scale*vec2(-1.,1.)/cocTextureSize));blur+=blurTextureTexelToLinear(texture2D(blurTexture,vUv+scale*vec2(-1.,-1.)/cocTextureSize));blur+=blurTextureTexelToLinear(texture2D(blurTexture,vUv+scale*vec2(1.,-1.)/cocTextureSize));blur/=5.;vec2 uvNearest=(floor(vUv*cocTextureSize)+0.5)/cocTextureSize;float coc=abs(min(2.*cocTextureTexelToLinear(texture2D(cocTexture,uvNearest)).a-1.,computeCoc()));float cocLower=0.005;float cocHigher=0.3;vec4 outColor=vec4(mix(colorTextureTexelToLinear(texture2D(colorTexture,vUv)).rgb,blur.rgb,smoothstep(cocLower,cocHigher,coc)),1.);vec2 d=vUv-crossCenter;if(length(d)>crossRadius+0.05){float dist=circle(d,crossRadius);gl_FragColor=outColor;}else{d.x*=cocTextureSize.x/cocTextureSize.y;float dist=circle(d,crossRadius);dist=smoothBoundary(dist,2.*fwidth(dist));vec4 color=outColor;vec3 dofCircleColor=mix(crossColor,color.rgb,1.-crossAlpha);gl_FragColor=vec4(mix(color.rgb,dofCircleColor,dist),color.a);}
#include <encodings_fragment>
}`},R0=(s_({uniforms:{cocTexture:{value:null},colorTexture:{value:null},colorTextureSize:{value:new b.FM8},direction:{value:new b.FM8}},vertexShader:Km,fragmentShader:`#include <common>
varying vec2 vUv;uniform vec2 colorTextureSize;uniform vec2 direction;const float MAXIMUM_BLUR_SIZE=16.;const float SIGMA=5.;const int NUM_SAMPLES=4;float normpdf(in float x,in float sigma){return 0.39894*exp(-0.5*x*x/(sigma*sigma))/sigma;}vec3 weightedBlur(){float cocIn=2.*cocTextureTexelToLinear(texture2D(cocTexture,vUv)).a-1.;float kernelRadius=MAXIMUM_BLUR_SIZE*cocIn;vec2 invSize=1./colorTextureSize;cocIn*=cocIn*cocIn;float centreSpaceWeight=normpdf(0.,SIGMA)*abs(cocIn);float weightSum=centreSpaceWeight;vec3 centreSample=colorTextureTexelToLinear(texture2D(colorTexture,vUv)).rgb;vec3 diffuseSum=centreSample*weightSum;vec2 delta=invSize*kernelRadius/float(NUM_SAMPLES);for(int i=1;i<=NUM_SAMPLES;i++){float spaceWeight=normpdf(float(i),SIGMA);vec2 texcoord=direction*delta*float(i);vec4 rightSample=colorTextureTexelToLinear(texture2D(colorTexture,vUv+texcoord));vec4 leftSample=colorTextureTexelToLinear(texture2D(colorTexture,vUv-texcoord));float leftCocWeight=abs(2.*cocTextureTexelToLinear(texture2D(cocTexture,vUv-texcoord)).a-1.);float rightCocWeight=abs(2.*cocTextureTexelToLinear(texture2D(cocTexture,vUv+texcoord)).a-1.);leftCocWeight*=leftCocWeight*leftCocWeight;rightCocWeight*=rightCocWeight*rightCocWeight;diffuseSum+=((leftSample.rgb*leftCocWeight)+(rightSample.rgb*rightCocWeight))*spaceWeight;weightSum+=(spaceWeight*(leftCocWeight+rightCocWeight));}return diffuseSum/weightSum;}void main(){gl_FragColor=vec4(weightedBlur(),1.);
#include <encodings_fragment>
}`},"colorTexture","cocTexture"),s_({uniforms:{colorTexture:{value:null},colorTextureSize:{value:new b.FM8},direction:{value:new b.FM8},frameCount:{value:0},blurRadius:{value:16}},vertexShader:Km,fragmentShader:Jm+`
`+MC+`
#include <common>
varying vec2 vUv;uniform vec2 colorTextureSize;uniform float blurRadius;vec4 CircularBlur(){vec4 color=colorTextureTexelToLinear(texture2D(colorTexture,vUv));
#ifdef DOF_MODE
float blurDist=blurRadius*(2.*color.a-1.);
#else
float blurDist=blurRadius*color.a;
#endif
float rnd=PI2*random3(vec3(vUv,frameCount*0.1));float costheta=cos(rnd);float sintheta=sin(rnd);vec4 rotationMatrix=vec4(costheta,-sintheta,sintheta,costheta);vec3 colorSum=vec3(0.);float weightSum=0.001;vec2 ofs;vec4 sampleColor;setPds();
#pragma unroll_loop_start
for(int i=0;i<16;i++){ofs=poisson_disk_samples[UNROLLED_LOOP_INDEX];ofs=vec2(dot(ofs,rotationMatrix.xy),dot(ofs,rotationMatrix.zw));sampleColor=colorTextureTexelToLinear(texture2D(colorTexture,vUv+blurDist*ofs/colorTextureSize.xy));
#ifdef DOF_MODE
sampleColor.a=abs(sampleColor.a*2.-1.);sampleColor.a*=sampleColor.a*sampleColor.a;
#endif
colorSum+=sampleColor.rgb*sampleColor.a;weightSum+=sampleColor.a;}
#pragma unroll_loop_end
colorSum/=weightSum;return vec4(saturate(colorSum),1.);}void main(){gl_FragColor=CircularBlur();
#include <encodings_fragment>
}`,defines:{DOF_MODE:1}},"colorTexture"));class T_ extends Tl{constructor(){super(kp,"colorTexture","cocTexture","blurTexture"),this.dofBlurMaterial=R0,this.nearFarBlurScale=new b.FM8(.25,.25),this.focalDepthRange=new b.FM8(.5,1.5),this.crossCenter=new b.FM8(.5,.5),this.crossRadius=.04,this.crossAlpha=1,this.crossColor=new mo(16750848),this.uiConfig={type:"folder",label:"Depth of Field",children:[{type:"checkbox",label:"Enabled",limitedUi:!0,property:[this,"enabled"]},{type:"slider",label:"Depth Range",bounds:[.5,3],property:[this.focalDepthRange,"y"]},{type:"slider",label:"Near Blur scale",bounds:[0,1],property:[this.nearFarBlurScale,"x"]},{type:"slider",label:"Far Blur scale",bounds:[0,1],property:[this.nearFarBlurScale,"y"]}]},this.material.extensions.derivatives=!0,this.computeCocMaterial=s_({uniforms:{colorTexture:{value:null},tNormalDepth:this.uniforms.tNormalDepth,cameraNearFar:this.uniforms.cameraNearFar,nearFarBlurScale:this.uniforms.nearFarBlurScale,focalDepthRange:this.uniforms.focalDepthRange},vertexShader:Km,fragmentShader:Fp+`
#include <common>
#include <packing>
varying vec2 vUv;uniform vec2 nearFarBlurScale;uniform vec2 cameraNearFar;uniform vec2 focalDepthRange;float computeCoc(){float depth=getDepth(vUv);if(depth==1.)return max(nearFarBlurScale.x,nearFarBlurScale.y);depth=mix(cameraNearFar.x,cameraNearFar.y,depth);float coc=(depth-focalDepthRange.x)/focalDepthRange.y;coc=clamp(coc,-1.,1.);return(coc>0.?coc*nearFarBlurScale.y:coc*nearFarBlurScale.x);}void main(){gl_FragColor=vec4(colorTextureTexelToLinear(texture2D(colorTexture,vUv)).rgb,0.5*computeCoc()+0.5);
#include <encodings_fragment>
}`},"colorTexture"),this.expandCocMaterial=s_({uniforms:{colorTexture:{value:null},colorTextureSize:{value:new b.FM8},direction:{value:new b.FM8},tNormalDepth:this.uniforms.tNormalDepth,nearFarBlurScale:this.uniforms.nearFarBlurScale},vertexShader:Km,fragmentShader:Fp+`
#include <common>
varying vec2 vUv;uniform vec2 colorTextureSize;uniform vec2 direction;uniform vec2 nearFarBlurScale;const float MAXIMUM_BLUR_SIZE=4.;float expandNear(const in vec2 offset,const in bool isBackground){float coc=0.;vec2 sampleOffsets=MAXIMUM_BLUR_SIZE*offset/5.;float coc0=2.*colorTextureTexelToLinear(texture2D(colorTexture,vUv)).a-1.;float coc1=2.*colorTextureTexelToLinear(texture2D(colorTexture,vUv-5.*sampleOffsets)).a-1.;float coc2=2.*colorTextureTexelToLinear(texture2D(colorTexture,vUv-4.*sampleOffsets)).a-1.;float coc3=2.*colorTextureTexelToLinear(texture2D(colorTexture,vUv-3.*sampleOffsets)).a-1.;float coc4=2.*colorTextureTexelToLinear(texture2D(colorTexture,vUv-2.*sampleOffsets)).a-1.;float coc5=2.*colorTextureTexelToLinear(texture2D(colorTexture,vUv-1.*sampleOffsets)).a-1.;float coc6=2.*colorTextureTexelToLinear(texture2D(colorTexture,vUv+1.*sampleOffsets)).a-1.;float coc7=2.*colorTextureTexelToLinear(texture2D(colorTexture,vUv+2.*sampleOffsets)).a-1.;float coc8=2.*colorTextureTexelToLinear(texture2D(colorTexture,vUv+3.*sampleOffsets)).a-1.;float coc9=2.*colorTextureTexelToLinear(texture2D(colorTexture,vUv+4.*sampleOffsets)).a-1.;float coc10=2.*colorTextureTexelToLinear(texture2D(colorTexture,vUv+5.*sampleOffsets)).a-1.;if(isBackground){coc=abs(coc0)*0.095474+(abs(coc1)+abs(coc10))*0.084264+(abs(coc2)+abs(coc9))*0.088139+(abs(coc3)+abs(coc8))*0.091276+(abs(coc4)+abs(coc7))*0.093585+(abs(coc5)+abs(coc6))*0.094998;}else{coc=min(coc0,0.);coc=min(coc1*0.3,coc);coc=min(coc2*0.5,coc);coc=min(coc3*0.75,coc);coc=min(coc4*0.8,coc);coc=min(coc5*0.95,coc);coc=min(coc6*0.95,coc);coc=min(coc7*0.8,coc);coc=min(coc8*0.75,coc);coc=min(coc9*0.5,coc);coc=min(coc10*0.3,coc);if(abs(coc0)>abs(coc))coc=coc0;}return coc;}void main(){vec2 offset=2.*direction/colorTextureSize;bool isBackground=getDepth(vUv)>1.-0.001;float coc=expandNear(offset,isBackground);gl_FragColor=vec4(colorTextureTexelToLinear(texture2D(colorTexture,vUv)).rgb,0.5*coc+0.5);
#include <encodings_fragment>
}`},"colorTexture")}render(e,i,s,a,h){if(!this.enabled)return;const d=e.baseRenderer,_={minFilter:b.TyD,magFilter:b.TyD,type:b.cLu,encoding:b.rnI,sizeMultiplier:.5,isAntialiased:!1,format:b.wk1,depthBuffer:!1,generateMipmaps:!1},et=d.getTempTarget(_),nt=d.getTempTarget(_);if(this.computeCocMaterial.uniforms.colorTexture.value=s.texture,d.blit(void 0,et,{material:this.computeCocMaterial}),this.expandCocMaterial.uniforms.colorTexture.value=et.texture,this.expandCocMaterial.uniforms.direction.value.set(1,0),d.blit(void 0,nt,{material:this.expandCocMaterial}),this.expandCocMaterial.uniforms.colorTexture.value=nt.texture,this.expandCocMaterial.uniforms.direction.value.set(0,1),d.blit(void 0,et,{material:this.expandCocMaterial}),this.dofBlurMaterial.uniforms.frameCount)this.dofBlurMaterial.uniforms.colorTexture.value=et.texture,d.blit(void 0,nt,{material:this.dofBlurMaterial});else{const it=d.getTempTarget(_);this.dofBlurMaterial.uniforms.cocTexture.value=et.texture,this.dofBlurMaterial.uniforms.colorTexture.value=et.texture,this.dofBlurMaterial.uniforms.direction.value.set(1,0),d.blit(void 0,it,{material:this.dofBlurMaterial}),this.dofBlurMaterial.uniforms.colorTexture.value=it.texture,this.dofBlurMaterial.uniforms.direction.value.set(0,1),d.blit(void 0,nt,{material:this.dofBlurMaterial}),d.releaseTempTarget(it)}this.material.uniforms.blurTexture.value=nt.texture,this.material.uniforms.cocTexture.value=et.texture,super.render(e,i,s,a,h),d.releaseTempTarget(et),d.releaseTempTarget(nt)}}YA([Fn(),rn()],T_.prototype,"nearFarBlurScale",void 0),YA([Fn(),rn()],T_.prototype,"focalDepthRange",void 0),YA([rn()],T_.prototype,"crossCenter",void 0),YA([rn()],T_.prototype,"crossRadius",void 0),YA([rn()],T_.prototype,"crossAlpha",void 0),YA([rn()],T_.prototype,"crossColor",void 0);var sv=function(c,e,i,s){var a,h=arguments.length,d=h<3?e:s===null?s=Object.getOwnPropertyDescriptor(e,i):s;if(typeof Reflect=="object"&&typeof Reflect.decorate=="function")d=Reflect.decorate(c,e,i,s);else for(var _=c.length-1;_>=0;_--)(a=c[_])&&(d=(h<3?a(d):h>3?a(e,i,d):a(e,i))||d);return h>3&&d&&Object.defineProperty(e,i,d),d};class XA extends Am{constructor(e=!0,i=!1){super(),this.passId="depthOfField",this._beforeFilters=["progressive","tonemap","screen"],this._afterFilters=["render"],this._requiredFilters=["render"],this.dependencies=[ho],this.enableEdit=!1,this._focalPointHit=new b.Pa4(0,0,0),this.crossFadeTime=200,this._focalPointHitTime=0,this._tempVec=new b.Pa4,this.enabled=e,this.enableEdit=i,this._onObjectHit=this._onObjectHit.bind(this),this.setDirty=this.setDirty.bind(this)}passCtor(e){return new T_}setFocalPoint(e,i=!0,s=!1){var a,h;this._focalPointHit.copy(e),i&&((h=(a=this._viewer)===null||a===void 0?void 0:a.getPlugin(ev))===null||h===void 0||h.startTransition(this._frameFadeTime)),s&&(this._focalPointHitTime=Yu()),this.setDirty()}getFocalPoint(){return this._focalPointHit}get depthRange(){var e,i;return(i=(e=this.pass)===null||e===void 0?void 0:e.passObject.focalDepthRange.y)!==null&&i!==void 0?i:0}set depthRange(e){this.pass&&(this.pass.passObject.focalDepthRange.y=e),this.setDirty()}get nearBlurScale(){var e,i;return(i=(e=this.pass)===null||e===void 0?void 0:e.passObject.nearFarBlurScale.x)!==null&&i!==void 0?i:0}set nearBlurScale(e){this.pass&&(this.pass.passObject.nearFarBlurScale.x=e),this.setDirty()}get farBlurScale(){var e,i;return(i=(e=this.pass)===null||e===void 0?void 0:e.passObject.nearFarBlurScale.y)!==null&&i!==void 0?i:0}set farBlurScale(e){this.pass&&(this.pass.passObject.nearFarBlurScale.y=e),this.setDirty()}get _frameFadeTime(){return 2.5*this.crossFadeTime}_onObjectHit(e){var i,s;this._pass&&e.intersects.intersect&&this.enabled&&this.enableEdit&&(this._focalPointHit.copy(e.intersects.intersect.point),this._focalPointHitTime=e.time,e.intersects.selectedObject=null,(s=(i=this._viewer)===null||i===void 0?void 0:i.getPlugin(ev))===null||s===void 0||s.startTransition(this._frameFadeTime),this.setDirty())}async onAdded(e){var i;await super.onAdded(e),(i=e.getPluginByType("Picking"))===null||i===void 0||i.addEventListener("hitObject",this._onObjectHit)}async onRemove(e){var i;return(i=e.getPluginByType("Picking"))===null||i===void 0||i.removeEventListener("hitObject",this._onObjectHit),super.onRemove(e)}setDirty(){var e;(e=this._viewer)===null||e===void 0||e.setDirty()}_update(e){var i,s;if(!super._update(e))return!1;const a=(i=this.pass)===null||i===void 0?void 0:i.passObject;if(!a)return!1;const h=e.getPlugin(ho);h==null||h.updateShaderProperties(a.material),a.dofBlurMaterial.uniforms.frameCount&&((s=e.renderer)===null||s===void 0||s.updateShaderProperties(a.dofBlurMaterial));const d=e.scene.activeCamera;if(!d)return!1;d.cameraObject.updateMatrixWorld(!0),d.updateShaderProperties(a.material),this._tempVec.subVectors(this._focalPointHit,d.cameraObject.position),a.focalDepthRange.x=this._tempVec.length(),a.focalDepthRange.x*=d.cameraObject.getWorldDirection(new b.Pa4).dot(this._tempVec.normalize());let _=(Yu()-this._focalPointHitTime)/this.crossFadeTime;if(_=1-Math.min(1,Math.max(0,_)),Math.abs(_-a.crossAlpha)>.01&&(a.crossAlpha=_,this.setDirty()),_>0){const et=this._tempVec.copy(this._focalPointHit).project(d.cameraObject).addScalar(1).divideScalar(2);a.crossCenter.set(et.x,et.y),a.computeCocMaterial.uniformsNeedUpdate=!0,a.expandCocMaterial.uniformsNeedUpdate=!0}return!0}get uiConfig(){var e,i,s,a,h;if(this._uiConfig)return this._uiConfig;const d=(i=(e=this._pass)===null||e===void 0?void 0:e.passObject)===null||i===void 0?void 0:i.uiConfig;return d?((a=(s=d.children)===null||s===void 0?void 0:s.map(_=>Yt(_)))===null||a===void 0||a.flat(2).forEach(_=>_&&(_.onChange=this.setDirty)),(h=d.children)===null||h===void 0||h.push({type:"checkbox",label:"Enable Edit",limitedUi:!0,property:[this,"enableEdit"]}),this._uiConfig=d,d):{}}}XA.PluginType="DepthOfField",sv([Fn()],XA.prototype,"enableEdit",void 0),sv([Fn("focalPoint")],XA.prototype,"_focalPointHit",void 0),sv([Fn()],XA.prototype,"crossFadeTime",void 0);var rw,ov=function(c,e,i,s){var a,h=arguments.length,d=h<3?e:s===null?s=Object.getOwnPropertyDescriptor(e,i):s;if(typeof Reflect=="object"&&typeof Reflect.decorate=="function")d=Reflect.decorate(c,e,i,s);else for(var _=c.length-1;_>=0;_--)(a=c[_])&&(d=(h<3?a(d):h>3?a(e,i,d):a(e,i))||d);return h>3&&d&&Object.defineProperty(e,i,d),d};let xm=rw=class extends Ls{constructor(c=!0){super(),this.enabled=!0,this.radius=.015,this.intensity=1,this.tolerance=1.5,this._defines={},this.onlySSCSDebug=!1,this.stepCount=2,this.dependencies=[ho,qr],this.materialExtension={shaderExtender:(e,i,s)=>{if(!e.defines.SSCS_ENABLED)return;const a=Qt`
                #ifndef D_sceneBoundingRadius
                #define D_sceneBoundingRadius
                uniform float sceneBoundingRadius;
                #endif
                float getShadow( sampler2D shadowMap, vec2 shadowMapSize, float shadowBias, float shadowRadius, vec4 shadowCoord, vec3 lightDirection ) {
                    vec3 ray_origin_view = -vViewPosition;
                    float rnd = interleavedGradientNoise(gl_FragCoord.xy, frameCount+34.);
                    float cameraDist = length(cameraPositionWorld);
//                    float radius = mix((cameraNearFar.y) + ray_origin_view.z, -ray_origin_view.z - cameraNearFar.x, rnd * 0.5 + 0.5)*sscsRadius;
                    float radius = mix((cameraDist + sceneBoundingRadius) + ray_origin_view.z, -ray_origin_view.z - max(0.0, cameraDist - sceneBoundingRadius), rnd * 0.5 + 0.5)*sscsRadius;
                    vec3 state = vec3(1.,(rnd+0.5)/float(SSCS_STEP_COUNT),2.);
                    traceRay(ray_origin_view, normalize(lightDirection) * radius, sscsTolerance * radius * 2., state, SSCS_STEP_COUNT);
                    state.z = state.z > 0.99 ? 1. : max(0.,min(state.z * state.z * (1.-sscsIntensity), 1.));
                    
                #if defined(SSCS_DEBUG) && SSCS_DEBUG > 0
                    return state.z;
                #endif
            `,h=`
#if SSCS_ENABLED

    uniform float sscsIntensity;
    uniform float sscsRadius;
    uniform float sscsTolerance;

    ${Q1}
    
    #define THREE_PACKING_INCLUDED
    ${$w}
    
    ${Fp}
    ${Jm}
    
    ${G1}

#endif
            
            `+b.WdD.shadowmap_pars_fragment.replace("float getShadow( sampler2D shadowMap, vec2 shadowMapSize, float shadowBias, float shadowRadius, vec4 shadowCoord ) {",`${a}
`).replace("return shadow;","return min(shadow, state.z);");e.fragmentShader=e.fragmentShader.replace("#include <shadowmap_pars_fragment>",h),e.fragmentShader=e.fragmentShader.replace("#include <lights_fragment_begin>",b.WdD.lights_fragment_begin),e.fragmentShader=e.fragmentShader.replace("directLight.color *= all( bvec2( directLight.visible, receiveShadow ) ) ? getShadow( directionalShadowMap[ i ], directionalLightShadow.shadowMapSize, directionalLightShadow.shadowBias, directionalLightShadow.shadowRadius, vDirectionalShadowCoord[ i ] ) : 1.0;","directLight.color *= all( bvec2( directLight.visible, receiveShadow ) ) ? getShadow( directionalShadowMap[ i ], directionalLightShadow.shadowMapSize, directionalLightShadow.shadowBias, directionalLightShadow.shadowRadius, vDirectionalShadowCoord[ i ], directLight.direction ) : 1.0;").replace("directLight.color *= all( bvec2( directLight.visible, receiveShadow ) ) ? getShadow( spotShadowMap[ i ], spotLightShadow.shadowMapSize, spotLightShadow.shadowBias, spotLightShadow.shadowRadius, vSpotShadowCoord[ i ] ) : 1.0;","directLight.color *= all( bvec2( directLight.visible, receiveShadow ) ) ? getShadow( spotShadowMap[ i ], spotLightShadow.shadowMapSize, spotLightShadow.shadowBias, spotLightShadow.shadowRadius, vSpotShadowCoord[ i ], directLight.direction ) : 1.0;")},onObjectRender:(e,i,s)=>{var a;const h=i.materialObject;let d=this.enabled&&s.userData.screenSpaceRendering!==!1&&!(!((a=h.userData)===null||a===void 0)&&a.sscsDisabled)?1:0;h.defines.SSCS_ENABLED!==d&&(h.defines.SSCS_ENABLED=d,h.needsUpdate=!0),d=this._defines.SSCS_STEP_COUNT,h.defines.SSCS_STEP_COUNT!==d&&(h.defines.SSCS_STEP_COUNT=d,h.needsUpdate=!0),d=+this._defines.SSCS_DEBUG,h.defines.SSCS_DEBUG!==d&&(h.defines.SSCS_DEBUG=d,h.needsUpdate=!0)},parsFragmentSnippet:()=>`
`,extraUniforms:{...rw._uniforms},computeCacheKey:e=>this.enabled?"1":"0",isCompatible:e=>e.isMeshStandardMaterial2,updaters:()=>{var e,i,s,a,h;return[(e=this._viewer)===null||e===void 0?void 0:e.getPlugin(ho),(i=this._viewer)===null||i===void 0?void 0:i.getPlugin(Bu),(s=this._viewer)===null||s===void 0?void 0:s.scene.activeCamera,(a=this._viewer)===null||a===void 0?void 0:a.renderer,(h=this._viewer)===null||h===void 0?void 0:h.scene]}},this.enabled=c,this.userData={setDirty:()=>{var e;(e=this._viewer)===null||e===void 0||e.setDirty()}}}async onAdded(c){var e,i;await super.onAdded(c),(i=(e=c.getPlugin(qr))===null||e===void 0?void 0:e.materials)===null||i===void 0||i.registerMaterialExtension(this.materialExtension)}async onRemove(c){var e,i;return(i=(e=c.getPlugin(qr))===null||e===void 0?void 0:e.materials)===null||i===void 0||i.unregisterMaterialExtension(this.materialExtension),super.onRemove(c)}};xm.PluginType="SSContactShadows",xm._uniforms={tNormalDepth:{value:null},frameCount:{value:0},projection:{value:new b.yGw},cameraPositionWorld:{value:new b.Pa4},cameraNearFar:{value:new b.FM8(.1,1e3)},sceneBoundingRadius:{value:0}},ov([ts("Enabled"),Fn()],xm.prototype,"enabled",void 0),ov([rn({uniforms:rw._uniforms,propKey:"sscsRadius"}),ss("Radius",[1e-4,.1],1e-4),Fn()],xm.prototype,"radius",void 0),ov([rn({uniforms:rw._uniforms,propKey:"sscsIntensity"}),ss("Intensity",[1e-4,1],1e-4),Fn()],xm.prototype,"intensity",void 0),ov([rn({uniforms:rw._uniforms,propKey:"sscsTolerance"}),ss("Tolerance",[.1,5]),Fn()],xm.prototype,"tolerance",void 0),ov([jn("SSCS_DEBUG",void 0,!0),ts("Debug only SSCS"),Fn()],xm.prototype,"onlySSCSDebug",void 0),ov([jn("SSCS_STEP_COUNT",void 0,!0),ss("Step count",[1,8],1),Fn()],xm.prototype,"stepCount",void 0),xm=rw=ov([Ys("Screen Space Contact Shadows")],xm);class wD{constructor(e=4){this.pool=e,this.queue=[],this.workers=[],this.workersResolve=[],this.workerStatus=0}_initWorker(e){if(!this.workers[e]){const i=this.workerCreator();i.addEventListener("message",this._onMessage.bind(this,e)),this.workers[e]=i}}_getIdleWorker(){for(let e=0;e<this.pool;e++)if(!(this.workerStatus&1<<e))return e;return-1}_onMessage(e,i){const s=this.workersResolve[e];if(s&&s(i),this.queue.length){const{resolve:a,msg:h,transfer:d}=this.queue.shift();this.workersResolve[e]=a,this.workers[e].postMessage(h,d)}else this.workerStatus^=1<<e}setWorkerCreator(e){this.workerCreator=e}setWorkerLimit(e){this.pool=e}postMessage(e,i){return new Promise(s=>{const a=this._getIdleWorker();a!==-1?(this._initWorker(a),this.workerStatus|=1<<a,this.workersResolve[a]=s,this.workers[a].postMessage(e,i)):this.queue.push({resolve:s,msg:e,transfer:i})})}dispose(){this.workers.forEach(e=>e.terminate()),this.workersResolve.length=0,this.workers.length=0,this.queue.length=0,this.workerStatus=0}}class xD{constructor(){this.vkFormat=0,this.typeSize=1,this.pixelWidth=0,this.pixelHeight=0,this.pixelDepth=0,this.layerCount=0,this.faceCount=1,this.supercompressionScheme=0,this.levels=[],this.dataFormatDescriptor=[{vendorId:0,descriptorType:0,descriptorBlockSize:0,versionNumber:2,colorModel:0,colorPrimaries:1,transferFunction:2,flags:0,texelBlockDimension:[0,0,0,0],bytesPlane:[0,0,0,0,0,0,0,0],samples:[]}],this.keyValue={},this.globalData=null}}class bm{constructor(e,i,s,a){this._dataView=new DataView(e.buffer,e.byteOffset+i,s),this._littleEndian=a,this._offset=0}_nextUint8(){const e=this._dataView.getUint8(this._offset);return this._offset+=1,e}_nextUint16(){const e=this._dataView.getUint16(this._offset,this._littleEndian);return this._offset+=2,e}_nextUint32(){const e=this._dataView.getUint32(this._offset,this._littleEndian);return this._offset+=4,e}_nextUint64(){const e=this._dataView.getUint32(this._offset,this._littleEndian)+4294967296*this._dataView.getUint32(this._offset+4,this._littleEndian);return this._offset+=8,e}_nextInt32(){const e=this._dataView.getInt32(this._offset,this._littleEndian);return this._offset+=4,e}_skip(e){return this._offset+=e,this}_scan(e,i=0){const s=this._offset;let a=0;for(;this._dataView.getUint8(this._offset)!==i&&a<e;)a++,this._offset++;return a<e&&this._offset++,new Uint8Array(this._dataView.buffer,this._dataView.byteOffset+s,a)}}const ep=[171,75,84,88,32,50,48,187,13,10,26,10];function DC(c){return typeof TextDecoder<"u"?new TextDecoder().decode(c):Buffer.from(c).toString("utf8")}let xE,qv,Dx;const PC={env:{emscripten_notify_memory_growth:function(c){Dx=new Uint8Array(qv.exports.memory.buffer)}}};class NT{init(){return xE||(xE=typeof fetch<"u"?fetch("data:application/wasm;base64,"+RC).then(e=>e.arrayBuffer()).then(e=>WebAssembly.instantiate(e,PC)).then(this._init):WebAssembly.instantiate(Buffer.from(RC,"base64"),PC).then(this._init),xE)}_init(e){qv=e.instance,PC.env.emscripten_notify_memory_growth(0)}decode(e,i=0){if(!qv)throw new Error("ZSTDDecoder: Await .init() before decoding.");const s=e.byteLength,a=qv.exports.malloc(s);Dx.set(e,a),i=i||Number(qv.exports.ZSTD_findDecompressedSize(a,s));const h=qv.exports.malloc(i),d=qv.exports.ZSTD_decompress(h,i,a,s),_=Dx.slice(h,h+d);return qv.exports.free(a),qv.exports.free(h),_}}const RC="AGFzbQEAAAABpQEVYAF/AX9gAn9/AGADf39/AX9gBX9/f39/AX9gAX8AYAJ/fwF/YAR/f39/AX9gA39/fwBgBn9/f39/fwF/YAd/f39/f39/AX9gAn9/AX5gAn5+AX5gAABgBX9/f39/AGAGf39/f39/AGAIf39/f39/f38AYAl/f39/f39/f38AYAABf2AIf39/f39/f38Bf2ANf39/f39/f39/f39/fwF/YAF/AX4CJwEDZW52H2Vtc2NyaXB0ZW5fbm90aWZ5X21lbW9yeV9ncm93dGgABANpaAEFAAAFAgEFCwACAQABAgIFBQcAAwABDgsBAQcAEhMHAAUBDAQEAAANBwQCAgYCBAgDAwMDBgEACQkHBgICAAYGAgQUBwYGAwIGAAMCAQgBBwUGCgoEEQAEBAEIAwgDBQgDEA8IAAcABAUBcAECAgUEAQCAAgYJAX8BQaCgwAILB2AHBm1lbW9yeQIABm1hbGxvYwAoBGZyZWUAJgxaU1REX2lzRXJyb3IAaBlaU1REX2ZpbmREZWNvbXByZXNzZWRTaXplAFQPWlNURF9kZWNvbXByZXNzAEoGX3N0YXJ0ACQJBwEAQQELASQKussBaA8AIAAgACgCBCABajYCBAsZACAAKAIAIAAoAgRBH3F0QQAgAWtBH3F2CwgAIABBiH9LC34BBH9BAyEBIAAoAgQiA0EgTQRAIAAoAggiASAAKAIQTwRAIAAQDQ8LIAAoAgwiAiABRgRAQQFBAiADQSBJGw8LIAAgASABIAJrIANBA3YiBCABIARrIAJJIgEbIgJrIgQ2AgggACADIAJBA3RrNgIEIAAgBCgAADYCAAsgAQsUAQF/IAAgARACIQIgACABEAEgAgv3AQECfyACRQRAIABCADcCACAAQQA2AhAgAEIANwIIQbh/DwsgACABNgIMIAAgAUEEajYCECACQQRPBEAgACABIAJqIgFBfGoiAzYCCCAAIAMoAAA2AgAgAUF/ai0AACIBBEAgAEEIIAEQFGs2AgQgAg8LIABBADYCBEF/DwsgACABNgIIIAAgAS0AACIDNgIAIAJBfmoiBEEBTQRAIARBAWtFBEAgACABLQACQRB0IANyIgM2AgALIAAgAS0AAUEIdCADajYCAAsgASACakF/ai0AACIBRQRAIABBADYCBEFsDwsgAEEoIAEQFCACQQN0ams2AgQgAgsWACAAIAEpAAA3AAAgACABKQAINwAICy8BAX8gAUECdEGgHWooAgAgACgCAEEgIAEgACgCBGprQR9xdnEhAiAAIAEQASACCyEAIAFCz9bTvtLHq9lCfiAAfEIfiUKHla+vmLbem55/fgsdAQF/IAAoAgggACgCDEYEfyAAKAIEQSBGBUEACwuCBAEDfyACQYDAAE8EQCAAIAEgAhBnIAAPCyAAIAJqIQMCQCAAIAFzQQNxRQRAAkAgAkEBSARAIAAhAgwBCyAAQQNxRQRAIAAhAgwBCyAAIQIDQCACIAEtAAA6AAAgAUEBaiEBIAJBAWoiAiADTw0BIAJBA3ENAAsLAkAgA0F8cSIEQcAASQ0AIAIgBEFAaiIFSw0AA0AgAiABKAIANgIAIAIgASgCBDYCBCACIAEoAgg2AgggAiABKAIMNgIMIAIgASgCEDYCECACIAEoAhQ2AhQgAiABKAIYNgIYIAIgASgCHDYCHCACIAEoAiA2AiAgAiABKAIkNgIkIAIgASgCKDYCKCACIAEoAiw2AiwgAiABKAIwNgIwIAIgASgCNDYCNCACIAEoAjg2AjggAiABKAI8NgI8IAFBQGshASACQUBrIgIgBU0NAAsLIAIgBE8NAQNAIAIgASgCADYCACABQQRqIQEgAkEEaiICIARJDQALDAELIANBBEkEQCAAIQIMAQsgA0F8aiIEIABJBEAgACECDAELIAAhAgNAIAIgAS0AADoAACACIAEtAAE6AAEgAiABLQACOgACIAIgAS0AAzoAAyABQQRqIQEgAkEEaiICIARNDQALCyACIANJBEADQCACIAEtAAA6AAAgAUEBaiEBIAJBAWoiAiADRw0ACwsgAAsMACAAIAEpAAA3AAALQQECfyAAKAIIIgEgACgCEEkEQEEDDwsgACAAKAIEIgJBB3E2AgQgACABIAJBA3ZrIgE2AgggACABKAAANgIAQQALDAAgACABKAIANgAAC/cCAQJ/AkAgACABRg0AAkAgASACaiAASwRAIAAgAmoiBCABSw0BCyAAIAEgAhALDwsgACABc0EDcSEDAkACQCAAIAFJBEAgAwRAIAAhAwwDCyAAQQNxRQRAIAAhAwwCCyAAIQMDQCACRQ0EIAMgAS0AADoAACABQQFqIQEgAkF/aiECIANBAWoiA0EDcQ0ACwwBCwJAIAMNACAEQQNxBEADQCACRQ0FIAAgAkF/aiICaiIDIAEgAmotAAA6AAAgA0EDcQ0ACwsgAkEDTQ0AA0AgACACQXxqIgJqIAEgAmooAgA2AgAgAkEDSw0ACwsgAkUNAgNAIAAgAkF/aiICaiABIAJqLQAAOgAAIAINAAsMAgsgAkEDTQ0AIAIhBANAIAMgASgCADYCACABQQRqIQEgA0EEaiEDIARBfGoiBEEDSw0ACyACQQNxIQILIAJFDQADQCADIAEtAAA6AAAgA0EBaiEDIAFBAWohASACQX9qIgINAAsLIAAL8wICAn8BfgJAIAJFDQAgACACaiIDQX9qIAE6AAAgACABOgAAIAJBA0kNACADQX5qIAE6AAAgACABOgABIANBfWogAToAACAAIAE6AAIgAkEHSQ0AIANBfGogAToAACAAIAE6AAMgAkEJSQ0AIABBACAAa0EDcSIEaiIDIAFB/wFxQYGChAhsIgE2AgAgAyACIARrQXxxIgRqIgJBfGogATYCACAEQQlJDQAgAyABNgIIIAMgATYCBCACQXhqIAE2AgAgAkF0aiABNgIAIARBGUkNACADIAE2AhggAyABNgIUIAMgATYCECADIAE2AgwgAkFwaiABNgIAIAJBbGogATYCACACQWhqIAE2AgAgAkFkaiABNgIAIAQgA0EEcUEYciIEayICQSBJDQAgAa0iBUIghiAFhCEFIAMgBGohAQNAIAEgBTcDGCABIAU3AxAgASAFNwMIIAEgBTcDACABQSBqIQEgAkFgaiICQR9LDQALCyAACy8BAn8gACgCBCAAKAIAQQJ0aiICLQACIQMgACACLwEAIAEgAi0AAxAIajYCACADCy8BAn8gACgCBCAAKAIAQQJ0aiICLQACIQMgACACLwEAIAEgAi0AAxAFajYCACADCx8AIAAgASACKAIEEAg2AgAgARAEGiAAIAJBCGo2AgQLCAAgAGdBH3MLugUBDX8jAEEQayIKJAACfyAEQQNNBEAgCkEANgIMIApBDGogAyAEEAsaIAAgASACIApBDGpBBBAVIgBBbCAAEAMbIAAgACAESxsMAQsgAEEAIAEoAgBBAXRBAmoQECENQVQgAygAACIGQQ9xIgBBCksNABogAiAAQQVqNgIAIAMgBGoiAkF8aiEMIAJBeWohDiACQXtqIRAgAEEGaiELQQQhBSAGQQR2IQRBICAAdCIAQQFyIQkgASgCACEPQQAhAiADIQYCQANAIAlBAkggAiAPS3JFBEAgAiEHAkAgCARAA0AgBEH//wNxQf//A0YEQCAHQRhqIQcgBiAQSQR/IAZBAmoiBigAACAFdgUgBUEQaiEFIARBEHYLIQQMAQsLA0AgBEEDcSIIQQNGBEAgBUECaiEFIARBAnYhBCAHQQNqIQcMAQsLIAcgCGoiByAPSw0EIAVBAmohBQNAIAIgB0kEQCANIAJBAXRqQQA7AQAgAkEBaiECDAELCyAGIA5LQQAgBiAFQQN1aiIHIAxLG0UEQCAHKAAAIAVBB3EiBXYhBAwCCyAEQQJ2IQQLIAYhBwsCfyALQX9qIAQgAEF/anEiBiAAQQF0QX9qIgggCWsiEUkNABogBCAIcSIEQQAgESAEIABIG2shBiALCyEIIA0gAkEBdGogBkF/aiIEOwEAIAlBASAGayAEIAZBAUgbayEJA0AgCSAASARAIABBAXUhACALQX9qIQsMAQsLAn8gByAOS0EAIAcgBSAIaiIFQQN1aiIGIAxLG0UEQCAFQQdxDAELIAUgDCIGIAdrQQN0awshBSACQQFqIQIgBEUhCCAGKAAAIAVBH3F2IQQMAQsLQWwgCUEBRyAFQSBKcg0BGiABIAJBf2o2AgAgBiAFQQdqQQN1aiADawwBC0FQCyEAIApBEGokACAACwkAQQFBBSAAGwsMACAAIAEoAAA2AAALqgMBCn8jAEHwAGsiCiQAIAJBAWohDiAAQQhqIQtBgIAEIAVBf2p0QRB1IQxBACECQQEhBkEBIAV0IglBf2oiDyEIA0AgAiAORkUEQAJAIAEgAkEBdCINai8BACIHQf//A0YEQCALIAhBA3RqIAI2AgQgCEF/aiEIQQEhBwwBCyAGQQAgDCAHQRB0QRB1ShshBgsgCiANaiAHOwEAIAJBAWohAgwBCwsgACAFNgIEIAAgBjYCACAJQQN2IAlBAXZqQQNqIQxBACEAQQAhBkEAIQIDQCAGIA5GBEADQAJAIAAgCUYNACAKIAsgAEEDdGoiASgCBCIGQQF0aiICIAIvAQAiAkEBajsBACABIAUgAhAUayIIOgADIAEgAiAIQf8BcXQgCWs7AQAgASAEIAZBAnQiAmooAgA6AAIgASACIANqKAIANgIEIABBAWohAAwBCwsFIAEgBkEBdGouAQAhDUEAIQcDQCAHIA1ORQRAIAsgAkEDdGogBjYCBANAIAIgDGogD3EiAiAISw0ACyAHQQFqIQcMAQsLIAZBAWohBgwBCwsgCkHwAGokAAsjAEIAIAEQCSAAhUKHla+vmLbem55/fkLj3MqV/M7y9YV/fAsQACAAQn43AwggACABNgIACyQBAX8gAARAIAEoAgQiAgRAIAEoAgggACACEQEADwsgABAmCwsfACAAIAEgAi8BABAINgIAIAEQBBogACACQQRqNgIEC0oBAX9BoCAoAgAiASAAaiIAQX9MBEBBiCBBMDYCAEF/DwsCQCAAPwBBEHRNDQAgABBmDQBBiCBBMDYCAEF/DwtBoCAgADYCACABC9cBAQh/Qbp/IQoCQCACKAIEIgggAigCACIJaiIOIAEgAGtLDQBBbCEKIAkgBCADKAIAIgtrSw0AIAAgCWoiBCACKAIIIgxrIQ0gACABQWBqIg8gCyAJQQAQKSADIAkgC2o2AgACQAJAIAwgBCAFa00EQCANIQUMAQsgDCAEIAZrSw0CIAcgDSAFayIAaiIBIAhqIAdNBEAgBCABIAgQDxoMAgsgBCABQQAgAGsQDyEBIAIgACAIaiIINgIEIAEgAGshBAsgBCAPIAUgCEEBECkLIA4hCgsgCgubAgEBfyMAQYABayINJAAgDSADNgJ8AkAgAkEDSwRAQX8hCQwBCwJAAkACQAJAIAJBAWsOAwADAgELIAZFBEBBuH8hCQwEC0FsIQkgBS0AACICIANLDQMgACAHIAJBAnQiAmooAgAgAiAIaigCABA7IAEgADYCAEEBIQkMAwsgASAJNgIAQQAhCQwCCyAKRQRAQWwhCQwCC0EAIQkgC0UgDEEZSHINAUEIIAR0QQhqIQBBACECA0AgAiAATw0CIAJBQGshAgwAAAsAC0FsIQkgDSANQfwAaiANQfgAaiAFIAYQFSICEAMNACANKAJ4IgMgBEsNACAAIA0gDSgCfCAHIAggAxAYIAEgADYCACACIQkLIA1BgAFqJAAgCQsLACAAIAEgAhALGgsQACAALwAAIAAtAAJBEHRyCy8AAn9BuH8gAUEISQ0AGkFyIAAoAAQiAEF3Sw0AGkG4fyAAQQhqIgAgACABSxsLCwkAIAAgATsAAAsDAAELigYBBX8gACAAKAIAIgVBfnE2AgBBACAAIAVBAXZqQYQgKAIAIgQgAEYbIQECQAJAIAAoAgQiAkUNACACKAIAIgNBAXENACACQQhqIgUgA0EBdkF4aiIDQQggA0EISxtnQR9zQQJ0QYAfaiIDKAIARgRAIAMgAigCDDYCAAsgAigCCCIDBEAgAyACKAIMNgIECyACKAIMIgMEQCADIAIoAgg2AgALIAIgAigCACAAKAIAQX5xajYCAEGEICEAAkACQCABRQ0AIAEgAjYCBCABKAIAIgNBAXENASADQQF2QXhqIgNBCCADQQhLG2dBH3NBAnRBgB9qIgMoAgAgAUEIakYEQCADIAEoAgw2AgALIAEoAggiAwRAIAMgASgCDDYCBAsgASgCDCIDBEAgAyABKAIINgIAQYQgKAIAIQQLIAIgAigCACABKAIAQX5xajYCACABIARGDQAgASABKAIAQQF2akEEaiEACyAAIAI2AgALIAIoAgBBAXZBeGoiAEEIIABBCEsbZ0Efc0ECdEGAH2oiASgCACEAIAEgBTYCACACIAA2AgwgAkEANgIIIABFDQEgACAFNgIADwsCQCABRQ0AIAEoAgAiAkEBcQ0AIAJBAXZBeGoiAkEIIAJBCEsbZ0Efc0ECdEGAH2oiAigCACABQQhqRgRAIAIgASgCDDYCAAsgASgCCCICBEAgAiABKAIMNgIECyABKAIMIgIEQCACIAEoAgg2AgBBhCAoAgAhBAsgACAAKAIAIAEoAgBBfnFqIgI2AgACQCABIARHBEAgASABKAIAQQF2aiAANgIEIAAoAgAhAgwBC0GEICAANgIACyACQQF2QXhqIgFBCCABQQhLG2dBH3NBAnRBgB9qIgIoAgAhASACIABBCGoiAjYCACAAIAE2AgwgAEEANgIIIAFFDQEgASACNgIADwsgBUEBdkF4aiIBQQggAUEISxtnQR9zQQJ0QYAfaiICKAIAIQEgAiAAQQhqIgI2AgAgACABNgIMIABBADYCCCABRQ0AIAEgAjYCAAsLDgAgAARAIABBeGoQJQsLgAIBA38CQCAAQQ9qQXhxQYQgKAIAKAIAQQF2ayICEB1Bf0YNAAJAQYQgKAIAIgAoAgAiAUEBcQ0AIAFBAXZBeGoiAUEIIAFBCEsbZ0Efc0ECdEGAH2oiASgCACAAQQhqRgRAIAEgACgCDDYCAAsgACgCCCIBBEAgASAAKAIMNgIECyAAKAIMIgFFDQAgASAAKAIINgIAC0EBIQEgACAAKAIAIAJBAXRqIgI2AgAgAkEBcQ0AIAJBAXZBeGoiAkEIIAJBCEsbZ0Efc0ECdEGAH2oiAygCACECIAMgAEEIaiIDNgIAIAAgAjYCDCAAQQA2AgggAkUNACACIAM2AgALIAELtwIBA38CQAJAIABBASAAGyICEDgiAA0AAkACQEGEICgCACIARQ0AIAAoAgAiA0EBcQ0AIAAgA0EBcjYCACADQQF2QXhqIgFBCCABQQhLG2dBH3NBAnRBgB9qIgEoAgAgAEEIakYEQCABIAAoAgw2AgALIAAoAggiAQRAIAEgACgCDDYCBAsgACgCDCIBBEAgASAAKAIINgIACyACECchAkEAIQFBhCAoAgAhACACDQEgACAAKAIAQX5xNgIAQQAPCyACQQ9qQXhxIgMQHSICQX9GDQIgAkEHakF4cSIAIAJHBEAgACACaxAdQX9GDQMLAkBBhCAoAgAiAUUEQEGAICAANgIADAELIAAgATYCBAtBhCAgADYCACAAIANBAXRBAXI2AgAMAQsgAEUNAQsgAEEIaiEBCyABC7kDAQJ/IAAgA2ohBQJAIANBB0wEQANAIAAgBU8NAiAAIAItAAA6AAAgAEEBaiEAIAJBAWohAgwAAAsACyAEQQFGBEACQCAAIAJrIgZBB00EQCAAIAItAAA6AAAgACACLQABOgABIAAgAi0AAjoAAiAAIAItAAM6AAMgAEEEaiACIAZBAnQiBkHAHmooAgBqIgIQFyACIAZB4B5qKAIAayECDAELIAAgAhAMCyACQQhqIQIgAEEIaiEACwJAAkACQAJAIAUgAU0EQCAAIANqIQEgBEEBRyAAIAJrQQ9Kcg0BA0AgACACEAwgAkEIaiECIABBCGoiACABSQ0ACwwFCyAAIAFLBEAgACEBDAQLIARBAUcgACACa0EPSnINASAAIQMgAiEEA0AgAyAEEAwgBEEIaiEEIANBCGoiAyABSQ0ACwwCCwNAIAAgAhAHIAJBEGohAiAAQRBqIgAgAUkNAAsMAwsgACEDIAIhBANAIAMgBBAHIARBEGohBCADQRBqIgMgAUkNAAsLIAIgASAAa2ohAgsDQCABIAVPDQEgASACLQAAOgAAIAFBAWohASACQQFqIQIMAAALAAsLQQECfyAAIAAoArjgASIDNgLE4AEgACgCvOABIQQgACABNgK84AEgACABIAJqNgK44AEgACABIAQgA2tqNgLA4AELpgEBAX8gACAAKALs4QEQFjYCyOABIABCADcD+OABIABCADcDuOABIABBwOABakIANwMAIABBqNAAaiIBQYyAgOAANgIAIABBADYCmOIBIABCADcDiOEBIABCAzcDgOEBIABBrNABakHgEikCADcCACAAQbTQAWpB6BIoAgA2AgAgACABNgIMIAAgAEGYIGo2AgggACAAQaAwajYCBCAAIABBEGo2AgALYQEBf0G4fyEDAkAgAUEDSQ0AIAIgABAhIgFBA3YiADYCCCACIAFBAXE2AgQgAiABQQF2QQNxIgM2AgACQCADQX9qIgFBAksNAAJAIAFBAWsOAgEAAgtBbA8LIAAhAwsgAwsMACAAIAEgAkEAEC4LiAQCA38CfiADEBYhBCAAQQBBKBAQIQAgBCACSwRAIAQPCyABRQRAQX8PCwJAAkAgA0EBRg0AIAEoAAAiBkGo6r5pRg0AQXYhAyAGQXBxQdDUtMIBRw0BQQghAyACQQhJDQEgAEEAQSgQECEAIAEoAAQhASAAQQE2AhQgACABrTcDAEEADwsgASACIAMQLyIDIAJLDQAgACADNgIYQXIhAyABIARqIgVBf2otAAAiAkEIcQ0AIAJBIHEiBkUEQEFwIQMgBS0AACIFQacBSw0BIAVBB3GtQgEgBUEDdkEKaq2GIgdCA4h+IAd8IQggBEEBaiEECyACQQZ2IQMgAkECdiEFAkAgAkEDcUF/aiICQQJLBEBBACECDAELAkACQAJAIAJBAWsOAgECAAsgASAEai0AACECIARBAWohBAwCCyABIARqLwAAIQIgBEECaiEEDAELIAEgBGooAAAhAiAEQQRqIQQLIAVBAXEhBQJ+AkACQAJAIANBf2oiA0ECTQRAIANBAWsOAgIDAQtCfyAGRQ0DGiABIARqMQAADAMLIAEgBGovAACtQoACfAwCCyABIARqKAAArQwBCyABIARqKQAACyEHIAAgBTYCICAAIAI2AhwgACAHNwMAQQAhAyAAQQA2AhQgACAHIAggBhsiBzcDCCAAIAdCgIAIIAdCgIAIVBs+AhALIAMLWwEBf0G4fyEDIAIQFiICIAFNBH8gACACakF/ai0AACIAQQNxQQJ0QaAeaigCACACaiAAQQZ2IgFBAnRBsB5qKAIAaiAAQSBxIgBFaiABRSAAQQV2cWoFQbh/CwsdACAAKAKQ4gEQWiAAQQA2AqDiASAAQgA3A5DiAQu1AwEFfyMAQZACayIKJABBuH8hBgJAIAVFDQAgBCwAACIIQf8BcSEHAkAgCEF/TARAIAdBgn9qQQF2IgggBU8NAkFsIQYgB0GBf2oiBUGAAk8NAiAEQQFqIQdBACEGA0AgBiAFTwRAIAUhBiAIIQcMAwUgACAGaiAHIAZBAXZqIgQtAABBBHY6AAAgACAGQQFyaiAELQAAQQ9xOgAAIAZBAmohBgwBCwAACwALIAcgBU8NASAAIARBAWogByAKEFMiBhADDQELIAYhBEEAIQYgAUEAQTQQECEJQQAhBQNAIAQgBkcEQCAAIAZqIggtAAAiAUELSwRAQWwhBgwDBSAJIAFBAnRqIgEgASgCAEEBajYCACAGQQFqIQZBASAILQAAdEEBdSAFaiEFDAILAAsLQWwhBiAFRQ0AIAUQFEEBaiIBQQxLDQAgAyABNgIAQQFBASABdCAFayIDEBQiAXQgA0cNACAAIARqIAFBAWoiADoAACAJIABBAnRqIgAgACgCAEEBajYCACAJKAIEIgBBAkkgAEEBcXINACACIARBAWo2AgAgB0EBaiEGCyAKQZACaiQAIAYLxhEBDH8jAEHwAGsiBSQAQWwhCwJAIANBCkkNACACLwAAIQogAi8AAiEJIAIvAAQhByAFQQhqIAQQDgJAIAMgByAJIApqakEGaiIMSQ0AIAUtAAohCCAFQdgAaiACQQZqIgIgChAGIgsQAw0BIAVBQGsgAiAKaiICIAkQBiILEAMNASAFQShqIAIgCWoiAiAHEAYiCxADDQEgBUEQaiACIAdqIAMgDGsQBiILEAMNASAAIAFqIg9BfWohECAEQQRqIQZBASELIAAgAUEDakECdiIDaiIMIANqIgIgA2oiDiEDIAIhBCAMIQcDQCALIAMgEElxBEAgACAGIAVB2ABqIAgQAkECdGoiCS8BADsAACAFQdgAaiAJLQACEAEgCS0AAyELIAcgBiAFQUBrIAgQAkECdGoiCS8BADsAACAFQUBrIAktAAIQASAJLQADIQogBCAGIAVBKGogCBACQQJ0aiIJLwEAOwAAIAVBKGogCS0AAhABIAktAAMhCSADIAYgBUEQaiAIEAJBAnRqIg0vAQA7AAAgBUEQaiANLQACEAEgDS0AAyENIAAgC2oiCyAGIAVB2ABqIAgQAkECdGoiAC8BADsAACAFQdgAaiAALQACEAEgAC0AAyEAIAcgCmoiCiAGIAVBQGsgCBACQQJ0aiIHLwEAOwAAIAVBQGsgBy0AAhABIActAAMhByAEIAlqIgkgBiAFQShqIAgQAkECdGoiBC8BADsAACAFQShqIAQtAAIQASAELQADIQQgAyANaiIDIAYgBUEQaiAIEAJBAnRqIg0vAQA7AAAgBUEQaiANLQACEAEgACALaiEAIAcgCmohByAEIAlqIQQgAyANLQADaiEDIAVB2ABqEA0gBUFAaxANciAFQShqEA1yIAVBEGoQDXJFIQsMAQsLIAQgDksgByACS3INAEFsIQsgACAMSw0BIAxBfWohCQNAQQAgACAJSSAFQdgAahAEGwRAIAAgBiAFQdgAaiAIEAJBAnRqIgovAQA7AAAgBUHYAGogCi0AAhABIAAgCi0AA2oiACAGIAVB2ABqIAgQAkECdGoiCi8BADsAACAFQdgAaiAKLQACEAEgACAKLQADaiEADAEFIAxBfmohCgNAIAVB2ABqEAQgACAKS3JFBEAgACAGIAVB2ABqIAgQAkECdGoiCS8BADsAACAFQdgAaiAJLQACEAEgACAJLQADaiEADAELCwNAIAAgCk0EQCAAIAYgBUHYAGogCBACQQJ0aiIJLwEAOwAAIAVB2ABqIAktAAIQASAAIAktAANqIQAMAQsLAkAgACAMTw0AIAAgBiAFQdgAaiAIEAIiAEECdGoiDC0AADoAACAMLQADQQFGBEAgBUHYAGogDC0AAhABDAELIAUoAlxBH0sNACAFQdgAaiAGIABBAnRqLQACEAEgBSgCXEEhSQ0AIAVBIDYCXAsgAkF9aiEMA0BBACAHIAxJIAVBQGsQBBsEQCAHIAYgBUFAayAIEAJBAnRqIgAvAQA7AAAgBUFAayAALQACEAEgByAALQADaiIAIAYgBUFAayAIEAJBAnRqIgcvAQA7AAAgBUFAayAHLQACEAEgACAHLQADaiEHDAEFIAJBfmohDANAIAVBQGsQBCAHIAxLckUEQCAHIAYgBUFAayAIEAJBAnRqIgAvAQA7AAAgBUFAayAALQACEAEgByAALQADaiEHDAELCwNAIAcgDE0EQCAHIAYgBUFAayAIEAJBAnRqIgAvAQA7AAAgBUFAayAALQACEAEgByAALQADaiEHDAELCwJAIAcgAk8NACAHIAYgBUFAayAIEAIiAEECdGoiAi0AADoAACACLQADQQFGBEAgBUFAayACLQACEAEMAQsgBSgCREEfSw0AIAVBQGsgBiAAQQJ0ai0AAhABIAUoAkRBIUkNACAFQSA2AkQLIA5BfWohAgNAQQAgBCACSSAFQShqEAQbBEAgBCAGIAVBKGogCBACQQJ0aiIALwEAOwAAIAVBKGogAC0AAhABIAQgAC0AA2oiACAGIAVBKGogCBACQQJ0aiIELwEAOwAAIAVBKGogBC0AAhABIAAgBC0AA2ohBAwBBSAOQX5qIQIDQCAFQShqEAQgBCACS3JFBEAgBCAGIAVBKGogCBACQQJ0aiIALwEAOwAAIAVBKGogAC0AAhABIAQgAC0AA2ohBAwBCwsDQCAEIAJNBEAgBCAGIAVBKGogCBACQQJ0aiIALwEAOwAAIAVBKGogAC0AAhABIAQgAC0AA2ohBAwBCwsCQCAEIA5PDQAgBCAGIAVBKGogCBACIgBBAnRqIgItAAA6AAAgAi0AA0EBRgRAIAVBKGogAi0AAhABDAELIAUoAixBH0sNACAFQShqIAYgAEECdGotAAIQASAFKAIsQSFJDQAgBUEgNgIsCwNAQQAgAyAQSSAFQRBqEAQbBEAgAyAGIAVBEGogCBACQQJ0aiIALwEAOwAAIAVBEGogAC0AAhABIAMgAC0AA2oiACAGIAVBEGogCBACQQJ0aiICLwEAOwAAIAVBEGogAi0AAhABIAAgAi0AA2ohAwwBBSAPQX5qIQIDQCAFQRBqEAQgAyACS3JFBEAgAyAGIAVBEGogCBACQQJ0aiIALwEAOwAAIAVBEGogAC0AAhABIAMgAC0AA2ohAwwBCwsDQCADIAJNBEAgAyAGIAVBEGogCBACQQJ0aiIALwEAOwAAIAVBEGogAC0AAhABIAMgAC0AA2ohAwwBCwsCQCADIA9PDQAgAyAGIAVBEGogCBACIgBBAnRqIgItAAA6AAAgAi0AA0EBRgRAIAVBEGogAi0AAhABDAELIAUoAhRBH0sNACAFQRBqIAYgAEECdGotAAIQASAFKAIUQSFJDQAgBUEgNgIUCyABQWwgBUHYAGoQCiAFQUBrEApxIAVBKGoQCnEgBUEQahAKcRshCwwJCwAACwALAAALAAsAAAsACwAACwALQWwhCwsgBUHwAGokACALC7UEAQ5/IwBBEGsiBiQAIAZBBGogABAOQVQhBQJAIARB3AtJDQAgBi0ABCEHIANB8ARqQQBB7AAQECEIIAdBDEsNACADQdwJaiIJIAggBkEIaiAGQQxqIAEgAhAxIhAQA0UEQCAGKAIMIgQgB0sNASADQdwFaiEPIANBpAVqIREgAEEEaiESIANBqAVqIQEgBCEFA0AgBSICQX9qIQUgCCACQQJ0aigCAEUNAAsgAkEBaiEOQQEhBQNAIAUgDk9FBEAgCCAFQQJ0IgtqKAIAIQwgASALaiAKNgIAIAVBAWohBSAKIAxqIQoMAQsLIAEgCjYCAEEAIQUgBigCCCELA0AgBSALRkUEQCABIAUgCWotAAAiDEECdGoiDSANKAIAIg1BAWo2AgAgDyANQQF0aiINIAw6AAEgDSAFOgAAIAVBAWohBQwBCwtBACEBIANBADYCqAUgBEF/cyAHaiEJQQEhBQNAIAUgDk9FBEAgCCAFQQJ0IgtqKAIAIQwgAyALaiABNgIAIAwgBSAJanQgAWohASAFQQFqIQUMAQsLIAcgBEEBaiIBIAJrIgRrQQFqIQgDQEEBIQUgBCAIT0UEQANAIAUgDk9FBEAgBUECdCIJIAMgBEE0bGpqIAMgCWooAgAgBHY2AgAgBUEBaiEFDAELCyAEQQFqIQQMAQsLIBIgByAPIAogESADIAIgARBkIAZBAToABSAGIAc6AAYgACAGKAIENgIACyAQIQULIAZBEGokACAFC8ENAQt/IwBB8ABrIgUkAEFsIQkCQCADQQpJDQAgAi8AACEKIAIvAAIhDCACLwAEIQYgBUEIaiAEEA4CQCADIAYgCiAMampBBmoiDUkNACAFLQAKIQcgBUHYAGogAkEGaiICIAoQBiIJEAMNASAFQUBrIAIgCmoiAiAMEAYiCRADDQEgBUEoaiACIAxqIgIgBhAGIgkQAw0BIAVBEGogAiAGaiADIA1rEAYiCRADDQEgACABaiIOQX1qIQ8gBEEEaiEGQQEhCSAAIAFBA2pBAnYiAmoiCiACaiIMIAJqIg0hAyAMIQQgCiECA0AgCSADIA9JcQRAIAYgBUHYAGogBxACQQF0aiIILQAAIQsgBUHYAGogCC0AARABIAAgCzoAACAGIAVBQGsgBxACQQF0aiIILQAAIQsgBUFAayAILQABEAEgAiALOgAAIAYgBUEoaiAHEAJBAXRqIggtAAAhCyAFQShqIAgtAAEQASAEIAs6AAAgBiAFQRBqIAcQAkEBdGoiCC0AACELIAVBEGogCC0AARABIAMgCzoAACAGIAVB2ABqIAcQAkEBdGoiCC0AACELIAVB2ABqIAgtAAEQASAAIAs6AAEgBiAFQUBrIAcQAkEBdGoiCC0AACELIAVBQGsgCC0AARABIAIgCzoAASAGIAVBKGogBxACQQF0aiIILQAAIQsgBUEoaiAILQABEAEgBCALOgABIAYgBUEQaiAHEAJBAXRqIggtAAAhCyAFQRBqIAgtAAEQASADIAs6AAEgA0ECaiEDIARBAmohBCACQQJqIQIgAEECaiEAIAkgBUHYAGoQDUVxIAVBQGsQDUVxIAVBKGoQDUVxIAVBEGoQDUVxIQkMAQsLIAQgDUsgAiAMS3INAEFsIQkgACAKSw0BIApBfWohCQNAIAVB2ABqEAQgACAJT3JFBEAgBiAFQdgAaiAHEAJBAXRqIggtAAAhCyAFQdgAaiAILQABEAEgACALOgAAIAYgBUHYAGogBxACQQF0aiIILQAAIQsgBUHYAGogCC0AARABIAAgCzoAASAAQQJqIQAMAQsLA0AgBUHYAGoQBCAAIApPckUEQCAGIAVB2ABqIAcQAkEBdGoiCS0AACEIIAVB2ABqIAktAAEQASAAIAg6AAAgAEEBaiEADAELCwNAIAAgCkkEQCAGIAVB2ABqIAcQAkEBdGoiCS0AACEIIAVB2ABqIAktAAEQASAAIAg6AAAgAEEBaiEADAELCyAMQX1qIQADQCAFQUBrEAQgAiAAT3JFBEAgBiAFQUBrIAcQAkEBdGoiCi0AACEJIAVBQGsgCi0AARABIAIgCToAACAGIAVBQGsgBxACQQF0aiIKLQAAIQkgBUFAayAKLQABEAEgAiAJOgABIAJBAmohAgwBCwsDQCAFQUBrEAQgAiAMT3JFBEAgBiAFQUBrIAcQAkEBdGoiAC0AACEKIAVBQGsgAC0AARABIAIgCjoAACACQQFqIQIMAQsLA0AgAiAMSQRAIAYgBUFAayAHEAJBAXRqIgAtAAAhCiAFQUBrIAAtAAEQASACIAo6AAAgAkEBaiECDAELCyANQX1qIQADQCAFQShqEAQgBCAAT3JFBEAgBiAFQShqIAcQAkEBdGoiAi0AACEKIAVBKGogAi0AARABIAQgCjoAACAGIAVBKGogBxACQQF0aiICLQAAIQogBUEoaiACLQABEAEgBCAKOgABIARBAmohBAwBCwsDQCAFQShqEAQgBCANT3JFBEAgBiAFQShqIAcQAkEBdGoiAC0AACECIAVBKGogAC0AARABIAQgAjoAACAEQQFqIQQMAQsLA0AgBCANSQRAIAYgBUEoaiAHEAJBAXRqIgAtAAAhAiAFQShqIAAtAAEQASAEIAI6AAAgBEEBaiEEDAELCwNAIAVBEGoQBCADIA9PckUEQCAGIAVBEGogBxACQQF0aiIALQAAIQIgBUEQaiAALQABEAEgAyACOgAAIAYgBUEQaiAHEAJBAXRqIgAtAAAhAiAFQRBqIAAtAAEQASADIAI6AAEgA0ECaiEDDAELCwNAIAVBEGoQBCADIA5PckUEQCAGIAVBEGogBxACQQF0aiIALQAAIQIgBUEQaiAALQABEAEgAyACOgAAIANBAWohAwwBCwsDQCADIA5JBEAgBiAFQRBqIAcQAkEBdGoiAC0AACECIAVBEGogAC0AARABIAMgAjoAACADQQFqIQMMAQsLIAFBbCAFQdgAahAKIAVBQGsQCnEgBUEoahAKcSAFQRBqEApxGyEJDAELQWwhCQsgBUHwAGokACAJC8oCAQR/IwBBIGsiBSQAIAUgBBAOIAUtAAIhByAFQQhqIAIgAxAGIgIQA0UEQCAEQQRqIQIgACABaiIDQX1qIQQDQCAFQQhqEAQgACAET3JFBEAgAiAFQQhqIAcQAkEBdGoiBi0AACEIIAVBCGogBi0AARABIAAgCDoAACACIAVBCGogBxACQQF0aiIGLQAAIQggBUEIaiAGLQABEAEgACAIOgABIABBAmohAAwBCwsDQCAFQQhqEAQgACADT3JFBEAgAiAFQQhqIAcQAkEBdGoiBC0AACEGIAVBCGogBC0AARABIAAgBjoAACAAQQFqIQAMAQsLA0AgACADT0UEQCACIAVBCGogBxACQQF0aiIELQAAIQYgBUEIaiAELQABEAEgACAGOgAAIABBAWohAAwBCwsgAUFsIAVBCGoQChshAgsgBUEgaiQAIAILtgMBCX8jAEEQayIGJAAgBkEANgIMIAZBADYCCEFUIQQCQAJAIANBQGsiDCADIAZBCGogBkEMaiABIAIQMSICEAMNACAGQQRqIAAQDiAGKAIMIgcgBi0ABEEBaksNASAAQQRqIQogBkEAOgAFIAYgBzoABiAAIAYoAgQ2AgAgB0EBaiEJQQEhBANAIAQgCUkEQCADIARBAnRqIgEoAgAhACABIAU2AgAgACAEQX9qdCAFaiEFIARBAWohBAwBCwsgB0EBaiEHQQAhBSAGKAIIIQkDQCAFIAlGDQEgAyAFIAxqLQAAIgRBAnRqIgBBASAEdEEBdSILIAAoAgAiAWoiADYCACAHIARrIQhBACEEAkAgC0EDTQRAA0AgBCALRg0CIAogASAEakEBdGoiACAIOgABIAAgBToAACAEQQFqIQQMAAALAAsDQCABIABPDQEgCiABQQF0aiIEIAg6AAEgBCAFOgAAIAQgCDoAAyAEIAU6AAIgBCAIOgAFIAQgBToABCAEIAg6AAcgBCAFOgAGIAFBBGohAQwAAAsACyAFQQFqIQUMAAALAAsgAiEECyAGQRBqJAAgBAutAQECfwJAQYQgKAIAIABHIAAoAgBBAXYiAyABa0F4aiICQXhxQQhHcgR/IAIFIAMQJ0UNASACQQhqC0EQSQ0AIAAgACgCACICQQFxIAAgAWpBD2pBeHEiASAAa0EBdHI2AgAgASAANgIEIAEgASgCAEEBcSAAIAJBAXZqIAFrIgJBAXRyNgIAQYQgIAEgAkH/////B3FqQQRqQYQgKAIAIABGGyABNgIAIAEQJQsLygIBBX8CQAJAAkAgAEEIIABBCEsbZ0EfcyAAaUEBR2oiAUEESSAAIAF2cg0AIAFBAnRB/B5qKAIAIgJFDQADQCACQXhqIgMoAgBBAXZBeGoiBSAATwRAIAIgBUEIIAVBCEsbZ0Efc0ECdEGAH2oiASgCAEYEQCABIAIoAgQ2AgALDAMLIARBHksNASAEQQFqIQQgAigCBCICDQALC0EAIQMgAUEgTw0BA0AgAUECdEGAH2ooAgAiAkUEQCABQR5LIQIgAUEBaiEBIAJFDQEMAwsLIAIgAkF4aiIDKAIAQQF2QXhqIgFBCCABQQhLG2dBH3NBAnRBgB9qIgEoAgBGBEAgASACKAIENgIACwsgAigCACIBBEAgASACKAIENgIECyACKAIEIgEEQCABIAIoAgA2AgALIAMgAygCAEEBcjYCACADIAAQNwsgAwvhCwINfwV+IwBB8ABrIgckACAHIAAoAvDhASIINgJcIAEgAmohDSAIIAAoAoDiAWohDwJAAkAgBUUEQCABIQQMAQsgACgCxOABIRAgACgCwOABIREgACgCvOABIQ4gAEEBNgKM4QFBACEIA0AgCEEDRwRAIAcgCEECdCICaiAAIAJqQazQAWooAgA2AkQgCEEBaiEIDAELC0FsIQwgB0EYaiADIAQQBhADDQEgB0EsaiAHQRhqIAAoAgAQEyAHQTRqIAdBGGogACgCCBATIAdBPGogB0EYaiAAKAIEEBMgDUFgaiESIAEhBEEAIQwDQCAHKAIwIAcoAixBA3RqKQIAIhRCEIinQf8BcSEIIAcoAkAgBygCPEEDdGopAgAiFUIQiKdB/wFxIQsgBygCOCAHKAI0QQN0aikCACIWQiCIpyEJIBVCIIghFyAUQiCIpyECAkAgFkIQiKdB/wFxIgNBAk8EQAJAIAZFIANBGUlyRQRAIAkgB0EYaiADQSAgBygCHGsiCiAKIANLGyIKEAUgAyAKayIDdGohCSAHQRhqEAQaIANFDQEgB0EYaiADEAUgCWohCQwBCyAHQRhqIAMQBSAJaiEJIAdBGGoQBBoLIAcpAkQhGCAHIAk2AkQgByAYNwNIDAELAkAgA0UEQCACBEAgBygCRCEJDAMLIAcoAkghCQwBCwJAAkAgB0EYakEBEAUgCSACRWpqIgNBA0YEQCAHKAJEQX9qIgMgA0VqIQkMAQsgA0ECdCAHaigCRCIJIAlFaiEJIANBAUYNAQsgByAHKAJINgJMCwsgByAHKAJENgJIIAcgCTYCRAsgF6chAyALBEAgB0EYaiALEAUgA2ohAwsgCCALakEUTwRAIAdBGGoQBBoLIAgEQCAHQRhqIAgQBSACaiECCyAHQRhqEAQaIAcgB0EYaiAUQhiIp0H/AXEQCCAUp0H//wNxajYCLCAHIAdBGGogFUIYiKdB/wFxEAggFadB//8DcWo2AjwgB0EYahAEGiAHIAdBGGogFkIYiKdB/wFxEAggFqdB//8DcWo2AjQgByACNgJgIAcoAlwhCiAHIAk2AmggByADNgJkAkACQAJAIAQgAiADaiILaiASSw0AIAIgCmoiEyAPSw0AIA0gBGsgC0Egak8NAQsgByAHKQNoNwMQIAcgBykDYDcDCCAEIA0gB0EIaiAHQdwAaiAPIA4gESAQEB4hCwwBCyACIARqIQggBCAKEAcgAkERTwRAIARBEGohAgNAIAIgCkEQaiIKEAcgAkEQaiICIAhJDQALCyAIIAlrIQIgByATNgJcIAkgCCAOa0sEQCAJIAggEWtLBEBBbCELDAILIBAgAiAOayICaiIKIANqIBBNBEAgCCAKIAMQDxoMAgsgCCAKQQAgAmsQDyEIIAcgAiADaiIDNgJkIAggAmshCCAOIQILIAlBEE8EQCADIAhqIQMDQCAIIAIQByACQRBqIQIgCEEQaiIIIANJDQALDAELAkAgCUEHTQRAIAggAi0AADoAACAIIAItAAE6AAEgCCACLQACOgACIAggAi0AAzoAAyAIQQRqIAIgCUECdCIDQcAeaigCAGoiAhAXIAIgA0HgHmooAgBrIQIgBygCZCEDDAELIAggAhAMCyADQQlJDQAgAyAIaiEDIAhBCGoiCCACQQhqIgJrQQ9MBEADQCAIIAIQDCACQQhqIQIgCEEIaiIIIANJDQAMAgALAAsDQCAIIAIQByACQRBqIQIgCEEQaiIIIANJDQALCyAHQRhqEAQaIAsgDCALEAMiAhshDCAEIAQgC2ogAhshBCAFQX9qIgUNAAsgDBADDQFBbCEMIAdBGGoQBEECSQ0BQQAhCANAIAhBA0cEQCAAIAhBAnQiAmpBrNABaiACIAdqKAJENgIAIAhBAWohCAwBCwsgBygCXCEIC0G6fyEMIA8gCGsiACANIARrSw0AIAQEfyAEIAggABALIABqBUEACyABayEMCyAHQfAAaiQAIAwLkRcCFn8FfiMAQdABayIHJAAgByAAKALw4QEiCDYCvAEgASACaiESIAggACgCgOIBaiETAkACQCAFRQRAIAEhAwwBCyAAKALE4AEhESAAKALA4AEhFSAAKAK84AEhDyAAQQE2AozhAUEAIQgDQCAIQQNHBEAgByAIQQJ0IgJqIAAgAmpBrNABaigCADYCVCAIQQFqIQgMAQsLIAcgETYCZCAHIA82AmAgByABIA9rNgJoQWwhECAHQShqIAMgBBAGEAMNASAFQQQgBUEESBshFyAHQTxqIAdBKGogACgCABATIAdBxABqIAdBKGogACgCCBATIAdBzABqIAdBKGogACgCBBATQQAhBCAHQeAAaiEMIAdB5ABqIQoDQCAHQShqEARBAksgBCAXTnJFBEAgBygCQCAHKAI8QQN0aikCACIdQhCIp0H/AXEhCyAHKAJQIAcoAkxBA3RqKQIAIh5CEIinQf8BcSEJIAcoAkggBygCREEDdGopAgAiH0IgiKchCCAeQiCIISAgHUIgiKchAgJAIB9CEIinQf8BcSIDQQJPBEACQCAGRSADQRlJckUEQCAIIAdBKGogA0EgIAcoAixrIg0gDSADSxsiDRAFIAMgDWsiA3RqIQggB0EoahAEGiADRQ0BIAdBKGogAxAFIAhqIQgMAQsgB0EoaiADEAUgCGohCCAHQShqEAQaCyAHKQJUISEgByAINgJUIAcgITcDWAwBCwJAIANFBEAgAgRAIAcoAlQhCAwDCyAHKAJYIQgMAQsCQAJAIAdBKGpBARAFIAggAkVqaiIDQQNGBEAgBygCVEF/aiIDIANFaiEIDAELIANBAnQgB2ooAlQiCCAIRWohCCADQQFGDQELIAcgBygCWDYCXAsLIAcgBygCVDYCWCAHIAg2AlQLICCnIQMgCQRAIAdBKGogCRAFIANqIQMLIAkgC2pBFE8EQCAHQShqEAQaCyALBEAgB0EoaiALEAUgAmohAgsgB0EoahAEGiAHIAcoAmggAmoiCSADajYCaCAKIAwgCCAJSxsoAgAhDSAHIAdBKGogHUIYiKdB/wFxEAggHadB//8DcWo2AjwgByAHQShqIB5CGIinQf8BcRAIIB6nQf//A3FqNgJMIAdBKGoQBBogB0EoaiAfQhiIp0H/AXEQCCEOIAdB8ABqIARBBHRqIgsgCSANaiAIazYCDCALIAg2AgggCyADNgIEIAsgAjYCACAHIA4gH6dB//8DcWo2AkQgBEEBaiEEDAELCyAEIBdIDQEgEkFgaiEYIAdB4ABqIRogB0HkAGohGyABIQMDQCAHQShqEARBAksgBCAFTnJFBEAgBygCQCAHKAI8QQN0aikCACIdQhCIp0H/AXEhCyAHKAJQIAcoAkxBA3RqKQIAIh5CEIinQf8BcSEIIAcoAkggBygCREEDdGopAgAiH0IgiKchCSAeQiCIISAgHUIgiKchDAJAIB9CEIinQf8BcSICQQJPBEACQCAGRSACQRlJckUEQCAJIAdBKGogAkEgIAcoAixrIgogCiACSxsiChAFIAIgCmsiAnRqIQkgB0EoahAEGiACRQ0BIAdBKGogAhAFIAlqIQkMAQsgB0EoaiACEAUgCWohCSAHQShqEAQaCyAHKQJUISEgByAJNgJUIAcgITcDWAwBCwJAIAJFBEAgDARAIAcoAlQhCQwDCyAHKAJYIQkMAQsCQAJAIAdBKGpBARAFIAkgDEVqaiICQQNGBEAgBygCVEF/aiICIAJFaiEJDAELIAJBAnQgB2ooAlQiCSAJRWohCSACQQFGDQELIAcgBygCWDYCXAsLIAcgBygCVDYCWCAHIAk2AlQLICCnIRQgCARAIAdBKGogCBAFIBRqIRQLIAggC2pBFE8EQCAHQShqEAQaCyALBEAgB0EoaiALEAUgDGohDAsgB0EoahAEGiAHIAcoAmggDGoiGSAUajYCaCAbIBogCSAZSxsoAgAhHCAHIAdBKGogHUIYiKdB/wFxEAggHadB//8DcWo2AjwgByAHQShqIB5CGIinQf8BcRAIIB6nQf//A3FqNgJMIAdBKGoQBBogByAHQShqIB9CGIinQf8BcRAIIB+nQf//A3FqNgJEIAcgB0HwAGogBEEDcUEEdGoiDSkDCCIdNwPIASAHIA0pAwAiHjcDwAECQAJAAkAgBygCvAEiDiAepyICaiIWIBNLDQAgAyAHKALEASIKIAJqIgtqIBhLDQAgEiADayALQSBqTw0BCyAHIAcpA8gBNwMQIAcgBykDwAE3AwggAyASIAdBCGogB0G8AWogEyAPIBUgERAeIQsMAQsgAiADaiEIIAMgDhAHIAJBEU8EQCADQRBqIQIDQCACIA5BEGoiDhAHIAJBEGoiAiAISQ0ACwsgCCAdpyIOayECIAcgFjYCvAEgDiAIIA9rSwRAIA4gCCAVa0sEQEFsIQsMAgsgESACIA9rIgJqIhYgCmogEU0EQCAIIBYgChAPGgwCCyAIIBZBACACaxAPIQggByACIApqIgo2AsQBIAggAmshCCAPIQILIA5BEE8EQCAIIApqIQoDQCAIIAIQByACQRBqIQIgCEEQaiIIIApJDQALDAELAkAgDkEHTQRAIAggAi0AADoAACAIIAItAAE6AAEgCCACLQACOgACIAggAi0AAzoAAyAIQQRqIAIgDkECdCIKQcAeaigCAGoiAhAXIAIgCkHgHmooAgBrIQIgBygCxAEhCgwBCyAIIAIQDAsgCkEJSQ0AIAggCmohCiAIQQhqIgggAkEIaiICa0EPTARAA0AgCCACEAwgAkEIaiECIAhBCGoiCCAKSQ0ADAIACwALA0AgCCACEAcgAkEQaiECIAhBEGoiCCAKSQ0ACwsgCxADBEAgCyEQDAQFIA0gDDYCACANIBkgHGogCWs2AgwgDSAJNgIIIA0gFDYCBCAEQQFqIQQgAyALaiEDDAILAAsLIAQgBUgNASAEIBdrIQtBACEEA0AgCyAFSARAIAcgB0HwAGogC0EDcUEEdGoiAikDCCIdNwPIASAHIAIpAwAiHjcDwAECQAJAAkAgBygCvAEiDCAepyICaiIKIBNLDQAgAyAHKALEASIJIAJqIhBqIBhLDQAgEiADayAQQSBqTw0BCyAHIAcpA8gBNwMgIAcgBykDwAE3AxggAyASIAdBGGogB0G8AWogEyAPIBUgERAeIRAMAQsgAiADaiEIIAMgDBAHIAJBEU8EQCADQRBqIQIDQCACIAxBEGoiDBAHIAJBEGoiAiAISQ0ACwsgCCAdpyIGayECIAcgCjYCvAEgBiAIIA9rSwRAIAYgCCAVa0sEQEFsIRAMAgsgESACIA9rIgJqIgwgCWogEU0EQCAIIAwgCRAPGgwCCyAIIAxBACACaxAPIQggByACIAlqIgk2AsQBIAggAmshCCAPIQILIAZBEE8EQCAIIAlqIQYDQCAIIAIQByACQRBqIQIgCEEQaiIIIAZJDQALDAELAkAgBkEHTQRAIAggAi0AADoAACAIIAItAAE6AAEgCCACLQACOgACIAggAi0AAzoAAyAIQQRqIAIgBkECdCIGQcAeaigCAGoiAhAXIAIgBkHgHmooAgBrIQIgBygCxAEhCQwBCyAIIAIQDAsgCUEJSQ0AIAggCWohBiAIQQhqIgggAkEIaiICa0EPTARAA0AgCCACEAwgAkEIaiECIAhBCGoiCCAGSQ0ADAIACwALA0AgCCACEAcgAkEQaiECIAhBEGoiCCAGSQ0ACwsgEBADDQMgC0EBaiELIAMgEGohAwwBCwsDQCAEQQNHBEAgACAEQQJ0IgJqQazQAWogAiAHaigCVDYCACAEQQFqIQQMAQsLIAcoArwBIQgLQbp/IRAgEyAIayIAIBIgA2tLDQAgAwR/IAMgCCAAEAsgAGoFQQALIAFrIRALIAdB0AFqJAAgEAslACAAQgA3AgAgAEEAOwEIIABBADoACyAAIAE2AgwgACACOgAKC7QFAQN/IwBBMGsiBCQAIABB/wFqIgVBfWohBgJAIAMvAQIEQCAEQRhqIAEgAhAGIgIQAw0BIARBEGogBEEYaiADEBwgBEEIaiAEQRhqIAMQHCAAIQMDQAJAIARBGGoQBCADIAZPckUEQCADIARBEGogBEEYahASOgAAIAMgBEEIaiAEQRhqEBI6AAEgBEEYahAERQ0BIANBAmohAwsgBUF+aiEFAn8DQEG6fyECIAMiASAFSw0FIAEgBEEQaiAEQRhqEBI6AAAgAUEBaiEDIARBGGoQBEEDRgRAQQIhAiAEQQhqDAILIAMgBUsNBSABIARBCGogBEEYahASOgABIAFBAmohA0EDIQIgBEEYahAEQQNHDQALIARBEGoLIQUgAyAFIARBGGoQEjoAACABIAJqIABrIQIMAwsgAyAEQRBqIARBGGoQEjoAAiADIARBCGogBEEYahASOgADIANBBGohAwwAAAsACyAEQRhqIAEgAhAGIgIQAw0AIARBEGogBEEYaiADEBwgBEEIaiAEQRhqIAMQHCAAIQMDQAJAIARBGGoQBCADIAZPckUEQCADIARBEGogBEEYahAROgAAIAMgBEEIaiAEQRhqEBE6AAEgBEEYahAERQ0BIANBAmohAwsgBUF+aiEFAn8DQEG6fyECIAMiASAFSw0EIAEgBEEQaiAEQRhqEBE6AAAgAUEBaiEDIARBGGoQBEEDRgRAQQIhAiAEQQhqDAILIAMgBUsNBCABIARBCGogBEEYahAROgABIAFBAmohA0EDIQIgBEEYahAEQQNHDQALIARBEGoLIQUgAyAFIARBGGoQEToAACABIAJqIABrIQIMAgsgAyAEQRBqIARBGGoQEToAAiADIARBCGogBEEYahAROgADIANBBGohAwwAAAsACyAEQTBqJAAgAgtpAQF/An8CQAJAIAJBB00NACABKAAAQbfIwuF+Rw0AIAAgASgABDYCmOIBQWIgAEEQaiABIAIQPiIDEAMNAhogAEKBgICAEDcDiOEBIAAgASADaiACIANrECoMAQsgACABIAIQKgtBAAsLrQMBBn8jAEGAAWsiAyQAQWIhCAJAIAJBCUkNACAAQZjQAGogAUEIaiIEIAJBeGogAEGY0AAQMyIFEAMiBg0AIANBHzYCfCADIANB/ABqIANB+ABqIAQgBCAFaiAGGyIEIAEgAmoiAiAEaxAVIgUQAw0AIAMoAnwiBkEfSw0AIAMoAngiB0EJTw0AIABBiCBqIAMgBkGAC0GADCAHEBggA0E0NgJ8IAMgA0H8AGogA0H4AGogBCAFaiIEIAIgBGsQFSIFEAMNACADKAJ8IgZBNEsNACADKAJ4IgdBCk8NACAAQZAwaiADIAZBgA1B4A4gBxAYIANBIzYCfCADIANB/ABqIANB+ABqIAQgBWoiBCACIARrEBUiBRADDQAgAygCfCIGQSNLDQAgAygCeCIHQQpPDQAgACADIAZBwBBB0BEgBxAYIAQgBWoiBEEMaiIFIAJLDQAgAiAFayEFQQAhAgNAIAJBA0cEQCAEKAAAIgZBf2ogBU8NAiAAIAJBAnRqQZzQAWogBjYCACACQQFqIQIgBEEEaiEEDAELCyAEIAFrIQgLIANBgAFqJAAgCAtGAQN/IABBCGohAyAAKAIEIQJBACEAA0AgACACdkUEQCABIAMgAEEDdGotAAJBFktqIQEgAEEBaiEADAELCyABQQggAmt0C4YDAQV/Qbh/IQcCQCADRQ0AIAItAAAiBEUEQCABQQA2AgBBAUG4fyADQQFGGw8LAn8gAkEBaiIFIARBGHRBGHUiBkF/Sg0AGiAGQX9GBEAgA0EDSA0CIAUvAABBgP4BaiEEIAJBA2oMAQsgA0ECSA0BIAItAAEgBEEIdHJBgIB+aiEEIAJBAmoLIQUgASAENgIAIAVBAWoiASACIANqIgNLDQBBbCEHIABBEGogACAFLQAAIgVBBnZBI0EJIAEgAyABa0HAEEHQEUHwEiAAKAKM4QEgACgCnOIBIAQQHyIGEAMiCA0AIABBmCBqIABBCGogBUEEdkEDcUEfQQggASABIAZqIAgbIgEgAyABa0GAC0GADEGAFyAAKAKM4QEgACgCnOIBIAQQHyIGEAMiCA0AIABBoDBqIABBBGogBUECdkEDcUE0QQkgASABIAZqIAgbIgEgAyABa0GADUHgDkGQGSAAKAKM4QEgACgCnOIBIAQQHyIAEAMNACAAIAFqIAJrIQcLIAcLrQMBCn8jAEGABGsiCCQAAn9BUiACQf8BSw0AGkFUIANBDEsNABogAkEBaiELIABBBGohCUGAgAQgA0F/anRBEHUhCkEAIQJBASEEQQEgA3QiB0F/aiIMIQUDQCACIAtGRQRAAkAgASACQQF0Ig1qLwEAIgZB//8DRgRAIAkgBUECdGogAjoAAiAFQX9qIQVBASEGDAELIARBACAKIAZBEHRBEHVKGyEECyAIIA1qIAY7AQAgAkEBaiECDAELCyAAIAQ7AQIgACADOwEAIAdBA3YgB0EBdmpBA2ohBkEAIQRBACECA0AgBCALRkUEQCABIARBAXRqLgEAIQpBACEAA0AgACAKTkUEQCAJIAJBAnRqIAQ6AAIDQCACIAZqIAxxIgIgBUsNAAsgAEEBaiEADAELCyAEQQFqIQQMAQsLQX8gAg0AGkEAIQIDfyACIAdGBH9BAAUgCCAJIAJBAnRqIgAtAAJBAXRqIgEgAS8BACIBQQFqOwEAIAAgAyABEBRrIgU6AAMgACABIAVB/wFxdCAHazsBACACQQFqIQIMAQsLCyEFIAhBgARqJAAgBQvjBgEIf0FsIQcCQCACQQNJDQACQAJAAkACQCABLQAAIgNBA3EiCUEBaw4DAwEAAgsgACgCiOEBDQBBYg8LIAJBBUkNAkEDIQYgASgAACEFAn8CQAJAIANBAnZBA3EiCEF+aiIEQQFNBEAgBEEBaw0BDAILIAVBDnZB/wdxIQQgBUEEdkH/B3EhAyAIRQwCCyAFQRJ2IQRBBCEGIAVBBHZB//8AcSEDQQAMAQsgBUEEdkH//w9xIgNBgIAISw0DIAEtAARBCnQgBUEWdnIhBEEFIQZBAAshBSAEIAZqIgogAksNAgJAIANBgQZJDQAgACgCnOIBRQ0AQQAhAgNAIAJBg4ABSw0BIAJBQGshAgwAAAsACwJ/IAlBA0YEQCABIAZqIQEgAEHw4gFqIQIgACgCDCEGIAUEQCACIAMgASAEIAYQXwwCCyACIAMgASAEIAYQXQwBCyAAQbjQAWohAiABIAZqIQEgAEHw4gFqIQYgAEGo0ABqIQggBQRAIAggBiADIAEgBCACEF4MAQsgCCAGIAMgASAEIAIQXAsQAw0CIAAgAzYCgOIBIABBATYCiOEBIAAgAEHw4gFqNgLw4QEgCUECRgRAIAAgAEGo0ABqNgIMCyAAIANqIgBBiOMBakIANwAAIABBgOMBakIANwAAIABB+OIBakIANwAAIABB8OIBakIANwAAIAoPCwJ/AkACQAJAIANBAnZBA3FBf2oiBEECSw0AIARBAWsOAgACAQtBASEEIANBA3YMAgtBAiEEIAEvAABBBHYMAQtBAyEEIAEQIUEEdgsiAyAEaiIFQSBqIAJLBEAgBSACSw0CIABB8OIBaiABIARqIAMQCyEBIAAgAzYCgOIBIAAgATYC8OEBIAEgA2oiAEIANwAYIABCADcAECAAQgA3AAggAEIANwAAIAUPCyAAIAM2AoDiASAAIAEgBGo2AvDhASAFDwsCfwJAAkACQCADQQJ2QQNxQX9qIgRBAksNACAEQQFrDgIAAgELQQEhByADQQN2DAILQQIhByABLwAAQQR2DAELIAJBBEkgARAhIgJBj4CAAUtyDQFBAyEHIAJBBHYLIQIgAEHw4gFqIAEgB2otAAAgAkEgahAQIQEgACACNgKA4gEgACABNgLw4QEgB0EBaiEHCyAHC0sAIABC+erQ0OfJoeThADcDICAAQgA3AxggAELP1tO+0ser2UI3AxAgAELW64Lu6v2J9eAANwMIIABCADcDACAAQShqQQBBKBAQGgviAgICfwV+IABBKGoiASAAKAJIaiECAn4gACkDACIDQiBaBEAgACkDECIEQgeJIAApAwgiBUIBiXwgACkDGCIGQgyJfCAAKQMgIgdCEol8IAUQGSAEEBkgBhAZIAcQGQwBCyAAKQMYQsXP2bLx5brqJ3wLIAN8IQMDQCABQQhqIgAgAk0EQEIAIAEpAAAQCSADhUIbiUKHla+vmLbem55/fkLj3MqV/M7y9YV/fCEDIAAhAQwBCwsCQCABQQRqIgAgAksEQCABIQAMAQsgASgAAK1Ch5Wvr5i23puef34gA4VCF4lCz9bTvtLHq9lCfkL5893xmfaZqxZ8IQMLA0AgACACSQRAIAAxAABCxc/ZsvHluuonfiADhUILiUKHla+vmLbem55/fiEDIABBAWohAAwBCwsgA0IhiCADhULP1tO+0ser2UJ+IgNCHYggA4VC+fPd8Zn2masWfiIDQiCIIAOFC+8CAgJ/BH4gACAAKQMAIAKtfDcDAAJAAkAgACgCSCIDIAJqIgRBH00EQCABRQ0BIAAgA2pBKGogASACECAgACgCSCACaiEEDAELIAEgAmohAgJ/IAMEQCAAQShqIgQgA2ogAUEgIANrECAgACAAKQMIIAQpAAAQCTcDCCAAIAApAxAgACkAMBAJNwMQIAAgACkDGCAAKQA4EAk3AxggACAAKQMgIABBQGspAAAQCTcDICAAKAJIIQMgAEEANgJIIAEgA2tBIGohAQsgAUEgaiACTQsEQCACQWBqIQMgACkDICEFIAApAxghBiAAKQMQIQcgACkDCCEIA0AgCCABKQAAEAkhCCAHIAEpAAgQCSEHIAYgASkAEBAJIQYgBSABKQAYEAkhBSABQSBqIgEgA00NAAsgACAFNwMgIAAgBjcDGCAAIAc3AxAgACAINwMICyABIAJPDQEgAEEoaiABIAIgAWsiBBAgCyAAIAQ2AkgLCy8BAX8gAEUEQEG2f0EAIAMbDwtBun8hBCADIAFNBH8gACACIAMQEBogAwVBun8LCy8BAX8gAEUEQEG2f0EAIAMbDwtBun8hBCADIAFNBH8gACACIAMQCxogAwVBun8LC6gCAQZ/IwBBEGsiByQAIABB2OABaikDAEKAgIAQViEIQbh/IQUCQCAEQf//B0sNACAAIAMgBBBCIgUQAyIGDQAgACgCnOIBIQkgACAHQQxqIAMgAyAFaiAGGyIKIARBACAFIAYbayIGEEAiAxADBEAgAyEFDAELIAcoAgwhBCABRQRAQbp/IQUgBEEASg0BCyAGIANrIQUgAyAKaiEDAkAgCQRAIABBADYCnOIBDAELAkACQAJAIARBBUgNACAAQdjgAWopAwBCgICACFgNAAwBCyAAQQA2ApziAQwBCyAAKAIIED8hBiAAQQA2ApziASAGQRRPDQELIAAgASACIAMgBSAEIAgQOSEFDAELIAAgASACIAMgBSAEIAgQOiEFCyAHQRBqJAAgBQtnACAAQdDgAWogASACIAAoAuzhARAuIgEQAwRAIAEPC0G4fyECAkAgAQ0AIABB7OABaigCACIBBEBBYCECIAAoApjiASABRw0BC0EAIQIgAEHw4AFqKAIARQ0AIABBkOEBahBDCyACCycBAX8QVyIERQRAQUAPCyAEIAAgASACIAMgBBBLEE8hACAEEFYgAAs/AQF/AkACQAJAIAAoAqDiAUEBaiIBQQJLDQAgAUEBaw4CAAECCyAAEDBBAA8LIABBADYCoOIBCyAAKAKU4gELvAMCB38BfiMAQRBrIgkkAEG4fyEGAkAgBCgCACIIQQVBCSAAKALs4QEiBRtJDQAgAygCACIHQQFBBSAFGyAFEC8iBRADBEAgBSEGDAELIAggBUEDakkNACAAIAcgBRBJIgYQAw0AIAEgAmohCiAAQZDhAWohCyAIIAVrIQIgBSAHaiEHIAEhBQNAIAcgAiAJECwiBhADDQEgAkF9aiICIAZJBEBBuH8hBgwCCyAJKAIAIghBAksEQEFsIQYMAgsgB0EDaiEHAn8CQAJAAkAgCEEBaw4CAgABCyAAIAUgCiAFayAHIAYQSAwCCyAFIAogBWsgByAGEEcMAQsgBSAKIAVrIActAAAgCSgCCBBGCyIIEAMEQCAIIQYMAgsgACgC8OABBEAgCyAFIAgQRQsgAiAGayECIAYgB2ohByAFIAhqIQUgCSgCBEUNAAsgACkD0OABIgxCf1IEQEFsIQYgDCAFIAFrrFINAQsgACgC8OABBEBBaiEGIAJBBEkNASALEEQhDCAHKAAAIAynRw0BIAdBBGohByACQXxqIQILIAMgBzYCACAEIAI2AgAgBSABayEGCyAJQRBqJAAgBgsuACAAECsCf0EAQQAQAw0AGiABRSACRXJFBEBBYiAAIAEgAhA9EAMNARoLQQALCzcAIAEEQCAAIAAoAsTgASABKAIEIAEoAghqRzYCnOIBCyAAECtBABADIAFFckUEQCAAIAEQWwsL0QIBB38jAEEQayIGJAAgBiAENgIIIAYgAzYCDCAFBEAgBSgCBCEKIAUoAgghCQsgASEIAkACQANAIAAoAuzhARAWIQsCQANAIAQgC0kNASADKAAAQXBxQdDUtMIBRgRAIAMgBBAiIgcQAw0EIAQgB2shBCADIAdqIQMMAQsLIAYgAzYCDCAGIAQ2AggCQCAFBEAgACAFEE5BACEHQQAQA0UNAQwFCyAAIAogCRBNIgcQAw0ECyAAIAgQUCAMQQFHQQAgACAIIAIgBkEMaiAGQQhqEEwiByIDa0EAIAMQAxtBCkdyRQRAQbh/IQcMBAsgBxADDQMgAiAHayECIAcgCGohCEEBIQwgBigCDCEDIAYoAgghBAwBCwsgBiADNgIMIAYgBDYCCEG4fyEHIAQNASAIIAFrIQcMAQsgBiADNgIMIAYgBDYCCAsgBkEQaiQAIAcLRgECfyABIAAoArjgASICRwRAIAAgAjYCxOABIAAgATYCuOABIAAoArzgASEDIAAgATYCvOABIAAgASADIAJrajYCwOABCwutAgIEfwF+IwBBQGoiBCQAAkACQCACQQhJDQAgASgAAEFwcUHQ1LTCAUcNACABIAIQIiEBIABCADcDCCAAQQA2AgQgACABNgIADAELIARBGGogASACEC0iAxADBEAgACADEBoMAQsgAwRAIABBuH8QGgwBCyACIAQoAjAiA2shAiABIANqIQMDQAJAIAAgAyACIARBCGoQLCIFEAMEfyAFBSACIAVBA2oiBU8NAUG4fwsQGgwCCyAGQQFqIQYgAiAFayECIAMgBWohAyAEKAIMRQ0ACyAEKAI4BEAgAkEDTQRAIABBuH8QGgwCCyADQQRqIQMLIAQoAighAiAEKQMYIQcgAEEANgIEIAAgAyABazYCACAAIAIgBmytIAcgB0J/URs3AwgLIARBQGskAAslAQF/IwBBEGsiAiQAIAIgACABEFEgAigCACEAIAJBEGokACAAC30BBH8jAEGQBGsiBCQAIARB/wE2AggCQCAEQRBqIARBCGogBEEMaiABIAIQFSIGEAMEQCAGIQUMAQtBVCEFIAQoAgwiB0EGSw0AIAMgBEEQaiAEKAIIIAcQQSIFEAMNACAAIAEgBmogAiAGayADEDwhBQsgBEGQBGokACAFC4cBAgJ/An5BABAWIQMCQANAIAEgA08EQAJAIAAoAABBcHFB0NS0wgFGBEAgACABECIiAhADRQ0BQn4PCyAAIAEQVSIEQn1WDQMgBCAFfCIFIARUIQJCfiEEIAINAyAAIAEQUiICEAMNAwsgASACayEBIAAgAmohAAwBCwtCfiAFIAEbIQQLIAQLPwIBfwF+IwBBMGsiAiQAAn5CfiACQQhqIAAgARAtDQAaQgAgAigCHEEBRg0AGiACKQMICyEDIAJBMGokACADC40BAQJ/IwBBMGsiASQAAkAgAEUNACAAKAKI4gENACABIABB/OEBaigCADYCKCABIAApAvThATcDICAAEDAgACgCqOIBIQIgASABKAIoNgIYIAEgASkDIDcDECACIAFBEGoQGyAAQQA2AqjiASABIAEoAig2AgggASABKQMgNwMAIAAgARAbCyABQTBqJAALKgECfyMAQRBrIgAkACAAQQA2AgggAEIANwMAIAAQWCEBIABBEGokACABC4cBAQN/IwBBEGsiAiQAAkAgACgCAEUgACgCBEVzDQAgAiAAKAIINgIIIAIgACkCADcDAAJ/IAIoAgAiAQRAIAIoAghBqOMJIAERBQAMAQtBqOMJECgLIgFFDQAgASAAKQIANwL04QEgAUH84QFqIAAoAgg2AgAgARBZIAEhAwsgAkEQaiQAIAMLywEBAn8jAEEgayIBJAAgAEGBgIDAADYCtOIBIABBADYCiOIBIABBADYC7OEBIABCADcDkOIBIABBADYCpOMJIABBADYC3OIBIABCADcCzOIBIABBADYCvOIBIABBADYCxOABIABCADcCnOIBIABBpOIBakIANwIAIABBrOIBakEANgIAIAFCADcCECABQgA3AhggASABKQMYNwMIIAEgASkDEDcDACABKAIIQQh2QQFxIQIgAEEANgLg4gEgACACNgKM4gEgAUEgaiQAC3YBA38jAEEwayIBJAAgAARAIAEgAEHE0AFqIgIoAgA2AiggASAAKQK80AE3AyAgACgCACEDIAEgAigCADYCGCABIAApArzQATcDECADIAFBEGoQGyABIAEoAig2AgggASABKQMgNwMAIAAgARAbCyABQTBqJAALzAEBAX8gACABKAK00AE2ApjiASAAIAEoAgQiAjYCwOABIAAgAjYCvOABIAAgAiABKAIIaiICNgK44AEgACACNgLE4AEgASgCuNABBEAgAEKBgICAEDcDiOEBIAAgAUGk0ABqNgIMIAAgAUGUIGo2AgggACABQZwwajYCBCAAIAFBDGo2AgAgAEGs0AFqIAFBqNABaigCADYCACAAQbDQAWogAUGs0AFqKAIANgIAIABBtNABaiABQbDQAWooAgA2AgAPCyAAQgA3A4jhAQs7ACACRQRAQbp/DwsgBEUEQEFsDwsgAiAEEGAEQCAAIAEgAiADIAQgBRBhDwsgACABIAIgAyAEIAUQZQtGAQF/IwBBEGsiBSQAIAVBCGogBBAOAn8gBS0ACQRAIAAgASACIAMgBBAyDAELIAAgASACIAMgBBA0CyEAIAVBEGokACAACzQAIAAgAyAEIAUQNiIFEAMEQCAFDwsgBSAESQR/IAEgAiADIAVqIAQgBWsgABA1BUG4fwsLRgEBfyMAQRBrIgUkACAFQQhqIAQQDgJ/IAUtAAkEQCAAIAEgAiADIAQQYgwBCyAAIAEgAiADIAQQNQshACAFQRBqJAAgAAtZAQF/QQ8hAiABIABJBEAgAUEEdCAAbiECCyAAQQh2IgEgAkEYbCIAQYwIaigCAGwgAEGICGooAgBqIgJBA3YgAmogAEGACGooAgAgAEGECGooAgAgAWxqSQs3ACAAIAMgBCAFQYAQEDMiBRADBEAgBQ8LIAUgBEkEfyABIAIgAyAFaiAEIAVrIAAQMgVBuH8LC78DAQN/IwBBIGsiBSQAIAVBCGogAiADEAYiAhADRQRAIAAgAWoiB0F9aiEGIAUgBBAOIARBBGohAiAFLQACIQMDQEEAIAAgBkkgBUEIahAEGwRAIAAgAiAFQQhqIAMQAkECdGoiBC8BADsAACAFQQhqIAQtAAIQASAAIAQtAANqIgQgAiAFQQhqIAMQAkECdGoiAC8BADsAACAFQQhqIAAtAAIQASAEIAAtAANqIQAMAQUgB0F+aiEEA0AgBUEIahAEIAAgBEtyRQRAIAAgAiAFQQhqIAMQAkECdGoiBi8BADsAACAFQQhqIAYtAAIQASAAIAYtAANqIQAMAQsLA0AgACAES0UEQCAAIAIgBUEIaiADEAJBAnRqIgYvAQA7AAAgBUEIaiAGLQACEAEgACAGLQADaiEADAELCwJAIAAgB08NACAAIAIgBUEIaiADEAIiA0ECdGoiAC0AADoAACAALQADQQFGBEAgBUEIaiAALQACEAEMAQsgBSgCDEEfSw0AIAVBCGogAiADQQJ0ai0AAhABIAUoAgxBIUkNACAFQSA2AgwLIAFBbCAFQQhqEAobIQILCwsgBUEgaiQAIAILkgIBBH8jAEFAaiIJJAAgCSADQTQQCyEDAkAgBEECSA0AIAMgBEECdGooAgAhCSADQTxqIAgQIyADQQE6AD8gAyACOgA+QQAhBCADKAI8IQoDQCAEIAlGDQEgACAEQQJ0aiAKNgEAIARBAWohBAwAAAsAC0EAIQkDQCAGIAlGRQRAIAMgBSAJQQF0aiIKLQABIgtBAnRqIgwoAgAhBCADQTxqIAotAABBCHQgCGpB//8DcRAjIANBAjoAPyADIAcgC2siCiACajoAPiAEQQEgASAKa3RqIQogAygCPCELA0AgACAEQQJ0aiALNgEAIARBAWoiBCAKSQ0ACyAMIAo2AgAgCUEBaiEJDAELCyADQUBrJAALowIBCX8jAEHQAGsiCSQAIAlBEGogBUE0EAsaIAcgBmshDyAHIAFrIRADQAJAIAMgCkcEQEEBIAEgByACIApBAXRqIgYtAAEiDGsiCGsiC3QhDSAGLQAAIQ4gCUEQaiAMQQJ0aiIMKAIAIQYgCyAPTwRAIAAgBkECdGogCyAIIAUgCEE0bGogCCAQaiIIQQEgCEEBShsiCCACIAQgCEECdGooAgAiCEEBdGogAyAIayAHIA4QYyAGIA1qIQgMAgsgCUEMaiAOECMgCUEBOgAPIAkgCDoADiAGIA1qIQggCSgCDCELA0AgBiAITw0CIAAgBkECdGogCzYBACAGQQFqIQYMAAALAAsgCUHQAGokAA8LIAwgCDYCACAKQQFqIQoMAAALAAs0ACAAIAMgBCAFEDYiBRADBEAgBQ8LIAUgBEkEfyABIAIgAyAFaiAEIAVrIAAQNAVBuH8LCyMAIAA/AEEQdGtB//8DakEQdkAAQX9GBEBBAA8LQQAQAEEBCzsBAX8gAgRAA0AgACABIAJBgCAgAkGAIEkbIgMQCyEAIAFBgCBqIQEgAEGAIGohACACIANrIgINAAsLCwYAIAAQAwsLqBUJAEGICAsNAQAAAAEAAAACAAAAAgBBoAgLswYBAAAAAQAAAAIAAAACAAAAJgAAAIIAAAAhBQAASgAAAGcIAAAmAAAAwAEAAIAAAABJBQAASgAAAL4IAAApAAAALAIAAIAAAABJBQAASgAAAL4IAAAvAAAAygIAAIAAAACKBQAASgAAAIQJAAA1AAAAcwMAAIAAAACdBQAASgAAAKAJAAA9AAAAgQMAAIAAAADrBQAASwAAAD4KAABEAAAAngMAAIAAAABNBgAASwAAAKoKAABLAAAAswMAAIAAAADBBgAATQAAAB8NAABNAAAAUwQAAIAAAAAjCAAAUQAAAKYPAABUAAAAmQQAAIAAAABLCQAAVwAAALESAABYAAAA2gQAAIAAAABvCQAAXQAAACMUAABUAAAARQUAAIAAAABUCgAAagAAAIwUAABqAAAArwUAAIAAAAB2CQAAfAAAAE4QAAB8AAAA0gIAAIAAAABjBwAAkQAAAJAHAACSAAAAAAAAAAEAAAABAAAABQAAAA0AAAAdAAAAPQAAAH0AAAD9AAAA/QEAAP0DAAD9BwAA/Q8AAP0fAAD9PwAA/X8AAP3/AAD9/wEA/f8DAP3/BwD9/w8A/f8fAP3/PwD9/38A/f//AP3//wH9//8D/f//B/3//w/9//8f/f//P/3//38AAAAAAQAAAAIAAAADAAAABAAAAAUAAAAGAAAABwAAAAgAAAAJAAAACgAAAAsAAAAMAAAADQAAAA4AAAAPAAAAEAAAABEAAAASAAAAEwAAABQAAAAVAAAAFgAAABcAAAAYAAAAGQAAABoAAAAbAAAAHAAAAB0AAAAeAAAAHwAAAAMAAAAEAAAABQAAAAYAAAAHAAAACAAAAAkAAAAKAAAACwAAAAwAAAANAAAADgAAAA8AAAAQAAAAEQAAABIAAAATAAAAFAAAABUAAAAWAAAAFwAAABgAAAAZAAAAGgAAABsAAAAcAAAAHQAAAB4AAAAfAAAAIAAAACEAAAAiAAAAIwAAACUAAAAnAAAAKQAAACsAAAAvAAAAMwAAADsAAABDAAAAUwAAAGMAAACDAAAAAwEAAAMCAAADBAAAAwgAAAMQAAADIAAAA0AAAAOAAAADAAEAQeAPC1EBAAAAAQAAAAEAAAABAAAAAgAAAAIAAAADAAAAAwAAAAQAAAAEAAAABQAAAAcAAAAIAAAACQAAAAoAAAALAAAADAAAAA0AAAAOAAAADwAAABAAQcQQC4sBAQAAAAIAAAADAAAABAAAAAUAAAAGAAAABwAAAAgAAAAJAAAACgAAAAsAAAAMAAAADQAAAA4AAAAPAAAAEAAAABIAAAAUAAAAFgAAABgAAAAcAAAAIAAAACgAAAAwAAAAQAAAAIAAAAAAAQAAAAIAAAAEAAAACAAAABAAAAAgAAAAQAAAAIAAAAAAAQBBkBIL5gQBAAAAAQAAAAEAAAABAAAAAgAAAAIAAAADAAAAAwAAAAQAAAAGAAAABwAAAAgAAAAJAAAACgAAAAsAAAAMAAAADQAAAA4AAAAPAAAAEAAAAAEAAAAEAAAACAAAAAAAAAABAAEBBgAAAAAAAAQAAAAAEAAABAAAAAAgAAAFAQAAAAAAAAUDAAAAAAAABQQAAAAAAAAFBgAAAAAAAAUHAAAAAAAABQkAAAAAAAAFCgAAAAAAAAUMAAAAAAAABg4AAAAAAAEFEAAAAAAAAQUUAAAAAAABBRYAAAAAAAIFHAAAAAAAAwUgAAAAAAAEBTAAAAAgAAYFQAAAAAAABwWAAAAAAAAIBgABAAAAAAoGAAQAAAAADAYAEAAAIAAABAAAAAAAAAAEAQAAAAAAAAUCAAAAIAAABQQAAAAAAAAFBQAAACAAAAUHAAAAAAAABQgAAAAgAAAFCgAAAAAAAAULAAAAAAAABg0AAAAgAAEFEAAAAAAAAQUSAAAAIAABBRYAAAAAAAIFGAAAACAAAwUgAAAAAAADBSgAAAAAAAYEQAAAABAABgRAAAAAIAAHBYAAAAAAAAkGAAIAAAAACwYACAAAMAAABAAAAAAQAAAEAQAAACAAAAUCAAAAIAAABQMAAAAgAAAFBQAAACAAAAUGAAAAIAAABQgAAAAgAAAFCQAAACAAAAULAAAAIAAABQwAAAAAAAAGDwAAACAAAQUSAAAAIAABBRQAAAAgAAIFGAAAACAAAgUcAAAAIAADBSgAAAAgAAQFMAAAAAAAEAYAAAEAAAAPBgCAAAAAAA4GAEAAAAAADQYAIABBgBcLhwIBAAEBBQAAAAAAAAUAAAAAAAAGBD0AAAAAAAkF/QEAAAAADwX9fwAAAAAVBf3/HwAAAAMFBQAAAAAABwR9AAAAAAAMBf0PAAAAABIF/f8DAAAAFwX9/38AAAAFBR0AAAAAAAgE/QAAAAAADgX9PwAAAAAUBf3/DwAAAAIFAQAAABAABwR9AAAAAAALBf0HAAAAABEF/f8BAAAAFgX9/z8AAAAEBQ0AAAAQAAgE/QAAAAAADQX9HwAAAAATBf3/BwAAAAEFAQAAABAABgQ9AAAAAAAKBf0DAAAAABAF/f8AAAAAHAX9//8PAAAbBf3//wcAABoF/f//AwAAGQX9//8BAAAYBf3//wBBkBkLhgQBAAEBBgAAAAAAAAYDAAAAAAAABAQAAAAgAAAFBQAAAAAAAAUGAAAAAAAABQgAAAAAAAAFCQAAAAAAAAULAAAAAAAABg0AAAAAAAAGEAAAAAAAAAYTAAAAAAAABhYAAAAAAAAGGQAAAAAAAAYcAAAAAAAABh8AAAAAAAAGIgAAAAAAAQYlAAAAAAABBikAAAAAAAIGLwAAAAAAAwY7AAAAAAAEBlMAAAAAAAcGgwAAAAAACQYDAgAAEAAABAQAAAAAAAAEBQAAACAAAAUGAAAAAAAABQcAAAAgAAAFCQAAAAAAAAUKAAAAAAAABgwAAAAAAAAGDwAAAAAAAAYSAAAAAAAABhUAAAAAAAAGGAAAAAAAAAYbAAAAAAAABh4AAAAAAAAGIQAAAAAAAQYjAAAAAAABBicAAAAAAAIGKwAAAAAAAwYzAAAAAAAEBkMAAAAAAAUGYwAAAAAACAYDAQAAIAAABAQAAAAwAAAEBAAAABAAAAQFAAAAIAAABQcAAAAgAAAFCAAAACAAAAUKAAAAIAAABQsAAAAAAAAGDgAAAAAAAAYRAAAAAAAABhQAAAAAAAAGFwAAAAAAAAYaAAAAAAAABh0AAAAAAAAGIAAAAAAAEAYDAAEAAAAPBgOAAAAAAA4GA0AAAAAADQYDIAAAAAAMBgMQAAAAAAsGAwgAAAAACgYDBABBpB0L2QEBAAAAAwAAAAcAAAAPAAAAHwAAAD8AAAB/AAAA/wAAAP8BAAD/AwAA/wcAAP8PAAD/HwAA/z8AAP9/AAD//wAA//8BAP//AwD//wcA//8PAP//HwD//z8A//9/AP///wD///8B////A////wf///8P////H////z////9/AAAAAAEAAAACAAAABAAAAAAAAAACAAAABAAAAAgAAAAAAAAAAQAAAAIAAAABAAAABAAAAAQAAAAEAAAABAAAAAgAAAAIAAAACAAAAAcAAAAIAAAACQAAAAoAAAALAEGgIAsDwBBQ",KA=new WeakMap;let Px,BC=0;class av extends b.aNw{constructor(e){super(e),this.transcoderPath="",this.transcoderBinary=null,this.transcoderPending=null,this.workerPool=new wD,this.workerSourceURL="",this.workerConfig=null,typeof MSC_TRANSCODER<"u"&&console.warn('THREE.KTX2Loader: Please update to latest "basis_transcoder". "msc_basis_transcoder" is no longer supported in three.js r125+.')}setTranscoderPath(e){return this.transcoderPath=e,this}setWorkerLimit(e){return this.workerPool.setWorkerLimit(e),this}detectSupport(e){return this.workerConfig={astcSupported:e.extensions.has("WEBGL_compressed_texture_astc"),etc1Supported:e.extensions.has("WEBGL_compressed_texture_etc1"),etc2Supported:e.extensions.has("WEBGL_compressed_texture_etc"),dxtSupported:e.extensions.has("WEBGL_compressed_texture_s3tc"),bptcSupported:e.extensions.has("EXT_texture_compression_bptc"),pvrtcSupported:e.extensions.has("WEBGL_compressed_texture_pvrtc")||e.extensions.has("WEBKIT_WEBGL_compressed_texture_pvrtc")},e.capabilities.isWebGL2&&(this.workerConfig.etc1Supported=!1),this}init(){if(!this.transcoderPending){const e=new b.hH6(this.manager);e.setPath(this.transcoderPath),e.setWithCredentials(this.withCredentials);const i=e.loadAsync("basis_transcoder.js"),s=new b.hH6(this.manager);s.setPath(this.transcoderPath),s.setResponseType("arraybuffer"),s.setWithCredentials(this.withCredentials);const a=s.loadAsync("basis_transcoder.wasm");this.transcoderPending=Promise.all([i,a]).then(([h,d])=>{const _=av.BasisWorker.toString(),et=["/* constants */","let _EngineFormat = "+JSON.stringify(av.EngineFormat),"let _TranscoderFormat = "+JSON.stringify(av.TranscoderFormat),"let _BasisFormat = "+JSON.stringify(av.BasisFormat),"/* basis_transcoder.js */",h,"/* worker */",_.substring(_.indexOf("{")+1,_.lastIndexOf("}"))].join(`
`);this.workerSourceURL=URL.createObjectURL(new Blob([et])),this.transcoderBinary=d,this.workerPool.setWorkerCreator(()=>{const nt=new Worker(this.workerSourceURL),it=this.transcoderBinary.slice(0);return nt.postMessage({type:"init",config:this.workerConfig,transcoderBinary:it},[it]),nt})}),BC>0&&console.warn("THREE.KTX2Loader: Multiple active KTX2 loaders may cause performance issues. Use a single KTX2Loader instance, or call .dispose() on old instances."),BC++}return this.transcoderPending}load(e,i,s,a){if(this.workerConfig===null)throw new Error("THREE.KTX2Loader: Missing initialization with `.detectSupport( renderer )`.");const h=new b.hH6(this.manager);h.setResponseType("arraybuffer"),h.setWithCredentials(this.withCredentials),h.load(e,d=>{if(KA.has(d))return KA.get(d).promise.then(i).catch(a);this.createTexture(d).then(_=>i?i(_):null).catch(a)},s,a)}_createTextureFrom(e){const{mipmaps:i,width:s,height:a,format:h,type:d,error:_,dfdTransferFn:et,dfdFlags:nt}=e;if(d==="error")return Promise.reject(_);const it=new b.EB7(i,s,a,h,b.ywz);return it.minFilter=i.length===1?b.wem:b.D1R,it.magFilter=b.wem,it.generateMipmaps=!1,it.needsUpdate=!0,it.encoding=et===2?b.knz:b.rnI,it.premultiplyAlpha=!!(1&nt),it}createTexture(e,i={}){const s=function(d){const _=new Uint8Array(d.buffer,d.byteOffset,ep.length);if(_[0]!==ep[0]||_[1]!==ep[1]||_[2]!==ep[2]||_[3]!==ep[3]||_[4]!==ep[4]||_[5]!==ep[5]||_[6]!==ep[6]||_[7]!==ep[7]||_[8]!==ep[8]||_[9]!==ep[9]||_[10]!==ep[10]||_[11]!==ep[11])throw new Error("Missing KTX 2.0 identifier.");const et=new xD,nt=17*Uint32Array.BYTES_PER_ELEMENT,it=new bm(d,ep.length,nt,!0);et.vkFormat=it._nextUint32(),et.typeSize=it._nextUint32(),et.pixelWidth=it._nextUint32(),et.pixelHeight=it._nextUint32(),et.pixelDepth=it._nextUint32(),et.layerCount=it._nextUint32(),et.faceCount=it._nextUint32();const lt=it._nextUint32();et.supercompressionScheme=it._nextUint32();const ut=it._nextUint32(),pt=it._nextUint32(),gt=it._nextUint32(),vt=it._nextUint32(),Ct=it._nextUint64(),wt=it._nextUint64(),xt=new bm(d,ep.length+nt,3*lt*8,!0);for(let Cr=0;Cr<lt;Cr++)et.levels.push({levelData:new Uint8Array(d.buffer,d.byteOffset+xt._nextUint64(),xt._nextUint64()),uncompressedByteLength:xt._nextUint64()});const _t=new bm(d,ut,pt,!0),Pt={vendorId:_t._skip(4)._nextUint16(),descriptorType:_t._nextUint16(),versionNumber:_t._nextUint16(),descriptorBlockSize:_t._nextUint16(),colorModel:_t._nextUint8(),colorPrimaries:_t._nextUint8(),transferFunction:_t._nextUint8(),flags:_t._nextUint8(),texelBlockDimension:[_t._nextUint8(),_t._nextUint8(),_t._nextUint8(),_t._nextUint8()],bytesPlane:[_t._nextUint8(),_t._nextUint8(),_t._nextUint8(),_t._nextUint8(),_t._nextUint8(),_t._nextUint8(),_t._nextUint8(),_t._nextUint8()],samples:[]},Bt=(Pt.descriptorBlockSize/4-6)/4;for(let Cr=0;Cr<Bt;Cr++){const Mr={bitOffset:_t._nextUint16(),bitLength:_t._nextUint8(),channelType:_t._nextUint8(),samplePosition:[_t._nextUint8(),_t._nextUint8(),_t._nextUint8(),_t._nextUint8()],sampleLower:-1/0,sampleUpper:1/0};64&Mr.channelType?(Mr.sampleLower=_t._nextInt32(),Mr.sampleUpper=_t._nextInt32()):(Mr.sampleLower=_t._nextUint32(),Mr.sampleUpper=_t._nextUint32()),Pt.samples[Cr]=Mr}et.dataFormatDescriptor.length=0,et.dataFormatDescriptor.push(Pt);const Ot=new bm(d,gt,vt,!0);for(;Ot._offset<vt;){const Cr=Ot._nextUint32(),Mr=Ot._scan(Cr),Lr=DC(Mr),ls=Ot._scan(Cr-Mr.byteLength);et.keyValue[Lr]=Lr.match(/^ktx/i)?DC(ls):ls,Ot._offset%4&&Ot._skip(4-Ot._offset%4)}if(wt<=0)return et;const Lt=new bm(d,Ct,wt,!0),qt=Lt._nextUint16(),en=Lt._nextUint16(),cn=Lt._nextUint32(),An=Lt._nextUint32(),mn=Lt._nextUint32(),Tn=Lt._nextUint32(),vn=[];for(let Cr=0;Cr<lt;Cr++)vn.push({imageFlags:Lt._nextUint32(),rgbSliceByteOffset:Lt._nextUint32(),rgbSliceByteLength:Lt._nextUint32(),alphaSliceByteOffset:Lt._nextUint32(),alphaSliceByteLength:Lt._nextUint32()});const xn=Ct+Lt._offset,Un=xn+cn,Mn=Un+An,Gn=Mn+mn,rr=new Uint8Array(d.buffer,d.byteOffset+xn,cn),dr=new Uint8Array(d.buffer,d.byteOffset+Un,An),_i=new Uint8Array(d.buffer,d.byteOffset+Mn,mn),xr=new Uint8Array(d.buffer,d.byteOffset+Gn,Tn);return et.globalData={endpointCount:qt,selectorCount:en,imageDescs:vn,endpointsData:rr,selectorsData:dr,tablesData:_i,extendedData:xr},et}(new Uint8Array(e));if(s.vkFormat!==0)return async function(d){const{vkFormat:_,pixelWidth:et,pixelHeight:nt,pixelDepth:it}=d;if(UT[_]===void 0)throw new Error("THREE.KTX2Loader: Unsupported vkFormat.");const lt=d.levels[0];let ut,pt;if(d.supercompressionScheme===0)ut=lt.levelData;else{if(d.supercompressionScheme!==2)throw new Error("THREE.KTX2Loader: Unsupported supercompressionScheme.");Px||(Px=new Promise(async vt=>{const Ct=new NT;await Ct.init(),vt(Ct)})),ut=(await Px).decode(lt.levelData,lt.uncompressedByteLength)}pt=bE[_]===b.VzW?new Float32Array(ut.buffer,ut.byteOffset,ut.byteLength/Float32Array.BYTES_PER_ELEMENT):bE[_]===b.cLu?new Uint16Array(ut.buffer,ut.byteOffset,ut.byteLength/Uint16Array.BYTES_PER_ELEMENT):ut;const gt=it===0?new b.IEO(pt,et,nt):new b.JUT(pt,et,nt,it);return gt.type=bE[_],gt.format=UT[_],gt.encoding=FT[_]||b.rnI,gt.needsUpdate=!0,Promise.resolve(gt)}(s);const a=i,h=this.init().then(()=>this.workerPool.postMessage({type:"transcode",buffer:e,taskConfig:a},[e])).then(d=>this._createTextureFrom(d.data));return KA.set(e,{promise:h}),h}dispose(){return this.workerPool.dispose(),this.workerSourceURL&&URL.revokeObjectURL(this.workerSourceURL),BC--,this}}av.BasisFormat={ETC1S:0,UASTC_4x4:1},av.TranscoderFormat={ETC1:0,ETC2:1,BC1:2,BC3:3,BC4:4,BC5:5,BC7_M6_OPAQUE_ONLY:6,BC7_M5:7,PVRTC1_4_RGB:8,PVRTC1_4_RGBA:9,ASTC_4x4:10,ATC_RGB:11,ATC_RGBA_INTERPOLATED_ALPHA:12,RGBA32:13,RGB565:14,BGR565:15,RGBA4444:16},av.EngineFormat={RGBAFormat:b.wk1,RGBA_ASTC_4x4_Format:b.ptH,RGBA_BPTC_Format:b.bsb,RGBA_ETC2_EAC_Format:b.ekQ,RGBA_PVRTC_4BPPV1_Format:b.eaV,RGBA_S3TC_DXT5_Format:b.ILR,RGB_ETC1_Format:b.fto,RGB_ETC2_Format:b.l0P,RGB_PVRTC_4BPPV1_Format:b._AM,RGB_S3TC_DXT1_Format:b.wuA},av.BasisWorker=function(){let c,e,i;const s=_EngineFormat,a=_TranscoderFormat,h=_BasisFormat;self.addEventListener("message",function(it){const lt=it.data;switch(lt.type){case"init":c=lt.config,ut=lt.transcoderBinary,e=new Promise(pt=>{i={wasmBinary:ut,onRuntimeInitialized:pt},BASIS(i)}).then(()=>{i.initializeBasis(),i.KTX2File===void 0&&console.warn("THREE.KTX2Loader: Please update Basis Universal transcoder.")});break;case"transcode":e.then(()=>{try{const{width:pt,height:gt,hasAlpha:vt,mipmaps:Ct,format:wt,dfdTransferFn:xt,dfdFlags:_t}=function(Bt){const Ot=new i.KTX2File(new Uint8Array(Bt));function Lt(){Ot.close(),Ot.delete()}if(!Ot.isValid())throw Lt(),new Error("THREE.KTX2Loader:	Invalid or unsupported .ktx2 file");const qt=Ot.isUASTC()?h.UASTC_4x4:h.ETC1S,en=Ot.getWidth(),cn=Ot.getHeight(),An=Ot.getLevels(),mn=Ot.getHasAlpha(),Tn=Ot.getDFDTransferFunc(),vn=Ot.getDFDFlags(),{transcoderFormat:xn,engineFormat:Un}=function(Gn,rr,dr,_i){let xr,Cr;const Mr=Gn===h.ETC1S?_:et;for(let Lr=0;Lr<Mr.length;Lr++){const ls=Mr[Lr];if(c[ls.if]&&ls.basisFormat.includes(Gn)&&!(_i&&ls.transcoderFormat.length<2)&&(!ls.needsPowerOfTwo||nt(rr)&&nt(dr)))return xr=ls.transcoderFormat[_i?1:0],Cr=ls.engineFormat[_i?1:0],{transcoderFormat:xr,engineFormat:Cr}}return console.warn("THREE.KTX2Loader: No suitable compressed texture format found. Decoding to RGBA32."),xr=a.RGBA32,Cr=s.RGBAFormat,{transcoderFormat:xr,engineFormat:Cr}}(qt,en,cn,mn);if(!en||!cn||!An)throw Lt(),new Error("THREE.KTX2Loader:	Invalid texture");if(!Ot.startTranscoding())throw Lt(),new Error("THREE.KTX2Loader: .startTranscoding failed");const Mn=[];for(let Gn=0;Gn<An;Gn++){const rr=Ot.getImageLevelInfo(Gn,0,0),dr=rr.origWidth,_i=rr.origHeight,xr=new Uint8Array(Ot.getImageTranscodedSizeInBytes(Gn,0,0,xn));if(!Ot.transcodeImage(xr,Gn,0,0,xn,0,-1,-1))throw Lt(),new Error("THREE.KTX2Loader: .transcodeImage failed.");Mn.push({data:xr,width:dr,height:_i})}return Lt(),{width:en,height:cn,hasAlpha:mn,mipmaps:Mn,format:Un,dfdTransferFn:Tn,dfdFlags:vn}}(lt.buffer),Pt=[];for(let Bt=0;Bt<Ct.length;++Bt)Pt.push(Ct[Bt].data.buffer);self.postMessage({type:"transcode",id:lt.id,width:pt,height:gt,hasAlpha:vt,mipmaps:Ct,format:wt,dfdTransferFn:xt,dfdFlags:_t},Pt)}catch(pt){console.error(pt),self.postMessage({type:"error",id:lt.id,error:pt.message})}})}var ut});const d=[{if:"astcSupported",basisFormat:[h.UASTC_4x4],transcoderFormat:[a.ASTC_4x4,a.ASTC_4x4],engineFormat:[s.RGBA_ASTC_4x4_Format,s.RGBA_ASTC_4x4_Format],priorityETC1S:1/0,priorityUASTC:1,needsPowerOfTwo:!1},{if:"bptcSupported",basisFormat:[h.ETC1S,h.UASTC_4x4],transcoderFormat:[a.BC7_M5,a.BC7_M5],engineFormat:[s.RGBA_BPTC_Format,s.RGBA_BPTC_Format],priorityETC1S:3,priorityUASTC:2,needsPowerOfTwo:!1},{if:"dxtSupported",basisFormat:[h.ETC1S,h.UASTC_4x4],transcoderFormat:[a.BC1,a.BC3],engineFormat:[s.RGB_S3TC_DXT1_Format,s.RGBA_S3TC_DXT5_Format],priorityETC1S:4,priorityUASTC:5,needsPowerOfTwo:!1},{if:"etc2Supported",basisFormat:[h.ETC1S,h.UASTC_4x4],transcoderFormat:[a.ETC1,a.ETC2],engineFormat:[s.RGB_ETC2_Format,s.RGBA_ETC2_EAC_Format],priorityETC1S:1,priorityUASTC:3,needsPowerOfTwo:!1},{if:"etc1Supported",basisFormat:[h.ETC1S,h.UASTC_4x4],transcoderFormat:[a.ETC1],engineFormat:[s.RGB_ETC1_Format],priorityETC1S:2,priorityUASTC:4,needsPowerOfTwo:!1},{if:"pvrtcSupported",basisFormat:[h.ETC1S,h.UASTC_4x4],transcoderFormat:[a.PVRTC1_4_RGB,a.PVRTC1_4_RGBA],engineFormat:[s.RGB_PVRTC_4BPPV1_Format,s.RGBA_PVRTC_4BPPV1_Format],priorityETC1S:5,priorityUASTC:6,needsPowerOfTwo:!0}],_=d.sort(function(it,lt){return it.priorityETC1S-lt.priorityETC1S}),et=d.sort(function(it,lt){return it.priorityUASTC-lt.priorityUASTC});function nt(it){return it<=2||(it&it-1)==0&&it!==0}};const UT={109:b.wk1,97:b.wk1,37:b.wk1,43:b.wk1,103:b.av9,83:b.av9,16:b.av9,22:b.av9,100:b.hEm,76:b.hEm,15:b.hEm,9:b.hEm},bE={109:b.VzW,97:b.cLu,37:b.ywz,43:b.ywz,103:b.VzW,83:b.cLu,16:b.ywz,22:b.ywz,100:b.VzW,76:b.cLu,15:b.ywz,9:b.ywz},FT={43:b.knz,22:b.knz,15:b.knz},EE="KHR_texture_basisu";class SE extends ot{constructor(){super(...arguments),this.dependencies=[qr]}async onAdded(e){var i,s,a,h;this._importer||(this._importer=new Wo(class extends av{constructor(d){super(d),this.setTranscoderPath("https://cdn.jsdelivr.net/gh/BinomialLLC/basis_universal@master/webgl/transcoder/build/").detectSupport(e.renderer.rendererObject)}async createTexture(d,_){const et=d.map(it=>new Uint8Array(it.slice(0))),nt=await super.createTexture(d,_);return nt.source._sourceImgBuffer=et,nt.userData.mimeType="image/ktx2",nt}},["ktx2"],!1)),io.Importers.push(this._importer),(h=(a=(s=(i=e.getManager())===null||i===void 0?void 0:i.exporter)===null||s===void 0?void 0:s.getExporter("gltf","glb"))===null||a===void 0?void 0:a.extensions)===null||h===void 0||h.push(CE)}async onDispose(e){this._importer=void 0}async onRemove(e){this._importer&&io.Importers.splice(io.Importers.indexOf(this._importer),1),this._importer=void 0}}SE.PluginType="KTX2LoadPlugin";const CE=c=>({writeTexture:(e,i)=>{if(e.userData.mimeType!=="image/ktx2")return;if(i.source!==void 0)return void console.warn("ktx2 export: source already set");const s=e.source._sourceImgBuffer;if(!s||!s.length)return void console.warn("ktx2 export: no source buffer for ktx2");i.extensions=i.extensions||{};const a={},h=new Blob(Array.isArray(s)?s:[s],{type:"image/ktx2"});a.source=c.processImageBlob(h,e),i.extensions[EE]=a,c.extensionsUsed[EE]=!0}});class JA{constructor(e){this.presets=[],this.name="",this.selected=void 0,e&&(this.name=e)}async apply(e,i,s){var a,h;if(!i)return void(this.selected=void 0);let d=this.presets.find(_=>_.path===i.path);return d||(this.presets.push(i),d=i),this.selected=d,(h=(a=e.getManager())===null||a===void 0?void 0:a.importer)===null||h===void 0?void 0:h.importAsset(d,s)}}class kC extends JA{constructor(){super(...arguments),this.name="Background"}async apply(e,i){const s=await super.apply(e,i),a=s==null?void 0:s[0];return a&&(a.encoding=b.knz,await e.setBackground(a)),a}}class jT extends JA{constructor(){super(...arguments),this.name="Environment"}async apply(e,i){const s=await super.apply(e,i),a=s==null?void 0:s[0];return a&&await e.scene.setEnvironment(a),a}}class zT extends JA{constructor(){super(...arguments),this.name="GemEnvironment"}async apply(e,i){const s=await super.apply(e,i),a=s==null?void 0:s[0];return bn(e.getPluginByType("Diamond"),"envMap",a),a}}class ME extends JA{async apply(e,i){var s,a;const h=await super.apply(e,i,{processImported:!1});return h?(a=(s=e.getManager())===null||s===void 0?void 0:s.importer)===null||a===void 0?void 0:a.processImported(h):void 0}}class bD extends ME{constructor(){super(...arguments),this.name="MaterialLibraries"}async apply(e,i){const s=await super.apply(e,i);return s&&await e.alert("Material Library successfully imported."),s}}class ZA extends Ls{constructor(){super(...arguments),this.toJSON=null,this.enabled=!0,this.presetGroups=[],this.uiConfig={type:"folder",label:"Presets",expanded:!0,limitedUi:!0,children:[()=>this.presetGroups.map(e=>({type:"dropdown",label:e.name,limitedUi:!0,children:[{value:"",label:"none"},...e.presets.map(i=>({label:i.path.split("/").pop(),value:i.path}))],getValue:()=>{var i;return((i=e.selected)===null||i===void 0?void 0:i.path)||""},setValue:i=>{e.apply(this._viewer,e.presets.find(s=>s.path===i))}})),{type:"button",label:"Download Selection",limitedUi:!0,value:()=>{const e=this.exportPresets();Nm(new File([JSON.stringify(e,null,2)],"preset.template.json",{type:"application/json"}))}},{type:"button",label:"Export Preset Groups",hidden:!0,limitedUi:!1,value:()=>{const e=this.exportPresetGroups();Nm(new File([JSON.stringify(e,null,2)],"presetGroups.json",{type:"application/json"}))}}]}}async onAdded(e){var i,s;await super.onAdded(e),this.presetGroups.push(new kC),this.presetGroups.push(new jT),this.presetGroups.push(new zT),this.presetGroups.push(new ME("Ground")),this.presetGroups.push(new ME("CameraViews")),this.presetGroups.push(new ME("MaterialConfiguration")),this.presetGroups.push(new bD),(s=(i=this.uiConfig).uiRefresh)===null||s===void 0||s.call(i,"postFrame",!0)}exportPresets(){const e=Object.fromEntries(this.presetGroups.map(i=>{var s;return[i.name,((s=i.selected)===null||s===void 0?void 0:s.path)||void 0]}).filter(([,i])=>i));return e.type=ZA.PluginType,e}async fromJSON(e,i){var s,a;if(!super.fromJSON(e,i))return null;const h={...e};delete h.type;const d=[];for(const[_,et]of Object.entries(h)){const nt=this.presetGroups.find(ut=>ut.name===_),it=nt==null?void 0:nt.presets;if(!nt||!it)continue;const lt=typeof et=="string"?{path:et}:et;d.push(nt.apply(this._viewer,lt))}return await Promise.all(d),(a=(s=this.uiConfig).uiRefresh)===null||a===void 0||a.call(s,"postFrame",!0),this}loadPresetGroups(e){var i;for(const[s,a]of Object.entries(e)){const h=(i=this.presetGroups.find(d=>d.name===s))===null||i===void 0?void 0:i.presets;h==null||h.push(...a)}}exportPresetGroups(){return Object.fromEntries(this.presetGroups.map(e=>[e.name,e.presets.map(i=>i.path)]).filter(([,e])=>e.length>0))}}ZA.PluginType="PresetLibraryPlugin";var B0=function(c,e,i,s){var a,h=arguments.length,d=h<3?e:s===null?s=Object.getOwnPropertyDescriptor(e,i):s;if(typeof Reflect=="object"&&typeof Reflect.decorate=="function")d=Reflect.decorate(c,e,i,s);else for(var _=c.length-1;_>=0;_--)(a=c[_])&&(d=(h<3?a(d):h>3?a(e,i,d):a(e,i))||d);return h>3&&d&&Object.defineProperty(e,i,d),d};let Yp=class extends Ls{constructor(){super(),this.enabled=!0,this.dependencies=[qr],this.scenes=[],this.assets={},this.toJSON=void 0,this._isPlaying=!1,this._isPlayingLoop=!1,this._options={},this.minSceneTime=2e3,this.loadScenes=this.loadScenes.bind(this),this.play=this.play.bind(this),this.stop=this.stop.bind(this),this.downloadScenes=this.downloadScenes.bind(this),this.promptLoadScenes=this.promptLoadScenes.bind(this)}get loadedScenes(){return this.scenes.length}async promptLoadScenes(){const c=await Yl(!0,!1,"model/gltf");await this.loadScenes(c)}async loadScenes(c){var e,i;const s=await Promise.all(c.map(async a=>await a.arrayBuffer()));for(let a=0;a<c.length;a++){const h=c[a];this.scenes.push({[h.name]:new Uint8Array(s[a])}),this.assets[h.name]={path:h.name,file:h}}(i=(e=this.uiConfig)===null||e===void 0?void 0:e.uiRefresh)===null||i===void 0||i.call(e)}async play(){var c;if(!this._viewer||this._isPlaying||this._isPlayingLoop)return;this._isPlaying=!0,this._isPlayingLoop=!0;const e=this._viewer.getPluginByType("AssetManagerBasicPopupPlugin");e==null||e.enabled,e&&(e.enabled=!1);const i=this._viewer.getPluginByType("FrameFade"),s=this._viewer.getPluginByType("GLTFAnimation"),a=this._viewer.getPluginByType("CameraViews");for(;this._isPlaying;)for(const h of this.scenes){if(!this._isPlaying)break;const d=Object.keys(h);s==null||s.stopAnimation(!1),await(a==null?void 0:a.stopAllAnimations()),this._viewer.scene.removeSceneModels(),this._viewer.renderEnabled=!1;for(const et of d){let nt=this.assets[et];nt||(nt={path:et,file:new File([h[et]],et)},this.assets[et]=nt),await((c=this._viewer.getManager())===null||c===void 0?void 0:c.addAssetSingle(nt,this._options))}if(!this._isPlaying)break;this._viewer.renderEnabled=!0,e&&(e.enabled=!1),i&&(i.enabled=!0,await i.startTransition(1e3));const _=[Vl(this.minSceneTime)];s&&_.push(s.playAnimation()),a&&_.push(a.animateAllViews()),await Promise.all(_)}this._isPlayingLoop=!1}stop(){this._isPlaying=!1}async downloadScenes(){const c={};for(const i of this.scenes)for(const s of Object.keys(i)){const a=c[s]?s+"_":s;c[a]=i[a]}const e=jS(c);Do(new Blob([e],{type:"application/zip"}),"scenes.glbloop")}async onAdded(c){await super.onAdded(c);const e=this;io.Importers.push(new Wo(class extends Xw{load(i,s,a,h){super.load(i,d=>{e.loadScenes([...d.values()]),s==null||s(null),Vl(100).then(e.play)},a,h)}},["glbloop"],!0))}};Yp.PluginType="SceneLoopPlugin",B0([r0("Loaded scenes")],Yp.prototype,"loadedScenes",null),B0([uo("Load Scenes")],Yp.prototype,"promptLoadScenes",null),B0([r0("Playing")],Yp.prototype,"_isPlaying",void 0),B0([qs("Min Scene Time")],Yp.prototype,"minSceneTime",void 0),B0([uo("Play")],Yp.prototype,"play",null),B0([uo("Stop")],Yp.prototype,"stop",null),B0([uo("Download Scenes")],Yp.prototype,"downloadScenes",null),Yp=B0([Ys("Scene Loop")],Yp);var TE=__webpackgi_require__(701),sw=__webpackgi_require__.n(TE),ED=__webpackgi_require__(236),IE=__webpackgi_require__.n(ED),SD=__webpackgi_require__(850),Rx=__webpackgi_require__.n(SD),VT=__webpackgi_require__(182),Yv=__webpackgi_require__.n(VT),CD=__webpackgi_require__(213),Bx=__webpackgi_require__.n(CD),kx=__webpackgi_require__(798),lv={};kx.Z&&kx.Z.locals&&(lv.locals=kx.Z.locals);var DE,OC=0,Xp={};Xp.styleTagTransform=Bx(),Xp.setAttributes=Rx(),Xp.insert=function(c,e){(e.target||document.head).appendChild(c)},Xp.domAPI=IE(),Xp.insertStyleElement=Yv(),lv.use=function(c){return Xp.options=c||{},OC++||(DE=sw()(kx.Z,Xp)),lv},lv.unuse=function(){OC>0&&!--OC&&(DE(),DE=null)};var MD=lv;class ow extends Ls{constructor(e){super(),this.enabled=!0,this.dependencies=[qr],this._mainDiv=rp({id:"assetManager"+e,addToBody:!1,innerHTML:""}),this._contentDiv=rp({id:"assetManager"+e+"Content",addToBody:!1,innerHTML:""}),this.enabled||(this._mainDiv.style.display="none"),this._mainDiv.appendChild(this._contentDiv)}_onEnabledChange(){this.enabled||(this._mainDiv.style.display="none")}async onAdded(e){var i,s,a,h;await super.onAdded(e),e.container.appendChild(this._mainDiv);const d=new Map;(s=(i=e.getManager())===null||i===void 0?void 0:i.importer)===null||s===void 0||s.addEventListener("importFile",_=>{_.state!=="done"?d.set(_.path,{state:_.state,progress:_.progress?100*_.progress:void 0}):d.delete(_.path),this._updateMainDiv(d)}),(h=(a=e.getManager())===null||a===void 0?void 0:a.exporter)===null||h===void 0||h.addEventListener("exportFile",_=>{_.state!=="done"?d.set(_.obj.name,{state:_.state,progress:_.progress?100*_.progress:void 0}):d.delete(_.obj.name),this._updateMainDiv(d)})}}(function(c,e,i,s){var a,h=arguments.length,d=h<3?e:s===null?s=Object.getOwnPropertyDescriptor(e,i):s;if(typeof Reflect=="object"&&typeof Reflect.decorate=="function")d=Reflect.decorate(c,e,i,s);else for(var _=c.length-1;_>=0;_--)(a=c[_])&&(d=(h<3?a(d):h>3?a(e,i,d):a(e,i))||d);h>3&&d&&Object.defineProperty(e,i,d)})([ts("Enabled"),pn(ow.prototype._onEnabledChange),Fn()],ow.prototype,"enabled",void 0);let Kp=class extends ow{constructor(){super("Popup");const c=rp({id:"assetManagerPopupClose",addToBody:!1,innerHTML:"&#10005"});c.addEventListener("click",()=>{this._mainDiv.style.display="none"}),this._mainDiv.appendChild(c)}_updateMainDiv(c){if(!this._contentDiv)return;if(!this.enabled)return void(this._mainDiv.style.display="none");let e="";c.forEach((i,s)=>{e+=`<span class="processState">${i.state}</span>: ${s.split("/").pop()} ${i.progress?" - "+i.progress.toFixed(0)+"%":""}<br>`}),this._contentDiv.innerHTML=e,c.size===0?this._mainDiv.style.display="none":this._mainDiv.style.display="block"}async onAdded(c){MD.use({target:c.container}),await super.onAdded(c)}};Kp.PluginType="AssetManagerBasicPopupPlugin",Kp=function(c,e,i,s){var a,h=arguments.length,d=h<3?e:s===null?s=Object.getOwnPropertyDescriptor(e,i):s;if(typeof Reflect=="object"&&typeof Reflect.decorate=="function")d=Reflect.decorate(c,e,i,s);else for(var _=c.length-1;_>=0;_--)(a=c[_])&&(d=(h<3?a(d):h>3?a(e,i,d):a(e,i))||d);return h>3&&d&&Object.defineProperty(e,i,d),d}([Ys("Asset manager popup")],Kp);class QT extends Tl{constructor(e){super({vertexShader:yt.vertexShader,uniforms:{tDiffuse:{value:null}},defines:{},fragmentShader:`
                varying vec2 vUv;
                ${e[0]}
                void main() {
                    gl_FragColor = tDiffuseTexelToLinear (texture2D(tDiffuse, vUv));
                    #glMarker
                    ${e[1]}
                }
                `},"tDiffuse"),this.uiConfig=void 0,this.customMaterial=new l0}render(e,i,s,a,h){super.render(e,i,s,a,h),this.needsSwap=!0}}class cv extends Am{constructor(e=!0,i=!0){super(),this.depthTonemap=e,this.passId="combinedPost",this.dependencies=[ho],this.toJSON=void 0,this._beforeFilters=[],this._afterFilters=["render"],this._requiredFilters=["render"],this._renderToScreen=!0,this._setDirty=this._setDirty.bind(this),this._renderToScreen=i}get renderToScreen(){return this._renderToScreen}async onAdded(e){var i,s;return!((s=(i=this._viewer)===null||i===void 0?void 0:i.screenShader)===null||s===void 0)&&s.isShaderPass2&&(this._renderToScreen=!1),this._renderToScreen&&bn(e.renderer.passes.find(a=>a.passId==="screen"),"enabled",!1,!0,!0),super.onAdded(e)}passCtor(e){var i,s,a,h;const d=e.screenShader,_=["",""];this._renderToScreen&&!d.isShaderPass2&&(_[0]=Array.isArray(d)?d[0]:((i=d)===null||i===void 0?void 0:i.pars)||"",_[1]=Array.isArray(d)?d[1]:typeof d=="string"?d:((s=d)===null||s===void 0?void 0:s.main)||"");const et=new QT(_);return bn((h=(a=et.uiConfig)===null||a===void 0?void 0:a.children)===null||h===void 0?void 0:h.find(nt=>{var it;return((it=nt)===null||it===void 0?void 0:it.label)==="Enabled"}),"hidden",!0,!0),et}_update(e){var i;return!!super._update(e)&&(this._pass.passObject.updateShaderProperties((i=this._viewer)===null||i===void 0?void 0:i.getPlugin(ho)),!0)}_setDirty(){this.pass&&(this.pass.dirty=!0)}get uiConfig(){var e,i,s;return(s=(i=(e=this.pass)===null||e===void 0?void 0:e.passObject)===null||i===void 0?void 0:i.uiConfig)!==null&&s!==void 0?s:{}}addExtension(e){this.pass.passObject.material.registerMaterialExtensions([e])}}cv.PluginType="CombinedPostPlugin";var I_=function(c,e,i,s){var a,h=arguments.length,d=h<3?e:s===null?s=Object.getOwnPropertyDescriptor(e,i):s;if(typeof Reflect=="object"&&typeof Reflect.decorate=="function")d=Reflect.decorate(c,e,i,s);else for(var _=c.length-1;_>=0;_--)(a=c[_])&&(d=(h<3?a(d):h>3?a(e,i,d):a(e,i))||d);return h>3&&d&&Object.defineProperty(e,i,d),d};class k0 extends Ls{constructor(){super(...arguments),this.enabled=!0,this.dependencies=[cv]}get uiConfig(){var e;return(e=this._extension)===null||e===void 0?void 0:e.uiConfig}get config(){return this._extension}disposeExtension(){}async onAdded(e){var i;await super.onAdded(e),this._extension=this.generateExtension(e),(i=e.getPlugin(cv))===null||i===void 0||i.addExtension(this._extension)}async onRemove(e){this.disposeExtension(),this._extension=void 0,await super.onRemove(e)}}I_([Fn("extension")],k0.prototype,"_extension",void 0),I_([Fn()],k0.prototype,"enabled",void 0);class GT{constructor(){this.uiConfig=void 0,this.enabled=!0}shaderExtender(e,i,s){this.enabled&&(e.fragmentShader=Ho(e.fragmentShader,"#glMarker",` 
            gl_FragColor = LinearTosRGB(gl_FragColor);
            #glMarker
        `))}computeCacheKey(e){return this.enabled?"1":"0"}isCompatible(e){return!0}}class PE extends k0{generateExtension(e){return new GT}}function Ox(c,e,i){return c&~(1<<e)|(i?1:0)<<e}function RE(c,e){return c&~(1<<e)}PE.PluginType="GammaCorrection";var aw,Lx=function(c,e,i,s){var a,h=arguments.length,d=h<3?e:s===null?s=Object.getOwnPropertyDescriptor(e,i):s;if(typeof Reflect=="object"&&typeof Reflect.decorate=="function")d=Reflect.decorate(c,e,i,s);else for(var _=c.length-1;_>=0;_--)(a=c[_])&&(d=(h<3?a(d):h>3?a(e,i,d):a(e,i))||d);return h>3&&d&&Object.defineProperty(e,i,d),d};const HT=b.dZ3;let Xs=aw=class{constructor(c,e=!0,i=!0){this.depthTonemap=e,this.toneMapping=b.LY2,this.tonemapBackground=!0,this.clipBackground=!1,this.exposure=1,this._renderToScreen=!0,this.enabled=!0,this._rendererState={},this.extraUniforms={tNormalDepth:{value:null},tGBufferFlags:{value:null},opacity:{value:1}},this.parsFragmentSnippet=(s,a)=>this.enabled?Qt`
            ${this.depthTonemap?Fp:""}
            #define USE_DEPTH_TONEMAP ${this.depthTonemap?"1":"0"}
            uniform float opacity;
            ${`float getToneMapBit(in float number){return mod(floor(number/pow(2.,1.)),2.);}vec4 ToneMapping(in vec4 color){vec4 outColor=opacity*color;
#if USE_DEPTH_TONEMAP > 0
bool doTonemap=getToneMapBit(getGBufferFlags(vUv).a*255.)>0.5;float depth=getDepth(vUv);
#if TONEMAP_BACKGROUND < 1 || TRANSPARENT_BACKGROUND > 0
bool isBackground=depth>0.9999;if(isBackground)doTonemap=false;
#endif
if(doTonemap){
#endif
#if defined( TONE_MAPPING )
outColor.rgb=toneMapping(outColor.rgb);
#endif
#if USE_DEPTH_TONEMAP > 0
}else{
#if TRANSPARENT_BACKGROUND > 0
if(isBackground)outColor.a=0.;
#endif
}if(depth<0.00001)outColor.a=0.;
#endif
return outColor;}`}
        `:"",this._combinedPostPlugin=c.getPlugin(cv),this._setDirty=this._setDirty.bind(this),this._renderToScreen=i,this.depthTonemap=e}shaderExtender(c,e,i){this.enabled&&(c.fragmentShader=Ho(c.fragmentShader,"#glMarker",` 
            gl_FragColor = ToneMapping(gl_FragColor);
            #glMarker
        `))}onObjectRender(c,e,i){if(!this.enabled)return;const{toneMapping:s,toneMappingExposure:a,outputEncoding:h}=i;this._rendererState.toneMapping=s,this._rendererState.toneMappingExposure=a,this._rendererState.outputEncoding=h;let d=this.tonemapBackground?"1":"0";e.materialObject.defines.TONEMAP_BACKGROUND!==d&&(e.materialObject.defines.TONEMAP_BACKGROUND=d,e.materialObject.needsUpdate=!0),d=this.clipBackground?"1":"0",e.materialObject.defines.TRANSPARENT_BACKGROUND!==d&&(e.materialObject.defines.TRANSPARENT_BACKGROUND=d,e.materialObject.needsUpdate=!0),i.toneMapping=this.toneMapping,i.toneMappingExposure=this.exposure,i.outputEncoding=b.knz,e.materialObject.toneMapped=!0,e.materialObject.needsUpdate=!0}onAfterRender(c,e,i){i.toneMapping=this._rendererState.toneMapping,i.toneMappingExposure=this._rendererState.toneMappingExposure,i.outputEncoding=this._rendererState.outputEncoding}getUiConfig(){return this.uiConfig}computeCacheKey(c){return this.enabled?"1":"0"}isCompatible(c){return!0}_setDirty(){this._combinedPostPlugin&&(this._combinedPostPlugin.pass.dirty=!0)}setDirty(){var c;(c=this.__setDirty)===null||c===void 0||c.call(this),this._setDirty()}};Xs.PluginType="Tonemap",Lx([xv("Mode",[["Linear",b.EoG],["Reinhard",b.CdI],["Cineon",b.YGz],["ACESFilmic",b.LY2],["Uncharted2",HT]].map(c=>({label:c[0],value:c[1]})),{limitedUi:!0}),pn(aw.prototype._setDirty),Fn()],Xs.prototype,"toneMapping",void 0),Lx([pn(aw.prototype._setDirty),ts("Tonemap Background",{limitedUi:!0}),Fn()],Xs.prototype,"tonemapBackground",void 0),Lx([pn(aw.prototype._setDirty),ts("Clip Background"),Fn()],Xs.prototype,"clipBackground",void 0),Lx([pn(aw.prototype._setDirty),ss("Exposure",[0,2*Math.PI],.01,{limitedUi:!0}),Fn()],Xs.prototype,"exposure",void 0),Xs=aw=Lx([Ys("Tonemapping")],Xs);class BE extends k0{constructor(e=!0){super(),this.depthTonemap=e,this.depthTonemap=e,this.updateGBuffer=this.updateGBuffer.bind(this)}fromJSON(e,i){return e.pass&&((e={...e}).extension={...e.pass},delete e.extension.enabled,delete e.pass),super.fromJSON(e,i)}async onAdded(e){var i;await super.onAdded(e),(i=e.getPlugin(ho))===null||i===void 0||i.registerGBufferUpdater(this.updateGBuffer)}generateExtension(e){return new Xs(e,this.depthTonemap)}get exposure(){var e,i;return(i=(e=this._extension)===null||e===void 0?void 0:e.exposure)!==null&&i!==void 0?i:1}set exposure(e){this._extension&&(this._extension.exposure=e,this._extension.setDirty())}get toneMapping(){var e,i;return(i=(e=this._extension)===null||e===void 0?void 0:e.toneMapping)!==null&&i!==void 0?i:b.EoG}set toneMapping(e){this._extension&&(this._extension.toneMapping=e,this._extension.setDirty())}updateGBuffer(e,i){var s,a;if(e instanceof b.Kj0&&(!((s=e.material)===null||s===void 0)&&s.userData)){const h=((a=e.material)===null||a===void 0?void 0:a.userData.postTonemap)===!1?0:1;i.w=Ox(i.w,1,h)}}}BE.PluginType="Tonemap",b.WdD.tonemapping_pars_fragment=b.WdD.tonemapping_pars_fragment.replace("vec3 CustomToneMapping( vec3 color ) { return color; }",`

// source: http://filmicworlds.com/blog/filmic-tonemapping-operators/
#define Uncharted2Helper( x ) max( ( ( x * ( 0.15 * x + 0.10 * 0.50 ) + 0.20 * 0.02 ) / ( x * ( 0.15 * x + 0.50 ) + 0.20 * 0.30 ) ) - 0.02 / 0.30, vec3( 0.0 ) )
vec3 Uncharted2ToneMapping( vec3 color ) {

	// John Hable's filmic operator from Uncharted 2 video game
	color *= toneMappingExposure;
	return saturate( Uncharted2Helper( color ) / Uncharted2Helper( vec3( 1.0 ) ) );

}

vec3 CustomToneMapping( vec3 color ) { return Uncharted2ToneMapping( color ); }

`);var D_,$A=function(c,e,i,s){var a,h=arguments.length,d=h<3?e:s===null?s=Object.getOwnPropertyDescriptor(e,i):s;if(typeof Reflect=="object"&&typeof Reflect.decorate=="function")d=Reflect.decorate(c,e,i,s);else for(var _=c.length-1;_>=0;_--)(a=c[_])&&(d=(h<3?a(d):h>3?a(e,i,d):a(e,i))||d);return h>3&&d&&Object.defineProperty(e,i,d),d};let O0=D_=class{constructor(c){this.enabled=!1,this.lutBackground=!0,this.intensity=1,this.lutMap=void 0,this.lutMap1=void 0,this.lutMap2=void 0,this.extraUniforms={intensity:{value:1},lutSize:{value:1},lutSize1:{value:1},lutSize2:{value:1}},this.parsFragmentSnippet=(e,i)=>this.enabled?`#if USE_LUT == 1
uniform float lutSize;uniform float lutSize1;uniform float lutSize2;uniform float intensity;
#if USE_3DTEXTURE == 1
precision highp sampler3D;uniform sampler3D lut3d;
#if USE_LUT1 == 1
uniform sampler3D lut3d1;
#endif
#if USE_LUT2 == 1
uniform sampler3D lut3d2;
#endif
#else
uniform sampler2D lut;vec3 lutLookup(sampler2D tex,float size,vec3 rgb){float sliceHeight=1./size;float yPixelHeight=1./(size*size);float slice=rgb.b*size;float interp=fract(slice);float slice0=slice-interp;float centeredInterp=interp-0.5;float slice1=slice0+sign(centeredInterp);float greenOffset=clamp(rgb.g*sliceHeight,yPixelHeight*0.5,sliceHeight-yPixelHeight*0.5);vec2 uv0=vec2(rgb.r,slice0*sliceHeight+greenOffset);vec2 uv1=vec2(rgb.r,slice1*sliceHeight+greenOffset);vec3 sample0=texture2D(tex,uv0).rgb;vec3 sample1=texture2D(tex,uv1).rgb;return mix(sample0,sample1,abs(centeredInterp));}
#endif
float getLUTBit(in float number){return mod(number,2.);}float getLUTIndex(in float number){return mod(number,8.);}vec3 getUVW(in float lutSize,in vec4 color){float pixelWidth=1./lutSize;float halfPixelWidth=0.5/lutSize;vec3 uvw=vec3(halfPixelWidth)+color.rgb*(1.-pixelWidth);return uvw;}vec4 colorLookUp(in vec4 color){vec4 outColor;float lutFac=step(0.0001,getLUTBit(getGBufferFlags(vUv).a*255.));
#if USE_3DTEXTURE == 1
float lutIndex=getLUTIndex(getGBufferFlags(vUv).g*255.);if(lutIndex==0.){outColor=vec4(texture(lut3d,getUVW(lutSize,color)).rgb,color.a);}else if(lutIndex==1.){
#if USE_LUT1 == 1
outColor=vec4(texture(lut3d1,getUVW(lutSize1,color)).rgb,color.a);
#endif
}else if(lutIndex==2.){
#if USE_LUT2 == 1
outColor=vec4(texture(lut3d2,getUVW(lutSize2,color)).rgb,color.a);
#endif
}else{outColor=vec4(texture(lut3d,getUVW(lutSize,color)).rgb,color.a);}
#else
outColor=vec4(lutLookup(lut,lutSize,getUVW(lutSize,color)),color.a);
#endif
outColor=mix(color,outColor,lutFac);return vec4(mix(color,outColor,intensity));}
#endif
`:"",this._combinedPostPlugin=c.getPlugin(cv),this._setDirty=this._setDirty.bind(this)}shaderExtender(c,e,i){this.enabled&&(c.fragmentShader=Ho(c.fragmentShader,"#glMarker",` 
            #if USE_LUT == 1
                bool isBackground = getDepth(vUv)>0.9999;
                #if LUT_BACKGROUND == 1
                    gl_FragColor = colorLookUp(gl_FragColor);
                #else
                    gl_FragColor = isBackground ? gl_FragColor : colorLookUp(gl_FragColor);
                #endif
            #endif
            #glMarker
        `))}onObjectRender(c,e,i){if(this.enabled){if(this.lutMap){const s=this.lutMap.texture3D?1:0;e.materialObject.defines.USE_3DTEXTURE!==s&&(e.materialObject.defines.USE_3DTEXTURE=s,e.materialObject.needsUpdate=!0);let a=1;this.lutMap.texture3D?(e.materialObject.uniforms.lut3d={value:this.lutMap.texture3D},e.materialObject.uniforms.lut3d.value.needsUpdate=!0,a=this.lutMap.texture3D.image.width):this.lutMap.texture&&(e.materialObject.uniforms.lut={value:this.lutMap.texture},e.materialObject.uniforms.lut.value.needsUpdate=!0,a=this.lutMap.texture.image.width),e.materialObject.uniforms.lutSize.value=a,e.materialObject.uniforms.intensity.value=this.intensity,e.materialObject.defines.USE_LUT=1,e.materialObject.defines.LUT_BACKGROUND=this.lutBackground?1:0}else e.materialObject.defines.USE_3DTEXTURE=0,e.materialObject.defines.USE_LUT=0,e.materialObject.needsUpdate=!0;if(this.lutMap1&&this.lutMap1.texture3D){e.materialObject.uniforms.lut3d1={value:this.lutMap1.texture3D},e.materialObject.uniforms.lut3d1.value.needsUpdate=!0;const s=this.lutMap1.texture3D.image.width;e.materialObject.uniforms.lutSize1.value=s,e.materialObject.defines.USE_LUT1=1,e.materialObject.needsUpdate=!0}else e.materialObject.defines.USE_LUT1=0,e.materialObject.needsUpdate=!0;if(this.lutMap2&&this.lutMap2.texture3D){e.materialObject.uniforms.lut3d2={value:this.lutMap2.texture3D},e.materialObject.uniforms.lut3d2.value.needsUpdate=!0;const s=this.lutMap2.texture3D.image.width;e.materialObject.uniforms.lutSize2.value=s,e.materialObject.defines.USE_LUT2=1,e.materialObject.needsUpdate=!0}else e.materialObject.defines.USE_LUT2=0,e.materialObject.needsUpdate=!0}}getUiConfig(c){const e={type:"folder",label:"LUT",children:[{type:"checkbox",label:"Enabled",get value(){var i,s;return(s=(i=c.materialObject.userData[Ou.PluginType])===null||i===void 0?void 0:i.enable)===null||s===void 0||s},set value(i){var s;const a=c.materialObject.userData[Ou.PluginType];i!==(a==null?void 0:a.enable)&&(a||Nx(c.materialObject),c.materialObject.userData[Ou.PluginType].enable=i,(s=e.uiRefresh)===null||s===void 0||s.call(e,"postFrame",!0))},onChange:this.setDirty},()=>({type:"dropdown",children:[["LUT 0",0],["LUT 1",1],["LUT 2",2]].map(i=>({label:i[0],value:i[1]})),label:"index",hidden:()=>{const i=c.materialObject.userData[Ou.PluginType];return!!i&&!i.enable},get value(){var i,s;return(s=(i=c.materialObject.userData[Ou.PluginType])===null||i===void 0?void 0:i.index)!==null&&s!==void 0?s:0},set value(i){var s;c.materialObject.userData[Ou.PluginType]||Nx(c.materialObject),c.materialObject.userData[Ou.PluginType].index=i,(s=e.uiRefresh)===null||s===void 0||s.call(e,"postFrame",!0)},onChange:this.setDirty()})]};return e}computeCacheKey(c){return this.enabled?"1":"0"}isCompatible(c){return!0}_setDirty(){this._combinedPostPlugin&&(this._combinedPostPlugin.pass.dirty=!0)}setDirty(){var c;(c=this.__setDirty)===null||c===void 0||c.call(this),this._setDirty()}};function Nx(c){const e=c==null?void 0:c.userData;if(!e)return!1;e[Ou.PluginType]||(e[Ou.PluginType]={});const i=e[Ou.PluginType];return i.enable=!0,i.index===void 0&&(i.index=0),c.isMaterial&&(c.needsUpdate=!0),!0}$A([Fn(),pn(D_.prototype._setDirty),ts("Enable")],O0.prototype,"enabled",void 0),$A([Fn(),pn(D_.prototype._setDirty),ts("LUT Background")],O0.prototype,"lutBackground",void 0),$A([Fn(),pn(D_.prototype._setDirty),ss("Intensity")],O0.prototype,"intensity",void 0),$A([pn(D_.prototype._setDirty),s0("LUT"),Fn()],O0.prototype,"lutMap",void 0),$A([pn(D_.prototype._setDirty),s0("LUT1"),Fn()],O0.prototype,"lutMap1",void 0),$A([pn(D_.prototype._setDirty),s0("LUT2"),Fn()],O0.prototype,"lutMap2",void 0),O0=D_=$A([Ys("LUT")],O0);class Ou extends k0{constructor(){super(),this.materialExtension={getUiConfig:e=>{var i;return(i=this._extension)===null||i===void 0?void 0:i.getUiConfig(e)},computeCacheKey:e=>{var i;return(this.enabled?"1":"0")+(!((i=e.materialObject.userData[Ou.PluginType])===null||i===void 0)&&i.enable?"1":"0")},isCompatible:e=>!0},this.updateGBuffer=this.updateGBuffer.bind(this)}async onAdded(e){var i,s;await super.onAdded(e),(i=e.getPlugin(ho))===null||i===void 0||i.registerGBufferUpdater(this.updateGBuffer);const a=e.getPlugin(qr);(s=a==null?void 0:a.materials)===null||s===void 0||s.registerMaterialExtension(this.materialExtension)}generateExtension(e){return new O0(e)}updateGBuffer(e,i){var s,a;if(e instanceof b.Kj0&&(!((s=e.material)===null||s===void 0)&&s.userData)){const h=(a=e.material)===null||a===void 0?void 0:a.userData[Ou.PluginType];if(h){const d=h.enable===!1?0:1;i.w=Ox(i.w,0,d);for(let et=0;et<3;et++)i.y=RE(i.y,et);let _=h.enable?h.index:0;_=Math.min(_,7),i.y=i.y|_}else i.w=Ox(i.w,0,1)}}}Ou.PluginType="LUTPlugin1";var Ux,kE=function(c,e,i,s){var a,h=arguments.length,d=h<3?e:s===null?s=Object.getOwnPropertyDescriptor(e,i):s;if(typeof Reflect=="object"&&typeof Reflect.decorate=="function")d=Reflect.decorate(c,e,i,s);else for(var _=c.length-1;_>=0;_--)(a=c[_])&&(d=(h<3?a(d):h>3?a(e,i,d):a(e,i))||d);return h>3&&d&&Object.defineProperty(e,i,d),d};let ey=Ux=class{constructor(c){this.enabled=!1,this.power=.5,this.bgcolor=new b.Ilk(0),this.extraUniforms={power:{value:1},bgcolor:{value:new b.Ilk}},this.parsFragmentSnippet=(e,i)=>this.enabled?Qt`
            uniform float power;
            uniform vec3 bgcolor;
            ${"vec4 Vignette(in vec4 color){vec2 uv=vUv*(1.-vUv);float vig=uv.x*uv.y*16.;vig=pow(vig,power);return vec4(mix(color.rgb,vec3(bgcolor),1.-vig),color.a);}"}
        `:"",this._combinedPostPlugin=c.getPlugin(cv),this._setDirty=this._setDirty.bind(this)}shaderExtender(c,e,i){this.enabled&&(c.fragmentShader=Ho(c.fragmentShader,"#glMarker",` 
            gl_FragColor = Vignette(gl_FragColor);
            #glMarker
        `))}onObjectRender(c,e,i){this.enabled&&(e.materialObject.uniforms.power.value=this.power,e.materialObject.uniforms.bgcolor.value.copy(this.bgcolor))}getUiConfig(){return this.uiConfig}computeCacheKey(c){return this.enabled?"1":"0"}isCompatible(c){return!0}_setDirty(){this._combinedPostPlugin&&(this._combinedPostPlugin.pass.dirty=!0)}setDirty(){var c;(c=this.__setDirty)===null||c===void 0||c.call(this),this._setDirty()}};ey.PluginType="Vignette",kE([pn(Ux.prototype._setDirty),ts("Enable"),Fn()],ey.prototype,"enabled",void 0),kE([pn(Ux.prototype._setDirty),ss("Power",[.1,4],.01,{limitedUi:!0}),Fn()],ey.prototype,"power",void 0),kE([pn(Ux.prototype._setDirty),cm("Color"),Fn()],ey.prototype,"bgcolor",void 0),ey=Ux=kE([Ys("Vignette")],ey);class OE extends k0{constructor(){super()}generateExtension(e){return new ey(e)}get power(){var e,i;return(i=(e=this._extension)===null||e===void 0?void 0:e.power)!==null&&i!==void 0?i:1}set power(e){this._extension&&(this._extension.power=e,this._extension.setDirty())}get color(){var e,i;return(i=(e=this._extension)===null||e===void 0?void 0:e.bgcolor)!==null&&i!==void 0?i:new b.Ilk}set color(e){this._extension&&(this._extension.bgcolor.copy(e),this._extension.setDirty())}}OE.PluginType="Vignette";var Fx,jx=function(c,e,i,s){var a,h=arguments.length,d=h<3?e:s===null?s=Object.getOwnPropertyDescriptor(e,i):s;if(typeof Reflect=="object"&&typeof Reflect.decorate=="function")d=Reflect.decorate(c,e,i,s);else for(var _=c.length-1;_>=0;_--)(a=c[_])&&(d=(h<3?a(d):h>3?a(e,i,d):a(e,i))||d);return h>3&&d&&Object.defineProperty(e,i,d),d};let lw=Fx=class{constructor(c){this.enabled=!1,this.aberrationIntensity=.01,this.extraUniforms={aberrationIntensity:{value:1}},this.parsFragmentSnippet=(e,i)=>this.enabled?Qt`
            uniform float aberrationIntensity;
            ${"vec4 chromaticAberration(){vec2 distFromCenter=vUv-0.5;vec2 aberrated=aberrationIntensity*pow(distFromCenter,vec2(2.));vec4 color=tDiffuseTexelToLinear(texture2D(tDiffuse,vUv));vec4 outColor=vec4(tDiffuseTexelToLinear(texture2D(tDiffuse,vUv+aberrated)).r,color.g,tDiffuseTexelToLinear(texture2D(tDiffuse,vUv-aberrated)).b,color.a);return outColor;}"}
        `:"",this._combinedPostPlugin=c.getPlugin(cv),this._setDirty=this._setDirty.bind(this)}shaderExtender(c,e,i){this.enabled&&(c.fragmentShader=Ho(c.fragmentShader,"#glMarker",` 
            gl_FragColor = chromaticAberration();
            #glMarker
        `))}onObjectRender(c,e,i){this.enabled&&(e.materialObject.uniforms.aberrationIntensity.value=this.aberrationIntensity)}getUiConfig(){return this.uiConfig}computeCacheKey(c){return this.enabled?"1":"0"}isCompatible(c){return!0}_setDirty(){this._combinedPostPlugin&&(this._combinedPostPlugin.pass.dirty=!0)}setDirty(){var c;(c=this.__setDirty)===null||c===void 0||c.call(this),this._setDirty()}};lw.PluginType="ChromaticAberration",jx([pn(Fx.prototype._setDirty),ts("Enable"),Fn()],lw.prototype,"enabled",void 0),jx([pn(Fx.prototype._setDirty),ss("Intensity",[0,.1],.001,{limitedUi:!0}),Fn()],lw.prototype,"aberrationIntensity",void 0),lw=Fx=jx([Ys("ChromaticAberration")],lw);class LE extends k0{constructor(){super()}generateExtension(e){return new lw(e)}get intensity(){var e,i;return(i=(e=this._extension)===null||e===void 0?void 0:e.aberrationIntensity)!==null&&i!==void 0?i:1}set intensity(e){this._extension&&(this._extension.aberrationIntensity=e,this._extension.setDirty())}}LE.PluginType="ChromaticAberration";var cw,NE=function(c,e,i,s){var a,h=arguments.length,d=h<3?e:s===null?s=Object.getOwnPropertyDescriptor(e,i):s;if(typeof Reflect=="object"&&typeof Reflect.decorate=="function")d=Reflect.decorate(c,e,i,s);else for(var _=c.length-1;_>=0;_--)(a=c[_])&&(d=(h<3?a(d):h>3?a(e,i,d):a(e,i))||d);return h>3&&d&&Object.defineProperty(e,i,d),d};let ty=cw=class{constructor(c){this.enabled=!1,this.grainMultiply=!1,this.grainIntensity=10,this.extraUniforms={grainIntensity:{value:1},grainMultiply:{value:1}},this.parsFragmentSnippet=(e,i)=>this.enabled?Qt`
            uniform float grainIntensity;
            uniform bool grainMultiply;
            ${"vec4 grain(in vec4 color){float x=(vUv.x+4.)*(vUv.y+4.)*(10.);vec4 grain=vec4(mod((mod(x,13.)+1.)*(mod(x,123.)+1.),0.01)-0.005)*grainIntensity;vec4 outColor=color;if(grainMultiply){grain=1.-grain;outColor.rgb=color.rgb*vec3(grain);}else{outColor.rgb=color.rgb+vec3(grain);}return outColor;}"}
        `:"",this._combinedPostPlugin=c.getPlugin(cv),this._setDirty=this._setDirty.bind(this)}shaderExtender(c,e,i){this.enabled&&(c.fragmentShader=Ho(c.fragmentShader,"#glMarker",` 
            gl_FragColor = grain(gl_FragColor);
            #glMarker
        `))}onObjectRender(c,e,i){this.enabled&&(e.materialObject.uniforms.grainIntensity.value=this.grainIntensity,e.materialObject.uniforms.grainMultiply.value=this.grainMultiply)}getUiConfig(){return this.uiConfig}computeCacheKey(c){return this.enabled?"1":"0"}isCompatible(c){return!0}_setDirty(){this._combinedPostPlugin&&(this._combinedPostPlugin.pass.dirty=!0)}setDirty(){var c;(c=this.__setDirty)===null||c===void 0||c.call(this),this._setDirty()}};NE([pn(cw.prototype._setDirty),ts("Enable"),Fn()],ty.prototype,"enabled",void 0),NE([pn(cw.prototype._setDirty),ts("Multiply"),Fn()],ty.prototype,"grainMultiply",void 0),NE([pn(cw.prototype._setDirty),ss("Intensity",[0,20],.01,{limitedUi:!0}),Fn()],ty.prototype,"grainIntensity",void 0),ty=cw=NE([Ys("FilmicGrain")],ty);class ny extends k0{constructor(){super()}generateExtension(e){return new ty(e)}get intensity(){var e,i;return(i=(e=this._extension)===null||e===void 0?void 0:e.grainIntensity)!==null&&i!==void 0?i:1}set intensity(e){this._extension&&(this._extension.grainIntensity=e,this._extension.setDirty())}get multiply(){var e,i;return(i=(e=this._extension)===null||e===void 0?void 0:e.grainMultiply)!==null&&i!==void 0&&i}set multiply(e){this._extension&&(this._extension.grainMultiply=e,this._extension.setDirty())}}ny.PluginType="FilmicGrain";var UE=__webpackgi_require__(44),uw={};UE.Z&&UE.Z.locals&&(uw.locals=UE.Z.locals);var LC,Xv=0,Kv={};Kv.styleTagTransform=Bx(),Kv.setAttributes=Rx(),Kv.insert=function(c,e){(e.target||document.head).appendChild(c)},Kv.domAPI=IE(),Kv.insertStyleElement=Yv(),uw.use=function(c){return Kv.options=c||{},Xv++||(LC=sw()(UE.Z,Kv)),uw},uw.unuse=function(){Xv>0&&!--Xv&&(LC(),LC=null)};var NC=uw;let hw=class extends ow{constructor(c=!0){super("LoadingBar"),this.showText=c}_updateMainDiv(c){if(!this._contentDiv)return;if(!this.enabled)return void(this._mainDiv.style.display="none");let e=1,i=1;c.forEach((s,a)=>{var h;e+=(h=s.progress)!==null&&h!==void 0?h:99,i+=100}),this._contentDiv.innerHTML=this.showText?(100*e/i).toFixed(0)+"%":"&nbsp;",this._contentDiv.style.width=(100*e/i).toFixed(0)+"%",c.size===0?this._mainDiv.style.display="none":this._mainDiv.style.display="block"}async onAdded(c){NC.use({target:c.container}),await super.onAdded(c)}};async function FE(c,{ground:e=!0,bloom:i=!0,depthTonemap:s=!0,enableDrop:a=!1}={}){await c.addPlugin(ho),await c.addPlugin(M0),a&&await c.addPlugin(Jw),await c.addPlugin(new Bu(32)),await c.addPlugin(new cv),await c.addPlugin(new LE),await c.addPlugin(new BE(s||!c.useRgbm)),await c.addPlugin(new Ou),await c.addPlugin(new OE),await c.addPlugin(new ny),await c.addPlugin(new PE),await c.addPlugin(W1),await c.addPlugin(Y1),await c.addPlugin(Dl),await c.addPlugin(ev),await c.addPlugin(El),e&&await c.addPlugin(gp),i&&await c.addPlugin(xx),await c.addPlugin(Wp),await c.addPlugin($u),await c.addPlugin(_h),await c.addPlugin(_d),await c.addPlugin(wm),await c.addPlugin(Mx,!1),await c.addPlugin(nw),await c.addPlugin(Xo),await c.addPlugin(iv,!1),await c.addPlugin(rv,!1),await c.addPlugin(XA,!1),await c.addPlugin(xm,!1),await c.addPlugin(SE),await c.addPlugin(ZA),await c.addPlugin(Yp)}async function WT(c,{debug:e=!1,ground:i=!0,bloom:s=!0,depthTonemap:a=!0,importPopup:h=!1,enableDrop:d=!1}={}){var _;const et=new Xm(c);e&&await et.addPlugin(mp);const nt=await et.addPlugin(qr,void 0,void 0,{storage:caches?await caches.open("webgi-cache-storage"):void 0});return h&&await et.addPlugin(Kp),await et.addPlugin(hw,!1),await FE(et,{ground:i,bloom:s,depthTonemap:a,enableDrop:d}),et.renderer.refreshPipeline(),(_=nt.importer)===null||_===void 0||_.processors.add("model",{forAssetType:"model",process:(it,lt)=>it}),et}hw.PluginType="AssetManagerLoadingBarPlugin",hw=function(c,e,i,s){var a,h=arguments.length,d=h<3?e:s===null?s=Object.getOwnPropertyDescriptor(e,i):s;if(typeof Reflect=="object"&&typeof Reflect.decorate=="function")d=Reflect.decorate(c,e,i,s);else for(var _=c.length-1;_>=0;_--)(a=c[_])&&(d=(h<3?a(d):h>3?a(e,i,d):a(e,i))||d);return h>3&&d&&Object.defineProperty(e,i,d),d}([Ys("Asset manager loading bar")],hw);let TD=0;class UC extends HTMLElement{constructor(){super(),this._initialized=!1,this._state={src:"",environment:""},this._models={},this._refreshingModels=!1,this._refreshingEnvironment=!1,this.viewerIndex=TD++,this.canvasId="webgi-viewer-"+this.viewerIndex,this.attachShadow({mode:"open"}),this.wrapper=document.createElement("div"),this.wrapper.style.width="100%",this.wrapper.style.height="100%",this.wrapper.style.display="block",this.canvas=a0(),this.canvas.setAttribute("id",this.canvasId);const e=document.createElement("style");e.textContent=Wt`
            #${this.canvasId}{
              width: 100%; height: 100%; z-index: 1;
              display: block;
            }
        `,this.wrapper.append(this.canvas),this.shadowRoot.append(e,this.wrapper),this._initialize().then(async()=>this.refreshAll())}async refreshAll(){await Promise.all([this.refreshModelSource(),this.refreshEnvironment()])}async _initialize(){this._initialized||(this.viewer=await WT({canvas:this.canvas,useRgbm:this._getAttr("rgbm","true")==="true",useGBufferDepth:this._getAttr("depth-prepass","true")==="true"},{debug:this._getAttr("debug","false")==="true",ground:this._getAttr("ground","baked")==="baked",bloom:this._getAttr("bloom","true")==="true",depthTonemap:!0}),this._initialized=!0,this.dispatchEvent(new Event("initialized")))}connectedCallback(){console.log("WebGiViewerElement added to page."),this.viewer&&(this.viewer.resize(),this.viewer.enabled=!0)}disconnectedCallback(){console.log("WebGiViewerElement removed from page."),this.viewer&&(this.viewer.enabled=!1)}adoptedCallback(){console.log("WebGiViewerElement moved to new page."),this.viewer&&(this.viewer.resize(),this.viewer.enabled=!0)}static get observedAttributes(){return["src","environment"]}attributeChangedCallback(e,i,s){console.log("WebGiViewerElement attributes changed.",e,i,s),this.refreshAll()}clearModels(){}async refreshModelSource(){if(!this.viewer)return;const e=this._getAttr("src","");if(e===this._state.src||this._refreshingModels)return;this._refreshingModels=!0;const i=[e],s=[],a=[];for(const h of i)!this._models[h]&&h&&(this._models[h]=this.viewer.getManager().importer.importPath(h,{autoScale:this._getAttr("auto-scale","true")==="true",autoCenter:this._getAttr("auto-center","true")==="true",processImported:!1}));for(const[h,d]of Object.entries(this._models))i.includes(h)?s.push(d):a.push(d);await Promise.all([Promise.all(s).then(async h=>Promise.all(h.map(async d=>this.viewer.getManager().importer.processImported(d)))).then(h=>{for(const d of h)for(const _ of d)_&&_.assetType==="model"&&this.viewer.scene.addSceneObject(_)}),Promise.all(a).then(h=>{for(const d of h)for(const _ of d)_&&_.assetType==="model"&&_.modelObject.removeFromParent()})]),this._state.src=e,this._refreshingModels=!1}async refreshEnvironment(){if(!this.viewer)return;if(!this.hasAttribute("environment"))return void(this._state.environment=null);const e=this._getAttr("environment","");if(e===this._state.src||this._refreshingEnvironment)return;this._refreshingEnvironment=!0;const i=this.viewer.scene.getEnvironment(),s=e?await this.viewer.getManager().importer.importSinglePath(e):void 0;s&&s.assetType!=="texture"||await this.viewer.scene.setEnvironment(s),i==null||i.dispose(),this._state.environment=e,this._refreshingEnvironment=!1}_getAttr(e,i){return this.hasAttribute(e)?this.getAttribute(e):i}}window&&window.customElements&&!window.customElements.get("webgi-viewer")&&window.customElements.define("webgi-viewer",UC);class qT{constructor(e){var i,s,a;this._basePath=(i=e==null?void 0:e.basePath)!==null&&i!==void 0?i:"",this._assets=(a=(s=e==null?void 0:e.assets)===null||s===void 0?void 0:s.map(h=>this._resolveAsset(h)))!==null&&a!==void 0?a:[]}get basePath(){return this._basePath}get assets(){return this._assets}find(e){const i=this._assets.find(e);return i??void 0}_resolveAsset(e){return{...e,path:i_([this._basePath,e.path])}}}class ID extends ot{constructor(...e){super(),this._assets=e}addAssetList(e){this._assets.push(e)}removeAssetList(e){const i=this._assets.indexOf(e);i>=0&&this._assets.splice(i,1)}async findAssetRegex(e){for(const i of this._assets){const s=i.find(a=>{var h,d;return a&&(e.test(a.path)||e.test((d=(h=a.file)===null||h===void 0?void 0:h.name)!==null&&d!==void 0?d:""))});if(s)return s}console.warn("Asset not found:",e)}async findAsset(e){return this.findAssetRegex(e.query)}async findAssetSimple(e,i=!1){return this.findAssetRegex(new RegExp(e,i?"i":""))}}var YT={},FC=function(c){return URL.createObjectURL(new Blob([c],{type:"text/javascript"}))},jC=function(c){return new Worker(c)};try{URL.revokeObjectURL(FC(""))}catch{FC=function(e){return"data:application/javascript;charset=UTF-8,"+encodeURI(e)},jC=function(e){return new Worker(e,{type:"module"})}}var $s=Uint8Array,au=Uint16Array,L0=Uint32Array,N0=new $s([0,0,0,0,0,0,0,0,1,1,1,1,2,2,2,2,3,3,3,3,4,4,4,4,5,5,5,5,0,0,0,0]),Ko=new $s([0,0,0,0,1,1,2,2,3,3,4,4,5,5,6,6,7,7,8,8,9,9,10,10,11,11,12,12,13,13,0,0]),zx=new $s([16,17,18,0,8,7,9,6,10,5,11,4,12,3,13,2,14,1,15]),Ll=function(c,e){for(var i=new au(31),s=0;s<31;++s)i[s]=e+=1<<c[s-1];var a=new L0(i[30]);for(s=1;s<30;++s)for(var h=i[s];h<i[s+1];++h)a[h]=h-i[s]<<5|s;return[i,a]},Vx=Ll(N0,2),zC=Vx[0],jE=Vx[1];zC[28]=258,jE[258]=28;for(var XT=Ll(Ko,0),VC=XT[0],dw=XT[1],iy=new au(32768),Al=0;Al<32768;++Al){var ry=(43690&Al)>>>1|(21845&Al)<<1;ry=(61680&(ry=(52428&ry)>>>2|(13107&ry)<<2))>>>4|(3855&ry)<<4,iy[Al]=((65280&ry)>>>8|(255&ry)<<8)>>>1}var Em=function(c,e,i){for(var s=c.length,a=0,h=new au(e);a<s;++a)++h[c[a]-1];var d,_=new au(e);for(a=0;a<e;++a)_[a]=_[a-1]+h[a-1]<<1;if(i){d=new au(1<<e);var et=15-e;for(a=0;a<s;++a)if(c[a])for(var nt=a<<4|c[a],it=e-c[a],lt=_[c[a]-1]++<<it,ut=lt|(1<<it)-1;lt<=ut;++lt)d[iy[lt]>>>et]=nt}else for(d=new au(s),a=0;a<s;++a)c[a]&&(d[a]=iy[_[c[a]-1]++]>>>15-c[a]);return d},Lu=new $s(288);for(Al=0;Al<144;++Al)Lu[Al]=8;for(Al=144;Al<256;++Al)Lu[Al]=9;for(Al=256;Al<280;++Al)Lu[Al]=7;for(Al=280;Al<288;++Al)Lu[Al]=8;var pw=new $s(32);for(Al=0;Al<32;++Al)pw[Al]=5;var KT=Em(Lu,9,0),JT=Em(Lu,9,1),ZT=Em(pw,5,0),$T=Em(pw,5,1),zE=function(c){for(var e=c[0],i=1;i<c.length;++i)c[i]>e&&(e=c[i]);return e},Sm=function(c,e,i){var s=e/8|0;return(c[s]|c[s+1]<<8)>>(7&e)&i},VE=function(c,e){var i=e/8|0;return(c[i]|c[i+1]<<8|c[i+2]<<16)>>(7&e)},Qx=function(c){return(c/8|0)+(7&c&&1)},Cm=function(c,e,i){(e==null||e<0)&&(e=0),(i==null||i>c.length)&&(i=c.length);var s=new(c instanceof au?au:c instanceof L0?L0:$s)(i-e);return s.set(c.subarray(e,i)),s},Gx=function(c,e,i){var s=c.length;if(!s||i&&!i.l&&s<5)return e||new $s(0);var a=!e||i,h=!i||i.i;i||(i={}),e||(e=new $s(3*s));var d=function(ls){var mr=e.length;if(ls>mr){var Us=new $s(Math.max(2*mr,ls));Us.set(e),e=Us}},_=i.f||0,et=i.p||0,nt=i.b||0,it=i.l,lt=i.d,ut=i.m,pt=i.n,gt=8*s;do{if(!it){i.f=_=Sm(c,et,1);var vt=Sm(c,et+1,3);if(et+=3,!vt){var Ct=c[(An=Qx(et)+4)-4]|c[An-3]<<8,wt=An+Ct;if(wt>s){if(h)throw"unexpected EOF";break}a&&d(nt+Ct),e.set(c.subarray(An,wt),nt),i.b=nt+=Ct,i.p=et=8*wt;continue}if(vt==1)it=JT,lt=$T,ut=9,pt=5;else{if(vt!=2)throw"invalid block type";var xt=Sm(c,et,31)+257,_t=Sm(c,et+10,15)+4,Pt=xt+Sm(c,et+5,31)+1;et+=14;for(var Bt=new $s(Pt),Ot=new $s(19),Lt=0;Lt<_t;++Lt)Ot[zx[Lt]]=Sm(c,et+3*Lt,7);et+=3*_t;var qt=zE(Ot),en=(1<<qt)-1,cn=Em(Ot,qt,1);for(Lt=0;Lt<Pt;){var An,mn=cn[Sm(c,et,en)];if(et+=15&mn,(An=mn>>>4)<16)Bt[Lt++]=An;else{var Tn=0,vn=0;for(An==16?(vn=3+Sm(c,et,3),et+=2,Tn=Bt[Lt-1]):An==17?(vn=3+Sm(c,et,7),et+=3):An==18&&(vn=11+Sm(c,et,127),et+=7);vn--;)Bt[Lt++]=Tn}}var xn=Bt.subarray(0,xt),Un=Bt.subarray(xt);ut=zE(xn),pt=zE(Un),it=Em(xn,ut,1),lt=Em(Un,pt,1)}if(et>gt){if(h)throw"unexpected EOF";break}}a&&d(nt+131072);for(var Mn=(1<<ut)-1,Gn=(1<<pt)-1,rr=et;;rr=et){var dr=(Tn=it[VE(c,et)&Mn])>>>4;if((et+=15&Tn)>gt){if(h)throw"unexpected EOF";break}if(!Tn)throw"invalid length/literal";if(dr<256)e[nt++]=dr;else{if(dr==256){rr=et,it=null;break}var _i=dr-254;if(dr>264){var xr=N0[Lt=dr-257];_i=Sm(c,et,(1<<xr)-1)+zC[Lt],et+=xr}var Cr=lt[VE(c,et)&Gn],Mr=Cr>>>4;if(!Cr)throw"invalid distance";if(et+=15&Cr,Un=VC[Mr],Mr>3&&(xr=Ko[Mr],Un+=VE(c,et)&(1<<xr)-1,et+=xr),et>gt){if(h)throw"unexpected EOF";break}a&&d(nt+131072);for(var Lr=nt+_i;nt<Lr;nt+=4)e[nt]=e[nt-Un],e[nt+1]=e[nt+1-Un],e[nt+2]=e[nt+2-Un],e[nt+3]=e[nt+3-Un];nt=Lr}}i.l=it,i.p=rr,i.b=nt,it&&(_=1,i.m=ut,i.d=lt,i.n=pt)}while(!_);return nt==e.length?e:Cm(e,0,nt)},Jv=function(c,e,i){i<<=7&e;var s=e/8|0;c[s]|=i,c[s+1]|=i>>>8},fw=function(c,e,i){i<<=7&e;var s=e/8|0;c[s]|=i,c[s+1]|=i>>>8,c[s+2]|=i>>>16},QE=function(c,e){for(var i=[],s=0;s<c.length;++s)c[s]&&i.push({s,f:c[s]});var a=i.length,h=i.slice();if(!a)return[U0,0];if(a==1){var d=new $s(i[0].s+1);return d[i[0].s]=1,[d,1]}i.sort(function(Bt,Ot){return Bt.f-Ot.f}),i.push({s:-1,f:25001});var _=i[0],et=i[1],nt=0,it=1,lt=2;for(i[0]={s:-1,f:_.f+et.f,l:_,r:et};it!=a-1;)_=i[i[nt].f<i[lt].f?nt++:lt++],et=i[nt!=it&&i[nt].f<i[lt].f?nt++:lt++],i[it++]={s:-1,f:_.f+et.f,l:_,r:et};var ut=h[0].s;for(s=1;s<a;++s)h[s].s>ut&&(ut=h[s].s);var pt=new au(ut+1),gt=GE(i[it-1],pt,0);if(gt>e){s=0;var vt=0,Ct=gt-e,wt=1<<Ct;for(h.sort(function(Bt,Ot){return pt[Ot.s]-pt[Bt.s]||Bt.f-Ot.f});s<a;++s){var xt=h[s].s;if(!(pt[xt]>e))break;vt+=wt-(1<<gt-pt[xt]),pt[xt]=e}for(vt>>>=Ct;vt>0;){var _t=h[s].s;pt[_t]<e?vt-=1<<e-pt[_t]++-1:++s}for(;s>=0&&vt;--s){var Pt=h[s].s;pt[Pt]==e&&(--pt[Pt],++vt)}gt=e}return[new $s(pt),gt]},GE=function(c,e,i){return c.s==-1?Math.max(GE(c.l,e,i+1),GE(c.r,e,i+1)):e[c.s]=i},QC=function(c){for(var e=c.length;e&&!c[--e];);for(var i=new au(++e),s=0,a=c[0],h=1,d=function(et){i[s++]=et},_=1;_<=e;++_)if(c[_]==a&&_!=e)++h;else{if(!a&&h>2){for(;h>138;h-=138)d(32754);h>2&&(d(h>10?h-11<<5|28690:h-3<<5|12305),h=0)}else if(h>3){for(d(a),--h;h>6;h-=6)d(8304);h>2&&(d(h-3<<5|8208),h=0)}for(;h--;)d(a);h=1,a=c[_]}return[i.subarray(0,s),e]},mw=function(c,e){for(var i=0,s=0;s<e.length;++s)i+=c[s]*e[s];return i},Hx=function(c,e,i){var s=i.length,a=Qx(e+2);c[a]=255&s,c[a+1]=s>>>8,c[a+2]=255^c[a],c[a+3]=255^c[a+1];for(var h=0;h<s;++h)c[a+h+4]=i[h];return 8*(a+4+s)},GC=function(c,e,i,s,a,h,d,_,et,nt,it){Jv(e,it++,i),++a[256];for(var lt=QE(a,15),ut=lt[0],pt=lt[1],gt=QE(h,15),vt=gt[0],Ct=gt[1],wt=QC(ut),xt=wt[0],_t=wt[1],Pt=QC(vt),Bt=Pt[0],Ot=Pt[1],Lt=new au(19),qt=0;qt<xt.length;++qt)Lt[31&xt[qt]]++;for(qt=0;qt<Bt.length;++qt)Lt[31&Bt[qt]]++;for(var en=QE(Lt,7),cn=en[0],An=en[1],mn=19;mn>4&&!cn[zx[mn-1]];--mn);var Tn,vn,xn,Un,Mn=nt+5<<3,Gn=mw(a,Lu)+mw(h,pw)+d,rr=mw(a,ut)+mw(h,vt)+d+14+3*mn+mw(Lt,cn)+(2*Lt[16]+3*Lt[17]+7*Lt[18]);if(Mn<=Gn&&Mn<=rr)return Hx(e,it,c.subarray(et,et+nt));if(Jv(e,it,1+(rr<Gn)),it+=2,rr<Gn){Tn=Em(ut,pt,0),vn=ut,xn=Em(vt,Ct,0),Un=vt;var dr=Em(cn,An,0);for(Jv(e,it,_t-257),Jv(e,it+5,Ot-1),Jv(e,it+10,mn-4),it+=14,qt=0;qt<mn;++qt)Jv(e,it+3*qt,cn[zx[qt]]);it+=3*mn;for(var _i=[xt,Bt],xr=0;xr<2;++xr){var Cr=_i[xr];for(qt=0;qt<Cr.length;++qt){var Mr=31&Cr[qt];Jv(e,it,dr[Mr]),it+=cn[Mr],Mr>15&&(Jv(e,it,Cr[qt]>>>5&127),it+=Cr[qt]>>>12)}}}else Tn=KT,vn=Lu,xn=ZT,Un=pw;for(qt=0;qt<_;++qt)if(s[qt]>255){Mr=s[qt]>>>18&31,fw(e,it,Tn[Mr+257]),it+=vn[Mr+257],Mr>7&&(Jv(e,it,s[qt]>>>23&31),it+=N0[Mr]);var Lr=31&s[qt];fw(e,it,xn[Lr]),it+=Un[Lr],Lr>3&&(fw(e,it,s[qt]>>>5&8191),it+=Ko[Lr])}else fw(e,it,Tn[s[qt]]),it+=vn[s[qt]];return fw(e,it,Tn[256]),it+vn[256]},eI=new L0([65540,131080,131088,131104,262176,1048704,1048832,2114560,2117632]),U0=new $s(0),tI=function(c,e,i,s,a,h){var d=c.length,_=new $s(s+d+5*(1+Math.ceil(d/7e3))+a),et=_.subarray(s,_.length-a),nt=0;if(!e||d<8)for(var it=0;it<=d;it+=65535){var lt=it+65535;lt<d?nt=Hx(et,nt,c.subarray(it,lt)):(et[it]=h,nt=Hx(et,nt,c.subarray(it,d)))}else{for(var ut=eI[e-1],pt=ut>>>13,gt=8191&ut,vt=(1<<i)-1,Ct=new au(32768),wt=new au(vt+1),xt=Math.ceil(i/3),_t=2*xt,Pt=function(To){return(c[To]^c[To+1]<<xt^c[To+2]<<_t)&vt},Bt=new L0(25e3),Ot=new au(288),Lt=new au(32),qt=0,en=0,cn=(it=0,0),An=0,mn=0;it<d;++it){var Tn=Pt(it),vn=32767&it,xn=wt[Tn];if(Ct[vn]=xn,wt[Tn]=vn,An<=it){var Un=d-it;if((qt>7e3||cn>24576)&&Un>423){nt=GC(c,et,0,Bt,Ot,Lt,en,cn,mn,it-mn,nt),cn=qt=en=0,mn=it;for(var Mn=0;Mn<286;++Mn)Ot[Mn]=0;for(Mn=0;Mn<30;++Mn)Lt[Mn]=0}var Gn=2,rr=0,dr=gt,_i=vn-xn&32767;if(Un>2&&Tn==Pt(it-_i))for(var xr=Math.min(pt,Un)-1,Cr=Math.min(32767,it),Mr=Math.min(258,Un);_i<=Cr&&--dr&&vn!=xn;){if(c[it+Gn]==c[it+Gn-_i]){for(var Lr=0;Lr<Mr&&c[it+Lr]==c[it+Lr-_i];++Lr);if(Lr>Gn){if(Gn=Lr,rr=_i,Lr>xr)break;var ls=Math.min(_i,Lr-2),mr=0;for(Mn=0;Mn<ls;++Mn){var Us=it-_i+Mn+32768&32767,Ws=Us-Ct[Us]+32768&32767;Ws>mr&&(mr=Ws,xn=Us)}}}_i+=(vn=xn)-(xn=Ct[vn])+32768&32767}if(rr){Bt[cn++]=268435456|jE[Gn]<<18|dw[rr];var Fs=31&jE[Gn],co=31&dw[rr];en+=N0[Fs]+Ko[co],++Ot[257+Fs],++Lt[co],An=it+Gn,++qt}else Bt[cn++]=c[it],++Ot[c[it]]}}nt=GC(c,et,h,Bt,Ot,Lt,en,cn,mn,it-mn,nt),!h&&7&nt&&(nt=Hx(et,nt+1,U0))}return Cm(_,0,s+Qx(nt)+a)},nI=function(){for(var c=new L0(256),e=0;e<256;++e){for(var i=e,s=9;--s;)i=(1&i&&3988292384)^i>>>1;c[e]=i}return c}(),gw=function(){var c=-1;return{p:function(e){for(var i=c,s=0;s<e.length;++s)i=nI[255&i^e[s]]^i>>>8;c=i},d:function(){return~c}}},HC=function(){var c=1,e=0;return{p:function(i){for(var s=c,a=e,h=i.length,d=0;d!=h;){for(var _=Math.min(d+2655,h);d<_;++d)a+=s+=i[d];s=(65535&s)+15*(s>>16),a=(65535&a)+15*(a>>16)}c=s,e=a},d:function(){return(255&(c%=65521))<<24|c>>>8<<16|(255&(e%=65521))<<8|e>>>8}}},dt=function(c,e,i,s,a){return tI(c,e.level==null?6:e.level,e.mem==null?Math.ceil(1.5*Math.max(8,Math.min(13,Math.log(c.length)))):12+e.mem,i,s,!a)},o=function(c,e){var i={};for(var s in c)i[s]=c[s];for(var s in e)i[s]=e[s];return i},g=function(c,e,i){for(var s=c(),a=c.toString(),h=a.slice(a.indexOf("[")+1,a.lastIndexOf("]")).replace(/ /g,"").split(","),d=0;d<s.length;++d){var _=s[d],et=h[d];if(typeof _=="function"){e+=";"+et+"=";var nt=_.toString();if(_.prototype)if(nt.indexOf("[native code]")!=-1){var it=nt.indexOf(" ",8)+1;e+=nt.slice(it,nt.indexOf("(",it))}else for(var lt in e+=nt,_.prototype)e+=";"+et+".prototype."+lt+"="+_.prototype[lt].toString();else e+=nt}else i[et]=_}return[e,i]},$=[],_e=function(c,e,i,s){var a;if(!$[i]){for(var h="",d={},_=c.length-1,et=0;et<_;++et)h=(a=g(c[et],h,d))[0],d=a[1];$[i]=g(c[_],h,d)}var nt=o({},$[i][1]);return function(it,lt,ut,pt,gt){var vt=jC(YT[lt]||(YT[lt]=FC(it)));return vt.onerror=function(Ct){return gt(Ct.error,null)},vt.onmessage=function(Ct){return gt(null,Ct.data)},vt.postMessage(ut,pt),vt}($[i][0]+";onmessage=function(e){for(var k in e.data)self[k]=e.data[k];onmessage="+e.toString()+"}",i,nt,function(it){var lt=[];for(var ut in it)(it[ut]instanceof $s||it[ut]instanceof au||it[ut]instanceof L0)&&lt.push((it[ut]=new it[ut].constructor(it[ut])).buffer);return lt}(nt),s)},rt=function(){return[$s,au,L0,N0,Ko,zx,zC,VC,JT,$T,iy,Em,zE,Sm,VE,Qx,Cm,Gx,ur,Tt,St]},at=function(){return[$s,au,L0,N0,Ko,zx,jE,dw,KT,Lu,ZT,pw,iy,eI,U0,Em,Jv,fw,QE,GE,QC,mw,Hx,GC,Qx,Cm,tI,dt,gr,Tt]},ct=function(){return[tn,kn,Xt,gw,nI]},ft=function(){return[sn,ln]},mt=function(){return[Ln,Xt,HC]},bt=function(){return[qn]},Tt=function(c){return postMessage(c,[c.buffer])},St=function(c){return c&&c.size&&new $s(c.size)},It=function(c,e,i,s,a,h){var d=_e(i,s,a,function(_,et){d.terminate(),h(_,et)});return d.postMessage([c,e],e.consume?[c.buffer]:[]),function(){d.terminate()}},Rt=function(c){return c.ondata=function(e,i){return postMessage([e,i],[e.buffer])},function(e){return c.push(e.data[0],e.data[1])}},Dt=function(c,e,i,s,a){var h,d=_e(c,s,a,function(_,et){_?(d.terminate(),e.ondata.call(e,_)):(et[1]&&d.terminate(),e.ondata.call(e,_,et[0],et[1]))});d.postMessage(i),e.push=function(_,et){if(h)throw"stream finished";if(!e.ondata)throw"no stream handler";d.postMessage([_,h=et],[_.buffer])},e.terminate=function(){d.terminate()}},Ft=function(c,e){return c[e]|c[e+1]<<8},Nt=function(c,e){return(c[e]|c[e+1]<<8|c[e+2]<<16|c[e+3]<<24)>>>0},zt=function(c,e){return Nt(c,e)+4294967296*Nt(c,e+4)},Xt=function(c,e,i){for(;i;++e)c[e]=i,i>>>=8},tn=function(c,e){var i=e.filename;if(c[0]=31,c[1]=139,c[2]=8,c[8]=e.level<2?4:e.level==9?2:0,c[9]=3,e.mtime!=0&&Xt(c,4,Math.floor(new Date(e.mtime||Date.now())/1e3)),i){c[3]=8;for(var s=0;s<=i.length;++s)c[s+10]=i.charCodeAt(s)}},sn=function(c){if(c[0]!=31||c[1]!=139||c[2]!=8)throw"invalid gzip data";var e=c[3],i=10;4&e&&(i+=c[10]|2+(c[11]<<8));for(var s=(e>>3&1)+(e>>4&1);s>0;s-=!c[i++]);return i+(2&e)},ln=function(c){var e=c.length;return(c[e-4]|c[e-3]<<8|c[e-2]<<16|c[e-1]<<24)>>>0},kn=function(c){return 10+(c.filename&&c.filename.length+1||0)},Ln=function(c,e){var i=e.level,s=i==0?0:i<6?1:i==9?3:2;c[0]=120,c[1]=s<<6|(s?32-2*s:1)},qn=function(c){if((15&c[0])!=8||c[0]>>>4>7||(c[0]<<8|c[1])%31)throw"invalid zlib data";if(32&c[1])throw"invalid zlib data: preset dictionaries not supported"};function Kn(c,e){return e||typeof c!="function"||(e=c,c={}),this.ondata=e,c}var On=function(){function c(e,i){i||typeof e!="function"||(i=e,e={}),this.ondata=i,this.o=e||{}}return c.prototype.p=function(e,i){this.ondata(dt(e,this.o,0,0,!i),i)},c.prototype.push=function(e,i){if(this.d)throw"stream finished";if(!this.ondata)throw"no stream handler";this.d=i,this.p(e,i||!1)},c}(),_r=function(){return function(c,e){Dt([at,function(){return[Rt,On]}],this,Kn.call(this,c,e),function(i){var s=new On(i.data);onmessage=Rt(s)},6)}}();function Tr(c,e,i){if(i||(i=e,e={}),typeof i!="function")throw"no callback";return It(c,e,[at],function(s){return Tt(gr(s.data[0],s.data[1]))},0,i)}function gr(c,e){return dt(c,e||{},0,0)}var Or=function(){function c(e){this.s={},this.p=new $s(0),this.ondata=e}return c.prototype.e=function(e){if(this.d)throw"stream finished";if(!this.ondata)throw"no stream handler";var i=this.p.length,s=new $s(i+e.length);s.set(this.p),s.set(e,i),this.p=s},c.prototype.c=function(e){this.d=this.s.i=e||!1;var i=this.s.b,s=Gx(this.p,this.o,this.s);this.ondata(Cm(s,i,this.s.b),this.d),this.o=Cm(s,this.s.b-32768),this.s.b=this.o.length,this.p=Cm(this.p,this.s.p/8|0),this.s.p&=7},c.prototype.push=function(e,i){this.e(e),this.c(i)},c}(),Gr=function(){return function(c){this.ondata=c,Dt([rt,function(){return[Rt,Or]}],this,0,function(){var e=new Or;onmessage=Rt(e)},7)}}();function cr(c,e,i){if(i||(i=e,e={}),typeof i!="function")throw"no callback";return It(c,e,[rt],function(s){return Tt(ur(s.data[0],St(s.data[1])))},1,i)}function ur(c,e){return Gx(c,e)}var Fr=function(){function c(e,i){this.c=gw(),this.l=0,this.v=1,On.call(this,e,i)}return c.prototype.push=function(e,i){On.prototype.push.call(this,e,i)},c.prototype.p=function(e,i){this.c.p(e),this.l+=e.length;var s=dt(e,this.o,this.v&&kn(this.o),i&&8,!i);this.v&&(tn(s,this.o),this.v=0),i&&(Xt(s,s.length-8,this.c.d()),Xt(s,s.length-4,this.l)),this.ondata(s,i)},c}(),Ar=function(){return function(c,e){Dt([at,ct,function(){return[Rt,On,Fr]}],this,Kn.call(this,c,e),function(i){var s=new Fr(i.data);onmessage=Rt(s)},8)}}();function Qr(c,e,i){if(i||(i=e,e={}),typeof i!="function")throw"no callback";return It(c,e,[at,ct,function(){return[as]}],function(s){return Tt(as(s.data[0],s.data[1]))},2,i)}function as(c,e){e||(e={});var i=gw(),s=c.length;i.p(c);var a=dt(c,e,kn(e),8),h=a.length;return tn(a,e),Xt(a,h-8,i.d()),Xt(a,h-4,s),a}var Qs=function(){function c(e){this.v=1,Or.call(this,e)}return c.prototype.push=function(e,i){if(Or.prototype.e.call(this,e),this.v){var s=this.p.length>3?sn(this.p):4;if(s>=this.p.length&&!i)return;this.p=this.p.subarray(s),this.v=0}if(i){if(this.p.length<8)throw"invalid gzip stream";this.p=this.p.subarray(0,-8)}Or.prototype.c.call(this,i)},c}(),ys=function(){return function(c){this.ondata=c,Dt([rt,ft,function(){return[Rt,Or,Qs]}],this,0,function(){var e=new Qs;onmessage=Rt(e)},9)}}();function Hs(c,e,i){if(i||(i=e,e={}),typeof i!="function")throw"no callback";return It(c,e,[rt,ft,function(){return[Dn]}],function(s){return Tt(Dn(s.data[0]))},3,i)}function Dn(c,e){return Gx(c.subarray(sn(c),-8),e||new $s(ln(c)))}var yn=function(){function c(e,i){this.c=HC(),this.v=1,On.call(this,e,i)}return c.prototype.push=function(e,i){On.prototype.push.call(this,e,i)},c.prototype.p=function(e,i){this.c.p(e);var s=dt(e,this.o,this.v&&2,i&&4,!i);this.v&&(Ln(s,this.o),this.v=0),i&&Xt(s,s.length-4,this.c.d()),this.ondata(s,i)},c}(),tr=function(){return function(c,e){Dt([at,mt,function(){return[Rt,On,yn]}],this,Kn.call(this,c,e),function(i){var s=new yn(i.data);onmessage=Rt(s)},10)}}();function Hn(c,e,i){if(i||(i=e,e={}),typeof i!="function")throw"no callback";return It(c,e,[at,mt,function(){return[In]}],function(s){return Tt(In(s.data[0],s.data[1]))},4,i)}function In(c,e){e||(e={});var i=HC();i.p(c);var s=dt(c,e,2,4);return Ln(s,e),Xt(s,s.length-4,i.d()),s}var Wn=function(){function c(e){this.v=1,Or.call(this,e)}return c.prototype.push=function(e,i){if(Or.prototype.e.call(this,e),this.v){if(this.p.length<2&&!i)return;this.p=this.p.subarray(2),this.v=0}if(i){if(this.p.length<4)throw"invalid zlib stream";this.p=this.p.subarray(0,-4)}Or.prototype.c.call(this,i)},c}(),pr=function(){return function(c){this.ondata=c,Dt([rt,bt,function(){return[Rt,Or,Wn]}],this,0,function(){var e=new Wn;onmessage=Rt(e)},11)}}();function Jt(c,e,i){if(i||(i=e,e={}),typeof i!="function")throw"no callback";return It(c,e,[rt,bt,function(){return[or]}],function(s){return Tt(or(s.data[0],St(s.data[1])))},5,i)}function or(c,e){return Gx((qn(c),c.subarray(2,-4)),e)}var Zn=function(){function c(e){this.G=Qs,this.I=Or,this.Z=Wn,this.ondata=e}return c.prototype.push=function(e,i){if(!this.ondata)throw"no stream handler";if(this.s)this.s.push(e,i);else{if(this.p&&this.p.length){var s=new $s(this.p.length+e.length);s.set(this.p),s.set(e,this.p.length)}else this.p=e;if(this.p.length>2){var a=this,h=function(){a.ondata.apply(a,arguments)};this.s=this.p[0]==31&&this.p[1]==139&&this.p[2]==8?new this.G(h):(15&this.p[0])!=8||this.p[0]>>4>7||(this.p[0]<<8|this.p[1])%31?new this.I(h):new this.Z(h),this.s.push(this.p,i),this.p=null}}},c}(),vr=function(){function c(e){this.G=ys,this.I=Gr,this.Z=pr,this.ondata=e}return c.prototype.push=function(e,i){Zn.prototype.push.call(this,e,i)},c}();function Pr(c,e,i){if(i||(i=e,e={}),typeof i!="function")throw"no callback";return c[0]==31&&c[1]==139&&c[2]==8?Hs(c,e,i):(15&c[0])!=8||c[0]>>4>7||(c[0]<<8|c[1])%31?cr(c,e,i):Jt(c,e,i)}function Jr(c,e){return c[0]==31&&c[1]==139&&c[2]==8?Dn(c,e):(15&c[0])!=8||c[0]>>4>7||(c[0]<<8|c[1])%31?ur(c,e):or(c,e)}var gs=function(c,e,i,s){for(var a in c){var h=c[a],d=e+a;h instanceof $s?i[d]=[h,s]:Array.isArray(h)?i[d]=[h[0],o(s,h[1])]:gs(h,d+"/",i,s)}},Ds=typeof TextEncoder<"u"&&new TextEncoder,Ns=typeof TextDecoder<"u"&&new TextDecoder,xs=0;try{Ns.decode(U0,{stream:!0}),xs=1}catch{}var Ms=function(c){for(var e="",i=0;;){var s=c[i++],a=(s>127)+(s>223)+(s>239);if(i+a>c.length)return[e,Cm(c,i-1)];a?a==3?(s=((15&s)<<18|(63&c[i++])<<12|(63&c[i++])<<6|63&c[i++])-65536,e+=String.fromCharCode(55296|s>>10,56320|1023&s)):e+=1&a?String.fromCharCode((31&s)<<6|63&c[i++]):String.fromCharCode((15&s)<<12|(63&c[i++])<<6|63&c[i++]):e+=String.fromCharCode(s)}},xo=function(){function c(e){this.ondata=e,xs?this.t=new TextDecoder:this.p=U0}return c.prototype.push=function(e,i){if(!this.ondata)throw"no callback";if(i=!!i,this.t){if(this.ondata(this.t.decode(e,{stream:!0}),i),i){if(this.t.decode().length)throw"invalid utf-8 data";this.t=null}}else{if(!this.p)throw"stream finished";var s=new $s(this.p.length+e.length);s.set(this.p),s.set(e,this.p.length);var a=Ms(s),h=a[0],d=a[1];if(i){if(d.length)throw"invalid utf-8 data";this.p=null}else this.p=d;this.ondata(h,i)}},c}(),Jp=function(){function c(e){this.ondata=e}return c.prototype.push=function(e,i){if(!this.ondata)throw"no callback";if(this.d)throw"stream finished";this.ondata(Is(e),this.d=i||!1)},c}();function Is(c,e){if(e){for(var i=new $s(c.length),s=0;s<c.length;++s)i[s]=c.charCodeAt(s);return i}if(Ds)return Ds.encode(c);var a=c.length,h=new $s(c.length+(c.length>>1)),d=0,_=function(it){h[d++]=it};for(s=0;s<a;++s){if(d+5>h.length){var et=new $s(d+8+(a-s<<1));et.set(h),h=et}var nt=c.charCodeAt(s);nt<128||e?_(nt):nt<2048?(_(192|nt>>6),_(128|63&nt)):nt>55295&&nt<57344?(_(240|(nt=65536+(1047552&nt)|1023&c.charCodeAt(++s))>>18),_(128|nt>>12&63),_(128|nt>>6&63),_(128|63&nt)):(_(224|nt>>12),_(128|nt>>6&63),_(128|63&nt))}return Cm(h,0,d)}function bo(c,e){if(e){for(var i="",s=0;s<c.length;s+=16384)i+=String.fromCharCode.apply(null,c.subarray(s,s+16384));return i}if(Ns)return Ns.decode(c);var a=Ms(c),h=a[0];if(a[1].length)throw"invalid utf-8 data";return h}var Mo=function(c){return c==1?3:c<6?2:c==9?1:0},Wx=function(c,e){return e+30+Ft(c,e+26)+Ft(c,e+28)},es=function(c,e,i){var s=Ft(c,e+28),a=bo(c.subarray(e+46,e+46+s),!(2048&Ft(c,e+8))),h=e+46+s,d=Nt(c,e+20),_=i&&d==4294967295?WC(c,h):[d,Nt(c,e+24),Nt(c,e+42)],et=_[0],nt=_[1],it=_[2];return[Ft(c,e+10),et,nt,a,h+Ft(c,e+30)+Ft(c,e+32),it]},WC=function(c,e){for(;Ft(c,e)!=1;e+=4+Ft(c,e+2));return[zt(c,e+12),zt(c,e+4),zt(c,e+20)]},F0=function(c){var e=0;if(c)for(var i in c){var s=c[i].length;if(s>65535)throw"extra field too long";e+=s+4}return e},bu=function(c,e,i,s,a,h,d,_){var et=s.length,nt=i.extra,it=_&&_.length,lt=F0(nt);Xt(c,e,d!=null?33639248:67324752),e+=4,d!=null&&(c[e++]=20,c[e++]=i.os),c[e]=20,e+=2,c[e++]=i.flag<<1|(h==null&&8),c[e++]=a&&8,c[e++]=255&i.compression,c[e++]=i.compression>>8;var ut=new Date(i.mtime==null?Date.now():i.mtime),pt=ut.getFullYear()-1980;if(pt<0||pt>119)throw"date not in range 1980-2099";if(Xt(c,e,pt<<25|ut.getMonth()+1<<21|ut.getDate()<<16|ut.getHours()<<11|ut.getMinutes()<<5|ut.getSeconds()>>>1),e+=4,h!=null&&(Xt(c,e,i.crc),Xt(c,e+4,h),Xt(c,e+8,i.size)),Xt(c,e+12,et),Xt(c,e+14,lt),e+=16,d!=null&&(Xt(c,e,it),Xt(c,e+6,i.attrs),Xt(c,e+10,d),e+=14),c.set(s,e),e+=et,lt)for(var gt in nt){var vt=nt[gt],Ct=vt.length;Xt(c,e,+gt),Xt(c,e+2,Ct),c.set(vt,e+4),e+=4+Ct}return it&&(c.set(_,e),e+=it),e},HE=function(c,e,i,s,a){Xt(c,e,101010256),Xt(c,e+8,i),Xt(c,e+10,i),Xt(c,e+12,s),Xt(c,e+16,a)},vw=function(){function c(e){this.filename=e,this.c=gw(),this.size=0,this.compression=0}return c.prototype.process=function(e,i){this.ondata(null,e,i)},c.prototype.push=function(e,i){if(!this.ondata)throw"no callback - add to ZIP archive before pushing";this.c.p(e),this.size+=e.length,i&&(this.crc=this.c.d()),this.process(e,i||!1)},c}(),iI=function(){function c(e,i){var s=this;i||(i={}),vw.call(this,e),this.d=new On(i,function(a,h){s.ondata(null,a,h)}),this.compression=8,this.flag=Mo(i.level)}return c.prototype.process=function(e,i){try{this.d.push(e,i)}catch(s){this.ondata(s,null,i)}},c.prototype.push=function(e,i){vw.prototype.push.call(this,e,i)},c}(),rI=function(){function c(e,i){var s=this;i||(i={}),vw.call(this,e),this.d=new _r(i,function(a,h,d){s.ondata(a,h,d)}),this.compression=8,this.flag=Mo(i.level),this.terminate=this.d.terminate}return c.prototype.process=function(e,i){this.d.push(e,i)},c.prototype.push=function(e,i){vw.prototype.push.call(this,e,i)},c}(),qC=function(){function c(e){this.ondata=e,this.u=[],this.d=1}return c.prototype.add=function(e){var i=this;if(2&this.d)throw"stream finished";var s=Is(e.filename),a=s.length,h=e.comment,d=h&&Is(h),_=a!=e.filename.length||d&&h.length!=d.length,et=a+F0(e.extra)+30;if(a>65535)throw"filename too long";var nt=new $s(et);bu(nt,0,e,s,_);var it=[nt],lt=function(){for(var Ct=0,wt=it;Ct<wt.length;Ct++){var xt=wt[Ct];i.ondata(null,xt,!1)}it=[]},ut=this.d;this.d=0;var pt=this.u.length,gt=o(e,{f:s,u:_,o:d,t:function(){e.terminate&&e.terminate()},r:function(){if(lt(),ut){var Ct=i.u[pt+1];Ct?Ct.r():i.d=1}ut=1}}),vt=0;e.ondata=function(Ct,wt,xt){if(Ct)i.ondata(Ct,wt,xt),i.terminate();else if(vt+=wt.length,it.push(wt),xt){var _t=new $s(16);Xt(_t,0,134695760),Xt(_t,4,e.crc),Xt(_t,8,vt),Xt(_t,12,e.size),it.push(_t),gt.c=vt,gt.b=et+vt+16,gt.crc=e.crc,gt.size=e.size,ut&&gt.r(),ut=1}else ut&&lt()},this.u.push(gt)},c.prototype.end=function(){var e=this;if(2&this.d)throw 1&this.d?"stream finishing":"stream finished";this.d?this.e():this.u.push({r:function(){1&e.d&&(e.u.splice(-1,1),e.e())},t:function(){}}),this.d=3},c.prototype.e=function(){for(var e=0,i=0,s=0,a=0,h=this.u;a<h.length;a++)s+=46+(nt=h[a]).f.length+F0(nt.extra)+(nt.o?nt.o.length:0);for(var d=new $s(s+22),_=0,et=this.u;_<et.length;_++){var nt=et[_];bu(d,e,nt,nt.f,nt.u,nt.c,i,nt.o),e+=46+nt.f.length+F0(nt.extra)+(nt.o?nt.o.length:0),i+=nt.b}HE(d,e,this.u.length,s,i),this.ondata(null,d,!0),this.d=2},c.prototype.terminate=function(){for(var e=0,i=this.u;e<i.length;e++)i[e].t();this.d=2},c}();function sI(c,e,i){if(i||(i=e,e={}),typeof i!="function")throw"no callback";var s={};gs(c,"",s,e);var a=Object.keys(s),h=a.length,d=0,_=0,et=h,nt=new Array(h),it=[],lt=function(){for(var vt=0;vt<it.length;++vt)it[vt]()},ut=function(){var vt=new $s(_+22),Ct=d,wt=_-d;_=0;for(var xt=0;xt<et;++xt){var _t=nt[xt];try{var Pt=_t.c.length;bu(vt,_,_t,_t.f,_t.u,Pt);var Bt=30+_t.f.length+F0(_t.extra),Ot=_+Bt;vt.set(_t.c,Ot),bu(vt,d,_t,_t.f,_t.u,Pt,_,_t.m),d+=16+Bt+(_t.m?_t.m.length:0),_=Ot+Pt}catch(Lt){return i(Lt,null)}}HE(vt,d,nt.length,wt,Ct),i(null,vt)};h||ut();for(var pt=function(vt){var Ct=a[vt],wt=s[Ct],xt=wt[0],_t=wt[1],Pt=gw(),Bt=xt.length;Pt.p(xt);var Ot=Is(Ct),Lt=Ot.length,qt=_t.comment,en=qt&&Is(qt),cn=en&&en.length,An=F0(_t.extra),mn=_t.level==0?0:8,Tn=function(vn,xn){if(vn)lt(),i(vn,null);else{var Un=xn.length;nt[vt]=o(_t,{size:Bt,crc:Pt.d(),c:xn,f:Ot,m:en,u:Lt!=Ct.length||en&&qt.length!=cn,compression:mn}),d+=30+Lt+An+Un,_+=76+2*(Lt+An)+(cn||0)+Un,--h||ut()}};if(Lt>65535&&Tn("filename too long",null),mn)if(Bt<16e4)try{Tn(null,gr(xt,_t))}catch(vn){Tn(vn,null)}else it.push(Tr(xt,_t,Tn));else Tn(null,xt)},gt=0;gt<et;++gt)pt(gt);return lt}function oI(c,e){e||(e={});var i={},s=[];gs(c,"",i,e);var a=0,h=0;for(var d in i){var _=i[d],et=_[0],nt=_[1],it=nt.level==0?0:8,lt=(Lt=Is(d)).length,ut=nt.comment,pt=ut&&Is(ut),gt=pt&&pt.length,vt=F0(nt.extra);if(lt>65535)throw"filename too long";var Ct=it?gr(et,nt):et,wt=Ct.length,xt=gw();xt.p(et),s.push(o(nt,{size:et.length,crc:xt.d(),c:Ct,f:Lt,m:pt,u:lt!=d.length||pt&&ut.length!=gt,o:a,compression:it})),a+=30+lt+vt+wt,h+=76+2*(lt+vt)+(gt||0)+wt}for(var _t=new $s(h+22),Pt=a,Bt=h-a,Ot=0;Ot<s.length;++Ot){var Lt=s[Ot];bu(_t,Lt.o,Lt,Lt.f,Lt.u,Lt.c.length);var qt=30+Lt.f.length+F0(Lt.extra);_t.set(Lt.c,Lt.o+qt),bu(_t,a,Lt,Lt.f,Lt.u,Lt.c.length,Lt.o,Lt.m),a+=16+qt+(Lt.m?Lt.m.length:0)}return HE(_t,a,s.length,Bt,Pt),_t}var P_=function(){function c(){}return c.prototype.push=function(e,i){this.ondata(null,e,i)},c.compression=0,c}(),aI=function(){function c(){var e=this;this.i=new Or(function(i,s){e.ondata(null,i,s)})}return c.prototype.push=function(e,i){try{this.i.push(e,i)}catch(s){this.ondata(s,e,i)}},c.compression=8,c}(),lI=function(){function c(e,i){var s=this;i<32e4?this.i=new Or(function(a,h){s.ondata(null,a,h)}):(this.i=new Gr(function(a,h,d){s.ondata(a,h,d)}),this.terminate=this.i.terminate)}return c.prototype.push=function(e,i){this.i.terminate&&(e=Cm(e,0)),this.i.push(e,i)},c.compression=8,c}(),WE=function(){function c(e){this.onfile=e,this.k=[],this.o={0:P_},this.p=U0}return c.prototype.push=function(e,i){var s=this;if(!this.onfile)throw"no callback";if(!this.p)throw"stream finished";if(this.c>0){var a=Math.min(this.c,e.length),h=e.subarray(0,a);if(this.c-=a,this.d?this.d.push(h,!this.c):this.k[0].push(h),(e=e.subarray(a)).length)return this.push(e,i)}else{var d=0,_=0,et=void 0,nt=void 0;this.p.length?e.length?((nt=new $s(this.p.length+e.length)).set(this.p),nt.set(e,this.p.length)):nt=this.p:nt=e;for(var it=nt.length,lt=this.c,ut=lt&&this.d,pt=function(){var Ct,wt=Nt(nt,_);if(wt==67324752){d=1,et=_,gt.d=null,gt.c=0;var xt=Ft(nt,_+6),_t=Ft(nt,_+8),Pt=2048&xt,Bt=8&xt,Ot=Ft(nt,_+26),Lt=Ft(nt,_+28);if(it>_+30+Ot+Lt){var qt=[];gt.k.unshift(qt),d=2;var en,cn=Nt(nt,_+18),An=Nt(nt,_+22),mn=bo(nt.subarray(_+30,_+=30+Ot),!Pt);cn==4294967295?(Ct=Bt?[-2]:WC(nt,_),cn=Ct[0],An=Ct[1]):Bt&&(cn=-1),_+=Lt,gt.c=cn;var Tn={name:mn,compression:_t,start:function(){if(!Tn.ondata)throw"no callback";if(cn){var vn=s.o[_t];if(!vn)throw"unknown compression type "+_t;(en=cn<0?new vn(mn):new vn(mn,cn,An)).ondata=function(Gn,rr,dr){Tn.ondata(Gn,rr,dr)};for(var xn=0,Un=qt;xn<Un.length;xn++){var Mn=Un[xn];en.push(Mn,!1)}s.k[0]==qt&&s.c?s.d=en:en.push(U0,!0)}else Tn.ondata(null,U0,!0)},terminate:function(){en&&en.terminate&&en.terminate()}};cn>=0&&(Tn.size=cn,Tn.originalSize=An),gt.onfile(Tn)}return"break"}if(lt){if(wt==134695760)return et=_+=12+(lt==-2&&8),d=3,gt.c=0,"break";if(wt==33639248)return et=_-=4,d=3,gt.c=0,"break"}},gt=this;_<it-4&&pt()!=="break";++_);if(this.p=U0,lt<0){var vt=d?nt.subarray(0,et-12-(lt==-2&&8)-(Nt(nt,et-16)==134695760&&4)):nt.subarray(0,_);ut?ut.push(vt,!!d):this.k[+(d==2)].push(vt)}if(2&d)return this.push(nt.subarray(_),i);this.p=nt.subarray(_)}if(i){if(this.c)throw"invalid zip file";this.p=null}},c.prototype.register=function(e){this.o[e.compression]=e},c}();function DD(c,e){if(typeof e!="function")throw"no callback";for(var i=[],s=function(){for(var ut=0;ut<i.length;++ut)i[ut]()},a={},h=c.length-22;Nt(c,h)!=101010256;--h)if(!h||c.length-h>65558)return void e("invalid zip file",null);var d=Ft(c,h+8);d||e(null,{});var _=d,et=Nt(c,h+16),nt=et==4294967295;if(nt){if(h=Nt(c,h-12),Nt(c,h)!=101075792)return void e("invalid zip file",null);_=d=Nt(c,h+32),et=Nt(c,h+48)}for(var it=function(ut){var pt=es(c,et,nt),gt=pt[0],vt=pt[1],Ct=pt[2],wt=pt[3],xt=pt[4],_t=pt[5],Pt=Wx(c,_t);et=xt;var Bt=function(Lt,qt){Lt?(s(),e(Lt,null)):(a[wt]=qt,--d||e(null,a))};if(gt)if(gt==8){var Ot=c.subarray(Pt,Pt+vt);if(vt<32e4)try{Bt(null,ur(Ot,new $s(Ct)))}catch(Lt){Bt(Lt,null)}else i.push(cr(Ot,{size:Ct},Bt))}else Bt("unknown compression type "+gt,null);else Bt(null,Cm(c,Pt,Pt+vt))},lt=0;lt<_;++lt)it();return s}function qE(c){for(var e={},i=c.length-22;Nt(c,i)!=101010256;--i)if(!i||c.length-i>65558)throw"invalid zip file";var s=Ft(c,i+8);if(!s)return{};var a=Nt(c,i+16),h=a==4294967295;if(h){if(i=Nt(c,i-12),Nt(c,i)!=101075792)throw"invalid zip file";s=Nt(c,i+32),a=Nt(c,i+48)}for(var d=0;d<s;++d){var _=es(c,a,h),et=_[0],nt=_[1],it=_[2],lt=_[3],ut=_[4],pt=_[5],gt=Wx(c,pt);if(a=ut,et){if(et!=8)throw"unknown compression type "+et;e[lt]=ur(c.subarray(gt,gt+nt),new $s(it))}else e[lt]=Cm(c,gt,gt+nt)}return e}class cI extends b.yxD{constructor(e){super(e),this.type=b.cLu}parse(e){const h=Math.pow(2.7182818,2.2),d={l:0,c:0,lc:0};function _(nn,Nn,on,Qn,Jn){for(;on<nn;)Nn=Nn<<8|xr(Qn,Jn),on+=8;on-=nn,d.l=Nn>>on&(1<<nn)-1,d.c=Nn,d.lc=on}const et=new Array(59);function nt(nn){return 63&nn}function it(nn){return nn>>6}const lt={c:0,lc:0};function ut(nn,Nn,on,Qn){nn=nn<<8|xr(on,Qn),Nn+=8,lt.c=nn,lt.lc=Nn}const pt={c:0,lc:0};function gt(nn,Nn,on,Qn,Jn,Vn,sr,jr,Zr){if(nn==Nn){Qn<8&&(ut(on,Qn,Jn,Vn),on=lt.c,Qn=lt.lc);let os=on>>(Qn-=8);if(os=new Uint8Array([os])[0],jr.value+os>Zr)return!1;const is=sr[jr.value-1];for(;os-- >0;)sr[jr.value++]=is}else{if(!(jr.value<Zr))return!1;sr[jr.value++]=nn}pt.c=on,pt.lc=Qn}function vt(nn){return 65535&nn}function Ct(nn){const Nn=vt(nn);return Nn>32767?Nn-65536:Nn}const wt={a:0,b:0};function xt(nn,Nn){const on=Ct(nn),Qn=Ct(Nn),Jn=on+(1&Qn)+(Qn>>1),Vn=Jn,sr=Jn-Qn;wt.a=Vn,wt.b=sr}function _t(nn,Nn){const on=vt(nn),Qn=vt(Nn),Jn=on-(Qn>>1)&65535,Vn=Qn+Jn-32768&65535;wt.a=Vn,wt.b=Jn}function Pt(nn,Nn,on,Qn,Jn,Vn,sr){const jr=sr<16384,Zr=on>Jn?Jn:on;let os,is,cs=1;for(;cs<=Zr;)cs<<=1;for(cs>>=1,os=cs,cs>>=1;cs>=1;){is=0;const ns=is+Vn*(Jn-os),$r=Vn*cs,ms=Vn*os,Wr=Qn*cs,vs=Qn*os;let bs,ks,yl,Vo;for(;is<=ns;is+=ms){let _s=is;const zs=is+Qn*(on-os);for(;_s<=zs;_s+=vs){const oo=_s+Wr,zu=_s+$r,Bm=zu+Wr;jr?(xt(nn[_s+Nn],nn[zu+Nn]),bs=wt.a,yl=wt.b,xt(nn[oo+Nn],nn[Bm+Nn]),ks=wt.a,Vo=wt.b,xt(bs,ks),nn[_s+Nn]=wt.a,nn[oo+Nn]=wt.b,xt(yl,Vo),nn[zu+Nn]=wt.a,nn[Bm+Nn]=wt.b):(_t(nn[_s+Nn],nn[zu+Nn]),bs=wt.a,yl=wt.b,_t(nn[oo+Nn],nn[Bm+Nn]),ks=wt.a,Vo=wt.b,_t(bs,ks),nn[_s+Nn]=wt.a,nn[oo+Nn]=wt.b,_t(yl,Vo),nn[zu+Nn]=wt.a,nn[Bm+Nn]=wt.b)}if(on&cs){const oo=_s+$r;jr?xt(nn[_s+Nn],nn[oo+Nn]):_t(nn[_s+Nn],nn[oo+Nn]),bs=wt.a,nn[oo+Nn]=wt.b,nn[_s+Nn]=bs}}if(Jn&cs){let _s=is;const zs=is+Qn*(on-os);for(;_s<=zs;_s+=vs){const oo=_s+Wr;jr?xt(nn[_s+Nn],nn[oo+Nn]):_t(nn[_s+Nn],nn[oo+Nn]),bs=wt.a,nn[oo+Nn]=wt.b,nn[_s+Nn]=bs}}os=cs,cs>>=1}return is}function Bt(nn,Nn,on,Qn,Jn,Vn){const sr=on.value,jr=_i(Nn,on),Zr=_i(Nn,on);on.value+=4;const os=_i(Nn,on);if(on.value+=4,jr<0||jr>=65537||Zr<0||Zr>=65537)throw new Error("Something wrong with HUF_ENCSIZE");const is=new Array(65537),cs=new Array(16384);if(function(ns){for(let $r=0;$r<16384;$r++)ns[$r]={},ns[$r].len=0,ns[$r].lit=0,ns[$r].p=null}(cs),function(ns,$r,ms,Wr,vs,bs){const ks=$r;let yl=0,Vo=0;for(;Wr<=vs;Wr++){if(ks.value-$r.value>ms)return!1;_(6,yl,Vo,ns,ks);const _s=d.l;if(yl=d.c,Vo=d.lc,bs[Wr]=_s,_s==63){if(ks.value-$r.value>ms)throw new Error("Something wrong with hufUnpackEncTable");_(8,yl,Vo,ns,ks);let zs=d.l+6;if(yl=d.c,Vo=d.lc,Wr+zs>vs+1)throw new Error("Something wrong with hufUnpackEncTable");for(;zs--;)bs[Wr++]=0;Wr--}else if(_s>=59){let zs=_s-59+2;if(Wr+zs>vs+1)throw new Error("Something wrong with hufUnpackEncTable");for(;zs--;)bs[Wr++]=0;Wr--}}(function(_s){for(let oo=0;oo<=58;++oo)et[oo]=0;for(let oo=0;oo<65537;++oo)et[_s[oo]]+=1;let zs=0;for(let oo=58;oo>0;--oo){const zu=zs+et[oo]>>1;et[oo]=zs,zs=zu}for(let oo=0;oo<65537;++oo){const zu=_s[oo];zu>0&&(_s[oo]=zu|et[zu]++<<6)}})(bs)}(nn,on,Qn-(on.value-sr),jr,Zr,is),os>8*(Qn-(on.value-sr)))throw new Error("Something wrong with hufUncompress");(function(ns,$r,ms,Wr){for(;$r<=ms;$r++){const vs=it(ns[$r]),bs=nt(ns[$r]);if(vs>>bs)throw new Error("Invalid table entry");if(bs>14){const ks=Wr[vs>>bs-14];if(ks.len)throw new Error("Invalid table entry");if(ks.lit++,ks.p){const yl=ks.p;ks.p=new Array(ks.lit);for(let Vo=0;Vo<ks.lit-1;++Vo)ks.p[Vo]=yl[Vo]}else ks.p=new Array(1);ks.p[ks.lit-1]=$r}else if(bs){let ks=0;for(let yl=1<<14-bs;yl>0;yl--){const Vo=Wr[(vs<<14-bs)+ks];if(Vo.len||Vo.p)throw new Error("Invalid table entry");Vo.len=bs,Vo.lit=$r,ks++}}}})(is,jr,Zr,cs),function(ns,$r,ms,Wr,vs,bs,ks,yl,Vo){let _s=0,zs=0;const oo=ks,zu=Math.trunc(Wr.value+(vs+7)/8);for(;Wr.value<zu;)for(ut(_s,zs,ms,Wr),_s=lt.c,zs=lt.lc;zs>=14;){const tp=$r[_s>>zs-14&16383];if(tp.len)zs-=tp.len,gt(tp.lit,bs,_s,zs,ms,Wr,yl,Vo,oo),_s=pt.c,zs=pt.lc;else{if(!tp.p)throw new Error("hufDecode issues");let vy;for(vy=0;vy<tp.lit;vy++){const A1=nt(ns[tp.p[vy]]);for(;zs<A1&&Wr.value<zu;)ut(_s,zs,ms,Wr),_s=lt.c,zs=lt.lc;if(zs>=A1&&it(ns[tp.p[vy]])==(_s>>zs-A1&(1<<A1)-1)){zs-=A1,gt(tp.p[vy],bs,_s,zs,ms,Wr,yl,Vo,oo),_s=pt.c,zs=pt.lc;break}}if(vy==tp.lit)throw new Error("hufDecode issues")}}const Bm=8-vs&7;for(_s>>=Bm,zs-=Bm;zs>0;){const tp=$r[_s<<14-zs&16383];if(!tp.len)throw new Error("hufDecode issues");zs-=tp.len,gt(tp.lit,bs,_s,zs,ms,Wr,yl,Vo,oo),_s=pt.c,zs=pt.lc}}(is,cs,nn,on,os,Zr,Vn,Jn,{value:0})}function Ot(nn){for(let Nn=1;Nn<nn.length;Nn++){const on=nn[Nn-1]+nn[Nn]-128;nn[Nn]=on}}function Lt(nn,Nn){let on=0,Qn=Math.floor((nn.length+1)/2),Jn=0;const Vn=nn.length-1;for(;!(Jn>Vn||(Nn[Jn++]=nn[on++],Jn>Vn));)Nn[Jn++]=nn[Qn++]}function qt(nn){let Nn=nn.byteLength;const on=new Array;let Qn=0;const Jn=new DataView(nn);for(;Nn>0;){const Vn=Jn.getInt8(Qn++);if(Vn<0){const sr=-Vn;Nn-=sr+1;for(let jr=0;jr<sr;jr++)on.push(Jn.getUint8(Qn++))}else{const sr=Vn;Nn-=2;const jr=Jn.getUint8(Qn++);for(let Zr=0;Zr<sr+1;Zr++)on.push(jr)}}return on}function en(nn,Nn,on){let Qn,Jn=1;for(;Jn<64;)Qn=Nn[nn.value],Qn==65280?Jn=64:Qn>>8==255?Jn+=255&Qn:(on[Jn]=Qn,Jn++),nn.value++}function cn(nn){const Nn=.5*Math.cos(.7853975),on=.5*Math.cos(3.14159/16),Qn=.5*Math.cos(3.14159/8),Jn=.5*Math.cos(3*3.14159/16),Vn=.5*Math.cos(.981746875),sr=.5*Math.cos(3*3.14159/8),jr=.5*Math.cos(1.374445625),Zr=new Array(4),os=new Array(4),is=new Array(4),cs=new Array(4);for(let ns=0;ns<8;++ns){const $r=8*ns;Zr[0]=Qn*nn[$r+2],Zr[1]=sr*nn[$r+2],Zr[2]=Qn*nn[$r+6],Zr[3]=sr*nn[$r+6],os[0]=on*nn[$r+1]+Jn*nn[$r+3]+Vn*nn[$r+5]+jr*nn[$r+7],os[1]=Jn*nn[$r+1]-jr*nn[$r+3]-on*nn[$r+5]-Vn*nn[$r+7],os[2]=Vn*nn[$r+1]-on*nn[$r+3]+jr*nn[$r+5]+Jn*nn[$r+7],os[3]=jr*nn[$r+1]-Vn*nn[$r+3]+Jn*nn[$r+5]-on*nn[$r+7],is[0]=Nn*(nn[$r+0]+nn[$r+4]),is[3]=Nn*(nn[$r+0]-nn[$r+4]),is[1]=Zr[0]+Zr[3],is[2]=Zr[1]-Zr[2],cs[0]=is[0]+is[1],cs[1]=is[3]+is[2],cs[2]=is[3]-is[2],cs[3]=is[0]-is[1],nn[$r+0]=cs[0]+os[0],nn[$r+1]=cs[1]+os[1],nn[$r+2]=cs[2]+os[2],nn[$r+3]=cs[3]+os[3],nn[$r+4]=cs[3]-os[3],nn[$r+5]=cs[2]-os[2],nn[$r+6]=cs[1]-os[1],nn[$r+7]=cs[0]-os[0]}for(let ns=0;ns<8;++ns)Zr[0]=Qn*nn[16+ns],Zr[1]=sr*nn[16+ns],Zr[2]=Qn*nn[48+ns],Zr[3]=sr*nn[48+ns],os[0]=on*nn[8+ns]+Jn*nn[24+ns]+Vn*nn[40+ns]+jr*nn[56+ns],os[1]=Jn*nn[8+ns]-jr*nn[24+ns]-on*nn[40+ns]-Vn*nn[56+ns],os[2]=Vn*nn[8+ns]-on*nn[24+ns]+jr*nn[40+ns]+Jn*nn[56+ns],os[3]=jr*nn[8+ns]-Vn*nn[24+ns]+Jn*nn[40+ns]-on*nn[56+ns],is[0]=Nn*(nn[ns]+nn[32+ns]),is[3]=Nn*(nn[ns]-nn[32+ns]),is[1]=Zr[0]+Zr[3],is[2]=Zr[1]-Zr[2],cs[0]=is[0]+is[1],cs[1]=is[3]+is[2],cs[2]=is[3]-is[2],cs[3]=is[0]-is[1],nn[0+ns]=cs[0]+os[0],nn[8+ns]=cs[1]+os[1],nn[16+ns]=cs[2]+os[2],nn[24+ns]=cs[3]+os[3],nn[32+ns]=cs[3]-os[3],nn[40+ns]=cs[2]-os[2],nn[48+ns]=cs[1]-os[1],nn[56+ns]=cs[0]-os[0]}function An(nn){for(let Nn=0;Nn<64;++Nn){const on=nn[0][Nn],Qn=nn[1][Nn],Jn=nn[2][Nn];nn[0][Nn]=on+1.5747*Jn,nn[1][Nn]=on-.1873*Qn-.4682*Jn,nn[2][Nn]=on+1.8556*Qn}}function mn(nn,Nn,on){for(let Jn=0;Jn<64;++Jn)Nn[on+Jn]=b.A5E.toHalfFloat((Qn=nn[Jn])<=1?Math.sign(Qn)*Math.pow(Math.abs(Qn),2.2):Math.sign(Qn)*Math.pow(h,Math.abs(Qn)-1));var Qn}function Tn(nn){return new DataView(nn.array.buffer,nn.offset.value,nn.size)}function vn(nn){const Nn=nn.viewer.buffer.slice(nn.offset.value,nn.offset.value+nn.size),on=new Uint8Array(qt(Nn)),Qn=new Uint8Array(on.length);return Ot(on),Lt(on,Qn),new DataView(Qn.buffer)}function xn(nn){const Nn=nn.array.slice(nn.offset.value,nn.offset.value+nn.size);tt===void 0&&console.error("THREE.EXRLoader: External library fflate.min.js required.");const on=or(Nn),Qn=new Uint8Array(on.length);return Ot(on),Lt(on,Qn),new DataView(Qn.buffer)}function Un(nn){const Nn=nn.viewer,on={value:nn.offset.value},Qn=new Uint16Array(nn.width*nn.scanlineBlockSize*(nn.channels*nn.type)),Jn=new Uint8Array(8192);let Vn=0;const sr=new Array(nn.channels);for(let ms=0;ms<nn.channels;ms++)sr[ms]={},sr[ms].start=Vn,sr[ms].end=sr[ms].start,sr[ms].nx=nn.width,sr[ms].ny=nn.lines,sr[ms].size=nn.type,Vn+=sr[ms].nx*sr[ms].ny*sr[ms].size;const jr=Us(Nn,on),Zr=Us(Nn,on);if(Zr>=8192)throw new Error("Something is wrong with PIZ_COMPRESSION BITMAP_SIZE");if(jr<=Zr)for(let ms=0;ms<Zr-jr+1;ms++)Jn[ms+jr]=Cr(Nn,on);const os=new Uint16Array(65536),is=function(ms,Wr){let vs=0;for(let ks=0;ks<65536;++ks)(ks==0||ms[ks>>3]&1<<(7&ks))&&(Wr[vs++]=ks);const bs=vs-1;for(;vs<65536;)Wr[vs++]=0;return bs}(Jn,os),cs=_i(Nn,on);Bt(nn.array,Nn,on,cs,Qn,Vn);for(let ms=0;ms<nn.channels;++ms){const Wr=sr[ms];for(let vs=0;vs<sr[ms].size;++vs)Pt(Qn,Wr.start+vs,Wr.nx,Wr.size,Wr.ny,Wr.nx*Wr.size,is)}(function(ms,Wr,vs){for(let bs=0;bs<vs;++bs)Wr[bs]=ms[Wr[bs]]})(os,Qn,Vn);let ns=0;const $r=new Uint8Array(Qn.buffer.byteLength);for(let ms=0;ms<nn.lines;ms++)for(let Wr=0;Wr<nn.channels;Wr++){const vs=sr[Wr],bs=vs.nx*vs.size,ks=new Uint8Array(Qn.buffer,2*vs.end,2*bs);$r.set(ks,ns),ns+=2*bs,vs.end+=bs}return new DataView($r.buffer)}function Mn(nn){const Nn=nn.array.slice(nn.offset.value,nn.offset.value+nn.size);tt===void 0&&console.error("THREE.EXRLoader: External library fflate.min.js required.");const on=or(Nn),Qn=nn.lines*nn.channels*nn.width,Jn=nn.type==1?new Uint16Array(Qn):new Uint32Array(Qn);let Vn=0,sr=0;const jr=new Array(4);for(let Zr=0;Zr<nn.lines;Zr++)for(let os=0;os<nn.channels;os++){let is=0;switch(nn.type){case 1:jr[0]=Vn,jr[1]=jr[0]+nn.width,Vn=jr[1]+nn.width;for(let cs=0;cs<nn.width;++cs)is+=on[jr[0]++]<<8|on[jr[1]++],Jn[sr]=is,sr++;break;case 2:jr[0]=Vn,jr[1]=jr[0]+nn.width,jr[2]=jr[1]+nn.width,Vn=jr[2]+nn.width;for(let cs=0;cs<nn.width;++cs)is+=on[jr[0]++]<<24|on[jr[1]++]<<16|on[jr[2]++]<<8,Jn[sr]=is,sr++}}return new DataView(Jn.buffer)}function Gn(nn){const Nn=nn.viewer,on={value:nn.offset.value},Qn=new Uint8Array(nn.width*nn.lines*(nn.channels*nn.type*2)),Jn={version:Mr(Nn,on),unknownUncompressedSize:Mr(Nn,on),unknownCompressedSize:Mr(Nn,on),acCompressedSize:Mr(Nn,on),dcCompressedSize:Mr(Nn,on),rleCompressedSize:Mr(Nn,on),rleUncompressedSize:Mr(Nn,on),rleRawSize:Mr(Nn,on),totalAcUncompressedCount:Mr(Nn,on),totalDcUncompressedCount:Mr(Nn,on),acCompression:Mr(Nn,on)};if(Jn.version<2)throw new Error("EXRLoader.parse: "+Rr.compression+" version "+Jn.version+" is unsupported");const Vn=new Array;let sr=Us(Nn,on)-2;for(;sr>0;){const Wr=rr(Nn.buffer,on),vs=Cr(Nn,on),bs=vs>>2&3,ks=new Int8Array([(vs>>4)-1])[0],yl=Cr(Nn,on);Vn.push({name:Wr,index:ks,type:yl,compression:bs}),sr-=Wr.length+3}const jr=Rr.channels,Zr=new Array(nn.channels);for(let Wr=0;Wr<nn.channels;++Wr){const vs=Zr[Wr]={},bs=jr[Wr];vs.name=bs.name,vs.compression=0,vs.decoded=!1,vs.type=bs.pixelType,vs.pLinear=bs.pLinear,vs.width=nn.width,vs.height=nn.lines}const os={idx:new Array(3)};for(let Wr=0;Wr<nn.channels;++Wr){const vs=Zr[Wr];for(let bs=0;bs<Vn.length;++bs){const ks=Vn[bs];vs.name==ks.name&&(vs.compression=ks.compression,ks.index>=0&&(os.idx[ks.index]=Wr),vs.offset=Wr)}}let is,cs,ns;if(Jn.acCompressedSize>0)switch(Jn.acCompression){case 0:is=new Uint16Array(Jn.totalAcUncompressedCount),Bt(nn.array,Nn,on,Jn.acCompressedSize,is,Jn.totalAcUncompressedCount);break;case 1:const Wr=or(nn.array.slice(on.value,on.value+Jn.totalAcUncompressedCount));is=new Uint16Array(Wr.buffer),on.value+=Jn.totalAcUncompressedCount}if(Jn.dcCompressedSize>0){const Wr={array:nn.array,offset:on,size:Jn.dcCompressedSize};cs=new Uint16Array(xn(Wr).buffer),on.value+=Jn.dcCompressedSize}Jn.rleRawSize>0&&(ns=qt(or(nn.array.slice(on.value,on.value+Jn.rleCompressedSize)).buffer),on.value+=Jn.rleCompressedSize);let $r=0;const ms=new Array(Zr.length);for(let Wr=0;Wr<ms.length;++Wr)ms[Wr]=new Array;for(let Wr=0;Wr<nn.lines;++Wr)for(let vs=0;vs<Zr.length;++vs)ms[vs].push($r),$r+=Zr[vs].width*nn.type*2;(function(Wr,vs,bs,ks,yl,Vo){let _s=new DataView(Vo.buffer);const zs=bs[Wr.idx[0]].width,oo=bs[Wr.idx[0]].height,zu=Math.floor(zs/8),Bm=Math.ceil(zs/8),tp=Math.ceil(oo/8),vy=zs-8*(Bm-1),A1=oo-8*(tp-1),lF={value:0},IR=new Array(3),RM=new Array(3),BM=new Array(3),K0=new Array(3),tD=new Array(3);for(let Bl=0;Bl<3;++Bl)tD[Bl]=vs[Wr.idx[Bl]],IR[Bl]=Bl<1?0:IR[Bl-1]+Bm*tp,RM[Bl]=new Float32Array(64),BM[Bl]=new Uint16Array(64),K0[Bl]=new Uint16Array(64*Bm);for(let Bl=0;Bl<tp;++Bl){let PS=8;Bl==tp-1&&(PS=A1);let RS=8;for(let $o=0;$o<Bm;++$o){$o==Bm-1&&(RS=vy);for(let Ml=0;Ml<3;++Ml)BM[Ml].fill(0),BM[Ml][0]=yl[IR[Ml]++],en(lF,ks,BM[Ml]),hs=BM[Ml],(ps=RM[Ml])[0]=mr(hs[0]),ps[1]=mr(hs[1]),ps[2]=mr(hs[5]),ps[3]=mr(hs[6]),ps[4]=mr(hs[14]),ps[5]=mr(hs[15]),ps[6]=mr(hs[27]),ps[7]=mr(hs[28]),ps[8]=mr(hs[2]),ps[9]=mr(hs[4]),ps[10]=mr(hs[7]),ps[11]=mr(hs[13]),ps[12]=mr(hs[16]),ps[13]=mr(hs[26]),ps[14]=mr(hs[29]),ps[15]=mr(hs[42]),ps[16]=mr(hs[3]),ps[17]=mr(hs[8]),ps[18]=mr(hs[12]),ps[19]=mr(hs[17]),ps[20]=mr(hs[25]),ps[21]=mr(hs[30]),ps[22]=mr(hs[41]),ps[23]=mr(hs[43]),ps[24]=mr(hs[9]),ps[25]=mr(hs[11]),ps[26]=mr(hs[18]),ps[27]=mr(hs[24]),ps[28]=mr(hs[31]),ps[29]=mr(hs[40]),ps[30]=mr(hs[44]),ps[31]=mr(hs[53]),ps[32]=mr(hs[10]),ps[33]=mr(hs[19]),ps[34]=mr(hs[23]),ps[35]=mr(hs[32]),ps[36]=mr(hs[39]),ps[37]=mr(hs[45]),ps[38]=mr(hs[52]),ps[39]=mr(hs[54]),ps[40]=mr(hs[20]),ps[41]=mr(hs[22]),ps[42]=mr(hs[33]),ps[43]=mr(hs[38]),ps[44]=mr(hs[46]),ps[45]=mr(hs[51]),ps[46]=mr(hs[55]),ps[47]=mr(hs[60]),ps[48]=mr(hs[21]),ps[49]=mr(hs[34]),ps[50]=mr(hs[37]),ps[51]=mr(hs[47]),ps[52]=mr(hs[50]),ps[53]=mr(hs[56]),ps[54]=mr(hs[59]),ps[55]=mr(hs[61]),ps[56]=mr(hs[35]),ps[57]=mr(hs[36]),ps[58]=mr(hs[48]),ps[59]=mr(hs[49]),ps[60]=mr(hs[57]),ps[61]=mr(hs[58]),ps[62]=mr(hs[62]),ps[63]=mr(hs[63]),cn(RM[Ml]);An(RM);for(let Ml=0;Ml<3;++Ml)mn(RM[Ml],K0[Ml],64*$o)}let _v=0;for(let $o=0;$o<3;++$o){const Ml=bs[Wr.idx[$o]].type;for(let _y=8*Bl;_y<8*Bl+PS;++_y){_v=tD[$o][_y];for(let kM=0;kM<zu;++kM){const tA=64*kM+8*(7&_y);_s.setUint16(_v+0*Ml,K0[$o][tA+0],!0),_s.setUint16(_v+2*Ml,K0[$o][tA+1],!0),_s.setUint16(_v+4*Ml,K0[$o][tA+2],!0),_s.setUint16(_v+6*Ml,K0[$o][tA+3],!0),_s.setUint16(_v+8*Ml,K0[$o][tA+4],!0),_s.setUint16(_v+10*Ml,K0[$o][tA+5],!0),_s.setUint16(_v+12*Ml,K0[$o][tA+6],!0),_s.setUint16(_v+14*Ml,K0[$o][tA+7],!0),_v+=16*Ml}}if(zu!=Bm)for(let _y=8*Bl;_y<8*Bl+PS;++_y){const kM=tD[$o][_y]+8*zu*2*Ml,tA=64*zu+8*(7&_y);for(let nD=0;nD<RS;++nD)_s.setUint16(kM+2*nD*Ml,K0[$o][tA+nD],!0)}}}var hs,ps;const dL=new Uint16Array(zs);_s=new DataView(Vo.buffer);for(let Bl=0;Bl<3;++Bl){bs[Wr.idx[Bl]].decoded=!0;const PS=bs[Wr.idx[Bl]].type;if(bs[Bl].type==2)for(let RS=0;RS<oo;++RS){const _v=tD[Bl][RS];for(let $o=0;$o<zs;++$o)dL[$o]=_s.getUint16(_v+2*$o*PS,!0);for(let $o=0;$o<zs;++$o)_s.setFloat32(_v+2*$o*PS,mr(dL[$o]),!0)}}})(os,ms,Zr,is,cs,Qn);for(let Wr=0;Wr<Zr.length;++Wr){const vs=Zr[Wr];if(!vs.decoded){if(vs.compression!==2)throw new Error("EXRLoader.parse: unsupported channel compression");{let bs=0,ks=0;for(let yl=0;yl<nn.lines;++yl){let Vo=ms[Wr][bs];for(let _s=0;_s<vs.width;++_s){for(let zs=0;zs<2*vs.type;++zs)Qn[Vo++]=ns[ks+zs*vs.width*vs.height];ks++}bs++}}}}return new DataView(Qn.buffer)}function rr(nn,Nn){const on=new Uint8Array(nn);let Qn=0;for(;on[Nn.value+Qn]!=0;)Qn+=1;const Jn=new TextDecoder().decode(on.slice(Nn.value,Nn.value+Qn));return Nn.value=Nn.value+Qn+1,Jn}function dr(nn,Nn){const on=nn.getInt32(Nn.value,!0);return Nn.value=Nn.value+4,on}function _i(nn,Nn){const on=nn.getUint32(Nn.value,!0);return Nn.value=Nn.value+4,on}function xr(nn,Nn){const on=nn[Nn.value];return Nn.value=Nn.value+1,on}function Cr(nn,Nn){const on=nn.getUint8(Nn.value);return Nn.value=Nn.value+1,on}const Mr=function(nn,Nn){const on=Number(nn.getBigInt64(Nn.value,!0));return Nn.value+=8,on};function Lr(nn,Nn){const on=nn.getFloat32(Nn.value,!0);return Nn.value+=4,on}function ls(nn,Nn){return b.A5E.toHalfFloat(Lr(nn,Nn))}function mr(nn){const Nn=(31744&nn)>>10,on=1023&nn;return(nn>>15?-1:1)*(Nn?Nn===31?on?NaN:1/0:Math.pow(2,Nn-15)*(1+on/1024):on/1024*6103515625e-14)}function Us(nn,Nn){const on=nn.getUint16(Nn.value,!0);return Nn.value+=2,on}function Ws(nn,Nn){return mr(Us(nn,Nn))}function Fs(nn,Nn,on,Qn,Jn){return Qn==="string"||Qn==="stringvector"||Qn==="iccProfile"?function(Vn,sr,jr){const Zr=new TextDecoder().decode(new Uint8Array(Vn).slice(sr.value,sr.value+jr));return sr.value=sr.value+jr,Zr}(Nn,on,Jn):Qn==="chlist"?function(Vn,sr,jr,Zr){const os=jr.value,is=[];for(;jr.value<os+Zr-1;){const cs=rr(sr,jr),ns=dr(Vn,jr),$r=Cr(Vn,jr);jr.value+=3;const ms=dr(Vn,jr),Wr=dr(Vn,jr);is.push({name:cs,pixelType:ns,pLinear:$r,xSampling:ms,ySampling:Wr})}return jr.value+=1,is}(nn,Nn,on,Jn):Qn==="chromaticities"?function(Vn,sr){return{redX:Lr(Vn,sr),redY:Lr(Vn,sr),greenX:Lr(Vn,sr),greenY:Lr(Vn,sr),blueX:Lr(Vn,sr),blueY:Lr(Vn,sr),whiteX:Lr(Vn,sr),whiteY:Lr(Vn,sr)}}(nn,on):Qn==="compression"?function(Vn,sr){return["NO_COMPRESSION","RLE_COMPRESSION","ZIPS_COMPRESSION","ZIP_COMPRESSION","PIZ_COMPRESSION","PXR24_COMPRESSION","B44_COMPRESSION","B44A_COMPRESSION","DWAA_COMPRESSION","DWAB_COMPRESSION"][Cr(Vn,sr)]}(nn,on):Qn==="box2i"?function(Vn,sr){return{xMin:_i(Vn,sr),yMin:_i(Vn,sr),xMax:_i(Vn,sr),yMax:_i(Vn,sr)}}(nn,on):Qn==="lineOrder"?function(Vn,sr){return["INCREASING_Y"][Cr(Vn,sr)]}(nn,on):Qn==="float"?Lr(nn,on):Qn==="v2f"?function(Vn,sr){return[Lr(Vn,sr),Lr(Vn,sr)]}(nn,on):Qn==="v3f"?function(Vn,sr){return[Lr(Vn,sr),Lr(Vn,sr),Lr(Vn,sr)]}(nn,on):Qn==="int"?dr(nn,on):Qn==="rational"?function(Vn,sr){return[dr(Vn,sr),_i(Vn,sr)]}(nn,on):Qn==="timecode"?function(Vn,sr){return[_i(Vn,sr),_i(Vn,sr)]}(nn,on):Qn==="preview"?(on.value+=Jn,"skipped"):void(on.value+=Jn)}const co=new DataView(e),To=new Uint8Array(e),ar={value:0},Rr=function(nn,Nn,on){const Qn={};if(nn.getUint32(0,!0)!=20000630)throw new Error("THREE.EXRLoader: provided file doesn't appear to be in OpenEXR format.");Qn.version=nn.getUint8(4);const Jn=nn.getUint8(5);Qn.spec={singleTile:!!(2&Jn),longName:!!(4&Jn),deepFormat:!!(8&Jn),multiPart:!!(16&Jn)},on.value=8;let Vn=!0;for(;Vn;){const sr=rr(Nn,on);if(sr==0)Vn=!1;else{const jr=rr(Nn,on),Zr=Fs(nn,Nn,on,jr,_i(nn,on));Zr===void 0?console.warn(`EXRLoader.parse: skipped unknown header attribute type '${jr}'.`):Qn[sr]=Zr}}if(-5&Jn)throw console.error("EXRHeader:",Qn),new Error("THREE.EXRLoader: provided file is currently unsupported.");return Qn}(co,e,ar),Br=function(nn,Nn,on,Qn,Jn){const Vn={size:0,viewer:Nn,array:on,offset:Qn,width:nn.dataWindow.xMax-nn.dataWindow.xMin+1,height:nn.dataWindow.yMax-nn.dataWindow.yMin+1,channels:nn.channels.length,bytesPerLine:null,lines:null,inputSize:null,type:nn.channels[0].pixelType,uncompress:null,getter:null,format:null,encoding:null};switch(nn.compression){case"NO_COMPRESSION":Vn.lines=1,Vn.uncompress=Tn;break;case"RLE_COMPRESSION":Vn.lines=1,Vn.uncompress=vn;break;case"ZIPS_COMPRESSION":Vn.lines=1,Vn.uncompress=xn;break;case"ZIP_COMPRESSION":Vn.lines=16,Vn.uncompress=xn;break;case"PIZ_COMPRESSION":Vn.lines=32,Vn.uncompress=Un;break;case"PXR24_COMPRESSION":Vn.lines=16,Vn.uncompress=Mn;break;case"DWAA_COMPRESSION":Vn.lines=32,Vn.uncompress=Gn;break;case"DWAB_COMPRESSION":Vn.lines=256,Vn.uncompress=Gn;break;default:throw new Error("EXRLoader.parse: "+nn.compression+" is unsupported")}if(Vn.scanlineBlockSize=Vn.lines,Vn.type==1)switch(Jn){case b.VzW:Vn.getter=Ws,Vn.inputSize=2;break;case b.cLu:Vn.getter=Us,Vn.inputSize=2}else{if(Vn.type!=2)throw new Error("EXRLoader.parse: unsupported pixelType "+Vn.type+" for "+nn.compression+".");switch(Jn){case b.VzW:Vn.getter=Lr,Vn.inputSize=4;break;case b.cLu:Vn.getter=ls,Vn.inputSize=4}}Vn.blockCount=(nn.dataWindow.yMax+1)/Vn.scanlineBlockSize;for(let jr=0;jr<Vn.blockCount;jr++)Mr(Nn,Qn);Vn.outputChannels=Vn.channels==3?4:Vn.channels;const sr=Vn.width*Vn.height*Vn.outputChannels;switch(Jn){case b.VzW:Vn.byteArray=new Float32Array(sr),Vn.channels<Vn.outputChannels&&Vn.byteArray.fill(1,0,sr);break;case b.cLu:Vn.byteArray=new Uint16Array(sr),Vn.channels<Vn.outputChannels&&Vn.byteArray.fill(15360,0,sr);break;default:console.error("THREE.EXRLoader: unsupported type: ",Jn)}return Vn.bytesPerLine=Vn.width*Vn.inputSize*Vn.channels,Vn.outputChannels==4?(Vn.format=b.wk1,Vn.encoding=b.rnI):(Vn.format=b.hEm,Vn.encoding=b.rnI),Vn}(Rr,co,To,ar,this.type),js={value:0},Eo={R:0,G:1,B:2,A:3,Y:0};for(let nn=0;nn<Br.height/Br.scanlineBlockSize;nn++){const Nn=_i(co,ar);Br.size=_i(co,ar),Br.lines=Nn+Br.scanlineBlockSize>Br.height?Br.height-Nn:Br.scanlineBlockSize;const on=Br.size<Br.lines*Br.bytesPerLine?Br.uncompress(Br):Tn(Br);ar.value+=Br.size;for(let Qn=0;Qn<Br.scanlineBlockSize;Qn++){const Jn=Qn+nn*Br.scanlineBlockSize;if(Jn>=Br.height)break;for(let Vn=0;Vn<Br.channels;Vn++){const sr=Eo[Rr.channels[Vn].name];for(let jr=0;jr<Br.width;jr++){js.value=(Qn*(Br.channels*Br.width)+Vn*Br.width+jr)*Br.inputSize;const Zr=(Br.height-1-Jn)*(Br.width*Br.outputChannels)+jr*Br.outputChannels+sr;Br.byteArray[Zr]=Br.getter(on,js)}}}}return{header:Rr,width:Br.width,height:Br.height,data:Br.byteArray,format:Br.format,encoding:Br.encoding,type:this.type}}setDataType(e){return this.type=e,this}load(e,i,s,a){return super.load(e,function(h,d){h.encoding=d.encoding,h.minFilter=b.wem,h.magFilter=b.wem,h.generateMipmaps=!1,h.flipY=!1,i&&i(h,d)},s,a)}}class Sn extends ot{constructor(){super(...arguments),this.dependencies=[qr]}async onAdded(e){this._importer||(this._importer=new Wo(class extends cI{constructor(i){super(i),this.setDataType(WS(e.renderer.rendererObject))}},["exr"],!1)),io.Importers.push(this._importer)}async onDispose(e){this._importer=void 0}async onRemove(e){this._importer&&io.Importers.splice(io.Importers.indexOf(this._importer),1),this._importer=void 0}}function fr(c,e,i){const s=i.length-c-1;if(e>=i[s])return s-1;if(e<=i[c])return c;let a=c,h=s,d=Math.floor((a+h)/2);for(;e<i[d]||e>=i[d+1];)e<i[d]?h=d:a=d,d=Math.floor((a+h)/2);return d}function br(c,e){let i=1;for(let a=2;a<=c;++a)i*=a;let s=1;for(let a=2;a<=e;++a)s*=a;for(let a=2;a<=c-e;++a)s*=a;return i/s}Sn.PluginType="EXRLoadPlugin";class wr extends b.Hyl{constructor(e,i,s,a,h){super(),this.degree=e,this.knots=i,this.controlPoints=[],this.startKnot=a||0,this.endKnot=h||this.knots.length-1;for(let d=0;d<s.length;++d){const _=s[d];this.controlPoints[d]=new b.Ltg(_.x,_.y,_.z,_.w)}}getPoint(e,i=new b.Pa4){const s=i,a=this.knots[this.startKnot]+e*(this.knots[this.endKnot]-this.knots[this.startKnot]),h=function(d,_,et,nt){const it=fr(d,nt,_),lt=function(pt,gt,vt,Ct){const wt=[],xt=[],_t=[];wt[0]=1;for(let Pt=1;Pt<=vt;++Pt){xt[Pt]=gt-Ct[pt+1-Pt],_t[Pt]=Ct[pt+Pt]-gt;let Bt=0;for(let Ot=0;Ot<Pt;++Ot){const Lt=_t[Ot+1],qt=xt[Pt-Ot],en=wt[Ot]/(Lt+qt);wt[Ot]=Bt+Lt*en,Bt=qt*en}wt[Pt]=Bt}return wt}(it,nt,d,_),ut=new b.Ltg(0,0,0,0);for(let pt=0;pt<=d;++pt){const gt=et[it-d+pt],vt=lt[pt],Ct=gt.w*vt;ut.x+=gt.x*Ct,ut.y+=gt.y*Ct,ut.z+=gt.z*Ct,ut.w+=gt.w*vt}return ut}(this.degree,this.knots,this.controlPoints,a);return h.w!==1&&h.divideScalar(h.w),s.set(h.x,h.y,h.z)}getTangent(e,i=new b.Pa4){const s=i,a=this.knots[0]+e*(this.knots[this.knots.length-1]-this.knots[0]),h=function(d,_,et,nt,it){const lt=function(ut,pt,gt,vt,Ct){const wt=Ct<ut?Ct:ut,xt=[],_t=fr(ut,vt,pt),Pt=function(Ot,Lt,qt,en,cn){const An=[];for(let Mn=0;Mn<=qt;++Mn)An[Mn]=0;const mn=[];for(let Mn=0;Mn<=en;++Mn)mn[Mn]=An.slice(0);const Tn=[];for(let Mn=0;Mn<=qt;++Mn)Tn[Mn]=An.slice(0);Tn[0][0]=1;const vn=An.slice(0),xn=An.slice(0);for(let Mn=1;Mn<=qt;++Mn){vn[Mn]=Lt-cn[Ot+1-Mn],xn[Mn]=cn[Ot+Mn]-Lt;let Gn=0;for(let rr=0;rr<Mn;++rr){const dr=xn[rr+1],_i=vn[Mn-rr];Tn[Mn][rr]=dr+_i;const xr=Tn[rr][Mn-1]/Tn[Mn][rr];Tn[rr][Mn]=Gn+dr*xr,Gn=_i*xr}Tn[Mn][Mn]=Gn}for(let Mn=0;Mn<=qt;++Mn)mn[0][Mn]=Tn[Mn][qt];for(let Mn=0;Mn<=qt;++Mn){let Gn=0,rr=1;const dr=[];for(let _i=0;_i<=qt;++_i)dr[_i]=An.slice(0);dr[0][0]=1;for(let _i=1;_i<=en;++_i){let xr=0;const Cr=Mn-_i,Mr=qt-_i;Mn>=_i&&(dr[rr][0]=dr[Gn][0]/Tn[Mr+1][Cr],xr=dr[rr][0]*Tn[Cr][Mr]);const Lr=Mn-1<=Mr?_i-1:qt-Mn;for(let mr=Cr>=-1?1:-Cr;mr<=Lr;++mr)dr[rr][mr]=(dr[Gn][mr]-dr[Gn][mr-1])/Tn[Mr+1][Cr+mr],xr+=dr[rr][mr]*Tn[Cr+mr][Mr];Mn<=Mr&&(dr[rr][_i]=-dr[Gn][_i-1]/Tn[Mr+1][Mn],xr+=dr[rr][_i]*Tn[Mn][Mr]),mn[_i][Mn]=xr;const ls=Gn;Gn=rr,rr=ls}}let Un=qt;for(let Mn=1;Mn<=en;++Mn){for(let Gn=0;Gn<=qt;++Gn)mn[Mn][Gn]*=Un;Un*=qt-Mn}return mn}(_t,vt,ut,wt,pt),Bt=[];for(let Ot=0;Ot<gt.length;++Ot){const Lt=gt[Ot].clone(),qt=Lt.w;Lt.x*=qt,Lt.y*=qt,Lt.z*=qt,Bt[Ot]=Lt}for(let Ot=0;Ot<=wt;++Ot){const Lt=Bt[_t-ut].clone().multiplyScalar(Pt[Ot][0]);for(let qt=1;qt<=ut;++qt)Lt.add(Bt[_t-ut+qt].clone().multiplyScalar(Pt[Ot][qt]));xt[Ot]=Lt}for(let Ot=wt+1;Ot<=Ct+1;++Ot)xt[Ot]=new b.Ltg(0,0,0);return xt}(d,_,et,nt,it);return function(ut){const pt=ut.length,gt=[],vt=[];for(let wt=0;wt<pt;++wt){const xt=ut[wt];gt[wt]=new b.Pa4(xt.x,xt.y,xt.z),vt[wt]=xt.w}const Ct=[];for(let wt=0;wt<pt;++wt){const xt=gt[wt].clone();for(let _t=1;_t<=wt;++_t)xt.sub(Ct[wt-_t].clone().multiplyScalar(br(wt,_t)*vt[_t]));Ct[wt]=xt.divideScalar(vt[0])}return Ct}(lt)}(this.degree,this.knots,this.controlPoints,a,1);return s.copy(h[1]).normalize(),s}}let hr,Kr,Ps;class Ts extends b.aNw{constructor(e){super(e)}load(e,i,s,a){const h=this,d=h.path===""?b.Zp0.extractUrlBase(e):h.path,_=new b.hH6(this.manager);_.setPath(h.path),_.setResponseType("arraybuffer"),_.setRequestHeader(h.requestHeader),_.setWithCredentials(h.withCredentials),_.load(e,function(et){try{i(h.parse(et,d))}catch(nt){a?a(nt):console.error(nt),h.manager.itemError(e)}},s,a)}parse(e,i){if(function(a){const h="Kaydara FBX Binary  \0";return a.byteLength>=h.length&&h===Rs(a,0,h.length)}(e))hr=new Eu().parse(e);else{const a=Rs(e);if(!function(h){const d=["K","a","y","d","a","r","a","\\","F","B","X","\\","B","i","n","a","r","y","\\","\\"];let _=0;function et(nt){const it=h[nt-1];return h=h.slice(_+nt),_++,it}for(let nt=0;nt<d.length;++nt)if(et(1)===d[nt])return!1;return!0}(a))throw new Error("THREE.FBXLoader: Unknown format.");if(YE(a)<7e3)throw new Error("THREE.FBXLoader: FBX version not supported, FileVersion: "+YE(a));hr=new eo().parse(a)}const s=new b.dpR(this.manager).setPath(this.resourcePath||i).setCrossOrigin(this.crossOrigin);return new so(s,this.manager).parse(hr)}}class so{constructor(e,i){this.textureLoader=e,this.manager=i}parse(){Kr=this.parseConnections();const e=this.parseImages(),i=this.parseTextures(e),s=this.parseMaterials(i),a=this.parseDeformers(),h=new Cl().parse(a);return this.parseScene(a,h,s),Ps}parseConnections(){const e=new Map;return"Connections"in hr&&hr.Connections.connections.forEach(function(i){const s=i[0],a=i[1],h=i[2];e.has(s)||e.set(s,{parents:[],children:[]});const d={ID:a,relationship:h};e.get(s).parents.push(d),e.has(a)||e.set(a,{parents:[],children:[]});const _={ID:s,relationship:h};e.get(a).children.push(_)}),e}parseImages(){const e={},i={};if("Video"in hr.Objects){const s=hr.Objects.Video;for(const a in s){const h=s[a];if(e[parseInt(a)]=h.RelativeFilename||h.Filename,"Content"in h){const d=h.Content instanceof ArrayBuffer&&h.Content.byteLength>0,_=typeof h.Content=="string"&&h.Content!=="";if(d||_){const et=this.parseImage(s[a]);i[h.RelativeFilename||h.Filename]=et}}}}for(const s in e){const a=e[s];i[a]!==void 0?e[s]=i[a]:e[s]=e[s].split("\\").pop()}return e}parseImage(e){const i=e.Content,s=e.RelativeFilename||e.Filename,a=s.slice(s.lastIndexOf(".")+1).toLowerCase();let h;switch(a){case"bmp":h="image/bmp";break;case"jpg":case"jpeg":h="image/jpeg";break;case"png":h="image/png";break;case"tif":h="image/tiff";break;case"tga":this.manager.getHandler(".tga")===null&&console.warn("FBXLoader: TGA loader not found, skipping ",s),h="image/tga";break;default:return void console.warn('FBXLoader: Image type "'+a+'" is not supported.')}if(typeof i=="string")return"data:"+h+";base64,"+i;{const d=new Uint8Array(i);return window.URL.createObjectURL(new Blob([d],{type:h}))}}parseTextures(e){const i=new Map;if("Texture"in hr.Objects){const s=hr.Objects.Texture;for(const a in s){const h=this.parseTexture(s[a],e);i.set(parseInt(a),h)}}return i}parseTexture(e,i){const s=this.loadTexture(e,i);s.ID=e.id,s.name=e.attrName;const a=e.WrapModeU,h=e.WrapModeV,d=a!==void 0?a.value:0,_=h!==void 0?h.value:0;if(s.wrapS=d===0?b.rpg:b.uWy,s.wrapT=_===0?b.rpg:b.uWy,"Scaling"in e){const et=e.Scaling.value;s.repeat.x=et[0],s.repeat.y=et[1]}if("Translation"in e){const et=e.Translation.value;s.offset.x=et[0],s.offset.y=et[1]}return s}loadTexture(e,i){let s;const a=this.textureLoader.path,h=Kr.get(e.id).children;let d;h!==void 0&&h.length>0&&i[h[0].ID]!==void 0&&(s=i[h[0].ID],s.indexOf("blob:")!==0&&s.indexOf("data:")!==0||this.textureLoader.setPath(void 0));const _=e.FileName.slice(-3).toLowerCase();if(_==="tga"){const et=this.manager.getHandler(".tga");et===null?(console.warn("FBXLoader: TGA loader not found, creating placeholder texture for",e.RelativeFilename),d=new b.xEZ):(et.setPath(this.textureLoader.path),d=et.load(s))}else _==="psd"?(console.warn("FBXLoader: PSD textures are not supported, creating placeholder texture for",e.RelativeFilename),d=new b.xEZ):d=this.textureLoader.load(s);return this.textureLoader.setPath(a),d}parseMaterials(e){const i=new Map;if("Material"in hr.Objects){const s=hr.Objects.Material;for(const a in s){const h=this.parseMaterial(s[a],e);h!==null&&i.set(parseInt(a),h)}}return i}parseMaterial(e,i){const s=e.id,a=e.attrName;let h=e.ShadingModel;if(typeof h=="object"&&(h=h.value),!Kr.has(s))return null;const d=this.parseParameters(e,i,s);let _;switch(h.toLowerCase()){case"phong":_=new b.xoR;break;case"lambert":_=new b.YBo;break;default:console.warn('THREE.FBXLoader: unknown material type "%s". Defaulting to MeshPhongMaterial.',h),_=new b.xoR}return _.setValues(d),_.name=a,_}parseParameters(e,i,s){const a={};e.BumpFactor&&(a.bumpScale=e.BumpFactor.value),e.Diffuse?a.color=new b.Ilk().fromArray(e.Diffuse.value):!e.DiffuseColor||e.DiffuseColor.type!=="Color"&&e.DiffuseColor.type!=="ColorRGB"||(a.color=new b.Ilk().fromArray(e.DiffuseColor.value)),e.DisplacementFactor&&(a.displacementScale=e.DisplacementFactor.value),e.Emissive?a.emissive=new b.Ilk().fromArray(e.Emissive.value):!e.EmissiveColor||e.EmissiveColor.type!=="Color"&&e.EmissiveColor.type!=="ColorRGB"||(a.emissive=new b.Ilk().fromArray(e.EmissiveColor.value)),e.EmissiveFactor&&(a.emissiveIntensity=parseFloat(e.EmissiveFactor.value)),e.Opacity&&(a.opacity=parseFloat(e.Opacity.value)),a.opacity<1&&(a.transparent=!0),e.ReflectionFactor&&(a.reflectivity=e.ReflectionFactor.value),e.Shininess&&(a.shininess=e.Shininess.value),e.Specular?a.specular=new b.Ilk().fromArray(e.Specular.value):e.SpecularColor&&e.SpecularColor.type==="Color"&&(a.specular=new b.Ilk().fromArray(e.SpecularColor.value));const h=this;return Kr.get(s).children.forEach(function(d){const _=d.relationship;switch(_){case"Bump":a.bumpMap=h.getTexture(i,d.ID);break;case"Maya|TEX_ao_map":a.aoMap=h.getTexture(i,d.ID);break;case"DiffuseColor":case"Maya|TEX_color_map":a.map=h.getTexture(i,d.ID),a.map!==void 0&&(a.map.encoding=b.knz);break;case"DisplacementColor":a.displacementMap=h.getTexture(i,d.ID);break;case"EmissiveColor":a.emissiveMap=h.getTexture(i,d.ID),a.emissiveMap!==void 0&&(a.emissiveMap.encoding=b.knz);break;case"NormalMap":case"Maya|TEX_normal_map":a.normalMap=h.getTexture(i,d.ID);break;case"ReflectionColor":a.envMap=h.getTexture(i,d.ID),a.envMap!==void 0&&(a.envMap.mapping=b.dSO,a.envMap.encoding=b.knz);break;case"SpecularColor":a.specularMap=h.getTexture(i,d.ID),a.specularMap!==void 0&&(a.specularMap.encoding=b.knz);break;case"TransparentColor":case"TransparencyFactor":a.alphaMap=h.getTexture(i,d.ID),a.transparent=!0;break;default:console.warn("THREE.FBXLoader: %s map is not supported in three.js, skipping texture.",_)}}),a}getTexture(e,i){return"LayeredTexture"in hr.Objects&&i in hr.Objects.LayeredTexture&&(console.warn("THREE.FBXLoader: layered textures are not supported in three.js. Discarding all but first layer."),i=Kr.get(i).children[0].ID),e.get(i)}parseDeformers(){const e={},i={};if("Deformer"in hr.Objects){const s=hr.Objects.Deformer;for(const a in s){const h=s[a],d=Kr.get(parseInt(a));if(h.attrType==="Skin"){const _=this.parseSkeleton(d,s);_.ID=a,d.parents.length>1&&console.warn("THREE.FBXLoader: skeleton attached to more than one geometry is not supported."),_.geometryID=d.parents[0].ID,e[a]=_}else if(h.attrType==="BlendShape"){const _={id:a};_.rawTargets=this.parseMorphTargets(d,s),_.id=a,d.parents.length>1&&console.warn("THREE.FBXLoader: morph target attached to more than one geometry is not supported."),i[a]=_}}}return{skeletons:e,morphTargets:i}}parseSkeleton(e,i){const s=[];return e.children.forEach(function(a){const h=i[a.ID];if(h.attrType!=="Cluster")return;const d={ID:a.ID,indices:[],weights:[],transformLink:new b.yGw().fromArray(h.TransformLink.a)};"Indexes"in h&&(d.indices=h.Indexes.a,d.weights=h.Weights.a),s.push(d)}),{rawBones:s,bones:[]}}parseMorphTargets(e,i){const s=[];for(let a=0;a<e.children.length;a++){const h=e.children[a],d=i[h.ID],_={name:d.attrName,initialWeight:d.DeformPercent,id:d.id,fullWeights:d.FullWeights.a};if(d.attrType!=="BlendShapeChannel")return;_.geoID=Kr.get(parseInt(h.ID)).children.filter(function(et){return et.relationship===void 0})[0].ID,s.push(_)}return s}parseScene(e,i,s){Ps=new b.ZAu;const a=this.parseModels(e.skeletons,i,s),h=hr.Objects.Model,d=this;a.forEach(function(et){const nt=h[et.ID];d.setLookAtProperties(et,nt),Kr.get(et.ID).parents.forEach(function(it){const lt=a.get(it.ID);lt!==void 0&&lt.add(et)}),et.parent===null&&Ps.add(et)}),this.bindSkeleton(e.skeletons,i,a),this.createAmbientLight(),Ps.traverse(function(et){if(et.userData.transformData){et.parent&&(et.userData.transformData.parentMatrix=et.parent.matrix,et.userData.transformData.parentMatrixWorld=et.parent.matrixWorld);const nt=Su(et.userData.transformData);et.applyMatrix4(nt),et.updateWorldMatrix()}});const _=new po().parse();Ps.children.length===1&&Ps.children[0].isGroup&&(Ps.children[0].animations=_,Ps=Ps.children[0]),Ps.animations=_}parseModels(e,i,s){const a=new Map,h=hr.Objects.Model;for(const d in h){const _=parseInt(d),et=h[d],nt=Kr.get(_);let it=this.buildSkeleton(nt,e,_,et.attrName);if(!it){switch(et.attrType){case"Camera":it=this.createCamera(nt);break;case"Light":it=this.createLight(nt);break;case"Mesh":it=this.createMesh(nt,i,s);break;case"NurbsCurve":it=this.createCurve(nt,i);break;case"LimbNode":case"Root":it=new b.N$j;break;default:it=new b.ZAu}it.name=et.attrName?b.iUV.sanitizeNodeName(et.attrName):"",it.ID=_}this.getTransformData(it,et),a.set(_,it)}return a}buildSkeleton(e,i,s,a){let h=null;return e.parents.forEach(function(d){for(const _ in i){const et=i[_];et.rawBones.forEach(function(nt,it){if(nt.ID===d.ID){const lt=h;h=new b.N$j,h.matrixWorld.copy(nt.transformLink),h.name=a?b.iUV.sanitizeNodeName(a):"",h.ID=s,et.bones[it]=h,lt!==null&&h.add(lt)}})}}),h}createCamera(e){let i,s;if(e.children.forEach(function(a){const h=hr.Objects.NodeAttribute[a.ID];h!==void 0&&(s=h)}),s===void 0)i=new b.Tme;else{let a=0;s.CameraProjectionType!==void 0&&s.CameraProjectionType.value===1&&(a=1);let h=1;s.NearPlane!==void 0&&(h=s.NearPlane.value/1e3);let d=1e3;s.FarPlane!==void 0&&(d=s.FarPlane.value/1e3);let _=window.innerWidth,et=window.innerHeight;s.AspectWidth!==void 0&&s.AspectHeight!==void 0&&(_=s.AspectWidth.value,et=s.AspectHeight.value);const nt=_/et;let it=45;s.FieldOfView!==void 0&&(it=s.FieldOfView.value);const lt=s.FocalLength?s.FocalLength.value:null;switch(a){case 0:i=new b.cPb(it,nt,h,d),lt!==null&&i.setFocalLength(lt);break;case 1:i=new b.iKG(-_/2,_/2,et/2,-et/2,h,d);break;default:console.warn("THREE.FBXLoader: Unknown camera type "+a+"."),i=new b.Tme}}return i}createLight(e){let i,s;if(e.children.forEach(function(a){const h=hr.Objects.NodeAttribute[a.ID];h!==void 0&&(s=h)}),s===void 0)i=new b.Tme;else{s.LightType===void 0||s.LightType.value;let a=16777215;s.Color!==void 0&&(a=new b.Ilk().fromArray(s.Color.value));let h=s.Intensity===void 0?1:s.Intensity.value/100;s.CastLightOnObject!==void 0&&s.CastLightOnObject.value===0&&(h=0);let d=0;s.FarAttenuationEnd!==void 0&&(d=s.EnableFarAttenuation!==void 0&&s.EnableFarAttenuation.value===0?0:s.FarAttenuationEnd.value);const _=1;switch(e){case 0:i=new b.cek(a,h,d,_);break;case 1:i=new b.Ox3(a,h);break;case 2:let et=Math.PI/3;s.InnerAngle!==void 0&&(et=b.M8C.degToRad(s.InnerAngle.value));let nt=0;s.OuterAngle!==void 0&&(nt=b.M8C.degToRad(s.OuterAngle.value),nt=Math.max(nt,1)),i=new b.PMe(a,h,d,et,nt,_);break;default:console.warn("THREE.FBXLoader: Unknown light type "+s.LightType.value+", defaulting to a PointLight."),i=new b.cek(a,h)}s.CastShadows!==void 0&&s.CastShadows.value===1&&(i.castShadow=!0)}return i}createMesh(e,i,s){let a,h=null,d=null;const _=[];return e.children.forEach(function(et){i.has(et.ID)&&(h=i.get(et.ID)),s.has(et.ID)&&_.push(s.get(et.ID))}),_.length>1?d=_:_.length>0?d=_[0]:(d=new b.xoR({color:13421772}),_.push(d)),"color"in h.attributes&&_.forEach(function(et){et.vertexColors=!0}),h.FBX_Deformer?(a=new b.TUv(h,d),a.normalizeSkinWeights()):a=new b.Kj0(h,d),a}createCurve(e,i){const s=e.children.reduce(function(h,d){return i.has(d.ID)&&(h=i.get(d.ID)),h},null),a=new b.nls({color:3342591,linewidth:1});return new b.x12(s,a)}getTransformData(e,i){const s={};"InheritType"in i&&(s.inheritType=parseInt(i.InheritType.value)),s.eulerOrder="RotationOrder"in i?Aw(i.RotationOrder.value):"ZYX","Lcl_Translation"in i&&(s.translation=i.Lcl_Translation.value),"PreRotation"in i&&(s.preRotation=i.PreRotation.value),"Lcl_Rotation"in i&&(s.rotation=i.Lcl_Rotation.value),"PostRotation"in i&&(s.postRotation=i.PostRotation.value),"Lcl_Scaling"in i&&(s.scale=i.Lcl_Scaling.value),"ScalingOffset"in i&&(s.scalingOffset=i.ScalingOffset.value),"ScalingPivot"in i&&(s.scalingPivot=i.ScalingPivot.value),"RotationOffset"in i&&(s.rotationOffset=i.RotationOffset.value),"RotationPivot"in i&&(s.rotationPivot=i.RotationPivot.value),e.userData.transformData=s}setLookAtProperties(e,i){"LookAtProperty"in i&&Kr.get(e.ID).children.forEach(function(s){if(s.relationship==="LookAtProperty"){const a=hr.Objects.Model[s.ID];if("Lcl_Translation"in a){const h=a.Lcl_Translation.value;e.target!==void 0?(e.target.position.fromArray(h),Ps.add(e.target)):e.lookAt(new b.Pa4().fromArray(h))}}})}bindSkeleton(e,i,s){const a=this.parsePoseNodes();for(const h in e){const d=e[h];Kr.get(parseInt(d.ID)).parents.forEach(function(_){if(i.has(_.ID)){const et=_.ID;Kr.get(et).parents.forEach(function(nt){s.has(nt.ID)&&s.get(nt.ID).bind(new b.OdW(d.bones),a[nt.ID])})}})}}parsePoseNodes(){const e={};if("Pose"in hr.Objects){const i=hr.Objects.Pose;for(const s in i)if(i[s].attrType==="BindPose"&&i[s].NbPoseNodes>0){const a=i[s].PoseNode;Array.isArray(a)?a.forEach(function(h){e[h.Node]=new b.yGw().fromArray(h.Matrix.a)}):e[a.Node]=new b.yGw().fromArray(a.Matrix.a)}}return e}createAmbientLight(){if("GlobalSettings"in hr&&"AmbientColor"in hr.GlobalSettings){const e=hr.GlobalSettings.AmbientColor.value,i=e[0],s=e[1],a=e[2];if(i!==0||s!==0||a!==0){const h=new b.Ilk(i,s,a);Ps.add(new b.Mig(h,1))}}}}class Cl{parse(e){const i=new Map;if("Geometry"in hr.Objects){const s=hr.Objects.Geometry;for(const a in s){const h=Kr.get(parseInt(a)),d=this.parseGeometry(h,s[a],e);i.set(parseInt(a),d)}}return i}parseGeometry(e,i,s){switch(i.attrType){case"Mesh":return this.parseMeshGeometry(e,i,s);case"NurbsCurve":return this.parseNurbsGeometry(i)}}parseMeshGeometry(e,i,s){const a=s.skeletons,h=[],d=e.parents.map(function(lt){return hr.Objects.Model[lt.ID]});if(d.length===0)return;const _=e.children.reduce(function(lt,ut){return a[ut.ID]!==void 0&&(lt=a[ut.ID]),lt},null);e.children.forEach(function(lt){s.morphTargets[lt.ID]!==void 0&&h.push(s.morphTargets[lt.ID])});const et=d[0],nt={};"RotationOrder"in et&&(nt.eulerOrder=Aw(et.RotationOrder.value)),"InheritType"in et&&(nt.inheritType=parseInt(et.InheritType.value)),"GeometricTranslation"in et&&(nt.translation=et.GeometricTranslation.value),"GeometricRotation"in et&&(nt.rotation=et.GeometricRotation.value),"GeometricScaling"in et&&(nt.scale=et.GeometricScaling.value);const it=Su(nt);return this.genGeometry(i,_,h,it)}genGeometry(e,i,s,a){const h=new b.u9r;e.attrName&&(h.name=e.attrName);const d=this.parseGeoNode(e,i),_=this.genBuffers(d),et=new b.a$l(_.vertex,3);if(et.applyMatrix4(a),h.setAttribute("position",et),_.colors.length>0&&h.setAttribute("color",new b.a$l(_.colors,3)),i&&(h.setAttribute("skinIndex",new b.qlB(_.weightsIndices,4)),h.setAttribute("skinWeight",new b.a$l(_.vertexWeights,4)),h.FBX_Deformer=i),_.normal.length>0){const nt=new b.Vkp().getNormalMatrix(a),it=new b.a$l(_.normal,3);it.applyNormalMatrix(nt),h.setAttribute("normal",it)}if(_.uvs.forEach(function(nt,it){let lt="uv"+(it+1).toString();it===0&&(lt="uv"),h.setAttribute(lt,new b.a$l(_.uvs[it],2))}),d.material&&d.material.mappingType!=="AllSame"){let nt=_.materialIndex[0],it=0;if(_.materialIndex.forEach(function(lt,ut){lt!==nt&&(h.addGroup(it,ut-it,nt),nt=lt,it=ut)}),h.groups.length>0){const lt=h.groups[h.groups.length-1],ut=lt.start+lt.count;ut!==_.materialIndex.length&&h.addGroup(ut,_.materialIndex.length-ut,nt)}h.groups.length===0&&h.addGroup(0,_.materialIndex.length,_.materialIndex[0])}return this.addMorphTargets(h,e,s,a),h}parseGeoNode(e,i){const s={};if(s.vertexPositions=e.Vertices!==void 0?e.Vertices.a:[],s.vertexIndices=e.PolygonVertexIndex!==void 0?e.PolygonVertexIndex.a:[],e.LayerElementColor&&(s.color=this.parseVertexColors(e.LayerElementColor[0])),e.LayerElementMaterial&&(s.material=this.parseMaterialIndices(e.LayerElementMaterial[0])),e.LayerElementNormal&&(s.normal=this.parseNormals(e.LayerElementNormal[0])),e.LayerElementUV){s.uv=[];let a=0;for(;e.LayerElementUV[a];)e.LayerElementUV[a].UV&&s.uv.push(this.parseUVs(e.LayerElementUV[a])),a++}return s.weightTable={},i!==null&&(s.skeleton=i,i.rawBones.forEach(function(a,h){a.indices.forEach(function(d,_){s.weightTable[d]===void 0&&(s.weightTable[d]=[]),s.weightTable[d].push({id:h,weight:a.weights[_]})})})),s}genBuffers(e){const i={vertex:[],normal:[],colors:[],uvs:[],materialIndex:[],vertexWeights:[],weightsIndices:[]};let s=0,a=0,h=!1,d=[],_=[],et=[],nt=[],it=[],lt=[];const ut=this;return e.vertexIndices.forEach(function(pt,gt){let vt,Ct=!1;pt<0&&(pt^=-1,Ct=!0);let wt=[],xt=[];if(d.push(3*pt,3*pt+1,3*pt+2),e.color){const _t=sy(gt,s,pt,e.color);et.push(_t[0],_t[1],_t[2])}if(e.skeleton){if(e.weightTable[pt]!==void 0&&e.weightTable[pt].forEach(function(_t){xt.push(_t.weight),wt.push(_t.id)}),xt.length>4){h||(console.warn("THREE.FBXLoader: Vertex has more than 4 skinning weights assigned to vertex. Deleting additional weights."),h=!0);const _t=[0,0,0,0],Pt=[0,0,0,0];xt.forEach(function(Bt,Ot){let Lt=Bt,qt=wt[Ot];Pt.forEach(function(en,cn,An){if(Lt>en){An[cn]=Lt,Lt=en;const mn=_t[cn];_t[cn]=qt,qt=mn}})}),wt=_t,xt=Pt}for(;xt.length<4;)xt.push(0),wt.push(0);for(let _t=0;_t<4;++_t)it.push(xt[_t]),lt.push(wt[_t])}if(e.normal){const _t=sy(gt,s,pt,e.normal);_.push(_t[0],_t[1],_t[2])}e.material&&e.material.mappingType!=="AllSame"&&(vt=sy(gt,s,pt,e.material)[0],vt<0&&(console.warn("THREE.FBXLoader: Invalid material index:",vt),vt=0)),e.uv&&e.uv.forEach(function(_t,Pt){const Bt=sy(gt,s,pt,_t);nt[Pt]===void 0&&(nt[Pt]=[]),nt[Pt].push(Bt[0]),nt[Pt].push(Bt[1])}),a++,Ct&&(ut.genFace(i,e,d,vt,_,et,nt,it,lt,a),s++,a=0,d=[],_=[],et=[],nt=[],it=[],lt=[])}),i}genFace(e,i,s,a,h,d,_,et,nt,it){for(let lt=2;lt<it;lt++)e.vertex.push(i.vertexPositions[s[0]]),e.vertex.push(i.vertexPositions[s[1]]),e.vertex.push(i.vertexPositions[s[2]]),e.vertex.push(i.vertexPositions[s[3*(lt-1)]]),e.vertex.push(i.vertexPositions[s[3*(lt-1)+1]]),e.vertex.push(i.vertexPositions[s[3*(lt-1)+2]]),e.vertex.push(i.vertexPositions[s[3*lt]]),e.vertex.push(i.vertexPositions[s[3*lt+1]]),e.vertex.push(i.vertexPositions[s[3*lt+2]]),i.skeleton&&(e.vertexWeights.push(et[0]),e.vertexWeights.push(et[1]),e.vertexWeights.push(et[2]),e.vertexWeights.push(et[3]),e.vertexWeights.push(et[4*(lt-1)]),e.vertexWeights.push(et[4*(lt-1)+1]),e.vertexWeights.push(et[4*(lt-1)+2]),e.vertexWeights.push(et[4*(lt-1)+3]),e.vertexWeights.push(et[4*lt]),e.vertexWeights.push(et[4*lt+1]),e.vertexWeights.push(et[4*lt+2]),e.vertexWeights.push(et[4*lt+3]),e.weightsIndices.push(nt[0]),e.weightsIndices.push(nt[1]),e.weightsIndices.push(nt[2]),e.weightsIndices.push(nt[3]),e.weightsIndices.push(nt[4*(lt-1)]),e.weightsIndices.push(nt[4*(lt-1)+1]),e.weightsIndices.push(nt[4*(lt-1)+2]),e.weightsIndices.push(nt[4*(lt-1)+3]),e.weightsIndices.push(nt[4*lt]),e.weightsIndices.push(nt[4*lt+1]),e.weightsIndices.push(nt[4*lt+2]),e.weightsIndices.push(nt[4*lt+3])),i.color&&(e.colors.push(d[0]),e.colors.push(d[1]),e.colors.push(d[2]),e.colors.push(d[3*(lt-1)]),e.colors.push(d[3*(lt-1)+1]),e.colors.push(d[3*(lt-1)+2]),e.colors.push(d[3*lt]),e.colors.push(d[3*lt+1]),e.colors.push(d[3*lt+2])),i.material&&i.material.mappingType!=="AllSame"&&(e.materialIndex.push(a),e.materialIndex.push(a),e.materialIndex.push(a)),i.normal&&(e.normal.push(h[0]),e.normal.push(h[1]),e.normal.push(h[2]),e.normal.push(h[3*(lt-1)]),e.normal.push(h[3*(lt-1)+1]),e.normal.push(h[3*(lt-1)+2]),e.normal.push(h[3*lt]),e.normal.push(h[3*lt+1]),e.normal.push(h[3*lt+2])),i.uv&&i.uv.forEach(function(ut,pt){e.uvs[pt]===void 0&&(e.uvs[pt]=[]),e.uvs[pt].push(_[pt][0]),e.uvs[pt].push(_[pt][1]),e.uvs[pt].push(_[pt][2*(lt-1)]),e.uvs[pt].push(_[pt][2*(lt-1)+1]),e.uvs[pt].push(_[pt][2*lt]),e.uvs[pt].push(_[pt][2*lt+1])})}addMorphTargets(e,i,s,a){if(s.length===0)return;e.morphTargetsRelative=!0,e.morphAttributes.position=[];const h=this;s.forEach(function(d){d.rawTargets.forEach(function(_){const et=hr.Objects.Geometry[_.geoID];et!==void 0&&h.genMorphGeometry(e,i,et,a,_.name)})})}genMorphGeometry(e,i,s,a,h){const d=i.PolygonVertexIndex!==void 0?i.PolygonVertexIndex.a:[],_=s.Vertices!==void 0?s.Vertices.a:[],et=s.Indexes!==void 0?s.Indexes.a:[],nt=3*e.attributes.position.count,it=new Float32Array(nt);for(let gt=0;gt<et.length;gt++){const vt=3*et[gt];it[vt]=_[3*gt],it[vt+1]=_[3*gt+1],it[vt+2]=_[3*gt+2]}const lt={vertexIndices:d,vertexPositions:it},ut=this.genBuffers(lt),pt=new b.a$l(ut.vertex,3);pt.name=h||s.attrName,pt.applyMatrix4(a),e.morphAttributes.position.push(pt)}parseNormals(e){const i=e.MappingInformationType,s=e.ReferenceInformationType,a=e.Normals.a;let h=[];return s==="IndexToDirect"&&("NormalIndex"in e?h=e.NormalIndex.a:"NormalsIndex"in e&&(h=e.NormalsIndex.a)),{dataSize:3,buffer:a,indices:h,mappingType:i,referenceType:s}}parseUVs(e){const i=e.MappingInformationType,s=e.ReferenceInformationType,a=e.UV.a;let h=[];return s==="IndexToDirect"&&(h=e.UVIndex.a),{dataSize:2,buffer:a,indices:h,mappingType:i,referenceType:s}}parseVertexColors(e){const i=e.MappingInformationType,s=e.ReferenceInformationType,a=e.Colors.a;let h=[];return s==="IndexToDirect"&&(h=e.ColorIndex.a),{dataSize:4,buffer:a,indices:h,mappingType:i,referenceType:s}}parseMaterialIndices(e){const i=e.MappingInformationType,s=e.ReferenceInformationType;if(i==="NoMappingInformation")return{dataSize:1,buffer:[0],indices:[0],mappingType:"AllSame",referenceType:s};const a=e.Materials.a,h=[];for(let d=0;d<a.length;++d)h.push(d);return{dataSize:1,buffer:a,indices:h,mappingType:i,referenceType:s}}parseNurbsGeometry(e){if(wr===void 0)return console.error("THREE.FBXLoader: The loader relies on NURBSCurve for any nurbs present in the model. Nurbs will show up as empty geometry."),new b.u9r;const i=parseInt(e.Order);if(isNaN(i))return console.error("THREE.FBXLoader: Invalid Order %s given for geometry ID: %s",e.Order,e.id),new b.u9r;const s=i-1,a=e.KnotVector.a,h=[],d=e.Points.a;for(let it=0,lt=d.length;it<lt;it+=4)h.push(new b.Ltg().fromArray(d,it));let _,et;if(e.Form==="Closed")h.push(h[0]);else if(e.Form==="Periodic"){_=s,et=a.length-1-_;for(let it=0;it<s;++it)h.push(h[it])}const nt=new wr(s,a,h,_,et).getPoints(12*h.length);return new b.u9r().setFromPoints(nt)}}class po{parse(){const e=[],i=this.parseClips();if(i!==void 0)for(const s in i){const a=i[s],h=this.addClip(a);e.push(h)}return e}parseClips(){if(hr.Objects.AnimationCurve===void 0)return;const e=this.parseAnimationCurveNodes();this.parseAnimationCurves(e);const i=this.parseAnimationLayers(e);return this.parseAnimStacks(i)}parseAnimationCurveNodes(){const e=hr.Objects.AnimationCurveNode,i=new Map;for(const s in e){const a=e[s];if(a.attrName.match(/S|R|T|DeformPercent/)!==null){const h={id:a.id,attr:a.attrName,curves:{}};i.set(h.id,h)}}return i}parseAnimationCurves(e){const i=hr.Objects.AnimationCurve;for(const s in i){const a={id:i[s].id,times:i[s].KeyTime.a.map(R_),values:i[s].KeyValueFloat.a},h=Kr.get(a.id);if(h!==void 0){const d=h.parents[0].ID,_=h.parents[0].relationship;_.match(/X/)?e.get(d).curves.x=a:_.match(/Y/)?e.get(d).curves.y=a:_.match(/Z/)?e.get(d).curves.z=a:_.match(/d|DeformPercent/)&&e.has(d)&&(e.get(d).curves.morph=a)}}}parseAnimationLayers(e){const i=hr.Objects.AnimationLayer,s=new Map;for(const a in i){const h=[],d=Kr.get(parseInt(a));d!==void 0&&(d.children.forEach(function(_,et){if(e.has(_.ID)){const nt=e.get(_.ID);if(nt.curves.x!==void 0||nt.curves.y!==void 0||nt.curves.z!==void 0){if(h[et]===void 0){const it=Kr.get(_.ID).parents.filter(function(lt){return lt.relationship!==void 0})[0].ID;if(it!==void 0){const lt=hr.Objects.Model[it.toString()];if(lt===void 0)return void console.warn("THREE.FBXLoader: Encountered a unused curve.",_);const ut={modelName:lt.attrName?b.iUV.sanitizeNodeName(lt.attrName):"",ID:lt.id,initialPosition:[0,0,0],initialRotation:[0,0,0],initialScale:[1,1,1]};Ps.traverse(function(pt){pt.ID===lt.id&&(ut.transform=pt.matrix,pt.userData.transformData&&(ut.eulerOrder=pt.userData.transformData.eulerOrder))}),ut.transform||(ut.transform=new b.yGw),"PreRotation"in lt&&(ut.preRotation=lt.PreRotation.value),"PostRotation"in lt&&(ut.postRotation=lt.PostRotation.value),h[et]=ut}}h[et]&&(h[et][nt.attr]=nt)}else if(nt.curves.morph!==void 0){if(h[et]===void 0){const it=Kr.get(_.ID).parents.filter(function(Ct){return Ct.relationship!==void 0})[0].ID,lt=Kr.get(it).parents[0].ID,ut=Kr.get(lt).parents[0].ID,pt=Kr.get(ut).parents[0].ID,gt=hr.Objects.Model[pt],vt={modelName:gt.attrName?b.iUV.sanitizeNodeName(gt.attrName):"",morphName:hr.Objects.Deformer[it].attrName};h[et]=vt}h[et][nt.attr]=nt}}}),s.set(parseInt(a),h))}return s}parseAnimStacks(e){const i=hr.Objects.AnimationStack,s={};for(const a in i){const h=Kr.get(parseInt(a)).children;h.length>1&&console.warn("THREE.FBXLoader: Encountered an animation stack with multiple layers, this is currently not supported. Ignoring subsequent layers.");const d=e.get(h[0].ID);s[a]={name:i[a].attrName,layer:d}}return s}addClip(e){let i=[];const s=this;return e.layer.forEach(function(a){i=i.concat(s.generateTracks(a))}),new b.m7l(e.name,-1,i)}generateTracks(e){const i=[];let s=new b.Pa4,a=new b._fP,h=new b.Pa4;if(e.transform&&e.transform.decompose(s,a,h),s=s.toArray(),a=new b.USm().setFromQuaternion(a,e.eulerOrder).toArray(),h=h.toArray(),e.T!==void 0&&Object.keys(e.T.curves).length>0){const d=this.generateVectorTrack(e.modelName,e.T.curves,s,"position");d!==void 0&&i.push(d)}if(e.R!==void 0&&Object.keys(e.R.curves).length>0){const d=this.generateRotationTrack(e.modelName,e.R.curves,a,e.preRotation,e.postRotation,e.eulerOrder);d!==void 0&&i.push(d)}if(e.S!==void 0&&Object.keys(e.S.curves).length>0){const d=this.generateVectorTrack(e.modelName,e.S.curves,h,"scale");d!==void 0&&i.push(d)}if(e.DeformPercent!==void 0){const d=this.generateMorphTrack(e);d!==void 0&&i.push(d)}return i}generateVectorTrack(e,i,s,a){const h=this.getTimesForAllAxes(i),d=this.getKeyframeTrackValues(h,i,s);return new b.yC1(e+"."+a,h,d)}generateRotationTrack(e,i,s,a,h,d){i.x!==void 0&&(this.interpolateRotations(i.x),i.x.values=i.x.values.map(b.M8C.degToRad)),i.y!==void 0&&(this.interpolateRotations(i.y),i.y.values=i.y.values.map(b.M8C.degToRad)),i.z!==void 0&&(this.interpolateRotations(i.z),i.z.values=i.z.values.map(b.M8C.degToRad));const _=this.getTimesForAllAxes(i),et=this.getKeyframeTrackValues(_,i,s);a!==void 0&&((a=a.map(b.M8C.degToRad)).push(d),a=new b.USm().fromArray(a),a=new b._fP().setFromEuler(a)),h!==void 0&&((h=h.map(b.M8C.degToRad)).push(d),h=new b.USm().fromArray(h),h=new b._fP().setFromEuler(h).invert());const nt=new b._fP,it=new b.USm,lt=[];for(let ut=0;ut<et.length;ut+=3)it.set(et[ut],et[ut+1],et[ut+2],d),nt.setFromEuler(it),a!==void 0&&nt.premultiply(a),h!==void 0&&nt.multiply(h),nt.toArray(lt,ut/3*4);return new b.iLg(e+".quaternion",_,lt)}generateMorphTrack(e){const i=e.DeformPercent.curves.morph,s=i.values.map(function(h){return h/100}),a=Ps.getObjectByName(e.modelName).morphTargetDictionary[e.morphName];return new b.dUE(e.modelName+".morphTargetInfluences["+a+"]",i.times,s)}getTimesForAllAxes(e){let i=[];if(e.x!==void 0&&(i=i.concat(e.x.times)),e.y!==void 0&&(i=i.concat(e.y.times)),e.z!==void 0&&(i=i.concat(e.z.times)),i=i.sort(function(s,a){return s-a}),i.length>1){let s=1,a=i[0];for(let h=1;h<i.length;h++){const d=i[h];d!==a&&(i[s]=d,a=d,s++)}i=i.slice(0,s)}return i}getKeyframeTrackValues(e,i,s){const a=s,h=[];let d=-1,_=-1,et=-1;return e.forEach(function(nt){if(i.x&&(d=i.x.times.indexOf(nt)),i.y&&(_=i.y.times.indexOf(nt)),i.z&&(et=i.z.times.indexOf(nt)),d!==-1){const it=i.x.values[d];h.push(it),a[0]=it}else h.push(a[0]);if(_!==-1){const it=i.y.values[_];h.push(it),a[1]=it}else h.push(a[1]);if(et!==-1){const it=i.z.values[et];h.push(it),a[2]=it}else h.push(a[2])}),h}interpolateRotations(e){for(let i=1;i<e.values.length;i++){const s=e.values[i-1],a=e.values[i]-s,h=Math.abs(a);if(h>=180){const d=h/180,_=a/d;let et=s+_;const nt=e.times[i-1],it=(e.times[i]-nt)/d;let lt=nt+it;const ut=[],pt=[];for(;lt<e.times[i];)ut.push(lt),lt+=it,pt.push(et),et+=_;e.times=lu(e.times,i,ut),e.values=lu(e.values,i,pt)}}}}class eo{getPrevNode(){return this.nodeStack[this.currentIndent-2]}getCurrentNode(){return this.nodeStack[this.currentIndent-1]}getCurrentProp(){return this.currentProp}pushStack(e){this.nodeStack.push(e),this.currentIndent+=1}popStack(){this.nodeStack.pop(),this.currentIndent-=1}setCurrentProp(e,i){this.currentProp=e,this.currentPropName=i}parse(e){this.currentIndent=0,this.allNodes=new Zp,this.nodeStack=[],this.currentProp=[],this.currentPropName="";const i=this,s=e.split(/[\r\n]+/);return s.forEach(function(a,h){const d=a.match(/^[\s\t]*;/),_=a.match(/^[\s\t]*$/);if(d||_)return;const et=a.match("^\\t{"+i.currentIndent+"}(\\w+):(.*){",""),nt=a.match("^\\t{"+i.currentIndent+"}(\\w+):[\\s\\t\\r\\n](.*)"),it=a.match("^\\t{"+(i.currentIndent-1)+"}}");et?i.parseNodeBegin(a,et):nt?i.parseNodeProperty(a,nt,s[++h]):it?i.popStack():a.match(/^[^\s\t}]/)&&i.parseNodePropertyContinued(a)}),this.allNodes}parseNodeBegin(e,i){const s=i[1].trim().replace(/^"/,"").replace(/"$/,""),a=i[2].split(",").map(function(et){return et.trim().replace(/^"/,"").replace(/"$/,"")}),h={name:s},d=this.parseNodeAttr(a),_=this.getCurrentNode();this.currentIndent===0?this.allNodes.add(s,h):s in _?(s==="PoseNode"?_.PoseNode.push(h):_[s].id!==void 0&&(_[s]={},_[s][_[s].id]=_[s]),d.id!==""&&(_[s][d.id]=h)):typeof d.id=="number"?(_[s]={},_[s][d.id]=h):s!=="Properties70"&&(_[s]=s==="PoseNode"?[h]:h),typeof d.id=="number"&&(h.id=d.id),d.name!==""&&(h.attrName=d.name),d.type!==""&&(h.attrType=d.type),this.pushStack(h)}parseNodeAttr(e){let i=e[0];e[0]!==""&&(i=parseInt(e[0]),isNaN(i)&&(i=e[0]));let s="",a="";return e.length>1&&(s=e[1].replace(/^(\w+)::/,""),a=e[2]),{id:i,name:s,type:a}}parseNodeProperty(e,i,s){let a=i[1].replace(/^"/,"").replace(/"$/,"").trim(),h=i[2].replace(/^"/,"").replace(/"$/,"").trim();a==="Content"&&h===","&&(h=s.replace(/"/g,"").replace(/,$/,"").trim());const d=this.getCurrentNode();if(d.name!=="Properties70"){if(a==="C"){const _=h.split(",").slice(1),et=parseInt(_[0]),nt=parseInt(_[1]);let it=h.split(",").slice(3);it=it.map(function(lt){return lt.trim().replace(/^"/,"")}),a="connections",h=[et,nt],function(lt,ut){for(let pt=0,gt=lt.length,vt=ut.length;pt<vt;pt++,gt++)lt[gt]=ut[pt]}(h,it),d[a]===void 0&&(d[a]=[])}a==="Node"&&(d.id=h),a in d&&Array.isArray(d[a])?d[a].push(h):a!=="a"?d[a]=h:d.a=h,this.setCurrentProp(d,a),a==="a"&&h.slice(-1)!==","&&(d.a=$p(h))}else this.parseNodeSpecialProperty(e,a,h)}parseNodePropertyContinued(e){const i=this.getCurrentNode();i.a+=e,e.slice(-1)!==","&&(i.a=$p(i.a))}parseNodeSpecialProperty(e,i,s){const a=s.split('",').map(function(it){return it.trim().replace(/^\"/,"").replace(/\s/,"_")}),h=a[0],d=a[1],_=a[2],et=a[3];let nt=a[4];switch(d){case"int":case"enum":case"bool":case"ULongLong":case"double":case"Number":case"FieldOfView":nt=parseFloat(nt);break;case"Color":case"ColorRGB":case"Vector3D":case"Lcl_Translation":case"Lcl_Rotation":case"Lcl_Scaling":nt=$p(nt)}this.getPrevNode()[h]={type:d,type2:_,flag:et,value:nt},this.setCurrentProp(this.getPrevNode(),h)}}class Eu{parse(e){const i=new _w(e);i.skip(23);const s=i.getUint32();if(s<6400)throw new Error("THREE.FBXLoader: FBX version not supported, FileVersion: "+s);const a=new Zp;for(;!this.endOfContent(i);){const h=this.parseNode(i,s);h!==null&&a.add(h.name,h)}return a}endOfContent(e){return e.size()%16==0?(e.getOffset()+160+16&-16)>=e.size():e.getOffset()+160+16>=e.size()}parseNode(e,i){const s={},a=i>=7500?e.getUint64():e.getUint32(),h=i>=7500?e.getUint64():e.getUint32();i>=7500?e.getUint64():e.getUint32();const d=e.getUint8(),_=e.getString(d);if(a===0)return null;const et=[];for(let ut=0;ut<h;ut++)et.push(this.parseProperty(e));const nt=et.length>0?et[0]:"",it=et.length>1?et[1]:"",lt=et.length>2?et[2]:"";for(s.singleProperty=h===1&&e.getOffset()===a;a>e.getOffset();){const ut=this.parseNode(e,i);ut!==null&&this.parseSubNode(_,s,ut)}return s.propertyList=et,typeof nt=="number"&&(s.id=nt),it!==""&&(s.attrName=it),lt!==""&&(s.attrType=lt),_!==""&&(s.name=_),s}parseSubNode(e,i,s){if(s.singleProperty===!0){const a=s.propertyList[0];Array.isArray(a)?(i[s.name]=s,s.a=a):i[s.name]=a}else if(e==="Connections"&&s.name==="C"){const a=[];s.propertyList.forEach(function(h,d){d!==0&&a.push(h)}),i.connections===void 0&&(i.connections=[]),i.connections.push(a)}else if(s.name==="Properties70")Object.keys(s).forEach(function(a){i[a]=s[a]});else if(e==="Properties70"&&s.name==="P"){let a=s.propertyList[0],h=s.propertyList[1];const d=s.propertyList[2],_=s.propertyList[3];let et;a.indexOf("Lcl ")===0&&(a=a.replace("Lcl ","Lcl_")),h.indexOf("Lcl ")===0&&(h=h.replace("Lcl ","Lcl_")),et=h==="Color"||h==="ColorRGB"||h==="Vector"||h==="Vector3D"||h.indexOf("Lcl_")===0?[s.propertyList[4],s.propertyList[5],s.propertyList[6]]:s.propertyList[4],i[a]={type:h,type2:d,flag:_,value:et}}else i[s.name]===void 0?typeof s.id=="number"?(i[s.name]={},i[s.name][s.id]=s):i[s.name]=s:s.name==="PoseNode"?(Array.isArray(i[s.name])||(i[s.name]=[i[s.name]]),i[s.name].push(s)):i[s.name][s.id]===void 0&&(i[s.name][s.id]=s)}parseProperty(e){const i=e.getString(1);let s;switch(i){case"C":return e.getBoolean();case"D":return e.getFloat64();case"F":return e.getFloat32();case"I":return e.getInt32();case"L":return e.getInt64();case"R":return s=e.getUint32(),e.getArrayBuffer(s);case"S":return s=e.getUint32(),e.getString(s);case"Y":return e.getInt16();case"b":case"c":case"d":case"f":case"i":case"l":const a=e.getUint32(),h=e.getUint32(),d=e.getUint32();if(h===0)switch(i){case"b":case"c":return e.getBooleanArray(a);case"d":return e.getFloat64Array(a);case"f":return e.getFloat32Array(a);case"i":return e.getInt32Array(a);case"l":return e.getInt64Array(a)}tt===void 0&&console.error("THREE.FBXLoader: External library fflate.min.js required.");const _=or(new Uint8Array(e.getArrayBuffer(d))),et=new _w(_.buffer);switch(i){case"b":case"c":return et.getBooleanArray(a);case"d":return et.getFloat64Array(a);case"f":return et.getFloat32Array(a);case"i":return et.getInt32Array(a);case"l":return et.getInt64Array(a)}break;default:throw new Error("THREE.FBXLoader: Unknown property type "+i)}}}class _w{constructor(e,i){this.dv=new DataView(e),this.offset=0,this.littleEndian=i===void 0||i}getOffset(){return this.offset}size(){return this.dv.buffer.byteLength}skip(e){this.offset+=e}getBoolean(){return(1&this.getUint8())==1}getBooleanArray(e){const i=[];for(let s=0;s<e;s++)i.push(this.getBoolean());return i}getUint8(){const e=this.dv.getUint8(this.offset);return this.offset+=1,e}getInt16(){const e=this.dv.getInt16(this.offset,this.littleEndian);return this.offset+=2,e}getInt32(){const e=this.dv.getInt32(this.offset,this.littleEndian);return this.offset+=4,e}getInt32Array(e){const i=[];for(let s=0;s<e;s++)i.push(this.getInt32());return i}getUint32(){const e=this.dv.getUint32(this.offset,this.littleEndian);return this.offset+=4,e}getInt64(){let e,i;return this.littleEndian?(e=this.getUint32(),i=this.getUint32()):(i=this.getUint32(),e=this.getUint32()),2147483648&i?(i=4294967295&~i,e=4294967295&~e,e===4294967295&&(i=i+1&4294967295),e=e+1&4294967295,-(4294967296*i+e)):4294967296*i+e}getInt64Array(e){const i=[];for(let s=0;s<e;s++)i.push(this.getInt64());return i}getUint64(){let e,i;return this.littleEndian?(e=this.getUint32(),i=this.getUint32()):(i=this.getUint32(),e=this.getUint32()),4294967296*i+e}getFloat32(){const e=this.dv.getFloat32(this.offset,this.littleEndian);return this.offset+=4,e}getFloat32Array(e){const i=[];for(let s=0;s<e;s++)i.push(this.getFloat32());return i}getFloat64(){const e=this.dv.getFloat64(this.offset,this.littleEndian);return this.offset+=8,e}getFloat64Array(e){const i=[];for(let s=0;s<e;s++)i.push(this.getFloat64());return i}getArrayBuffer(e){const i=this.dv.buffer.slice(this.offset,this.offset+e);return this.offset+=e,i}getString(e){let i=[];for(let a=0;a<e;a++)i[a]=this.getUint8();const s=i.indexOf(0);return s>=0&&(i=i.slice(0,s)),b.Zp0.decodeText(new Uint8Array(i))}}class Zp{add(e,i){this[e]=i}}function YE(c){const e=c.match(/FBXVersion: (\d+)/);if(e)return parseInt(e[1]);throw new Error("THREE.FBXLoader: Cannot find the version number for the file given.")}function R_(c){return c/46186158e3}const PD=[];function sy(c,e,i,s){let a;switch(s.mappingType){case"ByPolygonVertex":a=c;break;case"ByPolygon":a=e;break;case"ByVertice":a=i;break;case"AllSame":a=s.indices[0];break;default:console.warn("THREE.FBXLoader: unknown attribute mapping type "+s.mappingType)}s.referenceType==="IndexToDirect"&&(a=s.indices[a]);const h=a*s.dataSize,d=h+s.dataSize;return function(_,et,nt,it){for(let lt=nt,ut=0;lt<it;lt++,ut++)_[ut]=et[lt];return _}(PD,s.buffer,h,d)}const YC=new b.USm,j0=new b.Pa4;function Su(c){const e=new b.yGw,i=new b.yGw,s=new b.yGw,a=new b.yGw,h=new b.yGw,d=new b.yGw,_=new b.yGw,et=new b.yGw,nt=new b.yGw,it=new b.yGw,lt=new b.yGw,ut=new b.yGw,pt=c.inheritType?c.inheritType:0;if(c.translation&&e.setPosition(j0.fromArray(c.translation)),c.preRotation){const cn=c.preRotation.map(b.M8C.degToRad);cn.push(c.eulerOrder||b.USm.DefaultOrder),i.makeRotationFromEuler(YC.fromArray(cn))}if(c.rotation){const cn=c.rotation.map(b.M8C.degToRad);cn.push(c.eulerOrder||b.USm.DefaultOrder),s.makeRotationFromEuler(YC.fromArray(cn))}if(c.postRotation){const cn=c.postRotation.map(b.M8C.degToRad);cn.push(c.eulerOrder||b.USm.DefaultOrder),a.makeRotationFromEuler(YC.fromArray(cn)),a.invert()}c.scale&&h.scale(j0.fromArray(c.scale)),c.scalingOffset&&_.setPosition(j0.fromArray(c.scalingOffset)),c.scalingPivot&&d.setPosition(j0.fromArray(c.scalingPivot)),c.rotationOffset&&et.setPosition(j0.fromArray(c.rotationOffset)),c.rotationPivot&&nt.setPosition(j0.fromArray(c.rotationPivot)),c.parentMatrixWorld&&(lt.copy(c.parentMatrix),it.copy(c.parentMatrixWorld));const gt=i.clone().multiply(s).multiply(a),vt=new b.yGw;vt.extractRotation(it);const Ct=new b.yGw;Ct.copyPosition(it);const wt=Ct.clone().invert().multiply(it),xt=vt.clone().invert().multiply(wt),_t=h,Pt=new b.yGw;if(pt===0)Pt.copy(vt).multiply(gt).multiply(xt).multiply(_t);else if(pt===1)Pt.copy(vt).multiply(xt).multiply(gt).multiply(_t);else{const cn=new b.yGw().scale(new b.Pa4().setFromMatrixScale(lt)).clone().invert(),An=xt.clone().multiply(cn);Pt.copy(vt).multiply(gt).multiply(An).multiply(_t)}const Bt=nt.clone().invert(),Ot=d.clone().invert();let Lt=e.clone().multiply(et).multiply(nt).multiply(i).multiply(s).multiply(a).multiply(Bt).multiply(_).multiply(d).multiply(h).multiply(Ot);const qt=new b.yGw().copyPosition(Lt),en=it.clone().multiply(qt);return ut.copyPosition(en),Lt=ut.clone().multiply(Pt),Lt.premultiply(it.invert()),Lt}function Aw(c){const e=["ZYX","YZX","XZY","ZXY","YXZ","XYZ"];return(c=c||0)===6?(console.warn("THREE.FBXLoader: unsupported Euler Order: Spherical XYZ. Animations and rotations may be incorrect."),e[0]):e[c]}function $p(c){return c.split(",").map(function(e){return parseFloat(e)})}function Rs(c,e,i){return e===void 0&&(e=0),i===void 0&&(i=c.byteLength),b.Zp0.decodeText(new Uint8Array(c,e,i))}function lu(c,e,i){return c.slice(0,e).concat(i).concat(c.slice(e))}class qx extends ot{constructor(){super(...arguments),this.dependencies=[qr],this._importer=new Wo(Ts,["fbx"],!0)}async onAdded(e){io.Importers.push(this._importer)}async onDispose(e){}async onRemove(e){io.Importers.splice(io.Importers.indexOf(this._importer),1)}}qx.PluginType="FBXLoadPlugin";const XC=new WeakMap;class RD extends b.aNw{constructor(e){super(e),this.libraryPath="",this.libraryPending=null,this.libraryBinary=null,this.libraryConfig={},this.url="",this.workerLimit=4,this.workerPool=[],this.workerNextTaskID=1,this.workerSourceURL="",this.workerConfig={},this.materials=[],this.warnings=[]}setLibraryPath(e){return this.libraryPath=e,this}setWorkerLimit(e){return this.workerLimit=e,this}load(e,i,s,a){const h=new b.hH6(this.manager);h.setPath(this.path),h.setResponseType("arraybuffer"),h.setRequestHeader(this.requestHeader),this.url=e,h.load(e,d=>{if(XC.has(d))return XC.get(d).promise.then(i).catch(a);this.decodeObjects(d,e).then(_=>{_.userData.warnings=this.warnings,i(_)}).catch(_=>a(_))},s,a)}debug(){console.log("Task load: ",this.workerPool.map(e=>e._taskLoad))}decodeObjects(e,i){let s,a;const h=e.byteLength,d=this._getWorker(h).then(_=>(s=_,a=this.workerNextTaskID++,new Promise((et,nt)=>{s._callbacks[a]={resolve:et,reject:nt},s.postMessage({type:"decode",id:a,buffer:e},[e])}))).then(_=>this._createGeometry(_.data)).catch(_=>{throw _});return d.catch(()=>!0).then(()=>{s&&a&&this._releaseTask(s,a)}),XC.set(e,{url:i,promise:d}),d}parse(e,i,s){this.decodeObjects(e,"").then(a=>{a.userData.warnings=this.warnings,i(a)}).catch(a=>s(a))}_compareMaterials(e){const i={};i.name=e.name,i.color={},i.color.r=e.color.r,i.color.g=e.color.g,i.color.b=e.color.b,i.type=e.type;for(let s=0;s<this.materials.length;s++){const a=this.materials[s],h={};if(h.name=a.name,h.color={},h.color.r=a.color.r,h.color.g=a.color.g,h.color.b=a.color.b,h.type=a.type,JSON.stringify(i)===JSON.stringify(h))return a}return this.materials.push(e),e}_createMaterial(e){if(e===void 0)return new b.Wid({color:new b.Ilk(1,1,1),metalness:.8,name:"default",side:2});const i=e.diffuseColor,s=new b.Ilk(i.r/255,i.g/255,i.b/255);i.r===0&&i.g===0&&i.b===0&&(s.r=1,s.g=1,s.b=1);const a=new b.Wid({color:s,name:e.name,side:2,transparent:e.transparency>0,opacity:1-e.transparency}),h=new b.dpR;for(let d=0;d<e.textures.length;d++){const _=e.textures[d];if(_.image!==null){const et=h.load(_.image);switch(_.type){case"Diffuse":a.map=et;break;case"Bump":a.bumpMap=et;break;case"Transparency":a.alphaMap=et,a.transparent=!0;break;case"Emap":a.envMap=et}et.wrapS=_.wrapU===0?b.rpg:b.uWy,et.wrapT=_.wrapV===0?b.rpg:b.uWy,et.repeat.set(_.repeat[0],_.repeat[1])}}return a}_createGeometry(e){const i=new b.Tme,s=[],a=[],h=[];i.userData.layers=e.layers,i.userData.groups=e.groups,i.userData.settings=e.settings,i.userData.objectType="File3dm",i.userData.materials=null,i.name=this.url;let d=e.objects;const _=e.materials;for(let et=0;et<d.length;et++){const nt=d[et],it=nt.attributes;switch(nt.objectType){case"InstanceDefinition":a.push(nt);break;case"InstanceReference":h.push(nt);break;default:let lt;if(it.materialIndex>=0){const pt=_[it.materialIndex];let gt=this._createMaterial(pt);gt=this._compareMaterials(gt),lt=this._createObject(nt,gt)}else{const pt=this._createMaterial();lt=this._createObject(nt,pt)}if(lt===void 0)continue;const ut=e.layers[it.layerIndex];lt.visible=!ut||e.layers[it.layerIndex].visible,it.isInstanceDefinitionObject?s.push(lt):i.add(lt)}}for(let et=0;et<a.length;et++){const nt=a[et];d=[];for(let it=0;it<nt.attributes.objectIds.length;it++){const lt=nt.attributes.objectIds[it];for(let ut=0;ut<s.length;ut++)lt===s[ut].userData.attributes.id&&d.push(s[ut])}for(let it=0;it<h.length;it++){const lt=h[it];if(lt.geometry.parentIdefId===nt.attributes.id){const ut=new b.Tme,pt=lt.geometry.xform.array,gt=new b.yGw;gt.set(pt[0],pt[1],pt[2],pt[3],pt[4],pt[5],pt[6],pt[7],pt[8],pt[9],pt[10],pt[11],pt[12],pt[13],pt[14],pt[15]),ut.applyMatrix4(gt);for(let vt=0;vt<d.length;vt++)ut.add(d[vt].clone(!0));i.add(ut)}}}return i.userData.materials=this.materials,i}_createObject(e,i){const s=new b.s4_,a=e.attributes;let h,d,_,et;switch(e.objectType){case"Point":case"PointSet":h=s.parse(e.geometry),h.attributes.hasOwnProperty("color")?d=new b.UY4({vertexColors:!0,sizeAttenuation:!1,size:2}):(_=a.drawColor,et=new b.Ilk(_.r/255,_.g/255,_.b/255),d=new b.UY4({color:et,sizeAttenuation:!1,size:2})),d=this._compareMaterials(d);const nt=new b.woe(h,d);return nt.userData.attributes=a,nt.userData.objectType=e.objectType,a.name&&(nt.name=a.name),nt;case"Mesh":case"Extrusion":case"SubD":case"Brep":if(e.geometry===null)return;h=s.parse(e.geometry),h.attributes.hasOwnProperty("color")&&(i.vertexColors=!0),i===null&&(i=this._createMaterial(),i=this._compareMaterials(i));const it=new b.Kj0(h,i);return it.castShadow=a.castsShadows,it.receiveShadow=a.receivesShadows,it.userData.attributes=a,it.userData.objectType=e.objectType,a.name&&(it.name=a.name),it;case"Curve":h=s.parse(e.geometry),_=a.drawColor,et=new b.Ilk(_.r/255,_.g/255,_.b/255),d=new b.nls({color:et}),d=this._compareMaterials(d);const lt=new b.x12(h,d);return lt.userData.attributes=a,lt.userData.objectType=e.objectType,a.name&&(lt.name=a.name),lt;case"TextDot":h=e.geometry;const ut=document.createElement("canvas").getContext("2d"),pt=`${h.fontHeight}px ${h.fontFace}`;ut.font=pt;const gt=ut.measureText(h.text).width+10,vt=h.fontHeight+10,Ct=window.devicePixelRatio;ut.canvas.width=gt*Ct,ut.canvas.height=vt*Ct,ut.canvas.style.width=gt+"px",ut.canvas.style.height=vt+"px",ut.setTransform(Ct,0,0,Ct,0,0),ut.font=pt,ut.textBaseline="middle",ut.textAlign="center",et=a.drawColor,ut.fillStyle=`rgba(${et.r},${et.g},${et.b},${et.a})`,ut.fillRect(0,0,gt,vt),ut.fillStyle="white",ut.fillText(h.text,gt/2,vt/2);const wt=new b.ROQ(ut.canvas);wt.minFilter=b.wem,wt.wrapS=b.uWy,wt.wrapT=b.uWy,d=new b.xeV({map:wt,depthTest:!1});const xt=new b.jyi(d);return xt.position.set(h.point[0],h.point[1],h.point[2]),xt.scale.set(gt/10,vt/10,1),xt.userData.attributes=a,xt.userData.objectType=e.objectType,a.name&&(xt.name=a.name),xt;case"Light":let _t;switch(h=e.geometry,h.lightStyle.name){case"LightStyle_WorldPoint":_t=new b.cek,_t.castShadow=a.castsShadows,_t.position.set(h.location[0],h.location[1],h.location[2]),_t.shadow.normalBias=.1;break;case"LightStyle_WorldSpot":_t=new b.PMe,_t.castShadow=a.castsShadows,_t.position.set(h.location[0],h.location[1],h.location[2]),_t.target.position.set(h.direction[0],h.direction[1],h.direction[2]),_t.angle=h.spotAngleRadians,_t.shadow.normalBias=.1;break;case"LightStyle_WorldRectangular":_t=new b.T_f;const Pt=Math.abs(h.width[2]),Bt=Math.abs(h.length[0]);_t.position.set(h.location[0]-Bt/2,h.location[1],h.location[2]-Pt/2),_t.height=Bt,_t.width=Pt,_t.lookAt(new b.Pa4(h.direction[0],h.direction[1],h.direction[2]));break;case"LightStyle_WorldDirectional":_t=new b.Ox3,_t.castShadow=a.castsShadows,_t.position.set(h.location[0],h.location[1],h.location[2]),_t.target.position.set(h.direction[0],h.direction[1],h.direction[2]),_t.shadow.normalBias=.1}return _t&&(_t.intensity=h.intensity,_=h.diffuse,et=new b.Ilk(_.r/255,_.g/255,_.b/255),_t.color=et,_t.userData.attributes=a,_t.userData.objectType=e.objectType),_t}}_initLibrary(){if(!this.libraryPending){const e=new b.hH6(this.manager);e.setPath(this.libraryPath);const i=new Promise((h,d)=>{e.load("rhino3dm.js",h,void 0,d)}),s=new b.hH6(this.manager);s.setPath(this.libraryPath),s.setResponseType("arraybuffer");const a=new Promise((h,d)=>{s.load("rhino3dm.wasm",h,void 0,d)});this.libraryPending=Promise.all([i,a]).then(([h,d])=>{this.libraryConfig.wasmBinary=d;const _=XE.toString(),et=["/* rhino3dm.js */",h,"/* worker */",_.substring(_.indexOf("{")+1,_.lastIndexOf("}"))].join(`
`);this.workerSourceURL=URL.createObjectURL(new Blob([et]))})}return this.libraryPending}_getWorker(e){return this._initLibrary().then(()=>{if(this.workerPool.length<this.workerLimit){const s=new Worker(this.workerSourceURL);s._callbacks={},s._taskCosts={},s._taskLoad=0,s.postMessage({type:"init",libraryConfig:this.libraryConfig}),s.onmessage=a=>{const h=a.data;switch(h.type){case"warning":this.warnings.push(h.data),console.warn(h.data);break;case"decode":s._callbacks[h.id].resolve(h);break;case"error":s._callbacks[h.id].reject(h);break;default:console.error('THREE.Rhino3dmLoader: Unexpected message, "'+h.type+'"')}},this.workerPool.push(s)}else this.workerPool.sort(function(s,a){return s._taskLoad>a._taskLoad?-1:1});const i=this.workerPool[this.workerPool.length-1];return i._taskLoad+=e,i})}_releaseTask(e,i){e._taskLoad-=e._taskCosts[i],delete e._callbacks[i],delete e._taskCosts[i]}dispose(){for(let e=0;e<this.workerPool.length;++e)this.workerPool[e].terminate();return this.workerPool.length=0,this}}function XE(){let c,e,i,s;function a(_,et){const nt=_.geometry(),it=_.attributes();let lt,ut,pt,gt,vt,Ct=nt.objectType;switch(Ct){case i.ObjectType.Curve:const wt=d(nt,100);pt={},ut={},gt={},pt.itemSize=3,pt.type="Float32Array",pt.array=[];for(let Ot=0;Ot<wt.length;Ot++)pt.array.push(wt[Ot][0]),pt.array.push(wt[Ot][1]),pt.array.push(wt[Ot][2]);ut.position=pt,gt.attributes=ut,lt={data:gt};break;case i.ObjectType.Point:const xt=nt.location;pt={};const _t={};ut={},gt={},pt.itemSize=3,pt.type="Float32Array",pt.array=[xt[0],xt[1],xt[2]];const Pt=it.drawColor(et);_t.itemSize=3,_t.type="Float32Array",_t.array=[Pt.r/255,Pt.g/255,Pt.b/255],ut.position=pt,ut.color=_t,gt.attributes=ut,lt={data:gt};break;case i.ObjectType.PointSet:case i.ObjectType.Mesh:lt=nt.toThreejsJSON();break;case i.ObjectType.Brep:const Bt=nt.faces();vt=new i.Mesh;for(let Ot=0;Ot<Bt.count;Ot++){const Lt=Bt.get(Ot),qt=Lt.getMesh(i.MeshType.Any);qt&&(vt.append(qt),qt.delete()),Lt.delete()}vt.faces().count>0&&(vt.compact(),lt=vt.toThreejsJSON(),Bt.delete()),vt.delete();break;case i.ObjectType.Extrusion:vt=nt.getMesh(i.MeshType.Any),vt&&(lt=vt.toThreejsJSON(),vt.delete());break;case i.ObjectType.TextDot:lt=h(nt);break;case i.ObjectType.Light:lt=h(nt),lt.lightStyle.name==="LightStyle_WorldLinear"&&self.postMessage({type:"warning",id:s,data:{message:`THREE.3DMLoader: No conversion exists for ${Ct.constructor.name} ${lt.lightStyle.name}`,type:"no conversion",guid:it.id}});break;case i.ObjectType.InstanceReference:lt=h(nt),lt.xform=h(nt.xform),lt.xform.array=nt.xform.toFloatArray(!0);break;case i.ObjectType.SubD:nt.subdivide(3),vt=i.Mesh.createFromSubDControlNet(nt),vt&&(lt=vt.toThreejsJSON(),vt.delete());break;default:self.postMessage({type:"warning",id:s,data:{message:`THREE.3DMLoader: Conversion not implemented for ${Ct.constructor.name}`,type:"not implemented",guid:it.id}})}if(lt)return ut=h(it),ut.geometry=h(nt),it.groupCount>0&&(ut.groupIds=it.getGroupList()),it.userStringCount>0&&(ut.userStrings=it.getUserStrings()),nt.userStringCount>0&&(ut.geometry.userStrings=nt.getUserStrings()),ut.drawColor=it.drawColor(et),Ct=Ct.constructor.name,Ct=Ct.substring(11,Ct.length),{geometry:lt,attributes:ut,objectType:Ct};self.postMessage({type:"warning",id:s,data:{message:`THREE.3DMLoader: ${Ct.constructor.name} has no associated mesh geometry.`,type:"missing mesh",guid:it.id}})}function h(_){const et={};for(const nt in _){const it=_[nt];typeof it!="function"&&(typeof it=="object"&&it!==null&&it.hasOwnProperty("constructor")?et[nt]={name:it.constructor.name,value:it.value}:et[nt]=it)}return et}function d(_,et){let nt=et,it=[];const lt=[];if(_ instanceof i.LineCurve)return[_.pointAtStart,_.pointAtEnd];if(_ instanceof i.PolylineCurve){nt=_.pointCount;for(let gt=0;gt<nt;gt++)it.push(_.point(gt));return it}if(_ instanceof i.PolyCurve){const gt=_.segmentCount;for(let vt=0;vt<gt;vt++){const Ct=_.segmentCurve(vt),wt=d(Ct,nt);it=it.concat(wt),Ct.delete()}return it}if(_ instanceof i.ArcCurve&&(nt=Math.floor(_.angleDegrees/5),nt=nt<2?2:nt),_ instanceof i.NurbsCurve&&_.degree===1){const gt=_.tryGetPolyline();for(let vt=0;vt<gt.count;vt++)it.push(gt.get(vt));return gt.delete(),it}const ut=_.domain,pt=nt-1;for(let gt=0;gt<nt;gt++){const vt=ut[0]+gt/pt*(ut[1]-ut[0]);if(vt===ut[0]||vt===ut[1]){lt.push(vt);continue}const Ct=_.tangentAt(vt),wt=_.tangentAt(lt.slice(-1)[0]),xt=Ct[0]*Ct[0]+Ct[1]*Ct[1]+Ct[2]*Ct[2],_t=wt[0]*wt[0]+wt[1]*wt[1]+wt[2]*wt[2],Pt=Math.sqrt(xt*_t);let Bt;if(Pt===0)Bt=Math.PI/2;else{const Ot=(Ct.x*wt.x+Ct.y*wt.y+Ct.z*wt.z)/Pt;Bt=Math.acos(Math.max(-1,Math.min(1,Ot)))}Bt<.1||lt.push(vt)}return it=lt.map(gt=>_.pointAt(gt)),it}onmessage=function(_){const et=_.data;switch(et.type){case"init":e=et.libraryConfig;const nt=e.wasmBinary;let it;c=new Promise(function(ut){it={wasmBinary:nt,onRuntimeInitialized:ut},rhino3dm(it)}).then(()=>{i=it});break;case"decode":s=et.id;const lt=et.buffer;c.then(()=>{try{const ut=function(pt,gt){const vt=new Uint8Array(gt),Ct=pt.File3dm.fromByteArray(vt),wt=[],xt=[],_t=[],Pt=[],Bt=[],Ot=[],Lt=[],qt=Ct.objects(),en=qt.count;for(let vn=0;vn<en;vn++){const xn=qt.get(vn),Un=a(xn,Ct);xn.delete(),Un&&wt.push(Un)}for(let vn=0;vn<Ct.instanceDefinitions().count();vn++){const xn=Ct.instanceDefinitions().get(vn),Un=h(xn);Un.objectIds=xn.getObjectIds(),wt.push({geometry:null,attributes:Un,objectType:"InstanceDefinition"})}const cn=[pt.TextureType.Diffuse,pt.TextureType.Bump,pt.TextureType.Transparency,pt.TextureType.Opacity,pt.TextureType.Emap],An=[pt.TextureType.PBR_BaseColor,pt.TextureType.PBR_Subsurface,pt.TextureType.PBR_SubsurfaceScattering,pt.TextureType.PBR_SubsurfaceScatteringRadius,pt.TextureType.PBR_Metallic,pt.TextureType.PBR_Specular,pt.TextureType.PBR_SpecularTint,pt.TextureType.PBR_Roughness,pt.TextureType.PBR_Anisotropic,pt.TextureType.PBR_Anisotropic_Rotation,pt.TextureType.PBR_Sheen,pt.TextureType.PBR_SheenTint,pt.TextureType.PBR_Clearcoat,pt.TextureType.PBR_ClearcoatBump,pt.TextureType.PBR_ClearcoatRoughness,pt.TextureType.PBR_OpacityIor,pt.TextureType.PBR_OpacityRoughness,pt.TextureType.PBR_Emission,pt.TextureType.PBR_AmbientOcclusion,pt.TextureType.PBR_Displacement];for(let vn=0;vn<Ct.materials().count();vn++){const xn=Ct.materials().get(vn),Un=xn.physicallyBased();let Mn=h(xn);const Gn=[];for(let rr=0;rr<cn.length;rr++){const dr=xn.getTexture(cn[rr]);if(dr){let _i=cn[rr].constructor.name;_i=_i.substring(12,_i.length);const xr={type:_i},Cr=Ct.getEmbeddedFileAsBase64(dr.fileName);xr.wrapU=dr.wrapU,xr.wrapV=dr.wrapV,xr.wrapW=dr.wrapW;const Mr=dr.uvwTransform.toFloatArray(!0);xr.repeat=[Mr[0],Mr[5]],Cr?xr.image="data:image/png;base64,"+Cr:(self.postMessage({type:"warning",id:s,data:{message:`THREE.3DMLoader: Image for ${_i} texture not embedded in file.`,type:"missing resource"}}),xr.image=null),Gn.push(xr),dr.delete()}}if(Mn.textures=Gn,Un.supported){for(let dr=0;dr<An.length;dr++){const _i=xn.getTexture(An[dr]);if(_i){const xr=Ct.getEmbeddedFileAsBase64(_i.fileName);let Cr=An[dr].constructor.name;Cr=Cr.substring(12,Cr.length);const Mr={type:Cr,image:"data:image/png;base64,"+xr};Gn.push(Mr),_i.delete()}}const rr=h(xn.physicallyBased());Mn=Object.assign(rr,Mn)}xt.push(Mn),xn.delete(),Un.delete()}for(let vn=0;vn<Ct.layers().count();vn++){const xn=Ct.layers().get(vn),Un=h(xn);_t.push(Un),xn.delete()}for(let vn=0;vn<Ct.views().count();vn++){const xn=Ct.views().get(vn),Un=h(xn);Pt.push(Un),xn.delete()}for(let vn=0;vn<Ct.namedViews().count();vn++){const xn=Ct.namedViews().get(vn),Un=h(xn);Bt.push(Un),xn.delete()}for(let vn=0;vn<Ct.groups().count();vn++){const xn=Ct.groups().get(vn),Un=h(xn);Ot.push(Un),xn.delete()}const mn=h(Ct.settings()),Tn=Ct.strings().count();for(let vn=0;vn<Tn;vn++)Lt.push(Ct.strings().get(vn));return Ct.delete(),{objects:wt,materials:xt,layers:_t,views:Pt,namedViews:Bt,groups:Ot,strings:Lt,settings:mn}}(i,lt);self.postMessage({type:"decode",id:et.id,data:ut})}catch(ut){self.postMessage({type:"error",id:et.id,error:ut})}})}}}class uI extends RD{constructor(e){super(e),this.setLibraryPath("https://cdn.jsdelivr.net/npm/rhino3dm@7.15.0/")}async loadAsync(e,i){const s=await super.loadAsync(e,i);return s.rotateX(-Math.PI/2),s}}class KC extends ot{constructor(){super(...arguments),this.dependencies=[qr],this._importer=new Wo(uI,["3dm"],!0)}async onAdded(e){io.Importers.push(this._importer)}async onDispose(e){}async onRemove(e){io.Importers.splice(io.Importers.indexOf(this._importer),1)}}KC.PluginType="Rhino3dmLoadPlugin";class JC extends ot{constructor(){super(...arguments),this.dependencies=[qr]}async onAdded(e){const i=document.createElement("script");i.type="module",i.innerHTML=`
import { MeshoptDecoder } from 'https://cdn.jsdelivr.net/gh/zeux/meshoptimizer@master/js/meshopt_decoder.module.js'
window.MeshoptDecoder = MeshoptDecoder
`,document.head.appendChild(i),this._script=i}async onDispose(e){}async onRemove(e){this._script&&(document.head.removeChild(this._script),this._script=void 0)}}JC.PluginType="GLTFMeshOptPlugin";class BD extends b.aNw{constructor(e){super(e)}load(e,i,s,a){const h=this,d=new b.hH6(this.manager);d.setPath(this.path),d.setResponseType("arraybuffer"),d.setRequestHeader(this.requestHeader),d.setWithCredentials(this.withCredentials),d.load(e,function(_){try{i(h.parse(_))}catch(et){a?a(et):console.error(et),h.manager.itemError(e)}},s,a)}parse(e){function i(h,d,_){for(let et=0,nt=h.length;et<nt;et++)if(h[et]!==d.getUint8(_+et))return!1;return!0}const s=function(h){if(typeof h=="string"){const d=new Uint8Array(h.length);for(let _=0;_<h.length;_++)d[_]=255&h.charCodeAt(_);return d.buffer||d}return h}(e);return function(h){const d=new DataView(h);if(84+50*d.getUint32(80,!0)===d.byteLength)return!0;const _=[115,111,108,105,100];for(let et=0;et<5;et++)if(i(_,d,et))return!1;return!0}(s)?function(h){const d=new DataView(h),_=d.getUint32(80,!0);let et,nt,it,lt,ut,pt,gt,vt,Ct=!1;for(let Pt=0;Pt<70;Pt++)d.getUint32(Pt,!1)==1129270351&&d.getUint8(Pt+4)==82&&d.getUint8(Pt+5)==61&&(Ct=!0,lt=new Float32Array(3*_*3),ut=d.getUint8(Pt+6)/255,pt=d.getUint8(Pt+7)/255,gt=d.getUint8(Pt+8)/255,vt=d.getUint8(Pt+9)/255);const wt=new b.u9r,xt=new Float32Array(3*_*3),_t=new Float32Array(3*_*3);for(let Pt=0;Pt<_;Pt++){const Bt=84+50*Pt,Ot=d.getFloat32(Bt,!0),Lt=d.getFloat32(Bt+4,!0),qt=d.getFloat32(Bt+8,!0);if(Ct){const en=d.getUint16(Bt+48,!0);32768&en?(et=ut,nt=pt,it=gt):(et=(31&en)/31,nt=(en>>5&31)/31,it=(en>>10&31)/31)}for(let en=1;en<=3;en++){const cn=Bt+12*en,An=3*Pt*3+3*(en-1);xt[An]=d.getFloat32(cn,!0),xt[An+1]=d.getFloat32(cn+4,!0),xt[An+2]=d.getFloat32(cn+8,!0),_t[An]=Ot,_t[An+1]=Lt,_t[An+2]=qt,Ct&&(lt[An]=et,lt[An+1]=nt,lt[An+2]=it)}}return wt.setAttribute("position",new b.TlE(xt,3)),wt.setAttribute("normal",new b.TlE(_t,3)),Ct&&(wt.setAttribute("color",new b.TlE(lt,3)),wt.hasColors=!0,wt.alpha=vt),wt}(s):function(h){const d=new b.u9r,_=/solid([\s\S]*?)endsolid/g,et=/facet([\s\S]*?)endfacet/g;let nt=0;const it=/[\s]+([+-]?(?:\d*)(?:\.\d*)?(?:[eE][+-]?\d+)?)/.source,lt=new RegExp("vertex"+it+it+it,"g"),ut=new RegExp("normal"+it+it+it,"g"),pt=[],gt=[],vt=new b.Pa4;let Ct,wt=0,xt=0,_t=0;for(;(Ct=_.exec(h))!==null;){xt=_t;const Pt=Ct[0];for(;(Ct=et.exec(Pt))!==null;){let Lt=0,qt=0;const en=Ct[0];for(;(Ct=ut.exec(en))!==null;)vt.x=parseFloat(Ct[1]),vt.y=parseFloat(Ct[2]),vt.z=parseFloat(Ct[3]),qt++;for(;(Ct=lt.exec(en))!==null;)pt.push(parseFloat(Ct[1]),parseFloat(Ct[2]),parseFloat(Ct[3])),gt.push(vt.x,vt.y,vt.z),Lt++,_t++;qt!==1&&console.error("THREE.STLLoader: Something isn't right with the normal of face number "+nt),Lt!==3&&console.error("THREE.STLLoader: Something isn't right with the vertices of face number "+nt),nt++}const Bt=xt,Ot=_t-xt;d.addGroup(Bt,Ot,wt),wt++}return d.setAttribute("position",new b.a$l(pt,3)),d.setAttribute("normal",new b.a$l(gt,3)),d}(typeof(a=e)!="string"?b.Zp0.decodeText(new Uint8Array(a)):a);var a}}class ZC extends ot{constructor(){super(...arguments),this.dependencies=[qr]}async onAdded(e){this._importer||(this._importer=new Wo(BD,["stl"],!0)),io.Importers.push(this._importer)}async onDispose(e){this._importer=void 0}async onRemove(e){this._importer&&io.Importers.splice(io.Importers.indexOf(this._importer),1),this._importer=void 0}}ZC.PluginType="STLLoadPlugin";class hI extends b.aNw{constructor(e){super(e)}load(e,i,s,a){const h=this,d=this.path===""?b.Zp0.extractUrlBase(e):this.path,_=new b.hH6(this.manager);_.setPath(this.path),_.setRequestHeader(this.requestHeader),_.setWithCredentials(this.withCredentials),_.load(e,function(et){try{i(h.parse(et,d))}catch(nt){a?a(nt):console.error(nt),h.manager.itemError(e)}},s,a)}setMaterialOptions(e){return this.materialOptions=e,this}parse(e,i){const s=e.split(`
`);let a={};const h=/\s+/,d={};for(let et=0;et<s.length;et++){let nt=s[et];if(nt=nt.trim(),nt.length===0||nt.charAt(0)==="#")continue;const it=nt.indexOf(" ");let lt=it>=0?nt.substring(0,it):nt;lt=lt.toLowerCase();let ut=it>=0?nt.substring(it+1):"";if(ut=ut.trim(),lt==="newmtl")a={name:ut},d[ut]=a;else if(lt==="ka"||lt==="kd"||lt==="ks"||lt==="ke"){const pt=ut.split(h,3);a[lt]=[parseFloat(pt[0]),parseFloat(pt[1]),parseFloat(pt[2])]}else a[lt]=ut}const _=new dI(this.resourcePath||i,this.materialOptions);return _.setCrossOrigin(this.crossOrigin),_.setManager(this.manager),_.setMaterials(d),_}}class dI{constructor(e="",i={}){this.baseUrl=e,this.options=i,this.materialsInfo={},this.materials={},this.materialsArray=[],this.nameLookup={},this.crossOrigin="anonymous",this.side=this.options.side!==void 0?this.options.side:b.Wl3,this.wrap=this.options.wrap!==void 0?this.options.wrap:b.rpg}setCrossOrigin(e){return this.crossOrigin=e,this}setManager(e){this.manager=e}setMaterials(e){this.materialsInfo=this.convert(e),this.materials={},this.materialsArray=[],this.nameLookup={}}convert(e){if(!this.options)return e;const i={};for(const s in e){const a=e[s],h={};i[s]=h;for(const d in a){let _=!0,et=a[d];const nt=d.toLowerCase();switch(nt){case"kd":case"ka":case"ks":this.options&&this.options.normalizeRGB&&(et=[et[0]/255,et[1]/255,et[2]/255]),this.options&&this.options.ignoreZeroRGBs&&et[0]===0&&et[1]===0&&et[2]===0&&(_=!1)}_&&(h[nt]=et)}}return i}async preload(){for(const e in this.materialsInfo)await this.create(e)}getIndex(e){return this.nameLookup[e]}async getAsArray(){let e=0;for(const i in this.materialsInfo)this.materialsArray[e]=await this.create(i),this.nameLookup[i]=e,e++;return this.materialsArray}async create(e){return this.materials[e]===void 0&&await this.createMaterial_(e),this.materials[e]}async createMaterial_(e){const i=this,s=this.materialsInfo[e],a={name:e,side:this.side};async function h(et,nt){if(a[et])return;const it=i.getTextureParams(nt,a);return new Promise((lt,ut)=>{let pt=!1,gt=()=>!pt&&(pt=!0)&&lt();const vt=i.loadTexture((Ct=i.baseUrl,typeof(wt=it.url)!="string"||wt===""?"":/^https?:\/\//i.test(wt)?wt:Ct+wt),void 0,xt=>{a[et]=xt,gt()},void 0,gt);var Ct,wt;setTimeout(gt,50),vt.repeat.copy(it.scale),vt.offset.copy(it.offset),vt.wrapS=i.wrap,vt.wrapT=i.wrap})}const d=Array.from(Object.keys(s||{}));let _=d.includes("d")||d.includes("D");for(const et of d){const nt=s[et];let it;if(nt!=="")switch(et.toLowerCase()){case"kd":a.color=new b.Ilk().fromArray(nt);break;case"ks":a.specular=new b.Ilk().fromArray(nt);break;case"ke":a.emissive=new b.Ilk().fromArray(nt);break;case"map_kd":await h("map",nt);break;case"map_ks":await h("specularMap",nt);break;case"map_ke":await h("emissiveMap",nt);break;case"norm":await h("normalMap",nt);break;case"map_bump":case"bump":await h("bumpMap",nt);break;case"map_d":await h("alphaMap",nt),a.transparent=!0;break;case"ns":a.shininess=parseFloat(nt);break;case"d":it=parseFloat(nt),it<1&&(a.opacity=it,a.transparent=!0);break;case"tr":if(_)break;it=parseFloat(nt),this.options&&this.options.invertTrProperty&&(it=1-it),it>0&&(a.opacity=1-it,a.transparent=!0)}}return this.materials[e]=new b.xoR(a),this.materials[e]}getTextureParams(e,i){const s={scale:new b.FM8(1,1),offset:new b.FM8(0,0)},a=e.split(/\s+/);let h;return h=a.indexOf("-bm"),h>=0&&(i.bumpScale=parseFloat(a[h+1]),a.splice(h,2)),h=a.indexOf("-s"),h>=0&&(s.scale.set(parseFloat(a[h+1]),parseFloat(a[h+2])),a.splice(h,4)),h=a.indexOf("-o"),h>=0&&(s.offset.set(parseFloat(a[h+1]),parseFloat(a[h+2])),a.splice(h,4)),s.url=a.join(" ").trim(),s}loadTexture(e,i,s,a,h){const d=this.manager!==void 0?this.manager:b.tEQ;let _=d.getHandler(e);_===null&&(_=new b.dpR(d)),_.setCrossOrigin&&_.setCrossOrigin(this.crossOrigin);const et=_.load(e,s,a,h);return i!==void 0&&(et.mapping=i),et}}const kD=/^[og]\s*(.+)?/,zo=/^mtllib /,OD=/^usemtl /,z0=/^usemap /,B_=new b.Pa4,KE=new b.Pa4,yw=new b.Pa4,JE=new b.Pa4,Jo=new b.Pa4;function oy(){const c={objects:[],object:{},vertices:[],normals:[],colors:[],uvs:[],materials:{},materialLibraries:[],startObject:function(e,i){if(this.object&&this.object.fromDeclaration===!1)return this.object.name=e,void(this.object.fromDeclaration=i!==!1);const s=this.object&&typeof this.object.currentMaterial=="function"?this.object.currentMaterial():void 0;if(this.object&&typeof this.object._finalize=="function"&&this.object._finalize(!0),this.object={name:e||"",fromDeclaration:i!==!1,geometry:{vertices:[],normals:[],colors:[],uvs:[],hasUVIndices:!1},materials:[],smooth:!0,startMaterial:function(a,h){const d=this._finalize(!1);d&&(d.inherited||d.groupCount<=0)&&this.materials.splice(d.index,1);const _={index:this.materials.length,name:a||"",mtllib:Array.isArray(h)&&h.length>0?h[h.length-1]:"",smooth:d!==void 0?d.smooth:this.smooth,groupStart:d!==void 0?d.groupEnd:0,groupEnd:-1,groupCount:-1,inherited:!1,clone:function(et){const nt={index:typeof et=="number"?et:this.index,name:this.name,mtllib:this.mtllib,smooth:this.smooth,groupStart:0,groupEnd:-1,groupCount:-1,inherited:!1};return nt.clone=this.clone.bind(nt),nt}};return this.materials.push(_),_},currentMaterial:function(){if(this.materials.length>0)return this.materials[this.materials.length-1]},_finalize:function(a){const h=this.currentMaterial();if(h&&h.groupEnd===-1&&(h.groupEnd=this.geometry.vertices.length/3,h.groupCount=h.groupEnd-h.groupStart,h.inherited=!1),a&&this.materials.length>1)for(let d=this.materials.length-1;d>=0;d--)this.materials[d].groupCount<=0&&this.materials.splice(d,1);return a&&this.materials.length===0&&this.materials.push({name:"",smooth:this.smooth}),h}},s&&s.name&&typeof s.clone=="function"){const a=s.clone(0);a.inherited=!0,this.object.materials.push(a)}this.objects.push(this.object)},finalize:function(){this.object&&typeof this.object._finalize=="function"&&this.object._finalize(!0)},parseVertexIndex:function(e,i){const s=parseInt(e,10);return 3*(s>=0?s-1:s+i/3)},parseNormalIndex:function(e,i){const s=parseInt(e,10);return 3*(s>=0?s-1:s+i/3)},parseUVIndex:function(e,i){const s=parseInt(e,10);return 2*(s>=0?s-1:s+i/2)},addVertex:function(e,i,s){const a=this.vertices,h=this.object.geometry.vertices;h.push(a[e+0],a[e+1],a[e+2]),h.push(a[i+0],a[i+1],a[i+2]),h.push(a[s+0],a[s+1],a[s+2])},addVertexPoint:function(e){const i=this.vertices;this.object.geometry.vertices.push(i[e+0],i[e+1],i[e+2])},addVertexLine:function(e){const i=this.vertices;this.object.geometry.vertices.push(i[e+0],i[e+1],i[e+2])},addNormal:function(e,i,s){const a=this.normals,h=this.object.geometry.normals;h.push(a[e+0],a[e+1],a[e+2]),h.push(a[i+0],a[i+1],a[i+2]),h.push(a[s+0],a[s+1],a[s+2])},addFaceNormal:function(e,i,s){const a=this.vertices,h=this.object.geometry.normals;B_.fromArray(a,e),KE.fromArray(a,i),yw.fromArray(a,s),Jo.subVectors(yw,KE),JE.subVectors(B_,KE),Jo.cross(JE),Jo.normalize(),h.push(Jo.x,Jo.y,Jo.z),h.push(Jo.x,Jo.y,Jo.z),h.push(Jo.x,Jo.y,Jo.z)},addColor:function(e,i,s){const a=this.colors,h=this.object.geometry.colors;a[e]!==void 0&&h.push(a[e+0],a[e+1],a[e+2]),a[i]!==void 0&&h.push(a[i+0],a[i+1],a[i+2]),a[s]!==void 0&&h.push(a[s+0],a[s+1],a[s+2])},addUV:function(e,i,s){const a=this.uvs,h=this.object.geometry.uvs;h.push(a[e+0],a[e+1]),h.push(a[i+0],a[i+1]),h.push(a[s+0],a[s+1])},addDefaultUV:function(){const e=this.object.geometry.uvs;e.push(0,0),e.push(0,0),e.push(0,0)},addUVLine:function(e){const i=this.uvs;this.object.geometry.uvs.push(i[e+0],i[e+1])},addFace:function(e,i,s,a,h,d,_,et,nt){const it=this.vertices.length;let lt=this.parseVertexIndex(e,it),ut=this.parseVertexIndex(i,it),pt=this.parseVertexIndex(s,it);if(this.addVertex(lt,ut,pt),this.addColor(lt,ut,pt),_!==void 0&&_!==""){const gt=this.normals.length;lt=this.parseNormalIndex(_,gt),ut=this.parseNormalIndex(et,gt),pt=this.parseNormalIndex(nt,gt),this.addNormal(lt,ut,pt)}else this.addFaceNormal(lt,ut,pt);if(a!==void 0&&a!==""){const gt=this.uvs.length;lt=this.parseUVIndex(a,gt),ut=this.parseUVIndex(h,gt),pt=this.parseUVIndex(d,gt),this.addUV(lt,ut,pt),this.object.geometry.hasUVIndices=!0}else this.addDefaultUV()},addPointGeometry:function(e){this.object.geometry.type="Points";const i=this.vertices.length;for(let s=0,a=e.length;s<a;s++){const h=this.parseVertexIndex(e[s],i);this.addVertexPoint(h),this.addColor(h)}},addLineGeometry:function(e,i){this.object.geometry.type="Line";const s=this.vertices.length,a=this.uvs.length;for(let h=0,d=e.length;h<d;h++)this.addVertexLine(this.parseVertexIndex(e[h],s));for(let h=0,d=i.length;h<d;h++)this.addUVLine(this.parseUVIndex(i[h],a))}};return c.startObject("",!1),c}class ZE extends b.aNw{constructor(e){super(e),this.materials=null}load(e,i,s,a){const h=this,d=new b.hH6(this.manager);d.setPath(this.path),d.setRequestHeader(this.requestHeader),d.setWithCredentials(this.withCredentials),d.load(e,async function(_){try{i(await h.parse(_))}catch(et){a?a(et):console.error(et),h.manager.itemError(e)}},s,a)}setMaterials(e){return this.materials=e,this}async parse(e){const i=new oy;e.indexOf(`\r
`)!==-1&&(e=e.replace(/\r\n/g,`
`)),e.indexOf(`\\
`)!==-1&&(e=e.replace(/\\\n/g,""));const s=e.split(`
`);let a="",h="",d=0,_=[];const et=typeof"".trimLeft=="function";for(let it=0,lt=s.length;it<lt;it++)if(a=s[it],a=et?a.trimLeft():a.trim(),d=a.length,d!==0&&(h=a.charAt(0),h!=="#"))if(h==="v"){const ut=a.split(/\s+/);switch(ut[0]){case"v":i.vertices.push(parseFloat(ut[1]),parseFloat(ut[2]),parseFloat(ut[3])),ut.length>=7?i.colors.push(parseFloat(ut[4]),parseFloat(ut[5]),parseFloat(ut[6])):i.colors.push(void 0,void 0,void 0);break;case"vn":i.normals.push(parseFloat(ut[1]),parseFloat(ut[2]),parseFloat(ut[3]));break;case"vt":i.uvs.push(parseFloat(ut[1]),parseFloat(ut[2]))}}else if(h==="f"){const ut=a.substr(1).trim().split(/\s+/),pt=[];for(let vt=0,Ct=ut.length;vt<Ct;vt++){const wt=ut[vt];if(wt.length>0){const xt=wt.split("/");pt.push(xt)}}const gt=pt[0];for(let vt=1,Ct=pt.length-1;vt<Ct;vt++){const wt=pt[vt],xt=pt[vt+1];i.addFace(gt[0],wt[0],xt[0],gt[1],wt[1],xt[1],gt[2],wt[2],xt[2])}}else if(h==="l"){const ut=a.substring(1).trim().split(" ");let pt=[];const gt=[];if(a.indexOf("/")===-1)pt=ut;else for(let vt=0,Ct=ut.length;vt<Ct;vt++){const wt=ut[vt].split("/");wt[0]!==""&&pt.push(wt[0]),wt[1]!==""&&gt.push(wt[1])}i.addLineGeometry(pt,gt)}else if(h==="p"){const ut=a.substr(1).trim().split(" ");i.addPointGeometry(ut)}else if((_=kD.exec(a))!==null){const ut=(" "+_[0].substr(1).trim()).substr(1);i.startObject(ut)}else if(OD.test(a))i.object.startMaterial(a.substring(7).trim(),i.materialLibraries);else if(zo.test(a)){i.materialLibraries.push(a.substring(7).trim());const ut=a.substring(7).trim(),pt=this.manager.getHandler(ut);if(pt){const gt=await pt.loadAsync(ut).catch(vt=>{console.warn(vt)});gt&&this.setMaterials(gt)}else console.warn("OBJLoader2: Set MTLLoader to loading manager to load materials.")}else if(z0.test(a))console.warn('OBJLoader2: Rendering identifier "usemap" not supported. Textures must be defined in MTL files.');else if(h==="s"){if(_=a.split(" "),_.length>1){const pt=_[1].trim().toLowerCase();i.object.smooth=pt!=="0"&&pt!=="off"}else i.object.smooth=!0;const ut=i.object.currentMaterial();ut&&(ut.smooth=i.object.smooth)}else{if(a==="\0")continue;console.warn('THREE.OBJLoader: Unexpected line: "'+a+'"')}i.finalize();const nt=new b.ZAu;if(nt.materialLibraries=[].concat(i.materialLibraries),!(i.objects.length===1&&i.objects[0].geometry.vertices.length===0))for(let it=0,lt=i.objects.length;it<lt;it++){const ut=i.objects[it],pt=ut.geometry,gt=ut.materials,vt=pt.type==="Line",Ct=pt.type==="Points";let wt=!1;if(pt.vertices.length===0)continue;const xt=new b.u9r;xt.setAttribute("position",new b.a$l(pt.vertices,3)),pt.normals.length>0&&xt.setAttribute("normal",new b.a$l(pt.normals,3)),pt.colors.length>0&&(wt=!0,xt.setAttribute("color",new b.a$l(pt.colors,3))),pt.hasUVIndices===!0&&xt.setAttribute("uv",new b.a$l(pt.uvs,2));const _t=[];for(let Bt=0,Ot=gt.length;Bt<Ot;Bt++){const Lt=gt[Bt],qt=Lt.name+"_"+Lt.smooth+"_"+wt;let en=i.materials[qt];if(this.materials!==null)if(en=await this.materials.create(Lt.name),!vt||!en||en instanceof b.nls){if(Ct&&en&&!(en instanceof b.UY4)){const cn=new b.UY4({size:10,sizeAttenuation:!1});b.F5T.prototype.copy.call(cn,en),cn.color.copy(en.color),cn.map=en.map,en=cn}}else{const cn=new b.nls;b.F5T.prototype.copy.call(cn,en),cn.color.copy(en.color),en=cn}en===void 0&&(en=vt?new b.nls:Ct?new b.UY4({size:1,sizeAttenuation:!1}):new b.xoR,en.name=Lt.name,en.flatShading=!Lt.smooth,en.vertexColors=wt,i.materials[qt]=en),_t.push(en)}let Pt;if(_t.length>1){for(let Bt=0,Ot=gt.length;Bt<Ot;Bt++){const Lt=gt[Bt];xt.addGroup(Lt.groupStart,Lt.groupCount,Bt)}Pt=vt?new b.ejS(xt,_t):Ct?new b.woe(xt,_t):new b.Kj0(xt,_t)}else Pt=vt?new b.ejS(xt,_t[0]):Ct?new b.woe(xt,_t[0]):new b.Kj0(xt,_t[0]);Pt.name=ut.name,nt.add(Pt)}else if(i.vertices.length>0){const it=new b.UY4({size:1,sizeAttenuation:!1}),lt=new b.u9r;lt.setAttribute("position",new b.a$l(i.vertices,3)),i.colors.length>0&&i.colors[0]!==void 0&&(lt.setAttribute("color",new b.a$l(i.colors,3)),it.vertexColors=!0);const ut=new b.woe(lt,it);nt.add(ut)}return nt}}class Mm extends ot{constructor(){super(...arguments),this.dependencies=[qr],this._importer1=new Wo(ZE,["obj"],!0),this._importer2=new Wo(hI,["mtl"],!1)}async onAdded(e){io.Importers.push(this._importer1),io.Importers.push(this._importer2)}async onDispose(e){}async onRemove(e){io.Importers.splice(io.Importers.indexOf(this._importer1),1),io.Importers.splice(io.Importers.indexOf(this._importer2),1)}}Mm.PluginType="ObjMtlLoadPlugin";class uv extends b.DqL{constructor(e){super(e)}parse(e,i){const s=new pI(e,1);return{mipmaps:s.mipmaps(i),width:s.pixelWidth,height:s.pixelHeight,format:s.glInternalFormat,isCubemap:s.numberOfFaces===6,mipmapCount:s.numberOfMipmapLevels}}}class pI{constructor(e,i){this.arrayBuffer=e;const s=new Uint8Array(this.arrayBuffer,0,12);if(s[0]!==171||s[1]!==75||s[2]!==84||s[3]!==88||s[4]!==32||s[5]!==49||s[6]!==49||s[7]!==187||s[8]!==13||s[9]!==10||s[10]!==26||s[11]!==10)return void console.error("texture missing KTX identifier");const a=Uint32Array.BYTES_PER_ELEMENT,h=new DataView(this.arrayBuffer,12,13*a),d=h.getUint32(0,!0)===67305985;this.glType=h.getUint32(1*a,d),this.glTypeSize=h.getUint32(2*a,d),this.glFormat=h.getUint32(3*a,d),this.glInternalFormat=h.getUint32(4*a,d),this.glBaseInternalFormat=h.getUint32(5*a,d),this.pixelWidth=h.getUint32(6*a,d),this.pixelHeight=h.getUint32(7*a,d),this.pixelDepth=h.getUint32(8*a,d),this.numberOfArrayElements=h.getUint32(9*a,d),this.numberOfFaces=h.getUint32(10*a,d),this.numberOfMipmapLevels=h.getUint32(11*a,d),this.bytesOfKeyValueData=h.getUint32(12*a,d),this.glType===0?(this.numberOfMipmapLevels=Math.max(1,this.numberOfMipmapLevels),this.pixelHeight!==0&&this.pixelDepth===0?this.numberOfArrayElements===0?this.numberOfFaces===i?this.loadType=0:console.warn("number of faces expected"+i+", but found "+this.numberOfFaces):console.warn("texture arrays not currently supported"):console.warn("only 2D textures currently supported")):console.warn("only compressed formats currently supported")}mipmaps(e){const i=[];let s=64+this.bytesOfKeyValueData,a=this.pixelWidth,h=this.pixelHeight;const d=e?this.numberOfMipmapLevels:1;for(let _=0;_<d;_++){const et=new Int32Array(this.arrayBuffer,s,1)[0];s+=4;for(let nt=0;nt<this.numberOfFaces;nt++){const it=new Uint8Array(this.arrayBuffer,s,et);i.push({data:it,width:a,height:h}),s+=et,s+=3-(et+3)%4}a=Math.max(1,.5*a),h=Math.max(1,.5*h)}return i}}class Nu extends ot{constructor(){super(...arguments),this.dependencies=[qr]}async onAdded(e){this._importer||(this._importer=new Wo(uv,["ktx"],!1)),io.Importers.push(this._importer)}async onDispose(e){this._importer=void 0}async onRemove(e){this._importer&&io.Importers.splice(io.Importers.indexOf(this._importer),1),this._importer=void 0}}Nu.PluginType="KTXLoadPlugin";class Yx extends b.hH6{constructor(e){super(e),this.responseType="blob"}}class fI extends b.hH6{constructor(e){super(e),this.responseType="blob"}load(e,i,s,a){return super.load(e,h=>{try{i==null||i(xp(h))}catch(d){a==null||a(d)}},s,a)}}class $C{async parseAsync(e,i){var s;return new Blob([JSON.stringify(e,null,(s=i.jsonSpaces)!==null&&s!==void 0?s:2)],{type:"application/json"})}}class DR{async parseAsync(e,i){return new Blob([e],{type:"text/plain"})}}class mI{constructor(){this.pluginCallbacks=[],this.register(function(e){return new pL(e)}),this.register(function(e){return new fL(e)}),this.register(function(e){return new mL(e)}),this.register(function(e){return new _L(e)}),this.register(function(e){return new AL(e)}),this.register(function(e){return new gL(e)}),this.register(function(e){return new yL(e)}),this.register(function(e){return new vL(e)}),this.register(function(e){return new wL(e)})}register(e){return this.pluginCallbacks.indexOf(e)===-1&&this.pluginCallbacks.push(e),this}unregister(e){return this.pluginCallbacks.indexOf(e)!==-1&&this.pluginCallbacks.splice(this.pluginCallbacks.indexOf(e),1),this}parse(e,i,s,a,h){const d=h||new kR,_=[];for(let et=0,nt=this.pluginCallbacks.length;et<nt;et++)_.push(this.pluginCallbacks[et](d));d.setPlugins(_),d.write(e,i,a).catch(s)}parseAsync(e,i){const s=this;return new Promise(function(a,h){s.parse(e,a,h,i)})}}const LD=5121,ND=5123,hv={};hv[b.TyD]=9728,hv[b.YLQ]=9984,hv[b.aH4]=9986,hv[b.wem]=9729,hv[b.qyh]=9985,hv[b.D1R]=9987,hv[b.uWy]=33071,hv[b.rpg]=10497,hv[b.OoA]=33648;const PR={scale:"scale",position:"translation",quaternion:"rotation",morphTargetInfluences:"weights"};function eM(c,e){return c.length===e.length&&c.every(function(i,s){return i===e[s]})}function RR(c){return 4*Math.ceil(c/4)}function UD(c,e=0){const i=RR(c.byteLength);if(i!==c.byteLength){const s=new Uint8Array(i);if(s.set(new Uint8Array(c)),e!==0)for(let a=c.byteLength;a<i;a++)s[a]=e;return s.buffer}return c}function BR(c,e){if(c.toBlob!==void 0)return new Promise(s=>c.toBlob(s,e));let i;return e==="image/jpeg"?i=.92:e==="image/webp"&&(i=.8),c.convertToBlob({type:e,quality:i})}class kR{constructor(){this.plugins=[],this.options={},this.pending=[],this.buffers=[],this.byteOffset=0,this.buffers=[],this.nodeMap=new Map,this.skins=[],this.extensionsUsed={},this.uids=new Map,this.uid=0,this.json={asset:{version:"2.0",generator:"THREE.GLTFExporter"}},this.cache={meshes:new Map,attributes:new Map,attributesNormalized:new Map,materials:new Map,textures:new Map,images:new Map}}setPlugins(e){this.plugins=e}async write(e,i,s){this.options=Object.assign({},{binary:!1,trs:!1,onlyVisible:!0,truncateDrawRange:!0,maxTextureSize:1/0,animations:[],includeCustomExtensions:!1},s),this.options.animations.length>0&&(this.options.trs=!0),this.processInput(e),await Promise.all(this.pending);const a=this,h=a.buffers,d=a.json;s=a.options;const _=a.extensionsUsed,et=new Blob(h,{type:"application/octet-stream"}),nt=Object.keys(_);if(nt.length>0&&(d.extensionsUsed=nt),d.buffers&&d.buffers.length>0&&(d.buffers[0].byteLength=et.size),s.binary===!0){const it=new FileReader;it.readAsArrayBuffer(et),it.onloadend=function(){const lt=UD(it.result),ut=new DataView(new ArrayBuffer(8));ut.setUint32(0,lt.byteLength,!0),ut.setUint32(4,5130562,!0);const pt=UD((gt=JSON.stringify(d),new TextEncoder().encode(gt).buffer),32);var gt;const vt=new DataView(new ArrayBuffer(8));vt.setUint32(0,pt.byteLength,!0),vt.setUint32(4,1313821514,!0);const Ct=new ArrayBuffer(12),wt=new DataView(Ct);wt.setUint32(0,1179937895,!0),wt.setUint32(4,2,!0);const xt=12+vt.byteLength+pt.byteLength+ut.byteLength+lt.byteLength;wt.setUint32(8,xt,!0);const _t=new Blob([Ct,vt,pt,ut,lt],{type:"application/octet-stream"}),Pt=new FileReader;Pt.readAsArrayBuffer(_t),Pt.onloadend=function(){i(Pt.result)}}}else if(d.buffers&&d.buffers.length>0){const it=new FileReader;it.readAsDataURL(et),it.onloadend=function(){const lt=it.result;d.buffers[0].uri=lt,i(d)}}else i(d)}serializeUserData(e,i){if(Object.keys(e.userData).length===0)return;const s=this.options,a=this.extensionsUsed;try{const h=JSON.parse(JSON.stringify(e.userData));if(s.includeCustomExtensions&&h.gltfExtensions){i.extensions===void 0&&(i.extensions={});for(const d in h.gltfExtensions)i.extensions[d]=h.gltfExtensions[d],a[d]=!0;delete h.gltfExtensions}Object.keys(h).length>0&&(i.extras=h)}catch(h){console.warn("THREE.GLTFExporter: userData of '"+e.name+"' won't be serialized because of JSON.stringify error - "+h.message),console.warn({...e.userData})}}getUID(e,i=!1){if(this.uids.has(e)===!1){const s=new Map;s.set(!0,this.uid++),s.set(!1,this.uid++),this.uids.set(e,s)}return this.uids.get(e).get(i)}isNormalizedNormalAttribute(e){if(this.cache.attributesNormalized.has(e))return!1;const i=new b.Pa4;for(let s=0,a=e.count;s<a;s++)if(Math.abs(i.fromBufferAttribute(e,s).length()-1)>5e-4)return!1;return!0}createNormalizedNormalAttribute(e){const i=this.cache;if(i.attributesNormalized.has(e))return i.attributesNormalized.get(e);const s=e.clone(),a=new b.Pa4;for(let h=0,d=s.count;h<d;h++)a.fromBufferAttribute(s,h),a.x===0&&a.y===0&&a.z===0?a.setX(1):a.normalize(),s.setXYZ(h,a.x,a.y,a.z);return i.attributesNormalized.set(e,s),s}applyTextureTransform(e,i){let s=!1;const a={};i.offset.x===0&&i.offset.y===0||(a.offset=i.offset.toArray(),s=!0),i.rotation!==0&&(a.rotation=i.rotation,s=!0),i.repeat.x===1&&i.repeat.y===1||(a.scale=i.repeat.toArray(),s=!0),s&&(e.extensions=e.extensions||{},e.extensions.KHR_texture_transform=a,this.extensionsUsed.KHR_texture_transform=!0)}buildMetalRoughTexture(e,i){if(e===i)return e;function s(ut){return ut.encoding===b.knz?function(pt){return pt<.04045?.0773993808*pt:Math.pow(.9478672986*pt+.0521327014,2.4)}:function(pt){return pt}}console.warn("THREE.GLTFExporter: Merged metalnessMap and roughnessMap textures.");const a=e?e.image:void 0,h=i?i.image:void 0,d=Math.max(a?a.width:0,h?h.width:0),_=Math.max(a?a.height:0,h?h.height:0),et=document.createElement("canvas");et.width=d,et.height=_;const nt=et.getContext("2d");nt.fillStyle="#00ffff",nt.fillRect(0,0,d,_);const it=nt.getImageData(0,0,d,_);if(a){nt.drawImage(a,0,0,d,_);const ut=s(e),pt=nt.getImageData(0,0,d,_).data;for(let gt=2;gt<pt.length;gt+=4)it.data[gt]=256*ut(pt[gt]/256)}if(h){nt.drawImage(h,0,0,d,_);const ut=s(i),pt=nt.getImageData(0,0,d,_).data;for(let gt=1;gt<pt.length;gt+=4)it.data[gt]=256*ut(pt[gt]/256)}nt.putImageData(it,0,0);const lt=(e||i).clone();return lt.source=new b.Hw6(et),lt.encoding=b.rnI,lt}processBuffer(e){const i=this.json,s=this.buffers;return i.buffers||(i.buffers=[{byteLength:0}]),s.push(e),0}processBufferView(e,i,s,a,h){const d=this.json;let _;d.bufferViews||(d.bufferViews=[]),_=i===LD?1:i===ND?2:4;const et=RR(a*e.itemSize*_),nt=new DataView(new ArrayBuffer(et));let it=0;for(let ut=s;ut<s+a;ut++)for(let pt=0;pt<e.itemSize;pt++){let gt;e.itemSize>4?gt=e.array[ut*e.itemSize+pt]:pt===0?gt=e.getX(ut):pt===1?gt=e.getY(ut):pt===2?gt=e.getZ(ut):pt===3&&(gt=e.getW(ut)),i===5126?nt.setFloat32(it,gt,!0):i===5125?nt.setUint32(it,gt,!0):i===ND?nt.setUint16(it,gt,!0):i===LD&&nt.setUint8(it,gt),it+=_}const lt={buffer:this.processBuffer(nt.buffer),byteOffset:this.byteOffset,byteLength:et};return h!==void 0&&(lt.target=h),h===34962&&(lt.byteStride=e.itemSize*_),this.byteOffset+=et,d.bufferViews.push(lt),{id:d.bufferViews.length-1,byteLength:0}}processBufferViewImage(e){const i=this,s=i.json;return s.bufferViews||(s.bufferViews=[]),new Promise(function(a){const h=new FileReader;h.readAsArrayBuffer(e),h.onloadend=function(){const d=UD(h.result),_={buffer:i.processBuffer(d),byteOffset:i.byteOffset,byteLength:d.byteLength};i.byteOffset+=d.byteLength,a(s.bufferViews.push(_)-1)}})}processAccessor(e,i,s,a){const h=this.options,d=this.json;let _;if(e.array.constructor===Float32Array)_=5126;else if(e.array.constructor===Uint32Array)_=5125;else if(e.array.constructor===Uint16Array)_=ND;else{if(e.array.constructor!==Uint8Array)throw new Error("THREE.GLTFExporter: Unsupported bufferAttribute component type.");_=LD}if(s===void 0&&(s=0),a===void 0&&(a=e.count),h.truncateDrawRange&&i!==void 0&&i.index===null){const ut=s+a,pt=i.drawRange.count===1/0?e.count:i.drawRange.start+i.drawRange.count;s=Math.max(s,i.drawRange.start),a=Math.min(ut,pt)-s,a<0&&(a=0)}if(a===0)return null;const et=function(ut,pt,gt){const vt={min:new Array(ut.itemSize).fill(Number.POSITIVE_INFINITY),max:new Array(ut.itemSize).fill(Number.NEGATIVE_INFINITY)};for(let Ct=pt;Ct<pt+gt;Ct++)for(let wt=0;wt<ut.itemSize;wt++){let xt;ut.itemSize>4?xt=ut.array[Ct*ut.itemSize+wt]:wt===0?xt=ut.getX(Ct):wt===1?xt=ut.getY(Ct):wt===2?xt=ut.getZ(Ct):wt===3&&(xt=ut.getW(Ct)),vt.min[wt]=Math.min(vt.min[wt],xt),vt.max[wt]=Math.max(vt.max[wt],xt)}return vt}(e,s,a);let nt;i!==void 0&&(nt=e===i.index?34963:34962);const it=this.processBufferView(e,_,s,a,nt),lt={bufferView:it.id,byteOffset:it.byteOffset,componentType:_,count:a,max:et.max,min:et.min,type:{1:"SCALAR",2:"VEC2",3:"VEC3",4:"VEC4",16:"MAT4"}[e.itemSize]};return d.accessors||(d.accessors=[]),d.accessors.push(lt)-1}processImage(e,i,s,a="image/png"){const h=this,d=h.cache,_=h.json,et=h.options,nt=h.pending;d.images.has(e)||d.images.set(e,{});const it=d.images.get(e),lt=a+":flipY/"+s.toString();if(it[lt]!==void 0)return it[lt];_.images||(_.images=[]);const ut={mimeType:a},pt=typeof document>"u"&&typeof OffscreenCanvas<"u"?new OffscreenCanvas(1,1):document.createElement("canvas");pt.width=Math.min(e.width,et.maxTextureSize),pt.height=Math.min(e.height,et.maxTextureSize);const gt=pt.getContext("2d");if(s===!0&&(gt.translate(0,pt.height),gt.scale(1,-1)),e.data!==void 0){i!==b.wk1&&console.error("GLTFExporter: Only RGBAFormat is supported."),(e.width>et.maxTextureSize||e.height>et.maxTextureSize)&&console.warn("GLTFExporter: Image size is bigger than maxTextureSize",e);const Ct=new Uint8ClampedArray(e.height*e.width*4);for(let wt=0;wt<Ct.length;wt+=4)Ct[wt+0]=e.data[wt+0],Ct[wt+1]=e.data[wt+1],Ct[wt+2]=e.data[wt+2],Ct[wt+3]=e.data[wt+3];gt.putImageData(new ImageData(Ct,e.width,e.height),0,0)}else gt.drawImage(e,0,0,pt.width,pt.height);et.binary===!0?nt.push(BR(pt,a).then(Ct=>h.processBufferViewImage(Ct)).then(Ct=>{ut.bufferView=Ct})):pt.toDataURL!==void 0?ut.uri=pt.toDataURL(a):nt.push(BR(pt,a).then(Ct=>new FileReader().readAsDataURL(Ct)).then(Ct=>{ut.uri=Ct}));const vt=_.images.push(ut)-1;return it[lt]=vt,vt}processSampler(e){const i=this.json;i.samplers||(i.samplers=[]);const s={magFilter:hv[e.magFilter],minFilter:hv[e.minFilter],wrapS:hv[e.wrapS],wrapT:hv[e.wrapT]};return i.samplers.push(s)-1}processTexture(e){const i=this.cache,s=this.json;if(i.textures.has(e))return i.textures.get(e);s.textures||(s.textures=[]);let a=e.userData.mimeType;a==="image/webp"&&(a="image/png"),a==="image/jpg"&&(a="image/jpeg");const h=["image/jpeg","image/png"];a&&!h.includes(a)&&console.error("GLTFExporter: Unsupported mime type: "+a+". Cannot export texture.",e);const d={sampler:this.processSampler(e),source:!a||h.includes(a)?this.processImage(e.image,e.format,e.flipY,a):null};e.name&&(d.name=e.name),this._invokeAll(function(et){et.writeTexture&&et.writeTexture(e,d)});const _=s.textures.push(d)-1;return i.textures.set(e,_),_}processMaterial(e){const i=this.cache,s=this.json;if(i.materials.has(e))return i.materials.get(e);if(e.isShaderMaterial)return console.warn("GLTFExporter: THREE.ShaderMaterial not supported."),null;s.materials||(s.materials=[]);const a={pbrMetallicRoughness:{}};e.isMeshStandardMaterial!==!0&&e.isMeshBasicMaterial!==!0&&console.warn("GLTFExporter: Use MeshStandardMaterial or MeshBasicMaterial for best results.");const h=e.color.toArray().concat([e.opacity]);if(eM(h,[1,1,1,1])||(a.pbrMetallicRoughness.baseColorFactor=h),e.isMeshStandardMaterial?(a.pbrMetallicRoughness.metallicFactor=e.metalness,a.pbrMetallicRoughness.roughnessFactor=e.roughness):(a.pbrMetallicRoughness.metallicFactor=.5,a.pbrMetallicRoughness.roughnessFactor=.5),e.metalnessMap||e.roughnessMap){const _=this.buildMetalRoughTexture(e.metalnessMap,e.roughnessMap),et={index:this.processTexture(_)};this.applyTextureTransform(et,_),a.pbrMetallicRoughness.metallicRoughnessTexture=et}if(e.map){const _={index:this.processTexture(e.map)};this.applyTextureTransform(_,e.map),a.pbrMetallicRoughness.baseColorTexture=_}if(e.emissive){const _=e.emissive.clone().multiplyScalar(e.emissiveIntensity),et=Math.max(_.r,_.g,_.b);if(et>1&&(_.multiplyScalar(1/et),console.warn("THREE.GLTFExporter: Some emissive components exceed 1; emissive has been limited")),et>0&&(a.emissiveFactor=_.toArray()),e.emissiveMap){const nt={index:this.processTexture(e.emissiveMap)};this.applyTextureTransform(nt,e.emissiveMap),a.emissiveTexture=nt}}if(e.normalMap){const _={index:this.processTexture(e.normalMap)};e.normalScale&&e.normalScale.x!==1&&(_.scale=e.normalScale.x),this.applyTextureTransform(_,e.normalMap),a.normalTexture=_}if(e.aoMap){const _={index:this.processTexture(e.aoMap),texCoord:1};e.aoMapIntensity!==1&&(_.strength=e.aoMapIntensity),this.applyTextureTransform(_,e.aoMap),a.occlusionTexture=_}e.transparent?a.alphaMode="BLEND":e.alphaTest>0&&(a.alphaMode="MASK",a.alphaCutoff=e.alphaTest),e.side===b.ehD&&(a.doubleSided=!0),e.name!==""&&(a.name=e.name),this.serializeUserData(e,a),this._invokeAll(function(_){_.writeMaterial&&_.writeMaterial(e,a)});const d=s.materials.push(a)-1;return i.materials.set(e,d),d}processMesh(e){const i=this.cache,s=this.json,a=[e.geometry.uuid];if(Array.isArray(e.material))for(let _t=0,Pt=e.material.length;_t<Pt;_t++)a.push(e.material[_t].uuid);else a.push(e.material.uuid);const h=a.join(":");if(i.meshes.has(h))return i.meshes.get(h);const d=e.geometry;let _;_=e.isLineSegments?1:e.isLineLoop?2:e.isLine?3:e.isPoints?0:e.material.wireframe?1:4;const et={},nt={},it=[],lt=[],ut={uv:"TEXCOORD_0",uv2:"TEXCOORD_1",color:"COLOR_0",skinWeight:"WEIGHTS_0",skinIndex:"JOINTS_0"},pt=d.getAttribute("normal");pt===void 0||this.isNormalizedNormalAttribute(pt)||(console.warn("THREE.GLTFExporter: Creating normalized normal attribute from the non-normalized one."),d.setAttribute("normal",this.createNormalizedNormalAttribute(pt)));let gt=null;for(let _t in d.attributes){if(_t.slice(0,5)==="morph")continue;const Pt=d.attributes[_t];if(_t=ut[_t]||_t.toUpperCase(),/^(POSITION|NORMAL|TANGENT|TEXCOORD_\d+|COLOR_\d+|JOINTS_\d+|WEIGHTS_\d+)$/.test(_t)||(_t="_"+_t),i.attributes.has(this.getUID(Pt))){nt[_t]=i.attributes.get(this.getUID(Pt));continue}gt=null;const Bt=Pt.array;_t!=="JOINTS_0"||Bt instanceof Uint16Array||Bt instanceof Uint8Array||(console.warn('GLTFExporter: Attribute "skinIndex" converted to type UNSIGNED_SHORT.'),gt=new b.TlE(new Uint16Array(Bt),Pt.itemSize,Pt.normalized));const Ot=this.processAccessor(gt||Pt,d);Ot!==null&&(nt[_t]=Ot,i.attributes.set(this.getUID(Pt),Ot))}if(pt!==void 0&&d.setAttribute("normal",pt),Object.keys(nt).length===0)return null;if(e.morphTargetInfluences!==void 0&&e.morphTargetInfluences.length>0){const _t=[],Pt=[],Bt={};if(e.morphTargetDictionary!==void 0)for(const Ot in e.morphTargetDictionary)Bt[e.morphTargetDictionary[Ot]]=Ot;for(let Ot=0;Ot<e.morphTargetInfluences.length;++Ot){const Lt={};let qt=!1;for(const en in d.morphAttributes){if(en!=="position"&&en!=="normal"){qt||(console.warn("GLTFExporter: Only POSITION and NORMAL morph are supported."),qt=!0);continue}const cn=d.morphAttributes[en][Ot],An=en.toUpperCase(),mn=d.attributes[en];if(i.attributes.has(this.getUID(cn,!0))){Lt[An]=i.attributes.get(this.getUID(cn,!0));continue}const Tn=cn.clone();if(!d.morphTargetsRelative)for(let vn=0,xn=cn.count;vn<xn;vn++)Tn.setXYZ(vn,cn.getX(vn)-mn.getX(vn),cn.getY(vn)-mn.getY(vn),cn.getZ(vn)-mn.getZ(vn));Lt[An]=this.processAccessor(Tn,d),i.attributes.set(this.getUID(mn,!0),Lt[An])}lt.push(Lt),_t.push(e.morphTargetInfluences[Ot]),e.morphTargetDictionary!==void 0&&Pt.push(Bt[Ot])}et.weights=_t,Pt.length>0&&(et.extras={},et.extras.targetNames=Pt)}const vt=Array.isArray(e.material);if(vt&&d.groups.length===0)return null;const Ct=vt?e.material:[e.material],wt=vt?d.groups:[{materialIndex:0,start:void 0,count:void 0}];for(let _t=0,Pt=wt.length;_t<Pt;_t++){const Bt={mode:_,attributes:nt};if(this.serializeUserData(d,Bt),lt.length>0&&(Bt.targets=lt),d.index!==null){let Lt=this.getUID(d.index);wt[_t].start===void 0&&wt[_t].count===void 0||(Lt+=":"+wt[_t].start+":"+wt[_t].count),i.attributes.has(Lt)?Bt.indices=i.attributes.get(Lt):(Bt.indices=this.processAccessor(d.index,d,wt[_t].start,wt[_t].count),i.attributes.set(Lt,Bt.indices)),Bt.indices===null&&delete Bt.indices}const Ot=this.processMaterial(Ct[wt[_t].materialIndex]);Ot!==null&&(Bt.material=Ot),it.push(Bt)}et.primitives=it,s.meshes||(s.meshes=[]),this._invokeAll(function(_t){_t.writeMesh&&_t.writeMesh(e,et)});const xt=s.meshes.push(et)-1;return i.meshes.set(h,xt),xt}processCamera(e){const i=this.json;i.cameras||(i.cameras=[]);const s=e.isOrthographicCamera,a={type:s?"orthographic":"perspective"};return s?a.orthographic={xmag:2*e.right,ymag:2*e.top,zfar:e.far<=0?.001:e.far,znear:e.near<0?0:e.near}:a.perspective={aspectRatio:e.aspect,yfov:b.M8C.degToRad(e.fov),zfar:e.far<=0?.001:e.far,znear:e.near<0?0:e.near},e.name!==""&&(a.name=e.type),i.cameras.push(a)-1}processAnimation(e,i){const s=this.json,a=this.nodeMap;s.animations||(s.animations=[]);const h=(e=mI.Utils.mergeMorphTargetTracks(e.clone(),i)).tracks,d=[],_=[];for(let et=0;et<h.length;++et){const nt=h[et],it=b.iUV.parseTrackName(nt.name);let lt=b.iUV.findNode(i,it.nodeName);const ut=PR[it.propertyName];if(it.objectName==="bones"&&(lt=lt.isSkinnedMesh===!0?lt.skeleton.getBoneByName(it.objectIndex):void 0),!lt||!ut)return console.warn('THREE.GLTFExporter: Could not export animation track "%s".',nt.name),null;const pt=1;let gt,vt=nt.values.length/nt.times.length;ut===PR.morphTargetInfluences&&(vt/=lt.morphTargetInfluences.length),nt.createInterpolant.isInterpolantFactoryMethodGLTFCubicSpline===!0?(gt="CUBICSPLINE",vt/=3):gt=nt.getInterpolation()===b.Syv?"STEP":"LINEAR",_.push({input:this.processAccessor(new b.TlE(nt.times,pt)),output:this.processAccessor(new b.TlE(nt.values,vt)),interpolation:gt}),d.push({sampler:_.length-1,target:{node:a.get(lt),path:ut}})}return s.animations.push({name:e.name||"clip_"+s.animations.length,samplers:_,channels:d}),s.animations.length-1}processSkin(e){const i=this.json,s=this.nodeMap,a=i.nodes[s.get(e)],h=e.skeleton;if(h===void 0)return null;const d=e.skeleton.bones[0];if(d===void 0)return null;const _=[],et=new Float32Array(16*h.bones.length),nt=new b.yGw;for(let it=0;it<h.bones.length;++it)_.push(s.get(h.bones[it])),nt.copy(h.boneInverses[it]),nt.multiply(e.bindMatrix).toArray(et,16*it);return i.skins===void 0&&(i.skins=[]),i.skins.push({inverseBindMatrices:this.processAccessor(new b.TlE(et,16)),joints:_,skeleton:s.get(d)}),a.skin=i.skins.length-1}processNode(e){const i=this.json,s=this.options,a=this.nodeMap;i.nodes||(i.nodes=[]);const h={};if(s.trs){const _=e.quaternion.toArray(),et=e.position.toArray(),nt=e.scale.toArray();eM(_,[0,0,0,1])||(h.rotation=_),eM(et,[0,0,0])||(h.translation=et),eM(nt,[1,1,1])||(h.scale=nt)}else e.matrixAutoUpdate&&e.updateMatrix(),eM(e.matrix.elements,[1,0,0,0,0,1,0,0,0,0,1,0,0,0,0,1])===!1&&(h.matrix=e.matrix.elements);if(e.name!==""&&(h.name=String(e.name)),this.serializeUserData(e,h),e.isMesh||e.isLine||e.isPoints){const _=this.processMesh(e);_!==null&&(h.mesh=_)}else e.isCamera&&(h.camera=this.processCamera(e));if(e.isSkinnedMesh&&this.skins.push(e),e.children.length>0){const _=[];for(let et=0,nt=e.children.length;et<nt;et++){const it=e.children[et];if(it.visible||s.onlyVisible===!1){const lt=this.processNode(it);lt!==null&&_.push(lt)}}_.length>0&&(h.children=_)}this._invokeAll(function(_){_.writeNode&&_.writeNode(e,h)});const d=i.nodes.push(h)-1;return a.set(e,d),d}processScene(e){const i=this.json,s=this.options;i.scenes||(i.scenes=[],i.scene=0);const a={};e.name!==""&&(a.name=e.name),i.scenes.push(a);const h=[];for(let d=0,_=e.children.length;d<_;d++){const et=e.children[d];if(et.visible||s.onlyVisible===!1){const nt=this.processNode(et);nt!==null&&h.push(nt)}}h.length>0&&(a.nodes=h),this.serializeUserData(e,a)}processObjects(e){const i=new b.xsS;i.name="AuxScene";for(let s=0;s<e.length;s++)i.children.push(e[s]);this.processScene(i)}processInput(e){const i=this.options;e=e instanceof Array?e:[e],this._invokeAll(function(a){a.beforeParse&&a.beforeParse(e)});const s=[];for(let a=0;a<e.length;a++)e[a]instanceof b.xsS?this.processScene(e[a]):s.push(e[a]);s.length>0&&this.processObjects(s);for(let a=0;a<this.skins.length;++a)this.processSkin(this.skins[a]);for(let a=0;a<i.animations.length;++a)this.processAnimation(i.animations[a],e[0]);this._invokeAll(function(a){a.afterParse&&a.afterParse(e)})}_invokeAll(e){for(let i=0,s=this.plugins.length;i<s;i++)e(this.plugins[i])}}class pL{constructor(e){this.writer=e,this.name="KHR_lights_punctual"}writeNode(e,i){if(!e.isLight)return;if(!e.isDirectionalLight&&!e.isPointLight&&!e.isSpotLight)return void console.warn("THREE.GLTFExporter: Only directional, point, and spot lights are supported.",e);const s=this.writer,a=s.json,h=s.extensionsUsed,d={};e.name&&(d.name=e.name),d.color=e.color.toArray(),d.intensity=e.intensity,e.isDirectionalLight?d.type="directional":e.isPointLight?(d.type="point",e.distance>0&&(d.range=e.distance)):e.isSpotLight&&(d.type="spot",e.distance>0&&(d.range=e.distance),d.spot={},d.spot.innerConeAngle=(e.penumbra-1)*e.angle*-1,d.spot.outerConeAngle=e.angle),e.decay!==void 0&&e.decay!==2&&console.warn("THREE.GLTFExporter: Light decay may be lost. glTF is physically-based, and expects light.decay=2."),!e.target||e.target.parent===e&&e.target.position.x===0&&e.target.position.y===0&&e.target.position.z===-1||console.warn("THREE.GLTFExporter: Light direction may be lost. For best results, make light.target a child of the light with position 0,0,-1."),h[this.name]||(a.extensions=a.extensions||{},a.extensions[this.name]={lights:[]},h[this.name]=!0);const _=a.extensions[this.name].lights;_.push(d),i.extensions=i.extensions||{},i.extensions[this.name]={light:_.length-1}}}class fL{constructor(e){this.writer=e,this.name="KHR_materials_unlit"}writeMaterial(e,i){if(!e.isMeshBasicMaterial)return;const s=this.writer.extensionsUsed;i.extensions=i.extensions||{},i.extensions[this.name]={},s[this.name]=!0,i.pbrMetallicRoughness.metallicFactor=0,i.pbrMetallicRoughness.roughnessFactor=.9}}class mL{constructor(e){this.writer=e,this.name="KHR_materials_pbrSpecularGlossiness"}writeMaterial(e,i){if(!e.isGLTFSpecularGlossinessMaterial)return;const s=this.writer,a=s.extensionsUsed,h={};i.pbrMetallicRoughness.baseColorFactor&&(h.diffuseFactor=i.pbrMetallicRoughness.baseColorFactor);const d=[1,1,1];if(e.specular.toArray(d,0),h.specularFactor=d,h.glossinessFactor=e.glossiness,i.pbrMetallicRoughness.baseColorTexture&&(h.diffuseTexture=i.pbrMetallicRoughness.baseColorTexture),e.specularMap){const _={index:s.processTexture(e.specularMap)};s.applyTextureTransform(_,e.specularMap),h.specularGlossinessTexture=_}i.extensions=i.extensions||{},i.extensions[this.name]=h,a[this.name]=!0}}class gL{constructor(e){this.writer=e,this.name="KHR_materials_clearcoat"}writeMaterial(e,i){if(!e.isMeshPhysicalMaterial)return;const s=this.writer,a=s.extensionsUsed,h={};if(h.clearcoatFactor=e.clearcoat,e.clearcoatMap){const d={index:s.processTexture(e.clearcoatMap)};s.applyTextureTransform(d,e.clearcoatMap),h.clearcoatTexture=d}if(h.clearcoatRoughnessFactor=e.clearcoatRoughness,e.clearcoatRoughnessMap){const d={index:s.processTexture(e.clearcoatRoughnessMap)};s.applyTextureTransform(d,e.clearcoatRoughnessMap),h.clearcoatRoughnessTexture=d}if(e.clearcoatNormalMap){const d={index:s.processTexture(e.clearcoatNormalMap)};s.applyTextureTransform(d,e.clearcoatNormalMap),h.clearcoatNormalTexture=d}i.extensions=i.extensions||{},i.extensions[this.name]=h,a[this.name]=!0}}class vL{constructor(e){this.writer=e,this.name="KHR_materials_iridescence"}writeMaterial(e,i){if(!e.isMeshPhysicalMaterial)return;const s=this.writer,a=s.extensionsUsed,h={};if(h.iridescenceFactor=e.iridescence,e.iridescenceMap){const d={index:s.processTexture(e.iridescenceMap)};s.applyTextureTransform(d,e.iridescenceMap),h.iridescenceTexture=d}if(h.iridescenceIor=e.iridescenceIOR,h.iridescenceThicknessMinimum=e.iridescenceThicknessRange[0],h.iridescenceThicknessMaximum=e.iridescenceThicknessRange[1],e.iridescenceThicknessMap){const d={index:s.processTexture(e.iridescenceThicknessMap)};s.applyTextureTransform(d,e.iridescenceThicknessMap),h.iridescenceThicknessTexture=d}i.extensions=i.extensions||{},i.extensions[this.name]=h,a[this.name]=!0}}class _L{constructor(e){this.writer=e,this.name="KHR_materials_transmission"}writeMaterial(e,i){if(!e.isMeshPhysicalMaterial||e.transmission===0)return;const s=this.writer,a=s.extensionsUsed,h={};if(h.transmissionFactor=e.transmission,e.transmissionMap){const d={index:s.processTexture(e.transmissionMap)};s.applyTextureTransform(d,e.transmissionMap),h.transmissionTexture=d}i.extensions=i.extensions||{},i.extensions[this.name]=h,a[this.name]=!0}}class AL{constructor(e){this.writer=e,this.name="KHR_materials_volume"}writeMaterial(e,i){if(!e.isMeshPhysicalMaterial||e.transmission===0)return;const s=this.writer,a=s.extensionsUsed,h={};if(h.thicknessFactor=e.thickness,e.thicknessMap){const d={index:s.processTexture(e.thicknessMap)};s.applyTextureTransform(d,e.thicknessMap),h.thicknessTexture=d}h.attenuationDistance=e.attenuationDistance,h.attenuationColor=e.attenuationColor.toArray(),i.extensions=i.extensions||{},i.extensions[this.name]=h,a[this.name]=!0}}class yL{constructor(e){this.writer=e,this.name="KHR_materials_sheen"}writeMaterial(e,i){if(!e.isMeshPhysicalMaterial||e.sheen<.01)return;const s=this.writer,a=s.extensionsUsed,h={};if(h.sheenColorFactor=e.sheenColor.toArray(),e.sheenColorMap){const d={index:s.processTexture(e.sheenColorMap)};s.applyTextureTransform(d,e.sheenColorMap),h.sheenColorTexture=d}if(h.sheenRoughnessFactor=e.sheenRoughness,e.sheenRoughnessMap){const d={index:s.processTexture(e.sheenRoughnessMap)};s.applyTextureTransform(d,e.sheenRoughnessMap),h.sheenRoughnessTexture=d}i.extensions=i.extensions||{},i.extensions[this.name]=h,i.extras=i.extras||{},i.extras.sheenFactor=e.sheen,a[this.name]=!0}}class wL{constructor(e){this.writer=e,this.name="KHR_materials_ior"}writeMaterial(e,i){if(!e.isMeshPhysicalMaterial)return;const s=this.writer.extensionsUsed,a={};a.ior=e.ior,i.extensions=i.extensions||{},i.extensions[this.name]=a,s[this.name]=!0}}mI.Utils={GLTFWriter:kR,insertKeyframe:function(c,e){const s=c.getValueSize(),a=new c.TimeBufferType(c.times.length+1),h=new c.ValueBufferType(c.values.length+s),d=c.createInterpolant(new c.ValueBufferType(s));let _;if(c.times.length===0){a[0]=e;for(let et=0;et<s;et++)h[et]=0;_=0}else if(e<c.times[0]){if(Math.abs(c.times[0]-e)<.001)return 0;a[0]=e,a.set(c.times,1),h.set(d.evaluate(e),0),h.set(c.values,s),_=0}else if(e>c.times[c.times.length-1]){if(Math.abs(c.times[c.times.length-1]-e)<.001)return c.times.length-1;a[a.length-1]=e,a.set(c.times,0),h.set(c.values,0),h.set(d.evaluate(e),c.values.length),_=a.length-1}else for(let et=0;et<c.times.length;et++){if(Math.abs(c.times[et]-e)<.001)return et;if(c.times[et]<e&&c.times[et+1]>e){a.set(c.times.slice(0,et+1),0),a[et+1]=e,a.set(c.times.slice(et+1),et+2),h.set(c.values.slice(0,(et+1)*s),0),h.set(d.evaluate(e),(et+1)*s),h.set(c.values.slice((et+1)*s),(et+2)*s),_=et+1;break}}return c.times=a,c.values=h,_},mergeMorphTargetTracks:function(c,e){const i=[],s={},a=c.tracks;for(let h=0;h<a.length;++h){let d=a[h];const _=b.iUV.parseTrackName(d.name),et=b.iUV.findNode(e,_.nodeName);if(_.propertyName!=="morphTargetInfluences"||_.propertyIndex===void 0){i.push(d);continue}if(d.createInterpolant!==d.InterpolantFactoryMethodDiscrete&&d.createInterpolant!==d.InterpolantFactoryMethodLinear){if(d.createInterpolant.isInterpolantFactoryMethodGLTFCubicSpline)throw new Error("THREE.GLTFExporter: Cannot merge tracks with glTF CUBICSPLINE interpolation.");console.warn("THREE.GLTFExporter: Morph target interpolation mode not yet supported. Using LINEAR instead."),d=d.clone(),d.setInterpolation(b.NMF)}const nt=et.morphTargetInfluences.length,it=et.morphTargetDictionary[_.propertyIndex];if(it===void 0)throw new Error("THREE.GLTFExporter: Morph target name not found: "+_.propertyIndex);let lt;if(s[et.uuid]===void 0){lt=d.clone();const pt=new lt.ValueBufferType(nt*lt.times.length);for(let gt=0;gt<lt.times.length;gt++)pt[gt*nt+it]=lt.values[gt];lt.name=(_.nodeName||"")+".morphTargetInfluences",lt.values=pt,s[et.uuid]=lt,i.push(lt);continue}const ut=d.createInterpolant(new d.ValueBufferType(1));lt=s[et.uuid];for(let pt=0;pt<lt.times.length;pt++)lt.values[pt*nt+it]=ut.evaluate(lt.times[pt]);for(let pt=0;pt<d.times.length;pt++){const gt=this.insertKeyframe(lt,d.times[pt]);lt.values[gt*nt+it]=d.values[pt]}}return c.tracks=i,c}};class OR extends mI.Utils.GLTFWriter{constructor(){super(...arguments),this._defaultMaterial=new b.Wid}serializeUserData(e,i){const s=e.userData,a={};s.__disposed&&console.error("Serializing a disposed object",e),Object.entries(s).forEach(([h,d])=>{(!d||typeof d=="function"||d.isObject3D||d.isTexture||d.isMaterial||d.assetType!=null||h.startsWith("_")||h!=="uuid"&&(Av.includes(h)||iA.includes(h)||am.includes(h)))&&(a[h]=d,delete s[h])}),super.serializeUserData(e,i),Object.entries(a).forEach(([h,d])=>{s[h]=d,delete a[h]})}processObjects(e){var i;e.length===1&&(!((i=e[0])===null||i===void 0)&&i.userData.rootSceneModelRoot)?this.processScene(e[0]):super.processObjects(e)}processMaterial(e){if(this.cache.materials.has(e))return this.cache.materials.get(e);let i=e;i&&!i.isShaderMaterial||(i=this._defaultMaterial);const s=super.processMaterial(i);if(!e||i===e)return s;const a=JSON.stringify(this.json.materials[s]),h=JSON.parse(a);this.serializeUserData(e,h),this._invokeAll(_=>{_.writeMaterial&&_.writeMaterial(e,h)});const d=this.json.materials.push(h)-1;return this.cache.materials.set(e,d),d}processImageBlob(e,i){if(!e)return-1;const s=this.cache,a=this.options,h=this.pending,d=this.json,_=i.image;s.images.has(_)||s.images.set(_,{});const et=s.images.get(_),nt=e.type+":flipY/"+i.flipY.toString();if(et[nt]!==void 0)return et[nt];d.images||(d.images=[]);const it={mimeType:e.type};a.binary===!0?h.push(new Promise(ut=>{this.processBufferViewImage(e).then(pt=>{it.bufferView=pt,ut()})})):h.push(xp(e).then(ut=>{it.uri=ut}));const lt=d.images.push(it)-1;return et[nt]=lt,lt}processSampler(e){return super.processSampler(e)}processTexture(e){const i=this.cache,s=this.json;if(i.textures.has(e))return i.textures.get(e);const a=e.source.data,h=e.userData.mimeType;e.userData.rootPath&&!this.options.embedUrlImages&&(e.source.data=null,delete e.userData.mimeType);const d=super.processTexture(e),_=s.textures[d];if(!_)return console.error("No texture def",d,e),d;const et=s.images?s.images[_.source]:null;if(et&&(et.extras||(et.extras={}),e.source&&(et.extras.uuid=e.source.uuid),et.extras.t_uuid=e.uuid),e.userData.rootPath&&!this.options.embedUrlImages){if(e.source.data=a,e.userData.mimeType=h,!_)return console.error("textureDef is null",d,e),d;_.source>=0?console.warn("textureDef.source is already set",d,e):_.source=this.processImageUri(e.image,e.userData.rootPath,e.flipY,h)}return _.source<0&&console.error("textureDef.source cannot be saved",_,e),d}processImage(e,i,s,a="image/png"){return e?super.processImage(e,i,s,a):-1}processImageUri(e,i,s,a="image/png"){const h=this.cache,d=this.json;h.images.has(e)||h.images.set(e,{});const _=h.images.get(e),et=a+":flipY/"+s.toString();if(_[et]!==void 0)return _[et];d.images||(d.images=[]);const nt={mimeType:a,uri:i,extras:{flipY:s}},it=d.images.push(nt)-1;return _[et]=it,it}}class FD extends mI{register(e){return super.register(e)}async parseAsync(e,i){var s;if(!e)throw new Error("No object to export");const a=e.__isGLTFOutput||!Array.isArray(e)&&!e.isObject3D?e:await new Promise((h,d)=>this.parse(e,h,d,i));if(a&&typeof a=="object"&&!a.byteLength)return new Blob([JSON.stringify(a,(h,d)=>h.startsWith("__")?void 0:d,(s=i.jsonSpaces)!==null&&s!==void 0?s:2)],{type:"model/gltf+json"});if(a)return new Blob([a],{type:"model/gltf+binary"});throw new Error("GLTFExporter2.parse() failed")}parse(e,i,s,a={}){var h;const d={binary:!1,trs:!1,onlyVisible:!0,truncateDrawRange:!0,externalImagesInExtras:!a.embedUrlImages&&a.externalImagesInExtras||!1,embedUrlImages:(h=a.embedUrlImages)!==null&&h!==void 0&&h,maxTextureSize:1/0,animations:[],includeCustomExtensions:!0};return a.exportExt==="glb"&&(d.binary=!0),a.preserveUUIDs!==!1&&(Array.isArray(e)?e:[e]).forEach(_=>_.traverse(et=>{et.uuid&&(et.userData.gltfUUID=et.uuid)})),(Array.isArray(e)?e:[e]).forEach(_=>_.traverse(et=>{if(et.animations)for(const nt of et.animations)nt.__gltfExport===!1||d.animations.includes(nt)||d.animations.push(...et.animations)})),super.parse(e,_=>{a.preserveUUIDs!==!1&&(Array.isArray(e)?e:[e]).forEach(et=>et.traverse(nt=>{delete nt.userData.gltfUUID})),i(Object.assign(_,{__isGLTFOutput:!0}))},s,d,new OR)}}function LR(c,e){const i=c.getPlugin(qr).exportViewerConfig();e.json.textures&&e.json.samplers&&e.json.images&&i.resources.textures&&Object.entries(i.resources.textures).forEach(([a,h])=>{e.json.textures.find(_=>{var et,nt,it,lt,ut;return((et=_.extras)===null||et===void 0?void 0:et.uuid)===a||((it=(nt=e.json.samplers[_.sampler])===null||nt===void 0?void 0:nt.extras)===null||it===void 0?void 0:it.uuid)===a||((ut=(lt=e.json.images[_.source])===null||lt===void 0?void 0:lt.extras)===null||ut===void 0?void 0:ut.t_uuid)===a})&&(h.image&&i.resources.images&&i.resources.images[h.image]&&delete i.resources.images[h.image],i.resources.textures[a]={})}),e.json.materials&&i.resources.materials&&Object.entries(i.resources.materials).forEach(([a,h])=>{e.json.materials.find(_=>{var et;return((et=_.extras)===null||et===void 0?void 0:et.uuid)===a})&&(i.resources.materials[a]={})});const s=[];Object.values(i.resources).forEach(a=>{a&&Object.values(a).forEach(h=>{h.url&&(h.url.type==="Uint16Array"&&h.url.data&&(h.url.data instanceof Uint16Array||(h.url.data=new Uint16Array(h.url.data)),s.push(h.url)),h.url.type==="Uint8Array"&&h.url.data&&(h.url.data instanceof Uint8Array||(h.url.data=new Uint8Array(h.url.data)),s.push(h.url)))})});for(const a of s){let h="application/octet-stream";if(a.type==="Uint16Array"&&a.width>0&&a.height>0){const nt=xL(a.data,4),it=new ImageData(nt,a.width,a.height),lt=b.PpQ.getDataURL(it,!0).split(",")[1];h="image/png",a.data=atob(lt),a.encoding="rgbe"}const d=new Blob([a.data],{type:h});e.json.images||(e.json.images=[]);const _={mimeType:h},et=e.json.images.push(_)-1;a.data={image:et},e.pending.push(e.processBufferViewImage(d).then(nt=>{_.bufferView=nt}))}return i}function xL(c,e=3,i){let s,a,h,d,_;const et=c.byteLength/(2*e)|0;i=i||new Uint8ClampedArray(4*et);for(let nt=0;nt<et;nt++){s=c[nt*e],a=c[nt*e+1],h=c[nt*e+2],d=Math.max(Math.max(s,a),h);const it=Math.ceil(Math.log2(d));_=Math.pow(2,it-8),i[4*nt]=s/_|0,i[4*nt+1]=a/_|0,i[4*nt+2]=h/_|0,i[4*nt+3]=it+128}return i}function jD(c,e=FD,i){var s;if(!c)return;const a=k_.Exporters.findIndex(d=>d.ext.includes("gltf")||d.ext.includes("glb")),h=[];a>=0?(h.push(...(s=k_.Exporters[a].extensions)!==null&&s!==void 0?s:[]),k_.Exporters.splice(a,1)):(h.push(SL),h.push(EL),h.push(bL),h.push(d=>new CL(d)),h.push(d=>new ML(d)),h.push(d=>new TL(d)),h.push(d=>new IL(d))),k_.Exporters.push({ctor:()=>{const d=new e;return h.forEach(_=>d.register(_)),d.register(_=>({afterParse:et=>{var nt,it;if(!(!((nt=(et=Array.isArray(et)?et[0]:et)==null?void 0:et.userData)===null||nt===void 0)&&nt.rootSceneModelRoot)||((it=et==null?void 0:et.userData)===null||it===void 0?void 0:it.__exportViewerConfig)===!1)return;const lt=_.json.scenes[_.json.scene||0];lt.extensions||(lt.extensions={}),lt.extensions[Xl]=LR(c,_),_.extensionsUsed[Xl]=!0}})),i==null||i(d),d},ext:["gltf","glb"],extensions:h})}const bL=c=>({writeNode:(e,i)=>{if(!(e!=null&&e.isLight))return;i.extensions||(i.extensions={});const s={};e.shadow&&(s.shadow=e.shadow.toJSON()),Object.keys(s).length>0&&(i.extensions[lp]=s,c.extensionsUsed[lp]=!0)}}),EL=c=>({writeNode:(e,i)=>{if(!(e!=null&&e.isObject3D))return;i.extensions||(i.extensions={});const s={};e.castShadow!==void 0&&(s.castShadow=e.castShadow),e.receiveShadow!==void 0&&(s.receiveShadow=e.receiveShadow),e.visible===!1&&(s.visible=!1),e.frustumCulled===!1&&(s.frustumCulled=!1),e.renderOrder!==0&&(s.renderOrder=e.renderOrder),e.layers.mask!==1&&(s.layers=e.layers.mask),e.matrixAutoUpdate===!1&&(s.matrixAutoUpdate=!1),Object.keys(s).length>0&&(i.extensions[Fm]=s,c.extensionsUsed[Fm]=!0)}}),SL=c=>({writeMaterial(e,i){var s;if(!(e!=null&&e.isMaterial))return;i.extensions||(i.extensions={});const a={};if(e.emissiveIntensity!==void 0&&(!((s=e.emissive)===null||s===void 0)&&s.isColor)){const d=e.emissive.clone().multiplyScalar(e.emissiveIntensity),_=Math.max(d.r,d.g,d.b);_>1&&(a.emissiveIntensity=_)}e.fog!==void 0&&(a.fog=e.fog),e.flatShading!==void 0&&(a.flatShading=e.flatShading),e.blending!==void 0&&(a.blending=e.blending),e.side!==void 0&&e.side!==b.ehD&&(a.side=e.side),e.shadowSide!==void 0&&(a.shadowSide=e.shadowSide),e.depthFunc!==void 0&&(a.depthFunc=e.depthFunc),e.depthTest!==void 0&&(a.depthTest=e.depthTest),e.depthWrite!==void 0&&(a.depthWrite=e.depthWrite),e.colorWrite!==void 0&&(a.colorWrite=e.colorWrite),e.wireframe!==void 0&&(a.wireframe=e.wireframe),e.wireframeLinewidth!==void 0&&(a.wireframeLinewidth=e.wireframeLinewidth),e.wireframeLinecap!==void 0&&(a.wireframeLinecap=e.wireframeLinecap),e.wireframeLinejoin!==void 0&&(a.wireframeLinejoin=e.wireframeLinejoin),e.rotation!==void 0&&(a.rotation=e.rotation),e.polygonOffset!==void 0&&(a.polygonOffset=e.polygonOffset),e.polygonOffsetFactor!==void 0&&(a.polygonOffsetFactor=e.polygonOffsetFactor),e.polygonOffsetUnits!==void 0&&(a.polygonOffsetUnits=e.polygonOffsetUnits),e.dithering!==void 0&&(a.dithering=e.dithering),e.alphaToCoverage!==void 0&&(a.alphaToCoverage=e.alphaToCoverage),e.premultipliedAlpha!==void 0&&(a.premultipliedAlpha=e.premultipliedAlpha),e.toneMapped!==void 0&&(a.toneMapped=e.toneMapped);const h=this.materialExternalResources[e.uuid];h&&Object.entries(h).forEach(([d,_])=>{d.startsWith("_")||(a[d]=ao(_,!1,this.serializedMeta))}),Object.keys(a).length>0&&(i.extensions[Kl]=a,c.extensionsUsed[Kl]=!0)},materialExternalResources:{},serializedMeta:{images:{},textures:{}},beforeParse(e){if(this.materialExternalResources={},!c.options.externalImagesInExtras)return;const i=[];(Array.isArray(e)?e:[e]).forEach(s=>{s==null||s.traverse(a=>{var h;a&&(!((h=a.material)===null||h===void 0)&&h.isMaterial)&&i.push(a.material)})}),i.forEach(s=>{s&&(this.materialExternalResources[s.uuid]||(this.materialExternalResources[s.uuid]={}),this.materialExternalResources[s.uuid].__materialRef=s,Object.entries(s).forEach(([a,h])=>{a.startsWith("_")||h&&h.isTexture&&h.userData.rootPath&&(s[a]=null,this.materialExternalResources[s.uuid][a]=h)}))})},afterParse(e){const i=Object.values(this.materialExternalResources);if(i.length<1)return;i.forEach(a=>{const h=a.__materialRef;h&&(Object.entries(a).forEach(([d,_])=>{d.startsWith("_")||_&&(h[d]=_)}),delete this.materialExternalResources[h.uuid])});const s=c.json.scenes[c.json.scene||0];s.extensions||(s.extensions={}),s.extensions[Kl]={resources:this.serializedMeta},c.extensionsUsed[Kl]=!0}});class CL{constructor(e){this.writer=e,this.name=ru}writeMaterial(e,i){if(!e.isMeshStandardMaterial||e.bumpScale===0)return;const s=this.writer,a=s.extensionsUsed,h={};if(h.bumpScale=e.bumpScale,e.bumpMap){const d={index:s.processTexture(e.bumpMap)};s.applyTextureTransform(d,e.bumpMap),h.bumpTexture=d}i.extensions=i.extensions||{},i.extensions[this.name]=h,a[this.name]=!0}}class ML{constructor(e){this.writer=e,this.name=Rv}writeMaterial(e,i){if(!e.isMeshStandardMaterial||e.displacementScale===0)return;const s=this.writer,a=s.extensionsUsed,h={};if(h.displacementScale=e.displacementScale,h.displacementBias=e.displacementBias,e.displacementMap){const d={index:s.processTexture(e.displacementMap)};s.applyTextureTransform(d,e.displacementMap),h.displacementTexture=d}i.extensions=i.extensions||{},i.extensions[this.name]=h,a[this.name]=!0}}class TL{constructor(e){this.writer=e,this.name=zm}writeMaterial(e,i){if(!e.isMeshStandardMaterial||e.lightMapIntensity===0)return;const s=this.writer,a=s.extensionsUsed,h={};if(h.lightMapIntensity=e.lightMapIntensity,e.lightMap){const d={index:s.processTexture(e.lightMap)};s.applyTextureTransform(d,e.lightMap),h.lightMapTexture=d}i.extensions=i.extensions||{},i.extensions[this.name]=h,a[this.name]=!0}}class IL{constructor(e){this.writer=e,this.name=g0}writeMaterial(e,i){if(!e.isMeshStandardMaterial||!e.alphaMap)return;const s=this.writer,a=s.extensionsUsed,h={};if(e.alphaMap){const d={index:s.processTexture(e.alphaMap)};s.applyTextureTransform(d,e.alphaMap),h.alphaTexture=d}i.extensions=i.extensions||{},i.extensions[this.name]=h,a[this.name]=!0}}class k_ extends ot{constructor(e,i={}){super(),this._processors=new c_,this._cachedParsers=[],jD(e)}get processors(){return this._processors}getExporter(...e){return k_.Exporters.find(i=>i.ext.some(s=>e.includes(s)))}async exportObject(e,i={}){var s,a,h,d;if(!(e!=null&&e.assetType))return void console.error("Object has no asset type");!((a=(s=e)===null||s===void 0?void 0:s.userData)===null||a===void 0)&&a.rootSceneModelRoot&&i.viewerConfig===!1&&(e.userData.__exportViewerConfig=!1);const _=await this._exportFile(e,i);return!((d=(h=e)===null||h===void 0?void 0:h.userData)===null||d===void 0)&&d.rootSceneModelRoot&&i.viewerConfig===!1&&delete e.userData.__exportViewerConfig,_}async _exportFile(e,i={}){var s,a,h;let d;this.dispatchEvent({type:"exportFile",obj:e,state:"processing"});try{const _=await this.processBeforeExport(e,i),et=(a=(s=i.exportExt)!==null&&s!==void 0?s:_==null?void 0:_.typeExt)!==null&&a!==void 0?a:_==null?void 0:_.ext;if(!_||!et)throw new Error(`Unable to preprocess before export ${et}`);const nt=this._getParser(et);this.dispatchEvent({type:"exportFile",obj:e,state:"exporting"});const it=await nt.parseAsync(_.obj,{exportExt:(h=_.ext)!==null&&h!==void 0?h:et,...i});it.ext=_.ext,d=it}catch(_){return console.error("AssetExporter: Unable to Export file",e),console.error(_),void this.dispatchEvent({type:"exportFile",obj:e,state:"error",error:_})}return this.dispatchEvent({type:"exportFile",obj:e,state:"done"}),d}_createParser(e){const i=k_.Exporters.find(a=>a.ext.includes(e));if(!i)throw new Error(`No exporter found for extension ${e}`);const s=i==null?void 0:i.ctor(this);if(!s)throw new Error(`Unable to create parser for extension ${e}`);return this._cachedParsers.push({ext:i.ext,parser:s}),this.dispatchEvent({type:"exporterCreate",exporter:i,parser:s}),s}_getParser(e){var i,s;return(s=(i=this._cachedParsers.find(a=>a.ext.includes(e)))===null||i===void 0?void 0:i.parser)!==null&&s!==void 0?s:this._createParser(e)}async processBeforeExport(e,i={}){switch(e.assetType!=null&&(e=await this._processors.process(e.assetType,e,i)),e.assetType){case"light":return void console.error("AssetExporter: light export not implemented");case"model":return{obj:e,ext:"glb"};case"material":return{obj:e.toJSON(),ext:e.typeSlug||"json",typeExt:"json"};case"texture":return{obj:e.toJSON(),ext:"json"};default:console.error("AssetExporter: unknown asset type",e.assetType)}}dispose(){var e;(e=this._processors)===null||e===void 0||e.dispose()}}k_.Exporters=[{ctor:()=>new $C,ext:["json"]},{ctor:()=>new DR,ext:["txt","text"]}];class tM extends Ls{constructor(e){super(),this.enabled=!0,this.exportOptions={compress:!1,name:"scene",viewerConfig:!0,convertMeshToIndexed:!1,embedUrlImages:!1},this.exporter=e,this.exportScene=this.exportScene.bind(this)}async onAdded(e){await super.onAdded(e),this.exporter||(this.exporter=new k_(e)),this.exporter.processors.add("model",{forAssetType:"model",processAsync:async(i,s)=>{var a;return s.convertMeshToIndexed&&((a=i.modelObject)===null||a===void 0||a.traverse(h=>{var d;h.geometry&&(h.geometry.attributes.index||(d=h.setGeometry)===null||d===void 0||d.call(h,Ao(h.geometry)))})),i}})}async onRemove(e){return super.onRemove(e)}async exportScene(e){var i,s;return(i=this.exporter)===null||i===void 0?void 0:i.exportObject((s=this._viewer)===null||s===void 0?void 0:s.scene.modelRoot,e||{...this.exportOptions})}get uiConfig(){if(this._uiConfig)return this._uiConfig;const e=this._viewer;e.addEventListener("addPlugin",s=>{var a;typeof((a=s.plugin)===null||a===void 0?void 0:a.toJSON)=="function"&&console.error("Add all plugins before setting up the export UI, or use `toJSON: any = null` in the plugin ")});const i=Object.entries(e.plugins).filter(([s,a])=>typeof(a==null?void 0:a.toJSON)=="function").map(([s,a])=>({label:s,type:"checkbox",value:!0}));return this._uiConfig={type:"folder",label:"Asset Export",limitedUi:!0,children:[{type:"input",property:[this.exportOptions,"name"],limitedUi:!0},{type:"folder",label:"GLB Export",limitedUi:!0,children:[{type:"checkbox",label:"DRACO Compress",property:[this.exportOptions,"compress"],limitedUi:!0},{type:"checkbox",label:"Scene Settings",property:[this.exportOptions,"viewerConfig"],limitedUi:!0},{type:"checkbox",label:"Indexed meshes only",property:[this.exportOptions,"convertMeshToIndexed"]},{type:"button",label:"Export GLB",limitedUi:!0,value:async()=>{const s=await this.exportScene(this.exportOptions);s&&Do(s,this.exportOptions.name+"."+s.ext)}}]},{type:"folder",label:"Preset/Config export",children:[{type:"folder",label:"Plugins",children:i},{type:"button",label:"Select none",value:()=>{i.forEach(s=>{var a;s.value=!1,(a=s.uiRefresh)===null||a===void 0||a.call(s)})}},{type:"button",label:"Select all",value:()=>{i.forEach(s=>{var a;s.value=!0,(a=s.uiRefresh)===null||a===void 0||a.call(s)})}},{type:"button",label:"Export Plugins",limitedUi:!0,value:async()=>{const s=new Blob([JSON.stringify(e.getPlugin(qr).exportPluginPresets(i.filter(a=>!!a.value).map(a=>Yt(a.label)||"")),null,2)],{type:"application/json"});s&&Do(s,this.exportOptions.name+"."+qr.ViewerTypeSlug)}},{type:"button",label:"Export All Viewer Config",limitedUi:!0,value:async()=>{const s=new Blob([JSON.stringify(e.getPlugin(qr).exportViewerConfig(!1),null,2)],{type:"application/json"});s&&Do(s,this.exportOptions.name+"."+qr.ViewerTypeSlug)}}]}]}}}tM.PluginType="AssetExporterPlugin";class zD{constructor(){this._listeners={}}addEventListener(e,i){const s=this._listeners;return s[e]===void 0&&(s[e]=[]),s[e].indexOf(i)===-1&&s[e].push(i),this}removeEventListener(e,i){if(this._listeners===void 0)return this;const s=this._listeners[e];if(s!==void 0){const a=s.indexOf(i);a!==-1&&s.splice(a,1)}return this}dispatchEvent(e){if(this._listeners===void 0)return this;const i=this._listeners[e.type];if(i!==void 0){const s=i.slice(0);for(let a=0,h=s.length;a<h;a++)s[a].call(this,e)}return this}dispose(){for(const e in this._listeners)delete this._listeners[e]}}class O_ extends zD{constructor(e,i,s,a={}){if(super(),this._name=void 0,this._parent=void 0,this._child=void 0,this._attributes=void 0,this._disposed=!1,this._name=e,this._parent=i,this._child=s,this._attributes=a,!i.isOnGraph(s))throw new Error("Cannot connect disconnected graphs.")}getName(){return this._name}getParent(){return this._parent}getChild(){return this._child}setChild(e){return this._child=e,this}getAttributes(){return this._attributes}dispose(){this._disposed||(this._disposed=!0,this.dispatchEvent({type:"dispose",target:this}),super.dispose())}isDisposed(){return this._disposed}}class DL extends zD{constructor(...e){super(...e),this._emptySet=new Set,this._edges=new Set,this._parentEdges=new Map,this._childEdges=new Map}listEdges(){return Array.from(this._edges)}listParentEdges(e){return Array.from(this._childEdges.get(e)||this._emptySet)}listParents(e){return this.listParentEdges(e).map(i=>i.getParent())}listChildEdges(e){return Array.from(this._parentEdges.get(e)||this._emptySet)}listChildren(e){return this.listChildEdges(e).map(i=>i.getChild())}disconnectParents(e,i){let s=this.listParentEdges(e);return i&&(s=s.filter(a=>i(a.getParent()))),s.forEach(a=>a.dispose()),this}createEdge(e,i,s,a){return this._registerEdge(new O_(e,i,s,a))}_registerEdge(e){this._edges.add(e);const i=e.getParent();this._parentEdges.has(i)||this._parentEdges.set(i,new Set),this._parentEdges.get(i).add(e);const s=e.getChild();return this._childEdges.has(s)||this._childEdges.set(s,new Set),this._childEdges.get(s).add(e),e.addEventListener("dispose",()=>this._removeEdge(e)),e}_removeEdge(e){return this._edges.delete(e),this._parentEdges.get(e.getParent()).delete(e),this._childEdges.get(e.getChild()).delete(e),this}}function nM(){return nM=Object.assign||function(c){for(var e=1;e<arguments.length;e++){var i=arguments[e];for(var s in i)Object.prototype.hasOwnProperty.call(i,s)&&(c[s]=i[s])}return c},nM.apply(this,arguments)}function VD(c){return c instanceof O_}function QD(c){return Array.isArray(c)&&c[0]instanceof O_}function GD(c){return!!(c&&typeof c=="object"&&Object.values(c)[0]instanceof O_)}const Zo=Symbol("attributes"),$E=Symbol("immutableKeys");class HD extends zD{constructor(e){super(),this._disposed=!1,this.graph=void 0,this[Zo]=void 0,this[$E]=void 0,this.graph=e,this[$E]=new Set,this[Zo]=this._createAttributes()}getDefaults(){return{}}_createAttributes(){const e=this.getDefaults(),i={};for(const s in e){const a=e[s];if(a instanceof HD){const h=this.graph.createEdge(s,this,a);h.addEventListener("dispose",()=>a.dispose()),this[$E].add(s),i[s]=h}else i[s]=a}return i}isOnGraph(e){return this.graph===e.graph}isDisposed(){return this._disposed}dispose(){this._disposed||(this.graph.listChildEdges(this).forEach(e=>e.dispose()),this.graph.disconnectParents(this),this._disposed=!0,this.dispatchEvent({type:"dispose"}))}detach(){return this.graph.disconnectParents(this),this}swap(e,i){for(const s in this[Zo]){const a=this[Zo][s];if(VD(a)){const h=a;h.getChild()===e&&this.setRef(s,i,h.getAttributes())}else if(QD(a)){const h=a.find(d=>d.getChild()===e);if(h){const d=h.getAttributes();this.removeRef(s,e).addRef(s,i,d)}}else if(GD(a)){const h=a;for(const d in h){const _=h[d];_.getChild()===e&&this.setRefMap(s,d,i,_.getAttributes())}}}return this}get(e){return this[Zo][e]}set(e,i){return this[Zo][e]=i,this.dispatchEvent({type:"change",attribute:e})}getRef(e){const i=this[Zo][e];return i?i.getChild():null}setRef(e,i,s){if(this[$E].has(e))throw new Error(`Cannot overwrite immutable attribute, "${e}".`);const a=this[Zo][e];if(a&&a.dispose(),!i)return this;const h=this.graph.createEdge(e,this,i,s);return h.addEventListener("dispose",()=>{delete this[Zo][e],this.dispatchEvent({type:"change",attribute:e})}),this[Zo][e]=h,this.dispatchEvent({type:"change",attribute:e})}listRefs(e){return this[Zo][e].map(i=>i.getChild())}addRef(e,i,s){const a=this.graph.createEdge(e,this,i,s),h=this[Zo][e];return h.push(a),a.addEventListener("dispose",()=>{const d=h.filter(_=>_!==a);h.length=0;for(const _ of d)h.push(_);this.dispatchEvent({type:"change",attribute:e})}),this.dispatchEvent({type:"change",attribute:e})}removeRef(e,i){return this[Zo][e].filter(s=>s.getChild()===i).forEach(s=>s.dispose()),this}listRefMapKeys(e){return Object.keys(this[Zo][e])}listRefMapValues(e){return Object.values(this[Zo][e]).map(i=>i.getChild())}getRefMap(e,i){const s=this[Zo][e];return s[i]?s[i].getChild():null}setRefMap(e,i,s,a){const h=this[Zo][e],d=h[i];if(d&&d.dispose(),!s)return this;a=Object.assign(a||{},{key:i});const _=this.graph.createEdge(e,this,s,nM({},a,{key:i}));return _.addEventListener("dispose",()=>{delete h[i],this.dispatchEvent({type:"change",attribute:e,key:i})}),h[i]=_,this.dispatchEvent({type:"change",attribute:e,key:i})}dispatchEvent(e){return super.dispatchEvent(nM({},e,{target:this})),this.graph.dispatchEvent(nM({},e,{target:this,type:`node:${e.type}`})),this}}var gI,Yr,vI,V0,cu,Zv,WD=typeof Float32Array<"u"?Float32Array:Array;function qD(c){var e=c[0],i=c[1],s=c[2];return Math.hypot(e,i,s)}function PL(c,e,i){var s=e[0],a=e[1],h=e[2],d=i[3]*s+i[7]*a+i[11]*h+i[15];return d=d||1,c[0]=(i[0]*s+i[4]*a+i[8]*h+i[12])/d,c[1]=(i[1]*s+i[5]*a+i[9]*h+i[13])/d,c[2]=(i[2]*s+i[6]*a+i[10]*h+i[14])/d,c}function RL(c,e,i){var s=e[0],a=e[1],h=e[2],d=e[3],_=e[4],et=e[5],nt=e[6],it=e[7],lt=e[8],ut=e[9],pt=e[10],gt=e[11],vt=e[12],Ct=e[13],wt=e[14],xt=e[15],_t=i[0],Pt=i[1],Bt=i[2],Ot=i[3];return c[0]=_t*s+Pt*_+Bt*lt+Ot*vt,c[1]=_t*a+Pt*et+Bt*ut+Ot*Ct,c[2]=_t*h+Pt*nt+Bt*pt+Ot*wt,c[3]=_t*d+Pt*it+Bt*gt+Ot*xt,_t=i[4],Pt=i[5],Bt=i[6],Ot=i[7],c[4]=_t*s+Pt*_+Bt*lt+Ot*vt,c[5]=_t*a+Pt*et+Bt*ut+Ot*Ct,c[6]=_t*h+Pt*nt+Bt*pt+Ot*wt,c[7]=_t*d+Pt*it+Bt*gt+Ot*xt,_t=i[8],Pt=i[9],Bt=i[10],Ot=i[11],c[8]=_t*s+Pt*_+Bt*lt+Ot*vt,c[9]=_t*a+Pt*et+Bt*ut+Ot*Ct,c[10]=_t*h+Pt*nt+Bt*pt+Ot*wt,c[11]=_t*d+Pt*it+Bt*gt+Ot*xt,_t=i[12],Pt=i[13],Bt=i[14],Ot=i[15],c[12]=_t*s+Pt*_+Bt*lt+Ot*vt,c[13]=_t*a+Pt*et+Bt*ut+Ot*Ct,c[14]=_t*h+Pt*nt+Bt*pt+Ot*wt,c[15]=_t*d+Pt*it+Bt*gt+Ot*xt,c}function BL(c,e){const i={min:[1/0,1/0,1/0],max:[-1/0,-1/0,-1/0]};for(const s of c.listPrimitives()){const a=s.getAttribute("POSITION");if(!a)continue;let h=[0,0,0],d=[0,0,0];for(let _=0;_<a.getCount();_++)h=a.getElement(_,h),d=PL(d,h,e),YD(d,i)}return i}function YD(c,e){for(let i=0;i<3;i++)e.min[i]=Math.min(c[i],e.min[i]),e.max[i]=Math.max(c[i],e.max[i])}Math.hypot||(Math.hypot=function(){for(var c=0,e=arguments.length;e--;)c+=arguments[e]*arguments[e];return Math.sqrt(c)}),gI=new WD(3),WD!=Float32Array&&(gI[0]=0,gI[1]=0,gI[2]=0),function(c){c.ACCESSOR="Accessor",c.ANIMATION="Animation",c.ANIMATION_CHANNEL="AnimationChannel",c.ANIMATION_SAMPLER="AnimationSampler",c.BUFFER="Buffer",c.CAMERA="Camera",c.MATERIAL="Material",c.MESH="Mesh",c.PRIMITIVE="Primitive",c.PRIMITIVE_TARGET="PrimitiveTarget",c.NODE="Node",c.ROOT="Root",c.SCENE="Scene",c.SKIN="Skin",c.TEXTURE="Texture",c.TEXTURE_INFO="TextureInfo"}(Yr||(Yr={})),function(c){c.INTERLEAVED="interleaved",c.SEPARATE="separate"}(vI||(vI={})),function(c){c.ARRAY_BUFFER="ARRAY_BUFFER",c.ELEMENT_ARRAY_BUFFER="ELEMENT_ARRAY_BUFFER",c.INVERSE_BIND_MATRICES="INVERSE_BIND_MATRICES",c.OTHER="OTHER"}(V0||(V0={})),function(c){c[c.R=4096]="R",c[c.G=256]="G",c[c.B=16]="B",c[c.A=1]="A"}(cu||(cu={})),function(c){c.GLTF="GLTF",c.GLB="GLB"}(Zv||(Zv={}));class fo{static createBufferFromDataURI(e){if(typeof Buffer>"u"){const i=atob(e.split(",")[1]),s=new Uint8Array(i.length);for(let a=0;a<i.length;a++)s[a]=i.charCodeAt(a);return s}{const i=e.split(",")[1],s=e.indexOf("base64")>=0;return Buffer.from(i,s?"base64":"utf8")}}static encodeText(e){return typeof TextEncoder<"u"?new TextEncoder().encode(e):Buffer.from(e)}static decodeText(e){return typeof TextDecoder<"u"?new TextDecoder().decode(e):Buffer.from(e).toString("utf8")}static concat(e){let i=0;for(const h of e)i+=h.byteLength;const s=new Uint8Array(i);let a=0;for(const h of e)s.set(h,a),a+=h.byteLength;return s}static pad(e,i=0){const s=this.padNumber(e.byteLength);if(s===e.byteLength)return e;const a=new Uint8Array(s);if(a.set(e),i!==0)for(let h=e.byteLength;h<s;h++)a[h]=i;return a}static padNumber(e){return 4*Math.ceil(e/4)}static equals(e,i){if(e===i)return!0;if(e.byteLength!==i.byteLength)return!1;let s=e.byteLength;for(;s--;)if(e[s]!==i[s])return!1;return!0}static toView(e,i=0,s=1/0){return new Uint8Array(e.buffer,e.byteOffset+i,Math.min(e.byteLength,s))}static assertView(e){if(e&&!ArrayBuffer.isView(e))throw new Error(`Method requires Uint8Array parameter; received "${typeof e}".`);return e}}class Tm{static hexToFactor(e,i){e=Math.floor(e);const s=i;return s[0]=(e>>16&255)/255,s[1]=(e>>8&255)/255,s[2]=(255&e)/255,this.convertSRGBToLinear(i,i)}static factorToHex(e){const i=[...e],[s,a,h]=this.convertLinearToSRGB(e,i);return 255*s<<16^255*a<<8^255*h<<0}static convertSRGBToLinear(e,i){const s=e,a=i;for(let h=0;h<3;h++)a[h]=s[h]<.04045?.0773993808*s[h]:Math.pow(.9478672986*s[h]+.0521327014,2.4);return i}static convertLinearToSRGB(e,i){const s=e,a=i;for(let h=0;h<3;h++)a[h]=s[h]<.0031308?12.92*s[h]:1.055*Math.pow(s[h],.41666)-.055;return i}}class _I{match(e){return e.length>=8&&e[0]===137&&e[1]===80&&e[2]===78&&e[3]===71&&e[4]===13&&e[5]===10&&e[6]===26&&e[7]===10}getSize(e){const i=new DataView(e.buffer,e.byteOffset);return fo.decodeText(e.slice(12,16))===_I.PNG_FRIED_CHUNK_NAME?[i.getUint32(32,!1),i.getUint32(36,!1)]:[i.getUint32(16,!1),i.getUint32(20,!1)]}getChannels(e){return 4}}_I.PNG_FRIED_CHUNK_NAME="CgBI";class ay{static registerFormat(e,i){this.impls[e]=i}static getMimeType(e){for(const i in this.impls)if(this.impls[i].match(e))return i;return null}static getSize(e,i){return this.impls[i]?this.impls[i].getSize(e):null}static getChannels(e,i){return this.impls[i]?this.impls[i].getChannels(e):null}static getMemSize(e,i){if(!this.impls[i])return null;if(this.impls[i].getGPUByteLength)return this.impls[i].getGPUByteLength(e);let s=0;const a=this.getSize(e,i);if(!a)return null;for(;a[0]>1||a[1]>1;)s+=a[0]*a[1]*4,a[0]=Math.max(Math.floor(a[0]/2),1),a[1]=Math.max(Math.floor(a[1]/2),1);return s+=4,s}static mimeTypeToExtension(e){return e==="image/jpeg"?"jpg":e.split("/").pop()}static extensionToMimeType(e){return e==="jpg"?"image/jpeg":`image/${e}`}}function kL(c,e){if(e>c.byteLength)throw new TypeError("Corrupt JPG, exceeded buffer limits");if(c.getUint8(e)!==255)throw new TypeError("Invalid JPG, marker table corrupted");return c}ay.impls={"image/jpeg":new class{match(c){return c.length>=3&&c[0]===255&&c[1]===216&&c[2]===255}getSize(c){let e,i,s=new DataView(c.buffer,c.byteOffset+4);for(;s.byteLength;){if(e=s.getUint16(0,!1),kL(s,e),i=s.getUint8(e+1),i===192||i===193||i===194)return[s.getUint16(e+7,!1),s.getUint16(e+5,!1)];s=new DataView(c.buffer,s.byteOffset+e+2)}throw new TypeError("Invalid JPG, no size found")}getChannels(c){return 3}},"image/png":new _I};class Xx{static basename(e){const i=e.split(/[\\/]/).pop();return i.substring(0,i.lastIndexOf("."))}static extension(e){if(e.startsWith("data:image/")){const i=e.match(/data:(image\/\w+)/)[1];return ay.mimeTypeToExtension(i)}return e.startsWith("data:model/gltf+json")?"gltf":e.startsWith("data:model/gltf-binary")?"glb":e.startsWith("data:application/")?"bin":e.split(/[\\/]/).pop().split(/[.]/).pop()}}function NR(c){return Object.prototype.toString.call(c)==="[object Object]"}function ly(c){if(NR(c)===!1)return!1;const e=c.constructor;if(e===void 0)return!0;const i=e.prototype;return NR(i)!==!1&&Object.prototype.hasOwnProperty.call(i,"isPrototypeOf")!==!1}class dv{constructor(e){this.verbosity=void 0,this.verbosity=e}debug(e){this.verbosity<=dv.Verbosity.DEBUG&&console.debug(e)}info(e){this.verbosity<=dv.Verbosity.INFO&&console.info(e)}warn(e){this.verbosity<=dv.Verbosity.WARN&&console.warn(e)}error(e){this.verbosity<=dv.Verbosity.ERROR&&console.error(e)}}dv.Verbosity={SILENT:4,ERROR:3,WARN:2,INFO:1,DEBUG:0},dv.DEFAULT_INSTANCE=new dv(dv.Verbosity.INFO);class $l{static identity(e){return e}static eq(e,i){if(e.length!==i.length)return!1;for(let s=0;s<e.length;s++)if(Math.abs(e[s]-i[s])>1e-5)return!1;return!0}static denormalize(e,i){switch(i){case 5126:return e;case 5123:return e/65535;case 5121:return e/255;case 5122:return Math.max(e/32767,-1);case 5120:return Math.max(e/127,-1);default:throw new Error("Invalid component type.")}}static normalize(e,i){switch(i){case 5126:return e;case 5123:return Math.round(65535*e);case 5121:return Math.round(255*e);case 5122:return Math.round(32767*e);case 5120:return Math.round(127*e);default:throw new Error("Invalid component type.")}}static decompose(e,i,s,a){let h=qD([e[0],e[1],e[2]]);const d=qD([e[4],e[5],e[6]]),_=qD([e[8],e[9],e[10]]);(function(ut){var pt=ut[0],gt=ut[1],vt=ut[2],Ct=ut[3],wt=ut[4],xt=ut[5],_t=ut[6],Pt=ut[7],Bt=ut[8],Ot=ut[9],Lt=ut[10],qt=ut[11],en=ut[12],cn=ut[13],An=ut[14],mn=ut[15];return(pt*xt-gt*wt)*(Lt*mn-qt*An)-(pt*_t-vt*wt)*(Ot*mn-qt*cn)+(pt*Pt-Ct*wt)*(Ot*An-Lt*cn)+(gt*_t-vt*xt)*(Bt*mn-qt*en)-(gt*Pt-Ct*xt)*(Bt*An-Lt*en)+(vt*Pt-Ct*_t)*(Bt*cn-Ot*en)})(e)<0&&(h=-h),i[0]=e[12],i[1]=e[13],i[2]=e[14];const et=e.slice(),nt=1/h,it=1/d,lt=1/_;et[0]*=nt,et[1]*=nt,et[2]*=nt,et[4]*=it,et[5]*=it,et[6]*=it,et[8]*=lt,et[9]*=lt,et[10]*=lt,function(ut,pt){var gt=new WD(3);(function(Tn,vn){var xn=vn[0],Un=vn[1],Mn=vn[2],Gn=vn[4],rr=vn[5],dr=vn[6],_i=vn[8],xr=vn[9],Cr=vn[10];Tn[0]=Math.hypot(xn,Un,Mn),Tn[1]=Math.hypot(Gn,rr,dr),Tn[2]=Math.hypot(_i,xr,Cr)})(gt,pt);var vt=1/gt[0],Ct=1/gt[1],wt=1/gt[2],xt=pt[0]*vt,_t=pt[1]*Ct,Pt=pt[2]*wt,Bt=pt[4]*vt,Ot=pt[5]*Ct,Lt=pt[6]*wt,qt=pt[8]*vt,en=pt[9]*Ct,cn=pt[10]*wt,An=xt+Ot+cn,mn=0;An>0?(mn=2*Math.sqrt(An+1),ut[3]=.25*mn,ut[0]=(Lt-en)/mn,ut[1]=(qt-Pt)/mn,ut[2]=(_t-Bt)/mn):xt>Ot&&xt>cn?(mn=2*Math.sqrt(1+xt-Ot-cn),ut[3]=(Lt-en)/mn,ut[0]=.25*mn,ut[1]=(_t+Bt)/mn,ut[2]=(qt+Pt)/mn):Ot>cn?(mn=2*Math.sqrt(1+Ot-xt-cn),ut[3]=(qt-Pt)/mn,ut[0]=(_t+Bt)/mn,ut[1]=.25*mn,ut[2]=(Lt+en)/mn):(mn=2*Math.sqrt(1+cn-xt-Ot),ut[3]=(_t-Bt)/mn,ut[0]=(qt+Pt)/mn,ut[1]=(Lt+en)/mn,ut[2]=.25*mn)}(s,et),a[0]=h,a[1]=d,a[2]=_}static compose(e,i,s,a){const h=a,d=i[0],_=i[1],et=i[2],nt=i[3],it=d+d,lt=_+_,ut=et+et,pt=d*it,gt=d*lt,vt=d*ut,Ct=_*lt,wt=_*ut,xt=et*ut,_t=nt*it,Pt=nt*lt,Bt=nt*ut,Ot=s[0],Lt=s[1],qt=s[2];return h[0]=(1-(Ct+xt))*Ot,h[1]=(gt+Bt)*Ot,h[2]=(vt-Pt)*Ot,h[3]=0,h[4]=(gt-Bt)*Lt,h[5]=(1-(pt+xt))*Lt,h[6]=(wt+_t)*Lt,h[7]=0,h[8]=(vt+Pt)*qt,h[9]=(wt-_t)*qt,h[10]=(1-(pt+Ct))*qt,h[11]=0,h[12]=e[0],h[13]=e[1],h[14]=e[2],h[15]=1,h}}function OL(c,e){if(!!c!=!!e)return!1;const i=c.getChild(),s=e.getChild();return i===s||i.equals(s)}function LL(c,e){if(!!c!=!!e||c.length!==e.length)return!1;for(let i=0;i<c.length;i++){const s=c[i],a=e[i];if(s.getChild()!==a.getChild()&&!s.getChild().equals(a.getChild()))return!1}return!0}function NL(c,e){if(!!c!=!!e)return!1;const i=Object.keys(c),s=Object.keys(e);if(i.length!==s.length)return!1;for(const a in c){const h=c[a],d=e[a];if(!!h!=!!d)return!1;const _=h.getChild(),et=d.getChild();if(_!==et&&!_.equals(et))return!1}return!0}function UR(c,e){if(c===e)return!0;if(!!c!=!!e||!c||!e||c.length!==e.length)return!1;for(let i=0;i<c.length;i++)if(c[i]!==e[i])return!1;return!0}function FR(c,e){if(c===e)return!0;if(!!c!=!!e)return!1;if(!ly(c)||!ly(e))return c===e;const i=c,s=e;let a,h=0,d=0;for(a in i)h++;for(a in s)d++;if(h!==d)return!1;for(a in i){const _=i[a],et=s[a];if(AI(_)&&AI(et)){if(!UR(_,et))return!1}else if(ly(_)&&ly(et)){if(!FR(_,et))return!1}else if(_!==et)return!1}return!0}function AI(c){return Array.isArray(c)||ArrayBuffer.isView(c)}const jR="23456789abdegjkmnpqrvwxyzABDEGJKMNPQRVWXYZ",zR=new Set,UL=function(){let c="";for(let e=0;e<6;e++)c+=jR.charAt(Math.floor(Math.random()*jR.length));return c};class ww{static dirname(e){const i=e.lastIndexOf("/");return i===-1?"./":e.substring(0,i+1)}static basename(e){return Xx.basename(new URL(e,"https://null.example").pathname)}static extension(e){return Xx.extension(new URL(e,"https://null.example").pathname)}static resolve(e,i){if(!this.isRelativePath(i))return i;const s=e.split("/"),a=i.split("/");s.pop();for(let h=0;h<a.length;h++)a[h]!=="."&&(a[h]===".."?s.pop():s.push(a[h]));return s.join("/")}static isAbsoluteURL(e){return this.PROTOCOL_REGEXP.test(e)}static isRelativePath(e){return!/^(?:[a-zA-Z]+:)?\//.test(e)}}ww.DEFAULT_INIT={},ww.PROTOCOL_REGEXP=/^[a-zA-Z]+:\/\//;const L_=c=>c,FL=new Set;class XD extends HD{constructor(e,i=""){super(e),this[Zo].name=i,this.init(),this.dispatchEvent({type:"create"})}getDefaults(){return Object.assign(super.getDefaults(),{name:"",extras:{}})}getName(){return this.get("name")}setName(e){return this.set("name",e)}getExtras(){return this.get("extras")}setExtras(e){return this.set("extras",e)}clone(){return new this.constructor(this.graph).copy(this,L_)}copy(e,i=L_){for(const s in this[Zo]){const a=this[Zo][s];if(a instanceof O_)this[$E].has(s)||a.dispose();else if(Array.isArray(a)&&a[0]instanceof O_)for(const h of a)h.dispose();else if(ly(a)&&Object.values(a)[0]instanceof O_)for(const h in a)a[h].dispose()}for(const s in e[Zo]){const a=this[Zo][s],h=e[Zo][s];if(h instanceof O_)this[$E].has(s)?a.getChild().copy(i(h.getChild()),i):this.setRef(s,i(h.getChild()),h.getAttributes());else if(Array.isArray(h)&&h[0]instanceof O_)for(const d of h)this.addRef(s,i(d.getChild()),d.getAttributes());else if(ly(h)&&Object.values(h)[0]instanceof O_)for(const d in h){const _=h[d];this.setRefMap(s,d,i(_.getChild()),_.getAttributes())}else this[Zo][s]=ly(h)?JSON.parse(JSON.stringify(h)):Array.isArray(h)||h instanceof ArrayBuffer||ArrayBuffer.isView(h)?h.slice():h}return this}equals(e,i=FL){if(this===e)return!0;if(this.propertyType!==e.propertyType)return!1;for(const s in this[Zo]){if(i.has(s))continue;const a=this[Zo][s],h=e[Zo][s];if(VD(a)||VD(h)){if(!OL(a,h))return!1}else if(QD(a)||QD(h)){if(!LL(a,h))return!1}else if(GD(a)||GD(h)){if(!NL(a,h))return!1}else if(ly(a)||ly(h)){if(!FR(a,h))return!1}else if(AI(a)||AI(h)){if(!UR(a,h))return!1}else if(a!==h)return!1}return!0}detach(){return this.graph.disconnectParents(this,e=>e.propertyType!=="Root"),this}listParents(){return this.graph.listParents(this)}}class _f extends XD{getDefaults(){return Object.assign(super.getDefaults(),{extensions:{}})}getExtension(e){return this.getRefMap("extensions",e)}setExtension(e,i){return i&&i.t(this),this.setRefMap("extensions",e,i)}listExtensions(){return this.listRefMapValues("extensions")}}class us extends _f{constructor(...e){super(...e),this.i=$l.identity,this.o=$l.identity}init(){this.propertyType=Yr.ACCESSOR}getDefaults(){return Object.assign(super.getDefaults(),{array:null,type:us.Type.SCALAR,componentType:us.ComponentType.FLOAT,normalized:!1,buffer:null})}copy(e,i=L_){return super.copy(e,i),this.i=e.i,this.o=e.o,this}static getElementSize(e){switch(e){case us.Type.SCALAR:return 1;case us.Type.VEC2:return 2;case us.Type.VEC3:return 3;case us.Type.VEC4:case us.Type.MAT2:return 4;case us.Type.MAT3:return 9;case us.Type.MAT4:return 16;default:throw new Error("Unexpected type: "+e)}}static getComponentSize(e){switch(e){case us.ComponentType.BYTE:case us.ComponentType.UNSIGNED_BYTE:return 1;case us.ComponentType.SHORT:case us.ComponentType.UNSIGNED_SHORT:return 2;case us.ComponentType.UNSIGNED_INT:case us.ComponentType.FLOAT:return 4;default:throw new Error("Unexpected component type: "+e)}}getMinNormalized(e){const i=this.getElementSize();this.getMin(e);for(let s=0;s<i;s++)e[s]=this.o(e[s]);return e}getMin(e){const i=this.get("array"),s=this.getCount(),a=this.getElementSize();for(let h=0;h<a;h++)e[h]=1/0;for(let h=0;h<s*a;h+=a)for(let d=0;d<a;d++){const _=i[h+d];Number.isFinite(_)&&(e[d]=Math.min(e[d],_))}return e}getMaxNormalized(e){const i=this.getElementSize();this.getMax(e);for(let s=0;s<i;s++)e[s]=this.o(e[s]);return e}getMax(e){const i=this.get("array"),s=this.getCount(),a=this.getElementSize();for(let h=0;h<a;h++)e[h]=-1/0;for(let h=0;h<s*a;h+=a)for(let d=0;d<a;d++){const _=i[h+d];Number.isFinite(_)&&(e[d]=Math.max(e[d],_))}return e}getCount(){const e=this.get("array");return e?e.length/this.getElementSize():0}getType(){return this.get("type")}setType(e){return this.set("type",e)}getElementSize(){return us.getElementSize(this.get("type"))}getComponentSize(){return this.get("array").BYTES_PER_ELEMENT}getComponentType(){return this.get("componentType")}getNormalized(){return this.get("normalized")}setNormalized(e){return this.set("normalized",e),e?(this.o=i=>$l.denormalize(i,this.get("componentType")),this.i=i=>$l.normalize(i,this.get("componentType"))):(this.o=$l.identity,this.i=$l.identity),this}getScalar(e){const i=this.getElementSize();return this.o(this.get("array")[e*i])}setScalar(e,i){return this.get("array")[e*this.getElementSize()]=this.i(i),this}getElement(e,i){const s=this.getElementSize(),a=this.get("array");for(let h=0;h<s;h++)i[h]=this.o(a[e*s+h]);return i}setElement(e,i){const s=this.getElementSize(),a=this.get("array");for(let h=0;h<s;h++)a[e*s+h]=this.i(i[h]);return this}getBuffer(){return this.getRef("buffer")}setBuffer(e){return this.setRef("buffer",e)}getArray(){return this.get("array")}setArray(e){return this.set("componentType",e?function(i){switch(i.constructor){case Float32Array:return us.ComponentType.FLOAT;case Uint32Array:return us.ComponentType.UNSIGNED_INT;case Uint16Array:return us.ComponentType.UNSIGNED_SHORT;case Uint8Array:return us.ComponentType.UNSIGNED_BYTE;case Int16Array:return us.ComponentType.SHORT;case Int8Array:return us.ComponentType.BYTE;default:throw new Error("Unknown accessor componentType.")}}(e):us.ComponentType.FLOAT),this.set("array",e),this}getByteLength(){const e=this.get("array");return e?e.byteLength:0}}us.Type={SCALAR:"SCALAR",VEC2:"VEC2",VEC3:"VEC3",VEC4:"VEC4",MAT2:"MAT2",MAT3:"MAT3",MAT4:"MAT4"},us.ComponentType={BYTE:5120,UNSIGNED_BYTE:5121,SHORT:5122,UNSIGNED_SHORT:5123,UNSIGNED_INT:5125,FLOAT:5126};class VR extends _f{init(){this.propertyType=Yr.ANIMATION}getDefaults(){return Object.assign(super.getDefaults(),{channels:[],samplers:[]})}addChannel(e){return this.addRef("channels",e)}removeChannel(e){return this.removeRef("channels",e)}listChannels(){return this.listRefs("channels")}addSampler(e){return this.addRef("samplers",e)}removeSampler(e){return this.removeRef("samplers",e)}listSamplers(){return this.listRefs("samplers")}}class KD extends _f{init(){this.propertyType=Yr.ANIMATION_CHANNEL}getDefaults(){return Object.assign(super.getDefaults(),{targetPath:null,targetNode:null,sampler:null})}getTargetPath(){return this.get("targetPath")}setTargetPath(e){return this.set("targetPath",e)}getTargetNode(){return this.getRef("targetNode")}setTargetNode(e){return this.setRef("targetNode",e)}getSampler(){return this.getRef("sampler")}setSampler(e){return this.setRef("sampler",e)}}KD.TargetPath={TRANSLATION:"translation",ROTATION:"rotation",SCALE:"scale",WEIGHTS:"weights"};class eS extends _f{init(){this.propertyType=Yr.ANIMATION_SAMPLER}getDefaultAttributes(){return Object.assign(super.getDefaults(),{interpolation:eS.Interpolation.LINEAR,input:null,output:null})}getInterpolation(){return this.get("interpolation")}setInterpolation(e){return this.set("interpolation",e)}getInput(){return this.getRef("input")}setInput(e){return this.setRef("input",e,{usage:V0.OTHER})}getOutput(){return this.getRef("output")}setOutput(e){return this.setRef("output",e,{usage:V0.OTHER})}}eS.Interpolation={LINEAR:"LINEAR",STEP:"STEP",CUBICSPLINE:"CUBICSPLINE"};class QR extends _f{init(){this.propertyType=Yr.BUFFER}getDefaults(){return Object.assign(super.getDefaults(),{uri:""})}getURI(){return this.get("uri")}setURI(e){return this.set("uri",e)}}class Kx extends _f{init(){this.propertyType=Yr.CAMERA}getDefaults(){return Object.assign(super.getDefaults(),{type:Kx.Type.PERSPECTIVE,znear:.1,zfar:100,aspectRatio:null,yfov:2*Math.PI*50/360,xmag:1,ymag:1})}getType(){return this.get("type")}setType(e){return this.set("type",e)}getZNear(){return this.get("znear")}setZNear(e){return this.set("znear",e)}getZFar(){return this.get("zfar")}setZFar(e){return this.set("zfar",e)}getAspectRatio(){return this.get("aspectRatio")}setAspectRatio(e){return this.set("aspectRatio",e)}getYFov(){return this.get("yfov")}setYFov(e){return this.set("yfov",e)}getXMag(){return this.get("xmag")}setXMag(e){return this.set("xmag",e)}getYMag(){return this.get("ymag")}setYMag(e){return this.set("ymag",e)}}Kx.Type={PERSPECTIVE:"perspective",ORTHOGRAPHIC:"orthographic"};class uu extends XD{t(e){if(!this.parentTypes.includes(e.propertyType))throw new Error(`Parent "${e.propertyType}" invalid for child "${this.propertyType}".`)}}uu.EXTENSION_NAME=void 0;class Rl extends _f{init(){this.propertyType=Yr.TEXTURE_INFO}getDefaults(){return Object.assign(super.getDefaults(),{texCoord:0,magFilter:null,minFilter:null,wrapS:Rl.WrapMode.REPEAT,wrapT:Rl.WrapMode.REPEAT})}getTexCoord(){return this.get("texCoord")}setTexCoord(e){return this.set("texCoord",e)}getMagFilter(){return this.get("magFilter")}setMagFilter(e){return this.set("magFilter",e)}getMinFilter(){return this.get("minFilter")}setMinFilter(e){return this.set("minFilter",e)}getWrapS(){return this.get("wrapS")}setWrapS(e){return this.set("wrapS",e)}getWrapT(){return this.get("wrapT")}setWrapT(e){return this.set("wrapT",e)}}Rl.WrapMode={CLAMP_TO_EDGE:33071,MIRRORED_REPEAT:33648,REPEAT:10497},Rl.MagFilter={NEAREST:9728,LINEAR:9729},Rl.MinFilter={NEAREST:9728,LINEAR:9729,NEAREST_MIPMAP_NEAREST:9984,LINEAR_MIPMAP_NEAREST:9985,NEAREST_MIPMAP_LINEAR:9986,LINEAR_MIPMAP_LINEAR:9987};const{R:yI,G:wI,B:xI,A:jL}=cu;class Jx extends _f{init(){this.propertyType=Yr.MATERIAL}getDefaults(){return Object.assign(super.getDefaults(),{alphaMode:Jx.AlphaMode.OPAQUE,alphaCutoff:.5,doubleSided:!1,baseColorFactor:[1,1,1,1],baseColorTexture:null,baseColorTextureInfo:new Rl(this.graph,"baseColorTextureInfo"),emissiveFactor:[0,0,0],emissiveTexture:null,emissiveTextureInfo:new Rl(this.graph,"emissiveTextureInfo"),normalScale:1,normalTexture:null,normalTextureInfo:new Rl(this.graph,"normalTextureInfo"),occlusionStrength:1,occlusionTexture:null,occlusionTextureInfo:new Rl(this.graph,"occlusionTextureInfo"),roughnessFactor:1,metallicFactor:1,metallicRoughnessTexture:null,metallicRoughnessTextureInfo:new Rl(this.graph,"metallicRoughnessTextureInfo")})}getDoubleSided(){return this.get("doubleSided")}setDoubleSided(e){return this.set("doubleSided",e)}getAlpha(){return this.get("baseColorFactor")[3]}setAlpha(e){const i=this.get("baseColorFactor").slice();return i[3]=e,this.set("baseColorFactor",i)}getAlphaMode(){return this.get("alphaMode")}setAlphaMode(e){return this.set("alphaMode",e)}getAlphaCutoff(){return this.get("alphaCutoff")}setAlphaCutoff(e){return this.set("alphaCutoff",e)}getBaseColorFactor(){return this.get("baseColorFactor")}setBaseColorFactor(e){return this.set("baseColorFactor",e)}getBaseColorHex(){return Tm.factorToHex(this.get("baseColorFactor"))}setBaseColorHex(e){const i=this.get("baseColorFactor").slice();return this.set("baseColorFactor",Tm.hexToFactor(e,i))}getBaseColorTexture(){return this.getRef("baseColorTexture")}getBaseColorTextureInfo(){return this.getRef("baseColorTexture")?this.getRef("baseColorTextureInfo"):null}setBaseColorTexture(e){return this.setRef("baseColorTexture",e,{channels:yI|wI|xI|jL})}getEmissiveFactor(){return this.get("emissiveFactor")}setEmissiveFactor(e){return this.set("emissiveFactor",e)}getEmissiveHex(){return Tm.factorToHex(this.get("emissiveFactor"))}setEmissiveHex(e){const i=this.get("emissiveFactor").slice();return this.set("emissiveFactor",Tm.hexToFactor(e,i))}getEmissiveTexture(){return this.getRef("emissiveTexture")}getEmissiveTextureInfo(){return this.getRef("emissiveTexture")?this.getRef("emissiveTextureInfo"):null}setEmissiveTexture(e){return this.setRef("emissiveTexture",e,{channels:yI|wI|xI})}getNormalScale(){return this.get("normalScale")}setNormalScale(e){return this.set("normalScale",e)}getNormalTexture(){return this.getRef("normalTexture")}getNormalTextureInfo(){return this.getRef("normalTexture")?this.getRef("normalTextureInfo"):null}setNormalTexture(e){return this.setRef("normalTexture",e,{channels:yI|wI|xI})}getOcclusionStrength(){return this.get("occlusionStrength")}setOcclusionStrength(e){return this.set("occlusionStrength",e)}getOcclusionTexture(){return this.getRef("occlusionTexture")}getOcclusionTextureInfo(){return this.getRef("occlusionTexture")?this.getRef("occlusionTextureInfo"):null}setOcclusionTexture(e){return this.setRef("occlusionTexture",e,{channels:yI})}getRoughnessFactor(){return this.get("roughnessFactor")}setRoughnessFactor(e){return this.set("roughnessFactor",e)}getMetallicFactor(){return this.get("metallicFactor")}setMetallicFactor(e){return this.set("metallicFactor",e)}getMetallicRoughnessTexture(){return this.getRef("metallicRoughnessTexture")}getMetallicRoughnessTextureInfo(){return this.getRef("metallicRoughnessTexture")?this.getRef("metallicRoughnessTextureInfo"):null}setMetallicRoughnessTexture(e){return this.setRef("metallicRoughnessTexture",e,{channels:wI|xI})}}Jx.AlphaMode={OPAQUE:"OPAQUE",MASK:"MASK",BLEND:"BLEND"};class GR extends _f{init(){this.propertyType=Yr.MESH}getDefaults(){return Object.assign(super.getDefaults(),{weights:[],primitives:[]})}addPrimitive(e){return this.addRef("primitives",e)}removePrimitive(e){return this.removeRef("primitives",e)}listPrimitives(){return this.listRefs("primitives")}getWeights(){return this.get("weights")}setWeights(e){return this.set("weights",e)}}class bI extends _f{constructor(...e){super(...e),this.u=null}init(){this.propertyType=Yr.NODE}getDefaults(){return Object.assign(super.getDefaults(),{translation:[0,0,0],rotation:[0,0,0,1],scale:[1,1,1],weights:[],camera:null,mesh:null,skin:null,children:[]})}copy(e,i=L_){if(i===L_)throw new Error("Node cannot be copied.");return super.copy(e,i)}getTranslation(){return this.get("translation")}getRotation(){return this.get("rotation")}getScale(){return this.get("scale")}setTranslation(e){return this.set("translation",e)}setRotation(e){return this.set("rotation",e)}setScale(e){return this.set("scale",e)}getMatrix(){return $l.compose(this.get("translation"),this.get("rotation"),this.get("scale"),[])}setMatrix(e){const i=this.get("translation").slice(),s=this.get("rotation").slice(),a=this.get("scale").slice();return $l.decompose(e,i,s,a),this.set("translation",i).set("rotation",s).set("scale",a)}getWorldTranslation(){const e=[0,0,0];return $l.decompose(this.getWorldMatrix(),e,[0,0,0,1],[1,1,1]),e}getWorldRotation(){const e=[0,0,0,1];return $l.decompose(this.getWorldMatrix(),[0,0,0],e,[1,1,1]),e}getWorldScale(){const e=[1,1,1];return $l.decompose(this.getWorldMatrix(),[0,0,0],[0,0,0,1],e),e}getWorldMatrix(){const e=[];for(let a=this;a instanceof bI;a=a.u)e.push(a);let i;const s=e.pop().getMatrix();for(;i=e.pop();)RL(s,s,i.getMatrix());return s}addChild(e){e.u&&e.u.removeChild(e),this.addRef("children",e),e.u=this;const i=this[Zo].children;return i[i.length-1].addEventListener("dispose",()=>e.u=null),this}removeChild(e){return this.removeRef("children",e)}listChildren(){return this.listRefs("children")}getParent(){return this.u}getMesh(){return this.getRef("mesh")}setMesh(e){return this.setRef("mesh",e)}getCamera(){return this.getRef("camera")}setCamera(e){return this.setRef("camera",e)}getSkin(){return this.getRef("skin")}setSkin(e){return this.setRef("skin",e)}getWeights(){return this.get("weights")}setWeights(e){return this.set("weights",e)}traverse(e){e(this);for(const i of this.listChildren())i.traverse(e);return this}}class Zx extends _f{init(){this.propertyType=Yr.PRIMITIVE}getDefaults(){return Object.assign(super.getDefaults(),{mode:Zx.Mode.TRIANGLES,material:null,indices:null,attributes:{},targets:[]})}getIndices(){return this.getRef("indices")}setIndices(e){return this.setRef("indices",e,{usage:V0.ELEMENT_ARRAY_BUFFER})}getAttribute(e){return this.getRefMap("attributes",e)}setAttribute(e,i){return this.setRefMap("attributes",e,i,{usage:V0.ARRAY_BUFFER})}listAttributes(){return this.listRefMapValues("attributes")}listSemantics(){return this.listRefMapKeys("attributes")}getMaterial(){return this.getRef("material")}setMaterial(e){return this.setRef("material",e)}getMode(){return this.get("mode")}setMode(e){return this.set("mode",e)}listTargets(){return this.listRefs("targets")}addTarget(e){return this.addRef("targets",e)}removeTarget(e){return this.removeRef("targets",e)}}Zx.Mode={POINTS:0,LINES:1,LINE_LOOP:2,LINE_STRIP:3,TRIANGLES:4,TRIANGLE_STRIP:5,TRIANGLE_FAN:6};class zL extends XD{init(){this.propertyType=Yr.PRIMITIVE_TARGET}getDefaults(){return Object.assign(super.getDefaults(),{attributes:{}})}getAttribute(e){return this.getRefMap("attributes",e)}setAttribute(e,i){return this.setRefMap("attributes",e,i,{usage:V0.ARRAY_BUFFER})}listAttributes(){return this.listRefMapValues("attributes")}listSemantics(){return this.listRefMapKeys("attributes")}}function Im(){return(Im=Object.assign||function(c){for(var e=1;e<arguments.length;e++){var i=arguments[e];for(var s in i)Object.prototype.hasOwnProperty.call(i,s)&&(c[s]=i[s])}return c}).apply(this,arguments)}class HR extends _f{init(){this.propertyType=Yr.SCENE}getDefaults(){return Object.assign(super.getDefaults(),{children:[]})}copy(e,i=L_){if(i===L_)throw new Error("Scene cannot be copied.");return super.copy(e,i)}addChild(e){e.u&&e.u.removeChild(e),this.addRef("children",e),e.u=this;const i=this[Zo].children;return i[i.length-1].addEventListener("dispose",()=>e.u=null),this}removeChild(e){return this.removeRef("children",e)}listChildren(){return this.listRefs("children")}traverse(e){for(const i of this.listChildren())i.traverse(e);return this}}class WR extends _f{init(){this.propertyType=Yr.SKIN}getDefaults(){return Object.assign(super.getDefaults(),{skeleton:null,inverseBindMatrices:null,joints:[]})}getSkeleton(){return this.getRef("skeleton")}setSkeleton(e){return this.setRef("skeleton",e)}getInverseBindMatrices(){return this.getRef("inverseBindMatrices")}setInverseBindMatrices(e){return this.setRef("inverseBindMatrices",e,{usage:V0.INVERSE_BIND_MATRICES})}addJoint(e){return this.addRef("joints",e)}removeJoint(e){return this.removeRef("joints",e)}listJoints(){return this.listRefs("joints")}}class qR extends _f{init(){this.propertyType=Yr.TEXTURE}getDefaults(){return Object.assign(super.getDefaults(),{image:null,mimeType:"",uri:""})}getMimeType(){return this.get("mimeType")||ay.extensionToMimeType(Xx.extension(this.get("uri")))}setMimeType(e){return this.set("mimeType",e)}getURI(){return this.get("uri")}setURI(e){return this.set("uri",e),this.set("mimeType",ay.extensionToMimeType(Xx.extension(e))),this}getImage(){return this.get("image")}setImage(e){return this.set("image",fo.assertView(e))}getSize(){const e=this.get("image");return e?ay.getSize(e,this.getMimeType()):null}}class YR extends _f{init(){this.propertyType=Yr.ROOT}getDefaults(){return Object.assign(super.getDefaults(),{asset:{generator:"glTF-Transform v2.2.3",version:"2.0"},defaultScene:null,accessors:[],animations:[],buffers:[],cameras:[],materials:[],meshes:[],nodes:[],scenes:[],skins:[],textures:[]})}constructor(e){super(e),this.h=new Set,e.addEventListener("node:create",i=>{this.l(i.target)})}clone(){throw new Error("Root cannot be cloned.")}copy(e,i=L_){if(i===L_)throw new Error("Root cannot be copied.");this.set("asset",Im({},e.get("asset"))),this.setName(e.getName()),this.setExtras(Im({},e.getExtras())),this.setDefaultScene(e.getDefaultScene()?i(e.getDefaultScene()):null);for(const s of e.listRefMapKeys("extensions")){const a=e.getExtension(s);this.setExtension(s,i(a))}return this}l(e){return e instanceof HR?this.addRef("scenes",e):e instanceof bI?this.addRef("nodes",e):e instanceof Kx?this.addRef("cameras",e):e instanceof WR?this.addRef("skins",e):e instanceof GR?this.addRef("meshes",e):e instanceof Jx?this.addRef("materials",e):e instanceof qR?this.addRef("textures",e):e instanceof VR?this.addRef("animations",e):e instanceof us?this.addRef("accessors",e):e instanceof QR&&this.addRef("buffers",e),this}getAsset(){return this.get("asset")}listExtensionsUsed(){return Array.from(this.h)}listExtensionsRequired(){return this.listExtensionsUsed().filter(e=>e.isRequired())}g(e){return this.h.add(e),this}p(e){return this.h.delete(e),this}listScenes(){return this.listRefs("scenes")}setDefaultScene(e){return this.setRef("defaultScene",e)}getDefaultScene(){return this.getRef("defaultScene")}listNodes(){return this.listRefs("nodes")}listCameras(){return this.listRefs("cameras")}listSkins(){return this.listRefs("skins")}listMeshes(){return this.listRefs("meshes")}listMaterials(){return this.listRefs("materials")}listTextures(){return this.listRefs("textures")}listAnimations(){return this.listRefs("animations")}listAccessors(){return this.listRefs("accessors")}listBuffers(){return this.listRefs("buffers")}}class JD{constructor(){this.m=new DL,this.T=new YR(this.m),this.v=dv.DEFAULT_INSTANCE}getRoot(){return this.T}getGraph(){return this.m}getLogger(){return this.v}setLogger(e){return this.v=e,this}clone(){return new JD().setLogger(this.v).merge(this)}merge(e){for(const h of e.getRoot().listExtensionsUsed()){const d=this.createExtension(h.constructor);h.isRequired()&&d.setRequired(!0)}const i=new Set,s=new Map;i.add(e.T),s.set(e.T,this.T);for(const h of e.m.listEdges())for(const d of[h.getParent(),h.getChild()]){if(i.has(d))continue;let _;_=d.propertyType===Yr.TEXTURE_INFO?d:new d.constructor(this.m),s.set(d,_),i.add(d)}const a=h=>{const d=s.get(h);if(!d)throw new Error("Could resolve property.");return d};for(const h of i){const d=s.get(h);if(!d)throw new Error("Could resolve property.");d.propertyType!==Yr.TEXTURE_INFO&&d.copy(h,a)}return this}async transform(...e){const i=e.map(s=>s.name);for(const s of e)await s(this,{stack:i});return this}createExtension(e){const i=e.EXTENSION_NAME;return this.getRoot().listExtensionsUsed().find(s=>s.extensionName===i)||new e(this)}createScene(e=""){return new HR(this.m,e)}createNode(e=""){return new bI(this.m,e)}createCamera(e=""){return new Kx(this.m,e)}createSkin(e=""){return new WR(this.m,e)}createMesh(e=""){return new GR(this.m,e)}createPrimitive(){return new Zx(this.m)}createPrimitiveTarget(e=""){return new zL(this.m,e)}createMaterial(e=""){return new Jx(this.m,e)}createTexture(e=""){return new qR(this.m,e)}createAnimation(e=""){return new VR(this.m,e)}createAnimationChannel(e=""){return new KD(this.m,e)}createAnimationSampler(e=""){return new eS(this.m,e)}createAccessor(e="",i=null){return i||(i=this.getRoot().listBuffers()[0]),new us(this.m,e).setBuffer(i)}createBuffer(e=""){return new QR(this.m,e)}}class Ql{constructor(e){this.extensionName="",this.prereadTypes=[],this.prewriteTypes=[],this.readDependencies=[],this.writeDependencies=[],this.document=void 0,this.required=!1,this.properties=new Set,this.S=void 0,this.document=e,e.getRoot().g(this),this.S=s=>{const a=s,h=a.target;h instanceof uu&&h.extensionName===this.extensionName&&(a.type==="node:create"&&this.M(h),a.type==="node:dispose"&&this.I(h))};const i=e.getGraph();i.addEventListener("node:create",this.S),i.addEventListener("node:dispose",this.S)}dispose(){this.document.getRoot().p(this);const e=this.document.getGraph();e.removeEventListener("node:create",this.S),e.removeEventListener("node:dispose",this.S);for(const i of this.properties)i.dispose()}static register(){}isRequired(){return this.required}setRequired(e){return this.required=e,this}M(e){return this.properties.add(e),this}I(e){return this.properties.delete(e),this}install(e,i){return this}preread(e,i){return this}prewrite(e,i){return this}}Ql.EXTENSION_NAME=void 0;class VL{constructor(e){this.jsonDoc=void 0,this.buffers=[],this.bufferViews=[],this.bufferViewBuffers=[],this.accessors=[],this.textures=[],this.textureInfos=new Map,this.materials=[],this.meshes=[],this.cameras=[],this.nodes=[],this.skins=[],this.animations=[],this.scenes=[],this.jsonDoc=e}setTextureInfo(e,i){this.textureInfos.set(e,i),i.texCoord!==void 0&&e.setTexCoord(i.texCoord);const s=this.jsonDoc.json.textures[i.index];if(s.sampler===void 0)return;const a=this.jsonDoc.json.samplers[s.sampler];a.magFilter!==void 0&&e.setMagFilter(a.magFilter),a.minFilter!==void 0&&e.setMinFilter(a.minFilter),a.wrapS!==void 0&&e.setWrapS(a.wrapS),a.wrapT!==void 0&&e.setWrapT(a.wrapT)}}const ZD={5120:Int8Array,5121:Uint8Array,5122:Int16Array,5123:Uint16Array,5125:Uint32Array,5126:Float32Array},XR={logger:dv.DEFAULT_INSTANCE,extensions:[],dependencies:{}};function EI(c,e){const i=e.bufferViews[c.bufferView],s=e.jsonDoc.json.bufferViews[c.bufferView],a=ZD[c.componentType],h=us.getElementSize(c.type),d=a.BYTES_PER_ELEMENT;if(s.byteStride!==void 0&&s.byteStride!==h*d)return function(et,nt){const it=nt.bufferViews[et.bufferView],lt=nt.jsonDoc.json.bufferViews[et.bufferView],ut=ZD[et.componentType],pt=us.getElementSize(et.type),gt=ut.BYTES_PER_ELEMENT,vt=et.byteOffset||0,Ct=new ut(et.count*pt),wt=new DataView(it.buffer,it.byteOffset,it.byteLength),xt=lt.byteStride;for(let _t=0;_t<et.count;_t++)for(let Pt=0;Pt<pt;Pt++){const Bt=vt+_t*xt+Pt*gt;let Ot;switch(et.componentType){case us.ComponentType.FLOAT:Ot=wt.getFloat32(Bt,!0);break;case us.ComponentType.UNSIGNED_INT:Ot=wt.getUint32(Bt,!0);break;case us.ComponentType.UNSIGNED_SHORT:Ot=wt.getUint16(Bt,!0);break;case us.ComponentType.UNSIGNED_BYTE:Ot=wt.getUint8(Bt);break;case us.ComponentType.SHORT:Ot=wt.getInt16(Bt,!0);break;case us.ComponentType.BYTE:Ot=wt.getInt8(Bt);break;default:throw new Error(`Unexpected componentType "${et.componentType}".`)}Ct[_t*pt+Pt]=Ot}return Ct}(c,e);const _=i.byteOffset+(c.byteOffset||0);return new a(i.buffer.slice(_,_+c.count*h*d))}var iM;(function(c){c[c.ARRAY_BUFFER=34962]="ARRAY_BUFFER",c[c.ELEMENT_ARRAY_BUFFER=34963]="ELEMENT_ARRAY_BUFFER"})(iM||(iM={}));class $v{constructor(e,i,s){this.N=void 0,this.jsonDoc=void 0,this.options=void 0,this.accessorIndexMap=new Map,this.animationIndexMap=new Map,this.bufferIndexMap=new Map,this.cameraIndexMap=new Map,this.skinIndexMap=new Map,this.materialIndexMap=new Map,this.meshIndexMap=new Map,this.nodeIndexMap=new Map,this.imageIndexMap=new Map,this.textureDefIndexMap=new Map,this.textureInfoDefMap=new Map,this.samplerDefIndexMap=new Map,this.sceneIndexMap=new Map,this.imageBufferViews=[],this.otherBufferViews=new Map,this.otherBufferViewsIndexMap=new Map,this.extensionData={},this.bufferURIGenerator=void 0,this.imageURIGenerator=void 0,this.logger=void 0,this.O=new Map,this.accessorUsageGroupedByParent=new Set(["ARRAY_BUFFER"]),this.accessorParents=new Map,this.N=e,this.jsonDoc=i,this.options=s;const a=e.getRoot(),h=a.listBuffers().length,d=a.listTextures().length;this.bufferURIGenerator=new KR(h>1,s.basename),this.imageURIGenerator=new KR(d>1,s.basename),this.logger=e.getLogger()}createTextureInfoDef(e,i){const s={magFilter:i.getMagFilter()||void 0,minFilter:i.getMinFilter()||void 0,wrapS:i.getWrapS(),wrapT:i.getWrapT()},a=JSON.stringify(s);this.samplerDefIndexMap.has(a)||(this.samplerDefIndexMap.set(a,this.jsonDoc.json.samplers.length),this.jsonDoc.json.samplers.push(s));const h={source:this.imageIndexMap.get(e),sampler:this.samplerDefIndexMap.get(a)},d=JSON.stringify(h);this.textureDefIndexMap.has(d)||(this.textureDefIndexMap.set(d,this.jsonDoc.json.textures.length),this.jsonDoc.json.textures.push(h));const _={index:this.textureDefIndexMap.get(d)};return i.getTexCoord()!==0&&(_.texCoord=i.getTexCoord()),this.textureInfoDefMap.set(i,_),_}createPropertyDef(e){const i={};return e.getName()&&(i.name=e.getName()),Object.keys(e.getExtras()).length>0&&(i.extras=e.getExtras()),i}createAccessorDef(e){const i=this.createPropertyDef(e);return i.type=e.getType(),i.componentType=e.getComponentType(),i.count=e.getCount(),this.N.getGraph().listParentEdges(e).some(s=>s.getName()==="attributes"&&s.getAttributes().key==="POSITION"||s.getName()==="input")&&(i.max=e.getMax([]).map(Math.fround),i.min=e.getMin([]).map(Math.fround)),e.getNormalized()&&(i.normalized=e.getNormalized()),i}createImageData(e,i,s){if(this.options.format===Zv.GLB)this.imageBufferViews.push(i),e.bufferView=this.jsonDoc.json.bufferViews.length,this.jsonDoc.json.bufferViews.push({buffer:0,byteOffset:-1,byteLength:i.byteLength});else{const a=ay.mimeTypeToExtension(s.getMimeType());e.uri=this.imageURIGenerator.createURI(s,a),this.jsonDoc.resources[e.uri]=i}}getAccessorUsage(e){const i=this.O.get(e);if(i)return i;for(const s of this.N.getGraph().listParentEdges(e)){const{usage:a}=s.getAttributes();if(a)return a;s.getParent().propertyType!==Yr.ROOT&&this.N.getLogger().warn(`Missing attribute ".usage" on edge, "${s.getName()}".`)}return $v.BufferViewUsage.OTHER}addAccessorToUsageGroup(e,i){const s=this.O.get(e);if(s&&s!==i)throw new Error(`Accessor with usage "${s}" cannot be reused as "${i}".`);return this.O.set(e,i),this}listAccessorUsageGroups(){const e={};for(const[i,s]of Array.from(this.O.entries()))e[s]=e[s]||[],e[s].push(i);return e}}$v.BufferViewTarget=iM,$v.BufferViewUsage=V0,$v.USAGE_TO_TARGET={[V0.ARRAY_BUFFER]:iM.ARRAY_BUFFER,[V0.ELEMENT_ARRAY_BUFFER]:iM.ELEMENT_ARRAY_BUFFER};class KR{constructor(e,i){this.multiple=void 0,this.basename=void 0,this.counter=1,this.multiple=e,this.basename=i}createURI(e,i){return e.getURI()?e.getURI():this.multiple?`${this.basename}_${this.counter++}.${i}`:`${this.basename}.${i}`}}const{BufferViewUsage:$D}=$v;var SI;(function(c){c[c.JSON=1313821514]="JSON",c[c.BIN=5130562]="BIN"})(SI||(SI={}));class QL extends class{constructor(){this.v=dv.DEFAULT_INSTANCE,this.h=new Set,this.C={},this.F=vI.INTERLEAVED,this.lastReadBytes=0,this.lastWriteBytes=0}setLogger(e){return this.v=e,this}registerExtensions(e){for(const i of e)this.h.add(i),i.register();return this}registerDependencies(e){return Object.assign(this.C,e),this}setVertexLayout(e){return this.F=e,this}async read(e){return await this.readJSON(await this.readAsJSON(e))}async readAsJSON(e){return e.match(/^data:application\/octet-stream;/)||this.detectFormat(e)===Zv.GLB?this.U(e):this.P(e)}async readJSON(e){return e=this.j(e),this.L(e),class{static read(i,s=XR){const a=Im({},XR,s),{json:h}=i,d=new JD;this.validate(i,a);const _=new VL(i),et=h.asset,nt=d.getRoot().getAsset();et.copyright&&(nt.copyright=et.copyright),et.extras&&(nt.extras=et.extras),h.extras!==void 0&&d.getRoot().setExtras(Im({},h.extras));const it=h.extensionsUsed||[],lt=h.extensionsRequired||[];for(const xt of a.extensions)if(it.includes(xt.EXTENSION_NAME)){const _t=d.createExtension(xt).setRequired(lt.includes(xt.EXTENSION_NAME));for(const Pt of _t.readDependencies)_t.install(Pt,a.dependencies[Pt])}const ut=h.buffers||[];d.getRoot().listExtensionsUsed().filter(xt=>xt.prereadTypes.includes(Yr.BUFFER)).forEach(xt=>xt.preread(_,Yr.BUFFER)),_.buffers=ut.map(xt=>{const _t=d.createBuffer(xt.name);return xt.extras&&_t.setExtras(xt.extras),xt.uri&&xt.uri.indexOf("__")!==0&&_t.setURI(xt.uri),_t}),_.bufferViewBuffers=(h.bufferViews||[]).map((xt,_t)=>{if(!_.bufferViews[_t]){const Pt=i.json.buffers[xt.buffer];_.bufferViews[_t]=fo.toView(Pt.uri?i.resources[Pt.uri]:i.resources["@glb.bin"],xt.byteOffset||0,xt.byteLength)}return _.buffers[xt.buffer]}),_.accessors=(h.accessors||[]).map(xt=>{const _t=d.createAccessor(xt.name,_.bufferViewBuffers[xt.bufferView]).setType(xt.type);if(xt.extras&&_t.setExtras(xt.extras),xt.normalized!==void 0&&_t.setNormalized(xt.normalized),xt.bufferView===void 0&&!xt.sparse)return _t;let Pt;return Pt=xt.sparse!==void 0?function(Bt,Ot){const Lt=ZD[Bt.componentType],qt=us.getElementSize(Bt.type);let en;en=Bt.bufferView!==void 0?EI(Bt,Ot):new Lt(Bt.count*qt);const cn=Bt.sparse,An=cn.count,mn=Im({},Bt,cn.indices,{count:An,type:"SCALAR"}),Tn=Im({},Bt,cn.values,{count:An}),vn=EI(mn,Ot),xn=EI(Tn,Ot);for(let Un=0;Un<mn.count;Un++)for(let Mn=0;Mn<qt;Mn++)en[vn[Un]*qt+Mn]=xn[Un*qt+Mn];return en}(xt,_):EI(xt,_),_t.setArray(Pt),_t});const pt=h.images||[],gt=h.textures||[];d.getRoot().listExtensionsUsed().filter(xt=>xt.prereadTypes.includes(Yr.TEXTURE)).forEach(xt=>xt.preread(_,Yr.TEXTURE)),_.textures=pt.map(xt=>{const _t=d.createTexture(xt.name);if(xt.extras&&_t.setExtras(xt.extras),xt.bufferView!==void 0){const Pt=h.bufferViews[xt.bufferView],Bt=i.json.buffers[Pt.buffer],Ot=Pt.byteOffset||0,Lt=(Bt.uri?i.resources[Bt.uri]:i.resources["@glb.bin"]).slice(Ot,Ot+Pt.byteLength);_t.setImage(Lt)}else xt.uri!==void 0&&(_t.setImage(i.resources[xt.uri]),xt.uri.indexOf("__")!==0&&_t.setURI(xt.uri));if(xt.mimeType!==void 0)_t.setMimeType(xt.mimeType);else if(xt.uri){const Pt=Xx.extension(xt.uri);_t.setMimeType(ay.extensionToMimeType(Pt))}return _t}),_.materials=(h.materials||[]).map(xt=>{const _t=d.createMaterial(xt.name);xt.extras&&_t.setExtras(xt.extras),xt.alphaMode!==void 0&&_t.setAlphaMode(xt.alphaMode),xt.alphaCutoff!==void 0&&_t.setAlphaCutoff(xt.alphaCutoff),xt.doubleSided!==void 0&&_t.setDoubleSided(xt.doubleSided);const Pt=xt.pbrMetallicRoughness||{};if(Pt.baseColorFactor!==void 0&&_t.setBaseColorFactor(Pt.baseColorFactor),xt.emissiveFactor!==void 0&&_t.setEmissiveFactor(xt.emissiveFactor),Pt.metallicFactor!==void 0&&_t.setMetallicFactor(Pt.metallicFactor),Pt.roughnessFactor!==void 0&&_t.setRoughnessFactor(Pt.roughnessFactor),Pt.baseColorTexture!==void 0){const Bt=Pt.baseColorTexture;_t.setBaseColorTexture(_.textures[gt[Bt.index].source]),_.setTextureInfo(_t.getBaseColorTextureInfo(),Bt)}if(xt.emissiveTexture!==void 0){const Bt=xt.emissiveTexture;_t.setEmissiveTexture(_.textures[gt[Bt.index].source]),_.setTextureInfo(_t.getEmissiveTextureInfo(),Bt)}if(xt.normalTexture!==void 0){const Bt=xt.normalTexture;_t.setNormalTexture(_.textures[gt[Bt.index].source]),_.setTextureInfo(_t.getNormalTextureInfo(),Bt),xt.normalTexture.scale!==void 0&&_t.setNormalScale(xt.normalTexture.scale)}if(xt.occlusionTexture!==void 0){const Bt=xt.occlusionTexture;_t.setOcclusionTexture(_.textures[gt[Bt.index].source]),_.setTextureInfo(_t.getOcclusionTextureInfo(),Bt),xt.occlusionTexture.strength!==void 0&&_t.setOcclusionStrength(xt.occlusionTexture.strength)}if(Pt.metallicRoughnessTexture!==void 0){const Bt=Pt.metallicRoughnessTexture;_t.setMetallicRoughnessTexture(_.textures[gt[Bt.index].source]),_.setTextureInfo(_t.getMetallicRoughnessTextureInfo(),Bt)}return _t});const vt=h.meshes||[];d.getRoot().listExtensionsUsed().filter(xt=>xt.prereadTypes.includes(Yr.PRIMITIVE)).forEach(xt=>xt.preread(_,Yr.PRIMITIVE)),_.meshes=vt.map(xt=>{const _t=d.createMesh(xt.name);return xt.extras&&_t.setExtras(xt.extras),xt.weights!==void 0&&_t.setWeights(xt.weights),(xt.primitives||[]).forEach(Pt=>{const Bt=d.createPrimitive();Pt.extras&&Bt.setExtras(Pt.extras),Pt.material!==void 0&&Bt.setMaterial(_.materials[Pt.material]),Pt.mode!==void 0&&Bt.setMode(Pt.mode);for(const[Lt,qt]of Object.entries(Pt.attributes||{}))Bt.setAttribute(Lt,_.accessors[qt]);Pt.indices!==void 0&&Bt.setIndices(_.accessors[Pt.indices]);const Ot=xt.extras&&xt.extras.targetNames||[];(Pt.targets||[]).forEach((Lt,qt)=>{const en=Ot[qt]||qt.toString(),cn=d.createPrimitiveTarget(en);for(const[An,mn]of Object.entries(Lt))cn.setAttribute(An,_.accessors[mn]);Bt.addTarget(cn)}),_t.addPrimitive(Bt)}),_t}),_.cameras=(h.cameras||[]).map(xt=>{const _t=d.createCamera(xt.name).setType(xt.type);if(xt.extras&&_t.setExtras(xt.extras),xt.type===Kx.Type.PERSPECTIVE){const Pt=xt.perspective;_t.setYFov(Pt.yfov),_t.setZNear(Pt.znear),Pt.zfar!==void 0&&_t.setZFar(Pt.zfar),Pt.aspectRatio!==void 0&&_t.setAspectRatio(Pt.aspectRatio)}else{const Pt=xt.orthographic;_t.setZNear(Pt.znear).setZFar(Pt.zfar).setXMag(Pt.xmag).setYMag(Pt.ymag)}return _t});const Ct=h.nodes||[];d.getRoot().listExtensionsUsed().filter(xt=>xt.prereadTypes.includes(Yr.NODE)).forEach(xt=>xt.preread(_,Yr.NODE)),_.nodes=Ct.map(xt=>{const _t=d.createNode(xt.name);if(xt.extras&&_t.setExtras(xt.extras),xt.translation!==void 0&&_t.setTranslation(xt.translation),xt.rotation!==void 0&&_t.setRotation(xt.rotation),xt.scale!==void 0&&_t.setScale(xt.scale),xt.matrix!==void 0){const Pt=[0,0,0],Bt=[0,0,0,1],Ot=[1,1,1];$l.decompose(xt.matrix,Pt,Bt,Ot),_t.setTranslation(Pt),_t.setRotation(Bt),_t.setScale(Ot)}return xt.weights!==void 0&&_t.setWeights(xt.weights),_t}),_.skins=(h.skins||[]).map(xt=>{const _t=d.createSkin(xt.name);xt.extras&&_t.setExtras(xt.extras),xt.inverseBindMatrices!==void 0&&_t.setInverseBindMatrices(_.accessors[xt.inverseBindMatrices]),xt.skeleton!==void 0&&_t.setSkeleton(_.nodes[xt.skeleton]);for(const Pt of xt.joints)_t.addJoint(_.nodes[Pt]);return _t}),Ct.map((xt,_t)=>{const Pt=_.nodes[_t];(xt.children||[]).forEach(Bt=>Pt.addChild(_.nodes[Bt])),xt.mesh!==void 0&&Pt.setMesh(_.meshes[xt.mesh]),xt.camera!==void 0&&Pt.setCamera(_.cameras[xt.camera]),xt.skin!==void 0&&Pt.setSkin(_.skins[xt.skin])}),_.animations=(h.animations||[]).map(xt=>{const _t=d.createAnimation(xt.name);xt.extras&&_t.setExtras(xt.extras);const Pt=(xt.samplers||[]).map(Bt=>{const Ot=d.createAnimationSampler().setInput(_.accessors[Bt.input]).setOutput(_.accessors[Bt.output]).setInterpolation(Bt.interpolation||eS.Interpolation.LINEAR);return Bt.extras&&Ot.setExtras(Bt.extras),_t.addSampler(Ot),Ot});return(xt.channels||[]).forEach(Bt=>{const Ot=d.createAnimationChannel().setSampler(Pt[Bt.sampler]).setTargetPath(Bt.target.path);Bt.target.node!==void 0&&Ot.setTargetNode(_.nodes[Bt.target.node]),Bt.extras&&Ot.setExtras(Bt.extras),_t.addChannel(Ot)}),_t});const wt=h.scenes||[];return d.getRoot().listExtensionsUsed().filter(xt=>xt.prereadTypes.includes(Yr.SCENE)).forEach(xt=>xt.preread(_,Yr.SCENE)),_.scenes=wt.map(xt=>{const _t=d.createScene(xt.name);return xt.extras&&_t.setExtras(xt.extras),(xt.nodes||[]).map(Pt=>_.nodes[Pt]).forEach(Pt=>_t.addChild(Pt)),_t}),h.scene!==void 0&&d.getRoot().setDefaultScene(_.scenes[h.scene]),d.getRoot().listExtensionsUsed().forEach(xt=>xt.read(_)),d}static validate(i,s){const a=i.json;if(a.asset.version!=="2.0")throw new Error(`Unsupported glTF version, "${a.asset.version}".`);if(a.extensionsRequired){for(const h of a.extensionsRequired)if(!s.extensions.find(d=>d.EXTENSION_NAME===h))throw new Error(`Missing required extension, "${h}".`)}if(a.extensionsUsed)for(const h of a.extensionsUsed)s.extensions.find(d=>d.EXTENSION_NAME===h)||s.logger.warn(`Missing optional extension, "${h}".`)}}.read(e,{extensions:Array.from(this.h),dependencies:this.C,logger:this.v})}async binaryToJSON(e){const i=this._(fo.assertView(e));this.L(i);const s=i.json;if(s.buffers&&s.buffers.some(a=>function(h,d){return d.uri!==void 0&&!(d.uri in h.resources)}(i,a)))throw new Error("Cannot resolve external buffers with binaryToJSON().");if(s.images&&s.images.some(a=>function(h,d){return d.uri!==void 0&&!(d.uri in h.resources)&&d.bufferView===void 0}(i,a)))throw new Error("Cannot resolve external images with binaryToJSON().");return i}async readBinary(e){return this.readJSON(await this.binaryToJSON(fo.assertView(e)))}async writeJSON(e,i={}){if(i.format===Zv.GLB&&e.getRoot().listBuffers().length>1)throw new Error("GLB must have 0–1 buffers.");return class{static write(s,a){const h=s.getRoot(),d={asset:Im({generator:"glTF-Transform v2.2.3"},h.getAsset()),extras:Im({},h.getExtras())},_={json:d,resources:{}},et=new $v(s,_,a),nt=a.logger||dv.DEFAULT_INSTANCE,it=new Set(a.extensions.map(wt=>wt.EXTENSION_NAME)),lt=s.getRoot().listExtensionsUsed().filter(wt=>it.has(wt.extensionName)),ut=s.getRoot().listExtensionsRequired().filter(wt=>it.has(wt.extensionName));lt.length<s.getRoot().listExtensionsUsed().length&&nt.debug("Some extensions were not registered for I/O, and will not be written.");for(const wt of lt)for(const xt of wt.writeDependencies)wt.install(xt,a.dependencies[xt]);function pt(wt,xt,_t,Pt){const Bt=[];let Ot=0;for(const qt of wt){const en=et.createAccessorDef(qt);en.bufferView=d.bufferViews.length;const cn=qt.getArray(),An=fo.pad(fo.toView(cn));en.byteOffset=Ot,Ot+=An.byteLength,Bt.push(An),et.accessorIndexMap.set(qt,d.accessors.length),d.accessors.push(en)}const Lt={buffer:xt,byteOffset:_t,byteLength:fo.concat(Bt).byteLength};return Pt&&(Lt.target=Pt),d.bufferViews.push(Lt),{buffers:Bt,byteLength:Ot}}function gt(wt,xt,_t){const Pt=wt[0].getCount();let Bt=0;for(const en of wt){const cn=et.createAccessorDef(en);cn.bufferView=d.bufferViews.length,cn.byteOffset=Bt;const An=en.getElementSize(),mn=en.getComponentSize();Bt+=fo.padNumber(An*mn),et.accessorIndexMap.set(en,d.accessors.length),d.accessors.push(cn)}const Ot=Pt*Bt,Lt=new ArrayBuffer(Ot),qt=new DataView(Lt);for(let en=0;en<Pt;en++){let cn=0;for(const An of wt){const mn=An.getElementSize(),Tn=An.getComponentSize(),vn=An.getComponentType(),xn=An.getArray();for(let Un=0;Un<mn;Un++){const Mn=en*Bt+cn+Un*Tn,Gn=xn[en*mn+Un];switch(vn){case us.ComponentType.FLOAT:qt.setFloat32(Mn,Gn,!0);break;case us.ComponentType.BYTE:qt.setInt8(Mn,Gn);break;case us.ComponentType.SHORT:qt.setInt16(Mn,Gn,!0);break;case us.ComponentType.UNSIGNED_BYTE:qt.setUint8(Mn,Gn);break;case us.ComponentType.UNSIGNED_SHORT:qt.setUint16(Mn,Gn,!0);break;case us.ComponentType.UNSIGNED_INT:qt.setUint32(Mn,Gn,!0);break;default:throw new Error("Unexpected component type: "+vn)}}cn+=fo.padNumber(mn*Tn)}}return d.bufferViews.push({buffer:xt,byteOffset:_t,byteLength:Ot,byteStride:Bt,target:$v.BufferViewTarget.ARRAY_BUFFER}),{byteLength:Ot,buffers:[new Uint8Array(Lt)]}}const vt=new Map;for(const wt of s.getGraph().listEdges()){if(wt.getParent()===h)continue;const xt=wt.getChild();if(xt instanceof us){const _t=vt.get(xt)||[];_t.push(wt),vt.set(xt,_t)}}if(d.accessors=[],d.bufferViews=[],d.samplers=[],d.textures=[],d.images=h.listTextures().map((wt,xt)=>{const _t=et.createPropertyDef(wt);wt.getMimeType()&&(_t.mimeType=wt.getMimeType());const Pt=wt.getImage();return Pt&&et.createImageData(_t,Pt,wt),et.imageIndexMap.set(wt,xt),_t}),lt.filter(wt=>wt.prewriteTypes.includes(Yr.ACCESSOR)).forEach(wt=>wt.prewrite(et,Yr.ACCESSOR)),h.listAccessors().forEach(wt=>{const xt=et.accessorUsageGroupedByParent,_t=et.accessorParents;if(et.accessorIndexMap.has(wt))return;const Pt=vt.get(wt)||[],Bt=et.getAccessorUsage(wt);if(et.addAccessorToUsageGroup(wt,Bt),xt.has(Bt)){const Ot=Pt[0].getParent(),Lt=_t.get(Ot)||new Set;Lt.add(wt),_t.set(Ot,Lt)}}),lt.filter(wt=>wt.prewriteTypes.includes(Yr.BUFFER)).forEach(wt=>wt.prewrite(et,Yr.BUFFER)),(h.listAccessors().length>0||h.listTextures().length>0||et.otherBufferViews.size>0)&&h.listBuffers().length===0)throw new Error("Buffer required for Document resources, but none was found.");d.buffers=[],h.listBuffers().forEach((wt,xt)=>{const _t=et.createPropertyDef(wt),Pt=et.accessorUsageGroupedByParent,Bt=et.accessorParents,Ot=wt.listParents().filter(mn=>mn instanceof us),Lt=new Set(Ot),qt=[],en=d.buffers.length;let cn=0;const An=et.listAccessorUsageGroups();for(const mn in An)if(Pt.has(mn))for(const Tn of Array.from(Bt.values())){const vn=Array.from(Tn).filter(xn=>Lt.has(xn)).filter(xn=>et.getAccessorUsage(xn)===mn);if(vn.length)if(mn!==$D.ARRAY_BUFFER||a.vertexLayout===vI.INTERLEAVED){const xn=mn===$D.ARRAY_BUFFER?gt(vn,en,cn):pt(vn,en,cn);cn+=xn.byteLength,qt.push(...xn.buffers)}else for(const xn of vn){const Un=gt([xn],en,cn);cn+=Un.byteLength,qt.push(...Un.buffers)}}else{const Tn=An[mn].filter(xn=>Lt.has(xn));if(!Tn.length)continue;const vn=pt(Tn,en,cn,mn===$D.ELEMENT_ARRAY_BUFFER?$v.BufferViewTarget.ELEMENT_ARRAY_BUFFER:void 0);cn+=vn.byteLength,qt.push(...vn.buffers)}if(et.imageBufferViews.length&&xt===0){for(let mn=0;mn<et.imageBufferViews.length;mn++)if(d.bufferViews[d.images[mn].bufferView].byteOffset=cn,cn+=et.imageBufferViews[mn].byteLength,qt.push(et.imageBufferViews[mn]),cn%8){const Tn=8-cn%8;cn+=Tn,qt.push(new Uint8Array(Tn))}}if(et.otherBufferViews.has(wt))for(const mn of et.otherBufferViews.get(wt))d.bufferViews.push({buffer:en,byteOffset:cn,byteLength:mn.byteLength}),et.otherBufferViewsIndexMap.set(mn,d.bufferViews.length-1),cn+=mn.byteLength,qt.push(mn);if(cn){let mn;a.format===Zv.GLB?mn="@glb.bin":(mn=et.bufferURIGenerator.createURI(wt,"bin"),_t.uri=mn),_t.byteLength=cn,_.resources[mn]=fo.concat(qt)}d.buffers.push(_t),et.bufferIndexMap.set(wt,xt)}),h.listAccessors().find(wt=>!wt.getBuffer())&&nt.warn("Skipped writing one or more Accessors: no Buffer assigned."),d.materials=h.listMaterials().map((wt,xt)=>{const _t=et.createPropertyDef(wt);if(wt.getAlphaMode()!==Jx.AlphaMode.OPAQUE&&(_t.alphaMode=wt.getAlphaMode()),wt.getAlphaMode()===Jx.AlphaMode.MASK&&(_t.alphaCutoff=wt.getAlphaCutoff()),wt.getDoubleSided()&&(_t.doubleSided=!0),_t.pbrMetallicRoughness={},$l.eq(wt.getBaseColorFactor(),[1,1,1,1])||(_t.pbrMetallicRoughness.baseColorFactor=wt.getBaseColorFactor()),$l.eq(wt.getEmissiveFactor(),[0,0,0])||(_t.emissiveFactor=wt.getEmissiveFactor()),wt.getRoughnessFactor()!==1&&(_t.pbrMetallicRoughness.roughnessFactor=wt.getRoughnessFactor()),wt.getMetallicFactor()!==1&&(_t.pbrMetallicRoughness.metallicFactor=wt.getMetallicFactor()),wt.getBaseColorTexture()){const Pt=wt.getBaseColorTexture(),Bt=wt.getBaseColorTextureInfo();_t.pbrMetallicRoughness.baseColorTexture=et.createTextureInfoDef(Pt,Bt)}if(wt.getEmissiveTexture()){const Pt=wt.getEmissiveTexture(),Bt=wt.getEmissiveTextureInfo();_t.emissiveTexture=et.createTextureInfoDef(Pt,Bt)}if(wt.getNormalTexture()){const Pt=wt.getNormalTexture(),Bt=wt.getNormalTextureInfo(),Ot=et.createTextureInfoDef(Pt,Bt);wt.getNormalScale()!==1&&(Ot.scale=wt.getNormalScale()),_t.normalTexture=Ot}if(wt.getOcclusionTexture()){const Pt=wt.getOcclusionTexture(),Bt=wt.getOcclusionTextureInfo(),Ot=et.createTextureInfoDef(Pt,Bt);wt.getOcclusionStrength()!==1&&(Ot.strength=wt.getOcclusionStrength()),_t.occlusionTexture=Ot}if(wt.getMetallicRoughnessTexture()){const Pt=wt.getMetallicRoughnessTexture(),Bt=wt.getMetallicRoughnessTextureInfo();_t.pbrMetallicRoughness.metallicRoughnessTexture=et.createTextureInfoDef(Pt,Bt)}return et.materialIndexMap.set(wt,xt),_t}),d.meshes=h.listMeshes().map((wt,xt)=>{const _t=et.createPropertyDef(wt);let Pt=null;return _t.primitives=wt.listPrimitives().map(Bt=>{const Ot={attributes:{}};Ot.mode=Bt.getMode();const Lt=Bt.getMaterial();Lt&&(Ot.material=et.materialIndexMap.get(Lt)),Object.keys(Bt.getExtras()).length&&(Ot.extras=Bt.getExtras());const qt=Bt.getIndices();qt&&(Ot.indices=et.accessorIndexMap.get(qt));for(const en of Bt.listSemantics())Ot.attributes[en]=et.accessorIndexMap.get(Bt.getAttribute(en));for(const en of Bt.listTargets()){const cn={};for(const An of en.listSemantics())cn[An]=et.accessorIndexMap.get(en.getAttribute(An));Ot.targets=Ot.targets||[],Ot.targets.push(cn)}return Bt.listTargets().length&&!Pt&&(Pt=Bt.listTargets().map(en=>en.getName())),Ot}),wt.getWeights().length&&(_t.weights=wt.getWeights()),Pt&&(_t.extras=_t.extras||{},_t.extras.targetNames=Pt),et.meshIndexMap.set(wt,xt),_t}),d.cameras=h.listCameras().map((wt,xt)=>{const _t=et.createPropertyDef(wt);if(_t.type=wt.getType(),_t.type===Kx.Type.PERSPECTIVE){_t.perspective={znear:wt.getZNear(),zfar:wt.getZFar(),yfov:wt.getYFov()};const Pt=wt.getAspectRatio();Pt!==null&&(_t.perspective.aspectRatio=Pt)}else _t.orthographic={znear:wt.getZNear(),zfar:wt.getZFar(),xmag:wt.getXMag(),ymag:wt.getYMag()};return et.cameraIndexMap.set(wt,xt),_t}),d.nodes=h.listNodes().map((wt,xt)=>{const _t=et.createPropertyDef(wt);return $l.eq(wt.getTranslation(),[0,0,0])||(_t.translation=wt.getTranslation()),$l.eq(wt.getRotation(),[0,0,0,1])||(_t.rotation=wt.getRotation()),$l.eq(wt.getScale(),[1,1,1])||(_t.scale=wt.getScale()),wt.getWeights().length&&(_t.weights=wt.getWeights()),et.nodeIndexMap.set(wt,xt),_t}),d.skins=h.listSkins().map((wt,xt)=>{const _t=et.createPropertyDef(wt),Pt=wt.getInverseBindMatrices();Pt&&(_t.inverseBindMatrices=et.accessorIndexMap.get(Pt));const Bt=wt.getSkeleton();return Bt&&(_t.skeleton=et.nodeIndexMap.get(Bt)),_t.joints=wt.listJoints().map(Ot=>et.nodeIndexMap.get(Ot)),et.skinIndexMap.set(wt,xt),_t}),h.listNodes().forEach((wt,xt)=>{const _t=d.nodes[xt],Pt=wt.getMesh();Pt&&(_t.mesh=et.meshIndexMap.get(Pt));const Bt=wt.getCamera();Bt&&(_t.camera=et.cameraIndexMap.get(Bt));const Ot=wt.getSkin();Ot&&(_t.skin=et.skinIndexMap.get(Ot)),wt.listChildren().length>0&&(_t.children=wt.listChildren().map(Lt=>et.nodeIndexMap.get(Lt)))}),d.animations=h.listAnimations().map((wt,xt)=>{const _t=et.createPropertyDef(wt),Pt=new Map;return _t.samplers=wt.listSamplers().map((Bt,Ot)=>{const Lt=et.createPropertyDef(Bt);return Lt.input=et.accessorIndexMap.get(Bt.getInput()),Lt.output=et.accessorIndexMap.get(Bt.getOutput()),Lt.interpolation=Bt.getInterpolation(),Pt.set(Bt,Ot),Lt}),_t.channels=wt.listChannels().map(Bt=>{const Ot=et.createPropertyDef(Bt);return Ot.sampler=Pt.get(Bt.getSampler()),Ot.target={node:et.nodeIndexMap.get(Bt.getTargetNode()),path:Bt.getTargetPath()},Ot}),et.animationIndexMap.set(wt,xt),_t}),d.scenes=h.listScenes().map((wt,xt)=>{const _t=et.createPropertyDef(wt);return _t.nodes=wt.listChildren().map(Pt=>et.nodeIndexMap.get(Pt)),et.sceneIndexMap.set(wt,xt),_t});const Ct=h.getDefaultScene();return Ct&&(d.scene=h.listScenes().indexOf(Ct)),d.extensionsUsed=lt.map(wt=>wt.extensionName),d.extensionsRequired=ut.map(wt=>wt.extensionName),lt.forEach(wt=>wt.write(et)),function(wt){const xt=[];for(const _t in wt){const Pt=wt[_t];(Array.isArray(Pt)&&Pt.length===0||Pt===null||Pt===""||Pt&&typeof Pt=="object"&&Object.keys(Pt).length===0)&&xt.push(_t)}for(const _t of xt)delete wt[_t]}(d),_}}.write(e,{format:i.format||Zv.GLTF,basename:i.basename||"",logger:this.v,vertexLayout:this.F,dependencies:Im({},this.C),extensions:Array.from(this.h)})}async writeBinary(e){const{json:i,resources:s}=await this.writeJSON(e,{format:Zv.GLB}),a=new Uint32Array([1179937895,2,12]),h=JSON.stringify(i),d=fo.pad(fo.encodeText(h),32),_=fo.toView(new Uint32Array([d.byteLength,1313821514])),et=fo.concat([_,d]);a[a.length-1]+=et.byteLength;const nt=Object.values(s)[0];if(!nt||!nt.byteLength)return fo.concat([fo.toView(a),et]);const it=fo.pad(nt,0),lt=fo.toView(new Uint32Array([it.byteLength,5130562])),ut=fo.concat([lt,it]);return a[a.length-1]+=ut.byteLength,fo.concat([fo.toView(a),et,ut])}detectFormat(e){return(ww.isAbsoluteURL(e)?ww.extension(e):Xx.extension(e))==="glb"?Zv.GLB:Zv.GLTF}async P(e){this.lastReadBytes=0;const i=await this.readURI(e,"text");this.lastReadBytes+=i.length;const s={json:JSON.parse(i),resources:{}};return await this.D(s,this.dirname(e)),this.L(s),s}async U(e){const i=await this.readURI(e,"view");this.lastReadBytes=i.byteLength;const s=this._(i);return await this.D(s,this.dirname(e)),this.L(s),s}async D(e,i){var s=this;const a=[...e.json.images||[],...e.json.buffers||[]].map(async function(h){const d=h.uri;if(!d||d.match(/data:/))return Promise.resolve();e.resources[d]=await s.readURI(s.resolve(i,d),"view"),s.lastReadBytes+=e.resources[d].byteLength});await Promise.all(a)}L(e){function i(s){if(s.uri){if(s.uri in e.resources)fo.assertView(e.resources[s.uri]);else if(s.uri.match(/data:/)){const a=`__${function(){for(let h=0;h<999;h++){const d=UL();if(!zR.has(d))return zR.add(d),d}return""}()}.${Xx.extension(s.uri)}`;e.resources[a]=fo.createBufferFromDataURI(s.uri),s.uri=a}}}(e.json.images||[]).forEach(s=>{if(s.bufferView===void 0&&s.uri===void 0)throw new Error("Missing resource URI or buffer view.");i(s)}),(e.json.buffers||[]).forEach(i)}j(e){const{images:i,buffers:s}=e.json;return e={json:Im({},e.json),resources:Im({},e.resources)},i&&(e.json.images=i.map(a=>Im({},a))),s&&(e.json.buffers=s.map(a=>Im({},a))),e}_(e){const i=new Uint32Array(e.buffer,e.byteOffset,3);if(i[0]!==1179937895)throw new Error("Invalid glTF asset.");if(i[1]!==2)throw new Error(`Unsupported glTF binary version, "${i[1]}".`);const s=new Uint32Array(e.buffer,e.byteOffset+12,2);if(s[1]!==SI.JSON)throw new Error("Missing required GLB JSON chunk.");const a=s[0],h=fo.decodeText(fo.toView(e,20,a)),d=JSON.parse(h),_=20+a;if(e.byteLength<=_)return{json:d,resources:{}};const et=new Uint32Array(e.buffer,e.byteOffset+_,2);if(et[1]!==SI.BIN)throw new Error("Expected GLB BIN in second chunk.");return{json:d,resources:{"@glb.bin":fo.toView(e,_+8,et[0])}}}}{constructor(e=ww.DEFAULT_INIT){super(),this.V=void 0,this.V=e}async readURI(e,i){const s=await fetch(e,this.V);switch(i){case"view":return new Uint8Array(await s.arrayBuffer());case"text":return s.text()}}resolve(e,i){return ww.resolve(e,i)}dirname(e){return ww.dirname(e)}detectFormat(e){return ww.extension(e)==="glb"?Zv.GLB:Zv.GLTF}}class GL{constructor(){this.vkFormat=0,this.typeSize=1,this.pixelWidth=0,this.pixelHeight=0,this.pixelDepth=0,this.layerCount=0,this.faceCount=1,this.supercompressionScheme=0,this.levels=[],this.dataFormatDescriptor=[{vendorId:0,descriptorType:0,descriptorBlockSize:0,versionNumber:2,colorModel:0,colorPrimaries:1,transferFunction:2,flags:0,texelBlockDimension:[0,0,0,0],bytesPlane:[0,0,0,0,0,0,0,0],samples:[]}],this.keyValue={},this.globalData=null}}class rM{constructor(e,i,s,a){this._dataView=void 0,this._littleEndian=void 0,this._offset=void 0,this._dataView=new DataView(e.buffer,e.byteOffset+i,s),this._littleEndian=a,this._offset=0}_nextUint8(){const e=this._dataView.getUint8(this._offset);return this._offset+=1,e}_nextUint16(){const e=this._dataView.getUint16(this._offset,this._littleEndian);return this._offset+=2,e}_nextUint32(){const e=this._dataView.getUint32(this._offset,this._littleEndian);return this._offset+=4,e}_nextUint64(){const e=this._dataView.getUint32(this._offset,this._littleEndian)+4294967296*this._dataView.getUint32(this._offset+4,this._littleEndian);return this._offset+=8,e}_nextInt32(){const e=this._dataView.getInt32(this._offset,this._littleEndian);return this._offset+=4,e}_skip(e){return this._offset+=e,this}_scan(e,i=0){const s=this._offset;let a=0;for(;this._dataView.getUint8(this._offset)!==i&&a<e;)a++,this._offset++;return a<e&&this._offset++,new Uint8Array(this._dataView.buffer,this._dataView.byteOffset+s,a)}}const em=[171,75,84,88,32,50,48,187,13,10,26,10];function JR(c){return typeof TextDecoder<"u"?new TextDecoder().decode(c):Buffer.from(c).toString("utf8")}function eP(c){const e=new Uint8Array(c.buffer,c.byteOffset,em.length);if(e[0]!==em[0]||e[1]!==em[1]||e[2]!==em[2]||e[3]!==em[3]||e[4]!==em[4]||e[5]!==em[5]||e[6]!==em[6]||e[7]!==em[7]||e[8]!==em[8]||e[9]!==em[9]||e[10]!==em[10]||e[11]!==em[11])throw new Error("Missing KTX 2.0 identifier.");const i=new GL,s=17*Uint32Array.BYTES_PER_ELEMENT,a=new rM(c,em.length,s,!0);i.vkFormat=a._nextUint32(),i.typeSize=a._nextUint32(),i.pixelWidth=a._nextUint32(),i.pixelHeight=a._nextUint32(),i.pixelDepth=a._nextUint32(),i.layerCount=a._nextUint32(),i.faceCount=a._nextUint32();const h=a._nextUint32();i.supercompressionScheme=a._nextUint32();const d=a._nextUint32(),_=a._nextUint32(),et=a._nextUint32(),nt=a._nextUint32(),it=a._nextUint64(),lt=a._nextUint64(),ut=new rM(c,em.length+s,3*h*8,!0);for(let Mn=0;Mn<h;Mn++)i.levels.push({levelData:new Uint8Array(c.buffer,c.byteOffset+ut._nextUint64(),ut._nextUint64()),uncompressedByteLength:ut._nextUint64()});const pt=new rM(c,d,_,!0),gt={vendorId:pt._skip(4)._nextUint16(),descriptorType:pt._nextUint16(),versionNumber:pt._nextUint16(),descriptorBlockSize:pt._nextUint16(),colorModel:pt._nextUint8(),colorPrimaries:pt._nextUint8(),transferFunction:pt._nextUint8(),flags:pt._nextUint8(),texelBlockDimension:[pt._nextUint8(),pt._nextUint8(),pt._nextUint8(),pt._nextUint8()],bytesPlane:[pt._nextUint8(),pt._nextUint8(),pt._nextUint8(),pt._nextUint8(),pt._nextUint8(),pt._nextUint8(),pt._nextUint8(),pt._nextUint8()],samples:[]},vt=(gt.descriptorBlockSize/4-6)/4;for(let Mn=0;Mn<vt;Mn++){const Gn={bitOffset:pt._nextUint16(),bitLength:pt._nextUint8(),channelType:pt._nextUint8(),samplePosition:[pt._nextUint8(),pt._nextUint8(),pt._nextUint8(),pt._nextUint8()],sampleLower:-1/0,sampleUpper:1/0};64&Gn.channelType?(Gn.sampleLower=pt._nextInt32(),Gn.sampleUpper=pt._nextInt32()):(Gn.sampleLower=pt._nextUint32(),Gn.sampleUpper=pt._nextUint32()),gt.samples[Mn]=Gn}i.dataFormatDescriptor.length=0,i.dataFormatDescriptor.push(gt);const Ct=new rM(c,et,nt,!0);for(;Ct._offset<nt;){const Mn=Ct._nextUint32(),Gn=Ct._scan(Mn),rr=JR(Gn),dr=Ct._scan(Mn-Gn.byteLength);i.keyValue[rr]=rr.match(/^ktx/i)?JR(dr):dr,Ct._offset%4&&Ct._skip(4-Ct._offset%4)}if(lt<=0)return i;const wt=new rM(c,it,lt,!0),xt=wt._nextUint16(),_t=wt._nextUint16(),Pt=wt._nextUint32(),Bt=wt._nextUint32(),Ot=wt._nextUint32(),Lt=wt._nextUint32(),qt=[];for(let Mn=0;Mn<h;Mn++)qt.push({imageFlags:wt._nextUint32(),rgbSliceByteOffset:wt._nextUint32(),rgbSliceByteLength:wt._nextUint32(),alphaSliceByteOffset:wt._nextUint32(),alphaSliceByteLength:wt._nextUint32()});const en=it+wt._offset,cn=en+Pt,An=cn+Bt,mn=An+Ot,Tn=new Uint8Array(c.buffer,c.byteOffset+en,Pt),vn=new Uint8Array(c.buffer,c.byteOffset+cn,Bt),xn=new Uint8Array(c.buffer,c.byteOffset+An,Ot),Un=new Uint8Array(c.buffer,c.byteOffset+mn,Lt);return i.globalData={endpointCount:xt,selectorCount:_t,imageDescs:qt,endpointsData:Tn,selectorsData:vn,tablesData:xn,extendedData:Un},i}class ZR extends uu{init(){this.extensionName="EXT_mesh_gpu_instancing",this.propertyType="InstancedMesh",this.parentTypes=[Yr.NODE]}getDefaults(){return Object.assign(super.getDefaults(),{attributes:{}})}getAttribute(e){return this.getRefMap("attributes",e)}setAttribute(e,i){return this.setRefMap("attributes",e,i,{usage:"INSTANCE_ATTRIBUTE"})}listAttributes(){return this.listRefMapValues("attributes")}listSemantics(){return this.listRefMapKeys("attributes")}}ZR.EXTENSION_NAME="EXT_mesh_gpu_instancing";const $x="EXT_mesh_gpu_instancing";function xw(){return(xw=Object.assign||function(c){for(var e=1;e<arguments.length;e++){var i=arguments[e];for(var s in i)Object.prototype.hasOwnProperty.call(i,s)&&(c[s]=i[s])}return c}).apply(this,arguments)}var sM,tS,hu;(class extends Ql{constructor(...c){super(...c),this.extensionName=$x,this.provideTypes=[Yr.NODE],this.prewriteTypes=[Yr.ACCESSOR]}createInstancedMesh(){return new ZR(this.document.getGraph())}read(c){return(c.jsonDoc.json.nodes||[]).forEach((e,i)=>{if(!e.extensions||!e.extensions[$x])return;const s=e.extensions[$x],a=this.createInstancedMesh();for(const h in s.attributes)a.setAttribute(h,c.accessors[s.attributes[h]]);c.nodes[i].setExtension($x,a)}),this}prewrite(c){c.accessorUsageGroupedByParent.add("INSTANCE_ATTRIBUTE");for(const e of this.properties)for(const i of e.listAttributes())c.addAccessorToUsageGroup(i,"INSTANCE_ATTRIBUTE");return this}write(c){const e=c.jsonDoc;return this.document.getRoot().listNodes().forEach(i=>{const s=i.getExtension($x);if(s){const a=c.nodeIndexMap.get(i),h=e.json.nodes[a],d={attributes:{}};s.listSemantics().forEach(_=>{const et=s.getAttribute(_);d.attributes[_]=c.accessorIndexMap.get(et)}),h.extensions=h.extensions||{},h.extensions[$x]=d}}),this}}).EXTENSION_NAME=$x,function(c){c.QUANTIZE="quantize",c.FILTER="filter"}(sM||(sM={})),function(c){c.ATTRIBUTES="ATTRIBUTES",c.TRIANGLES="TRIANGLES",c.INDICES="INDICES"}(tS||(tS={})),function(c){c.NONE="NONE",c.OCTAHEDRAL="OCTAHEDRAL",c.QUATERNION="QUATERNION",c.EXPONENTIAL="EXPONENTIAL"}(hu||(hu={}));const{BYTE:HL,SHORT:$R,FLOAT:WL}=us.ComponentType,{normalize:eB,denormalize:tP}=$l;function qL(c,e,i,s){const{filter:a,bits:h}=s,d={array:c.getArray(),byteStride:c.getElementSize()*c.getComponentSize(),componentType:c.getComponentType(),normalized:c.getNormalized()};if(i!==tS.ATTRIBUTES)return d;if(a!==hu.NONE){let _=c.getNormalized()?function(et){const nt=et.getComponentType(),it=et.getArray(),lt=new Float32Array(it.length);for(let ut=0;ut<it.length;ut++)lt[ut]=tP(it[ut],nt);return lt}(c):new Float32Array(d.array);switch(a){case hu.EXPONENTIAL:d.byteStride=4*c.getElementSize(),d.componentType=WL,d.normalized=!1,d.array=e.encodeFilterExp(_,c.getCount(),d.byteStride,h);break;case hu.OCTAHEDRAL:d.byteStride=h>8?8:4,d.componentType=h>8?$R:HL,d.normalized=!0,_=c.getElementSize()===3?function(et){const nt=new Float32Array(4*et.length/3);for(let it=0,lt=et.length/3;it<lt;it++)nt[4*it]=et[3*it],nt[4*it+1]=et[3*it+1],nt[4*it+2]=et[3*it+2];return nt}(_):_,d.array=e.encodeFilterOct(_,c.getCount(),d.byteStride,h);break;case hu.QUATERNION:d.byteStride=8,d.componentType=$R,d.normalized=!0,d.array=e.encodeFilterQuat(_,c.getCount(),d.byteStride,h);break;default:throw new Error("Invalid filter.")}d.min=c.getMin([]),d.max=c.getMax([]),c.getNormalized()&&(d.min=d.min.map(et=>tP(et,c.getComponentType())),d.max=d.max.map(et=>tP(et,c.getComponentType()))),d.normalized&&(d.min=d.min.map(et=>eB(et,d.componentType)),d.max=d.max.map(et=>eB(et,d.componentType)))}else d.byteStride%4&&(d.array=function(_,et){const nt=fo.padNumber(_.BYTES_PER_ELEMENT*et)/_.BYTES_PER_ELEMENT,it=new _.constructor(_.length/et*nt);for(let lt=0;lt*et<_.length;lt++)for(let ut=0;ut<et;ut++)it[lt*nt+ut]=_[lt*et+ut];return it}(d.array,c.getElementSize()),d.byteStride=d.array.byteLength/c.getCount());return d}function YL(c,e){return e===$v.BufferViewUsage.ELEMENT_ARRAY_BUFFER?c.listParents().some(i=>i instanceof Zx&&i.getMode()===Zx.Mode.TRIANGLES)?tS.TRIANGLES:tS.INDICES:tS.ATTRIBUTES}function XL(c,e){const i=e.getGraph().listParentEdges(c).filter(s=>!(s.getParent()instanceof YR));for(const s of i){const a=s.getName(),h=s.getAttributes().key||"";if(a==="indices")return{filter:hu.NONE};if(a==="attributes"){if(h==="POSITION")return{filter:hu.NONE};if(h==="TEXCOORD_0")return{filter:hu.NONE};if(h==="NORMAL")return{filter:hu.OCTAHEDRAL,bits:8};if(h==="TANGENT")return{filter:hu.OCTAHEDRAL,bits:8};if(h.startsWith("JOINTS_"))return{filter:hu.NONE};if(h.startsWith("WEIGHTS_"))return{filter:hu.NONE}}if(a==="output"){const d=tB(c);return d==="rotation"?{filter:hu.QUATERNION,bits:16}:d==="translation"||d==="scale"?{filter:hu.EXPONENTIAL,bits:12}:{filter:hu.NONE}}if(a==="input")return{filter:hu.NONE};if(a==="inverseBindMatrices")return{filter:hu.NONE}}return{filter:hu.NONE}}function tB(c){for(const e of c.listParents())if(e instanceof eS){for(const i of e.listParents())if(i instanceof KD)return i.getTargetPath()}return null}const tm="EXT_meshopt_compression",nB={method:sM.QUANTIZE};class iB extends Ql{constructor(...e){super(...e),this.extensionName=tm,this.prereadTypes=[Yr.BUFFER,Yr.PRIMITIVE],this.prewriteTypes=[Yr.BUFFER,Yr.ACCESSOR],this.readDependencies=["meshopt.decoder"],this.writeDependencies=["meshopt.encoder"],this._decoder=null,this._decoderFallbackBufferMap=new Map,this._encoder=null,this._encoderOptions=nB,this._encoderFallbackBuffer=null,this._encoderBufferViews={},this._encoderBufferViewData={},this._encoderBufferViewAccessors={}}install(e,i){return e==="meshopt.decoder"&&(this._decoder=i),e==="meshopt.encoder"&&(this._encoder=i),this}setEncoderOptions(e){return this._encoderOptions=xw({},nB,e),this}preread(e,i){if(!this._decoder){if(!this.isRequired())return this;throw new Error(`[${tm}] Please install extension dependency, "meshopt.decoder".`)}if(!this._decoder.supported){if(!this.isRequired())return this;throw new Error(`[${tm}]: Missing WASM support.`)}return i===Yr.BUFFER?this._prereadBuffers(e):i===Yr.PRIMITIVE&&this._prereadPrimitives(e),this}_prereadBuffers(e){const i=e.jsonDoc;(i.json.bufferViews||[]).forEach((s,a)=>{if(!s.extensions||!s.extensions[tm])return;const h=s.extensions[tm],d=h.byteOffset||0,_=h.byteLength||0,et=h.count,nt=h.byteStride,it=new Uint8Array(et*nt),lt=i.json.buffers[s.buffer],ut=fo.toView(lt.uri?i.resources[lt.uri]:i.resources["@glb.bin"],d,_);this._decoder.decodeGltfBuffer(it,et,nt,ut,h.mode,h.filter),e.bufferViews[a]=it})}_prereadPrimitives(e){const i=e.jsonDoc;(i.json.bufferViews||[]).forEach(s=>{var a;s.extensions&&s.extensions[tm]&&(a=i.json.buffers[s.buffer]).extensions&&a.extensions.EXT_meshopt_compression&&a.extensions.EXT_meshopt_compression.fallback&&this._decoderFallbackBufferMap.set(e.buffers[s.buffer],e.buffers[s.extensions[tm].buffer])})}read(e){if(!this.isRequired())return this;for(const[i,s]of this._decoderFallbackBufferMap){for(const a of i.listParents())a instanceof us&&a.swap(i,s);i.dispose()}return this}prewrite(e,i){return i===Yr.ACCESSOR?this._prewriteAccessors(e):i===Yr.BUFFER&&this._prewriteBuffers(e),this}_prewriteAccessors(e){const i=e.jsonDoc.json,s=this._encoder,a=this._encoderOptions,h=this.document.createBuffer(),d=this.document.getRoot().listBuffers().indexOf(h);this._encoderFallbackBuffer=h,this._encoderBufferViews={},this._encoderBufferViewData={},this._encoderBufferViewAccessors={};for(const _ of this.document.getRoot().listAccessors()){if(tB(_)==="weights")continue;const et=e.getAccessorUsage(_),nt=YL(_,et),it=a.method===sM.FILTER?XL(_,this.document):{filter:hu.NONE},lt=qL(_,s,nt,it),{array:ut,byteStride:pt}=lt,gt=_.getBuffer();if(!gt)throw new Error(`${tm}: Missing buffer for accessor.`);const vt=this.document.getRoot().listBuffers().indexOf(gt),Ct=[et,nt,it.filter,pt,vt].join(":");let wt=this._encoderBufferViews[Ct],xt=this._encoderBufferViewData[Ct],_t=this._encoderBufferViewAccessors[Ct];wt&&xt||(_t=this._encoderBufferViewAccessors[Ct]=[],xt=this._encoderBufferViewData[Ct]=[],wt=this._encoderBufferViews[Ct]={buffer:d,target:$v.USAGE_TO_TARGET[et],byteOffset:0,byteLength:0,byteStride:et===$v.BufferViewUsage.ARRAY_BUFFER?pt:void 0,extensions:{[tm]:{buffer:vt,byteOffset:0,byteLength:0,mode:nt,filter:it.filter!==hu.NONE?it.filter:void 0,byteStride:pt,count:0}}});const Pt=e.createAccessorDef(_);Pt.componentType=lt.componentType,Pt.normalized=lt.normalized,Pt.byteOffset=wt.byteLength,Pt.min&&lt.min&&(Pt.min=lt.min),Pt.max&&lt.max&&(Pt.max=lt.max),e.accessorIndexMap.set(_,i.accessors.length),i.accessors.push(Pt),_t.push(Pt),xt.push(new Uint8Array(ut.buffer,ut.byteOffset,ut.byteLength)),wt.byteLength+=ut.byteLength,wt.extensions.EXT_meshopt_compression.count+=_.getCount()}}_prewriteBuffers(e){const i=this._encoder;for(const s in this._encoderBufferViews){const a=this._encoderBufferViews[s],h=this._encoderBufferViewData[s],d=this.document.getRoot().listBuffers()[a.extensions[tm].buffer],_=e.otherBufferViews.get(d)||[],{count:et,byteStride:nt,mode:it}=a.extensions[tm],lt=fo.concat(h),ut=i.encodeGltfBuffer(lt,et,nt,it),pt=fo.pad(ut);a.extensions[tm].byteLength=ut.byteLength,h.length=0,h.push(pt),_.push(pt),e.otherBufferViews.set(d,_)}}write(e){let i=0;for(const d in this._encoderBufferViews){const _=this._encoderBufferViews[d],et=e.otherBufferViewsIndexMap.get(this._encoderBufferViewData[d][0]),nt=this._encoderBufferViewAccessors[d];for(const ut of nt)ut.bufferView=et;const it=e.jsonDoc.json.bufferViews[et],lt=it.byteOffset||0;Object.assign(it,_),it.byteOffset=i,it.extensions[tm].byteOffset=lt,i+=fo.padNumber(_.byteLength)}const s=this._encoderFallbackBuffer,a=e.bufferIndexMap.get(s),h=e.jsonDoc.json.buffers[a];return h.byteLength=i,h.extensions={[tm]:{fallback:!0}},s.dispose(),this}}iB.EXTENSION_NAME=tm,iB.EncoderMethod=sM;const rB="EXT_texture_webp";class KL{match(e){return e.length>=12&&e[8]===87&&e[9]===69&&e[10]===66&&e[11]===80}getSize(e){const i=fo.decodeText(e.slice(0,4)),s=fo.decodeText(e.slice(8,12));if(i!=="RIFF"||s!=="WEBP")return null;const a=new DataView(e.buffer,e.byteOffset);let h=12;for(;h<a.byteLength;){const d=fo.decodeText(new Uint8Array([a.getUint8(h),a.getUint8(h+1),a.getUint8(h+2),a.getUint8(h+3)])),_=a.getUint32(h+4,!0);if(d==="VP8 ")return[16383&a.getInt16(h+14,!0),16383&a.getInt16(h+16,!0)];if(d==="VP8L"){const et=a.getUint8(h+9),nt=a.getUint8(h+10),it=a.getUint8(h+11);return[1+((63&nt)<<8|et),1+((15&a.getUint8(h+12))<<10|it<<2|(192&nt)>>6)]}h+=8+_+_%2}return null}getChannels(e){return 4}}(class extends Ql{constructor(...c){super(...c),this.extensionName=rB,this.prereadTypes=[Yr.TEXTURE]}static register(){ay.registerFormat("image/webp",new KL)}preread(c){return(c.jsonDoc.json.textures||[]).forEach(e=>{e.extensions&&e.extensions.EXT_texture_webp&&(e.source=e.extensions.EXT_texture_webp.source)}),this}read(c){return this}write(c){const e=c.jsonDoc;return this.document.getRoot().listTextures().forEach(i=>{if(i.getMimeType()==="image/webp"){const s=c.imageIndexMap.get(i);(e.json.textures||[]).forEach(a=>{a.source===s&&(a.extensions=a.extensions||{},a.extensions.EXT_texture_webp={source:a.source},delete a.source)})}}),this}}).EXTENSION_NAME=rB;const sB="KHR_draco_mesh_compression";let Uu,oB,aB,Dm;function JL(c,e){const i=new Uu.DecoderBuffer;try{if(i.Init(e,e.length),c.GetEncodedGeometryType(i)!==Uu.TRIANGULAR_MESH)throw new Error(`[${sB}] Unknown geometry type.`);const s=new Uu.Mesh;if(!c.DecodeBufferToMesh(i,s).ok()||s.ptr===0)throw new Error(`[${sB}] Decoding failure.`);return s}finally{Uu.destroy(i)}}function ZL(c,e){const i=3*e.num_faces();let s,a;if(e.num_points()<=65534){const h=i*Uint16Array.BYTES_PER_ELEMENT;s=Uu._malloc(h),c.GetTrianglesUInt16Array(e,h,s),a=new Uint16Array(Uu.HEAPU16.buffer,s,i).slice()}else{const h=i*Uint32Array.BYTES_PER_ELEMENT;s=Uu._malloc(h),c.GetTrianglesUInt32Array(e,h,s),a=new Uint32Array(Uu.HEAPU32.buffer,s,i).slice()}return Uu._free(s),a}function $L(c,e,i,s){const a=aB[s.componentType],h=oB[s.componentType],d=i.num_components(),_=e.num_points()*d,et=_*h.BYTES_PER_ELEMENT,nt=Uu._malloc(et);c.GetAttributeDataArrayForAllPoints(e,i,a,et,nt);const it=new h(Uu.HEAPF32.buffer,nt,_).slice();return Uu._free(nt),it}var oM,e0;(function(c){c[c.EDGEBREAKER=1]="EDGEBREAKER",c[c.SEQUENTIAL=0]="SEQUENTIAL"})(oM||(oM={})),function(c){c.POSITION="POSITION",c.NORMAL="NORMAL",c.COLOR="COLOR",c.TEX_COORD="TEX_COORD",c.GENERIC="GENERIC"}(e0||(e0={}));const lB={[e0.POSITION]:14,[e0.NORMAL]:10,[e0.COLOR]:8,[e0.TEX_COORD]:12,[e0.GENERIC]:12},cB={decodeSpeed:5,encodeSpeed:5,method:oM.EDGEBREAKER,quantizationBits:lB,quantizationVolume:"mesh"};function eN(c,e=cB){const i=xw({},cB,e);i.quantizationBits=xw({},lB,e.quantizationBits);const s=new Dm.Encoder,a=new Dm.MeshBuilder,h=new Dm.Mesh,d={},_=new Dm.DracoInt8Array;for(const gt of c.listSemantics()){const vt=c.getAttribute(gt),Ct=tN(gt),wt=nN(a,vt.getComponentType(),h,Dm[Ct],vt.getCount(),vt.getElementSize(),vt.getArray());if(wt===-1)throw new Error(`Error compressing "${gt}" attribute.`);if(d[gt]=wt,i.quantizationVolume==="mesh"||gt!=="POSITION")s.SetAttributeQuantization(Dm[Ct],i.quantizationBits[Ct]);else{if(typeof i.quantizationVolume!="object")throw new Error("Invalid quantization volume state.");{const{quantizationVolume:xt}=i,_t=Math.max(xt.max[0]-xt.min[0],xt.max[1]-xt.min[1],xt.max[2]-xt.min[2]);s.SetAttributeExplicitQuantization(Dm[Ct],i.quantizationBits[Ct],vt.getElementSize(),xt.min,_t)}}}const et=c.getIndices();if(!et)throw new Error("Primitive must have indices.");a.AddFacesToMesh(h,et.getCount()/3,et.getArray()),s.SetSpeedOptions(i.encodeSpeed,i.decodeSpeed),s.SetTrackEncodedProperties(!0),i.method===oM.SEQUENTIAL||c.listTargets().length>0?s.SetEncodingMethod(Dm.MESH_SEQUENTIAL_ENCODING):s.SetEncodingMethod(Dm.MESH_EDGEBREAKER_ENCODING);const nt=s.EncodeMeshToDracoBuffer(h,_);if(nt<=0)throw new Error("Error applying Draco compression.");const it=new Uint8Array(nt);for(let gt=0;gt<nt;++gt)it[gt]=_.GetValue(gt);const lt=c.getAttribute("POSITION").getCount(),ut=s.GetNumberOfEncodedPoints(),pt=3*s.GetNumberOfEncodedFaces();if(c.listTargets().length>0&&ut!==lt)throw new Error('Compression reduced vertex count unexpectedly, corrupting morph targets. Applying the "weld" function before compression may resolve the issue.');return Dm.destroy(_),Dm.destroy(h),Dm.destroy(a),Dm.destroy(s),{numVertices:ut,numIndices:pt,data:it,attributeIDs:d}}function tN(c){return c==="POSITION"?e0.POSITION:c==="NORMAL"?e0.NORMAL:c.startsWith("COLOR_")?e0.COLOR:c.startsWith("TEXCOORD_")?e0.TEX_COORD:e0.GENERIC}function nN(c,e,i,s,a,h,d){switch(e){case us.ComponentType.UNSIGNED_BYTE:return c.AddUInt8Attribute(i,s,a,h,d);case us.ComponentType.BYTE:return c.AddInt8Attribute(i,s,a,h,d);case us.ComponentType.UNSIGNED_SHORT:return c.AddUInt16Attribute(i,s,a,h,d);case us.ComponentType.SHORT:return c.AddInt16Attribute(i,s,a,h,d);case us.ComponentType.UNSIGNED_INT:return c.AddUInt32Attribute(i,s,a,h,d);case us.ComponentType.FLOAT:return c.AddFloatAttribute(i,s,a,h,d);default:throw new Error(`Unexpected component type, "${e}".`)}}const Cu="KHR_draco_mesh_compression";class aM extends Ql{constructor(...e){super(...e),this.extensionName=Cu,this.prereadTypes=[Yr.PRIMITIVE],this.prewriteTypes=[Yr.ACCESSOR],this.readDependencies=["draco3d.decoder"],this.writeDependencies=["draco3d.encoder"],this._decoderModule=null,this._encoderModule=null,this._encoderOptions={}}install(e,i){return e==="draco3d.decoder"&&(this._decoderModule=i,Uu=this._decoderModule,oB={[us.ComponentType.FLOAT]:Float32Array,[us.ComponentType.UNSIGNED_INT]:Uint32Array,[us.ComponentType.UNSIGNED_SHORT]:Uint16Array,[us.ComponentType.UNSIGNED_BYTE]:Uint8Array,[us.ComponentType.SHORT]:Int16Array,[us.ComponentType.BYTE]:Int8Array},aB={[us.ComponentType.FLOAT]:Uu.DT_FLOAT32,[us.ComponentType.UNSIGNED_INT]:Uu.DT_UINT32,[us.ComponentType.UNSIGNED_SHORT]:Uu.DT_UINT16,[us.ComponentType.UNSIGNED_BYTE]:Uu.DT_UINT8,[us.ComponentType.SHORT]:Uu.DT_INT16,[us.ComponentType.BYTE]:Uu.DT_INT8}),e==="draco3d.encoder"&&(this._encoderModule=i,Dm=this._encoderModule),this}setEncoderOptions(e){return this._encoderOptions=e,this}preread(e){if(!this._decoderModule)throw new Error(`[${Cu}] Please install extension dependency, "draco3d.decoder".`);const i=this.document.getLogger(),s=e.jsonDoc,a=new Map;try{const h=s.json.meshes||[];for(const d of h)for(const _ of d.primitives){if(!_.extensions||!_.extensions[Cu])continue;const et=_.extensions[Cu];let[nt,it]=a.get(et.bufferView)||[];if(!it||!nt){const lt=s.json.bufferViews[et.bufferView],ut=s.json.buffers[lt.buffer],pt=fo.toView(ut.uri?s.resources[ut.uri]:s.resources["@glb.bin"],lt.byteOffset||0,lt.byteLength);nt=new this._decoderModule.Decoder,it=JL(nt,pt),a.set(et.bufferView,[nt,it]),i.debug(`[${Cu}] Decompressed ${pt.byteLength} bytes.`)}for(const lt in _.attributes){const ut=e.jsonDoc.json.accessors[_.attributes[lt]],pt=nt.GetAttributeByUniqueId(it,et.attributes[lt]),gt=$L(nt,it,pt,ut);e.accessors[_.attributes[lt]].setArray(gt)}_.indices!==void 0&&e.accessors[_.indices].setArray(ZL(nt,it))}}finally{for(const[h,d]of Array.from(a.values()))this._decoderModule.destroy(h),this._decoderModule.destroy(d)}return this}read(e){return this}prewrite(e,i){if(!this._encoderModule)throw new Error(`[${Cu}] Please install extension dependency, "draco3d.encoder".`);const s=this.document.getLogger();s.debug(`[${Cu}] Compression options: ${JSON.stringify(this._encoderOptions)}`);const a=function(_){const et=_.getLogger(),nt=new Set,it=new Set;for(const Ct of _.getRoot().listMeshes())for(const wt of Ct.listPrimitives())wt.getIndices()?wt.getMode()!==Zx.Mode.TRIANGLES?(it.add(wt),et.warn(`[${Cu}] Skipping Draco compression on non-TRIANGLES primitive.`)):nt.add(wt):(it.add(wt),et.warn(`[${Cu}] Skipping Draco compression on non-indexed primitive.`));const lt=_.getRoot().listAccessors(),ut=new Map;for(let Ct=0;Ct<lt.length;Ct++)ut.set(lt[Ct],Ct);const pt=new Map,gt=new Set,vt=new Map;for(const Ct of Array.from(nt)){let wt=uB(Ct,ut);if(gt.has(wt))vt.set(Ct,wt);else{if(pt.has(Ct.getIndices())){const xt=Ct.getIndices(),_t=xt.clone();ut.set(_t,_.getRoot().listAccessors().length-1),Ct.swap(xt,_t)}for(const xt of Ct.listAttributes())if(pt.has(xt)){const _t=xt.clone();ut.set(_t,_.getRoot().listAccessors().length-1),Ct.swap(xt,_t)}wt=uB(Ct,ut),gt.add(wt),vt.set(Ct,wt),pt.set(Ct.getIndices(),wt);for(const xt of Ct.listAttributes())pt.set(xt,wt)}}for(const Ct of Array.from(pt.keys())){const wt=new Set(Ct.listParents().map(xt=>xt.propertyType));if(wt.size!==2||!wt.has(Yr.PRIMITIVE)||!wt.has(Yr.ROOT))throw new Error(`[${Cu}] Compressed accessors must only be used as indices or vertex attributes.`)}for(const Ct of Array.from(nt)){const wt=vt.get(Ct),xt=Ct.getIndices();if(pt.get(xt)!==wt||Ct.listAttributes().some(_t=>pt.get(_t)!==wt))throw new Error(`[${Cu}] Draco primitives must share all, or no, accessors.`)}for(const Ct of Array.from(it)){const wt=Ct.getIndices();if(pt.has(wt)||Ct.listAttributes().some(xt=>pt.has(xt)))throw new Error(`[${Cu}] Accessor cannot be shared by compressed and uncompressed primitives.`)}return vt}(this.document),h=new Map;let d="mesh";this._encoderOptions.quantizationVolume==="scene"&&(this.document.getRoot().listScenes().length!==1?s.warn(`[${Cu}]: quantizationVolume=scene requires exactly 1 scene.`):d=function(_){const et={min:[1/0,1/0,1/0],max:[-1/0,-1/0,-1/0]},nt=_.propertyType===Yr.NODE?[_]:_.listChildren();for(const it of nt)it.traverse(lt=>{const ut=lt.getMesh();if(!ut)return;const pt=BL(ut,lt.getWorldMatrix());YD(pt.min,et),YD(pt.max,et)});return et}(this.document.getRoot().listScenes().pop()));for(const _ of Array.from(a.keys())){const et=a.get(_);if(!et)throw new Error("Unexpected primitive.");if(h.has(et)){h.set(et,h.get(et));continue}const nt=_.getIndices(),it=e.jsonDoc.json.accessors,lt=eN(_,xw({},this._encoderOptions,{quantizationVolume:d}));h.set(et,lt);const ut=e.createAccessorDef(nt);ut.count=lt.numIndices,e.accessorIndexMap.set(nt,it.length),it.push(ut);for(const gt of _.listSemantics()){const vt=_.getAttribute(gt),Ct=e.createAccessorDef(vt);Ct.count=lt.numVertices,e.accessorIndexMap.set(vt,it.length),it.push(Ct)}const pt=_.getAttribute("POSITION").getBuffer()||this.document.getRoot().listBuffers()[0];e.otherBufferViews.has(pt)||e.otherBufferViews.set(pt,[]),e.otherBufferViews.get(pt).push(lt.data)}return s.debug(`[${Cu}] Compressed ${a.size} primitives.`),e.extensionData[Cu]={primitiveHashMap:a,primitiveEncodingMap:h},this}write(e){const i=e.extensionData[Cu];for(const s of this.document.getRoot().listMeshes()){const a=e.jsonDoc.json.meshes[e.meshIndexMap.get(s)];for(let h=0;h<s.listPrimitives().length;h++){const d=s.listPrimitives()[h],_=a.primitives[h],et=i.primitiveHashMap.get(d);if(!et)continue;const nt=i.primitiveEncodingMap.get(et);_.extensions=_.extensions||{},_.extensions[Cu]={bufferView:e.otherBufferViewsIndexMap.get(nt.data),attributes:nt.attributeIDs}}}if(!i.primitiveHashMap.size){const s=e.jsonDoc.json;s.extensionsUsed=(s.extensionsUsed||[]).filter(a=>a!==Cu),s.extensionsRequired=(s.extensionsRequired||[]).filter(a=>a!==Cu)}return this}}function uB(c,e){const i=[],s=c.getIndices();i.push(e.get(s));for(const a of c.listAttributes())i.push(e.get(a));return i.sort().join("|")}aM.EXTENSION_NAME=Cu,aM.EncoderMethod=oM;class nS extends uu{init(){this.extensionName="KHR_lights_punctual",this.propertyType="Light",this.parentTypes=[Yr.NODE]}getDefaults(){return Object.assign(super.getDefaults(),{color:[1,1,1],intensity:1,type:nS.Type.POINT,range:null,innerConeAngle:0,outerConeAngle:Math.PI/4})}getColor(){return this.get("color")}setColor(e){return this.set("color",e)}getColorHex(){return Tm.factorToHex(this.getColor())}setColorHex(e){const i=this.getColor().slice();return Tm.hexToFactor(e,i),this.setColor(i)}getIntensity(){return this.get("intensity")}setIntensity(e){return this.set("intensity",e)}getType(){return this.get("type")}setType(e){return this.set("type",e)}getRange(){return this.get("range")}setRange(e){return this.set("range",e)}getInnerConeAngle(){return this.get("innerConeAngle")}setInnerConeAngle(e){return this.set("innerConeAngle",e)}getOuterConeAngle(){return this.get("outerConeAngle")}setOuterConeAngle(e){return this.set("outerConeAngle",e)}}nS.EXTENSION_NAME="KHR_lights_punctual",nS.Type={POINT:"point",SPOT:"spot",DIRECTIONAL:"directional"};const CI="KHR_lights_punctual";class hB extends Ql{constructor(...e){super(...e),this.extensionName=CI}createLight(e=""){return new nS(this.document.getGraph(),e)}read(e){const i=e.jsonDoc;if(!i.json.extensions||!i.json.extensions.KHR_lights_punctual)return this;const s=(i.json.extensions.KHR_lights_punctual.lights||[]).map(a=>{var h,d;const _=this.createLight().setName(a.name||"").setType(a.type);return a.color!==void 0&&_.setColor(a.color),a.intensity!==void 0&&_.setIntensity(a.intensity),a.range!==void 0&&_.setRange(a.range),((h=a.spot)==null?void 0:h.innerConeAngle)!==void 0&&_.setInnerConeAngle(a.spot.innerConeAngle),((d=a.spot)==null?void 0:d.outerConeAngle)!==void 0&&_.setOuterConeAngle(a.spot.outerConeAngle),_});return i.json.nodes.forEach((a,h)=>{a.extensions&&a.extensions.KHR_lights_punctual&&e.nodes[h].setExtension(CI,s[a.extensions.KHR_lights_punctual.light])}),this}write(e){const i=e.jsonDoc;if(this.properties.size===0)return this;const s=[],a=new Map;for(const h of this.properties){const d=h,_={type:d.getType()};$l.eq(d.getColor(),[1,1,1])||(_.color=d.getColor()),d.getIntensity()!==1&&(_.intensity=d.getIntensity()),d.getRange()!=null&&(_.range=d.getRange()),d.getName()&&(_.name=d.getName()),d.getType()===nS.Type.SPOT&&(_.spot={innerConeAngle:d.getInnerConeAngle(),outerConeAngle:d.getOuterConeAngle()}),s.push(_),a.set(d,s.length-1)}return this.document.getRoot().listNodes().forEach(h=>{const d=h.getExtension(CI);if(d){const _=e.nodeIndexMap.get(h),et=i.json.nodes[_];et.extensions=et.extensions||{},et.extensions.KHR_lights_punctual={light:a.get(d)}}}),i.json.extensions=i.json.extensions||{},i.json.extensions.KHR_lights_punctual={lights:s},this}}hB.EXTENSION_NAME=CI;const{R:dB,G:pB,B:iN}=cu;class fB extends uu{init(){this.extensionName="KHR_materials_clearcoat",this.propertyType="Clearcoat",this.parentTypes=[Yr.MATERIAL]}getDefaults(){return Object.assign(super.getDefaults(),{clearcoatFactor:0,clearcoatTexture:null,clearcoatTextureInfo:new Rl(this.graph,"clearcoatTextureInfo"),clearcoatRoughnessFactor:0,clearcoatRoughnessTexture:null,clearcoatRoughnessTextureInfo:new Rl(this.graph,"clearcoatRoughnessTextureInfo"),clearcoatNormalScale:1,clearcoatNormalTexture:null,clearcoatNormalTextureInfo:new Rl(this.graph,"clearcoatNormalTextureInfo")})}getClearcoatFactor(){return this.get("clearcoatFactor")}setClearcoatFactor(e){return this.set("clearcoatFactor",e)}getClearcoatTexture(){return this.getRef("clearcoatTexture")}getClearcoatTextureInfo(){return this.getRef("clearcoatTexture")?this.getRef("clearcoatTextureInfo"):null}setClearcoatTexture(e){return this.setRef("clearcoatTexture",e,{channels:dB})}getClearcoatRoughnessFactor(){return this.get("clearcoatRoughnessFactor")}setClearcoatRoughnessFactor(e){return this.set("clearcoatRoughnessFactor",e)}getClearcoatRoughnessTexture(){return this.getRef("clearcoatRoughnessTexture")}getClearcoatRoughnessTextureInfo(){return this.getRef("clearcoatRoughnessTexture")?this.getRef("clearcoatRoughnessTextureInfo"):null}setClearcoatRoughnessTexture(e){return this.setRef("clearcoatRoughnessTexture",e,{channels:pB})}getClearcoatNormalScale(){return this.get("clearcoatNormalScale")}setClearcoatNormalScale(e){return this.set("clearcoatNormalScale",e)}getClearcoatNormalTexture(){return this.getRef("clearcoatNormalTexture")}getClearcoatNormalTextureInfo(){return this.getRef("clearcoatNormalTexture")?this.getRef("clearcoatNormalTextureInfo"):null}setClearcoatNormalTexture(e){return this.setRef("clearcoatNormalTexture",e,{channels:dB|pB|iN})}}fB.EXTENSION_NAME="KHR_materials_clearcoat";const _b="KHR_materials_clearcoat";class mB extends Ql{constructor(...e){super(...e),this.extensionName=_b}createClearcoat(){return new fB(this.document.getGraph())}read(e){const i=e.jsonDoc,s=i.json.textures||[];return(i.json.materials||[]).forEach((a,h)=>{if(a.extensions&&a.extensions[_b]){const d=this.createClearcoat();e.materials[h].setExtension(_b,d);const _=a.extensions[_b];if(_.clearcoatFactor!==void 0&&d.setClearcoatFactor(_.clearcoatFactor),_.clearcoatRoughnessFactor!==void 0&&d.setClearcoatRoughnessFactor(_.clearcoatRoughnessFactor),_.clearcoatTexture!==void 0){const et=_.clearcoatTexture;d.setClearcoatTexture(e.textures[s[et.index].source]),e.setTextureInfo(d.getClearcoatTextureInfo(),et)}if(_.clearcoatRoughnessTexture!==void 0){const et=_.clearcoatRoughnessTexture;d.setClearcoatRoughnessTexture(e.textures[s[et.index].source]),e.setTextureInfo(d.getClearcoatRoughnessTextureInfo(),et)}if(_.clearcoatNormalTexture!==void 0){const et=_.clearcoatNormalTexture;d.setClearcoatNormalTexture(e.textures[s[et.index].source]),e.setTextureInfo(d.getClearcoatNormalTextureInfo(),et),et.scale!==void 0&&d.setClearcoatNormalScale(et.scale)}}}),this}write(e){const i=e.jsonDoc;return this.document.getRoot().listMaterials().forEach(s=>{const a=s.getExtension(_b);if(a){const h=e.materialIndexMap.get(s),d=i.json.materials[h];d.extensions=d.extensions||{};const _=d.extensions[_b]={clearcoatFactor:a.getClearcoatFactor(),clearcoatRoughnessFactor:a.getClearcoatRoughnessFactor()};if(a.getClearcoatTexture()){const et=a.getClearcoatTexture(),nt=a.getClearcoatTextureInfo();_.clearcoatTexture=e.createTextureInfoDef(et,nt)}if(a.getClearcoatRoughnessTexture()){const et=a.getClearcoatRoughnessTexture(),nt=a.getClearcoatRoughnessTextureInfo();_.clearcoatRoughnessTexture=e.createTextureInfoDef(et,nt)}if(a.getClearcoatNormalTexture()){const et=a.getClearcoatNormalTexture(),nt=a.getClearcoatNormalTextureInfo();_.clearcoatNormalTexture=e.createTextureInfoDef(et,nt),a.getClearcoatNormalScale()!==1&&(_.clearcoatNormalTexture.scale=a.getClearcoatNormalScale())}}}),this}}mB.EXTENSION_NAME=_b;class gB extends uu{init(){this.extensionName="KHR_materials_emissive_strength",this.propertyType="EmissiveStrength",this.parentTypes=[Yr.MATERIAL]}getDefaults(){return Object.assign(super.getDefaults(),{emissiveStrength:1})}getEmissiveStrength(){return this.get("emissiveStrength")}setEmissiveStrength(e){return this.set("emissiveStrength",e)}}gB.EXTENSION_NAME="KHR_materials_emissive_strength";const e1="KHR_materials_emissive_strength";class vB extends Ql{constructor(...e){super(...e),this.extensionName=e1}createEmissiveStrength(){return new gB(this.document.getGraph())}read(e){return(e.jsonDoc.json.materials||[]).forEach((i,s)=>{if(i.extensions&&i.extensions[e1]){const a=this.createEmissiveStrength();e.materials[s].setExtension(e1,a);const h=i.extensions[e1];h.emissiveStrength!==void 0&&a.setEmissiveStrength(h.emissiveStrength)}}),this}write(e){const i=e.jsonDoc;return this.document.getRoot().listMaterials().forEach(s=>{const a=s.getExtension(e1);if(a){const h=e.materialIndexMap.get(s),d=i.json.materials[h];d.extensions=d.extensions||{},d.extensions[e1]={emissiveStrength:a.getEmissiveStrength()}}}),this}}vB.EXTENSION_NAME=e1;class _B extends uu{init(){this.extensionName="KHR_materials_ior",this.propertyType="IOR",this.parentTypes=[Yr.MATERIAL]}getDefaults(){return Object.assign(super.getDefaults(),{ior:0})}getIOR(){return this.get("ior")}setIOR(e){return this.set("ior",e)}}_B.EXTENSION_NAME="KHR_materials_ior";const MI="KHR_materials_ior";class AB extends Ql{constructor(...e){super(...e),this.extensionName=MI}createIOR(){return new _B(this.document.getGraph())}read(e){return(e.jsonDoc.json.materials||[]).forEach((i,s)=>{if(i.extensions&&i.extensions.KHR_materials_ior){const a=this.createIOR();e.materials[s].setExtension(MI,a);const h=i.extensions.KHR_materials_ior;h.ior!==void 0&&a.setIOR(h.ior)}}),this}write(e){const i=e.jsonDoc;return this.document.getRoot().listMaterials().forEach(s=>{const a=s.getExtension(MI);if(a){const h=e.materialIndexMap.get(s),d=i.json.materials[h];d.extensions=d.extensions||{},d.extensions.KHR_materials_ior={ior:a.getIOR()}}}),this}}AB.EXTENSION_NAME=MI;const{R:rN,G:sN}=cu;class yB extends uu{init(){this.extensionName="KHR_materials_iridescence",this.propertyType="Iridescence",this.parentTypes=[Yr.MATERIAL]}getDefaults(){return Object.assign(super.getDefaults(),{iridescenceFactor:0,iridescenceTexture:null,iridescenceTextureInfo:new Rl(this.graph,"iridescenceTextureInfo"),iridescenceIOR:1.3,iridescenceThicknessMinimum:100,iridescenceThicknessMaximum:400,iridescenceThicknessTexture:null,iridescenceThicknessTextureInfo:new Rl(this.graph,"iridescenceThicknessTextureInfo")})}getIridescenceFactor(){return this.get("iridescenceFactor")}setIridescenceFactor(e){return this.set("iridescenceFactor",e)}getIridescenceTexture(){return this.getRef("iridescenceTexture")}getIridescenceTextureInfo(){return this.getRef("iridescenceTexture")?this.getRef("iridescenceTextureInfo"):null}setIridescenceTexture(e){return this.setRef("iridescenceTexture",e,{channels:rN})}getIridescenceIOR(){return this.get("iridescenceIOR")}setIridescenceIOR(e){return this.set("iridescenceIOR",e)}getIridescenceThicknessMinimum(){return this.get("iridescenceThicknessMinimum")}setIridescenceThicknessMinimum(e){return this.set("iridescenceThicknessMinimum",e)}getIridescenceThicknessMaximum(){return this.get("iridescenceThicknessMaximum")}setIridescenceThicknessMaximum(e){return this.set("iridescenceThicknessMaximum",e)}getIridescenceThicknessTexture(){return this.getRef("iridescenceThicknessTexture")}getIridescenceThicknessTextureInfo(){return this.getRef("iridescenceThicknessTexture")?this.getRef("iridescenceThicknessTextureInfo"):null}setIridescenceThicknessTexture(e){return this.setRef("iridescenceThicknessTexture",e,{channels:sN})}}yB.EXTENSION_NAME="KHR_materials_iridescence";const t1="KHR_materials_iridescence";class wB extends Ql{constructor(...e){super(...e),this.extensionName=t1}createIridescence(){return new yB(this.document.getGraph())}read(e){const i=e.jsonDoc,s=i.json.textures||[];return(i.json.materials||[]).forEach((a,h)=>{if(a.extensions&&a.extensions[t1]){const d=this.createIridescence();e.materials[h].setExtension(t1,d);const _=a.extensions[t1];if(_.iridescenceFactor!==void 0&&d.setIridescenceFactor(_.iridescenceFactor),_.iridescenceIor!==void 0&&d.setIridescenceIOR(_.iridescenceIor),_.iridescenceThicknessMinimum!==void 0&&d.setIridescenceThicknessMinimum(_.iridescenceThicknessMinimum),_.iridescenceThicknessMaximum!==void 0&&d.setIridescenceThicknessMaximum(_.iridescenceThicknessMaximum),_.iridescenceTexture!==void 0){const et=_.iridescenceTexture;d.setIridescenceTexture(e.textures[s[et.index].source]),e.setTextureInfo(d.getIridescenceTextureInfo(),et)}if(_.iridescenceThicknessTexture!==void 0){const et=_.iridescenceThicknessTexture;d.setIridescenceThicknessTexture(e.textures[s[et.index].source]),e.setTextureInfo(d.getIridescenceThicknessTextureInfo(),et)}}}),this}write(e){const i=e.jsonDoc;return this.document.getRoot().listMaterials().forEach(s=>{const a=s.getExtension(t1);if(a){const h=e.materialIndexMap.get(s),d=i.json.materials[h];d.extensions=d.extensions||{};const _=d.extensions[t1]={};if(a.getIridescenceFactor()>0&&(_.iridescenceFactor=a.getIridescenceFactor()),a.getIridescenceIOR()!==1.3&&(_.iridescenceIor=a.getIridescenceIOR()),a.getIridescenceThicknessMinimum()!==100&&(_.iridescenceThicknessMinimum=a.getIridescenceThicknessMinimum()),a.getIridescenceThicknessMaximum()!==400&&(_.iridescenceThicknessMaximum=a.getIridescenceThicknessMaximum()),a.getIridescenceTexture()){const et=a.getIridescenceTexture(),nt=a.getIridescenceTextureInfo();_.iridescenceTexture=e.createTextureInfoDef(et,nt)}if(a.getIridescenceThicknessTexture()){const et=a.getIridescenceThicknessTexture(),nt=a.getIridescenceThicknessTextureInfo();_.iridescenceThicknessTexture=e.createTextureInfoDef(et,nt)}}}),this}}wB.EXTENSION_NAME=t1;const{R:xB,G:bB,B:EB,A:SB}=cu;class CB extends uu{init(){this.extensionName="KHR_materials_pbrSpecularGlossiness",this.propertyType="PBRSpecularGlossiness",this.parentTypes=[Yr.MATERIAL]}getDefaults(){return Object.assign(super.getDefaults(),{diffuseFactor:[1,1,1,1],diffuseTexture:null,diffuseTextureInfo:new Rl(this.graph,"diffuseTextureInfo"),specularFactor:[1,1,1],glossinessFactor:1,specularGlossinessTexture:null,specularGlossinessTextureInfo:new Rl(this.graph,"specularGlossinessTextureInfo")})}getDiffuseFactor(){return this.get("diffuseFactor")}setDiffuseFactor(e){return this.set("diffuseFactor",e)}getDiffuseHex(){return Tm.factorToHex(this.getDiffuseFactor())}setDiffuseHex(e){const i=this.getDiffuseFactor().slice();return this.setDiffuseFactor(Tm.hexToFactor(e,i))}getDiffuseTexture(){return this.getRef("diffuseTexture")}getDiffuseTextureInfo(){return this.getRef("diffuseTexture")?this.getRef("diffuseTextureInfo"):null}setDiffuseTexture(e){return this.setRef("diffuseTexture",e,{channels:xB|bB|EB|SB})}getSpecularFactor(){return this.get("specularFactor")}setSpecularFactor(e){return this.set("specularFactor",e)}getGlossinessFactor(){return this.get("glossinessFactor")}setGlossinessFactor(e){return this.set("glossinessFactor",e)}getSpecularGlossinessTexture(){return this.getRef("specularGlossinessTexture")}getSpecularGlossinessTextureInfo(){return this.getRef("specularGlossinessTexture")?this.getRef("specularGlossinessTextureInfo"):null}setSpecularGlossinessTexture(e){return this.setRef("specularGlossinessTexture",e,{channels:xB|bB|EB|SB})}}CB.EXTENSION_NAME="KHR_materials_pbrSpecularGlossiness";const n1="KHR_materials_pbrSpecularGlossiness";class MB extends Ql{constructor(...e){super(...e),this.extensionName=n1}createPBRSpecularGlossiness(){return new CB(this.document.getGraph())}read(e){const i=e.jsonDoc,s=i.json.textures||[];return(i.json.materials||[]).forEach((a,h)=>{if(a.extensions&&a.extensions[n1]){const d=this.createPBRSpecularGlossiness();e.materials[h].setExtension(n1,d);const _=a.extensions[n1];if(_.diffuseFactor!==void 0&&d.setDiffuseFactor(_.diffuseFactor),_.specularFactor!==void 0&&d.setSpecularFactor(_.specularFactor),_.glossinessFactor!==void 0&&d.setGlossinessFactor(_.glossinessFactor),_.diffuseTexture!==void 0){const et=_.diffuseTexture;d.setDiffuseTexture(e.textures[s[et.index].source]),e.setTextureInfo(d.getDiffuseTextureInfo(),et)}if(_.specularGlossinessTexture!==void 0){const et=_.specularGlossinessTexture;d.setSpecularGlossinessTexture(e.textures[s[et.index].source]),e.setTextureInfo(d.getSpecularGlossinessTextureInfo(),et)}}}),this}write(e){const i=e.jsonDoc;return this.document.getRoot().listMaterials().forEach(s=>{const a=s.getExtension(n1);if(a){const h=e.materialIndexMap.get(s),d=i.json.materials[h];d.extensions=d.extensions||{};const _=d.extensions[n1]={diffuseFactor:a.getDiffuseFactor(),specularFactor:a.getSpecularFactor(),glossinessFactor:a.getGlossinessFactor()};if(a.getDiffuseTexture()){const et=a.getDiffuseTexture(),nt=a.getDiffuseTextureInfo();_.diffuseTexture=e.createTextureInfoDef(et,nt)}if(a.getSpecularGlossinessTexture()){const et=a.getSpecularGlossinessTexture(),nt=a.getSpecularGlossinessTextureInfo();_.specularGlossinessTexture=e.createTextureInfoDef(et,nt)}}}),this}}MB.EXTENSION_NAME=n1;const{R:oN,G:aN,B:lN,A:cN}=cu;class TB extends uu{init(){this.extensionName="KHR_materials_sheen",this.propertyType="Sheen",this.parentTypes=[Yr.MATERIAL]}getDefaults(){return Object.assign(super.getDefaults(),{sheenColorFactor:[0,0,0],sheenColorTexture:null,sheenColorTextureInfo:new Rl(this.graph,"sheenColorTextureInfo"),sheenRoughnessFactor:0,sheenRoughnessTexture:null,sheenRoughnessTextureInfo:new Rl(this.graph,"sheenRoughnessTextureInfo")})}getSheenColorFactor(){return this.get("sheenColorFactor")}getSheenColorHex(){return Tm.factorToHex(this.getSheenColorFactor())}setSheenColorFactor(e){return this.set("sheenColorFactor",e)}setSheenColorHex(e){const i=this.getSheenColorFactor().slice();return this.set("sheenColorFactor",Tm.hexToFactor(e,i))}getSheenColorTexture(){return this.getRef("sheenColorTexture")}getSheenColorTextureInfo(){return this.getRef("sheenColorTexture")?this.getRef("sheenColorTextureInfo"):null}setSheenColorTexture(e){return this.setRef("sheenColorTexture",e,{channels:oN|aN|lN})}getSheenRoughnessFactor(){return this.get("sheenRoughnessFactor")}setSheenRoughnessFactor(e){return this.set("sheenRoughnessFactor",e)}getSheenRoughnessTexture(){return this.getRef("sheenRoughnessTexture")}getSheenRoughnessTextureInfo(){return this.getRef("sheenRoughnessTexture")?this.getRef("sheenRoughnessTextureInfo"):null}setSheenRoughnessTexture(e){return this.setRef("sheenRoughnessTexture",e,{channels:cN})}}TB.EXTENSION_NAME="KHR_materials_sheen";const TI="KHR_materials_sheen";class IB extends Ql{constructor(...e){super(...e),this.extensionName=TI}createSheen(){return new TB(this.document.getGraph())}read(e){const i=e.jsonDoc,s=i.json.textures||[];return(i.json.materials||[]).forEach((a,h)=>{if(a.extensions&&a.extensions.KHR_materials_sheen){const d=this.createSheen();e.materials[h].setExtension(TI,d);const _=a.extensions.KHR_materials_sheen;if(_.sheenColorFactor!==void 0&&d.setSheenColorFactor(_.sheenColorFactor),_.sheenRoughnessFactor!==void 0&&d.setSheenRoughnessFactor(_.sheenRoughnessFactor),_.sheenColorTexture!==void 0){const et=_.sheenColorTexture;d.setSheenColorTexture(e.textures[s[et.index].source]),e.setTextureInfo(d.getSheenColorTextureInfo(),et)}if(_.sheenRoughnessTexture!==void 0){const et=_.sheenRoughnessTexture;d.setSheenRoughnessTexture(e.textures[s[et.index].source]),e.setTextureInfo(d.getSheenRoughnessTextureInfo(),et)}}}),this}write(e){const i=e.jsonDoc;return this.document.getRoot().listMaterials().forEach(s=>{const a=s.getExtension(TI);if(a){const h=e.materialIndexMap.get(s),d=i.json.materials[h];d.extensions=d.extensions||{};const _=d.extensions.KHR_materials_sheen={sheenColorFactor:a.getSheenColorFactor(),sheenRoughnessFactor:a.getSheenRoughnessFactor()};if(a.getSheenColorTexture()){const et=a.getSheenColorTexture(),nt=a.getSheenColorTextureInfo();_.sheenColorTexture=e.createTextureInfoDef(et,nt)}if(a.getSheenRoughnessTexture()){const et=a.getSheenRoughnessTexture(),nt=a.getSheenRoughnessTextureInfo();_.sheenRoughnessTexture=e.createTextureInfoDef(et,nt)}}}),this}}IB.EXTENSION_NAME=TI;const{R:uN,G:hN,B:dN,A:pN}=cu;class DB extends uu{init(){this.extensionName="KHR_materials_specular",this.propertyType="Specular",this.parentTypes=[Yr.MATERIAL]}getDefaults(){return Object.assign(super.getDefaults(),{specularFactor:1,specularTexture:null,specularTextureInfo:new Rl(this.graph,"specularTextureInfo"),specularColorFactor:[1,1,1],specularColorTexture:null,specularColorTextureInfo:new Rl(this.graph,"specularColorTextureInfo")})}getSpecularFactor(){return this.get("specularFactor")}setSpecularFactor(e){return this.set("specularFactor",e)}getSpecularColorFactor(){return this.get("specularColorFactor")}setSpecularColorFactor(e){return this.set("specularColorFactor",e)}getSpecularColorHex(){return Tm.factorToHex(this.getSpecularColorFactor())}setSpecularColorHex(e){const i=this.getSpecularColorFactor().slice();return this.set("specularColorFactor",Tm.hexToFactor(e,i))}getSpecularTexture(){return this.getRef("specularTexture")}getSpecularTextureInfo(){return this.getRef("specularTexture")?this.getRef("specularTextureInfo"):null}setSpecularTexture(e){return this.setRef("specularTexture",e,{channels:pN})}getSpecularColorTexture(){return this.getRef("specularColorTexture")}getSpecularColorTextureInfo(){return this.getRef("specularColorTexture")?this.getRef("specularColorTextureInfo"):null}setSpecularColorTexture(e){return this.setRef("specularColorTexture",e,{channels:uN|hN|dN})}}DB.EXTENSION_NAME="KHR_materials_specular";const i1="KHR_materials_specular";class PB extends Ql{constructor(...e){super(...e),this.extensionName=i1}createSpecular(){return new DB(this.document.getGraph())}read(e){const i=e.jsonDoc,s=i.json.textures||[];return(i.json.materials||[]).forEach((a,h)=>{if(a.extensions&&a.extensions[i1]){const d=this.createSpecular();e.materials[h].setExtension(i1,d);const _=a.extensions[i1];if(_.specularFactor!==void 0&&d.setSpecularFactor(_.specularFactor),_.specularColorFactor!==void 0&&d.setSpecularColorFactor(_.specularColorFactor),_.specularTexture!==void 0){const et=_.specularTexture;d.setSpecularTexture(e.textures[s[et.index].source]),e.setTextureInfo(d.getSpecularTextureInfo(),et)}if(_.specularColorTexture!==void 0){const et=_.specularColorTexture;d.setSpecularColorTexture(e.textures[s[et.index].source]),e.setTextureInfo(d.getSpecularColorTextureInfo(),et)}}}),this}write(e){const i=e.jsonDoc;return this.document.getRoot().listMaterials().forEach(s=>{const a=s.getExtension(i1);if(a){const h=e.materialIndexMap.get(s),d=i.json.materials[h];d.extensions=d.extensions||{};const _=d.extensions[i1]={};if(a.getSpecularFactor()!==1&&(_.specularFactor=a.getSpecularFactor()),$l.eq(a.getSpecularColorFactor(),[1,1,1])||(_.specularColorFactor=a.getSpecularColorFactor()),a.getSpecularTexture()){const et=a.getSpecularTexture(),nt=a.getSpecularTextureInfo();_.specularTexture=e.createTextureInfoDef(et,nt)}if(a.getSpecularColorTexture()){const et=a.getSpecularColorTexture(),nt=a.getSpecularColorTextureInfo();_.specularColorTexture=e.createTextureInfoDef(et,nt)}}}),this}}PB.EXTENSION_NAME=i1;const{R:fN}=cu;class RB extends uu{init(){this.extensionName="KHR_materials_transmission",this.propertyType="Transmission",this.parentTypes=[Yr.MATERIAL]}getDefaults(){return Object.assign(super.getDefaults(),{transmissionFactor:0,transmissionTexture:null,transmissionTextureInfo:new Rl(this.graph,"transmissionTextureInfo")})}getTransmissionFactor(){return this.get("transmissionFactor")}setTransmissionFactor(e){return this.set("transmissionFactor",e)}getTransmissionTexture(){return this.getRef("transmissionTexture")}getTransmissionTextureInfo(){return this.getRef("transmissionTexture")?this.getRef("transmissionTextureInfo"):null}setTransmissionTexture(e){return this.setRef("transmissionTexture",e,{channels:fN})}}RB.EXTENSION_NAME="KHR_materials_transmission";const r1="KHR_materials_transmission";class BB extends Ql{constructor(...e){super(...e),this.extensionName=r1}createTransmission(){return new RB(this.document.getGraph())}read(e){const i=e.jsonDoc,s=i.json.textures||[];return(i.json.materials||[]).forEach((a,h)=>{if(a.extensions&&a.extensions[r1]){const d=this.createTransmission();e.materials[h].setExtension(r1,d);const _=a.extensions[r1];if(_.transmissionFactor!==void 0&&d.setTransmissionFactor(_.transmissionFactor),_.transmissionTexture!==void 0){const et=_.transmissionTexture;d.setTransmissionTexture(e.textures[s[et.index].source]),e.setTextureInfo(d.getTransmissionTextureInfo(),et)}}}),this}write(e){const i=e.jsonDoc;return this.document.getRoot().listMaterials().forEach(s=>{const a=s.getExtension(r1);if(a){const h=e.materialIndexMap.get(s),d=i.json.materials[h];d.extensions=d.extensions||{};const _=d.extensions[r1]={transmissionFactor:a.getTransmissionFactor()};if(a.getTransmissionTexture()){const et=a.getTransmissionTexture(),nt=a.getTransmissionTextureInfo();_.transmissionTexture=e.createTextureInfoDef(et,nt)}}}),this}}BB.EXTENSION_NAME=r1;class kB extends uu{init(){this.extensionName="KHR_materials_unlit",this.propertyType="Unlit",this.parentTypes=[Yr.MATERIAL]}}kB.EXTENSION_NAME="KHR_materials_unlit";const II="KHR_materials_unlit";class OB extends Ql{constructor(...e){super(...e),this.extensionName=II}createUnlit(){return new kB(this.document.getGraph())}read(e){return(e.jsonDoc.json.materials||[]).forEach((i,s)=>{i.extensions&&i.extensions.KHR_materials_unlit&&e.materials[s].setExtension(II,this.createUnlit())}),this}write(e){const i=e.jsonDoc;return this.document.getRoot().listMaterials().forEach(s=>{if(s.getExtension(II)){const a=e.materialIndexMap.get(s),h=i.json.materials[a];h.extensions=h.extensions||{},h.extensions.KHR_materials_unlit={}}}),this}}OB.EXTENSION_NAME=II;class LB extends uu{init(){this.extensionName="KHR_materials_variants",this.propertyType="Mapping",this.parentTypes=["MappingList"]}getDefaults(){return Object.assign(super.getDefaults(),{material:null,variants:[]})}getMaterial(){return this.getRef("material")}setMaterial(e){return this.setRef("material",e)}addVariant(e){return this.addRef("variants",e)}removeVariant(e){return this.removeRef("variants",e)}listVariants(){return this.listRefs("variants")}}LB.EXTENSION_NAME="KHR_materials_variants";class NB extends uu{init(){this.extensionName="KHR_materials_variants",this.propertyType="MappingList",this.parentTypes=[Yr.PRIMITIVE]}getDefaults(){return Object.assign(super.getDefaults(),{mappings:[]})}addMapping(e){return this.addRef("mappings",e)}removeMapping(e){return this.removeRef("mappings",e)}listMappings(){return this.listRefs("mappings")}}NB.EXTENSION_NAME="KHR_materials_variants";class nP extends uu{init(){this.extensionName="KHR_materials_variants",this.propertyType="Variant",this.parentTypes=["MappingList"]}}nP.EXTENSION_NAME="KHR_materials_variants";const N_="KHR_materials_variants";class UB extends Ql{constructor(...e){super(...e),this.extensionName=N_}createMappingList(){return new NB(this.document.getGraph())}createVariant(e=""){return new nP(this.document.getGraph(),e)}createMapping(){return new LB(this.document.getGraph())}listVariants(){return Array.from(this.properties).filter(e=>e instanceof nP)}read(e){const i=e.jsonDoc;if(!i.json.extensions||!i.json.extensions[N_])return this;const s=(i.json.extensions[N_].variants||[]).map(a=>this.createVariant().setName(a.name||""));return(i.json.meshes||[]).forEach((a,h)=>{const d=e.meshes[h];(a.primitives||[]).forEach((_,et)=>{if(!_.extensions||!_.extensions[N_])return;const nt=this.createMappingList(),it=_.extensions[N_];for(const lt of it.mappings){const ut=this.createMapping();lt.material!==void 0&&ut.setMaterial(e.materials[lt.material]);for(const pt of lt.variants||[])ut.addVariant(s[pt]);nt.addMapping(ut)}d.listPrimitives()[et].setExtension(N_,nt)})}),this}write(e){const i=e.jsonDoc,s=this.listVariants();if(!s.length)return this;const a=[],h=new Map;for(const d of s)h.set(d,a.length),a.push(e.createPropertyDef(d));for(const d of this.document.getRoot().listMeshes()){const _=e.meshIndexMap.get(d);d.listPrimitives().forEach((et,nt)=>{const it=et.getExtension(N_);if(!it)return;const lt=e.jsonDoc.json.meshes[_].primitives[nt],ut=it.listMappings().map(pt=>{const gt=e.createPropertyDef(pt),vt=pt.getMaterial();return vt&&(gt.material=e.materialIndexMap.get(vt)),gt.variants=pt.listVariants().map(Ct=>h.get(Ct)),gt});lt.extensions=lt.extensions||{},lt.extensions[N_]={mappings:ut}})}return i.json.extensions=i.json.extensions||{},i.json.extensions[N_]={variants:a},this}}UB.EXTENSION_NAME=N_;const{G:mN}=cu;class FB extends uu{init(){this.extensionName="KHR_materials_volume",this.propertyType="Volume",this.parentTypes=[Yr.MATERIAL]}getDefaults(){return Object.assign(super.getDefaults(),{thicknessFactor:0,thicknessTexture:null,thicknessTextureInfo:new Rl(this.graph,"thicknessTexture"),attenuationDistance:1/0,attenuationColor:[1,1,1]})}getThicknessFactor(){return this.get("thicknessFactor")}setThicknessFactor(e){return this.set("thicknessFactor",e)}getThicknessTexture(){return this.getRef("thicknessTexture")}getThicknessTextureInfo(){return this.getRef("thicknessTexture")?this.getRef("thicknessTextureInfo"):null}setThicknessTexture(e){return this.setRef("thicknessTexture",e,{channels:mN})}getAttenuationDistance(){return this.get("attenuationDistance")}setAttenuationDistance(e){return this.set("attenuationDistance",e)}getAttenuationColor(){return this.get("attenuationColor")}setAttenuationColor(e){return this.set("attenuationColor",e)}getAttenuationColorHex(){return Tm.factorToHex(this.getAttenuationColor())}setAttenuationColorHex(e){const i=this.getAttenuationColor().slice();return this.set("attenuationColor",Tm.hexToFactor(e,i))}}FB.EXTENSION_NAME="KHR_materials_volume";const DI="KHR_materials_volume";class jB extends Ql{constructor(...e){super(...e),this.extensionName=DI}createVolume(){return new FB(this.document.getGraph())}read(e){const i=e.jsonDoc,s=i.json.textures||[];return(i.json.materials||[]).forEach((a,h)=>{if(a.extensions&&a.extensions.KHR_materials_volume){const d=this.createVolume();e.materials[h].setExtension(DI,d);const _=a.extensions.KHR_materials_volume;if(_.thicknessFactor!==void 0&&d.setThicknessFactor(_.thicknessFactor),_.attenuationDistance!==void 0&&d.setAttenuationDistance(_.attenuationDistance),_.attenuationColor!==void 0&&d.setAttenuationColor(_.attenuationColor),_.thicknessTexture!==void 0){const et=_.thicknessTexture;d.setThicknessTexture(e.textures[s[et.index].source]),e.setTextureInfo(d.getThicknessTextureInfo(),et)}}}),this}write(e){const i=e.jsonDoc;return this.document.getRoot().listMaterials().forEach(s=>{const a=s.getExtension(DI);if(a){const h=e.materialIndexMap.get(s),d=i.json.materials[h];d.extensions=d.extensions||{};const _=d.extensions.KHR_materials_volume={};if(a.getThicknessFactor()>0&&(_.thicknessFactor=a.getThicknessFactor()),Number.isFinite(a.getAttenuationDistance())&&(_.attenuationDistance=a.getAttenuationDistance()),$l.eq(a.getAttenuationColor(),[1,1,1])||(_.attenuationColor=a.getAttenuationColor()),a.getThicknessTexture()){const et=a.getThicknessTexture(),nt=a.getThicknessTextureInfo();_.thicknessTexture=e.createTextureInfoDef(et,nt)}}}),this}}jB.EXTENSION_NAME=DI;const zB="KHR_mesh_quantization";class VB extends Ql{constructor(...e){super(...e),this.extensionName=zB}read(e){return this}write(e){return this}}VB.EXTENSION_NAME=zB;const QB="KHR_texture_basisu";class gN{match(e){return e[0]===171&&e[1]===75&&e[2]===84&&e[3]===88&&e[4]===32&&e[5]===50&&e[6]===48&&e[7]===187&&e[8]===13&&e[9]===10&&e[10]===26&&e[11]===10}getSize(e){const i=eP(e);return[i.pixelWidth,i.pixelHeight]}getChannels(e){const i=eP(e).dataFormatDescriptor[0];if(i.colorModel===163)return i.samples.length===2&&(15&i.samples[1].channelType)==15?4:3;if(i.colorModel===166)return(15&i.samples[0].channelType)==3?4:3;throw new Error(`Unexpected KTX2 colorModel, "${i.colorModel}".`)}getGPUByteLength(e){const i=eP(e),s=this.getChannels(e)>3;let a=0;for(let h=0;h<i.levels.length;h++){const d=i.levels[h];a+=d.uncompressedByteLength?d.uncompressedByteLength:Math.max(1,Math.floor(i.pixelWidth/Math.pow(2,h)))/4*(Math.max(1,Math.floor(i.pixelHeight/Math.pow(2,h)))/4)*(s?16:8)}return a}}class GB extends Ql{constructor(...e){super(...e),this.extensionName=QB,this.prereadTypes=[Yr.TEXTURE]}static register(){ay.registerFormat("image/ktx2",new gN)}preread(e){return e.jsonDoc.json.textures.forEach(i=>{i.extensions&&i.extensions.KHR_texture_basisu&&(i.source=i.extensions.KHR_texture_basisu.source)}),this}read(e){return this}write(e){const i=e.jsonDoc;return this.document.getRoot().listTextures().forEach(s=>{if(s.getMimeType()==="image/ktx2"){const a=e.imageIndexMap.get(s);i.json.textures.forEach(h=>{h.source===a&&(h.extensions=h.extensions||{},h.extensions.KHR_texture_basisu={source:h.source},delete h.source)})}}),this}}GB.EXTENSION_NAME=QB;class HB extends uu{init(){this.extensionName="KHR_texture_transform",this.propertyType="Transform",this.parentTypes=[Yr.TEXTURE_INFO]}getDefaults(){return Object.assign(super.getDefaults(),{offset:[0,0],rotation:0,scale:[1,1],texCoord:null})}getOffset(){return this.get("offset")}setOffset(e){return this.set("offset",e)}getRotation(){return this.get("rotation")}setRotation(e){return this.set("rotation",e)}getScale(){return this.get("scale")}setScale(e){return this.set("scale",e)}getTexCoord(){return this.get("texCoord")}setTexCoord(e){return this.set("texCoord",e)}}HB.EXTENSION_NAME="KHR_texture_transform";const PI="KHR_texture_transform";class WB extends Ql{constructor(...e){super(...e),this.extensionName=PI}createTransform(){return new HB(this.document.getGraph())}read(e){for(const[i,s]of Array.from(e.textureInfos.entries())){if(!s.extensions||!s.extensions.KHR_texture_transform)continue;const a=this.createTransform(),h=s.extensions.KHR_texture_transform;h.offset!==void 0&&a.setOffset(h.offset),h.rotation!==void 0&&a.setRotation(h.rotation),h.scale!==void 0&&a.setScale(h.scale),h.texCoord!==void 0&&a.setTexCoord(h.texCoord),i.setExtension(PI,a)}return this}write(e){const i=Array.from(e.textureInfoDefMap.entries());for(const[s,a]of i){const h=s.getExtension(PI);if(!h)continue;a.extensions=a.extensions||{};const d={},_=$l.eq;_(h.getOffset(),[0,0])||(d.offset=h.getOffset()),h.getRotation()!==0&&(d.rotation=h.getRotation()),_(h.getScale(),[1,1])||(d.scale=h.getScale()),h.getTexCoord()!=null&&(d.texCoord=h.getTexCoord()),a.extensions.KHR_texture_transform=d}return this}}WB.EXTENSION_NAME=PI;const vN=[Yr.ROOT,Yr.SCENE,Yr.NODE,Yr.MESH,Yr.MATERIAL,Yr.TEXTURE,Yr.ANIMATION];class qB extends uu{init(){this.extensionName="KHR_xmp_json_ld",this.propertyType="Packet",this.parentTypes=vN}getDefaults(){return Object.assign(super.getDefaults(),{context:{},properties:{}})}getContext(){return this.get("context")}setContext(e){return this.set("context",xw({},e))}listProperties(){return Object.keys(this.get("properties"))}getProperty(e){const i=this.get("properties");return e in i?i[e]:null}setProperty(e,i){this._assertContext(e);const s=xw({},this.get("properties"));return i?s[e]=i:delete s[e],this.set("properties",s)}toJSONLD(){return xw({"@context":iP(this.get("context"))},iP(this.get("properties")))}fromJSONLD(e){const i=(e=iP(e))["@context"];return i&&this.set("context",i),delete e["@context"],this.set("properties",e)}_assertContext(e){if(!(e.split(":")[0]in this.get("context")))throw new Error(`KHR_xmp_json_ld: Missing context for term, "${e}".`)}}function iP(c){return JSON.parse(JSON.stringify(c))}qB.EXTENSION_NAME="KHR_xmp_json_ld";const rP="KHR_xmp_json_ld";class YB extends Ql{constructor(...e){super(...e),this.extensionName=rP}createPacket(){return new qB(this.document.getGraph())}listPackets(){return Array.from(this.properties)}read(e){var i;const s=(i=e.jsonDoc.json.extensions)==null?void 0:i.KHR_xmp_json_ld;if(!s||!s.packets)return this;const a=e.jsonDoc.json,h=this.document.getRoot(),d=s.packets.map(nt=>this.createPacket().fromJSONLD(nt)),_=[[a.asset],a.scenes,a.nodes,a.meshes,a.materials,a.images,a.animations],et=[[h],h.listScenes(),h.listNodes(),h.listMeshes(),h.listMaterials(),h.listTextures(),h.listAnimations()];for(let nt=0;nt<_.length;nt++){const it=_[nt]||[];for(let lt=0;lt<it.length;lt++){const ut=it[lt];ut.extensions&&ut.extensions.KHR_xmp_json_ld&&et[nt][lt].setExtension(rP,d[ut.extensions.KHR_xmp_json_ld.packet])}}return this}write(e){const{json:i}=e.jsonDoc,s=[];for(const a of this.properties){s.push(a.toJSONLD());for(const h of a.listParents()){let d;switch(h.propertyType){case Yr.ROOT:d=i.asset;break;case Yr.SCENE:d=i.scenes[e.sceneIndexMap.get(h)];break;case Yr.NODE:d=i.nodes[e.nodeIndexMap.get(h)];break;case Yr.MESH:d=i.meshes[e.meshIndexMap.get(h)];break;case Yr.MATERIAL:d=i.materials[e.materialIndexMap.get(h)];break;case Yr.TEXTURE:d=i.images[e.imageIndexMap.get(h)];break;case Yr.ANIMATION:d=i.animations[e.animationIndexMap.get(h)];break;default:d=null,this.document.getLogger().warn(`[KHR_xmp_json_ld]: Unsupported parent property, "${h.propertyType}"`)}d&&(d.extensions=d.extensions||{},d.extensions.KHR_xmp_json_ld={packet:s.length-1})}}return s.length>0&&(i.extensions=i.extensions||{},i.extensions.KHR_xmp_json_ld={packets:s}),this}}YB.EXTENSION_NAME=rP;const _N=[aM,hB,mB,vB,AB,wB,MB,PB,IB,BB,OB,UB,jB,VB,GB,WB,YB];let sP=class extends o_{constructor(c,e,i){super(c,e,i??new AN,new mo(0,0,0),1),this.enabled=!0,this._firstCall=!0}render(c,e,i,s,a){this.enabled&&super.render(c,e,i,s,a)}};sP=function(c,e,i,s){var a,h=arguments.length,d=h<3?e:s===null?s=Object.getOwnPropertyDescriptor(e,i):s;if(typeof Reflect=="object"&&typeof Reflect.decorate=="function")d=Reflect.decorate(c,e,i,s);else for(var _=c.length-1;_>=0;_--)(a=c[_])&&(d=(h<3?a(d):h>3?a(e,i,d):a(e,i))||d);return h>3&&d&&Object.defineProperty(e,i,d),d}([Ys("High precision Normal Buffer")],sP);class AN extends b.RSm{constructor(){super()}onBeforeRender(e,i,s,a,h){var d,_;let et=h.material;Array.isArray(et)&&(et=et[0]),this.normalMap=(d=et==null?void 0:et.normalMap)!==null&&d!==void 0?d:null,this.needsUpdate=!0,this.side=(_=et.side)!==null&&_!==void 0?_:b.ehD}}class s1 extends Am{constructor(e=!0){super(),this.passId="normalBuffer",this._beforeFilters=["render"],this._afterFilters=[],this._requiredFilters=["render"],this.enabled=e}passCtor(e){this._normalTarget=e.renderer.createTarget({depthBuffer:!0,type:b.cLu,minFilter:b.TyD,magFilter:b.TyD,generateMipmaps:!1}),this._normalTarget.texture.name="normalBuffer",this._normalTarget.texture.generateMipmaps=!1;const i=this._normalTarget,s=new Set,a=new Set;return new class extends sP{render(h,d,_,et,nt){const it=h.getRenderTarget(),lt=h.getActiveCubeFace(),ut=h.getActiveMipmapLevel();this.scene&&(this.scene.traverse(({material:pt})=>{pt&&((pt.transparent&&pt.userData.renderToDepth||!pt.transparent&&pt.transmission===0&&pt.userData.renderToDepth===!1)&&(s.add(pt),pt.transparent=!pt.transparent),Math.abs(pt.transmission||0)>0&&pt.userData.renderToDepth&&(a.add([pt,pt.transmission]),pt.transmission=0))}),zr(h,{shadowMapRender:!1,backgroundRender:!1,opaqueRender:!0,transparentRender:!1,transmissionRender:!1,mainRenderPass:!1},()=>super.render(h,d,i,et,nt)),s.forEach(pt=>pt.transparent=!pt.transparent),s.clear(),a.forEach(([pt,gt])=>pt.transmission=gt),a.clear(),h.setRenderTarget(it,lt,ut))}}}_update(e){if(!super._update(e))return!1;const i=this.pass.passObject;return i.scene=e.scene.modelObject,i.camera=e.scene.activeCamera.cameraObject,!0}getNormalBuffer(){return this._normalTarget}async onDispose(e){}async onRemove(e){var i,s;return e.renderer.disposeTarget((s=(i=this._normalTarget)===null||i===void 0?void 0:i.dispose)===null||s===void 0?void 0:s.call(i)),super.onRemove(e)}updateShaderProperties(e){var i,s;return e.uniforms.tNormalBuffer?e.uniforms.tNormalBuffer.value=this.enabled&&(s=(i=this.getNormalBuffer())===null||i===void 0?void 0:i.texture)!==null&&s!==void 0?s:null:console.warn("BaseRenderer: no uniform: tNormalBuffer"),this}get uiConfig(){var e;return(e=this.pass)===null||e===void 0?void 0:e.passObject.uiConfig}}s1.PluginType="NormalBufferPlugin";function XB(c){const e=c==null?void 0:c.userData;if(!e)return!1;e._ssBevel||(e._ssBevel={});const i=e._ssBevel;return i.hasSSBevel=!0,i.radius===void 0&&(i.radius=0),c.isMaterial&&(c.needsUpdate=!0),!0}let oP=class extends Tl{constructor(c,e,i,s){super({defines:{NUM_SAMPLES:16},uniforms:{tNormalDepth:{value:null},tNormalBuffer:{value:null},tGBufferFlags:{value:null},edgeMaskBuffer:{value:null},screenSize:{value:new b.FM8},radius:{value:1},samples:{value:null},frameCount:{value:0},cameraPositionWorld:{value:new b.Pa4(1,1,1)}},vertexShader:Km,fragmentShader:`

            ${i}

            ${Jm}

            uniform sampler2D tNormalBuffer;uniform sampler2D edgeMaskBuffer;uniform vec2 screenSize;const float depthStep=0.02;uniform vec2 samples[NUM_SAMPLES];uniform vec3 cameraPositionWorld;varying vec2 vUv;
#include <common>
float getBevelRadius(in float number){return floor(number/8.);}vec3 smoothNormal(){vec2 uv=gl_FragCoord.xy/screenSize;vec4 texel=texture2D(tNormalDepth,uv);vec4 edgeMask=texture2D(edgeMaskBuffer,uv);vec3 avgNormal=2.*texture2D(tNormalBuffer,uv).rgb-1.;float depth=pow(unpack16(texel.xy),2.);vec2 invScreenSize=vec2(1.)/screenSize;vec4 mask=texture2D(tGBufferFlags,uv);float weightSum=0.;float radius=getBevelRadius(mask.g*255.)*2.;float randomAngle=6.2*random(frameCount*0.1);float theta=randomAngle;float snTheta=sin(theta);float csTheta=cos(theta);mat2 randomRotationMatrix=mat2(csTheta,snTheta,-snTheta,csTheta);float d_=dot(cameraPositionWorld,cameraPositionWorld);float radiusModifier=clamp(1./(1.+pow(d_,0.5)),0.,1.);for(int i=0;i<5;i++){float x=float(i)-2.;for(int j=0;j<5;j++){float y=float(j)-2.;vec2 offset=randomRotationMatrix*vec2(x,y)*radius*radiusModifier*invScreenSize;vec4 texel=texture2D(tNormalDepth,uv+offset);float offsetDepth=pow(unpack16(texel.xy),2.);float depthWeight=abs(offsetDepth-depth);depthWeight=(1.-step(depthStep,depthWeight));vec3 offsetNormal=2.*texture2D(tNormalBuffer,uv+offset).rgb-1.;if(dot(offsetNormal,offsetNormal)>0.){avgNormal+=offsetNormal*depthWeight;}}}return normalize(avgNormal);}void main(){vec2 uv=gl_FragCoord.xy/screenSize;vec4 edgeMask=texture2D(edgeMaskBuffer,uv);vec3 normal=vec3(0.);if(edgeMask.x>0.){normal=smoothNormal();}else{normal=2.*texture2D(tNormalBuffer,uv).rgb-1.;}gl_FragColor=vec4(vec3(0.5*normal+0.5),1.);}
            
            `},"tDiffuse"),this.uiConfig=void 0,this.materialExtension={shaderExtender:(a,h,d)=>{var _,et;this.enabled&&(!((et=(_=h.materialObject.userData)===null||_===void 0?void 0:_._ssBevel)===null||et===void 0)&&et.hasSSBevel)&&(a.fragmentShader=Ho(a.fragmentShader,"#include <normal_fragment_maps>",` 
                normal = 2. * texture2D(tSSBevelMap, viewToScreen(vViewPosition.xyz).xy).rgb - 1.;
                normal = normalize(normal);
                //geometryNormal = normal;
            `))},onObjectRender:(a,h,d)=>{var _,et;if(!this.enabled||!(!((et=(_=h.materialObject.userData)===null||_===void 0?void 0:_._ssBevel)===null||et===void 0)&&et.hasSSBevel))return;const nt=h.materialObject,it=this._target.texture;this.materialExtension.extraUniforms.tSSBevelMap.value!==it&&(this.materialExtension.extraUniforms.tSSBevelMap.value=it,nt.needsUpdate=!0)},getUiConfig:a=>{const h={type:"folder",label:"SSBevel (Dev)",children:[{type:"checkbox",label:"Enabled",get value(){var d;return((d=a.materialObject.userData._ssBevel)===null||d===void 0?void 0:d.hasSSBevel)||!1},set value(d){var _,et;d!==((_=a.materialObject.userData._ssBevel)===null||_===void 0?void 0:_.hasSSBevel)&&(d?XB(a.materialObject)||alert("Cannot add screen space bevel."):(a.materialObject.userData._ssBevel.hasSSBevel=!1,a.materialObject.needsUpdate=!0),(et=h.uiRefresh)===null||et===void 0||et.call(h,"postFrame",!0))},onChange:this.setDirty},()=>({type:"slider",bounds:[0,8],label:"radius",hidden:()=>{var d;return!(!((d=a.materialObject.userData._ssBevel)===null||d===void 0)&&d.hasSSBevel)},property:[a.materialObject.userData._ssBevel,"radius"],onChange:this.setDirty})]};return h},parsFragmentSnippet:(a,h)=>{var d,_;return this.enabled&&(!((_=(d=h==null?void 0:h.materialObject.userData)===null||d===void 0?void 0:d._ssBevel)===null||_===void 0)&&_.hasSSBevel)?Qt`
            uniform sampler2D tSSBevelMap;
            ${H1}
            `:""},extraUniforms:{tSSBevelMap:{value:null}},computeCacheKey:a=>{var h,d;return(this.enabled?"1":"0")+(!((d=(h=a.materialObject.userData)===null||h===void 0?void 0:h._ssBevel)===null||d===void 0)&&d.hasSSBevel?"1":"0")},isCompatible:a=>a.isMeshStandardMaterial2},this._target=e,this.needsSwap=!1,this.clear=!0,this._viewerApp=s,this._edgeMaterial=new l0({uniforms:{tNormalDepth:{value:null},tNormalBuffer:{value:null},tGBufferFlags:{value:null},screenSize:{value:null},radius:{value:10},cameraNearFar:{value:new b.FM8(1,1)},cameraPositionWorld:{value:new b.Pa4(1,1,1)}},vertexShader:Km,fragmentShader:"uniform vec2 screenSize;uniform sampler2D tNormalDepth;uniform sampler2D tNormalBuffer;uniform sampler2D tGBufferFlags;uniform float radius;uniform vec2 cameraNearFar;uniform vec3 cameraPositionWorld;const float depthStep=0.2;const float normalThreshold=0.9;float unpack16(vec2 value){return(value.x*0.996108949416342426275150501169264316558837890625+value.y*0.00389105058365758760263730664519243873655796051025390625);}vec3 unpackNormal(vec2 enc){vec2 fenc=enc*4.-2.;float f=dot(fenc,fenc);float g=sqrt(1.-f/4.);return vec3(fenc*g,1.-f/2.);}void lookupNormalDepth(out float depth,out vec3 normal,vec2 off){vec2 uv=(gl_FragCoord.st+off)/screenSize;vec4 texel=texture2D(tNormalDepth,uv);depth=mix(cameraNearFar.x,cameraNearFar.y,pow(unpack16(texel.xy),2.));normal=2.*texture2D(tNormalBuffer,uv).rgb-1.;}float getBorderWeight(){float depth1,depth2,depth3,depth4;vec3 normal1,normal2,normal3,normal4;float d_=dot(cameraPositionWorld,cameraPositionWorld);float radiusModifier=clamp(3./(1.+pow(d_,0.5)),0.,1.);float modRad=radius;lookupNormalDepth(depth1,normal1,vec2(0.,modRad));lookupNormalDepth(depth2,normal2,vec2(0.,-modRad));lookupNormalDepth(depth3,normal3,vec2(modRad,0.));lookupNormalDepth(depth4,normal4,vec2(-modRad,0.));vec2 uv=(gl_FragCoord.st)/screenSize;float mask=step(0.0001,texture2D(tGBufferFlags,uv).g);float mask1=texture2D(tGBufferFlags,uv+vec2(0.,modRad)/screenSize).b*255.;float mask2=texture2D(tGBufferFlags,uv+vec2(0.,-modRad)/screenSize).b*255.;float mask3=texture2D(tGBufferFlags,uv+vec2(modRad,0.)/screenSize).b*255.;float mask4=texture2D(tGBufferFlags,uv+vec2(-modRad,0.)/screenSize).b*255.;float maskWeight=max(abs(mask1-mask2),abs(mask3-mask4))*255.;maskWeight=(step(maskWeight,0.01));float a1=dot(normal1,normal2);float a2=dot(normal3,normal4);float normalWeight=min(abs(a1),abs(a2));normalWeight=1.-step(normalThreshold,normalWeight);float depthWeight=max(abs(depth1-depth2),abs(depth3-depth4));depthWeight=(step(depthWeight,depthStep));return normalWeight*depthWeight*maskWeight*mask;}void main(){float weight=getBorderWeight();vec2 uv=gl_FragCoord.st/screenSize;vec4 texel=texture2D(tNormalDepth,uv);float depth=pow(unpack16(texel.xy),2.);vec3 outColor=vec3(0.);if(depth>0.999){weight=0.;}else{outColor=vec3(weight);}gl_FragColor=vec4(outColor,1.);}"}),this._separableBlurMaterial=new l0({defines:{KERNEL_RADIUS:3,SIGMA:3},uniforms:{colorTexture:{value:null},maskTexture:{value:null},texSize:{value:new b.FM8(.5,.5)},direction:{value:new b.FM8(.5,.5)}},vertexShader:Km,fragmentShader:"varying vec2 vUv;uniform sampler2D colorTexture;uniform sampler2D maskTexture;uniform vec2 texSize;uniform vec2 direction;float gaussianPdf(in float x,in float sigma){return 0.39894*exp(-0.5*x*x/(sigma*sigma))/sigma;}void main(){vec2 invSize=1./texSize;float fSigma=float(SIGMA);float weightSum=gaussianPdf(0.,fSigma);vec4 mask=texture2D(maskTexture,vUv);vec3 diffuseSum=texture2D(colorTexture,vUv).rgb*weightSum;for(int i=1;i<KERNEL_RADIUS;i++){float x=float(i);float w=gaussianPdf(x,fSigma);vec2 uvOffset=direction*invSize*x;vec3 sample1=texture2D(colorTexture,vUv+uvOffset).rgb;vec3 sample2=texture2D(colorTexture,vUv-uvOffset).rgb;diffuseSum+=(sample1+sample2)*w;weightSum+=2.*w;}gl_FragColor=vec4(diffuseSum/weightSum,1.);}"})}render(c,e,i,s,a){var h,d;if(!this.enabled)return;const _=c.baseRenderer,et={minFilter:b.wem,magFilter:b.wem,isAntialiased:!1,format:b.wk1,depthBuffer:!1,generateMipmaps:!1},nt=_.getTempTarget(et);this._renderEdges(_,nt),this._blurEdges(_,nt),this._viewerApp.scene.activeCamera.updateShaderProperties(this.material),(h=this._viewerApp.getPlugin(ho))===null||h===void 0||h.updateShaderProperties(this.material),(d=this._viewerApp.getPlugin(s1))===null||d===void 0||d.updateShaderProperties(this.material),this._viewerApp.renderer.updateShaderProperties(this.material),this.uniforms.edgeMaskBuffer.value=nt.texture,super.render(c,this._target,nt,s,a),_.releaseTempTarget(nt)}_initsamples(){const c=[];return c.push(new b.FM8(-8,0).multiplyScalar(.125)),c.push(new b.FM8(-6,-4).multiplyScalar(.125)),c.push(new b.FM8(-3,-2).multiplyScalar(.125)),c.push(new b.FM8(-2,-6).multiplyScalar(.125)),c.push(new b.FM8(1,-1).multiplyScalar(.125)),c.push(new b.FM8(2,-5).multiplyScalar(.125)),c.push(new b.FM8(6,-7).multiplyScalar(.125)),c.push(new b.FM8(5,-3).multiplyScalar(.125)),c.push(new b.FM8(4,1).multiplyScalar(.125)),c.push(new b.FM8(7,4).multiplyScalar(.125)),c.push(new b.FM8(3,5).multiplyScalar(.125)),c.push(new b.FM8(0,7).multiplyScalar(.125)),c.push(new b.FM8(-1,3).multiplyScalar(.125)),c.push(new b.FM8(-4,6).multiplyScalar(.125)),c.push(new b.FM8(-7,8).multiplyScalar(.125)),c.push(new b.FM8(-5,2).multiplyScalar(.125)),c}_blurEdges(c,e){var i,s;const a={minFilter:b.wem,magFilter:b.wem,isAntialiased:!1,format:b.wk1,depthBuffer:!1,generateMipmaps:!1,sizeMultiplier:.5},h=c.getTempTarget(a),d=((i=e.texture.image)===null||i===void 0?void 0:i.width)||1,_=((s=e.texture.image)===null||s===void 0?void 0:s.height)||1;this._separableBlurMaterial.uniforms.texSize.value=new b.FM8(d,_),this._separableBlurMaterial.uniforms.colorTexture.value=e.texture,this._separableBlurMaterial.uniforms.direction.value=new b.FM8(1,0),c.blit(void 0,h,{material:this._separableBlurMaterial}),this._separableBlurMaterial.uniforms.texSize.value=new b.FM8(d/2,_/2),this._separableBlurMaterial.uniforms.colorTexture.value=h.texture,this._separableBlurMaterial.uniforms.direction.value=new b.FM8(0,1),c.blit(void 0,e,{material:this._separableBlurMaterial}),c.releaseTempTarget(h)}_renderEdges(c,e){var i,s,a,h;const d=((i=e.texture.image)===null||i===void 0?void 0:i.width)||1,_=((s=e.texture.image)===null||s===void 0?void 0:s.height)||1;this._edgeMaterial.uniforms.screenSize.value=new b.FM8(d,_),this._viewerApp.scene.activeCamera.updateShaderProperties(this._edgeMaterial),(a=this._viewerApp.getPlugin(ho))===null||a===void 0||a.updateShaderProperties(this._edgeMaterial),(h=this._viewerApp.getPlugin(s1))===null||h===void 0||h.updateShaderProperties(this._edgeMaterial),c.blit(void 0,e,{material:this._edgeMaterial})}};oP=function(c,e,i,s){var a,h=arguments.length,d=h<3?e:s===null?s=Object.getOwnPropertyDescriptor(e,i):s;if(typeof Reflect=="object"&&typeof Reflect.decorate=="function")d=Reflect.decorate(c,e,i,s);else for(var _=c.length-1;_>=0;_--)(a=c[_])&&(d=(h<3?a(d):h>3?a(e,i,d):a(e,i))||d);return h>3&&d&&Object.defineProperty(e,i,d),d}([Ys("SSBevel")],oP);class cy extends Am{constructor(e=!0){super(),this.passId="ssBevel",this._beforeFilters=["render"],this._afterFilters=["gbuffer","normalBuffer"],this._requiredFilters=["render","gbuffer","normalBuffer"],this._lastEnabled=!1,this.dependencies=[qr,ho,s1],this.enabled=e,this.setDirty=this.setDirty.bind(this),this._loaderCreate=this._loaderCreate.bind(this),this.updateGBuffer=this.updateGBuffer.bind(this)}get bevelTarget(){return this._bevelTarget}_loaderCreate({loader:e}){e.isGLTFLoader2&&e.register(i=>new yN(i))}passCtor(e){var i,s;this._bevelTarget=e.renderer.createTarget({depthBuffer:!0,type:b.cLu,minFilter:b.TyD,magFilter:b.TyD,generateMipmaps:!1}),this._bevelTarget.texture.name="bevelBuffer",this._bevelTarget.texture.generateMipmaps=!1;const a=e.getPluginByType("debug");return a&&a.addTexture("tempBuffer",()=>this._bevelTarget.texture,[440,50,400,200]),new oP(e.renderer,this._bevelTarget,(s=(i=e.getPlugin(ho))===null||i===void 0?void 0:i.getUnpackSnippet())!==null&&s!==void 0?s:"",e)}async onAdded(e){var i,s,a,h,d,_,et,nt;await super.onAdded(e);const it=e.getPlugin(qr);return!((i=this.pass)===null||i===void 0)&&i.passObject.materialExtension&&((s=it==null?void 0:it.materials)===null||s===void 0||s.registerMaterialExtension((a=this.pass)===null||a===void 0?void 0:a.passObject.materialExtension)),(h=it==null?void 0:it.importer)===null||h===void 0||h.addEventListener("loaderCreate",this._loaderCreate),(et=(_=(d=it==null?void 0:it.exporter)===null||d===void 0?void 0:d.getExporter("gltf","glb"))===null||_===void 0?void 0:_.extensions)===null||et===void 0||et.push(wN),(nt=e.getPlugin(ho))===null||nt===void 0||nt.registerGBufferUpdater(this.updateGBuffer),super.onAdded(e)}async onRemove(e){return e.renderer.disposeTarget(this._bevelTarget),super.onRemove(e)}setDirty(){var e,i,s,a;(e=this._viewer)===null||e===void 0||e.setDirty(),(a=(i=this.pass)===null||i===void 0?void 0:(s=i.passObject.materialExtension).setDirty)===null||a===void 0||a.call(s)}_update(e){var i;let s=this.enabled;if(s&&!this._lastEnabled){const a=(i=this._viewer)===null||i===void 0?void 0:i.getPluginByType("NormalBufferPlugin");confirm("SS Bevel Plugin needs to enable NormalBufferPlugin. Enable now?")?a.enabled=!0:(this.enabled=!1,a.enabled=!1,s=!1)}return this._lastEnabled=s,s}get uiConfig(){var e,i,s,a,h;const d=(s=(i=(e=this.pass)===null||e===void 0?void 0:e.passObject)===null||i===void 0?void 0:i.uiConfig)!==null&&s!==void 0?s:{};return(h=(a=d.children)===null||a===void 0?void 0:a.map(_=>Yt(_)))===null||h===void 0||h.flat(2).forEach(_=>_&&(_.onChange=this.setDirty)),d}updateGBuffer(e,i){var s,a,h;if(e instanceof b.Kj0&&(!((s=e.material)===null||s===void 0)&&s.userData)){for(let _=3;_<8;_++)i.y=RE(i.y,_);let d=!((a=e.material)===null||a===void 0)&&a.userData._ssBevel?(h=e.material)===null||h===void 0?void 0:h.userData._ssBevel.radius:0;d=Math.min(d,31),d<<=3,i.y=i.y|d}}}cy.PluginType="SSBevelPlugin",cy.SSBEVEL_GLTF_EXTENSION="WEBGI_materials_ssbevel";class yN{constructor(e){this.parser=e,this.name=cy.SSBEVEL_GLTF_EXTENSION}async extendMaterialParams(e,i){const s=this.parser.json.materials[e];if(!s.extensions||!s.extensions[this.name])return Promise.resolve();const a=s.extensions[this.name];return i.userData||(i.userData={}),XB(i),i.userData._ssBevel=to(a,i.userData._ssBevel,!1,{}),Promise.resolve()}}const wN=c=>({writeMaterial:(e,i)=>{if(!e.isMeshStandardMaterial||!e.userData._ssBevel||!e.userData._ssBevel.hasSSBevel)return;i.extensions=i.extensions||{};const s=ao(e.userData._ssBevel,!1);i.extensions[cy.SSBEVEL_GLTF_EXTENSION]=s,c.extensionsUsed[cy.SSBEVEL_GLTF_EXTENSION]=!0}});class KB extends FD{constructor(e){super(),this._loadedLibs=!1,e=e||{method:aM.EncoderMethod.EDGEBREAKER,encodeSpeed:5},this._io=new QL().registerExtensions(_N).registerExtensions([JB,LI,BI,kI,OI,NI,UI,FI,jI,zI,VI,QI,GI,HI,WI]),this._encoderOptions=e}preload(){return this._loadLibs(),this}async _loadLibs(){if(this._loadedLibs||!this.loader)return;const e=await Promise.all([this.loader.initEncoder(),this.loader.initDecoder()]);this._io.registerDependencies({"draco3d.encoder":e[0],"draco3d.decoder":e[1]}),this._loadedLibs=!0}async parseAsync(e,{compress:i=!1,...s}){if(!this.loader)return console.error("GLTFDracoExporter: No DRACOLoader2 instance provided"),super.parseAsync(e,s);await this._loadLibs();const a={...s};i&&(a.externalImagesInExtras=!0);const h=await new Promise((lt,ut)=>this.parse(e,lt,ut,a)),d=await super.parseAsync(h,a);if(!i)return d;if(!h)throw new Error("GLTFDracoExporter: gltf is null");let _=h;const et=_.byteLength||1/0,nt=await(typeof _!="object"||_.byteLength?this._io.readBinary(new Uint8Array(_)):this._io.readJSON({json:_,resources:{}}));if(nt.createExtension(aM).setRequired(!0).setEncoderOptions(this._encoderOptions),a.exportExt==="glb")_=await this._io.writeBinary(nt),isFinite(et)&&console.log("DRACO Compression ratio: "+(_.byteLength/et).toFixed(5));else{const lt=await this._io.writeJSON(nt);_=lt.json,Object.values(lt.resources).filter(ut=>ut).length>0&&(console.warn("DRACOExporter: extra resources in resources not supported properly"),_.resources=lt.resources)}_.__isGLTFOutput=!0;const it=await super.parseAsync(_,a);return it.__uncompressed=d,it}}class aP extends Ls{constructor(){super(...arguments),this.enabled=!0,this.dependencies=[qr,tM]}async onAdded(e){await super.onAdded(e);const i=e.getManager().importer;if(!i)throw new Error("GLTFDracoExportPlugin: AssetImporter not found");(function(s,a){jD(s,KB,h=>{const d=gu()+".drc",_=h;_.loader=a.registerFile(d),_.loader.setDecoderConfig({type:"js"}),_.loader.preload(!0,!0)})})(e,i)}}aP.PluginType="GLTFDracoExportPlugin";class xN extends uu{constructor(){super(...arguments),this.extensionName=Xl,this.parentTypes=[Yr.SCENE],this.propertyType="ViewerJSON"}init(){}}class JB extends Ql{constructor(){super(...arguments),this.extensionName=Xl,this._viewerConfig={},this._texturesRef=[],this.required=!0}read(e){var i;return this._viewerConfig={},(i=e.jsonDoc.json.scenes)===null||i===void 0||i.forEach((s,a)=>{if(s.extensions&&s.extensions[Xl]){const h=new xN(this.document.getGraph());e.scenes[a].setExtension(Xl,h);const d=s.extensions[Xl];this._viewerConfig=d}}),this}write(e){return this.document.getRoot().listScenes().forEach(i=>{var s;if(i.getExtension(Xl)){const a=(s=e.jsonDoc.json.scenes)===null||s===void 0?void 0:s[e.jsonDoc.json.scene||0];a&&this._viewerConfig!=={}&&(a.extensions=a.extensions||{},a.extensions[Xl]=this._viewerConfig,this._texturesRef=[],this._viewerConfig={})}}),this}}JB.EXTENSION_NAME=Xl;class RI extends uu{constructor(e,i,s){super(e,i),this.parentTypes=[Yr.MATERIAL,Yr.MESH,Yr.NODE,Yr.SCENE],this.propertyType="GenericExtension",this.textures={},this.extensionName=s}addTexture(e,i,s,a=4369){this.setRef(e,s,{channels:a}),this.textures[e]=[i,s]}copy(e,i=L_){return super.copy(e,i),this}dispose(){Object.values(this.textures).forEach(([e,i])=>{e==null||e.dispose()}),super.dispose()}init(){}}class Pm extends Ql{constructor(){super(...arguments),this.textureChannels={}}read(e){const i=e.jsonDoc,s=i.json.materials||[],a=i.json.textures||[];return s.forEach((h,d)=>{var _,et;if(h.extensions&&h.extensions[this.extensionName]){const nt=new RI(this.document.getGraph(),"",this.extensionName);e.materials[d].setExtension(this.extensionName,nt);const it={...h.extensions[this.extensionName]};for(const[lt,ut]of Object.entries(it))if(typeof(ut==null?void 0:ut.index)=="number"){const pt=ut,gt=(_=a[pt.index])===null||_===void 0?void 0:_.source;if(typeof gt!="number"){console.warn("GLTF Pipeline: source texture not found for texture info",pt);continue}const vt=e.textures[gt],Ct=new Rl(this.document.getGraph()),wt=(et=this.textureChannels[lt])!==null&&et!==void 0?et:4369;nt.addTexture(lt,Ct,vt,wt),e.setTextureInfo(Ct,pt),delete it[lt]}nt.setExtras(it)}}),(i.json.meshes||[]).forEach((h,d)=>{if(h.extensions&&h.extensions[this.extensionName]){const _=new RI(this.document.getGraph(),"",this.extensionName);e.meshes[d].setExtension(this.extensionName,_);const et=h.extensions[this.extensionName];_.setExtras(et)}}),(i.json.nodes||[]).forEach((h,d)=>{if(h.extensions&&h.extensions[this.extensionName]){const _=new RI(this.document.getGraph(),"",this.extensionName);e.nodes[d].setExtension(this.extensionName,_);const et=h.extensions[this.extensionName];_.setExtras(et)}}),(i.json.scenes||[]).forEach((h,d)=>{if(h.extensions&&h.extensions[this.extensionName]){const _=new RI(this.document.getGraph(),"",this.extensionName);e.scenes[d].setExtension(this.extensionName,_);const et=h.extensions[this.extensionName];_.setExtras(et)}}),this}write(e){const i=e.jsonDoc;return this.document.getRoot().listMaterials().forEach(s=>{const a=s.getExtension(this.extensionName);if(a){const h=e.materialIndexMap.get(s),d=i.json.materials[h];d.extensions=d.extensions||{};const _={...a.getExtras()};for(const[et,nt]of Object.entries(a.textures)){const it=nt[0],lt=nt[1];lt&&(_[et]=e.createTextureInfoDef(lt,it))}d.extensions[this.extensionName]=_}}),this.document.getRoot().listMeshes().forEach(s=>{const a=s.getExtension(this.extensionName);if(a){const h=e.meshIndexMap.get(s),d=i.json.meshes[h];d.extensions=d.extensions||{},d.extensions[this.extensionName]=a.getExtras()}}),this.document.getRoot().listNodes().forEach(s=>{const a=s.getExtension(this.extensionName);if(a){const h=e.nodeIndexMap.get(s),d=i.json.nodes[h];d.extensions=d.extensions||{},d.extensions[this.extensionName]=a.getExtras()}}),this.document.getRoot().listScenes().forEach(s=>{const a=s.getExtension(this.extensionName);if(a){const h=e.jsonDoc.json.scene||0,d=i.json.scenes[h];if(!d)return;d.extensions=d.extensions||{},d.extensions[this.extensionName]=a.getExtras()}}),this}}class BI extends Pm{constructor(){super(...arguments),this.extensionName=BI.EXTENSION_NAME,this.textureChannels={bumpTexture:cu.R}}}BI.EXTENSION_NAME=ru;class kI extends Pm{constructor(){super(...arguments),this.extensionName=kI.EXTENSION_NAME,this.textureChannels={lightMapTexture:cu.R|cu.G|cu.B}}}kI.EXTENSION_NAME=zm;class OI extends Pm{constructor(){super(...arguments),this.extensionName=OI.EXTENSION_NAME,this.textureChannels={alphaTexture:cu.G}}}OI.EXTENSION_NAME=g0;class LI extends Pm{constructor(){super(...arguments),this.extensionName=LI.EXTENSION_NAME}}LI.EXTENSION_NAME=Dl.DIAMOND_GLTF_EXTENSION;class NI extends Pm{constructor(){super(...arguments),this.extensionName=NI.EXTENSION_NAME}}NI.EXTENSION_NAME=El.AnimationMarkersExtension;class UI extends Pm{constructor(){super(...arguments),this.extensionName=UI.EXTENSION_NAME,this.textureChannels={anisotropyDirection:cu.R|cu.G|cu.B}}}UI.EXTENSION_NAME=Wp.ANISOTROPY_GLTF_EXTENSION;class FI extends Pm{constructor(){super(...arguments),this.extensionName=FI.EXTENSION_NAME,this.textureChannels={anisotropyDirection:cu.R|cu.G|cu.B}}}FI.EXTENSION_NAME=_d.CUSTOM_BUMP_MAP_GLTF_EXTENSION;class jI extends Pm{constructor(){super(...arguments),this.extensionName=jI.EXTENSION_NAME}}jI.EXTENSION_NAME=lp;class zI extends Pm{constructor(){super(...arguments),this.extensionName=zI.EXTENSION_NAME}}zI.EXTENSION_NAME=Fm;class VI extends Pm{constructor(){super(...arguments),this.extensionName=VI.EXTENSION_NAME}}VI.EXTENSION_NAME=Kl;class QI extends Pm{constructor(){super(...arguments),this.extensionName=QI.EXTENSION_NAME}}QI.EXTENSION_NAME=wm.CLEARCOAT_TINT_GLTF_EXTENSION;class GI extends Pm{constructor(){super(...arguments),this.extensionName=GI.EXTENSION_NAME}}GI.EXTENSION_NAME=$u.THIN_FILM_LAYER_GLTF_EXTENSION;class HI extends Pm{constructor(){super(...arguments),this.extensionName=HI.EXTENSION_NAME}}HI.EXTENSION_NAME=cy.SSBEVEL_GLTF_EXTENSION;class WI extends Pm{constructor(){super(...arguments),this.extensionName=WI.EXTENSION_NAME}}WI.EXTENSION_NAME=_h.NOISE_BUMP_MATERIAL_GLTF_EXTENSION;class ZB extends ot{constructor(){super(...arguments),this.processor={forAssetType:"texture",process:(e,i)=>e}}async onAdded(e){}async onDispose(e){}async onRemove(e){this._pmrem=void 0}}ZB.PluginType="PMREMGenerator";const $B=new b.Pa4,bN=new b._fP,_k=new b.Pa4;class EN extends b.Tme{constructor(e=document.createElement("div")){super(),this.isCSS3DObject=!0,this.element=e,this.element.style.position="absolute",this.element.style.pointerEvents="auto",this.element.style.userSelect="none",this.element.setAttribute("draggable",!1),this.addEventListener("removed",function(){this.traverse(function(i){i.element instanceof Element&&i.element.parentNode!==null&&i.element.parentNode.removeChild(i.element)})})}copy(e,i){return super.copy(e,i),this.element=e.element.cloneNode(!0),this}}const U_=new b.yGw,SN=new b.yGw;class CN{constructor(e={}){const i=this;let s,a,h,d;const _={camera:{fov:0,style:""},objects:new WeakMap},et=e.element!==void 0?e.element:document.createElement("div");et.style.overflow="hidden",this.domElement=et;const nt=document.createElement("div");function it(gt){return Math.abs(gt)<1e-10?0:gt}function lt(gt){const vt=gt.elements;return"matrix3d("+it(vt[0])+","+it(-vt[1])+","+it(vt[2])+","+it(vt[3])+","+it(vt[4])+","+it(-vt[5])+","+it(vt[6])+","+it(vt[7])+","+it(vt[8])+","+it(-vt[9])+","+it(vt[10])+","+it(vt[11])+","+it(vt[12])+","+it(-vt[13])+","+it(vt[14])+","+it(vt[15])+")"}function ut(gt){const vt=gt.elements;return"translate(-50%,-50%)matrix3d("+it(vt[0])+","+it(vt[1])+","+it(vt[2])+","+it(vt[3])+","+it(-vt[4])+","+it(-vt[5])+","+it(-vt[6])+","+it(-vt[7])+","+it(vt[8])+","+it(vt[9])+","+it(vt[10])+","+it(vt[11])+","+it(vt[12])+","+it(vt[13])+","+it(vt[14])+","+it(vt[15])+")"}function pt(gt,vt,Ct,wt){if(gt.isCSS3DObject){const xt=gt.visible===!0&&gt.layers.test(Ct.layers)===!0;if(gt.element.style.display=xt===!0?"":"none",xt===!0){let _t;gt.onBeforeRender(i,vt,Ct),gt.isCSS3DSprite?(U_.copy(Ct.matrixWorldInverse),U_.transpose(),gt.rotation2D!==0&&U_.multiply(SN.makeRotationZ(gt.rotation2D)),gt.matrixWorld.decompose($B,bN,_k),U_.setPosition($B),U_.scale(_k),U_.elements[3]=0,U_.elements[7]=0,U_.elements[11]=0,U_.elements[15]=1,_t=ut(U_)):_t=ut(gt.matrixWorld);const Pt=gt.element,Bt=_.objects.get(gt);if(Bt===void 0||Bt.style!==_t){Pt.style.transform=_t;const Ot={style:_t};_.objects.set(gt,Ot)}Pt.parentNode!==nt&&nt.appendChild(Pt),gt.onAfterRender(i,vt,Ct)}}for(let xt=0,_t=gt.children.length;xt<_t;xt++)pt(gt.children[xt],vt,Ct)}nt.style.transformStyle="preserve-3d",nt.style.pointerEvents="none",et.appendChild(nt),this.getSize=function(){return{width:s,height:a}},this.render=function(gt,vt){const Ct=vt.projectionMatrix.elements[5]*d;let wt,xt;_.camera.fov!==Ct&&(et.style.perspective=vt.isPerspectiveCamera?Ct+"px":"",_.camera.fov=Ct),gt.matrixWorldAutoUpdate===!0&&gt.updateMatrixWorld(),vt.parent===null&&vt.matrixWorldAutoUpdate===!0&&vt.updateMatrixWorld(),vt.isOrthographicCamera&&(wt=-(vt.right+vt.left)/2,xt=(vt.top+vt.bottom)/2);const _t=vt.isOrthographicCamera?"scale("+Ct+")translate("+it(wt)+"px,"+it(xt)+"px)"+lt(vt.matrixWorldInverse):"translateZ("+Ct+"px)"+lt(vt.matrixWorldInverse),Pt=_t+"translate("+h+"px,"+d+"px)";_.camera.style!==Pt&&(nt.style.transform=Pt,_.camera.style=Pt),pt(gt,gt,vt)},this.setSize=function(gt,vt){s=gt,a=vt,h=s/2,d=a/2,et.style.width=gt+"px",et.style.height=vt+"px",nt.style.width=gt+"px",nt.style.height=vt+"px"}}}var qI,YI=function(c,e,i,s){var a,h=arguments.length,d=h<3?e:s===null?s=Object.getOwnPropertyDescriptor(e,i):s;if(typeof Reflect=="object"&&typeof Reflect.decorate=="function")d=Reflect.decorate(c,e,i,s);else for(var _=c.length-1;_>=0;_--)(a=c[_])&&(d=(h<3?a(d):h>3?a(e,i,d):a(e,i))||d);return h>3&&d&&Object.defineProperty(e,i,d),d};let uy=qI=class extends Ls{constructor(c=!0){super(),this._scene=new b.xsS,this.overCanvas=!0,this._trackers=[],this.attachIFrameToSelected=async()=>{var e,i,s,a,h;const d=(i=(e=this._viewer)===null||e===void 0?void 0:e.getPlugin(ro))===null||i===void 0?void 0:i.getSelectedObject();if(!(d!=null&&d.geometry))return void await((s=this._viewer)===null||s===void 0?void 0:s.alert("No Geometry: Selected object must have a geometry to apply the iframe to"));const _=await((a=this._viewer)===null||a===void 0?void 0:a.prompt("URL: Enter the url for the webpage. (Make sure its allowed to be embedded in an iframe.)","https://webgi.xyz/",!1))||"https://webgi.pixotronics.com/";if(!_)return;const et=await((h=this._viewer)===null||h===void 0?void 0:h.prompt("Width: Enter the width for the object.","512",!1))||"512";et&&this.attachIFrame(d,_,parseInt(et))},this._resizeObserver=new ResizeObserver(()=>{var e;this.enabled&&((e=this._viewer)===null||e===void 0||e.scene.setDirty({sceneUpdate:!0}))}),this.enabled=c,this._refreshCanvasInDOM=this._refreshCanvasInDOM.bind(this),this._refreshEnabled=this._refreshEnabled.bind(this)}_refreshEnabled(){}_refreshCanvasInDOM(){const c=this._viewer;c&&this._renderer&&(c.canvas.remove(),this.overCanvas?this._renderer.domElement.insertAdjacentElement("afterbegin",c.canvas):this._renderer.domElement.appendChild(c.canvas))}_initialize(){if(this._renderer||!this._viewer)return;this._renderer=new CN;const c=this._viewer.renderer.rendererObject.getSize(new b.FM8);this._renderer.setSize(c.width,c.height);const e=document.createElement("div");e.style.position="absolute",e.style.top="0",e.style.zIndex="0",e.appendChild(this._renderer.domElement),this._viewer.canvas.style.position="absolute",this._viewer.canvas.style.top="0",this._viewer.canvas.style.left="0",this._viewer.canvas.style.zIndex="0",this._viewer.container.appendChild(e),this._refreshCanvasInDOM(),this._viewer.renderer.addEventListener("resize",()=>{if(!this._viewer||!this._renderer)return;const i=this._viewer.renderer.rendererObject.getSize(new b.FM8);this._renderer.setSize(i.width,i.height)})}async onAdded(c){await super.onAdded(c);let e=!0,i=!0;c.addEventListener("postFrame",h=>{var d,_;e&&this.enabled&&(this._renderer||this._initialize(),this._renderer&&(i&&this._trackers.forEach(et=>{var nt,it;let lt=!0;const ut=et.modelObj.material.side;if(ut!==b.ehD){const pt=new b.Pa4(0,0,1).applyQuaternion(et.cssObj.quaternion),gt=(it=(nt=this._viewer)===null||nt===void 0?void 0:nt.scene.activeCamera)===null||it===void 0?void 0:it.cameraObject,vt=pt.dot(gt.getWorldDirection(new b.Pa4));lt=ut===b._Li?vt>0:vt<0}et.cssObj.element.style.visibility=lt?"visible":"hidden"}),this._trackers.filter(et=>et.dirty).forEach(et=>this._syncProperties(et)),(d=this._renderer)===null||d===void 0||d.render(this._scene,(_=c.scene.activeCamera)===null||_===void 0?void 0:_.cameraObject),e=!1))}),c.addEventListener("update",h=>{this.enabled&&(e=this._trackers.length>0)}),c.scene.addEventListener("sceneUpdate",h=>{this.enabled&&(this._trackers.forEach(d=>d.dirty=!0),e=this._trackers.length>0)}),c.scene.addEventListener("activeCameraUpdate",h=>{this.enabled&&(e=this._trackers.length>0,i=!0)});let s=!1;const a=new b.iMs;c.container.addEventListener("mousemove",h=>{if(!this.enabled||!this._viewer||this.overCanvas)return;const d=this._viewer.canvas.getBoundingClientRect(),_=(h.clientX-d.x)/d.width*2-1,et=-(h.clientY-d.y)/d.height*2+1;a.setFromCamera({x:_,y:et},this._viewer.scene.activeCamera.cameraObject);const nt=this._trackers.map(lt=>lt.modelObj),it=a.intersectObjects(nt,!1);if(console.log(it),it.length)return this._viewer.canvas.style.pointerEvents="none",s=!0,void console.log(this._viewer.canvas.style.pointerEvents);s&&(this._viewer.canvas.style.pointerEvents="auto",s=!1)})}attachIFrame(c,e,i){const s=KI(c.modelObject),a=e3(e,i,i*s.y/s.x,()=>{var h;return(h=c.setDirty)===null||h===void 0?void 0:h.call(c)});return this.attachCSS3DObject(a,c),a}attachCSS3DObject(c,e){var i,s,a,h,d;if(this._trackers.push({cssObj:c,modelObj:e.modelObject,dirty:!0}),c.element&&(this._resizeObserver.observe(c.element),c.element.__isCSS3DObjectElement=!0,console.log(c.element,c.element.__isCSS3DObjectElement)),e.userData.__oldMaterial=e.material,!e.setMaterial)throw"model not processed?";const _=(i=this._viewer)===null||i===void 0?void 0:i.createMaterial("basic",{opacity:0,color:new b.Ilk("black"),blending:b.jFi,side:b.Wl3});if(!_)throw"cannot create mat";_.userData.forcedLinearDepth=0,(s=e.setMaterial)===null||s===void 0||s.call(e,_),XI(e.modelObject),lP(e.modelObject),KI(e.modelObject),this._scene.add(c),(h=(a=this.uiConfig)===null||a===void 0?void 0:a.uiRefresh)===null||h===void 0||h.call(a),(d=e.setDirty)===null||d===void 0||d.call(e)}_syncProperties(c){const e=c.modelObj,i=c.cssObj;e.updateMatrixWorld();const s=c.cssObj.element.clientWidth<1.5?0:(c.cssObj.element.clientWidth-1.5)/KI(e).x,a=XI(e);i.quaternion.setFromUnitVectors(new b.Pa4(0,0,1),a),i.position.copy(lP(e)),i.scale.set(1,1,1).multiplyScalar(1/s),i.updateMatrixWorld(),i.applyMatrix4(e.matrixWorld),c.dirty=!1}async onDispose(c){return this._resizeObserver.disconnect(),super.onDispose(c)}};function e3(c,e,i,s){const a=document.createElement("div");a.style.width=e.toString()+"px",a.style.height=i.toString()+"px",a.style.backgroundColor="transparent";const h=document.createElement("iframe",{is:"x-frame-bypass"});h.style.width="100%",h.style.height="100%",h.style.border="0px";const d=()=>{var _,et;try{h.contentWindow.name}catch(nt){(typeof nt=="string"?nt:(et=(_=nt==null?void 0:nt.toString)===null||_===void 0?void 0:_.call(nt))!==null&&et!==void 0?et:"").includes("cross-origin")?console.warn("Trying to load cross-origin scripts, Install chrome extension if not able to load: https://chrome.google.com/webstore/detail/ignore-x-frame-headers/gleekbfjekiniecknbkamfmkohkpodhe"):console.error(nt)}s(),h.removeEventListener("load",d)};return h.addEventListener("load",d),h.src=c,a.appendChild(h),new EN(a)}function XI(c){if(c.geometry.userData.geometryNormal)return c.geometry.userData.geometryNormal;const e=c.geometry.attributes.normal,i=new b.Pa4,s=new b.Pa4;for(let a=0,h=e.count;a<h;a++)i.fromBufferAttribute(e,a),s.add(i);return s.normalize(),c.geometry.userData.geometryNormal=s,s}function lP(c){if(c.geometry.userData.geometryCenter)return c.geometry.userData.geometryCenter;const e=c.geometry;if(!e)return new b.Pa4(0,0,0);e.boundingBox||e.computeBoundingBox();const i=e.boundingBox.getCenter(new b.Pa4);return c.geometry.userData.geometryCenter=i,i}function KI(c,e=new b.Pa4(0,0,1)){if(c.geometry.userData.geometrySize)return c.geometry.userData.geometrySize;const i=c.geometry;if(!i)return new b.Pa4(0,0,0);const s=i.clone();s.applyMatrix4(new b.yGw().makeRotationFromQuaternion(new b._fP().setFromUnitVectors(e,XI(c)).invert())),s.computeBoundingBox();const a=s.boundingBox.getSize(new b.Pa4);return c.geometry.userData.geometrySize=a,s.dispose(),a}uy.PluginType="CSS3DRenderer",YI([ts("Enabled"),pn(qI.prototype._refreshEnabled),Fn()],uy.prototype,"enabled",void 0),YI([ts("Over canvas"),pn(qI.prototype._refreshCanvasInDOM),Fn()],uy.prototype,"overCanvas",void 0),YI([uo("Attach iframe")],uy.prototype,"attachIFrameToSelected",void 0),uy=qI=YI([Ys("CSS3D Renderer")],uy);var bw,o1=function(c,e,i,s){var a,h=arguments.length,d=h<3?e:s===null?s=Object.getOwnPropertyDescriptor(e,i):s;if(typeof Reflect=="object"&&typeof Reflect.decorate=="function")d=Reflect.decorate(c,e,i,s);else for(var _=c.length-1;_>=0;_--)(a=c[_])&&(d=(h<3?a(d):h>3?a(e,i,d):a(e,i))||d);return h>3&&d&&Object.defineProperty(e,i,d),d};let F_=bw=class{constructor(c){this.enabled=!0,this.enableHighlight=!0,this.enableDynamicSelection=!0,this.outlineIntensity=2,this.highlightTransparency=.84,this.outlineColor=new b.Ilk(13715217),this.transparnecy=0,this._outlineThickness=2,this.extraUniforms={outlineIntensity:{value:1},tDiffuseSize:{value:new b.FM8(1,1)},outlineThickness:{value:2},highlightTransparency:{value:1},outlineColor:{value:new b.Ilk(16777215)},enableHighlight:{value:!0}},this.parsFragmentSnippet=(e,i)=>this.enabled?Qt`
            ${Fp}
            ${"uniform vec2 tDiffuseSize;uniform vec3 outlineColor;uniform float outlineThickness;uniform float outlineIntensity;uniform float highlightTransparency;uniform bool enableHighlight;float getVisibilityBit(in float number){return mod(floor(number/pow(2.,2.)),2.);}float visibility(vec2 uv){float backGround=getDepth(uv)>0.9999?1.:0.;return getVisibilityBit(getGBufferFlags(uv).a*255.)*(1.-backGround);}vec4 outline(in vec4 color){vec2 invSize=1./tDiffuseSize;vec4 uvOffset=outlineThickness*vec4(1.,0.,-1.,1.)*vec4(invSize,invSize);float c=visibility(vUv);float c1=visibility(vUv+uvOffset.xy);float c2=visibility(vUv-uvOffset.xy);float c3=visibility(vUv+uvOffset.yw);float c4=visibility(vUv-uvOffset.yw);float diff1=(c1-c2)*0.5;float diff2=(c3-c4)*0.5;float d=length(vec2(diff1,diff2));float trans=min(1.,10.*(1.-highlightTransparency));vec4 highlightColor=enableHighlight?vec4(c*outlineColor,(1.-highlightTransparency)*c):vec4(0.);vec4 outColor=vec4(outlineColor,trans)*vec4(d)+highlightColor;vec3 finalColor=mix(color.rgb,outlineIntensity*outColor.rgb,outColor.a);return vec4(finalColor.rgb,color.a);}"}
        `:"",this._combinedPostPlugin=c.getPlugin(cv),this._pickingPlugin=c.getPlugin(ro),this._setDirty=this._setDirty.bind(this)}shaderExtender(c,e,i){this.enabled&&(c.fragmentShader=Ho(c.fragmentShader,"#glMarker",` 
            gl_FragColor = outline(gl_FragColor);
            #glMarker
        `))}onObjectRender(c,e,i){this.enabled&&e.materialObject.uniforms.outlineIntensity&&(e.materialObject.uniforms.outlineIntensity.value=this.outlineIntensity,e.materialObject.uniforms.outlineThickness.value=this._outlineThickness,e.materialObject.uniforms.outlineColor.value.copy(this.outlineColor),e.materialObject.uniforms.enableHighlight.value=this.enableHighlight,e.materialObject.uniforms.highlightTransparency.value=this.transparnecy)}getUiConfig(){return this.uiConfig}computeCacheKey(c){return this.enabled?"1":"0"}isCompatible(c){return!0}_setDirty(){this._combinedPostPlugin&&(this._combinedPostPlugin.pass.dirty=!0)}setDirty(){var c;(c=this.__setDirty)===null||c===void 0||c.call(this),this._setDirty()}_enable(){var c;(c=this._pickingPlugin)===null||c===void 0||c.enableWidget(!this.enabled),this._setDirty()}};F_.PluginType="Outline",o1([pn(bw.prototype._enable),ts("Enable"),Fn()],F_.prototype,"enabled",void 0),o1([pn(bw.prototype._setDirty),ts("Highlight"),Fn()],F_.prototype,"enableHighlight",void 0),o1([pn(bw.prototype._setDirty),ts("DynamicSelection"),Fn()],F_.prototype,"enableDynamicSelection",void 0),o1([pn(bw.prototype._setDirty),ss("Intensity",[0,2],.001,{limitedUi:!0}),Fn()],F_.prototype,"outlineIntensity",void 0),o1([pn(bw.prototype._setDirty),ss("Transparency",[0,1],.01,{limitedUi:!0}),Fn()],F_.prototype,"highlightTransparency",void 0),o1([pn(bw.prototype._setDirty),cm("Color"),Fn()],F_.prototype,"outlineColor",void 0),F_=bw=o1([Ys("Outline")],F_);class JI extends k0{constructor(){super(),this._state="in",this.updateGBuffer=this.updateGBuffer.bind(this)}generateExtension(e){return new F_(e)}async onAdded(e){var i,s;await super.onAdded(e),(i=e.getPlugin(ho))===null||i===void 0||i.registerGBufferUpdater(this.updateGBuffer),this._pickingPlugin=e.getPlugin(ro);const a=this;(s=this._pickingPlugin)===null||s===void 0||s.addEventListener("selectedObjectChanged",()=>{var h;a._animationCallBack||(!((h=this._pickingPlugin)===null||h===void 0)&&h.getSelectedObject()?(this._extension.transparnecy=1,a._animationCallBack=this._startTransparencyAnimation(1,this._extension.highlightTransparency,400)):this._extension.transparnecy=1)}),document.addEventListener("mousemove",h=>{var d;const _=(d=this._pickingPlugin)===null||d===void 0?void 0:d.getSelectedObject();_&&this._extension.enableDynamicSelection?h.target!=e.canvas?a._animationCallBack||a._state!="in"||(a._animationCallBack=this._startTransparencyAnimation(this._extension.highlightTransparency,1,600),a._state="out"):a._animationCallBack||a._state!="out"||(a._animationCallBack=this._startTransparencyAnimation(1,this._extension.highlightTransparency,600),a._state="in"):this._extension.transparnecy=_?this._extension.highlightTransparency:1})}async _startTransparencyAnimation(e,i,s){return mE(this._extension,"transparnecy",{from:e,to:i,duration:s,onComplete:()=>{this._animationCallBack=null}})}updateGBuffer(e,i){var s;if(e instanceof b.Kj0){const a=(s=this._pickingPlugin)===null||s===void 0?void 0:s.getSelectedObject();a&&a.id===e.id?i.w=Ox(i.w,2,1):i.w=Ox(i.w,2,0)}}}JI.PluginType="Outline";const MN=1e4,t3=50;class iS{constructor(e=t3){this.velocity=0,this.naturalFrequency=0,this.setDecayTime(e)}setDecayTime(e){this.naturalFrequency=1/Math.max(.001,e)}update(e,i,s,a){const h=2e-4*this.naturalFrequency;if(e==null||a===0||e===i&&this.velocity===0)return i;if(s<0)return e;const d=e-i,_=this.velocity+this.naturalFrequency*d,et=d+s*_,nt=Math.exp(-this.naturalFrequency*s),it=(_-this.naturalFrequency*et)*nt,lt=-this.naturalFrequency*(it+_*nt);return Math.abs(it)<h*Math.abs(a)&&lt*d>=0?(this.velocity=0,i):(this.velocity=it,i+et*nt)}}const cP=new b.Pa4;class n3{constructor(){this.inputSource=null,this.isTranslating=!1,this.isRotating=!1,this.isTwoFingering=!1,this.lastDragPosition=new b.Pa4,this.firstRatio=0,this.lastAngle=0,this.goalPosition=new b.Pa4,this.goalYaw=0,this.goalScale=1,this.presentedScene=null,this.placementBox=null,this.placeOnWall=!1,this.placementComplete=!1,this.xr=null,this.session=null,this._hitPosition=new b.Pa4,this._hitMatrix=new b.yGw,this.xDamper=new iS,this.yDamper=new iS,this.zDamper=new iS,this.yawDamper=new iS,this.scaleDamper=new iS,this.onSelectStart=e=>{const i=this.transientHitTestSource;if(i==null)return;const s=this.frame.getHitTestResultsForTransientInput(i),a=this.presentedScene,h=this.placementBox;if(s.length===1){this.inputSource=e.inputSource;const{axes:d}=this.inputSource.gamepad||{axes:[0,0]},_=h.getHit(a,d[0],d[1]);h.show=!0,_!=null?(this.isTranslating=!0,this.lastDragPosition.copy(_)):this.placeOnWall||(this.isRotating=!0,this.lastAngle=1.5*d[0])}else if(s.length===2){h.show=!0,this.isTwoFingering=!0;const{separation:d}=this.fingerPolar(s);this.firstRatio=d/a.scale.x}},this.onSelectEnd=()=>{this.isTranslating=!1,this.isRotating=!1,this.isTwoFingering=!1,this.inputSource=null,this.goalPosition.y+=this.placementBox.offsetHeight*this.presentedScene.scale.x,this.placementBox.show=!1}}async setSession(e,i,s,a){var h;this.transientHitTestSource=await((h=e.requestHitTestSourceForTransientInput)===null||h===void 0?void 0:h.call(e,{profile:"generic-touchscreen"})),this.presentedScene=i,this.placementBox=a,this.xr=s,this.session=e,this.placementComplete=!1,this.goalPosition.copy(i.position),this.goalYaw=i.rotation.y,this.goalScale=i.scale.x,e.addEventListener("selectstart",this.onSelectStart),e.addEventListener("selectend",this.onSelectEnd)}cancel(){this.transientHitTestSource&&(this.transientHitTestSource.cancel(),this.transientHitTestSource=void 0),this.presentedScene=null,this.placeOnWall=!1,this.frame=void 0,this.xr=null,this.placementBox&&(this.placementBox.show=!1,this.placementBox=null),this.session&&(this.session.removeEventListener("selectstart",this.onSelectStart),this.session.removeEventListener("selectend",this.onSelectEnd),this.session=null)}getHitPoint(e){var i;const s=(i=this.xr)===null||i===void 0?void 0:i.getReferenceSpace(),a=s?e.getPose(s):null;return a?(this._hitMatrix.fromArray(a.transform.matrix),this.placeOnWall&&(this.goalYaw=Math.atan2(this._hitMatrix.elements[4],this._hitMatrix.elements[6])),this._hitMatrix.elements[5]>.75!==this.placeOnWall?this._hitPosition.setFromMatrixPosition(this._hitMatrix):null):null}moveScene(e){if(!this.session)return;const i=this.presentedScene,s=i.position,a=i.rotation.y,h=this.placementBox,d=Math.max(h.boundingSize.x,h.boundingSize.y,h.boundingSize.z)/2,_=this.goalPosition,et=i.scale.x;if(!_.equals(s)||this.goalScale!==et){let{x:nt,y:it,z:lt}=s;nt=this.xDamper.update(nt,_.x,e,d),it=this.yDamper.update(it,_.y,e,d),lt=this.zDamper.update(lt,_.z,e,d),s.set(nt,it,lt);const ut=this.scaleDamper.update(et,this.goalScale,e,1);if(i.scale.set(ut,ut,ut),!this.isTranslating){const pt=_.y-it;this.placementComplete&&!this.placeOnWall?h.offsetHeight=pt/ut:pt===0&&(this.placementComplete=!0,h.show=!1)}}h.updateOpacity(e),i.rotation.y=this.yawDamper.update(a,this.goalYaw,e,Math.PI)}processInput(e){var i;this.frame=e;const s=this.transientHitTestSource;if(!s||!this.isTranslating&&!this.isTwoFingering&&!this.isRotating)return;const a=e.getHitTestResultsForTransientInput(s),h=this.presentedScene,d=h.scale.x;if(this.isTwoFingering)if(a.length<2)this.isTwoFingering=!1;else{const{separation:_,deltaYaw:et}=this.fingerPolar(a);if(this.placeOnWall||(this.goalYaw+=et),!h.userData.__scaleDisabled){const nt=_/this.firstRatio;this.goalScale=nt<1.3&&nt>.7692307692307692?1:nt}}else if(a.length!==2)if(this.isRotating&&(!((i=this.inputSource)===null||i===void 0)&&i.gamepad)){const _=1.5*this.inputSource.gamepad.axes[0];this.goalYaw+=_-this.lastAngle,this.lastAngle=_}else this.isTranslating&&(console.log("translating"),a.forEach(_=>{if(_.inputSource!==this.inputSource)return;let et=null;if(_.results.length>0&&(et=this.getHitPoint(_.results[0])),et==null&&(et=this.getTouchLocation()),et!=null){if(this.goalPosition.sub(this.lastDragPosition),!this.placeOnWall){const nt=et.y-this.lastDragPosition.y;if(nt<0){this.placementBox.offsetHeight=nt/d;const it=cP.copy(this.xr.getCamera().position),lt=-nt/(it.y-et.y);it.multiplyScalar(lt),et.multiplyScalar(1-lt).add(it)}}this.goalPosition.add(et),this.lastDragPosition.copy(et)}}));else{this.isTranslating=!1,this.isRotating=!1,this.isTwoFingering=!0;const{separation:_}=this.fingerPolar(a);this.firstRatio=_/d}}getTouchLocation(){var e,i;const{axes:s}=(e=this.inputSource.gamepad)!==null&&e!==void 0?e:{axes:[0,0]},a=this.placementBox.getExpandedHit(this.presentedScene,s[0],s[1]);return a!=null&&(cP.copy(a).sub((i=this.xr)===null||i===void 0?void 0:i.getCamera().position),cP.length()>10)?null:a}fingerPolar(e){var i,s,a,h,d,_;const et=(a=(s=(i=e[0].inputSource)===null||i===void 0?void 0:i.gamepad)===null||s===void 0?void 0:s.axes)!==null&&a!==void 0?a:[0,0],nt=(_=(d=(h=e[1].inputSource)===null||h===void 0?void 0:h.gamepad)===null||d===void 0?void 0:d.axes)!==null&&_!==void 0?_:[0,0],it=nt[0]-et[0],lt=nt[1]-et[1],ut=Math.atan2(lt,it);let pt=this.lastAngle-ut;return pt>Math.PI?pt-=2*Math.PI:pt<-Math.PI&&(pt+=2*Math.PI),this.lastAngle=ut,{separation:Math.sqrt(it*it+lt*lt),deltaYaw:pt}}}const ZI=.2,TN=Math.PI/24,i3=new b.FM8,$I=(c,e,i)=>{let s=e>0?i>0?0:-Math.PI/2:i>0?Math.PI/2:Math.PI;for(let a=0;a<=12;++a)c.push(e+.17*Math.cos(s),i+.17*Math.sin(s),0,e+ZI*Math.cos(s),i+ZI*Math.sin(s),0),s+=TN};class r3 extends b.Kj0{constructor(e,i,s=!1){super(((et,nt)=>{const it=new b.u9r,lt=[],ut=[],pt=et.getSize(new b.Pa4),gt=pt.x/2,vt=(nt?pt.y:pt.z)/2;$I(ut,gt,vt),$I(ut,-gt,vt),$I(ut,-gt,-vt),$I(ut,gt,-vt);const Ct=ut.length/3;for(let xt=0;xt<Ct-2;xt+=2)lt.push(xt,xt+1,xt+3,xt,xt+3,xt+2);const wt=Ct-2;return lt.push(wt,wt+1,1,wt,1,0),it.setAttribute("position",new b.a$l(ut,3)),it.setIndex(lt),it})(e,s)),this.boundingSize=new b.Pa4,this._raycaster=new b.iMs,this._camera=i,this._placeOnWall=s;const a=this.material;a.side=b.Wl3,a.color=new mo(16711935),a.opacity=0,this.userData.bboxVisible=!1;const h=e.getSize(this.boundingSize);console.log(e,s,h,this);const d=h.x/2,_=(s?h.y:h.z)/2;this.hitPlane=new b.Kj0(new b._12(2*(d+ZI),2*(_+ZI))),this.hitPlane.visible=!1,this.add(this.hitPlane),e.getCenter(this.position),s?(this.shadowHeight=e.min.z,this.position.z=this.shadowHeight):(this.rotateX(-Math.PI/2),this.shadowHeight=e.min.y,this.position.y=this.shadowHeight),this.offsetHeight=0}getHit(e,i,s){i3.set(i,-s),this.hitPlane.visible=!0;const a=this._positionAndNormalFromPoint(i3,this.hitPlane);return this.hitPlane.visible=!1,a==null?null:a.position}getExpandedHit(e,i,s){this.hitPlane.scale.set(1e3,1e3,1e3);const a=this.getHit(e,i,s);return this.hitPlane.scale.set(1,1,1),a}set offsetHeight(e){e-=.001,this._placeOnWall?this.position.z=this.shadowHeight+e:this.position.y=this.shadowHeight+e}get offsetHeight(){return this._placeOnWall?this.position.z-this.shadowHeight:this.position.y-this.shadowHeight}set show(e){this.material.opacity=e?.75:0}get show(){return this.material.opacity>.01}updateOpacity(e){const i=this.material;this.visible=i.opacity>0}dispose(){var e;const{geometry:i,material:s}=this.hitPlane;i.dispose(),s.dispose(),this.geometry.dispose(),this.material.dispose(),(e=this.parent)===null||e===void 0||e.remove(this)}_positionAndNormalFromPoint(e,i){if(!this._camera)return null;this._raycaster.setFromCamera(e,this._camera);const s=this._raycaster.intersectObject(i,!0);if(s.length===0)return null;const a=s[0];return a.face==null?null:a.uv==null?{position:a.point,normal:a.face.normal,uv:null}:(a.face.normal.applyNormalMatrix(new b.Vkp().getNormalMatrix(a.object.matrixWorld)),{position:a.point,normal:a.face.normal,uv:a.uv})}}class s3 extends Ls{constructor(){super(...arguments),this.enabled=!0,this._touchInputHelper=new n3,this._preRender=()=>{if(!(this._dirty&&this._viewer&&this._xrManager&&this._xrSession))return;this._viewer.renderer.composer.renderToScreen=!1,this._xrManager.enabled=!1;const e=this._xrManager.getCamera(),i=e.cameras[0]||e,s=this._viewer.scene.activeCamera;s.cameraObject.projectionMatrix.copy(i.projectionMatrix),s.cameraObject.projectionMatrixInverse.copy(s.cameraObject.projectionMatrix).invert()},this._postRender=()=>{var e,i;if(!this._dirty||!this._viewer||!this._xrSession)return;this._viewer.scene.activeCamera.cameraObject.updateProjectionMatrix();const s=this._viewer.renderer,a=(i=(e=this._xrManager)===null||e===void 0?void 0:e.getCamera())===null||i===void 0?void 0:i.cameras[0].viewport;a?s.rendererObject.setViewport(a):console.warn("no viewport for ar camera"),zr(s.rendererObject,{sceneRender:!0,opaqueRender:!0,shadowMapRender:!1,backgroundRender:!1,transparentRender:!1,transmissionRender:!1,screenSpaceRendering:!1},()=>{e2.render(s.rendererObject,null,s.composer.readBuffer,0,!1)}),this._xrManager.enabled=!0,this._viewer.renderer.composer.renderToScreen=!0},this._frameCount=0,this._lastTime=0,this._preFrame=({xrFrame:e,deltaTime:i})=>{var s,a;if(this.dirty=!!e&&((s=this._xrManager)===null||s===void 0?void 0:s.isPresenting)||!1,this._viewer.scene.activeCamera.interactionsEnabled=!this._dirty,this._viewer.scene.activeCamera.autoLookAtTarget=!this._dirty,!this._dirty||!e)return void(this._xrSession&&this._xrSessionEnd());if(!this._xrSession&&!this._xrManager.getSession())return console.error("no xr session found, shouldn't happen"),void(this.dirty=!1);this._xrSession||console.log("webxr: AR session init"),this._frameCount++;const h=this._xrManager.getReferenceSpace(),d=e.getViewerPose(h);if(d==null&&this._frameCount,d==null||((a=this._viewer)===null||a===void 0?void 0:a.scene.modelRoot.children.length)===0)return this.dirty=!1,void console.log("no pose or no model");if(!this._xrSession){if(this._xrSession=this._xrManager.getSession()||void 0,!this._xrSession)return;this._frameCount=0,this._cancelHitSources(),this._savePreXRState(),this._preSetupModel(),this._xrSessionStart()}const _=this._viewer.scene.activeCamera;this._xrManager.updateCamera(_.cameraObject),_.setDirty(),this.moveToFloor(e),this._touchInputHelper.processInput(e),this._touchInputHelper.moveScene(i),this._updateShadow()},this.placeOnWall=!1,this._preXRState={viewerBg:null,modelScale:new b.Pa4(1,1,1),modelPosition:new b.Pa4,modelRotation:new b._fP,cameraPosition:new b.Pa4(0,0,5),cameraTarget:new b.Pa4,cameraUp:new b.Pa4(0,1,0),cameraAspect:1,cameraFov:50,cameraZoom:1,cameraNear:.01,cameraFar:100,groundOffset:new b.Pa4,groundScale:1},this._savePreXRState=()=>{if(!this._viewer)return;this._preXRState.viewerBg=this._viewer.getBackground(!0);const e=this._viewer.scene.modelRoot,i=this._viewer.scene.activeCamera;e.updateMatrix(),e.updateMatrixWorld(!0),this._preXRState.modelScale.copy(e.scale),this._preXRState.modelPosition.copy(e.position),this._preXRState.modelRotation.copy(e.quaternion),this._preXRState.cameraPosition.copy(i.position),this._preXRState.cameraTarget.copy(i.target),this._preXRState.cameraUp.copy(i.cameraObject.up),i.cameraObject.isPerspectiveCamera&&(this._preXRState.cameraFov=i.cameraObject.fov,this._preXRState.cameraAspect=i.cameraObject.aspect),this._preXRState.cameraZoom=i.cameraObject.zoom,this._preXRState.cameraNear=i.cameraObject.near,this._preXRState.cameraFar=i.cameraObject.far;const s=this._viewer.getPluginByType("Ground");s!=null&&s.mesh&&(this._preXRState.groundOffset.subVectors(e.position,s.mesh.modelObject.position),this._preXRState.groundScale=s.mesh.modelObject.scale.x,console.log("ground offset",this._preXRState.groundOffset,this._preXRState.groundScale),s.shadowBaker.enabled=!1)},this._xrSessionStart=()=>{if(!this._xrSession||!this._viewer)return;console.log("webxr: AR session start");const e=20*Math.PI/180,i=this.placeOnWall?void 0:new window.XRRay(new DOMPoint(0,0,0),{x:0,y:-Math.sin(e),z:-Math.cos(e)});this._touchInputHelper.placeOnWall=this.placeOnWall,this._viewer.resize(),(async()=>{var s,a;if(this._xrSession){const h=await this._xrSession.requestReferenceSpace("viewer");this._hitTestSource=await((a=(s=this._xrSession).requestHitTestSource)===null||a===void 0?void 0:a.call(s,{space:h,offsetRay:i}))}this._xrSession&&await this._touchInputHelper.setSession(this._xrSession,this._viewer.scene.modelRoot,this._xrManager,this._placementBox)})()},this._xrSessionEnd=()=>{var e;console.log("webxr: AR session end"),this._frameCount=0,(e=this._xrSession)===null||e===void 0||e.removeEventListener("end",this._xrSessionEnd),this._xrSession=void 0,this._cancelHitSources(),this._viewer&&(this._restorePreXRState(),this._viewer.resize())}}async onAdded(e){await super.onAdded(e);const i=e.renderer.rendererObject.xr;i.enabled=!0,i.cameraAutoUpdate=!1,this._xrManager=i;const s=document.getElementById("tweakpaneUiContainer"),a=s?{root:s}:void 0;document.body.appendChild(class{static createButton(h,d={}){const _=document.createElement("button");function et(){_.style.display="",_.style.cursor="auto",_.style.left="calc(50% - 75px)",_.style.width="150px",_.onmouseenter=null,_.onmouseleave=null,_.onclick=null}function nt(it){it.style.position="absolute",it.style.bottom="20px",it.style.padding="12px 6px",it.style.border="1px solid #fff",it.style.borderRadius="4px",it.style.background="rgba(0,0,0,0.1)",it.style.color="#fff",it.style.font="normal 13px sans-serif",it.style.textAlign="center",it.style.opacity="0.5",it.style.outline="none",it.style.zIndex="999"}if("xr"in navigator)return _.id="ARButton",_.style.display="none",nt(_),navigator.xr.isSessionSupported("immersive-ar").then(function(it){it?function(){if(d.domOverlay===void 0){const gt=document.createElement("div");gt.style.display="none",document.body.appendChild(gt);const vt=document.createElementNS("http://www.w3.org/2000/svg","svg");vt.setAttribute("width",38),vt.setAttribute("height",38),vt.style.position="absolute",vt.style.right="20px",vt.style.top="20px",vt.addEventListener("click",function(){lt.end()}),gt.appendChild(vt);const Ct=document.createElementNS("http://www.w3.org/2000/svg","path");Ct.setAttribute("d","M 12,12 L 28,28 M 28,12 12,28"),Ct.setAttribute("stroke","#fff"),Ct.setAttribute("stroke-width",2),vt.appendChild(Ct),d.optionalFeatures===void 0&&(d.optionalFeatures=[]),d.optionalFeatures.push("dom-overlay"),d.domOverlay={root:gt}}let lt=null;async function ut(gt){gt.addEventListener("end",pt),h.xr.setReferenceSpaceType("local"),await h.xr.setSession(gt),_.textContent="STOP AR",d.domOverlay.root.style.display="",lt=gt}function pt(){lt.removeEventListener("end",pt),_.textContent="START AR",d.domOverlay.root.style.display="none",lt=null}_.style.display="",_.style.cursor="pointer",_.style.left="calc(50% - 50px)",_.style.width="100px",_.textContent="START AR",_.onmouseenter=function(){_.style.opacity="1.0"},_.onmouseleave=function(){_.style.opacity="0.5"},_.onclick=function(){lt===null?navigator.xr.requestSession("immersive-ar",d).then(ut):lt.end()}}():(et(),_.textContent="AR NOT SUPPORTED")}).catch(function(it){et(),console.warn("Exception when trying to call xr.isSessionSupported",it),_.textContent="AR NOT ALLOWED"}),_;{const it=document.createElement("a");return window.isSecureContext===!1?(it.href=document.location.href.replace(/^http:/,"https:"),it.innerHTML="WEBXR NEEDS HTTPS"):(it.href="https://immersiveweb.dev/",it.innerHTML="WEBXR NOT AVAILABLE"),it.style.left="calc(50% - 90px)",it.style.width="180px",it.style.textDecoration="none",nt(it),it}}}.createButton(e.renderer.rendererObject,{requiredFeatures:["hit-test"],optionalFeatures:["dom-overlay"],domOverlay:a})),e.addEventListener("preRender",this._preRender),e.addEventListener("postRender",this._postRender),e.addEventListener("preFrame",this._preFrame)}_updateShadow(){if(!this._viewer)return;const e=this._viewer.scene.modelRoot,i=this._viewer.getPluginByType("Ground");i&&(i.groundReflection=!1,i.mesh.modelObject.position.copy(this._preXRState.groundOffset).multiplyScalar(e.modelObject.scale.x).sub(e.modelObject.position).negate(),i.mesh.modelObject.scale.setScalar(e.modelObject.scale.x*this._preXRState.groundScale))}moveToFloor(e){if(!this._dirty||!this._hitTestSource||!this._xrManager)return;const i=e.getHitTestResults(this._hitTestSource);if(!i.length)return;const s=i[0],a=this._touchInputHelper.getHitPoint(s);a&&(this._placementBox.show=!0,this._viewer.scene.modelRoot,this.placeOnWall?this._touchInputHelper.goalPosition.copy(a):this._touchInputHelper.goalPosition.y=a.y,this._hitTestSource.cancel(),this._hitTestSource=void 0,console.log("move to initial hit point",a))}_removePlacementBox(){this._placementBox&&(this._placementBox.dispose(),this._placementBox=void 0)}_preSetupModel(){var e;const i=this._viewer.scene.modelRoot,s=this._viewer.scene.activeCamera,a=(e=this._xrManager)===null||e===void 0?void 0:e.getCamera(),h=a.cameras[0]||a;this._removePlacementBox();const d=this._viewer.scene.getBounds(!0,!0);d.getSize(new b.Pa4).length()>.01&&(this._placementBox=new r3(d,a,this.placeOnWall),i.add(this._placementBox),this._placementBox.show=!1);const _=a.getWorldDirection(new b.Pa4);i.rotation.y=Math.atan2(-_.x,-_.z)-0,s.cameraObject.zoom=h.zoom,s.cameraObject.near=h.near,s.cameraObject.far=h.far,s.cameraObject.isPerspectiveCamera?(s.cameraObject.fov=h.fov,s.cameraObject.aspect=h.viewport.width/h.viewport.height):console.warn("Perspective camera required."),s.cameraObject.updateProjectionMatrix(),i.position.set(0,0,0);const et=i.userData.arScale||1;i.scale.set(et,et,et),i.position.copy(a.position).add(_.multiplyScalar(5)),i.visible=!0,this._viewer.setBackground(null)}_restorePreXRState(){if(!this._viewer)return;this._viewer.setBackground(this._preXRState.viewerBg),this._preXRState.viewerBg=null;const e=this._viewer.scene.modelRoot;e.scale.copy(this._preXRState.modelScale),e.position.copy(this._preXRState.modelPosition),e.quaternion.copy(this._preXRState.modelRotation),e.updateMatrix(),e.updateMatrixWorld(!0),e.visible=!0;const i=this._viewer.scene.activeCamera;i.position.copy(this._preXRState.cameraPosition),i.target.copy(this._preXRState.cameraTarget),i.cameraObject.up.copy(this._preXRState.cameraUp),i.cameraObject.near=this._preXRState.cameraNear,i.cameraObject.far=this._preXRState.cameraFar,i.cameraObject.isPerspectiveCamera&&(this._preXRState.cameraFov!==void 0&&(i.cameraObject.fov=this._preXRState.cameraFov),this._preXRState.cameraAspect!==void 0&&(i.cameraObject.aspect=this._preXRState.cameraAspect)),i.positionUpdated(!1),i.targetUpdated(!0),i.cameraObject.updateMatrixWorld(!0),i.cameraObject.updateProjectionMatrix()}_cancelHitSources(){this._hitTestSource&&(this._hitTestSource.cancel(),this._hitTestSource=void 0),this._touchInputHelper.cancel()}}s3.PluginType="WEBXR_ARPlugin";const e2=new an({vertexShader:yt.vertexShader,fragmentShader:`
    uniform float opacity;

		uniform sampler2D tDiffuse;

		varying vec2 vUv;

		void main() {

			vec4 texel = texture2D( tDiffuse, vUv );
			// gl_FragColor = vec4(1,0,1,1);
			gl_FragColor = texel;

		}
		`,uniforms:yt.uniforms});async function o3(c,e){if(c.createWriter){const s=await c.createWriter();return await s.write(0,e),void await s.close()}const i=await c.createWritable();await i.write(e),await i.close()}async function IN(c,e){const i={};return e&&(i.writable=!0,i.mode="readwrite"),await c.queryPermission(i)==="granted"||await c.requestPermission(i)==="granted"}e2.renderToScreen=!1,e2.useExistingRenderTarget=!0,e2.clear=!1;class lM extends ot{constructor(e,i){super(),this._state="stopped",this._console=console,this._currentRecording=[],this._currentImages=[],this.stepMode=!1,this._resumeSyncTime=0,this._frameCount=0,this._onstop=a=>{var h;if(this._state="stopped",this._recorder&&this._currentRecording.length>0){const d=new Blob(this._currentRecording,{type:this._options.mimeType});(h=this._recordingCallback)===null||h===void 0||h.call(this,d)}else this._currentImages.length>0&&(this._writeImages([...this._currentImages]),this._currentImages=[]);this._recorder=void 0,this.dispatchEvent({type:"stop"})},this._onstart=a=>{var h;this._state="recording",this._frameCount=0,this.dispatchEvent({type:"start"}),this.stepMode&&((h=this._recorder)===null||h===void 0||h.pause())},this._onresume=a=>{if(!this.stepMode)return;const h=()=>{var _;this._state==="recording"&&((_=this._recorder)===null||_===void 0||_.pause())},d=Math.min(this._resumeSyncTime-Yu(),0)+1e3/this._options.frameRate;d>0?Vl(d).then(h):h()},this._onpause=a=>{},this._ondataavailable=a=>{a.data&&a.data.size>0&&this._currentRecording.push(a.data)},this._onerror=a=>{this._state="error",this._console.error(a),this.dispatchEvent({type:"error",error:a}),this._recorder=void 0},this._canvas=e;const s=i==null?void 0:i.mimeType;this._options={mimeType:s||"auto",frameRate:30},this._setOptions(i||this._options)}_setOptions(e){var i,s;Object.assign(this._options,e),this._options.mimeType&&this._options.mimeType!=="auto"||(this._options.mimeType=(i=lM.GetSupportedMimeTypes([],["h264"],!0))!==null&&i!==void 0?i:lM.GetSupportedMimeTypes(void 0,void 0,!0)),this._options.mimeType&&!(!((s=this._options.mimeType)===null||s===void 0)&&s.startsWith("video/"))||window.MediaRecorder||(this._console.warn("MediaRecorder is not supported, switching to png"),this._options.mimeType="image/png"),this._options.mimeType||console.warn(new Error("No supported mimetype found"))}setOptions(e){this._setOptions(e)}isRecording(){return this._state==="recording"}start(){var e,i,s;if(this._state==="recording")return void this._console.log("Already recording canvas");if(this._state==="error"&&(this._recorder=void 0,this._console.warn("Resetting from error state.")),this._recorder)return this._state==="paused"?(this.dispatchEvent({type:"starting"}),void this._recorder.resume()):void this._console.warn("Canvas recorder unknown state",this._state);if(this._state==="paused")return this.dispatchEvent({type:"starting"}),void(this._state="recording");const a={mimeType:this._options.mimeType,videoBitsPerSecond:this._options.videoBitsPerSecond};if(this._currentRecording=[],this._currentImages=[],this._frameCount=0,(e=a.mimeType)===null||e===void 0?void 0:e.startsWith("video")){if(!window.MediaRecorder)return this._console.error("MediaRecorder not supported, use image sequence"),void(this._state="error");{const h=this._canvas.captureStream(this.stepMode?0:this._options.frameRate),d=(i=h.getVideoTracks())===null||i===void 0?void 0:i[0];this._track=d,this._recorder=new window.MediaRecorder(h,a),this._recorder.onstop=this._onstop,this._recorder.ondataavailable=this._ondataavailable,this._recorder.onerror=this._onerror,this._recorder.onresume=this._onresume,this._recorder.onstart=this._onstart}}this.dispatchEvent({type:"starting"}),this._recorder?(this._state="recording",(s=this._recorder)===null||s===void 0||s.start()):window&&window.showDirectoryPicker&&window.showDirectoryPicker().then(async h=>{const d=await(h==null?void 0:h.getDirectoryHandle("i-"+Math.floor(Date.now()),{create:!0}));this._imgDirectory=d,this._state="recording",this._onstart({})}).catch(h=>{this._onerror({detail:h})})}async requestFrame(){if(this._state!=="recording")return;this._frameCount++;const e=this._options.mimeType;if(!this._recorder&&e.startsWith("image/")){const i=this._canvas.toDataURL(e,90);this._currentImages.push(["frame_"+String(this._frameCount).padStart(5,"0")+(e.includes("png")?".png":".jpg"),i]),this._currentImages.length>60&&(this._writeImages([...this._currentImages]),this._currentImages=[])}this._recorder&&this._track&&this.stepMode&&(this._resumeSyncTime=Yu(),this._track.requestFrame(),this._recorder.resume())}pause(){this._state!=="paused"&&this._state!=="stopped"&&(this._recorder?this._recorder.pause():this._state="paused")}stop(e){this._state!=="stopped"&&(this._state!=="error"?(this._recordingCallback=e,this.dispatchEvent({type:"stopping"}),this._recorder?this._recorder.stop():this._onstop({})):this._console.error("Recorder in error state, cannot stop, call start again."))}get state(){return this._state}dispose(){this._recorder&&this._state!=="error"?this.stop(e=>{this._console.warn("disposed with blob",e),this.dispose()}):this._recorder=void 0}async _writeImages(e){if(!this._imgDirectory)return;const i=await Promise.all(e.map(async([a,h])=>await(await fetch(h)).blob())),s=[];for(let a=0;a<e.length;a++){const h=await this._imgDirectory.getFileHandle(e[a][0],{create:!0});s.push(o3(h,i[a]))}await Promise.all(s)}static GetSupportedMimeTypes(e,i,s=!1){if(!window.MediaRecorder)return s?void 0:[];const a=["webm","ogg","mp4","x-matroska"].filter(_=>!e||e.length<1||e.includes(_)),h=["vp9","vp9.0","vp8","vp8.0","avc1","av1","h265","h.265","h264","h.264","opus"].filter(_=>!i||i.length<1||i.includes(_)),d=[];return a.forEach(_=>{const et=`video/${_}`;h.forEach(nt=>{[`${et};codecs=${nt}`,`${et};codecs:${nt}`,`${et};codecs=${nt.toUpperCase()}`,`${et};codecs:${nt.toUpperCase()}`,`${et}`].forEach(it=>{MediaRecorder.isTypeSupported(it)&&d.push(it)})})}),s?d.length>0?d[0]:void 0:d}}var uP=function(c,e,i,s){var a,h=arguments.length,d=h<3?e:s===null?s=Object.getOwnPropertyDescriptor(e,i):s;if(typeof Reflect=="object"&&typeof Reflect.decorate=="function")d=Reflect.decorate(c,e,i,s);else for(var _=c.length-1;_>=0;_--)(a=c[_])&&(d=(h<3?a(d):h>3?a(e,i,d):a(e,i))||d);return h>3&&d&&Object.defineProperty(e,i,d),d};class j_ extends Ls{constructor(){super(...arguments),this.enabled=!0,this.convergeMode=!1,this.mimeType="auto",this.videoFrameRate=30,this._renderToScreenDisabled=!1,this._preRender=()=>{var e,i,s;if(this.convergeMode&&(!((e=this._recorder)===null||e===void 0)&&e.isRecording())){const a=this._viewer.renderer.composer.renderToScreen;this._viewer.renderer.composer.renderToScreen=((s=(i=this._viewer)===null||i===void 0?void 0:i.getPluginByType("Progressive"))===null||s===void 0?void 0:s.isConverged())||!1,a&&!this._viewer.renderer.composer.renderToScreen&&(this._renderToScreenDisabled=!0)}},this._postRender=()=>{var e,i,s;if(!((e=this._recorder)===null||e===void 0)&&e.isRecording()&&(!this.convergeMode||!((s=(i=this._viewer)===null||i===void 0?void 0:i.getPluginByType("Progressive"))===null||s===void 0)&&s.isConverged(!0))){const a=()=>{var h;return(h=this._recorder)===null||h===void 0?void 0:h.requestFrame()};this.convergeMode?Vl(1).then(a):a()}this._renderToScreenDisabled&&(this._viewer.renderer.composer.renderToScreen=!0)},this._refreshUi=()=>{var e,i;(i=(e=this._uiConfig)===null||e===void 0?void 0:e.children)===null||i===void 0||i.map(s=>Yt(s)).flat(2).forEach(s=>{var a;return(a=s==null?void 0:s.uiRefresh)===null||a===void 0?void 0:a.call(s)})}}get recorder(){return this._recorder}isRecording(){var e,i;return(i=(e=this._recorder)===null||e===void 0?void 0:e.isRecording())!==null&&i!==void 0&&i}refreshRecorderOptions(){this._recorder&&(this._recorder.setOptions({frameRate:this.videoFrameRate,mimeType:this.mimeType}),this._recorder.stepMode=this.convergeMode)}async onAdded(e){await super.onAdded(e),this._recorder=new lM(e.canvas,{frameRate:this.videoFrameRate,mimeType:this.mimeType}),e.addEventListener("preRender",this._preRender),e.addEventListener("postRender",this._postRender),e.scene.addEventListener("addSceneObject",this._refreshUi),this._recorder.addEventListener("starting",()=>this._stateChange(!1)),this._recorder.addEventListener("start",()=>{this.dispatchEvent({type:"start"}),this._stateChange(!this.convergeMode)}),this._recorder.addEventListener("error",()=>{this.dispatchEvent({type:"error"})}),this._recorder.addEventListener("pause",()=>this._stateChange(!1)),this._recorder.addEventListener("resume",()=>this._stateChange(!this.convergeMode)),this._recorder.addEventListener("stop",()=>{this.dispatchEvent({type:"stop"}),this._stateChange(!1)})}_stateChange(e){var i,s,a;this.dirty=e,(i=this._viewer)===null||i===void 0||i.setDirty(),(a=(s=this._uiConfig)===null||s===void 0?void 0:s.children)===null||a===void 0||a.map(h=>Yt(h)).flat(2).forEach(h=>{var d;return(d=h==null?void 0:h.uiRefresh)===null||d===void 0?void 0:d.call(h)})}async onRemove(e){var i;return e.removeEventListener("preRender",this._preRender),e.removeEventListener("preRender",this._postRender),e.scene.removeEventListener("addSceneObject",this._refreshUi),(i=this._recorder)===null||i===void 0||i.dispose(),super.onRemove(e)}startRecording(){var e;return!!this.enabled&&((e=this.recorder)===null||e===void 0?void 0:e.isRecording())===!1&&(this.recorder.stepMode=this.convergeMode,this.recorder.start(),!0)}async stopRecording(){var e;if(!((e=this.recorder)===null||e===void 0)&&e.isRecording())return new Promise((i,s)=>{var a;return(a=this.recorder)===null||a===void 0?void 0:a.stop(i)})}get uiConfig(){if(this._uiConfig)return this._uiConfig;const e=this;return this._uiConfig={type:"folder",label:"Video Export",children:[{type:"slider",label:"Frame Rate",bounds:[1,60],stepSize:1,property:[this,"videoFrameRate"]},{type:"checkbox",limitedUi:!0,property:[this,"convergeMode"]},{type:"dropdown",label:"Mime type",limitedUi:!0,property:[this,"mimeType"],children:[["Auto Video (x264)","auto"],["PNG sequence","image/png"],["JPEG sequence","image/jpeg"]].map(i=>({label:i[0],value:i[1]}))},{type:"input",disabled:!0,label:"State",limitedUi:!0,get value(){var i,s;return(s=(i=e.recorder)===null||i===void 0?void 0:i.state)!==null&&s!==void 0?s:"not initialized"},set value(i){}},{type:"button",get label(){var i;return!((i=e.recorder)===null||i===void 0)&&i.isRecording()?"Stop Recording":"Start Recording"},value:()=>{var i;!((i=e.recorder)===null||i===void 0)&&i.isRecording()?this.stopRecording().then(s=>{if(s){console.log(s);const a=s.type.split(";")[0].split("/").pop()||"mp4";Do(s,"test."+a)}}):this.startRecording()}},{type:"button",limitedUi:!0,label:"Record Camera Views",hidden:()=>{var i,s;return!!(!((i=e.recorder)===null||i===void 0)&&i.isRecording())||!(!((s=this._viewer)===null||s===void 0)&&s.getPluginByType("CameraViews"))},value:()=>{var i,s;(s=(i=this._viewer)===null||i===void 0?void 0:i.getPluginByType("CameraViews"))===null||s===void 0||s.recordAllViews()}},{type:"button",limitedUi:!0,label:"Record Camera Views + GLTF Anim",hidden:()=>{var i,s,a,h;return!!(!((i=e.recorder)===null||i===void 0)&&i.isRecording())||!(!((s=this._viewer)===null||s===void 0)&&s.getPluginByType("CameraViews"))||!(!((h=(a=this._viewer)===null||a===void 0?void 0:a.getPluginByType("GLTFAnimation"))===null||h===void 0)&&h.animations.length)},value:()=>{var i,s,a,h;const d=((s=(i=this._viewer)===null||i===void 0?void 0:i.getPluginByType("GLTFAnimation"))===null||s===void 0?void 0:s.animationState)==="playing";(h=(a=this._viewer)===null||a===void 0?void 0:a.getPluginByType("CameraViews"))===null||h===void 0||h.recordAllViews(()=>{var _,et;(et=(_=this._viewer)===null||_===void 0?void 0:_.getPluginByType("GLTFAnimation"))===null||et===void 0||et.playAnimation()}).then(()=>{var _,et;d||(et=(_=this._viewer)===null||_===void 0?void 0:_.getPluginByType("GLTFAnimation"))===null||et===void 0||et.stopAnimation()})}},{type:"button",limitedUi:!0,label:"Record GLTF Anim",hidden:()=>{var i,s,a;return!!(!((i=e.recorder)===null||i===void 0)&&i.isRecording())||!(!((a=(s=this._viewer)===null||s===void 0?void 0:s.getPluginByType("GLTFAnimation"))===null||a===void 0)&&a.animations.length)},value:async()=>{var i,s;if(!((i=e.recorder)===null||i===void 0)&&i.isRecording())return;const a=(s=this._viewer)===null||s===void 0?void 0:s.getPluginByType("GLTFAnimation");if(!a||!this.startRecording())return;let h=!1;a.loopAnimations&&(h=!0),h&&(a.loopAnimations=!1),await a.playAnimation();const d=await this.stopRecording();if(h&&(a.loopAnimations=!0),d){const _=d.type.split(";")[0].split("/").pop()||"mp4";Do(d,"test."+_)}}}]}}}j_.PluginType="CanvasRecorder",uP([pn(j_.prototype.refreshRecorderOptions),Fn()],j_.prototype,"convergeMode",void 0),uP([pn(j_.prototype.refreshRecorderOptions),Fn()],j_.prototype,"mimeType",void 0),uP([pn(j_.prototype.refreshRecorderOptions),Fn()],j_.prototype,"videoFrameRate",void 0);var t2=function(c,e,i,s){var a,h=arguments.length,d=h<3?e:s===null?s=Object.getOwnPropertyDescriptor(e,i):s;if(typeof Reflect=="object"&&typeof Reflect.decorate=="function")d=Reflect.decorate(c,e,i,s);else for(var _=c.length-1;_>=0;_--)(a=c[_])&&(d=(h<3?a(d):h>3?a(e,i,d):a(e,i))||d);return h>3&&d&&Object.defineProperty(e,i,d),d};const hP=new b.jyz({uniforms:{tDiffuse:{value:null},h:{value:1/512}},vertexShader:`

		varying vec2 vUv;

		void main() {

			vUv = uv;
			gl_Position = projectionMatrix * modelViewMatrix * vec4( position, 1.0 );

		}`,fragmentShader:`

		uniform sampler2D tDiffuse;
		uniform float h;

		varying vec2 vUv;

		void main() {

			vec4 sum = vec4( 0.0 );

			sum += texture2D( tDiffuse, vec2( vUv.x - 4.0 * h, vUv.y ) ) * 0.051;
			sum += texture2D( tDiffuse, vec2( vUv.x - 3.0 * h, vUv.y ) ) * 0.0918;
			sum += texture2D( tDiffuse, vec2( vUv.x - 2.0 * h, vUv.y ) ) * 0.12245;
			sum += texture2D( tDiffuse, vec2( vUv.x - 1.0 * h, vUv.y ) ) * 0.1531;
			sum += texture2D( tDiffuse, vec2( vUv.x, vUv.y ) ) * 0.1633;
			sum += texture2D( tDiffuse, vec2( vUv.x + 1.0 * h, vUv.y ) ) * 0.1531;
			sum += texture2D( tDiffuse, vec2( vUv.x + 2.0 * h, vUv.y ) ) * 0.12245;
			sum += texture2D( tDiffuse, vec2( vUv.x + 3.0 * h, vUv.y ) ) * 0.0918;
			sum += texture2D( tDiffuse, vec2( vUv.x + 4.0 * h, vUv.y ) ) * 0.051;

			gl_FragColor = sum;

		}`});hP.depthTest=!1;const dP=new b.jyz({uniforms:{tDiffuse:{value:null},v:{value:1/512}},vertexShader:`

		varying vec2 vUv;

		void main() {

			vUv = uv;
			gl_Position = projectionMatrix * modelViewMatrix * vec4( position, 1.0 );

		}`,fragmentShader:`

		uniform sampler2D tDiffuse;
		uniform float v;

		varying vec2 vUv;

		void main() {

			vec4 sum = vec4( 0.0 );

			sum += texture2D( tDiffuse, vec2( vUv.x, vUv.y - 4.0 * v ) ) * 0.051;
			sum += texture2D( tDiffuse, vec2( vUv.x, vUv.y - 3.0 * v ) ) * 0.0918;
			sum += texture2D( tDiffuse, vec2( vUv.x, vUv.y - 2.0 * v ) ) * 0.12245;
			sum += texture2D( tDiffuse, vec2( vUv.x, vUv.y - 1.0 * v ) ) * 0.1531;
			sum += texture2D( tDiffuse, vec2( vUv.x, vUv.y ) ) * 0.1633;
			sum += texture2D( tDiffuse, vec2( vUv.x, vUv.y + 1.0 * v ) ) * 0.1531;
			sum += texture2D( tDiffuse, vec2( vUv.x, vUv.y + 2.0 * v ) ) * 0.12245;
			sum += texture2D( tDiffuse, vec2( vUv.x, vUv.y + 3.0 * v ) ) * 0.0918;
			sum += texture2D( tDiffuse, vec2( vUv.x, vUv.y + 4.0 * v ) ) * 0.051;

			gl_FragColor = sum;

		}`});dP.depthTest=!1;class z_ extends ku{constructor(e={},i=!1){super(e),this.contactShadows=!0,this.blurAmount=1,this.shadowScale=1,this.shadowHeight=5,this.shadowCamera=new b.iKG(-1,1,1,-1,.001,this.shadowHeight),this._refreshShadowCameraFrustum=this._refreshShadowCameraFrustum.bind(this),this.refreshOptions=this.refreshOptions.bind(this),this._showDebug=i,i&&this.dependencies.push(mp)}async onAdded(e){const i=e.renderer.createTarget({type:b.ywz,format:b.wk1,encoding:b.rnI,size:{width:512,height:512},generateMipmaps:!1,depthBuffer:!0,minFilter:b.wem,magFilter:b.wem});i.texture.name="groundContactDepthTexture";const s=new b.lRF({depthPacking:b.z81});s.onBeforeCompile=function(h){h.uniforms.opacity.value=1,h.fragmentShader=`
						${h.fragmentShader.replace("gl_FragColor = vec4( vec3( 1.0 - fragCoordZ ), opacity );","gl_FragColor = vec4( vec3( 1.0 - fragCoordZ ), 1.0 );")}
					`};const a=new qS(i,s,new b.Ilk(0,0,0),0);this._depthPass=a,await super.onAdded(e)}_postFrame(){super._postFrame(),this._viewer}_preRender(){if(super._preRender(),!this._viewer||!this._depthPass)return;this._depthPass.scene=this._viewer.scene.modelObject,this._depthPass.camera=this.shadowCamera,this._depthPass.render(this._viewer.renderer.rendererObject);const e=this._viewer.renderer.getTempTarget({type:b.ywz,format:b.wk1,encoding:b.rnI,size:{width:1024,height:1024},generateMipmaps:!1,depthBuffer:!1,minFilter:b.wem,magFilter:b.wem});this._blurShadow(e),this._blurShadow(e,.4),this._viewer.renderer.releaseTempTarget(e)}_blurShadow(e,i=1){this._viewer&&this._depthPass&&(hP.uniforms.h.value=i*this.blurAmount/256,dP.uniforms.v.value=i*this.blurAmount/256,this._viewer.renderer.blit(this._depthPass.target.texture,e,{material:hP,clear:!0}),this._viewer.renderer.blit(e.texture,this._depthPass.target,{material:dP,clear:!0}))}async onDispose(e){return super.onDispose(e)}async onRemove(e){return super.onRemove(e)}_refreshTransform(){super._refreshTransform(),this._mesh&&this._viewer&&(this.shadowCamera.position.copy(this._mesh.getWorldPosition(new b.Pa4)),this.shadowCamera.setRotationFromEuler(new b.USm(Math.PI/2,0,0)),this.shadowCamera.updateMatrixWorld(),this._refreshShadowCameraFrustum(),this._mesh.scale.y=-this.size)}_refreshShadowCameraFrustum(){this.shadowCamera&&(this.shadowCamera.left=-this.size/(2*this.shadowScale),this.shadowCamera.right=this.size/(2*this.shadowScale),this.shadowCamera.top=this.size/(2*this.shadowScale),this.shadowCamera.bottom=-this.size/(2*this.shadowScale),this.shadowCamera.far=this.shadowHeight,this.shadowCamera.updateProjectionMatrix(),this._setDirty())}_setDirty(){var e;(e=this._viewer)===null||e===void 0||e.setDirty()}_removeMaterial(){this._material&&super._removeMaterial()}refreshOptions(){this._viewer&&super.refreshOptions()}_refreshMaterial(){var e;if(!this._viewer)return!1;const i=super._refreshMaterial();return this._material&&(this._material.alphaMap=((e=this._depthPass)===null||e===void 0?void 0:e.target.texture)||null,i&&(this._material.roughness=1,this._material.metalness=0,this._material.color.set(1118481),this._material.transparent=!0,this._material.materialObject.userData.ssreflDisabled=!0,this._material.materialObject.userData.ssreflNonPhysical=!1)),i}_extraUiConfig(){return[{label:"Contact Shadows",type:"checkbox",property:[this,"contactShadows"]},{label:"Shadow Scale",type:"slider",bounds:[0,2],property:[this,"shadowScale"]},{label:"Shadow Height",type:"slider",bounds:[0,20],property:[this,"shadowHeight"]},{label:"Blur Amount",type:"slider",bounds:[0,10],property:[this,"blurAmount"]},...super._extraUiConfig()]}}z_.PluginType="ContactShadowGroundPlugin",t2([pn(z_.prototype.refreshOptions),Fn()],z_.prototype,"contactShadows",void 0),t2([Fn(),pn(z_.prototype._setDirty)],z_.prototype,"blurAmount",void 0),t2([Fn(),pn(z_.prototype._refreshShadowCameraFrustum)],z_.prototype,"shadowScale",void 0),t2([Fn(),pn(z_.prototype._refreshShadowCameraFrustum)],z_.prototype,"shadowHeight",void 0);const rS=new b.cPb(45,1,.1,1e3);function pP(c,e,i,s=7,a=new b.Pa4(0,0,1.5)){i=i??c.scene.modelObject;const h=new Dr().expandByObject(i??e,!0,!0),d=h.getCenter(new b.Pa4),_=h.getSize(new b.Pa4);rS.position.copy(d).add(a.clone().multiplyScalar(Math.max(_.x,_.y,_.z))),rS.lookAt(d),e&&e.traverseVisible(it=>{it.layers.enable(s)}),s>0?rS.layers.set(s):rS.layers.enableAll();const et=e==null?void 0:e.visible;e&&(e.visible=!0),c.renderer.rendererObject.setRenderTarget(null),c.renderer.rendererObject.render(i,rS);const nt=c.renderer.rendererObject.domElement.toDataURL("image/png");return e&&(e.visible=et,e.traverseVisible(it=>{it.layers.disable(s)}),rS.layers.enableAll()),c.setDirty(),nt}class fP{constructor(e){this.viewer=e,this._lights=[],this.shapes={sphere:new b.Kj0(new b.xo$(1)),cube:new b.Kj0(new b.DvJ(1,1,1)),cylinder:new b.Kj0(new b.fHI(.5,.5,1))};const i=new b.xsS;this._channel=7;const s=new b.vmT(16777215,4473924,1);s.position.set(0,10,0),s.layers.set(this._channel),i.add(s),this._lights.push(s),this._scene=i}dispose(){[...this._lights].forEach(e=>e.dispose()),Object.values(this.shapes).forEach(e=>{e.geometry&&e.geometry.dispose()})}generate(e,i="sphere"){const s=this.shapes[i]||new b.Kj0(new b.xo$(1));s.material=e.materialObject,s.geometry.attributes.tangent||s.geometry.computeTangents(),this._scene.add(s),this._scene.environment=this.viewer.scene.getEnvironment();const a=s.material.envMapIntensity;typeof a=="number"&&(s.material.envMapIntensity=Math.max(a,2));const h=pP(this.viewer,s,this._scene,this._channel,new b.Pa4(0,0,1.5));return typeof a=="number"&&(s.material.envMapIntensity=a),this._scene.remove(s),s.material=void 0,h}}class n2 extends Ls{constructor(){super(...arguments),this.enabled=!0,this._uiNeedRefresh=!1,this._refreshUiConfig=()=>{var e,i;this.enabled&&((i=(e=this.uiConfig).uiRefresh)===null||i===void 0||i.call(e))},this.dependencies=[qr],this.variations=[],this._selectedMaterial=()=>{var e,i;return((i=(e=this._picking)===null||e===void 0?void 0:e.getSelectedObject())===null||i===void 0?void 0:i.material)||void 0},this.uiConfig={label:"Material Configurator",type:"folder",children:[()=>{var e;return[{type:"input",label:"uuid",property:[this._selectedMaterial(),"uuid"],hidden:()=>!this._selectedMaterial(),disabled:!0},{type:"input",label:"title",hidden:()=>!this._selectedMaterial(),property:()=>[this.getSelectedVariation(),"title"],onChange:async()=>this.refreshUi()},{type:"dropdown",label:"Preview Type",hidden:()=>!this._selectedMaterial(),property:()=>[this.getSelectedVariation(),"preview"],onChange:async()=>this.refreshUi(),children:["generate:sphere","generate:cube","color","map","emissive",...Object.keys(c0).filter(i=>i.endsWith("Map"))].map(i=>({label:i,value:i}))},...((e=this.getSelectedVariation())===null||e===void 0?void 0:e.materials.map(i=>i.uiConfig?Object.assign(i.uiConfig,{expanded:!1}):{}))||[],{type:"button",label:"Remove All",hidden:()=>!this._selectedMaterial(),value:async()=>{const i=this.getSelectedVariation();i&&await this._viewer.confirm("Material configurator: Remove all variations for this material?")&&(i.materials=[]),this.refreshUi()}},{type:"button",label:"Remove Variation",hidden:()=>!this._selectedMaterial(),value:async()=>{const i=this.getSelectedVariation();i&&await this._viewer.confirm("Material configurator: Remove this variation?")&&this.removeVariation(i)}},{type:"button",label:"Add Variation",hidden:()=>!this._selectedMaterial(),value:()=>this.addVariation(this._selectedMaterial())},{type:"button",label:"Refresh Ui",value:()=>this.refreshUi()}]}]}}async onAdded(e){var i,s;await super.onAdded(e),this.refreshUi=this.refreshUi.bind(this),this._refreshUi=this._refreshUi.bind(this),this._picking=(i=this._viewer)===null||i===void 0?void 0:i.getPluginByType("Picking"),this._previewGenerator=new fP(this._viewer),(s=this._picking)===null||s===void 0||s.addEventListener("selectedObjectChanged",this._refreshUiConfig),e.addEventListener("preFrame",this._refreshUi),this.addEventListener("deserialize",this.refreshUi)}fromJSON(e,i){return this.variations=[],super.fromJSON(e,i)}async onRemove(e){var i,s;return(i=this._previewGenerator)===null||i===void 0||i.dispose(),this._previewGenerator=void 0,(s=this._picking)===null||s===void 0||s.removeEventListener("selectedObjectChanged",this._refreshUiConfig),this.removeEventListener("deserialize",this.refreshUi),e.removeEventListener("preFrame",this._refreshUi),this._picking=void 0,super.onRemove(e)}findVariation(e){return e?this.variations.find(i=>i.uuid===e):void 0}getSelectedVariation(){var e,i;return this.findVariation((e=this._selectedMaterial())===null||e===void 0?void 0:e.uuid)||this.findVariation((i=this._selectedMaterial())===null||i===void 0?void 0:i.name)}applyVariation(e,i){var s,a;const h=e.materials.find(d=>d.uuid===i);if(h){const d=(a=(s=this._viewer)===null||s===void 0?void 0:s.getManager())===null||a===void 0?void 0:a.materials;let _=d==null?void 0:d.findMaterialsByName(e.uuid);(!_||_.length<1)&&(_=[d==null?void 0:d.findMaterial(e.uuid)]),_.forEach(et=>{if(!et)return;const nt=et.name;et.copyProps(h),et.name=nt})}}refreshUi(){this.enabled&&(this._uiNeedRefresh=!0)}async _refreshUi(){return!(!this.enabled||!this._viewer||!this._uiNeedRefresh||(this._uiNeedRefresh=!1,this._refreshUiConfig(),0))}removeVariationForMaterial(e){let i=this.findVariation(e.uuid);!i&&e.name.length>0&&(i=this.findVariation(e.name)),i&&this.removeVariation(i)}removeVariation(e){e&&(this.variations.splice(this.variations.indexOf(e),1),this.refreshUi())}addVariation(e){var i;const s=(i=e==null?void 0:e.clone)===null||i===void 0?void 0:i.call(e);if(e&&s){let a=this.findVariation(e.uuid);!a&&e.name.length>0&&(a=this.findVariation(e.name)),a||this.variations.push(a={uuid:e.name.length>0?e.name:e.uuid,title:"Name",preview:"generate:sphere",materials:[]}),a.materials.push(s),this.refreshUi()}}}n2.PluginType="MaterialConfiguratorBasePlugin",function(c,e,i,s){var a,h=arguments.length,d=h<3?e:s===null?s=Object.getOwnPropertyDescriptor(e,i):s;if(typeof Reflect=="object"&&typeof Reflect.decorate=="function")d=Reflect.decorate(c,e,i,s);else for(var _=c.length-1;_>=0;_--)(a=c[_])&&(d=(h<3?a(d):h>3?a(e,i,d):a(e,i))||d);h>3&&d&&Object.defineProperty(e,i,d)}([Fn()],n2.prototype,"variations",void 0);const a3=(c,e=!0)=>{const i=new mo().set(c);return e&&i.convertLinearToSRGB(),`data:image/svg+xml,%3Csvg width='16' height='16' viewBox='0 0 16 16' fill='none' xmlns='http://www.w3.org/2000/svg'%3E%3Crect width='16' height='16' fill='%23${i.getHexString()}'/%3E%3C/svg%3E%0A`},l3=(c,e=!0)=>{const i=new mo().set(c);return e&&i.convertLinearToSRGB(),`data:image/svg+xml,%3Csvg width='16' height='16' viewBox='0 0 16 16' fill='none' xmlns='http://www.w3.org/2000/svg'%3E%3Ccircle cx='8' cy='8' r='7' fill='%23${i.getHexString()}'/%3E%3C/svg%3E%0A`},cM=c=>`data:image/svg+xml,%3Csvg viewBox='0 0 80 14' xmlns='http://www.w3.org/2000/svg'%3E%3Ctext style='font: 8px "Roboto Mono", "Source Code Pro", Menlo, Courier, monospace; fill: white;' x='9' y='9'%3E${c}%3C/text%3E%3C/svg%3E%0A`,mP=async(c,e)=>tu(await rA(c),e),c3=async(c,e)=>await mP(c,e).then(i=>i.toDataURL("image/png"));class Q0{static _initialize(){this._inited=!0,r_(Wt`
  .customContextGrid {
    background: #28223C;
    //backdrop-filter: blur(8px);
    border: 0.5px solid rgba(220, 220, 220, 0.3);
    width: auto;
    height: auto;
    position: absolute;
    display: flex;
    flex-direction: row;
    flex-wrap: wrap;
    z-index: 200;
    padding: 0.35rem 0.35rem;
    border-radius: 0.375rem;
    min-width: 5rem;
    pointer-events: auto;
    box-shadow: 0px 2px 10px rgba(12, 12, 12, 0.2);

    color: white;
    font-size: 0.65rem;
    font-family: Inter, "Roboto Mono", "Source Code Pro", Menlo, Courier, monospace;
  }
  .customContextGridItems {
    background-color: transparent;
    cursor: pointer;
    border-radius: 0.25rem;
    line-height: 1rem;
    font-weight: 500;
    overflow: hidden;
    margin: 0.12rem;
  }
  .customContextGridItems:hover {
    color: white;
    background-color: #017AFF;
  }
  .customContextGridItemImage{
    width: 100%;
    height: 100%;
  }
  .customContextGridHeading{
    width: 100%;
    padding: 0.12rem;
    font-size: 0.85rem;
  }

        `)}static Create(e,i,s,a,h,d,_){var et;this._inited||this._initialize();const nt=Cv(),it=nt?.15:.25,lt=nt?1.5:2.5,ut=rp({classList:["customContextGrid"],addToBody:!1,innerHTML:`
            <div class="customContextGridHeading"> ${i} </div>
            `});ut.style.top=h+"px",ut.style.left=a+"px",ut.style.gap=it+"rem",ut.style.width=(lt+it)*s-it+"rem",ut.dataset.tag=e;for(const pt of d){const gt=rp({classList:["customContextGridItems"],addToBody:!1,innerHTML:`
            <img src="${pt.image}" class="customContextGridItemImage">
            `});gt.style.width=lt+"rem",gt.style.height=lt+"rem",ut.appendChild(gt),gt.onclick=()=>{var vt;return(vt=pt.onClick)===null||vt===void 0?void 0:vt.call(pt,pt.id)},_(gt,pt)}return(et=this.Elements)===null||et===void 0||et.push(ut),ut}static RemoveAll(e){if(e){const i=this.Elements.filter(s=>s.dataset.tag===e);for(const s of i)s.remove();this.Elements=this.Elements.filter(s=>s.dataset.tag!==e)}else{for(const i of this.Elements)i.remove();this.Elements=[]}}static RebuildUi(e){if(this.Elements.length===0)return;e||(e=document.body);for(const s of this.Elements)s.remove();let i=20;for(const s of this.Elements)s.style.top=i+"px",e.appendChild(s),i+=s.clientHeight+20}}function G0(c){if(c==null)return window;if(c.toString()!=="[object Window]"){var e=c.ownerDocument;return e&&e.defaultView||window}return c}function sS(c){return c instanceof G0(c).Element||c instanceof Element}function t0(c){return c instanceof G0(c).HTMLElement||c instanceof HTMLElement}function gP(c){return typeof ShadowRoot<"u"&&(c instanceof G0(c).ShadowRoot||c instanceof ShadowRoot)}Q0.Elements=[],Q0._inited=!1;var a1=Math.max,i2=Math.min,oS=Math.round;function aS(c,e){e===void 0&&(e=!1);var i=c.getBoundingClientRect(),s=1,a=1;if(t0(c)&&e){var h=c.offsetHeight,d=c.offsetWidth;d>0&&(s=oS(i.width)/d||1),h>0&&(a=oS(i.height)/h||1)}return{width:i.width/s,height:i.height/a,top:i.top/a,right:i.right/s,bottom:i.bottom/a,left:i.left/s,x:i.left/s,y:i.top/a}}function vP(c){var e=G0(c);return{scrollLeft:e.pageXOffset,scrollTop:e.pageYOffset}}function V_(c){return c?(c.nodeName||"").toLowerCase():null}function Ew(c){return((sS(c)?c.ownerDocument:c.document)||window.document).documentElement}function _P(c){return aS(Ew(c)).left+vP(c).scrollLeft}function hy(c){return G0(c).getComputedStyle(c)}function AP(c){var e=hy(c),i=e.overflow,s=e.overflowX,a=e.overflowY;return/auto|scroll|overlay|hidden/.test(i+a+s)}function DN(c,e,i){i===void 0&&(i=!1);var s,a,h=t0(e),d=t0(e)&&function(lt){var ut=lt.getBoundingClientRect(),pt=oS(ut.width)/lt.offsetWidth||1,gt=oS(ut.height)/lt.offsetHeight||1;return pt!==1||gt!==1}(e),_=Ew(e),et=aS(c,d),nt={scrollLeft:0,scrollTop:0},it={x:0,y:0};return(h||!h&&!i)&&((V_(e)!=="body"||AP(_))&&(nt=(s=e)!==G0(s)&&t0(s)?{scrollLeft:(a=s).scrollLeft,scrollTop:a.scrollTop}:vP(s)),t0(e)?((it=aS(e,!0)).x+=e.clientLeft,it.y+=e.clientTop):_&&(it.x=_P(_))),{x:et.left+nt.scrollLeft-it.x,y:et.top+nt.scrollTop-it.y,width:et.width,height:et.height}}function yP(c){var e=aS(c),i=c.offsetWidth,s=c.offsetHeight;return Math.abs(e.width-i)<=1&&(i=e.width),Math.abs(e.height-s)<=1&&(s=e.height),{x:c.offsetLeft,y:c.offsetTop,width:i,height:s}}function r2(c){return V_(c)==="html"?c:c.assignedSlot||c.parentNode||(gP(c)?c.host:null)||Ew(c)}function u3(c){return["html","body","#document"].indexOf(V_(c))>=0?c.ownerDocument.body:t0(c)&&AP(c)?c:u3(r2(c))}function uM(c,e){var i;e===void 0&&(e=[]);var s=u3(c),a=s===((i=c.ownerDocument)==null?void 0:i.body),h=G0(s),d=a?[h].concat(h.visualViewport||[],AP(s)?s:[]):s,_=e.concat(d);return a?_:_.concat(uM(r2(d)))}function PN(c){return["table","td","th"].indexOf(V_(c))>=0}function h3(c){return t0(c)&&hy(c).position!=="fixed"?c.offsetParent:null}function hM(c){for(var e=G0(c),i=h3(c);i&&PN(i)&&hy(i).position==="static";)i=h3(i);return i&&(V_(i)==="html"||V_(i)==="body"&&hy(i).position==="static")?e:i||function(s){var a=navigator.userAgent.toLowerCase().indexOf("firefox")!==-1;if(navigator.userAgent.indexOf("Trident")!==-1&&t0(s)&&hy(s).position==="fixed")return null;var h=r2(s);for(gP(h)&&(h=h.host);t0(h)&&["html","body"].indexOf(V_(h))<0;){var d=hy(h);if(d.transform!=="none"||d.perspective!=="none"||d.contain==="paint"||["transform","perspective"].indexOf(d.willChange)!==-1||a&&d.willChange==="filter"||a&&d.filter&&d.filter!=="none")return h;h=h.parentNode}return null}(c)||e}var nm="top",pv="bottom",fv="right",im="left",s2="auto",lS=[nm,pv,fv,im],l1="start",cS="end",d3="clippingParents",wP="viewport",uS="popper",p3="reference",xP=lS.reduce(function(c,e){return c.concat([e+"-"+l1,e+"-"+cS])},[]),bP=[].concat(lS,[s2]).reduce(function(c,e){return c.concat([e,e+"-"+l1,e+"-"+cS])},[]),f3="beforeRead",m3="read",g3="afterRead",v3="beforeMain",_3="main",A3="afterMain",y3="beforeWrite",w3="write",x3="afterWrite",b3=[f3,m3,g3,v3,_3,A3,y3,w3,x3];function RN(c){var e=new Map,i=new Set,s=[];function a(h){i.add(h.name),[].concat(h.requires||[],h.requiresIfExists||[]).forEach(function(d){if(!i.has(d)){var _=e.get(d);_&&a(_)}}),s.push(h)}return c.forEach(function(h){e.set(h.name,h)}),c.forEach(function(h){i.has(h.name)||a(h)}),s}var E3={placement:"bottom",modifiers:[],strategy:"absolute"};function S3(){for(var c=arguments.length,e=new Array(c),i=0;i<c;i++)e[i]=arguments[i];return!e.some(function(s){return!(s&&typeof s.getBoundingClientRect=="function")})}function o2(c){c===void 0&&(c={});var e=c,i=e.defaultModifiers,s=i===void 0?[]:i,a=e.defaultOptions,h=a===void 0?E3:a;return function(d,_,et){et===void 0&&(et=h);var nt,it,lt={placement:"bottom",orderedModifiers:[],options:Object.assign({},E3,h),modifiersData:{},elements:{reference:d,popper:_},attributes:{},styles:{}},ut=[],pt=!1,gt={state:lt,setOptions:function(Ct){var wt=typeof Ct=="function"?Ct(lt.options):Ct;vt(),lt.options=Object.assign({},h,lt.options,wt),lt.scrollParents={reference:sS(d)?uM(d):d.contextElement?uM(d.contextElement):[],popper:uM(_)};var xt,_t,Pt=function(Bt){var Ot=RN(Bt);return b3.reduce(function(Lt,qt){return Lt.concat(Ot.filter(function(en){return en.phase===qt}))},[])}((xt=[].concat(s,lt.options.modifiers),_t=xt.reduce(function(Bt,Ot){var Lt=Bt[Ot.name];return Bt[Ot.name]=Lt?Object.assign({},Lt,Ot,{options:Object.assign({},Lt.options,Ot.options),data:Object.assign({},Lt.data,Ot.data)}):Ot,Bt},{}),Object.keys(_t).map(function(Bt){return _t[Bt]})));return lt.orderedModifiers=Pt.filter(function(Bt){return Bt.enabled}),lt.orderedModifiers.forEach(function(Bt){var Ot=Bt.name,Lt=Bt.options,qt=Lt===void 0?{}:Lt,en=Bt.effect;if(typeof en=="function"){var cn=en({state:lt,name:Ot,instance:gt,options:qt});ut.push(cn||function(){})}}),gt.update()},forceUpdate:function(){if(!pt){var Ct=lt.elements,wt=Ct.reference,xt=Ct.popper;if(S3(wt,xt)){lt.rects={reference:DN(wt,hM(xt),lt.options.strategy==="fixed"),popper:yP(xt)},lt.reset=!1,lt.placement=lt.options.placement,lt.orderedModifiers.forEach(function(en){return lt.modifiersData[en.name]=Object.assign({},en.data)});for(var _t=0;_t<lt.orderedModifiers.length;_t++)if(lt.reset!==!0){var Pt=lt.orderedModifiers[_t],Bt=Pt.fn,Ot=Pt.options,Lt=Ot===void 0?{}:Ot,qt=Pt.name;typeof Bt=="function"&&(lt=Bt({state:lt,options:Lt,name:qt,instance:gt})||lt)}else lt.reset=!1,_t=-1}}},update:(nt=function(){return new Promise(function(Ct){gt.forceUpdate(),Ct(lt)})},function(){return it||(it=new Promise(function(Ct){Promise.resolve().then(function(){it=void 0,Ct(nt())})})),it}),destroy:function(){vt(),pt=!0}};if(!S3(d,_))return gt;function vt(){ut.forEach(function(Ct){return Ct()}),ut=[]}return gt.setOptions(et).then(function(Ct){!pt&&et.onFirstUpdate&&et.onFirstUpdate(Ct)}),gt}}var BN=o2(),a2={passive:!0},EP={name:"eventListeners",enabled:!0,phase:"write",fn:function(){},effect:function(c){var e=c.state,i=c.instance,s=c.options,a=s.scroll,h=a===void 0||a,d=s.resize,_=d===void 0||d,et=G0(e.elements.popper),nt=[].concat(e.scrollParents.reference,e.scrollParents.popper);return h&&nt.forEach(function(it){it.addEventListener("scroll",i.update,a2)}),_&&et.addEventListener("resize",i.update,a2),function(){h&&nt.forEach(function(it){it.removeEventListener("scroll",i.update,a2)}),_&&et.removeEventListener("resize",i.update,a2)}},data:{}};function Q_(c){return c.split("-")[0]}function hS(c){return c.split("-")[1]}function SP(c){return["top","bottom"].indexOf(c)>=0?"x":"y"}function C3(c){var e,i=c.reference,s=c.element,a=c.placement,h=a?Q_(a):null,d=a?hS(a):null,_=i.x+i.width/2-s.width/2,et=i.y+i.height/2-s.height/2;switch(h){case nm:e={x:_,y:i.y-s.height};break;case pv:e={x:_,y:i.y+i.height};break;case fv:e={x:i.x+i.width,y:et};break;case im:e={x:i.x-s.width,y:et};break;default:e={x:i.x,y:i.y}}var nt=h?SP(h):null;if(nt!=null){var it=nt==="y"?"height":"width";switch(d){case l1:e[nt]=e[nt]-(i[it]/2-s[it]/2);break;case cS:e[nt]=e[nt]+(i[it]/2-s[it]/2)}}return e}var CP={name:"popperOffsets",enabled:!0,phase:"read",fn:function(c){var e=c.state,i=c.name;e.modifiersData[i]=C3({reference:e.rects.reference,element:e.rects.popper,strategy:"absolute",placement:e.placement})},data:{}},kN={top:"auto",right:"auto",bottom:"auto",left:"auto"};function M3(c){var e,i=c.popper,s=c.popperRect,a=c.placement,h=c.variation,d=c.offsets,_=c.position,et=c.gpuAcceleration,nt=c.adaptive,it=c.roundOffsets,lt=c.isFixed,ut=d.x,pt=ut===void 0?0:ut,gt=d.y,vt=gt===void 0?0:gt,Ct=typeof it=="function"?it({x:pt,y:vt}):{x:pt,y:vt};pt=Ct.x,vt=Ct.y;var wt=d.hasOwnProperty("x"),xt=d.hasOwnProperty("y"),_t=im,Pt=nm,Bt=window;if(nt){var Ot=hM(i),Lt="clientHeight",qt="clientWidth";Ot===G0(i)&&hy(Ot=Ew(i)).position!=="static"&&_==="absolute"&&(Lt="scrollHeight",qt="scrollWidth"),(a===nm||(a===im||a===fv)&&h===cS)&&(Pt=pv,vt-=(lt&&Ot===Bt&&Bt.visualViewport?Bt.visualViewport.height:Ot[Lt])-s.height,vt*=et?1:-1),a!==im&&(a!==nm&&a!==pv||h!==cS)||(_t=fv,pt-=(lt&&Ot===Bt&&Bt.visualViewport?Bt.visualViewport.width:Ot[qt])-s.width,pt*=et?1:-1)}var en,cn=Object.assign({position:_},nt&&kN),An=it===!0?function(mn){var Tn=mn.x,vn=mn.y,xn=window.devicePixelRatio||1;return{x:oS(Tn*xn)/xn||0,y:oS(vn*xn)/xn||0}}({x:pt,y:vt}):{x:pt,y:vt};return pt=An.x,vt=An.y,et?Object.assign({},cn,((en={})[Pt]=xt?"0":"",en[_t]=wt?"0":"",en.transform=(Bt.devicePixelRatio||1)<=1?"translate("+pt+"px, "+vt+"px)":"translate3d("+pt+"px, "+vt+"px, 0)",en)):Object.assign({},cn,((e={})[Pt]=xt?vt+"px":"",e[_t]=wt?pt+"px":"",e.transform="",e))}var MP={name:"computeStyles",enabled:!0,phase:"beforeWrite",fn:function(c){var e=c.state,i=c.options,s=i.gpuAcceleration,a=s===void 0||s,h=i.adaptive,d=h===void 0||h,_=i.roundOffsets,et=_===void 0||_,nt={placement:Q_(e.placement),variation:hS(e.placement),popper:e.elements.popper,popperRect:e.rects.popper,gpuAcceleration:a,isFixed:e.options.strategy==="fixed"};e.modifiersData.popperOffsets!=null&&(e.styles.popper=Object.assign({},e.styles.popper,M3(Object.assign({},nt,{offsets:e.modifiersData.popperOffsets,position:e.options.strategy,adaptive:d,roundOffsets:et})))),e.modifiersData.arrow!=null&&(e.styles.arrow=Object.assign({},e.styles.arrow,M3(Object.assign({},nt,{offsets:e.modifiersData.arrow,position:"absolute",adaptive:!1,roundOffsets:et})))),e.attributes.popper=Object.assign({},e.attributes.popper,{"data-popper-placement":e.placement})},data:{}},l2={name:"applyStyles",enabled:!0,phase:"write",fn:function(c){var e=c.state;Object.keys(e.elements).forEach(function(i){var s=e.styles[i]||{},a=e.attributes[i]||{},h=e.elements[i];t0(h)&&V_(h)&&(Object.assign(h.style,s),Object.keys(a).forEach(function(d){var _=a[d];_===!1?h.removeAttribute(d):h.setAttribute(d,_===!0?"":_)}))})},effect:function(c){var e=c.state,i={popper:{position:e.options.strategy,left:"0",top:"0",margin:"0"},arrow:{position:"absolute"},reference:{}};return Object.assign(e.elements.popper.style,i.popper),e.styles=i,e.elements.arrow&&Object.assign(e.elements.arrow.style,i.arrow),function(){Object.keys(e.elements).forEach(function(s){var a=e.elements[s],h=e.attributes[s]||{},d=Object.keys(e.styles.hasOwnProperty(s)?e.styles[s]:i[s]).reduce(function(_,et){return _[et]="",_},{});t0(a)&&V_(a)&&(Object.assign(a.style,d),Object.keys(h).forEach(function(_){a.removeAttribute(_)}))})}},requires:["computeStyles"]},T3={name:"offset",enabled:!0,phase:"main",requires:["popperOffsets"],fn:function(c){var e=c.state,i=c.options,s=c.name,a=i.offset,h=a===void 0?[0,0]:a,d=bP.reduce(function(it,lt){return it[lt]=function(ut,pt,gt){var vt=Q_(ut),Ct=[im,nm].indexOf(vt)>=0?-1:1,wt=typeof gt=="function"?gt(Object.assign({},pt,{placement:ut})):gt,xt=wt[0],_t=wt[1];return xt=xt||0,_t=(_t||0)*Ct,[im,fv].indexOf(vt)>=0?{x:_t,y:xt}:{x:xt,y:_t}}(lt,e.rects,h),it},{}),_=d[e.placement],et=_.x,nt=_.y;e.modifiersData.popperOffsets!=null&&(e.modifiersData.popperOffsets.x+=et,e.modifiersData.popperOffsets.y+=nt),e.modifiersData[s]=d}},ON={left:"right",right:"left",bottom:"top",top:"bottom"};function c2(c){return c.replace(/left|right|bottom|top/g,function(e){return ON[e]})}var LN={start:"end",end:"start"};function I3(c){return c.replace(/start|end/g,function(e){return LN[e]})}function D3(c,e){var i=e.getRootNode&&e.getRootNode();if(c.contains(e))return!0;if(i&&gP(i)){var s=e;do{if(s&&c.isSameNode(s))return!0;s=s.parentNode||s.host}while(s)}return!1}function TP(c){return Object.assign({},c,{left:c.x,top:c.y,right:c.x+c.width,bottom:c.y+c.height})}function P3(c,e){return e===wP?TP(function(i){var s=G0(i),a=Ew(i),h=s.visualViewport,d=a.clientWidth,_=a.clientHeight,et=0,nt=0;return h&&(d=h.width,_=h.height,/^((?!chrome|android).)*safari/i.test(navigator.userAgent)||(et=h.offsetLeft,nt=h.offsetTop)),{width:d,height:_,x:et+_P(i),y:nt}}(c)):sS(e)?function(i){var s=aS(i);return s.top=s.top+i.clientTop,s.left=s.left+i.clientLeft,s.bottom=s.top+i.clientHeight,s.right=s.left+i.clientWidth,s.width=i.clientWidth,s.height=i.clientHeight,s.x=s.left,s.y=s.top,s}(e):TP(function(i){var s,a=Ew(i),h=vP(i),d=(s=i.ownerDocument)==null?void 0:s.body,_=a1(a.scrollWidth,a.clientWidth,d?d.scrollWidth:0,d?d.clientWidth:0),et=a1(a.scrollHeight,a.clientHeight,d?d.scrollHeight:0,d?d.clientHeight:0),nt=-h.scrollLeft+_P(i),it=-h.scrollTop;return hy(d||a).direction==="rtl"&&(nt+=a1(a.clientWidth,d?d.clientWidth:0)-_),{width:_,height:et,x:nt,y:it}}(Ew(c)))}function R3(c){return Object.assign({},{top:0,right:0,bottom:0,left:0},c)}function B3(c,e){return e.reduce(function(i,s){return i[s]=c,i},{})}function dS(c,e){e===void 0&&(e={});var i=e,s=i.placement,a=s===void 0?c.placement:s,h=i.boundary,d=h===void 0?d3:h,_=i.rootBoundary,et=_===void 0?wP:_,nt=i.elementContext,it=nt===void 0?uS:nt,lt=i.altBoundary,ut=lt!==void 0&&lt,pt=i.padding,gt=pt===void 0?0:pt,vt=R3(typeof gt!="number"?gt:B3(gt,lS)),Ct=it===uS?p3:uS,wt=c.rects.popper,xt=c.elements[ut?Ct:it],_t=function(An,mn,Tn){var vn=mn==="clippingParents"?function(Gn){var rr=uM(r2(Gn)),dr=["absolute","fixed"].indexOf(hy(Gn).position)>=0&&t0(Gn)?hM(Gn):Gn;return sS(dr)?rr.filter(function(_i){return sS(_i)&&D3(_i,dr)&&V_(_i)!=="body"}):[]}(An):[].concat(mn),xn=[].concat(vn,[Tn]),Un=xn[0],Mn=xn.reduce(function(Gn,rr){var dr=P3(An,rr);return Gn.top=a1(dr.top,Gn.top),Gn.right=i2(dr.right,Gn.right),Gn.bottom=i2(dr.bottom,Gn.bottom),Gn.left=a1(dr.left,Gn.left),Gn},P3(An,Un));return Mn.width=Mn.right-Mn.left,Mn.height=Mn.bottom-Mn.top,Mn.x=Mn.left,Mn.y=Mn.top,Mn}(sS(xt)?xt:xt.contextElement||Ew(c.elements.popper),d,et),Pt=aS(c.elements.reference),Bt=C3({reference:Pt,element:wt,strategy:"absolute",placement:a}),Ot=TP(Object.assign({},wt,Bt)),Lt=it===uS?Ot:Pt,qt={top:_t.top-Lt.top+vt.top,bottom:Lt.bottom-_t.bottom+vt.bottom,left:_t.left-Lt.left+vt.left,right:Lt.right-_t.right+vt.right},en=c.modifiersData.offset;if(it===uS&&en){var cn=en[a];Object.keys(qt).forEach(function(An){var mn=[fv,pv].indexOf(An)>=0?1:-1,Tn=[nm,pv].indexOf(An)>=0?"y":"x";qt[An]+=cn[Tn]*mn})}return qt}var k3={name:"flip",enabled:!0,phase:"main",fn:function(c){var e=c.state,i=c.options,s=c.name;if(!e.modifiersData[s]._skip){for(var a=i.mainAxis,h=a===void 0||a,d=i.altAxis,_=d===void 0||d,et=i.fallbackPlacements,nt=i.padding,it=i.boundary,lt=i.rootBoundary,ut=i.altBoundary,pt=i.flipVariations,gt=pt===void 0||pt,vt=i.allowedAutoPlacements,Ct=e.options.placement,wt=Q_(Ct),xt=et||(wt!==Ct&&gt?function(_i){if(Q_(_i)===s2)return[];var xr=c2(_i);return[I3(_i),xr,I3(xr)]}(Ct):[c2(Ct)]),_t=[Ct].concat(xt).reduce(function(_i,xr){return _i.concat(Q_(xr)===s2?function(Cr,Mr){Mr===void 0&&(Mr={});var Lr=Mr,ls=Lr.placement,mr=Lr.boundary,Us=Lr.rootBoundary,Ws=Lr.padding,Fs=Lr.flipVariations,co=Lr.allowedAutoPlacements,To=co===void 0?bP:co,ar=hS(ls),Rr=ar?Fs?xP:xP.filter(function(Eo){return hS(Eo)===ar}):lS,Br=Rr.filter(function(Eo){return To.indexOf(Eo)>=0});Br.length===0&&(Br=Rr);var js=Br.reduce(function(Eo,nn){return Eo[nn]=dS(Cr,{placement:nn,boundary:mr,rootBoundary:Us,padding:Ws})[Q_(nn)],Eo},{});return Object.keys(js).sort(function(Eo,nn){return js[Eo]-js[nn]})}(e,{placement:xr,boundary:it,rootBoundary:lt,padding:nt,flipVariations:gt,allowedAutoPlacements:vt}):xr)},[]),Pt=e.rects.reference,Bt=e.rects.popper,Ot=new Map,Lt=!0,qt=_t[0],en=0;en<_t.length;en++){var cn=_t[en],An=Q_(cn),mn=hS(cn)===l1,Tn=[nm,pv].indexOf(An)>=0,vn=Tn?"width":"height",xn=dS(e,{placement:cn,boundary:it,rootBoundary:lt,altBoundary:ut,padding:nt}),Un=Tn?mn?fv:im:mn?pv:nm;Pt[vn]>Bt[vn]&&(Un=c2(Un));var Mn=c2(Un),Gn=[];if(h&&Gn.push(xn[An]<=0),_&&Gn.push(xn[Un]<=0,xn[Mn]<=0),Gn.every(function(_i){return _i})){qt=cn,Lt=!1;break}Ot.set(cn,Gn)}if(Lt)for(var rr=function(_i){var xr=_t.find(function(Cr){var Mr=Ot.get(Cr);if(Mr)return Mr.slice(0,_i).every(function(Lr){return Lr})});if(xr)return qt=xr,"break"},dr=gt?3:1;dr>0&&rr(dr)!=="break";dr--);e.placement!==qt&&(e.modifiersData[s]._skip=!0,e.placement=qt,e.reset=!0)}},requiresIfExists:["offset"],data:{_skip:!1}};function dM(c,e,i){return a1(c,i2(e,i))}var O3={name:"preventOverflow",enabled:!0,phase:"main",fn:function(c){var e=c.state,i=c.options,s=c.name,a=i.mainAxis,h=a===void 0||a,d=i.altAxis,_=d!==void 0&&d,et=i.boundary,nt=i.rootBoundary,it=i.altBoundary,lt=i.padding,ut=i.tether,pt=ut===void 0||ut,gt=i.tetherOffset,vt=gt===void 0?0:gt,Ct=dS(e,{boundary:et,rootBoundary:nt,padding:lt,altBoundary:it}),wt=Q_(e.placement),xt=hS(e.placement),_t=!xt,Pt=SP(wt),Bt=Pt==="x"?"y":"x",Ot=e.modifiersData.popperOffsets,Lt=e.rects.reference,qt=e.rects.popper,en=typeof vt=="function"?vt(Object.assign({},e.rects,{placement:e.placement})):vt,cn=typeof en=="number"?{mainAxis:en,altAxis:en}:Object.assign({mainAxis:0,altAxis:0},en),An=e.modifiersData.offset?e.modifiersData.offset[e.placement]:null,mn={x:0,y:0};if(Ot){if(h){var Tn,vn=Pt==="y"?nm:im,xn=Pt==="y"?pv:fv,Un=Pt==="y"?"height":"width",Mn=Ot[Pt],Gn=Mn+Ct[vn],rr=Mn-Ct[xn],dr=pt?-qt[Un]/2:0,_i=xt===l1?Lt[Un]:qt[Un],xr=xt===l1?-qt[Un]:-Lt[Un],Cr=e.elements.arrow,Mr=pt&&Cr?yP(Cr):{width:0,height:0},Lr=e.modifiersData["arrow#persistent"]?e.modifiersData["arrow#persistent"].padding:{top:0,right:0,bottom:0,left:0},ls=Lr[vn],mr=Lr[xn],Us=dM(0,Lt[Un],Mr[Un]),Ws=_t?Lt[Un]/2-dr-Us-ls-cn.mainAxis:_i-Us-ls-cn.mainAxis,Fs=_t?-Lt[Un]/2+dr+Us+mr+cn.mainAxis:xr+Us+mr+cn.mainAxis,co=e.elements.arrow&&hM(e.elements.arrow),To=co?Pt==="y"?co.clientTop||0:co.clientLeft||0:0,ar=(Tn=An==null?void 0:An[Pt])!=null?Tn:0,Rr=Mn+Fs-ar,Br=dM(pt?i2(Gn,Mn+Ws-ar-To):Gn,Mn,pt?a1(rr,Rr):rr);Ot[Pt]=Br,mn[Pt]=Br-Mn}if(_){var js,Eo=Pt==="x"?nm:im,nn=Pt==="x"?pv:fv,Nn=Ot[Bt],on=Bt==="y"?"height":"width",Qn=Nn+Ct[Eo],Jn=Nn-Ct[nn],Vn=[nm,im].indexOf(wt)!==-1,sr=(js=An==null?void 0:An[Bt])!=null?js:0,jr=Vn?Qn:Nn-Lt[on]-qt[on]-sr+cn.altAxis,Zr=Vn?Nn+Lt[on]+qt[on]-sr-cn.altAxis:Jn,os=pt&&Vn?function(is,cs,ns){var $r=dM(is,cs,ns);return $r>ns?ns:$r}(jr,Nn,Zr):dM(pt?jr:Qn,Nn,pt?Zr:Jn);Ot[Bt]=os,mn[Bt]=os-Nn}e.modifiersData[s]=mn}},requiresIfExists:["offset"]},L3={name:"arrow",enabled:!0,phase:"main",fn:function(c){var e,i=c.state,s=c.name,a=c.options,h=i.elements.arrow,d=i.modifiersData.popperOffsets,_=Q_(i.placement),et=SP(_),nt=[im,fv].indexOf(_)>=0?"height":"width";if(h&&d){var it=function(qt,en){return R3(typeof(qt=typeof qt=="function"?qt(Object.assign({},en.rects,{placement:en.placement})):qt)!="number"?qt:B3(qt,lS))}(a.padding,i),lt=yP(h),ut=et==="y"?nm:im,pt=et==="y"?pv:fv,gt=i.rects.reference[nt]+i.rects.reference[et]-d[et]-i.rects.popper[nt],vt=d[et]-i.rects.reference[et],Ct=hM(h),wt=Ct?et==="y"?Ct.clientHeight||0:Ct.clientWidth||0:0,xt=gt/2-vt/2,_t=it[ut],Pt=wt-lt[nt]-it[pt],Bt=wt/2-lt[nt]/2+xt,Ot=dM(_t,Bt,Pt),Lt=et;i.modifiersData[s]=((e={})[Lt]=Ot,e.centerOffset=Ot-Bt,e)}},effect:function(c){var e=c.state,i=c.options.element,s=i===void 0?"[data-popper-arrow]":i;s!=null&&(typeof s!="string"||(s=e.elements.popper.querySelector(s)))&&D3(e.elements.popper,s)&&(e.elements.arrow=s)},requires:["popperOffsets"],requiresIfExists:["preventOverflow"]};function N3(c,e,i){return i===void 0&&(i={x:0,y:0}),{top:c.top-e.height-i.y,right:c.right-e.width+i.x,bottom:c.bottom-e.height+i.y,left:c.left-e.width-i.x}}function U3(c){return[nm,fv,pv,im].some(function(e){return c[e]>=0})}var F3={name:"hide",enabled:!0,phase:"main",requiresIfExists:["preventOverflow"],fn:function(c){var e=c.state,i=c.name,s=e.rects.reference,a=e.rects.popper,h=e.modifiersData.preventOverflow,d=dS(e,{elementContext:"reference"}),_=dS(e,{altBoundary:!0}),et=N3(d,s),nt=N3(_,a,h),it=U3(et),lt=U3(nt);e.modifiersData[i]={referenceClippingOffsets:et,popperEscapeOffsets:nt,isReferenceHidden:it,hasPopperEscaped:lt},e.attributes.popper=Object.assign({},e.attributes.popper,{"data-popper-reference-hidden":it,"data-popper-escaped":lt})}},j3=o2({defaultModifiers:[EP,CP,MP,l2,T3,k3,O3,L3,F3]}),z3="tippy-content",V3="tippy-arrow",Q3="tippy-svg-arrow",c1={passive:!0,capture:!0},G3=function(){return document.body};function IP(c,e,i){if(Array.isArray(c)){var s=c[e];return s??(Array.isArray(i)?i[e]:i)}return c}function DP(c,e){var i={}.toString.call(c);return i.indexOf("[object")===0&&i.indexOf(e+"]")>-1}function H3(c,e){return typeof c=="function"?c.apply(void 0,e):c}function W3(c,e){return e===0?c:function(s){clearTimeout(i),i=setTimeout(function(){c(s)},e)};var i}function pS(c){return[].concat(c)}function q3(c,e){c.indexOf(e)===-1&&c.push(e)}function u2(c){return[].slice.call(c)}function Y3(c){return Object.keys(c).reduce(function(e,i){return c[i]!==void 0&&(e[i]=c[i]),e},{})}function pM(){return document.createElement("div")}function h2(c){return["Element","Fragment"].some(function(e){return DP(c,e)})}function PP(c,e){c.forEach(function(i){i&&(i.style.transitionDuration=e+"ms")})}function X3(c,e){c.forEach(function(i){i&&i.setAttribute("data-state",e)})}function RP(c,e,i){var s=e+"EventListener";["transitionend","webkitTransitionEnd"].forEach(function(a){c[s](a,i)})}function K3(c,e){for(var i=e;i;){var s;if(c.contains(i))return!0;i=i.getRootNode==null||(s=i.getRootNode())==null?void 0:s.host}return!1}var G_={isTouch:!1},J3=0;function NN(){G_.isTouch||(G_.isTouch=!0,window.performance&&document.addEventListener("mousemove",Z3))}function Z3(){var c=performance.now();c-J3<20&&(G_.isTouch=!1,document.removeEventListener("mousemove",Z3)),J3=c}function UN(){var c,e=document.activeElement;if((c=e)&&c._tippy&&c._tippy.reference===c){var i=e._tippy;e.blur&&!i.state.isVisible&&e.blur()}}var FN=!(typeof window>"u"||typeof document>"u"||!window.msCrypto),H0=Object.assign({appendTo:G3,aria:{content:"auto",expanded:"auto"},delay:0,duration:[300,250],getReferenceClientRect:null,hideOnClick:!0,ignoreAttributes:!1,interactive:!1,interactiveBorder:2,interactiveDebounce:0,moveTransition:"",offset:[0,10],onAfterUpdate:function(){},onBeforeUpdate:function(){},onCreate:function(){},onDestroy:function(){},onHidden:function(){},onHide:function(){},onMount:function(){},onShow:function(){},onShown:function(){},onTrigger:function(){},onUntrigger:function(){},onClickOutside:function(){},placement:"top",plugins:[],popperOptions:{},render:null,showOnCreate:!1,touch:!0,trigger:"mouseenter focus",triggerTarget:null},{animateFill:!1,followCursor:!1,inlinePositioning:!1,sticky:!1},{allowHTML:!1,animation:"fade",arrow:!0,content:"",inertia:!1,maxWidth:350,role:"tooltip",theme:"",zIndex:9999}),jN=Object.keys(H0);function $3(c){var e=(c.plugins||[]).reduce(function(i,s){var a,h=s.name,d=s.defaultValue;return h&&(i[h]=c[h]!==void 0?c[h]:(a=H0[h])!=null?a:d),i},{});return Object.assign({},c,e)}function eO(c,e){var i=Object.assign({},e,{content:H3(e.content,[c])},e.ignoreAttributes?{}:function(s,a){return(a?Object.keys($3(Object.assign({},H0,{plugins:a}))):jN).reduce(function(h,d){var _=(s.getAttribute("data-tippy-"+d)||"").trim();if(!_)return h;if(d==="content")h[d]=_;else try{h[d]=JSON.parse(_)}catch{h[d]=_}return h},{})}(c,e.plugins));return i.aria=Object.assign({},H0.aria,i.aria),i.aria={expanded:i.aria.expanded==="auto"?e.interactive:i.aria.expanded,content:i.aria.content==="auto"?e.interactive?null:"describedby":i.aria.content},i}function BP(c,e){c.innerHTML=e}function tO(c){var e=pM();return c===!0?e.className=V3:(e.className=Q3,h2(c)?e.appendChild(c):BP(e,c)),e}function nO(c,e){h2(e.content)?(BP(c,""),c.appendChild(e.content)):typeof e.content!="function"&&(e.allowHTML?BP(c,e.content):c.textContent=e.content)}function kP(c){var e=c.firstElementChild,i=u2(e.children);return{box:e,content:i.find(function(s){return s.classList.contains(z3)}),arrow:i.find(function(s){return s.classList.contains(V3)||s.classList.contains(Q3)}),backdrop:i.find(function(s){return s.classList.contains("tippy-backdrop")})}}function iO(c){var e=pM(),i=pM();i.className="tippy-box",i.setAttribute("data-state","hidden"),i.setAttribute("tabindex","-1");var s=pM();function a(h,d){var _=kP(e),et=_.box,nt=_.content,it=_.arrow;d.theme?et.setAttribute("data-theme",d.theme):et.removeAttribute("data-theme"),typeof d.animation=="string"?et.setAttribute("data-animation",d.animation):et.removeAttribute("data-animation"),d.inertia?et.setAttribute("data-inertia",""):et.removeAttribute("data-inertia"),et.style.maxWidth=typeof d.maxWidth=="number"?d.maxWidth+"px":d.maxWidth,d.role?et.setAttribute("role",d.role):et.removeAttribute("role"),h.content===d.content&&h.allowHTML===d.allowHTML||nO(nt,c.props),d.arrow?it?h.arrow!==d.arrow&&(et.removeChild(it),et.appendChild(tO(d.arrow))):et.appendChild(tO(d.arrow)):it&&et.removeChild(it)}return s.className=z3,s.setAttribute("data-state","hidden"),nO(s,c.props),e.appendChild(i),i.appendChild(s),a(c.props,c.props),{popper:e,onUpdate:a}}iO.$$tippy=!0;var zN=1,d2=[],OP=[];function VN(c,e){var i,s,a,h,d,_,et,nt,it=eO(c,Object.assign({},H0,$3(Y3(e)))),lt=!1,ut=!1,pt=!1,gt=!1,vt=[],Ct=W3(co,it.interactiveDebounce),wt=zN++,xt=(nt=it.plugins).filter(function(on,Qn){return nt.indexOf(on)===Qn}),_t={id:wt,reference:c,popper:pM(),popperInstance:null,props:it,state:{isEnabled:!0,isVisible:!1,isDestroyed:!1,isMounted:!1,isShown:!1},plugins:xt,clearDelayTimeouts:function(){clearTimeout(i),clearTimeout(s),cancelAnimationFrame(a)},setProps:function(on){if(!_t.state.isDestroyed){Mn("onBeforeUpdate",[_t,on]),Ws();var Qn=_t.props,Jn=eO(c,Object.assign({},Qn,Y3(on),{ignoreAttributes:!0}));_t.props=Jn,Us(),Qn.interactiveDebounce!==Jn.interactiveDebounce&&(dr(),Ct=W3(co,Jn.interactiveDebounce)),Qn.triggerTarget&&!Jn.triggerTarget?pS(Qn.triggerTarget).forEach(function(Vn){Vn.removeAttribute("aria-expanded")}):Jn.triggerTarget&&c.removeAttribute("aria-expanded"),rr(),Un(),Ot&&Ot(Qn,Jn),_t.popperInstance&&(Br(),Eo().forEach(function(Vn){requestAnimationFrame(Vn._tippy.popperInstance.forceUpdate)})),Mn("onAfterUpdate",[_t,on])}},setContent:function(on){_t.setProps({content:on})},show:function(){var on=_t.state.isVisible,Qn=_t.state.isDestroyed,Jn=!_t.state.isEnabled,Vn=G_.isTouch&&!_t.props.touch,sr=IP(_t.props.duration,0,H0.duration);if(!(on||Qn||Jn||Vn||mn().hasAttribute("disabled")||(Mn("onShow",[_t],!1),_t.props.onShow(_t)===!1))){if(_t.state.isVisible=!0,An()&&(Bt.style.visibility="visible"),Un(),Mr(),_t.state.isMounted||(Bt.style.transition="none"),An()){var jr=vn();PP([jr.box,jr.content],0)}var Zr,os,is;_=function(){var cs;if(_t.state.isVisible&&!gt){if(gt=!0,Bt.offsetHeight,Bt.style.transition=_t.props.moveTransition,An()&&_t.props.animation){var ns=vn(),$r=ns.box,ms=ns.content;PP([$r,ms],sr),X3([$r,ms],"visible")}Gn(),rr(),q3(OP,_t),(cs=_t.popperInstance)==null||cs.forceUpdate(),Mn("onMount",[_t]),_t.props.animation&&An()&&function(Wr,vs){ls(Wr,function(){_t.state.isShown=!0,Mn("onShown",[_t])})}(sr)}},os=_t.props.appendTo,is=mn(),(Zr=_t.props.interactive&&os===G3||os==="parent"?is.parentNode:H3(os,[is])).contains(Bt)||Zr.appendChild(Bt),_t.state.isMounted=!0,Br()}},hide:function(){var on=!_t.state.isVisible,Qn=_t.state.isDestroyed,Jn=!_t.state.isEnabled,Vn=IP(_t.props.duration,1,H0.duration);if(!(on||Qn||Jn)&&(Mn("onHide",[_t],!1),_t.props.onHide(_t)!==!1)){if(_t.state.isVisible=!1,_t.state.isShown=!1,gt=!1,lt=!1,An()&&(Bt.style.visibility="hidden"),dr(),Lr(),Un(!0),An()){var sr=vn(),jr=sr.box,Zr=sr.content;_t.props.animation&&(PP([jr,Zr],Vn),X3([jr,Zr],"hidden"))}Gn(),rr(),_t.props.animation?An()&&function(os,is){ls(os,function(){!_t.state.isVisible&&Bt.parentNode&&Bt.parentNode.contains(Bt)&&is()})}(Vn,_t.unmount):_t.unmount()}},hideWithInteractivity:function(on){Tn().addEventListener("mousemove",Ct),q3(d2,Ct),Ct(on)},enable:function(){_t.state.isEnabled=!0},disable:function(){_t.hide(),_t.state.isEnabled=!1},unmount:function(){_t.state.isVisible&&_t.hide(),_t.state.isMounted&&(js(),Eo().forEach(function(on){on._tippy.unmount()}),Bt.parentNode&&Bt.parentNode.removeChild(Bt),OP=OP.filter(function(on){return on!==_t}),_t.state.isMounted=!1,Mn("onHidden",[_t]))},destroy:function(){_t.state.isDestroyed||(_t.clearDelayTimeouts(),_t.unmount(),Ws(),delete c._tippy,_t.state.isDestroyed=!0,Mn("onDestroy",[_t]))}};if(!it.render)return _t;var Pt=it.render(_t),Bt=Pt.popper,Ot=Pt.onUpdate;Bt.setAttribute("data-tippy-root",""),Bt.id="tippy-"+_t.id,_t.popper=Bt,c._tippy=_t,Bt._tippy=_t;var Lt=xt.map(function(on){return on.fn(_t)}),qt=c.hasAttribute("aria-expanded");return Us(),rr(),Un(),Mn("onCreate",[_t]),it.showOnCreate&&nn(),Bt.addEventListener("mouseenter",function(){_t.props.interactive&&_t.state.isVisible&&_t.clearDelayTimeouts()}),Bt.addEventListener("mouseleave",function(){_t.props.interactive&&_t.props.trigger.indexOf("mouseenter")>=0&&Tn().addEventListener("mousemove",Ct)}),_t;function en(){var on=_t.props.touch;return Array.isArray(on)?on:[on,0]}function cn(){return en()[0]==="hold"}function An(){var on;return!((on=_t.props.render)==null||!on.$$tippy)}function mn(){return et||c}function Tn(){var on,Qn,Jn=mn().parentNode;return Jn&&(Qn=pS(Jn)[0])!=null&&(on=Qn.ownerDocument)!=null&&on.body?Qn.ownerDocument:document}function vn(){return kP(Bt)}function xn(on){return _t.state.isMounted&&!_t.state.isVisible||G_.isTouch||h&&h.type==="focus"?0:IP(_t.props.delay,on?0:1,H0.delay)}function Un(on){on===void 0&&(on=!1),Bt.style.pointerEvents=_t.props.interactive&&!on?"":"none",Bt.style.zIndex=""+_t.props.zIndex}function Mn(on,Qn,Jn){var Vn;Jn===void 0&&(Jn=!0),Lt.forEach(function(sr){sr[on]&&sr[on].apply(sr,Qn)}),Jn&&(Vn=_t.props)[on].apply(Vn,Qn)}function Gn(){var on=_t.props.aria;if(on.content){var Qn="aria-"+on.content,Jn=Bt.id;pS(_t.props.triggerTarget||c).forEach(function(Vn){var sr=Vn.getAttribute(Qn);if(_t.state.isVisible)Vn.setAttribute(Qn,sr?sr+" "+Jn:Jn);else{var jr=sr&&sr.replace(Jn,"").trim();jr?Vn.setAttribute(Qn,jr):Vn.removeAttribute(Qn)}})}}function rr(){!qt&&_t.props.aria.expanded&&pS(_t.props.triggerTarget||c).forEach(function(on){_t.props.interactive?on.setAttribute("aria-expanded",_t.state.isVisible&&on===mn()?"true":"false"):on.removeAttribute("aria-expanded")})}function dr(){Tn().removeEventListener("mousemove",Ct),d2=d2.filter(function(on){return on!==Ct})}function _i(on){if(!G_.isTouch||!pt&&on.type!=="mousedown"){var Qn=on.composedPath&&on.composedPath()[0]||on.target;if(!_t.props.interactive||!K3(Bt,Qn)){if(pS(_t.props.triggerTarget||c).some(function(Jn){return K3(Jn,Qn)})){if(G_.isTouch||_t.state.isVisible&&_t.props.trigger.indexOf("click")>=0)return}else Mn("onClickOutside",[_t,on]);_t.props.hideOnClick===!0&&(_t.clearDelayTimeouts(),_t.hide(),ut=!0,setTimeout(function(){ut=!1}),_t.state.isMounted||Lr())}}}function xr(){pt=!0}function Cr(){pt=!1}function Mr(){var on=Tn();on.addEventListener("mousedown",_i,!0),on.addEventListener("touchend",_i,c1),on.addEventListener("touchstart",Cr,c1),on.addEventListener("touchmove",xr,c1)}function Lr(){var on=Tn();on.removeEventListener("mousedown",_i,!0),on.removeEventListener("touchend",_i,c1),on.removeEventListener("touchstart",Cr,c1),on.removeEventListener("touchmove",xr,c1)}function ls(on,Qn){var Jn=vn().box;function Vn(sr){sr.target===Jn&&(RP(Jn,"remove",Vn),Qn())}if(on===0)return Qn();RP(Jn,"remove",d),RP(Jn,"add",Vn),d=Vn}function mr(on,Qn,Jn){Jn===void 0&&(Jn=!1),pS(_t.props.triggerTarget||c).forEach(function(Vn){Vn.addEventListener(on,Qn,Jn),vt.push({node:Vn,eventType:on,handler:Qn,options:Jn})})}function Us(){var on;cn()&&(mr("touchstart",Fs,{passive:!0}),mr("touchend",To,{passive:!0})),(on=_t.props.trigger,on.split(/\s+/).filter(Boolean)).forEach(function(Qn){if(Qn!=="manual")switch(mr(Qn,Fs),Qn){case"mouseenter":mr("mouseleave",To);break;case"focus":mr(FN?"focusout":"blur",ar);break;case"focusin":mr("focusout",ar)}})}function Ws(){vt.forEach(function(on){var Qn=on.node,Jn=on.eventType,Vn=on.handler,sr=on.options;Qn.removeEventListener(Jn,Vn,sr)}),vt=[]}function Fs(on){var Qn,Jn=!1;if(_t.state.isEnabled&&!Rr(on)&&!ut){var Vn=((Qn=h)==null?void 0:Qn.type)==="focus";h=on,et=on.currentTarget,rr(),!_t.state.isVisible&&DP(on,"MouseEvent")&&d2.forEach(function(sr){return sr(on)}),on.type==="click"&&(_t.props.trigger.indexOf("mouseenter")<0||lt)&&_t.props.hideOnClick!==!1&&_t.state.isVisible?Jn=!0:nn(on),on.type==="click"&&(lt=!Jn),Jn&&!Vn&&Nn(on)}}function co(on){var Qn=on.target,Jn=mn().contains(Qn)||Bt.contains(Qn);if(on.type!=="mousemove"||!Jn){var Vn=Eo().concat(Bt).map(function(sr){var jr,Zr=(jr=sr._tippy.popperInstance)==null?void 0:jr.state;return Zr?{popperRect:sr.getBoundingClientRect(),popperState:Zr,props:it}:null}).filter(Boolean);(function(sr,jr){var Zr=jr.clientX,os=jr.clientY;return sr.every(function(is){var cs=is.popperRect,ns=is.popperState,$r=is.props.interactiveBorder,ms=ns.placement.split("-")[0],Wr=ns.modifiersData.offset;if(!Wr)return!0;var vs=ms==="bottom"?Wr.top.y:0,bs=ms==="top"?Wr.bottom.y:0,ks=ms==="right"?Wr.left.x:0,yl=ms==="left"?Wr.right.x:0,Vo=cs.top-os+vs>$r,_s=os-cs.bottom-bs>$r,zs=cs.left-Zr+ks>$r,oo=Zr-cs.right-yl>$r;return Vo||_s||zs||oo})})(Vn,on)&&(dr(),Nn(on))}}function To(on){Rr(on)||_t.props.trigger.indexOf("click")>=0&&lt||(_t.props.interactive?_t.hideWithInteractivity(on):Nn(on))}function ar(on){_t.props.trigger.indexOf("focusin")<0&&on.target!==mn()||_t.props.interactive&&on.relatedTarget&&Bt.contains(on.relatedTarget)||Nn(on)}function Rr(on){return!!G_.isTouch&&cn()!==on.type.indexOf("touch")>=0}function Br(){js();var on=_t.props,Qn=on.popperOptions,Jn=on.placement,Vn=on.offset,sr=on.getReferenceClientRect,jr=on.moveTransition,Zr=An()?kP(Bt).arrow:null,os=sr?{getBoundingClientRect:sr,contextElement:sr.contextElement||mn()}:c,is=[{name:"offset",options:{offset:Vn}},{name:"preventOverflow",options:{padding:{top:2,bottom:2,left:5,right:5}}},{name:"flip",options:{padding:5}},{name:"computeStyles",options:{adaptive:!jr}},{name:"$$tippy",enabled:!0,phase:"beforeWrite",requires:["computeStyles"],fn:function(cs){var ns=cs.state;if(An()){var $r=vn().box;["placement","reference-hidden","escaped"].forEach(function(ms){ms==="placement"?$r.setAttribute("data-placement",ns.placement):ns.attributes.popper["data-popper-"+ms]?$r.setAttribute("data-"+ms,""):$r.removeAttribute("data-"+ms)}),ns.attributes.popper={}}}}];An()&&Zr&&is.push({name:"arrow",options:{element:Zr,padding:3}}),is.push.apply(is,(Qn==null?void 0:Qn.modifiers)||[]),_t.popperInstance=j3(os,Bt,Object.assign({},Qn,{placement:Jn,onFirstUpdate:_,modifiers:is}))}function js(){_t.popperInstance&&(_t.popperInstance.destroy(),_t.popperInstance=null)}function Eo(){return u2(Bt.querySelectorAll("[data-tippy-root]"))}function nn(on){_t.clearDelayTimeouts(),on&&Mn("onTrigger",[_t,on]),Mr();var Qn=xn(!0),Jn=en(),Vn=Jn[0],sr=Jn[1];G_.isTouch&&Vn==="hold"&&sr&&(Qn=sr),Qn?i=setTimeout(function(){_t.show()},Qn):_t.show()}function Nn(on){if(_t.clearDelayTimeouts(),Mn("onUntrigger",[_t,on]),_t.state.isVisible){if(!(_t.props.trigger.indexOf("mouseenter")>=0&&_t.props.trigger.indexOf("click")>=0&&["mouseleave","mousemove"].indexOf(on.type)>=0&&lt)){var Qn=xn(!1);Qn?s=setTimeout(function(){_t.state.isVisible&&_t.hide()},Qn):a=requestAnimationFrame(function(){_t.hide()})}}else Lr()}}function fM(c,e){e===void 0&&(e={});var i=H0.plugins.concat(e.plugins||[]);document.addEventListener("touchstart",NN,c1),window.addEventListener("blur",UN);var s,a=Object.assign({},e,{plugins:i}),h=(s=c,h2(s)?[s]:function(d){return DP(d,"NodeList")}(s)?u2(s):Array.isArray(s)?s:u2(document.querySelectorAll(s))).reduce(function(d,_){var et=_&&VN(_,a);return et&&d.push(et),d},[]);return h2(c)?h[0]:h}fM.defaultProps=H0,fM.setDefaultProps=function(c){Object.keys(c).forEach(function(e){H0[e]=c[e]})},fM.currentInput=G_,Object.assign({},l2,{effect:function(c){var e=c.state,i={popper:{position:e.options.strategy,left:"0",top:"0",margin:"0"},arrow:{position:"absolute"},reference:{}};Object.assign(e.elements.popper.style,i.popper),e.styles=i,e.elements.arrow&&Object.assign(e.elements.arrow.style,i.arrow)}}),fM.setDefaultProps({render:iO});var LP=fM;class u1 extends n2{async _refreshUi(){var e;if(!await super._refreshUi())return!1;Q0.RemoveAll(u1.PluginType);for(const i of this.variations)Q0.Create(u1.PluginType,i.title,5,20,0,i.materials.map(s=>{let a;if(i.preview.startsWith("generate:"))a=this._previewGenerator.generate(s,i.preview.split(":")[1]);else{const h=s[i.preview]||"#ff00ff";a=h.image?qu(h.image,100):void 0,a||(a=l3(h,!0))}return{id:s.uuid,image:a,onClick:h=>this.applyVariation(i,h),tooltip:s.name||s.uuid}}),(s,a)=>LP(s,{placement:"bottom",content:a.tooltip}));return Q0.RebuildUi((e=this._viewer)===null||e===void 0?void 0:e.container),!0}}u1.PluginType="MaterialConfiguratorPlugin";class p2 extends Ls{constructor(){super(...arguments),this.enabled=!0,this._uiNeedRefresh=!1,this._refreshUiConfig=()=>{var e,i;this.enabled&&((i=(e=this.uiConfig)===null||e===void 0?void 0:e.uiRefresh)===null||i===void 0||i.call(e,"postFrame",!0))},this.dependencies=[qr],this._selectedObject=()=>{var e;return((e=this._picking)===null||e===void 0?void 0:e.getSelectedObject())||void 0},this._selectedMaterial=()=>{var e;return((e=this._selectedObject())===null||e===void 0?void 0:e.material)||void 0}}async onAdded(e){var i,s;await super.onAdded(e),this.refreshUi=this.refreshUi.bind(this),this._refreshUi=this._refreshUi.bind(this),this._picking=(i=this._viewer)===null||i===void 0?void 0:i.getPluginByType("Picking"),this._previewGenerator=new fP(this._viewer),(s=this._picking)===null||s===void 0||s.addEventListener("selectedObjectChanged",this._refreshUiConfig),e.addEventListener("preFrame",this._refreshUi),this.addEventListener("deserialize",this.refreshUi)}async onRemove(e){var i,s;return(i=this._previewGenerator)===null||i===void 0||i.dispose(),this._previewGenerator=void 0,(s=this._picking)===null||s===void 0||s.removeEventListener("selectedObjectChanged",this._refreshUiConfig),this.removeEventListener("deserialize",this.refreshUi),e.removeEventListener("preFrame",this._refreshUi),this._picking=void 0,super.onRemove(e)}refreshUi(){this.enabled&&(this._uiNeedRefresh=!0)}async _refreshUi(){return this._uiNeedRefresh&&this.enabled&&this._refreshUiConfig(),this._uiNeedRefresh=!1,!1}}p2.PluginType="MaterialLibraryBasePlugin",function(c,e,i,s){var a,h=arguments.length,d=h<3?e:s===null?s=Object.getOwnPropertyDescriptor(e,i):s;if(typeof Reflect=="object"&&typeof Reflect.decorate=="function")d=Reflect.decorate(c,e,i,s);else for(var _=c.length-1;_>=0;_--)(a=c[_])&&(d=(h<3?a(d):h>3?a(e,i,d):a(e,i))||d);h>3&&d&&Object.defineProperty(e,i,d)}([ts("Enabled")],p2.prototype,"enabled",void 0);class Sw extends p2{constructor(){super(...arguments),this.replaceMaterial=!1,this.uiConfig={type:"folder",label:"Material Library",uuid:gu(),children:[...bv(this),()=>{var e;return{type:"dropdown",label:"Apply Material",limitedUi:!0,hidden:()=>!this._selectedObject(),children:[{label:"select one",value:""},[...this._viewer.getPlugin(qr).materials.getMaterialsOfType((e=this._selectedMaterial())===null||e===void 0?void 0:e.typeSlug).map(i=>({label:i.name||i.uuid,value:i.uuid}))||[]]],getValue:()=>{var i;return(i=this._selectedMaterial())===null||i===void 0?void 0:i.uuid},setValue:i=>{var s,a,h,d,_;const et=(h=(a=(s=this._viewer)===null||s===void 0?void 0:s.getPlugin(qr))===null||a===void 0?void 0:a.materials)===null||h===void 0?void 0:h.findMaterial(i);if(et)if(this.replaceMaterial)(_=(d=this._selectedObject())===null||d===void 0?void 0:d.setMaterial)===null||_===void 0||_.call(d,et);else{const nt=this._selectedMaterial();if(nt){const it=nt.name,lt=nt.uuid;nt.copyProps(et),nt.name=it,nt.uuid=lt,nt.userData.uuid&&(nt.userData.uuid=lt)}}this._refreshUi()}}}]}}async _refreshUi(){var e,i,s,a;if(!await super._refreshUi())return!1;const h=[Tu.TypeSlug,Fo.TypeSlug],d=(i=(e=this._viewer)===null||e===void 0?void 0:e.getPlugin(qr))===null||i===void 0?void 0:i.materials,_=h.map(et=>[et,d==null?void 0:d.getMaterialsOfType(et)]);Q0.RemoveAll(Sw.PluginType);for(const[et,nt]of _)Q0.Create(Sw.PluginType,et,5,20,0,(s=nt)===null||s===void 0?void 0:s.filter(it=>!it.userData.__runtimeMaterial).map(it=>{let lt;const ut="generate:sphere";if(ut.startsWith("generate:"))lt=this._previewGenerator.generate(it,ut.split(":")[1]);else{const pt=it[ut]||"#ff00ff";lt=pt.image?qu(pt.image,100):void 0,lt||(lt=a3(pt,!0))}return{id:it.uuid,image:lt,onClick:pt=>{const gt=d==null?void 0:d.findMaterial(pt);if(console.log(gt==null?void 0:gt.name),gt){const vt=gt.userData.__appliedMeshes;if(vt!=null&&vt.size){const Ct=vt.keys().next().value;Ct.dispatchEvent({type:"select",value:Ct})}}},tooltip:it.name||it.uuid}}),(it,lt)=>LP(it,{placement:"bottom",content:lt.tooltip}));return Q0.RebuildUi((a=this._viewer)===null||a===void 0?void 0:a.container),!0}}function rO(c,e,i,s){c.traverse(a=>{a&&(a.userData.cloneRotI=e,a.userData.rotationCount=i,a.userData.rotationAxis=s,a.addEventListener("beforeRender",h=>function(d,_){var et;_&&(!((et=_.map)===null||et===void 0)&&et.isTexture)&&(_.extraUniformsToUpload||(_.extraUniformsToUpload={}),_.extraUniformsToUpload.uvTransform||(_.extraUniformsToUpload.uvTransform={value:new b.Vkp}),_.extraUniformsToUpload.uvTransform.value.setUvTransform(_.map.offset.x*_.map.repeat.x*d.userData.cloneRotI/(d.userData.rotationCount||1),_.map.offset.y*_.map.repeat.y*d.userData.cloneRotI/(d.userData.rotationCount||1),_.map.repeat.x,_.map.repeat.y,_.map.rotation,_.map.center.x,_.map.center.y))}(a,h.material)))})}function sO(c,e,i,s="x"){var a;if(c.userData.rotationCount>1&&!c.userData.rotationRoot)return c;const h=c.parent;if(!h)throw new Error("No parent");if(c.userData.cloneParent){const _=c.userData.cloneParent;if(!(c=h.children.find(et=>_===et.uuid)))return console.error("Couldn't find clone root, cannot rotate. maybe a serialization issue?",_,h),c}let d=h.children.filter(_=>{var et;return((et=_.userData)===null||et===void 0?void 0:et.cloneParent)===c.uuid}).sort((_,et)=>_.userData.cloneRotI-et.userData.cloneRotI);if(c.userData.rotationCount===e&&e===d.length&&i===void 0&&c.userData.rotationAxis===s)return c;if(i==null&&(i=(a=c.userData.rotationSkips)!==null&&a!==void 0?a:[]),i!==c.userData.rotationSkips&&(c.userData.rotationSkips=[...i]),rO(c,0,e,s),c.userData.rotationRoot=!0,c.visible=!0,e<=d.length){for(let _=e-1;_<d.length;_++)h.remove(d[_]),d[_].traverse(et=>et.userData={__disposed:!0});d=d.slice(0,e)}for(let _=1;_<e;_++){const et=_<=d.length?d[_-1]:c.clone();et.rotation.copy(c.rotation),et.rotation[s]+=_/e*Math.PI*2,rO(et,_,e,s),_>d.length&&h.add(et),et.visible=!i.includes(_)}return c.visible=!i.includes(0),c}Sw.PluginType="MaterialLibraryPlugin",function(c,e,i,s){var a,h=arguments.length,d=h<3?e:s===null?s=Object.getOwnPropertyDescriptor(e,i):s;if(typeof Reflect=="object"&&typeof Reflect.decorate=="function")d=Reflect.decorate(c,e,i,s);else for(var _=c.length-1;_>=0;_--)(a=c[_])&&(d=(h<3?a(d):h>3?a(e,i,d):a(e,i))||d);h>3&&d&&Object.defineProperty(e,i,d)}([ts("Replace Material")],Sw.prototype,"replaceMaterial",void 0);var fS,mM=function(c,e,i,s){var a,h=arguments.length,d=h<3?e:s===null?s=Object.getOwnPropertyDescriptor(e,i):s;if(typeof Reflect=="object"&&typeof Reflect.decorate=="function")d=Reflect.decorate(c,e,i,s);else for(var _=c.length-1;_>=0;_--)(a=c[_])&&(d=(h<3?a(d):h>3?a(e,i,d):a(e,i))||d);return h>3&&d&&Object.defineProperty(e,i,d),d};let H_=fS=class extends Ls{constructor(){super(),this.enabled=!0,this.rotations=1,this.axis="x",this.skips="",this._selectedObjectChanged=this._selectedObjectChanged.bind(this)}async onAdded(c){var e;await super.onAdded(c),(e=c.getPluginByType("Picking"))===null||e===void 0||e.addEventListener("selectedObjectChanged",this._selectedObjectChanged)}_selectedObjectChanged(){var c,e,i,s,a,h,d,_,et;if(!this.enabled)return;const nt=(e=(c=this._viewer)===null||c===void 0?void 0:c.getPluginByType("Picking"))===null||e===void 0?void 0:e.getSelectedObject();if(!nt)return void((s=(i=this.uiConfig).uiRefresh)===null||s===void 0||s.call(i,"postFrame",!0));const it=nt.userData.rotationRoot&&(a=nt.userData.rotationCount)!==null&&a!==void 0?a:1;this.rotations=it,this.skips=(d=(h=nt.userData.rotationSkips)===null||h===void 0?void 0:h.join(","))!==null&&d!==void 0?d:"",this.axis=nt.userData.rotationAxis||"x",(et=(_=this.uiConfig).uiRefresh)===null||et===void 0||et.call(_,"postFrame",!0)}_paramsChanged(){var c,e,i,s,a,h;if(!this.enabled)return;const d=(e=(c=this._viewer)===null||c===void 0?void 0:c.getPluginByType("Picking"))===null||e===void 0?void 0:e.getSelectedObject();if(d){if(this.rotations>1||d.userData.rotationCount){const _=d.userData.rotationCount,et=sO(d,this.rotations,this.skips.split(",").map(it=>parseInt(it)).filter(it=>isFinite(it)),this.axis),nt=et==null?void 0:et.userData.rotationCount;if(nt&&nt!==_){const it=[];et==null||et.traverseAncestors(lt=>{it.push(lt)});for(const lt of it)if(lt.userData.autoScaled){Gs(lt),(i=this._viewer)===null||i===void 0||i.resetCamera({rootObject:lt,centerOffset:new b.Pa4(4,4,4)});break}}d.parent&&!d.userData.__disposed||(a=(s=this._viewer)===null||s===void 0?void 0:s.getPluginByType("Picking"))===null||a===void 0||a.setSelectedObject(et,!0)}(h=this._viewer)===null||h===void 0||h.scene.setDirty({frameFade:!1,sceneUpdate:!0})}}};H_.PluginType="ObjectRotationPlugin",mM([Fn(),ts("Enabled"),pn(fS.prototype._paramsChanged)],H_.prototype,"enabled",void 0),mM([ss("Rotation Count",[1,100],1,c=>({hidden:()=>{var e,i;return!(!((i=(e=c._viewer)===null||e===void 0?void 0:e.getPluginByType("Picking"))===null||i===void 0)&&i.getSelectedObject())||!c.rotations}})),pn(fS.prototype._paramsChanged)],H_.prototype,"rotations",void 0),mM([xv("Axis",["x","y","z"].map(c=>({label:c})),c=>({hidden:()=>{var e,i;return!(!((i=(e=c._viewer)===null||e===void 0?void 0:e.getPluginByType("Picking"))===null||i===void 0)&&i.getSelectedObject())||!c.rotations}})),pn(fS.prototype._paramsChanged)],H_.prototype,"axis",void 0),mM([qs("Rotation Skips",c=>({hidden:()=>{var e,i;return!(!((i=(e=c._viewer)===null||e===void 0?void 0:e.getPluginByType("Picking"))===null||i===void 0)&&i.getSelectedObject())||!c.rotations}})),pn(fS.prototype._paramsChanged)],H_.prototype,"skips",void 0),H_=fS=mM([Ys("Object Rotations")],H_);var h1,mS=function(c,e,i,s){var a,h=arguments.length,d=h<3?e:s===null?s=Object.getOwnPropertyDescriptor(e,i):s;if(typeof Reflect=="object"&&typeof Reflect.decorate=="function")d=Reflect.decorate(c,e,i,s);else for(var _=c.length-1;_>=0;_--)(a=c[_])&&(d=(h<3?a(d):h>3?a(e,i,d):a(e,i))||d);return h>3&&d&&Object.defineProperty(e,i,d),d};let W0=h1=class extends Ls{constructor(c=!0){super(),this.enabled=!0,this.debugNormals=!1,this.debugHitHeight=!1,this._defines={PARALLAX_NORMAL_MAP_QUALITY:0},this.stepCount=12,this.binaryStepCount=3,this._bumpMapExtension={shaderExtender:(e,i,s)=>{if(i.materialObject.bumpMap&&this.enabled){e.fragmentShader=e.fragmentShader.replace("#include <normal_fragment_begin>",""),e.fragmentShader=e.fragmentShader.replace("#include <normal_fragment_maps>",""),e.fragmentShader=e.fragmentShader.replace("#include <map_fragment>",`#include <normal_fragment_begin>
#include <normal_fragment_maps>
#include <map_fragment>`);for(const a of["map_fragment","alphamap_fragment","roughnessmap_fragment","metalnessmap_fragment","emissivemap_fragment","transmission_fragment"])e.fragmentShader=e.fragmentShader.replace(`#include <${a}>`,b.WdD[a].replace("vUv","parallaxUv.xy"));(this.debugNormals||this.debugHitHeight)&&(e.fragmentShader=e.fragmentShader.replace("texture2D( map, parallaxUv.xy )",this.debugNormals?"vec4(normal, 1.); normal = geometryNormal":"vec4(parallaxUv.z,0., 0., 1.)")),e.fragmentShader=e.fragmentShader.replace("#include <normal_fragment_maps>",b.WdD.normal_fragment_maps.replace("#elif defined( TANGENTSPACE_NORMALMAP )","#elif defined( TANGENTSPACE_NORMALMAP ) && !defined( USE_BUMPMAP )").replace("normal = perturbNormalArb( - vViewPosition, normal, dHdxy_fwd(), faceDirection );","vec3 parallaxUv = reliefParallaxPerturbNormal(faceDirection, normal);"))}},parsFragmentSnippet:()=>this.enabled?`#ifdef USE_BUMPMAP
mat3 mat3_inverse(mat3 A){mat3 M_t=mat3(vec3(A[0][0],A[1][0],A[2][0]),vec3(A[0][1],A[1][1],A[2][1]),vec3(A[0][2],A[1][2],A[2][2]));float det=dot(cross(M_t[0],M_t[1]),M_t[2]);mat3 adjugate=mat3(cross(M_t[1],M_t[2]),cross(M_t[2],M_t[0]),cross(M_t[0],M_t[1]));return adjugate/det;}float CalculateHeight(in vec2 texCoords){float height=texture2D(bumpMap,texCoords).x;return clamp(height,0.,1.);}const vec2 bumpMapSize=vec2(512,512);vec3 CalculateNormal(in vec2 texCoords){
#if defined( TANGENTSPACE_NORMALMAP ) && 0 
vec3 mapN=texture2D(normalMap,texCoords).xyz;mapN.xy*=normalScale;return normalize(mapN);
#else
vec2 texOffs=1./bumpMapSize;
#if PARALLAX_NORMAL_MAP_QUALITY > 0
float hx[9];hx[0]=texture2D(bumpMap,texCoords.st+texOffs*vec2(-1.,-1.)).r;hx[1]=texture2D(bumpMap,texCoords.st+texOffs*vec2(0.,-1.)).r;hx[2]=texture2D(bumpMap,texCoords.st+texOffs*vec2(1.,-1.)).r;hx[3]=texture2D(bumpMap,texCoords.st+texOffs*vec2(-1.,0.)).r;hx[4]=texture2D(bumpMap,texCoords.st).r;hx[5]=texture2D(bumpMap,texCoords.st+texOffs*vec2(1.,0.)).r;hx[6]=texture2D(bumpMap,texCoords.st+texOffs*vec2(-1.,1.)).r;hx[7]=texture2D(bumpMap,texCoords.st+texOffs*vec2(0.,1.)).r;hx[8]=texture2D(bumpMap,texCoords.st+texOffs*vec2(1.,1.)).r;vec2 deltaH=vec2(hx[0]-hx[2]+2.*(hx[3]-hx[5])+hx[6]-hx[8],hx[0]-hx[6]+2.*(hx[1]-hx[7])+hx[2]-hx[8]);
#else
float h_xa=texture2D(bumpMap,texCoords.st+texOffs*vec2(-1.,0.)).r;float h_xb=texture2D(bumpMap,texCoords.st+texOffs*vec2(1.,0.)).r;float h_ya=texture2D(bumpMap,texCoords.st+texOffs*vec2(0.,-1.)).r;float h_yb=texture2D(bumpMap,texCoords.st+texOffs*vec2(0.,1.)).r;vec2 deltaH=vec2(h_xa-h_xb,h_ya-h_yb);
#endif
return normalize(vec3(deltaH/texOffs,1.));
#endif
}vec3 ReliefParallax(in float frontFace,in vec3 texDir3D,in vec2 texCoord){float surf_sign=frontFace;float back_face=step(0.,-surf_sign);vec2 texStep=surf_sign*texDir3D.xy/abs(texDir3D.z);vec2 texC=texCoord.st+surf_sign*texStep+back_face*texStep.xy;float mapHeight=1.;float bumpHeightStep=1./float(PARALLAX_MAP_STEPS);float bestBumpHeight=mapHeight+bumpHeightStep;
#pragma unroll_loop_start
for(int i=0;i<PARALLAX_MAP_STEPS;i++){if(mapHeight<bestBumpHeight){bestBumpHeight-=bumpHeightStep;mapHeight=back_face+surf_sign*CalculateHeight(texC.xy-bestBumpHeight*texStep.xy);}}
#pragma unroll_loop_end
bestBumpHeight+=bumpHeightStep;
#pragma unroll_loop_start
for(int i=0;i<PARALLAX_MAP_B_STEPS;i++){bumpHeightStep*=0.5;bestBumpHeight-=bumpHeightStep;mapHeight=back_face+surf_sign*CalculateHeight(texC.xy-bestBumpHeight*texStep.xy);bestBumpHeight+=(bestBumpHeight<mapHeight)?bumpHeightStep:0.;}
#pragma unroll_loop_end
bestBumpHeight-=bumpHeightStep*clamp((bestBumpHeight-mapHeight)/bumpHeightStep,0.,1.);mapHeight=bestBumpHeight;texC-=mapHeight*texStep;return vec3(texC.xy,mapHeight);}vec3 reliefParallaxPerturbNormal(in float faceDirection,inout vec3 normal){if(abs(bumpScale)<0.001)return vec3(vUv,0.);float parallaxHeight;vec2 texCoords=vUv;float face_sign=sign(dot(normal,vViewPosition));vec3 N=normalize(normal);vec3 dp1=dFdx(-vViewPosition);vec3 dp2=dFdy(-vViewPosition);vec2 duv1=dFdx(vUv);vec2 duv2=dFdy(vUv);vec3 dp2perp=cross(dp2,N);vec3 dp1perp=cross(N,dp1);vec3 T=dp2perp*duv1.x+dp1perp*duv2.x;vec3 B=dp2perp*duv1.y+dp1perp*duv2.y;float invmax=inversesqrt(max(dot(T,T),dot(B,B)));mat3 tbnMat=mat3(T*invmax,B*invmax,N*bumpScale);vec3 tangentPos=normalize(mat3_inverse(tbnMat)*-vViewPosition);vec3 parallaxUv=ReliefParallax(face_sign,tangentPos,vUv);tbnMat[2]=face_sign*N/bumpScale;normal=normalize(tbnMat*CalculateNormal(parallaxUv.xy).xyz);
#ifdef FLIP_SIDED
normal=-normal;
#endif
return parallaxUv;}
#endif 

`.replaceAll("PARALLAX_MAP_STEPS",this._defines.PARALLAX_MAP_STEPS).replaceAll("PARALLAX_MAP_B_STEPS",this._defines.PARALLAX_MAP_B_STEPS):"",isCompatible:e=>e.isMeshStandardMaterial2,computeCacheKey:e=>{var i;return this.enabled+" "+((i=e.materialObject.bumpMap)===null||i===void 0?void 0:i.uuid)+" "+this.debugNormals+" "+this.debugHitHeight+"  "},onObjectRender:(e,{materialObject:i},s)=>{for(const[a,h]of Object.entries(this._defines)){const d=typeof h=="number"?h:h?1:0;i.defines[a]!==d&&(i.defines[a]=d,i.needsUpdate=!0)}}},this.dependencies=[qr],this.enabled=c,this._updateExtension=this._updateExtension.bind(this)}_updateExtension(){var c,e,i;(e=(c=this._bumpMapExtension)===null||c===void 0?void 0:c.setDirty)===null||e===void 0||e.call(c),(i=this._viewer)===null||i===void 0||i.setDirty()}async onAdded(c){var e,i;return(i=(e=c.getPlugin(qr))===null||e===void 0?void 0:e.materials)===null||i===void 0||i.registerMaterialExtension(this._bumpMapExtension),super.onAdded(c)}async onRemove(c){var e,i;return(i=(e=c.getPlugin(qr))===null||e===void 0?void 0:e.materials)===null||i===void 0||i.unregisterMaterialExtension(this._bumpMapExtension),super.onRemove(c)}};W0.PluginType="ReliefParallaxMapping",mS([pn(h1.prototype._updateExtension),ts("Enabled")],W0.prototype,"enabled",void 0),mS([pn(h1.prototype._updateExtension),ts("Debug Normals")],W0.prototype,"debugNormals",void 0),mS([pn(h1.prototype._updateExtension),ts("Debug Hit Height")],W0.prototype,"debugHitHeight",void 0),mS([jn("PARALLAX_MAP_STEPS",void 0,!0,h1.prototype._updateExtension),ss("Step count",[1,32],1),Fn()],W0.prototype,"stepCount",void 0),mS([jn("PARALLAX_MAP_B_STEPS",void 0,!0,h1.prototype._updateExtension),ss("Binary search steps",[1,8],1),Fn()],W0.prototype,"binaryStepCount",void 0),W0=h1=mS([Ys("Parallax Mapping")],W0);var n0=function(c,e,i,s){var a,h=arguments.length,d=h<3?e:s===null?s=Object.getOwnPropertyDescriptor(e,i):s;if(typeof Reflect=="object"&&typeof Reflect.decorate=="function")d=Reflect.decorate(c,e,i,s);else for(var _=c.length-1;_>=0;_--)(a=c[_])&&(d=(h<3?a(d):h>3?a(e,i,d):a(e,i))||d);return h>3&&d&&Object.defineProperty(e,i,d),d};class mv extends Tl{constructor(e,i,s,a=!1){super({vertexShader:Km,fragmentShader:`

${Q1}
${$w}
${Jm}
${ZS}
${s}

${G1}

varying vec2 vUv;uniform float intensity;uniform float objectRadius;uniform float rayCount;uniform float power;uniform float bias;uniform float falloff;uniform float tolerance;uniform bool autoRadius;uniform vec2 screenSize;vec3 ComputeUniformL(vec3 N,vec2 E){vec3 L;L.xy=E;L.z=interleavedGradientNoise(gl_FragCoord.xy,frameCount*5.);L=L*2.-1.;return L;}vec2 GetRandomE(float seed){vec2 rand_e;rand_e.x=random3(vec3(gl_FragCoord.xy,frameCount+seed));rand_e.y=random3(vec3(gl_FragCoord.yx,rand_e.x+(frameCount)*7.));return rand_e;}vec4 calculateGI(in float seed,in vec3 screenPos,in vec3 normal,in float radiusFactor){vec3 viewPos=screenToView(screenPos.xy,screenPos.z);normal=normalize(normal);vec2 E=GetRandomE(seed);vec3 L=ComputeUniformL(normal,E);L=normalize(L);L*=sign(dot(L,normal));float cameraDist=length(cameraPositionWorld);float rayLen=autoRadius?length(viewPos-screenToView(screenPos.xy+objectRadius/10.,screenPos.z)):mix((cameraNearFar.y)+viewPos.z,-viewPos.z-cameraNearFar.x,L.z*0.5+0.5)*objectRadius;rayLen*=radiusFactor;float r=interleavedGradientNoise(gl_FragCoord.xy,frameCount*14.+seed)+0.05;rayLen=max(rayLen,0.001);vec3 state=vec3(1.,(r+0.5)/float(RTAO_STEP_COUNT),2.);viewPos+=normal*max(-0.01*viewPos.z,0.001);vec3 screenHitP=traceRay(viewPos,L*rayLen,tolerance*rayLen,state,RTAO_STEP_COUNT);vec3 viewHitP=screenToView(screenHitP.xy,screenHitP.z);vec3 LRes=viewHitP-viewPos;if(state.z>1.)LRes=vec3(9999999.);float dist=length(LRes)*falloff;float EPS=0.01;float zBias=(viewPos.z)*bias;float ao=(max(dot(normal,L)+zBias,0.))/(dist*dist+EPS);
#if defined(SSGI_ENABLED) && SSGI_ENABLED > 0
vec3 hitColor=tLastFrameTexelToLinear(texture2D(tLastFrame,screenHitP.xy)).rgb;vec3 hitNormal=getViewNormal(screenHitP.xy);float giWeight=1.;giWeight=saturate2(giWeight/(dist+EPS),1.);giWeight*=saturate2((dot(normal,L)),1.);giWeight*=saturate2((dot(hitNormal,-L)),1.);return vec4(hitColor*giWeight,ao);
#endif
return vec4(0,0,0,ao);}float normpdf(in float x,in float sigma){return exp(-0.5*x*x/(sigma*sigma));}vec4 getLastThis(sampler2D tex,float depth,vec3 normal){vec2 direction=vec2(1,1);vec4 color=clamp(tLastThisTexelToLinear(texture2D(tex,vUv.xy)),0.,5.);return color;}void main(){float depth;vec3 normal;getDepthNormal(vUv,depth,normal);if(depth>0.99){discard;gl_FragColor=getLastThis(tLastThis,depth,normal);return;}float viewZ=depthToViewZ(depth);vec3 screenPos=vec3(vUv.x,vUv.y,viewZ);vec4 gi=vec4(0.);gi+=calculateGI(8.,screenPos,normal,1.);if(rayCount>1.5)gi=max(gi,calculateGI(2.,screenPos,normal,0.4));if(rayCount>2.5)gi=max(gi,calculateGI(3.,screenPos,normal,1.5));if(rayCount>3.5)gi=max(gi,calculateGI(1.,screenPos,normal,0.6));if(rayCount>4.5)gi=max(gi,calculateGI(3.,screenPos,normal,1.));gi.a=min(1.,gi.a);gi.a=max(0.,gi.a);gi.rgb=min(vec3(3.),gi.rgb);gi.rgb=max(vec3(0.),gi.rgb);if(frameCount<3.){gl_FragColor=gi;return;}gl_FragColor=(texture2D(tLastThis,vUv));gl_FragColor=((gi+(gl_FragColor)*frameCount)/(frameCount+1.));}

            `,uniforms:{tLastThis:{value:null},tDiffuse:{value:null},tNormalDepth:{value:null},tLastFrame:{value:null},opacity:{value:1},intensity:{value:2.14},rayCount:{value:.1},objectRadius:{value:1},autoRadius:{value:!a},power:{value:1.1},bias:{value:.015},falloff:{value:.7},tolerance:{value:1.5},frameCount:{value:0},projection:{value:new b.yGw},screenSize:{value:new b.FM8},cameraPositionWorld:{value:new b.Pa4},cameraNearFar:{value:new b.FM8(.1,1e3)}},defines:{PERSPECTIVE_CAMERA:1,SSGI_ENABLED:a?1:0}},"tDiffuse","tLastFrame","tLastThis"),this.materialExtension={shaderExtender:(h,d,_)=>{if(!h.defines.SSRTAO_ENABLED)return;const et="vec3 totalDiffuse =";h.fragmentShader=h.fragmentShader.replace(et,`

            
            #if defined(SSRTAO_ENABLED) && SSRTAO_ENABLED > 0
vec4 ssgi=tSSGIMapTexelToLinear(texture2D(tSSGIMap,viewToScreen(vViewPosition.xyz).xy));float ambientOcclusion=1.-ssgi.a;ambientOcclusion=max(0.,ambientOcclusion);ambientOcclusion=pow(ambientOcclusion,ssaoPower);ambientOcclusion=min(1.,ambientOcclusion);reflectedLight.indirectDiffuse*=ambientOcclusion;
#if defined(SSGI_ENABLED) && SSGI_ENABLED > 0
vec3 ssgiColor=ssgi.rgb*ssgiIntensity;reflectedLight.indirectDiffuse+=ssgiColor*(material.diffuseColor.rgb);
#endif
#if defined( USE_ENVMAP )
float dotNV=saturate(dot(geometry.normal,geometry.viewDir));float specularOcclusion=saturate(pow(dotNV+ambientOcclusion,exp2(-16.*material.roughness-1.))-1.+ambientOcclusion);reflectedLight.indirectSpecular*=specularOcclusion;
#if defined(SSGI_ENABLED) && SSGI_ENABLED > 0
#if !defined(SSR_ENABLED) || SSR_ENABLED < 1
reflectedLight.indirectSpecular+=ssgiColor*material.specularColor;
#endif
#endif
#endif
#endif

            
            // reflectedLight.directDiffuse = vec3(0.);
            // reflectedLight.indirectDiffuse = vec3(0.);
            // reflectedLight.directSpecular = vec3(0.);
            // reflectedLight.indirectSpecular = vec3(0.);
            
            
${et}`),h.fragmentShader=h.fragmentShader.replace("#include <aomap_fragment>",""),h.vertexUvs=!0},onObjectRender:(h,d,_)=>{var et,nt,it;this.materialExtension.extraUniforms.tSSGIMap.value=(et=this._target)===null||et===void 0?void 0:et.texture;const lt=d.materialObject,ut=!lt.transparent&&lt.transmission<.001;let pt=this.enabled&&ut&&(this.renderWithCamera||this._renderer.frameCount>1)&&_.userData.screenSpaceRendering!==!1&&!(!((nt=lt.userData)===null||nt===void 0)&&nt.ssrtaoDisabled)&&!(!((it=lt.userData)===null||it===void 0)&&it.ssaoDisabled)?1:0;lt.defines.SSRTAO_ENABLED!==pt&&(lt.defines.SSRTAO_ENABLED=pt,lt.needsUpdate=!0),pt=this.material.defines.SSGI_ENABLED,lt.defines.SSGI_ENABLED!==pt&&(lt.defines.SSGI_ENABLED=pt,lt.needsUpdate=!0),pt=this._target.texture,this.materialExtension.extraUniforms.tSSGIMap.value!==pt&&(this.materialExtension.extraUniforms.tSSGIMap.value=pt,lt.needsUpdate=!0)},parsFragmentSnippet:h=>{var d;return Qt`
            uniform float ssaoPower;
            uniform float ssgiIntensity;
            uniform sampler2D tSSGIMap;
            ${$n("tSSGIMap",(d=this._target)===null||d===void 0?void 0:d.texture,h.capabilities.isWebGL2)}

            ${H1}

        `},extraUniforms:{tSSGIMap:{value:null},ssaoPower:this.material.uniforms.power,ssgiIntensity:this.material.uniforms.intensity},computeCacheKey:h=>{var d,_;return this.enabled?"1":"0"+((_=(d=this._target)===null||d===void 0?void 0:d.texture)===null||_===void 0?void 0:_.encoding)},isCompatible:h=>{var d;return!(!((d=h.materialObject.userData)===null||d===void 0)&&d.ssaoDisabled)&&h.isMeshStandardMaterial2}},this.intensity=2,this.power=1.1,this.autoRadius=!0,this.objectRadius=2,this.tolerance=1,this.bias=.15,this.falloff=.7,this.rayCount=2,this.stepCount=4,this.smoothEnabled=!0,this.renderWithCamera=!0,this.uiConfig={type:"folder",label:"SS Global illumination (Dev)",children:[...bv(this),{type:"checkbox",label:"GI Enabled",hidden:()=>!this._giActivated,property:[this,"ssgiEnabled"]}]},this._renderer=e,this._target=i,this.needsSwap=!0,this._giActivated=a,this.ssgiEnabled=a,this.bilateralPass=new q1(this._target,s,"rgba")}get ssgiEnabled(){return parseInt(this.material.defines.SSGI_ENABLED)>.5}set ssgiEnabled(e){e=e&&this._giActivated,this.material.defines.SSGI_ENABLED=e?1:0,this.material.needsUpdate=!0}render(e,i,s,a,h){this.needsSwap=!1,!this.renderWithCamera&&this._renderer.frameCount<2||(this._renderer.blit(this._target.texture,i),this.uniforms.tLastThis.value=i.texture,super.render(e,this._target,s,a,h),this.smoothEnabled&&this.bilateralPass.render(e,i,s,a,h))}}n0([Fn()],mv.prototype,"bilateralPass",void 0),n0([ss("Intensity",[0,4]),Fn(),rn()],mv.prototype,"intensity",void 0),n0([ss("Power",[0,3]),Fn(),rn()],mv.prototype,"power",void 0),n0([ts("Auto radius"),Fn(),rn()],mv.prototype,"autoRadius",void 0),n0([ss("Object Radius",[.01,10]),Fn(),rn()],mv.prototype,"objectRadius",void 0),n0([ss("Tolerance",[.1,5]),Fn(),rn()],mv.prototype,"tolerance",void 0),n0([ss("Bias",[-.3,.3]),Fn(),rn()],mv.prototype,"bias",void 0),n0([ss("Falloff",[1e-4,4]),Fn(),rn()],mv.prototype,"falloff",void 0),n0([ss("Ray Count",[1,5],1),Fn(),rn()],mv.prototype,"rayCount",void 0),n0([ss("Step count",[1,16],1),Fn(),jn("RTAO_STEP_COUNT")],mv.prototype,"stepCount",void 0),n0([ts("Smooth Enabled"),Fn()],mv.prototype,"smoothEnabled",void 0),n0([ts("Render with Camera")],mv.prototype,"renderWithCamera",void 0);class f2 extends Zw{constructor(e=!0){super(),this.dependencies=[qr,ho,Bu],this._initEnabled=!1,this.setDirty=this.setDirty.bind(this),this._initEnabled=e}get rtgiTarget(){return this._rtgiTarget}async onAdded(e){var i,s;await super.onAdded(e),this.enabled=this._initEnabled,(s=(i=this.uiConfig).uiRefresh)===null||s===void 0||s.call(i,"postFrame",!0)}get enabled(){var e,i;return((i=(e=this.passes.ssrtgi)===null||e===void 0?void 0:e.passObject)===null||i===void 0?void 0:i.enabled)||!1}set enabled(e){var i;!((i=this.passes.ssrtgi)===null||i===void 0)&&i.passObject&&(this.passes.ssrtgi.passObject.enabled=e)}createPasses(e){var i,s,a;this._rtgiTarget=e.renderer.createTarget({sizeMultiplier:1});let h=!1;return(i=this._viewer)===null||i===void 0||i.getPluginByType("debug"),[CA(e,{passId:"ssrtgi",after:["gbuffer"],before:["render"],required:["render","gbuffer","progressive"],passObject:new mv(e.renderer,this._rtgiTarget,(a=(s=e.getPlugin(ho))===null||s===void 0?void 0:s.getUnpackSnippet())!==null&&a!==void 0?a:"",!0),update:()=>{var d;let _=this.enabled;if(_&&!h){const et=(d=this._viewer)===null||d===void 0?void 0:d.getPluginByType("SSAO");et!=null&&et.enabled&&(confirm("SSAO Plugin needs to be disabled to enable SSRTGI or SSRTAO. Disable now?")?et.enabled=!1:(this.enabled=!1,_=!1))}h=_,_&&this.passes.ssrtgi.passObject.bilateralPass.updateShaderProperties([e.getPlugin(ho)])}},()=>[e.getPlugin(ho),e.getPlugin(Bu),e.scene.activeCamera,e.renderer])]}async onRemove(e){return e.renderer.disposeTarget(this._rtgiTarget),super.onRemove(e)}setDirty(){var e;(e=this._viewer)===null||e===void 0||e.setDirty()}get uiConfig(){var e,i,s,a,h;const d=(s=(i=(e=this.passes.ssrtgi)===null||e===void 0?void 0:e.passObject)===null||i===void 0?void 0:i.uiConfig)!==null&&s!==void 0?s:{};return(h=(a=d.children)===null||a===void 0?void 0:a.map(_=>Yt(_)))===null||h===void 0||h.flat(2).forEach(_=>_&&(_.onChange=this.setDirty)),d}}f2.PluginType="SSGI";class Cw extends Ls{constructor(){super(...arguments),this.enabled=!0,this._uiNeedRefresh=!1,this.dependencies=[qr],this.variations=[],this._selectedSwitchNode=()=>{var e;const i=(e=this._picking)===null||e===void 0?void 0:e.getSelectedObject();if(!i)return;const s=this.variations.map(h=>h.name);let a;return i.traverseAncestors(h=>{a||s.includes(h.name)&&(a=h)}),a},this.uiConfig={label:"Switch Node",type:"folder",children:[()=>[{type:"folder",label:"All nodes",expanded:!0,children:[this.variations.map(e=>({type:"input",label:e.title,property:[e,"name"],onChange:()=>this.refreshUi()}))]},{type:"button",label:"Add Node",value:()=>{this.variations.push({name:"switch_node",selected:"",title:"Switch Node",camView:"front",camDistance:1}),this.refreshUi()}},{type:"button",label:"Refresh UI",value:()=>this.refreshUi()},{type:"input",label:"Selected node title",hidden:()=>!this._selectedSwitchNode(),property:()=>{const e=this._selectedSwitchNode();return e?[this.variations.find(i=>i.name===e.name),"title"]:[]},onChange:()=>this.refreshUi()},{type:"slider",bounds:[.01,2],stepSize:.01,label:"Cam Distance",hidden:()=>!this._selectedSwitchNode(),property:()=>{const e=this._selectedSwitchNode();return e?[this.variations.find(i=>i.name===e.name),"camDistance"]:[]}},{type:"dropdown",label:"Cam View",hidden:()=>!this._selectedSwitchNode(),property:()=>{const e=this._selectedSwitchNode();return e?[this.variations.find(i=>i.name===e.name),"camView"]:[]},onChange:()=>this.refreshUi(),children:["top","bottom","front","back","left","right"].map(e=>({label:e,value:e}))}]]}}async onAdded(e){var i,s;await super.onAdded(e),this._picking=(i=this._viewer)===null||i===void 0?void 0:i.getPluginByType("Picking"),(s=this._picking)===null||s===void 0||s.addEventListener("selectedObjectChanged",()=>{var a,h;(h=(a=this.uiConfig).uiRefresh)===null||h===void 0||h.call(a)}),e.addEventListener("postFrame",()=>{this._uiNeedRefresh&&this._refreshUi()}),e.addEventListener("preRender",()=>{if(this._viewer)for(const a of this.variations){const h=this._viewer.scene.getObjectByName(a.name);if(!h||h.children.length<1)return;a.selected||(a.selected=h.children[0].name||h.children[0].uuid);for(const d of h.children)d.visible=(d.name||d.uuid)===a.selected}}),e.addEventListener("postRender",()=>{if(this._viewer)for(const a of this.variations){const h=this._viewer.scene.getObjectByName(a.name);if(!h||h.children.length<1)return;for(const d of h.children)d.visible=!0}}),this.addEventListener("deserialize",async()=>{await Vl(200),this.refreshUi()})}refreshUi(){this.enabled&&(this._uiNeedRefresh=!0)}_refreshUi(){var e,i,s;if(this.enabled&&this._viewer){this._uiNeedRefresh=!1,Q0.RemoveAll(Cw.PluginType);for(const a of this.variations){const h=this._viewer.scene.getObjectByName(a.name);h?(h.children.length<1&&console.warn("SwitchNode does not have enough children",a),Q0.Create(Cw.PluginType,a.title,Math.min(5,h.children.length),20,0,h.children.map(d=>{const _=a.camView,et=new b.Pa4((_.includes("right")?1:0)-(_.includes("left")?1:0),(_.includes("top")?1:0)-(_.includes("bottom")?1:0),(_.includes("front")?1:0)-(_.includes("back")?1:0));a.camDistance||(a.camDistance=1);const nt=pP(this._viewer,d,void 0,7,et.multiplyScalar(.5*a.camDistance));return{id:d.uuid,image:nt,onClick:()=>{var it;a.selected=d.name||d.uuid,(it=this._viewer)===null||it===void 0||it.scene.setDirty({sceneUpdate:!0,frameFade:!0})},tooltip:d.name||d.uuid}}),(d,_)=>LP(d,{placement:"bottom",content:_.tooltip}))):console.warn("no object found for variation, skipping",a)}Q0.RebuildUi((e=this._viewer)===null||e===void 0?void 0:e.container),(s=(i=this.uiConfig).uiRefresh)===null||s===void 0||s.call(i)}}}Cw.PluginType="SwitchNodePlugin",function(c,e,i,s){var a,h=arguments.length,d=h<3?e:s===null?s=Object.getOwnPropertyDescriptor(e,i):s;if(typeof Reflect=="object"&&typeof Reflect.decorate=="function")d=Reflect.decorate(c,e,i,s);else for(var _=c.length-1;_>=0;_--)(a=c[_])&&(d=(h<3?a(d):h>3?a(e,i,d):a(e,i))||d);h>3&&d&&Object.defineProperty(e,i,d)}([Fn()],Cw.prototype,"variations",void 0);class NP extends b.u9r{constructor(e,i,s=32,a=64,h=!1,d=new b.FM8(1,1),_="shape"){super(),this.type="TubeShapeGeometry",this.parameters={path:i,shape:e,shapeSegments:s,tubularSegments:a,closed:h,primary:_,shapeScale:d.clone()};const et=i.computeFrenetFrames(a,h);this.frames=et;const nt=new b.Pa4,it=new b.Pa4,lt=new b.Pa4,ut=new b.FM8;let pt=new b.Pa4;const gt=[],vt=[],Ct=[],wt=e.getSpacedPoints(s);for(const Pt of wt)Pt.multiply(d);(function(){for(let Pt=0;Pt<a;Pt++)_t(Pt);_t(h===!1?a:0),function(){for(let Pt=0;Pt<=a;Pt++)for(let Bt=0;Bt<=s;Bt++)ut.x=Pt/a,ut.y=Bt/s,vt.push(ut.x,ut.y)}(),function(){const Pt=_==="shape",Bt=Pt?s:a,Ot=Pt?a:s;for(let Lt=1;Lt<=Bt;Lt++)for(let qt=1;qt<=Ot;qt++){const[en,cn]=Pt?[qt,Lt]:[Lt,qt],An=(s+1)*(en-1)+(cn-1),mn=(s+1)*en+(cn-1),Tn=(s+1)*en+cn,vn=(s+1)*(en-1)+cn;Ct.push(An,mn,vn),Ct.push(mn,Tn,vn)}}()})(),this.setIndex(Ct),this.setAttribute("position",new b.a$l(gt,3)),this.setAttribute("uv",new b.a$l(vt,2)),this.computeVertexNormals();const xt=this.attributes.normal;function _t(Pt){pt=i.getPointAt(Pt/a,pt);const Bt=et.normals[Pt],Ot=et.binormals[Pt];for(let Lt=0;Lt<=s;Lt++){const qt=wt[Lt%s];it.set(0,0,0).addScaledVector(Bt,qt.x).addScaledVector(Ot,qt.y),nt.copy(pt).add(it),gt.push(nt.x,nt.y,nt.z)}}(function(){for(let Bt=1;Bt<s;Bt++){const Ot=Bt+a*(s+1);it.fromBufferAttribute(xt,Bt),lt.fromBufferAttribute(xt,Ot),it.add(lt).normalize(),xt.setXYZ(Bt,it.x,it.y,it.z),xt.setXYZ(Ot,it.x,it.y,it.z)}for(let Bt=1;Bt<a;Bt++){const Ot=Bt*(s+1),Lt=Ot+s;it.fromBufferAttribute(xt,Ot),lt.fromBufferAttribute(xt,Lt),it.add(lt).normalize(),xt.setXYZ(Ot,it.x,it.y,it.z),xt.setXYZ(Lt,it.x,it.y,it.z)}it.fromBufferAttribute(xt,0),lt.fromBufferAttribute(xt,s),it.add(lt);const Pt=a*(s+1);lt.fromBufferAttribute(xt,Pt),it.add(lt),lt.fromBufferAttribute(xt,Pt+s),it.add(lt),it.normalize(),xt.setXYZ(0,it.x,it.y,it.z),xt.setXYZ(s,it.x,it.y,it.z),xt.setXYZ(Pt,it.x,it.y,it.z),xt.setXYZ(Pt+s,it.x,it.y,it.z),xt.needsUpdate=!0})()}createSplits(e){this.clearGroups();const i=this.parameters.primary==="shape"?this.parameters.shapeSegments:this.parameters.tubularSegments,s=this.index.count,a=[...e,1].sort();let h=0,d=0;for(const _ of a){const et=Math.round(i*_)*s/i;this.addGroup(h,et-h,d++),h=et}return this.groups.length}toJSON(){const e=super.toJSON();return e.path=this.parameters.path.toJSON(),e.shape=this.parameters.shape.toJSON(),e}}var UP,Mw=function(c,e,i,s){var a,h=arguments.length,d=h<3?e:s===null?s=Object.getOwnPropertyDescriptor(e,i):s;if(typeof Reflect=="object"&&typeof Reflect.decorate=="function")d=Reflect.decorate(c,e,i,s);else for(var _=c.length-1;_>=0;_--)(a=c[_])&&(d=(h<3?a(d):h>3?a(e,i,d):a(e,i))||d);return h>3&&d&&Object.defineProperty(e,i,d),d};let gv=UP=class extends Ls{constructor(){super(...arguments),this.enabled=!0,this.shapeSegments=32,this.tubularSegments=32,this.shapeScale=new b.FM8(1,1),this.materialSplits="0.3, 0.6",this.horizontalSplits=!0,this.extrudeCirceTube=async()=>{var c,e;const i=(e=(c=this._viewer)===null||c===void 0?void 0:c.getPlugin(ro))===null||e===void 0?void 0:e.getSelectedObject();if(!i)return;let s=this._viewer.prompt("Radius: Radius for the circle","1",!0);if(!s)return;s=parseFloat(s);const a=new FP(0,0,s,s,0,2*Math.PI,!0,0);await this.extrudeObject(i,a)}}async onAdded(c){await super.onAdded(c)}static CreateCurve(c,e){var i,s;if(c==="circle")return new FP(0,0,(i=e.radius)!==null&&i!==void 0?i:1,(s=e.radius)!==null&&s!==void 0?s:1,0,2*Math.PI,!0,0);throw new Error("Unknown curve type")}async extrudeObject(c,e,i=this.shapeSegments,s=this.tubularSegments,a=this.shapeScale,h=this.materialSplits.split(",").map(_=>parseFloat(_.trim())),d=this.horizontalSplits){var _,et,nt,it,lt,ut,pt,gt;if(c.userData.isExtrudedTube,c.userData._extrudeSource){const Pt=c.userData._extrudeSource;if(c=(_=c.parent)===null||_===void 0?void 0:_.children.find(Bt=>Pt===Bt.uuid),!c)return void console.warn("Could not find extrude source with uuid",Pt)}if(c.userData.extrudedObject){const Pt=c.userData.extrudedObject,Bt=(et=c.parent)===null||et===void 0?void 0:et.children.find(Ot=>Pt===Ot.uuid);Bt&&(Bt.removeFromParent(),Bt.geometry.dispose(),Bt.geometry=null,Bt.material=null),delete c.userData.extrudedObject}const vt=c.geometry;if(!vt)return void((nt=this._viewer)===null||nt===void 0||nt.alert("Extrude: No geometry to extrude"));const Ct=[c.material];let wt;try{const Pt=UP.ConvertGeometryToFlatShape(vt);wt=new NP(Pt,e,i,s,!0,a,d?"shape":"path"),wt.computeBoundingBox(),wt.createSplits(h)}catch(Pt){return void((it=this._viewer)===null||it===void 0||it.alert(typeof Pt=="string"?Pt:Pt==null?void 0:Pt.message))}Ct[0].color.set(16777215);for(let Pt=Ct.length;Pt<wt.groups.length;Pt++){const Bt=Ct[0].clone();Ct.push(Bt),Bt.color.set(16777215*Math.random())}const xt=new b.Kj0(wt,Ct);xt.userData._extrudeSource=c.uuid,xt.userData.isExtrudedTube=!0,c.visible=!1,c.userData.bboxVisible=!1,xt.name=c.name+"_extruded";const _t=await((pt=(ut=(lt=this._viewer)===null||lt===void 0?void 0:lt.getManager())===null||ut===void 0?void 0:ut.importer)===null||pt===void 0?void 0:pt.processImportedSingle(xt,{autoCenter:!1,autoScale:!1}));_t&&((gt=c.parent)===null||gt===void 0||gt.add(_t.modelObject),c.userData.extrudedObject=_t.modelObject.uuid,_t.dispatchEvent({type:"select",ui:!0,value:_t}))}static ExtrudeShape(c,e,i,s,a,h,d,_){const et=new NP(c,s,e,i,!0,new b.FM8(a,h),_?"shape":"path");et.computeBoundingBox(),et.createSplits(d);const nt=new b.Kj0(et,[]);return nt.userData.isExtrudedTube=!0,nt}static ConvertGeometryToFlatShape(c,e=!0){if(c.userData.__planarShape)return c.userData.__planarShape;let i=c.attributes.position;if(!i)throw"no position attribute";if(i.count>500)throw"too large to extrude";const s=c;i=s.attributes.position,s.boundingBox||s.computeBoundingBox();const a=s.boundingBox.getSize(new b.Pa4),h=a.x<.001?"x":a.y<.001?"y":a.z<.001?"z":null;if(!h)throw"geometry is not axis aligned not planar";let d=[];for(let et=0;et<i.count;et++){const nt=new b.FM8;h==="x"?nt.set(i.getY(et),i.getZ(et)):h==="y"?nt.set(i.getX(et),i.getZ(et)):nt.set(i.getX(et),i.getY(et)),d.push(nt)}if(e){let et=0;for(let nt=0;nt<d.length;nt++)(d[nt].x<d[et].x||d[nt].x===d[et].x&&d[nt].y<d[et].y)&&(et=nt);et!==0&&(d=d.slice(et).concat(d.slice(0,et)))}const _=new b.bnF(d);return c.userData.__planarShape=_,_}};gv.PluginType="ShapeTubeExtrudePlugin",Mw([ts("Enabled")],gv.prototype,"enabled",void 0),Mw([ss("Shape Segments (X)",[1,100],1,c=>({hidden:()=>{var e,i;return!(!((i=(e=c._viewer)===null||e===void 0?void 0:e.getPlugin(ro))===null||i===void 0)&&i.getSelectedObject())}}))],gv.prototype,"shapeSegments",void 0),Mw([ss("Tube Segments (Y)",[1,100],1,c=>({hidden:()=>{var e,i;return!(!((i=(e=c._viewer)===null||e===void 0?void 0:e.getPlugin(ro))===null||i===void 0)&&i.getSelectedObject())}}))],gv.prototype,"tubularSegments",void 0),Mw([Up("Shape scale",[.01,10],.01,c=>({hidden:()=>{var e,i;return!(!((i=(e=c._viewer)===null||e===void 0?void 0:e.getPlugin(ro))===null||i===void 0)&&i.getSelectedObject())}}))],gv.prototype,"shapeScale",void 0),Mw([qs("Material Splits",c=>({hidden:()=>{var e,i;return!(!((i=(e=c._viewer)===null||e===void 0?void 0:e.getPlugin(ro))===null||i===void 0)&&i.getSelectedObject())}}))],gv.prototype,"materialSplits",void 0),Mw([ts("Horizontal Splits",c=>({hidden:()=>{var e,i;return!(!((i=(e=c._viewer)===null||e===void 0?void 0:e.getPlugin(ro))===null||i===void 0)&&i.getSelectedObject())}}))],gv.prototype,"horizontalSplits",void 0),Mw([uo("Extrude Circle Tube",c=>({hidden:()=>{var e,i;return!(!((i=(e=c._viewer)===null||e===void 0?void 0:e.getPlugin(ro))===null||i===void 0)&&i.getSelectedObject())}}))],gv.prototype,"extrudeCirceTube",void 0),gv=UP=Mw([Ys("Extrude Tube Shapes")],gv);class FP extends b.Ny0{getPoint(e,i){return super.getPoint(e,i||new b.Pa4)}}class gM extends Ls{constructor(e=!0){super(),this.enabled=!0,this.toJSON=void 0,this.fromJSON=void 0,this._lastFrameTime=0,this._updaters=[],this.dependencies=[],this._fadeDisabled=!1,this.disableFrameFade=!0,this._postFrame=()=>{var i,s;if(!this._viewer)return;if(!this.enabled||Object.keys(this.animations).length<1)return this._lastFrameTime=0,void(this._fadeDisabled&&((i=this._viewer.getPluginByType("FrameFade"))===null||i===void 0||i.enable(gM.PluginType),this._fadeDisabled=!1));const a=Yu()/1e3;this._lastFrameTime<1&&(this._lastFrameTime=a-1/60);let h=a-this._lastFrameTime;this._lastFrameTime=a;const d=(s=this._viewer.getPluginByType("Progressive"))===null||s===void 0?void 0:s.postFrameConvergedRecordingDelta();if(d&&d>0&&(h=d),d!==0&&(h*=1e3,!(h<=.001)&&(this._updaters.forEach(_=>{let et=h;_.time+et<0&&(et=-_.time),_.time+=et,Math.abs(et)>.001&&_.u(et)}),!this._fadeDisabled&&this.disableFrameFade))){const _=this._viewer.getPluginByType("FrameFade");_&&(_.disable(gM.PluginType),this._fadeDisabled=!0)}},this.defaultDriver=i=>({start:()=>this._updaters.push({u:i,time:0}),stop:()=>this._updaters.splice(this._updaters.findIndex(s=>s.u===i),1)}),this.animations={},this.enabled=e,this._postFrame=this._postFrame.bind(this)}async onAdded(e){await super.onAdded(e),e.addEventListener("postFrame",this._postFrame)}async onRemove(e){return e.removeEventListener("postFrame",this._postFrame),super.onRemove(e)}animate(e){const i=gu(),s={id:i,options:e,stop:()=>{var a,h,d;!((a=this.animations[i])===null||a===void 0)&&a._stop?(d=(h=this.animations[i])===null||h===void 0?void 0:h._stop)===null||d===void 0||d.call(h):console.warn("Animation not started")}};return this.animations[i]=s,s.promise=new Promise((a,h)=>{const d={driver:this.defaultDriver,onComplete:()=>{var et;(et=e.onComplete)===null||et===void 0||et.call(e),a()},onStop:()=>{var et;(et=e.onStop)===null||et===void 0||et.call(e),a()},...e},_=Xy(d);this.animations[i]._stop=_.stop,this.animations[i].options=d}).then(()=>(delete this.animations[i],i)),this.animations[i]}async animateAsync(e){return this.animate(e).promise}}gM.PluginType="PopmotionPlugin";const QN=async c=>xp(await(await fetch(c)).blob());async function oO(c,e=QN){const i=c.match(/(((ftp|https?):\/\/)[\-\w@:%_\+.~#?,&\/\/=]+)/g);if(i)for(const s of i){const a=await e(s);c=c.replace(s,a)}return c}function jP(c,e,{width:i,height:s},a=!0){const h=`
<svg viewBox="0 0 ${i} ${s}" xmlns="http://www.w3.org/2000/svg">
    <style>
    ${e}
    </style>
    <foreignObject x="0" y="0" width="100%" height="100%">
        <div xmlns="http://www.w3.org/1999/xhtml" style="height: 100%; width: 100%; position: absolute: top:0; left:0">
            ${c}
        </div>
    </foreignObject>
</svg>
    `;return a?En(h):h}async function GN(c,e,i){const s=jP(c,e,i);return await mP(s,i)}async function HN(c,e,i){const s=jP(c,e,i);return await c3(s,i)}var zP,q0,Gl=function(c,e,i,s){var a,h=arguments.length,d=h<3?e:s===null?s=Object.getOwnPropertyDescriptor(e,i):s;if(typeof Reflect=="object"&&typeof Reflect.decorate=="function")d=Reflect.decorate(c,e,i,s);else for(var _=c.length-1;_>=0;_--)(a=c[_])&&(d=(h<3?a(d):h>3?a(e,i,d):a(e,i))||d);return h>3&&d&&Object.defineProperty(e,i,d),d};const rm=c=>({onChange:e=>{e.last&&c.onChange()}});let Fu=zP=class{constructor(){this.text="Custom Text",this.fontSize=100,this.width=1024,this.height=1024,this.xOffset=0,this.yOffset=0,this.boxWidth=1024,this.boxHeight=1024,this.fontFamily="",this.fontPath="",this.maskText=!1,this.innerShadow=!1,this.textColor="#000000",this.bgFillColor="#ffffff",this.svgBackground="#ffffff",this.onChange=()=>{}}set(c){Object.assign(this,c)}reset(){const c=this.onChange;Object.assign(this,new zP),this.onChange=c}toJSON(){return{text:this.text,fontFamily:this.fontFamily,fontPath:this.fontPath,svgBackground:this.svgBackground,width:this.width,height:this.height,xOffset:this.xOffset,yOffset:this.yOffset,boxWidth:this.boxWidth,boxHeight:this.boxHeight,fontSize:this.fontSize,maskText:this.maskText,innerShadow:this.innerShadow,bgFillColor:this.bgFillColor,textColor:this.textColor}}};Gl([qs("Text",rm)],Fu.prototype,"text",void 0),Gl([ss("Font Size",[2,400],1,rm)],Fu.prototype,"fontSize",void 0),Gl([ss("Width",[2,4096],1,rm)],Fu.prototype,"width",void 0),Gl([ss("Height",[2,4096],1,rm)],Fu.prototype,"height",void 0),Gl([ss("X Offset",[-1024,1024],1,rm)],Fu.prototype,"xOffset",void 0),Gl([ss("Y Offset",[-1024,1024],1,rm)],Fu.prototype,"yOffset",void 0),Gl([ss("V-Width",[2,4096],1,rm)],Fu.prototype,"boxWidth",void 0),Gl([ss("V-Height",[2,4096],1,rm)],Fu.prototype,"boxHeight",void 0),Gl([qs("Font",rm)],Fu.prototype,"fontFamily",void 0),Gl([qs("Font Url",rm)],Fu.prototype,"fontPath",void 0),Gl([ts("Mask Text",rm)],Fu.prototype,"maskText",void 0),Gl([ts("Inner Shadow",rm)],Fu.prototype,"innerShadow",void 0),Gl([cm("Text Color",rm)],Fu.prototype,"textColor",void 0),Gl([cm("BG Fill",rm)],Fu.prototype,"bgFillColor",void 0),Gl([cm("SVG BG",rm)],Fu.prototype,"svgBackground",void 0),Fu=zP=Gl([Ys("Text SVG Options")],Fu);const aO={woff:"woff",woff2:"woff2",ttf:"truetype",otf:"opentype",eot:"embedded-opentype"},vM=c=>({hidden:()=>{const e=c.getSelected();return!e||!e.userData[vv.PluginType]}});let vv=q0=class extends Ls{constructor(){super(),this.enabled=!0,this.getSelected=()=>{var c,e;return(e=(c=this._viewer)===null||c===void 0?void 0:c.getPluginByType("Picking"))===null||e===void 0?void 0:e.getSelectedObject()},this.options=new Fu,this.applyToMap=!0,this.applyToBumpMap=!1,this.applyToAlphaMap=!0,this.inverseAlphaMap=!1,this._lastMeta=void 0,this.fonts={roboto:"https://fonts.gstatic.com/s/roboto/v30/KFOmCnqEu92Fr1Mu4mxKKTU1Kg.woff2"},this._assetLoadOptions=void 0,this._selectedObjectChanged=this._selectedObjectChanged.bind(this),this.addTextToSelected=this.addTextToSelected.bind(this),this._paramsChanged=this._paramsChanged.bind(this),this.options.onChange=this._paramsChanged}async onAdded(c){var e;await super.onAdded(c),(e=c.getPluginByType("Picking"))===null||e===void 0||e.addEventListener("selectedObjectChanged",this._selectedObjectChanged)}_selectedObjectChanged(){var c,e,i,s,a,h;if(!this.enabled)return;const d=this.getSelected();if(!d)return void((e=(c=this.uiConfig).uiRefresh)===null||e===void 0||e.call(c,"postFrame",!0));const _=d.userData[q0.PluginType];if(!_)return this.options.reset(),this._lastMeta=void 0,void((s=(i=this.uiConfig).uiRefresh)===null||s===void 0||s.call(i,"postFrame",!0));this._lastMeta!==_&&(this.options.set(_),this._lastMeta=_),(h=(a=this.uiConfig).uiRefresh)===null||h===void 0||h.call(a,"postFrame",!0)}_paramsChanged(){if(!this.enabled)return;const c=this.getSelected();c&&c.isMesh&&c.userData[q0.PluginType]&&this.updateText(c,this.options.toJSON())}async addTextToSelected(){var c;const e=this.getSelected();e&&e.isMesh?e.material?(e.userData[q0.PluginType]||!e.material.map||await((c=this._viewer)===null||c===void 0?void 0:c.confirm("Add Text: This mesh already has a texture. Adding text will replace the texture. Continue?")))&&await this.addText(e):console.error("no material on mesh"):console.error("no mesh is selected")}async addText(c,e){return this.updateText(c,Object.assign(this.options.toJSON(),e))}async updateText(c,e){var i,s;if(!c.isMesh)return;if(!c.material)return void console.error("updateText: no material on mesh");let a=c.userData[q0.PluginType];a||(c.userData[q0.PluginType]=a={}),Object.assign(a,e);const h=c.material;h.map&&(h.map._isSimpleTextTexture&&h.map.dispose(),h.map=void 0),h.alphaMap&&(h.alphaMap._isSimpleTextTexture&&h.alphaMap.dispose(),h.alphaMap=void 0),h.bumpMap&&(h.bumpMap._isSimpleTextTexture&&h.bumpMap.dispose(),h.bumpMap=void 0);const d=await this.makeTextSvg(a);this.applyToMap&&(h.map=d),this.applyToAlphaMap&&(h.alphaMap=d,h.transparent=!0),this.applyToBumpMap&&(h.bumpMap=d),h.userData.inverseAlphaMap=this.inverseAlphaMap,h.setDirty(),h.needsUpdate=!0,(s=(i=this.uiConfig).uiRefresh)===null||s===void 0||s.call(i,"postFrame",!0)}async makeTextSvg(c){const e=c.fontFamily||"Arial",i=c.fontPath||this.fonts[e]||"";let s=c.style;if(i.length>0){const d=i.split("?")[0].split(".").pop()||"woff";s+=`
`+(i.length>0?`
            @font-face {
                font-family: ${e};
                src: url(${i}) format(${aO[d]||d});
            }`:"")}let a=function({text:d="Custom Text",svgBackground:_="#ffffff",xOffset:et=0,yOffset:nt=0,width:it=1024,height:lt=1024,boxWidth:ut=1024,boxHeight:pt=1024,fontFamily:gt="",fontSize:vt=32,maskText:Ct=!0,innerShadow:wt=!0,bgFillColor:xt="#000000",textColor:_t="#ffffff",style:Pt=""}){return`
<svg style="background-color:${_}" width="${it}" height="${lt}" viewBox="0 0 ${ut} ${pt}"
 xmlns="http://www.w3.org/2000/svg"
 xmlns:xlink="http://www.w3.org/1999/xlink">
     <defs>
        <style>
        ${Pt}
        </style>
    </defs>

    <g style="overflow:hidden; text-anchor: middle; font-size: ${vt}px; font-family: ${gt||"Arial"}">
        <defs>

`+(Ct?`
<mask id="textMask">
<text style="fill:white; font-size: ${vt}px;" x="${et+ut/2}" y="${pt/2+nt+vt/4}" > ${d} </text>
</mask>
`:"")+`

`+(wt?`
<filter id="innerShadow" x="-20%" y="-20%" width="140%" height="140%">
<feGaussianBlur in="SourceGraphic" stdDeviation="0.5" result="blur"/>
<feOffset in="blur" dx="1.5" dy="1.5"/>
</filter>
`:"")+`

        </defs>

`+(Ct?`
        <g mask="url(#textMask)">
`:"")+`

        <rect x="0" y="0" width="${ut}" height="${pt}" style="fill:${xt}"/>
        <text style="${wt?"filter: url(#innerShadow);":""} fill:${_t};" x="${et+ut/2}" y="${pt/2+nt+vt/4}"> ${d} </text>

`+(Ct?`
        </g>
`:"")+`

    </g>
</svg>
`}({...c,fontFamily:e,style:s});a=await oO(a,async d=>this._getAssetData(d)),a=En(a);const h=await this._viewer.getManager().importer.importSinglePath(a,{generateMipmaps:!1,minFilter:b.wem});return h._isSimpleTextTexture=!0,h.flipY=!1,h.needsUpdate=!0,h}async _getAssetData(c){var e,i;if(c.startsWith("http://www.w3.org"))return c;const s=(i=(e=this._viewer)===null||e===void 0?void 0:e.getManager())===null||i===void 0?void 0:i.importer;if(!s)throw new Error("no importer");this._assetLoadOptions=this._assetLoadOptions||{fileHandler:new fI(s.loadingManager),processImported:!1};try{return await s.importPath(c,this._assetLoadOptions)}catch(a){return console.error(a),""}}};vv.PluginType="SimpleTextPlugin",Gl([eu(void 0,{params:vM})],vv.prototype,"options",void 0),Gl([ts("Apply Map",vM),pn(q0.prototype._paramsChanged)],vv.prototype,"applyToMap",void 0),Gl([ts("Apply Bump Map",vM),pn(q0.prototype._paramsChanged)],vv.prototype,"applyToBumpMap",void 0),Gl([ts("Apply Alpha Map",vM),pn(q0.prototype._paramsChanged)],vv.prototype,"applyToAlphaMap",void 0),Gl([ts("Invert Alpha Map",vM),pn(q0.prototype._paramsChanged)],vv.prototype,"inverseAlphaMap",void 0),Gl([uo("Add Text",c=>({hidden:()=>!c.getSelected()}))],vv.prototype,"addTextToSelected",null),vv=q0=Gl([Ys("Simple Text")],vv);class VP{constructor(e){this.top=0,this.array=new Float32Array(e)}write(e){this.array[this.top++]=e.x,this.array[this.top++]=e.y,this.array[this.top++]=e.z}}class WN{constructor(e){this.top=0,this.array=new Float32Array(e)}write(e){this.array[this.top++]=e.x,this.array[this.top++]=e.y}}class W_{constructor(e){this.plane=null,this.front=null,this.back=null,this.polygons=[],e&&this.build(e)}clone(){const e=new W_;return e.plane=this.plane&&this.plane.clone(),e.front=this.front&&this.front.clone(),e.back=this.back&&this.back.clone(),e.polygons=this.polygons.map(i=>i.clone()),e}invert(){for(let i=0;i<this.polygons.length;i++)this.polygons[i].flip();this.plane&&this.plane.flip(),this.front&&this.front.invert(),this.back&&this.back.invert();const e=this.front;this.front=this.back,this.back=e}clipPolygons(e){if(!this.plane)return e.slice();let i=new Array,s=new Array;for(let a=0;a<e.length;a++)this.plane.splitPolygon(e[a],i,s,i,s);return this.front&&(i=this.front.clipPolygons(i)),s=this.back?this.back.clipPolygons(s):[],i.concat(s)}clipTo(e){this.polygons=e.clipPolygons(this.polygons),this.front&&this.front.clipTo(e),this.back&&this.back.clipTo(e)}allPolygons(){let e=this.polygons.slice();return this.front&&(e=e.concat(this.front.allPolygons())),this.back&&(e=e.concat(this.back.allPolygons())),e}build(e){if(!e.length)return;this.plane||(this.plane=e[0].plane.clone());const i=[],s=[];for(let a=0;a<e.length;a++)this.plane.splitPolygon(e[a],this.polygons,this.polygons,i,s);i.length&&(this.front||(this.front=new W_),this.front.build(i)),s.length&&(this.back||(this.back=new W_),this.back.build(s))}}class Rm{constructor(e=0,i=0,s=0){this.x=e,this.y=i,this.z=s}copy(e){return this.x=e.x,this.y=e.y,this.z=e.z,this}clone(){return new Rm(this.x,this.y,this.z)}negate(){return this.x*=-1,this.y*=-1,this.z*=-1,this}add(e){return this.x+=e.x,this.y+=e.y,this.z+=e.z,this}sub(e){return this.x-=e.x,this.y-=e.y,this.z-=e.z,this}times(e){return this.x*=e,this.y*=e,this.z*=e,this}dividedBy(e){return this.x/=e,this.y/=e,this.z/=e,this}lerp(e,i){return this.add(new Rm().copy(e).sub(this).times(i))}unit(){return this.dividedBy(this.length())}length(){return Math.sqrt(Math.pow(this.x,2)+Math.pow(this.y,2)+Math.pow(this.z,2))}normalize(){return this.unit()}cross(e){const i=this.clone(),s=i.x,a=i.y,h=i.z,d=e.x,_=e.y,et=e.z;return this.x=a*et-h*_,this.y=h*d-s*et,this.z=s*_-a*d,this}dot(e){return this.x*e.x+this.y*e.y+this.z*e.z}toVector3(){return new b.Pa4(this.x,this.y,this.z)}}class d1{constructor(e,i){this.normal=e,this.w=i,this.normal=e,this.w=i}clone(){return new d1(this.normal.clone(),this.w)}flip(){this.normal.negate(),this.w=-this.w}splitPolygon(e,i,s,a,h){let d=0;const _=[];for(let et=0;et<e.vertices.length;et++){const nt=this.normal.dot(e.vertices[et].pos)-this.w,it=nt<-d1.EPSILON?2:nt>d1.EPSILON?1:0;d|=it,_.push(it)}switch(d){case 0:(this.normal.dot(e.plane.normal)>0?i:s).push(e);break;case 1:a.push(e);break;case 2:h.push(e);break;case 3:{const et=[],nt=[];for(let it=0;it<e.vertices.length;it++){const lt=(it+1)%e.vertices.length,ut=_[it],pt=_[lt],gt=e.vertices[it],vt=e.vertices[lt];if(ut!=2&&et.push(gt),ut!=1&&nt.push(ut!=2?gt.clone():gt),(ut|pt)==3){const Ct=(this.w-this.normal.dot(gt.pos))/this.normal.dot(new Rm().copy(vt.pos).sub(gt.pos)),wt=gt.interpolate(vt,Ct);et.push(wt),nt.push(wt.clone())}}et.length>=3&&a.push(new gS(et,e.shared)),nt.length>=3&&h.push(new gS(nt,e.shared));break}}}static fromPoints(e,i,s){const a=new Rm().copy(i).sub(e).cross(new Rm().copy(s).sub(e)).normalize();return new d1(a.clone(),a.dot(e))}}d1.EPSILON=1e-5;class gS{constructor(e,i){this.vertices=e,this.shared=i,this.plane=d1.fromPoints(e[0].pos,e[1].pos,e[2].pos)}clone(){return new gS(this.vertices.map(e=>e.clone()),this.shared)}flip(){this.vertices.reverse().map(e=>e.flip()),this.plane.flip()}}class m2{constructor(e,i,s,a){this.pos=new Rm().copy(e),this.normal=new Rm().copy(i),this.uv=new Rm().copy(s),this.uv.z=0,a&&(this.color=new Rm().copy(a))}clone(){return new m2(this.pos,this.normal,this.uv,this.color)}flip(){this.normal.negate()}interpolate(e,i){return new m2(this.pos.clone().lerp(e.pos,i),this.normal.clone().lerp(e.normal,i),this.uv.clone().lerp(e.uv,i),this.color&&e.color&&this.color.clone().lerp(e.color,i))}}class _c{constructor(){this.polygons=new Array}static fromPolygons(e){const i=new _c;return i.polygons=e,i}static fromGeometry(e,i){let s=[];const a=e.attributes.position,h=e.attributes.normal,d=e.attributes.uv,_=e.attributes.color,et=e.groups;let nt;if(e.index)nt=e.index.array;else{nt=new Array(a.array.length/a.itemSize|0);for(let lt=0;lt<nt.length;lt++)nt[lt]=lt}const it=nt.length/3|0;s=new Array(it);for(let lt=0,ut=0,pt=nt.length;lt<pt;lt+=3,ut++){const gt=new Array(3);for(let vt=0;vt<3;vt++){const Ct=nt[lt+vt],wt=3*Ct,xt=2*Ct,_t=a.array[wt],Pt=a.array[wt+1],Bt=a.array[wt+2],Ot=h.array[wt],Lt=h.array[wt+1],qt=h.array[wt+2],en=d==null?void 0:d.array[xt],cn=d==null?void 0:d.array[xt+1];gt[vt]=new m2(new Rm(_t,Pt,Bt),new Rm(Ot,Lt,qt),new Rm(en,cn,0),_&&new Rm(_.array[xt],_.array[xt+1],_.array[xt+2]))}if(i===void 0&&et&&et.length>0)for(const vt of et)lt>=vt.start&&lt<vt.start+vt.count&&(s[ut]=new gS(gt,vt.materialIndex));else s[ut]=new gS(gt,i)}return _c.fromPolygons(s.filter(lt=>!isNaN(lt.plane.normal.x)))}static toGeometry(e,i){let s=0;const a=e.polygons;for(const pt of a)s+=pt.vertices.length-2;const h=new b.u9r,d=new VP(3*s*3),_=new VP(3*s*3),et=new WN(2*s*3);let nt;const it=[],lt=[];for(const pt of a){const gt=pt.vertices,vt=gt.length;pt.shared!==void 0&&(it[pt.shared]||(it[pt.shared]=[])),vt&&gt[0].color!==void 0&&(nt||(nt=new VP(3*s*3)));for(let Ct=3;Ct<=vt;Ct++)(pt.shared===void 0?lt:it[pt.shared]).push(d.top/3,d.top/3+1,d.top/3+2),d.write(gt[0].pos),d.write(gt[Ct-2].pos),d.write(gt[Ct-1].pos),_.write(gt[0].normal),_.write(gt[Ct-2].normal),_.write(gt[Ct-1].normal),et&&(et.write(gt[0].uv),et.write(gt[Ct-2].uv),et.write(gt[Ct-1].uv)),nt&&(nt.write(gt[0].color),nt.write(gt[Ct-2].color),nt.write(gt[Ct-1].color))}h.setAttribute("position",new b.TlE(d.array,3)),h.setAttribute("normal",new b.TlE(_.array,3)),et&&h.setAttribute("uv",new b.TlE(et.array,2)),nt&&h.setAttribute("color",new b.TlE(nt.array,3));for(let pt=0;pt<it.length;pt++)it[pt]===void 0&&(it[pt]=[]);if(it.length){let pt=[],gt=0;for(let vt=0;vt<it.length;vt++)h.addGroup(gt,it[vt].length,vt),gt+=it[vt].length,pt=pt.concat(it[vt]);h.addGroup(gt,lt.length,it.length),pt=pt.concat(lt),h.setIndex(pt)}const ut=new b.yGw().copy(i).invert();return h.applyMatrix4(ut),h.computeBoundingSphere(),h.computeBoundingBox(),h}static fromMesh(e,i){const s=_c.fromGeometry(e.geometry,i),a=new b.Pa4,h=new b.Vkp;h.getNormalMatrix(e.matrix);for(let d=0;d<s.polygons.length;d++){const _=s.polygons[d];for(let et=0;et<_.vertices.length;et++){const nt=_.vertices[et];nt.pos.copy(a.copy(nt.pos.toVector3()).applyMatrix4(e.matrix)),nt.normal.copy(a.copy(nt.normal.toVector3()).applyMatrix3(h))}}return s}static toMesh(e,i,s){const a=_c.toGeometry(e,i),h=new b.Kj0(a,s);return h.matrix.copy(i),h.matrix.decompose(h.position,h.quaternion,h.scale),h.rotation.setFromQuaternion(h.quaternion),h.updateMatrixWorld(),h.castShadow=h.receiveShadow=!0,h}static union(e,i){const s=_c.fromMesh(e),a=_c.fromMesh(i);return _c.toMesh(s.union(a),e.matrix,e.material)}static subtract(e,i){const s=_c.fromMesh(e),a=_c.fromMesh(i);return _c.toMesh(s.subtract(a),e.matrix,e.material)}static intersect(e,i){const s=_c.fromMesh(e),a=_c.fromMesh(i);return _c.toMesh(s.intersect(a),e.matrix,e.material)}clone(){const e=new _c;return e.polygons=this.polygons.map(i=>i.clone()).filter(i=>Number.isFinite(i.plane.w)),e}toPolygons(){return this.polygons}union(e){const i=new W_(this.clone().polygons),s=new W_(e.clone().polygons);return i.clipTo(s),s.clipTo(i),s.invert(),s.clipTo(i),s.invert(),i.build(s.allPolygons()),_c.fromPolygons(i.allPolygons())}subtract(e){const i=new W_(this.clone().polygons),s=new W_(e.clone().polygons);return i.invert(),i.clipTo(s),s.clipTo(i),s.invert(),s.clipTo(i),s.invert(),i.build(s.allPolygons()),i.invert(),_c.fromPolygons(i.allPolygons())}intersect(e){const i=new W_(this.clone().polygons),s=new W_(e.clone().polygons);return i.invert(),s.clipTo(i),s.invert(),i.clipTo(s),s.clipTo(i),i.build(s.allPolygons()),i.invert(),_c.fromPolygons(i.allPolygons())}inverse(){const e=this.clone();for(const i of e.polygons)i.flip();return e}toMesh(e,i){return _c.toMesh(this,e,i)}toGeometry(e){return _c.toGeometry(this,e)}}var vS=function(c,e,i,s){var a,h=arguments.length,d=h<3?e:s===null?s=Object.getOwnPropertyDescriptor(e,i):s;if(typeof Reflect=="object"&&typeof Reflect.decorate=="function")d=Reflect.decorate(c,e,i,s);else for(var _=c.length-1;_>=0;_--)(a=c[_])&&(d=(h<3?a(d):h>3?a(e,i,d):a(e,i))||d);return h>3&&d&&Object.defineProperty(e,i,d),d};const QP=["union","subtract","intersect"];class dy extends Ls{constructor(){super(),this.enabled=!0,this.toJSON=void 0,this.dependencies=[ro],this.rootMesh=new b.Kj0,this.showResult=!1,this.csgSelectedEnabled=!1,this.csgSelectedOperation="union",this._csgNeedsUpdate=!1,this._csgVisible=!1,this._sceneUpdate=this._sceneUpdate.bind(this),this._preFrame=this._preFrame.bind(this),this.makeSelectedCSGBrush=this.makeSelectedCSGBrush.bind(this),this.refreshCSG=this.refreshCSG.bind(this),this._selectedObjectChanged=this._selectedObjectChanged.bind(this),this._updateSelectedProperties=this._updateSelectedProperties.bind(this),this.downloadObject=this.downloadObject.bind(this),this.exportObject=this.exportObject.bind(this)}async onAdded(e){var i;await super.onAdded(e),this.rootObject=await e.createObject3D(),this.rootObject.modelObject.add(this.rootMesh),e.scene.addEventListener("sceneUpdate",this._sceneUpdate),e.addEventListener("preFrame",this._preFrame),(i=e.getPlugin(ro))===null||i===void 0||i.addEventListener("selectedObjectChanged",this._selectedObjectChanged)}async makeSelectedCSGBrush(){var e,i;const s=(i=(e=this._viewer)===null||e===void 0?void 0:e.getPlugin(ro))===null||i===void 0?void 0:i.getSelectedObject();s&&s.geometry&&(s.userData._isCSGMesh||(s.userData.csgBrush||(s.userData.csgBrush={enabled:!0,operation:"union"}),this._selectedObjectChanged()))}refreshCSG(){this._sceneUpdate()}async downloadObject(){const e=await this.exportObject();e&&Do(e,"csg."+e.ext)}async exportObject(){var e,i;const s=(i=(e=this._viewer)===null||e===void 0?void 0:e.getPluginByType("AssetExporterPlugin"))===null||i===void 0?void 0:i.exporter;if(!s||!this.rootObject)return;const a=this.rootMesh.visible;this.rootMesh.visible=!0;const h=await s.exportObject(this.rootObject.modelObject,{});return this.rootMesh.visible=a,h}_updateSelectedProperties(){var e,i;const s=(i=(e=this._viewer)===null||e===void 0?void 0:e.getPlugin(ro))===null||i===void 0?void 0:i.getSelectedObject();s&&s.userData.csgBrush&&(s.userData.csgBrush.enabled=this.csgSelectedEnabled,s.userData.csgBrush.operation=this.csgSelectedOperation)}_selectedObjectChanged(){var e,i,s,a,h,d,_,et;const nt=(i=(e=this._viewer)===null||e===void 0?void 0:e.getPlugin(ro))===null||i===void 0?void 0:i.getSelectedObject();nt&&(this.csgSelectedEnabled=(a=(s=nt.userData.csgBrush)===null||s===void 0?void 0:s.enabled)!==null&&a!==void 0&&a,this.csgSelectedOperation=(d=(h=nt.userData.csgBrush)===null||h===void 0?void 0:h.operation)!==null&&d!==void 0?d:"union"),(et=(_=this.uiConfig)===null||_===void 0?void 0:_.uiRefresh)===null||et===void 0||et.call(_,"postFrame",!0)}_preFrame(){var e,i,s;if(!this.rootObject||!this._csgNeedsUpdate&&this._csgVisible===this.showResult)return;const a=this._findCSGMeshes();this._csgNeedsUpdate&&(this._csgNeedsUpdate=!1,(e=this.rootObject)===null||e===void 0||e.modelObject.updateMatrixWorld(!0),((i=this.rootMesh.userData.dispose)!==null&&i!==void 0?i:this.rootMesh.removeFromParent)(),this.rootMesh=this._buildCSGMesh(a)),this.rootMesh&&!this.rootMesh.parent&&((s=this.rootObject)===null||s===void 0||s.modelObject.add(this.rootMesh)),this.showResult?(a.forEach(h=>{h[0].visible=!1}),this.rootObject.visible=!0,this._csgVisible=!0,this.rootObject.setDirty()):(a.forEach(h=>{h[0].visible=!0}),this.rootObject.visible=!1,this._csgVisible=!1,this.rootObject.setDirty())}_findCSGMeshes(){var e;const i=[];return(e=this._viewer)===null||e===void 0||e.scene.traverse(s=>{var a;s.isMesh&&s.geometry&&(!((a=s.userData.csgBrush)===null||a===void 0)&&a.enabled)&&i.push([s,s.userData.csgBrush.operation])}),i}_sceneUpdate(e){var i,s;!((s=(i=e==null?void 0:e.object)===null||i===void 0?void 0:i.userData)===null||s===void 0)&&s._isCSGMesh||(this._csgNeedsUpdate=!0)}}vS([ts("Show Result",c=>({onChange:()=>{var e;return(e=c._viewer)===null||e===void 0?void 0:e.setDirty()}}))],dy.prototype,"showResult",void 0),vS([uo("Make CSG Brush",c=>({hidden:()=>{var e,i;const s=(i=(e=c._viewer)===null||e===void 0?void 0:e.getPlugin(ro))===null||i===void 0?void 0:i.getSelectedObject();return!(s!=null&&s.userData)||!!s.userData.csgBrush||s.userData._isCSGMesh}}))],dy.prototype,"makeSelectedCSGBrush",null),vS([ts("Enabled",c=>({hidden:()=>{var e,i;const s=(i=(e=c._viewer)===null||e===void 0?void 0:e.getPlugin(ro))===null||i===void 0?void 0:i.getSelectedObject();return!s||!s.userData.csgBrush},onChange:c._updateSelectedProperties}))],dy.prototype,"csgSelectedEnabled",void 0),vS([xv("Operation",QP.map(c=>({label:c})),c=>({hidden:()=>{var e,i;const s=(i=(e=c._viewer)===null||e===void 0?void 0:e.getPlugin(ro))===null||i===void 0?void 0:i.getSelectedObject();return!s||!s.userData.csgBrush},onChange:c._updateSelectedProperties}))],dy.prototype,"csgSelectedOperation",void 0),vS([uo("Refresh CSG")],dy.prototype,"refreshCSG",null),vS([uo("Export Result",c=>({hidden:()=>{var e;return!(!((e=c._viewer)===null||e===void 0)&&e.getPluginByType("AssetExporterPlugin"))}}))],dy.prototype,"downloadObject",null);function lO(c,e){let i=new _c;const s=c.map(h=>h[0].material).flatMap(h=>h);c.forEach(([h,d])=>{if(!QP.includes(d))return void console.error(`Unknown operation ${d}`);h.updateMatrix(),h.updateMatrixWorld();const _=h.matrix;h.matrix=h.matrixWorld;let et=0;et=Array.isArray(h.material)?void 0:s.indexOf(h.material),i=i[d](_c.fromMesh(h,et)),h.matrix=_});const a=i.toMesh(e??new b.yGw().identity(),s);return a.userData._isCSGMesh=!0,a.geometry.groups=a.geometry.groups.filter(h=>h.count>0),a}let g2=class extends dy{_buildCSGMesh(c){return lO(c)}};g2.PluginType="CSGPluginBSP",g2=function(c,e,i,s){var a,h=arguments.length,d=h<3?e:s===null?s=Object.getOwnPropertyDescriptor(e,i):s;if(typeof Reflect=="object"&&typeof Reflect.decorate=="function")d=Reflect.decorate(c,e,i,s);else for(var _=c.length-1;_>=0;_--)(a=c[_])&&(d=(h<3?a(d):h>3?a(e,i,d):a(e,i))||d);return h>3&&d&&Object.defineProperty(e,i,d),d}([Ys("CSG Plugin (BSP)")],g2);class q_{constructor(){this.min=1/0,this.max=-1/0}setFromPointsField(e,i){let s=1/0,a=-1/0;for(let h=0,d=e.length;h<d;h++){const _=e[h][i];s=_<s?_:s,a=_>a?_:a}this.min=s,this.max=a}setFromPoints(e,i){let s=1/0,a=-1/0;for(let h=0,d=i.length;h<d;h++){const _=i[h],et=e.dot(_);s=et<s?et:s,a=et>a?et:a}this.min=s,this.max=a}isSeparated(e){return this.min>e.max||e.min>this.max}}q_.prototype.setFromBox=function(){const c=new b.Pa4;return function(e,i){const s=i.min,a=i.max;let h=1/0,d=-1/0;for(let _=0;_<=1;_++)for(let et=0;et<=1;et++)for(let nt=0;nt<=1;nt++){c.x=s.x*_+a.x*(1-_),c.y=s.y*et+a.y*(1-et),c.z=s.z*nt+a.z*(1-nt);const it=e.dot(c);h=Math.min(it,h),d=Math.max(it,d)}this.min=h,this.max=d}}(),new q_;const qN=function(){const c=new b.Pa4,e=new b.Pa4,i=new b.Pa4;return function(s,a,h){const d=s.start,_=c,et=a.start,nt=e;i.subVectors(d,et),c.subVectors(s.end,a.start),e.subVectors(a.end,a.start);const it=i.dot(nt),lt=nt.dot(_),ut=nt.dot(nt),pt=i.dot(_),gt=_.dot(_)*ut-lt*lt;let vt,Ct;vt=gt!==0?(it*lt-pt*ut)/gt:0,Ct=(it+vt*lt)/ut,h.x=vt,h.y=Ct}}(),GP=function(){const c=new b.FM8,e=new b.Pa4,i=new b.Pa4;return function(s,a,h,d){qN(s,a,c);let _=c.x,et=c.y;if(_>=0&&_<=1&&et>=0&&et<=1)return s.at(_,h),void a.at(et,d);if(_>=0&&_<=1)return et<0?a.at(0,d):a.at(1,d),void s.closestPointToPoint(d,!0,h);if(et>=0&&et<=1)return _<0?s.at(0,h):s.at(1,h),void a.closestPointToPoint(h,!0,d);{let nt,it;nt=_<0?s.start:s.end,it=et<0?a.start:a.end;const lt=e,ut=i;return s.closestPointToPoint(it,!0,e),a.closestPointToPoint(nt,!0,i),lt.distanceToSquared(it)<=ut.distanceToSquared(nt)?(h.copy(lt),void d.copy(it)):(h.copy(nt),void d.copy(ut))}}}(),YN=function(){const c=new b.Pa4,e=new b.Pa4,i=new b.JOQ,s=new b.Zzh;return function(a,h){const{radius:d,center:_}=a,{a:et,b:nt,c:it}=h;if(s.start=et,s.end=nt,s.closestPointToPoint(_,!0,c).distanceTo(_)<=d||(s.start=et,s.end=it,s.closestPointToPoint(_,!0,c).distanceTo(_)<=d)||(s.start=nt,s.end=it,s.closestPointToPoint(_,!0,c).distanceTo(_)<=d))return!0;const lt=h.getPlane(i);if(Math.abs(lt.distanceToPoint(_))<=d){const ut=lt.projectPoint(_,e);if(h.containsPoint(ut))return!0}return!1}}();function _S(c){return Math.abs(c)<1e-15}class Y_ extends b.CJI{constructor(...e){super(...e),this.isExtendedTriangle=!0,this.satAxes=new Array(4).fill().map(()=>new b.Pa4),this.satBounds=new Array(4).fill().map(()=>new q_),this.points=[this.a,this.b,this.c],this.sphere=new b.aLr,this.plane=new b.JOQ,this.needsUpdate=!0}intersectsSphere(e){return YN(e,this)}update(){const e=this.a,i=this.b,s=this.c,a=this.points,h=this.satAxes,d=this.satBounds,_=h[0],et=d[0];this.getNormal(_),et.setFromPoints(_,a);const nt=h[1],it=d[1];nt.subVectors(e,i),it.setFromPoints(nt,a);const lt=h[2],ut=d[2];lt.subVectors(i,s),ut.setFromPoints(lt,a);const pt=h[3],gt=d[3];pt.subVectors(s,e),gt.setFromPoints(pt,a),this.sphere.setFromPoints(this.points),this.plane.setFromNormalAndCoplanarPoint(_,e),this.needsUpdate=!1}}Y_.prototype.closestPointToSegment=function(){const c=new b.Pa4,e=new b.Pa4,i=new b.Zzh;return function(s,a=null,h=null){const{start:d,end:_}=s,et=this.points;let nt,it=1/0;for(let lt=0;lt<3;lt++){const ut=(lt+1)%3;i.start.copy(et[lt]),i.end.copy(et[ut]),GP(i,s,c,e),nt=c.distanceToSquared(e),nt<it&&(it=nt,a&&a.copy(c),h&&h.copy(e))}return this.closestPointToPoint(d,c),nt=d.distanceToSquared(c),nt<it&&(it=nt,a&&a.copy(c),h&&h.copy(d)),this.closestPointToPoint(_,c),nt=_.distanceToSquared(c),nt<it&&(it=nt,a&&a.copy(c),h&&h.copy(_)),Math.sqrt(it)}}(),Y_.prototype.intersectsTriangle=function(){const c=new Y_,e=new Array(3),i=new Array(3),s=new q_,a=new q_,h=new b.Pa4,d=new b.Pa4,_=new b.Pa4,et=new b.Pa4,nt=new b.Zzh,it=new b.Zzh,lt=new b.Zzh;return function(ut,pt=null){this.needsUpdate&&this.update(),ut.isExtendedTriangle?ut.needsUpdate&&ut.update():(c.copy(ut),c.update(),ut=c);const gt=this.plane,vt=ut.plane;if(Math.abs(gt.normal.dot(vt.normal))>1-1e-10){const Ct=this.satBounds,wt=this.satAxes;i[0]=ut.a,i[1]=ut.b,i[2]=ut.c;for(let Pt=0;Pt<4;Pt++){const Bt=Ct[Pt],Ot=wt[Pt];if(s.setFromPoints(Ot,i),Bt.isSeparated(s))return!1}const xt=ut.satBounds,_t=ut.satAxes;e[0]=this.a,e[1]=this.b,e[2]=this.c;for(let Pt=0;Pt<4;Pt++){const Bt=xt[Pt],Ot=_t[Pt];if(s.setFromPoints(Ot,e),Bt.isSeparated(s))return!1}for(let Pt=0;Pt<4;Pt++){const Bt=wt[Pt];for(let Ot=0;Ot<4;Ot++){const Lt=_t[Ot];if(h.crossVectors(Bt,Lt),s.setFromPoints(h,e),a.setFromPoints(h,i),s.isSeparated(a))return!1}}return pt&&(console.warn("ExtendedTriangle.intersectsTriangle: Triangles are coplanar which does not support an output edge. Setting edge to 0, 0, 0."),pt.start.set(0,0,0),pt.end.set(0,0,0)),!0}{const Ct=this.points;let wt=!1,xt=0;for(let mn=0;mn<3;mn++){const Tn=Ct[mn],vn=Ct[(mn+1)%3];nt.start.copy(Tn),nt.end.copy(vn),nt.delta(d);const xn=wt?it.start:it.end,Un=_S(vt.distanceToPoint(Tn));if(_S(vt.normal.dot(d))&&Un){it.copy(nt),xt=2;break}if((vt.intersectLine(nt,xn)||Un)&&!_S(xn.distanceTo(vn))){if(xt++,wt)break;wt=!0}}if(xt===1&&this.containsPoint(it.start))return pt&&(pt.start.copy(it.start),pt.end.copy(it.start)),!0;if(xt!==2)return!1;const _t=ut.points;let Pt=!1,Bt=0;for(let mn=0;mn<3;mn++){const Tn=_t[mn],vn=_t[(mn+1)%3];nt.start.copy(Tn),nt.end.copy(vn),nt.delta(_);const xn=Pt?lt.start:lt.end,Un=_S(gt.distanceToPoint(Tn));if(_S(gt.normal.dot(_))&&Un){lt.copy(nt),Bt=2;break}if((gt.intersectLine(nt,xn)||Un)&&!_S(xn.distanceTo(vn))){if(Bt++,Pt)break;Pt=!0}}if(Bt===1&&this.containsPoint(lt.start))return pt&&(pt.start.copy(lt.start),pt.end.copy(lt.start)),!0;if(Bt!==2)return!1;if(it.delta(d),lt.delta(_),d.dot(_)<0){let mn=lt.start;lt.start=lt.end,lt.end=mn}const Ot=it.start.dot(d),Lt=it.end.dot(d),qt=lt.start.dot(d),en=lt.end.dot(d),cn=Lt<qt,An=Ot<en;return(Ot===en||qt===Lt||cn!==An)&&(pt&&(et.subVectors(it.start,lt.start),et.dot(d)>0?pt.start.copy(it.start):pt.start.copy(lt.start),et.subVectors(it.end,lt.end),et.dot(d)<0?pt.end.copy(it.end):pt.end.copy(lt.end)),!0)}}}(),Y_.prototype.distanceToPoint=function(){const c=new b.Pa4;return function(e){return this.closestPointToPoint(e,c),e.distanceTo(c)}}(),Y_.prototype.distanceToTriangle=function(){const c=new b.Pa4,e=new b.Pa4,i=["a","b","c"],s=new b.Zzh,a=new b.Zzh;return function(h,d=null,_=null){const et=d||_?s:null;if(this.intersectsTriangle(h,et))return(d||_)&&(d&&et.getCenter(d),_&&et.getCenter(_)),0;let nt=1/0;for(let it=0;it<3;it++){let lt;const ut=i[it],pt=h[ut];this.closestPointToPoint(pt,c),lt=pt.distanceToSquared(c),lt<nt&&(nt=lt,d&&d.copy(c),_&&_.copy(pt));const gt=this[ut];h.closestPointToPoint(gt,c),lt=gt.distanceToSquared(c),lt<nt&&(nt=lt,d&&d.copy(gt),_&&_.copy(c))}for(let it=0;it<3;it++){const lt=i[it],ut=i[(it+1)%3];s.set(this[lt],this[ut]);for(let pt=0;pt<3;pt++){const gt=i[pt],vt=i[(pt+1)%3];a.set(h[gt],h[vt]),GP(s,a,c,e);const Ct=c.distanceToSquared(e);Ct<nt&&(nt=Ct,d&&d.copy(c),_&&_.copy(e))}}return Math.sqrt(nt)}}();class cO{constructor(){this.intersectionSet={},this.ids=[]}add(e,i){const{intersectionSet:s,ids:a}=this;s[e]||(s[e]=[],a.push(e)),s[e].push(i)}}const p1=new b.zHn,uO=new b.yGw,sm=new b.CJI,py=new b.Pa4,hO=new b.Ltg,dO=new b.Ltg,pO=new b.Ltg,HP=new b.Ltg,v2=new b.Ltg,_2=new b.Ltg,WP=new b.Zzh,qP=1e-8;let A2=null;function fO(c){A2=c}function mO(c,e){function i(){return Math.random()-.5}p1.origin.copy(c.a).add(c.b).add(c.c).multiplyScalar(1/3),c.getNormal(p1.direction);let s=0,a=1/0;for(let h=0;h<3;h++){p1.direction.x+=i()*qP,p1.direction.y+=i()*qP,p1.direction.z+=i()*qP;const d=e.raycastFirst(p1,b.ehD);if(Boolean(d&&p1.direction.dot(d.face.normal)>0)&&s++,d!==null&&(a=Math.min(a,d.distance)),a===0||s/3>.5||(h-s+1)/3>.5)break}return a===0?0:s/3>.5?-1:1}function gO(c,e,i,s,a,h,d=!1){const _=i.attributes,et=i.index,nt=3*c,it=et.getX(nt+0),lt=et.getX(nt+1),ut=et.getX(nt+2);for(const pt in h){const gt=_[pt],vt=h[pt];if(!(pt in _))throw new Error(`CSG Operations: Attribute ${pt} not available on geometry.`);const Ct=gt.itemSize;pt==="position"?(sm.a.fromBufferAttribute(gt,it).applyMatrix4(s),sm.b.fromBufferAttribute(gt,lt).applyMatrix4(s),sm.c.fromBufferAttribute(gt,ut).applyMatrix4(s),YP(sm.a,sm.b,sm.c,e,3,vt,d)):pt==="normal"?(sm.a.fromBufferAttribute(gt,it).applyNormalMatrix(a),sm.b.fromBufferAttribute(gt,lt).applyNormalMatrix(a),sm.c.fromBufferAttribute(gt,ut).applyNormalMatrix(a),d&&(sm.a.multiplyScalar(-1),sm.b.multiplyScalar(-1),sm.c.multiplyScalar(-1)),YP(sm.a,sm.b,sm.c,e,3,vt,d,!0)):(hO.fromBufferAttribute(gt,it),dO.fromBufferAttribute(gt,lt),pO.fromBufferAttribute(gt,ut),YP(hO,dO,pO,e,Ct,vt,d))}}function vO(c,e,i,s,a,h,d,_=!1){XP(c,s,a,h,d,_),XP(e,s,a,h,d,_),XP(i,s,a,h,d,_)}function _O(c,e,i=!1){switch(c){case 0:if(e===1||e===0&&i)return 1;break;case 1:if(i){if(e===-1)return 0}else if(e===1)return 1;break;case 3:if(e===-1)return 0;if(e===1)return 1;case 4:if(e===-1||e===0&&i)return 1;break;default:throw new Error(`Unrecognized CSG operation enum "${c}".`)}return 2}function YP(c,e,i,s,a,h,d=!1,_=!1){const et=nt=>{h.push(nt.x),a>1&&h.push(nt.y),a>2&&h.push(nt.z),a>3&&h.push(nt.w)};HP.set(0,0,0,0).addScaledVector(c,s.a.x).addScaledVector(e,s.a.y).addScaledVector(i,s.a.z),v2.set(0,0,0,0).addScaledVector(c,s.b.x).addScaledVector(e,s.b.y).addScaledVector(i,s.b.z),_2.set(0,0,0,0).addScaledVector(c,s.c.x).addScaledVector(e,s.c.y).addScaledVector(i,s.c.z),_&&(HP.normalize(),v2.normalize(),_2.normalize()),et(HP),d?(et(_2),et(v2)):(et(v2),et(_2))}function XP(c,e,i,s,a,h=!1){for(const d in a){const _=e[d],et=a[d];if(!(d in e))throw new Error(`CSG Operations: Attribute ${d} no available on geometry.`);const nt=_.itemSize;d==="position"?(py.fromBufferAttribute(_,c).applyMatrix4(i),et.push(py.x,py.y,py.z)):d==="normal"?(py.fromBufferAttribute(_,c).applyNormalMatrix(s),h&&py.multiplyScalar(-1),et.push(py.x,py.y,py.z)):(et.push(_.getX(c)),nt>1&&et.push(_.getY(c)),nt>2&&et.push(_.getZ(c)),nt>3&&et.push(_.getW(c)))}}const Tw=1e-14,y2=1e-7,X_=new b.Zzh,du=new b.Zzh,Y0=new b.Pa4,AO=new b.Pa4,_M=new b.JOQ,XN=new Y_;function AM(c){return c.a.distanceToSquared(c.b)<Tw||c.a.distanceToSquared(c.c)<Tw||c.b.distanceToSquared(c.c)<Tw}class KN extends b.CJI{constructor(...e){super(...e),this.side=null,this.originalSide=null,this.coplanarCount=0}init(){this.side=null,this.originalSide=null,this.coplanarCount=0}initFrom(e){this.side=e.side,this.originalSide=e.originalSide,this.coplanarCount=e.coplanarCount}updateSide(e,i=null,s=-1){if(this.originalSide!==null&&this.side===null)return;Y0.copy(this.a).add(this.b).add(this.c).multiplyScalar(1/3);const a=e.distanceToPoint(Y0)<0?-1:1;i&&s!==-1?a===1&&(this.coplanarCount++,this.coplanarCount===3&&(this.side=0)):(this.originalSide===null&&(this.originalSide=a,this.side=a),a!==this.side&&(this.side=null))}}class JN{constructor(){this._pool=[],this._index=0}getTriangle(){this._index>=this._pool.length&&this._pool.push(new KN);const e=this._pool[this._index++];return e.init(),e}clear(){this._index=0}reset(){this._pool.length=0,this._index=0}}class ZN{constructor(){this.trianglePool=new JN,this.triangles=[],this.normal=new b.Pa4}initialize(e){const{triangles:i,trianglePool:s,normal:a}=this;if(i.length=0,s.clear(),Array.isArray(e))for(let h=0,d=e.length;h<d;h++){const _=e[h];if(h===0)_.getNormal(a);else if(Math.abs(1-_.getNormal(Y0).dot(a))>Tw)throw new Error("Triangle Splitter: Cannot initialize with triangles that have different normals.");const et=s.getTriangle();et.copy(_),i.push(et)}else{e.getNormal(a);const h=s.getTriangle();h.copy(e),i.push(h)}}splitByTriangle(e){const{normal:i,triangles:s}=this;if(e.getPlane(_M),Math.abs(1-Math.abs(_M.normal.dot(i)))<y2){const a=[e.a,e.b,e.c];for(let h=0;h<3;h++){const d=(h+1)%3,_=a[h],et=a[d];Y0.subVectors(et,_).normalize(),AO.crossVectors(i,Y0),_M.setFromNormalAndCoplanarPoint(AO,_),this.splitByPlane(_M,e,h)}for(let h=0,d=s.length;h<d;h++)s[h].coplanarCount=0}else this.splitByPlane(_M,e)}splitByPlane(e,i=null,s=-1){const{triangles:a,trianglePool:h}=this;let d=null;i!==null&&(d=XN,d.copy(i),d.needsUpdate=!0);for(let _=0,et=a.length;_<et;_++){const nt=a[_],{a:it,b:lt,c:ut}=nt;if(d&&(!d.intersectsTriangle(nt,X_)||X_.distance()<1e-5)){nt.updateSide(e,d,s),nt.side=null;continue}let pt=0,gt=-1,vt=0,Ct=0,wt=!1;const xt=[it,lt,ut];for(let _t=0;_t<3;_t++){const Pt=(_t+1)%3;X_.start.copy(xt[_t]),X_.end.copy(xt[Pt]);const Bt=e.distanceToPoint(X_.start),Ot=e.distanceToPoint(X_.end);Math.abs(Bt)<Tw?Ct++:Bt>0&&vt++,Math.abs(Bt)<y2&&Math.abs(Ot)<y2&&(wt=!0);let Lt=!!e.intersectLine(X_,Y0);!Lt&&Math.abs(Ot)<Tw&&(Y0.copy(X_.end),Lt=!0),!Lt||Y0.distanceTo(X_.start)<Tw||(Y0.distanceTo(X_.end)<Tw&&(gt=_t),pt===0?du.start.copy(Y0):du.end.copy(Y0),pt++)}if(!wt&&Ct<2&&pt===2&&du.distance()>y2)if(gt!==-1){gt=(gt+1)%3;let _t=0;_t===gt&&(_t=(_t+1)%3);let Pt=_t+1;Pt===gt&&(Pt=(Pt+1)%3);const Bt=h.getTriangle();Bt.a.copy(xt[Pt]),Bt.b.copy(du.end),Bt.c.copy(du.start),AM(Bt)||(a.push(Bt),Bt.initFrom(nt),Bt.updateSide(e,d,s)),nt.a.copy(xt[_t]),nt.b.copy(du.start),nt.c.copy(du.end),AM(nt)?(a.splice(_,1),_--,et--):nt.updateSide(e,d,s)}else{const _t=xt.findIndex(qt=>vt>=2?e.distanceToPoint(qt)<0:e.distanceToPoint(qt)>0);if(_t===0){let qt=du.start;du.start=du.end,du.end=qt}else if(_t===-1)continue;const Pt=(_t+1)%3,Bt=(_t+2)%3,Ot=h.getTriangle(),Lt=h.getTriangle();xt[Pt].distanceToSquared(du.start)<xt[Bt].distanceToSquared(du.end)?(Ot.a.copy(xt[Pt]),Ot.b.copy(du.start),Ot.c.copy(du.end),Lt.a.copy(xt[Pt]),Lt.b.copy(xt[Bt]),Lt.c.copy(du.start)):(Ot.a.copy(xt[Bt]),Ot.b.copy(du.start),Ot.c.copy(du.end),Lt.a.copy(xt[Pt]),Lt.b.copy(xt[Bt]),Lt.c.copy(du.end)),nt.a.copy(xt[_t]),nt.b.copy(du.end),nt.c.copy(du.start),AM(Ot)||(a.push(Ot),Ot.initFrom(nt),Ot.updateSide(e,d,s)),AM(Lt)||(a.push(Lt),Lt.initFrom(nt),Lt.updateSide(e,d,s)),AM(nt)?(a.splice(_,1),_--,et--):nt.updateSide(e,d,s)}else pt===3&&console.warn("TriangleClipper: Coplanar clip not handled")}}reset(){this.triangles.length=0}}function yO(){return typeof SharedArrayBuffer<"u"}function $N(c){if(c.buffer instanceof SharedArrayBuffer)return c;const e=c.constructor,i=c.buffer,s=new SharedArrayBuffer(i.byteLength),a=new Uint8Array(i);return new Uint8Array(s).set(a,0),new e(s)}class wO{constructor(e,i=500){const s=yO()?SharedArrayBuffer:ArrayBuffer;this.expansionFactor=1.5,this.type=e,this.array=new e(new s(i*e.BYTES_PER_ELEMENT)),this.length=0}expand(e=null){const{type:i,array:s,expansionFactor:a}=this;e===null&&(e=~~(s.length*a));const h=new i(e);h.set(s,0),this.array=h}push(...e){let{array:i,length:s}=this;s+e.length>i.length&&(this.expand(),i=this.array);for(let a=0,h=e.length;a<h;a++)i[s+a]=e[a];this.length+=e.length}clear(){this.length=0}}class eU{constructor(){this.groupAttributes=[{}],this.groupCount=0}getType(e){return this.groupAttributes[0][e].type}getTotalLength(e){const{groupCount:i,groupAttributes:s}=this;let a=0;for(let h=0;h<i;h++)a+=s[h][e].length;return a}getGroupSet(e=0){const{groupAttributes:i}=this;if(i[e])return this.groupCount=Math.max(this.groupCount,e+1),i[e];const s=i[0];for(this.groupCount=Math.max(this.groupCount,e+1);e>=i.length;){const a={};i.push(a);for(const h in s)a[h]=new wO(s[h].type)}return i[e]}getGroupArray(e,i=0){const{groupAttributes:s}=this;if(!s[0][e])throw new Error(`TypedAttributeData: Attribute with "${e}" has not been initialized`);return this.getGroupSet(i)[e]}initializeArray(e,i){const{groupAttributes:s}=this,a=s[0][e];if(a){if(a.type!==i)throw new Error(`TypedAttributeData: Array ${e} already initialized with a different type.`)}else for(let h=0,d=s.length;h<d;h++)s[h][e]=new wO(i)}clear(){this.groupCount=0;const{groupAttributes:e}=this;e.forEach(i=>{for(const s in i)i[s].clear()})}delete(e){this.groupAttributes.forEach(i=>{delete i[e]})}reset(){this.groupAttributes=[]}}class tU{constructor(e){this.triangle=new b.CJI().copy(e),this.intersects={}}addTriangle(e,i){this.intersects[e]=new b.CJI().copy(i)}getIntersectArray(){const e=[],{intersects:i}=this;for(const s in i)e.push(i[s]);return e}}class xO{constructor(){this.data={}}addTriangleIntersection(e,i,s,a){const{data:h}=this;h[e]||(h[e]=new tU(i)),h[e].addTriangle(s,a)}getTrianglesAsArray(e=null){const{data:i}=this,s=[];if(e!==null)e in i&&s.push(i[e].triangle);else for(const a in i)s.push(i[a].triangle);return s}getTriangleIndices(){return Object.keys(this.data).map(e=>parseInt(e))}getIntersectionIndices(e){const{data:i}=this;return i[e]?Object.keys(i[e].intersects).map(s=>parseInt(s)):[]}getIntersectionsAsArray(e=null,i=null){const{data:s}=this,a=new Set,h=[],d=_=>{if(s[_])if(i!==null)s[_].intersects[i]&&h.push(s[_].intersects[i]);else{const et=s[_].intersects;for(const nt in et)a.has(nt)||(a.add(nt),h.push(et[nt]))}};if(e!==null)d(e);else for(const _ in s)d(_);return h}reset(){this.data={}}}class nU{constructor(){this.enabled=!1,this.triangleIntersectsA=new xO,this.triangleIntersectsB=new xO,this.intersectionEdges=[]}addIntersectingTriangles(e,i,s,a){const{triangleIntersectsA:h,triangleIntersectsB:d}=this;h.addTriangleIntersection(e,i,s,a),d.addTriangleIntersection(s,a,e,i)}addEdge(e){this.intersectionEdges.push(e.clone())}reset(){this.triangleIntersectsA.reset(),this.triangleIntersectsB.reset(),this.intersectionEdges=[]}}const Iw=new b.yGw,AS=new b.Vkp,f1=new b.CJI,w2=new b.CJI,x2=new b.CJI,yM=new b.CJI;function iU(c){for(const e of c)return e}function bO(c,e,i,s,a,h,d,_=0){Iw.copy(e.matrixWorld).invert().multiply(c.matrixWorld),AS.getNormalMatrix(c.matrixWorld);const et=c.geometry.groupIndices,nt=c.geometry.index,it=c.geometry.attributes.position,lt=e.geometry.boundsTree,ut=e.geometry.index,pt=e.geometry.attributes.position,gt=i.ids,vt=i.intersectionSet;for(let Ct=0,wt=gt.length;Ct<wt;Ct++){const xt=gt[Ct],_t=_===-1?0:et[xt]+_,Pt=d.getGroupSet(_t),Bt=3*xt,Ot=nt.getX(Bt+0),Lt=nt.getX(Bt+1),qt=nt.getX(Bt+2);f1.a.fromBufferAttribute(it,Ot).applyMatrix4(Iw),f1.b.fromBufferAttribute(it,Lt).applyMatrix4(Iw),f1.c.fromBufferAttribute(it,qt).applyMatrix4(Iw),h.initialize(f1);const en=vt[xt];for(let An=0,mn=en.length;An<mn;An++){const Tn=3*en[An],vn=ut.getX(Tn+0),xn=ut.getX(Tn+1),Un=ut.getX(Tn+2);w2.a.fromBufferAttribute(pt,vn),w2.b.fromBufferAttribute(pt,xn),w2.c.fromBufferAttribute(pt,Un),h.splitByTriangle(w2)}const cn=h.triangles;for(let An=0,mn=cn.length;An<mn;An++){const Tn=cn[An],vn=_O(s,mO(Tn,lt),a);if(vn!==2)switch(f1.getBarycoord(Tn.a,yM.a),f1.getBarycoord(Tn.b,yM.b),f1.getBarycoord(Tn.c,yM.c),vn){case 1:gO(xt,yM,c.geometry,c.matrixWorld,AS,Pt);break;case 0:gO(xt,yM,c.geometry,c.matrixWorld,AS,Pt,!0)}}}return gt.length}function EO(c,e,i,s,a,h,d=0){Iw.copy(e.matrixWorld).invert().multiply(c.matrixWorld),AS.getNormalMatrix(c.matrixWorld);const _=e.geometry.boundsTree,et=c.geometry.groupIndices,nt=c.geometry.index,it=c.geometry.attributes,lt=it.position,ut=[],pt=c.geometry.halfEdges,gt=new Set;for(let vt=0,Ct=nt.count/3;vt<Ct;vt++)vt in i.intersectionSet||gt.add(vt);for(;gt.size>0;){const vt=iU(gt);gt.delete(vt),ut.push(vt);const Ct=3*vt,wt=nt.getX(Ct+0),xt=nt.getX(Ct+1),_t=nt.getX(Ct+2);x2.a.fromBufferAttribute(lt,wt).applyMatrix4(Iw),x2.b.fromBufferAttribute(lt,xt).applyMatrix4(Iw),x2.c.fromBufferAttribute(lt,_t).applyMatrix4(Iw);const Pt=_O(s,mO(x2,_),a);for(;ut.length>0;){const Bt=ut.pop(),Ot=d===-1?0:et[Bt]+d,Lt=h.getGroupSet(Ot);for(let mn=0;mn<3;mn++){const Tn=pt.getSiblingTriangleIndex(Bt,mn);Tn!==-1&&gt.has(Tn)&&(ut.push(Tn),gt.delete(Tn))}const qt=3*Bt,en=nt.getX(qt+0),cn=nt.getX(qt+1),An=nt.getX(qt+2);switch(Pt){case 1:vO(en,cn,An,it,c.matrixWorld,AS,Lt);break;case 0:vO(An,cn,en,it,c.matrixWorld,AS,Lt,a)}}}}const KP=1.25,JP=65535,rU=Math.pow(2,-24);class b2{constructor(){}}function K_(c,e,i){return i.min.x=e[c],i.min.y=e[c+1],i.min.z=e[c+2],i.max.x=e[c+3],i.max.y=e[c+4],i.max.z=e[c+5],i}function SO(c){let e=-1,i=-1/0;for(let s=0;s<3;s++){const a=c[s+3]-c[s];a>i&&(i=a,e=s)}return e}function CO(c,e){e.set(c)}function MO(c,e,i){let s,a;for(let h=0;h<3;h++){const d=h+3;s=c[h],a=e[h],i[h]=s<a?s:a,s=c[d],a=e[d],i[d]=s>a?s:a}}function E2(c,e,i){for(let s=0;s<3;s++){const a=e[c+2*s],h=e[c+2*s+1],d=a-h,_=a+h;d<i[s]&&(i[s]=d),_>i[s+3]&&(i[s+3]=_)}}function wM(c){const e=c[3]-c[0],i=c[4]-c[1],s=c[5]-c[2];return 2*(e*i+i*s+s*e)}function ZP(c,e,i,s,a=null){let h=1/0,d=1/0,_=1/0,et=-1/0,nt=-1/0,it=-1/0,lt=1/0,ut=1/0,pt=1/0,gt=-1/0,vt=-1/0,Ct=-1/0;const wt=a!==null;for(let xt=6*e,_t=6*(e+i);xt<_t;xt+=6){const Pt=c[xt+0],Bt=c[xt+1],Ot=Pt-Bt,Lt=Pt+Bt;Ot<h&&(h=Ot),Lt>et&&(et=Lt),wt&&Pt<lt&&(lt=Pt),wt&&Pt>gt&&(gt=Pt);const qt=c[xt+2],en=c[xt+3],cn=qt-en,An=qt+en;cn<d&&(d=cn),An>nt&&(nt=An),wt&&qt<ut&&(ut=qt),wt&&qt>vt&&(vt=qt);const mn=c[xt+4],Tn=c[xt+5],vn=mn-Tn,xn=mn+Tn;vn<_&&(_=vn),xn>it&&(it=xn),wt&&mn<pt&&(pt=mn),wt&&mn>Ct&&(Ct=mn)}s[0]=h,s[1]=d,s[2]=_,s[3]=et,s[4]=nt,s[5]=it,wt&&(a[0]=lt,a[1]=ut,a[2]=pt,a[3]=gt,a[4]=vt,a[5]=Ct)}const sU=(c,e)=>c.candidate-e.candidate,Dw=new Array(32).fill().map(()=>({count:0,bounds:new Float32Array(6),rightCacheBounds:new Float32Array(6),leftCacheBounds:new Float32Array(6),candidate:0})),S2=new Float32Array(6);class J_ extends b.ZzF{constructor(...e){super(...e),this.isOrientedBox=!0,this.matrix=new b.yGw,this.invMatrix=new b.yGw,this.points=new Array(8).fill().map(()=>new b.Pa4),this.satAxes=new Array(3).fill().map(()=>new b.Pa4),this.satBounds=new Array(3).fill().map(()=>new q_),this.alignedSatBounds=new Array(3).fill().map(()=>new q_),this.needsUpdate=!1}set(e,i,s){super.set(e,i),this.matrix.copy(s),this.needsUpdate=!0}copy(e){super.copy(e),this.matrix.copy(e.matrix),this.needsUpdate=!0}}J_.prototype.update=function(){const c=this.matrix,e=this.min,i=this.max,s=this.points;for(let et=0;et<=1;et++)for(let nt=0;nt<=1;nt++)for(let it=0;it<=1;it++){const lt=s[1*et|2*nt|4*it];lt.x=et?i.x:e.x,lt.y=nt?i.y:e.y,lt.z=it?i.z:e.z,lt.applyMatrix4(c)}const a=this.satBounds,h=this.satAxes,d=s[0];for(let et=0;et<3;et++){const nt=h[et],it=a[et],lt=s[1<<et];nt.subVectors(d,lt),it.setFromPoints(nt,s)}const _=this.alignedSatBounds;_[0].setFromPointsField(s,"x"),_[1].setFromPointsField(s,"y"),_[2].setFromPointsField(s,"z"),this.invMatrix.copy(this.matrix).invert(),this.needsUpdate=!1},J_.prototype.intersectsBox=function(){const c=new q_;return function(e){this.needsUpdate&&this.update();const i=e.min,s=e.max,a=this.satBounds,h=this.satAxes,d=this.alignedSatBounds;if(c.min=i.x,c.max=s.x,d[0].isSeparated(c)||(c.min=i.y,c.max=s.y,d[1].isSeparated(c))||(c.min=i.z,c.max=s.z,d[2].isSeparated(c)))return!1;for(let _=0;_<3;_++){const et=h[_],nt=a[_];if(c.setFromBox(et,e),nt.isSeparated(c))return!1}return!0}}(),J_.prototype.intersectsTriangle=function(){const c=new Y_,e=new Array(3),i=new q_,s=new q_,a=new b.Pa4;return function(h){this.needsUpdate&&this.update(),h.isExtendedTriangle?h.needsUpdate&&h.update():(c.copy(h),c.update(),h=c);const d=this.satBounds,_=this.satAxes;e[0]=h.a,e[1]=h.b,e[2]=h.c;for(let lt=0;lt<3;lt++){const ut=d[lt],pt=_[lt];if(i.setFromPoints(pt,e),ut.isSeparated(i))return!1}const et=h.satBounds,nt=h.satAxes,it=this.points;for(let lt=0;lt<3;lt++){const ut=et[lt],pt=nt[lt];if(i.setFromPoints(pt,it),ut.isSeparated(i))return!1}for(let lt=0;lt<3;lt++){const ut=_[lt];for(let pt=0;pt<4;pt++){const gt=nt[pt];if(a.crossVectors(ut,gt),i.setFromPoints(a,e),s.setFromPoints(a,it),i.isSeparated(s))return!1}}return!0}}(),J_.prototype.closestPointToPoint=function(c,e){return this.needsUpdate&&this.update(),e.copy(c).applyMatrix4(this.invMatrix).clamp(this.min,this.max).applyMatrix4(this.matrix),e},J_.prototype.distanceToPoint=function(){const c=new b.Pa4;return function(e){return this.closestPointToPoint(e,c),e.distanceTo(c)}}(),J_.prototype.distanceToBox=function(){const c=["x","y","z"],e=new Array(12).fill().map(()=>new b.Zzh),i=new Array(12).fill().map(()=>new b.Zzh),s=new b.Pa4,a=new b.Pa4;return function(h,d=0,_=null,et=null){if(this.needsUpdate&&this.update(),this.intersectsBox(h))return(_||et)&&(h.getCenter(a),this.closestPointToPoint(a,s),h.closestPointToPoint(s,a),_&&_.copy(s),et&&et.copy(a)),0;const nt=d*d,it=h.min,lt=h.max,ut=this.points;let pt=1/0;for(let vt=0;vt<8;vt++){const Ct=ut[vt];a.copy(Ct).clamp(it,lt);const wt=Ct.distanceToSquared(a);if(wt<pt&&(pt=wt,_&&_.copy(Ct),et&&et.copy(a),wt<nt))return Math.sqrt(wt)}let gt=0;for(let vt=0;vt<3;vt++)for(let Ct=0;Ct<=1;Ct++)for(let wt=0;wt<=1;wt++){const xt=(vt+1)%3,_t=(vt+2)%3,Pt=1<<vt|Ct<<xt|wt<<_t,Bt=ut[Ct<<xt|wt<<_t],Ot=ut[Pt];e[gt].set(Bt,Ot);const Lt=c[vt],qt=c[xt],en=c[_t],cn=i[gt],An=cn.start,mn=cn.end;An[Lt]=it[Lt],An[qt]=Ct?it[qt]:lt[qt],An[en]=wt?it[en]:lt[qt],mn[Lt]=lt[Lt],mn[qt]=Ct?it[qt]:lt[qt],mn[en]=wt?it[en]:lt[qt],gt++}for(let vt=0;vt<=1;vt++)for(let Ct=0;Ct<=1;Ct++)for(let wt=0;wt<=1;wt++){a.x=vt?lt.x:it.x,a.y=Ct?lt.y:it.y,a.z=wt?lt.z:it.z,this.closestPointToPoint(a,s);const xt=a.distanceToSquared(s);if(xt<pt&&(pt=xt,_&&_.copy(s),et&&et.copy(a),xt<nt))return Math.sqrt(xt)}for(let vt=0;vt<12;vt++){const Ct=e[vt];for(let wt=0;wt<12;wt++){const xt=i[wt];GP(Ct,xt,s,a);const _t=s.distanceToSquared(a);if(_t<pt&&(pt=_t,_&&_.copy(s),et&&et.copy(a),_t<nt))return Math.sqrt(_t)}}return Math.sqrt(pt)}}();const C2=new b.Pa4,M2=new b.Pa4,T2=new b.Pa4,TO=new b.FM8,IO=new b.FM8,DO=new b.FM8,PO=new b.Pa4;function RO(c,e,i,s,a){const h=3*s,d=c.index.getX(h),_=c.index.getX(h+1),et=c.index.getX(h+2),nt=function(it,lt,ut,pt,gt,vt,Ct){C2.fromBufferAttribute(lt,pt),M2.fromBufferAttribute(lt,gt),T2.fromBufferAttribute(lt,vt);const wt=function(xt,_t,Pt,Bt,Ot,Lt){let qt;return qt=Lt===b._Li?xt.intersectTriangle(Bt,Pt,_t,!0,Ot):xt.intersectTriangle(_t,Pt,Bt,Lt!==b.ehD,Ot),qt===null?null:{distance:xt.origin.distanceTo(Ot),point:Ot.clone()}}(it,C2,M2,T2,PO,Ct);if(wt){ut&&(TO.fromBufferAttribute(ut,pt),IO.fromBufferAttribute(ut,gt),DO.fromBufferAttribute(ut,vt),wt.uv=b.CJI.getUV(PO,C2,M2,T2,TO,IO,DO,new b.FM8));const xt={a:pt,b:gt,c:vt,normal:new b.Pa4,materialIndex:0};b.CJI.getNormal(C2,M2,T2,xt.normal),wt.face=xt,wt.faceIndex=pt}return wt}(i,c.attributes.position,c.attributes.uv,d,_,et,e);return nt?(nt.faceIndex=s,a&&a.push(nt),nt):null}function BO(c,e,i){return c===null?null:(c.point.applyMatrix4(e.matrixWorld),c.distance=c.point.distanceTo(i.ray.origin),c.object=e,c.distance<i.near||c.distance>i.far?null:c)}function Z_(c,e,i,s){const a=c.a,h=c.b,d=c.c;let _=e,et=e+1,nt=e+2;i&&(_=i.getX(e),et=i.getX(e+1),nt=i.getX(e+2)),a.x=s.getX(_),a.y=s.getY(_),a.z=s.getZ(_),h.x=s.getX(et),h.y=s.getY(et),h.z=s.getZ(et),d.x=s.getX(nt),d.y=s.getY(nt),d.z=s.getZ(nt)}function kO(c,e,i,s,a,h,d){const _=i.index,et=i.attributes.position;for(let nt=c,it=e+c;nt<it;nt++)if(Z_(d,3*nt,_,et),d.needsUpdate=!0,s(d,nt,a,h))return!0;return!1}class OO{constructor(e){this._getNewPrimitive=e,this._primitives=[]}getPrimitive(){const e=this._primitives;return e.length===0?this._getNewPrimitive():e.pop()}releasePrimitive(e){this._primitives.push(e)}}function Pw(c,e){return e[c+15]===65535}function yS(c,e){return e[c+6]}function xM(c,e){return e[c+14]}function bM(c){return c+8}function EM(c,e){return e[c+6]}const wS=new b.ZzF,I2=new b.Pa4,oU=["x","y","z"];function $P(c,e,i,s,a){let h=2*c,d=xS,_=Rw,et=Bw;if(Pw(h,_))(function(nt,it,lt,ut,pt,gt){for(let vt=ut,Ct=ut+pt;vt<Ct;vt++)RO(nt,it,lt,vt,gt)})(e,i,s,yS(c,et),xM(h,_),a);else{const nt=bM(c);D2(nt,d,s,I2)&&$P(nt,e,i,s,a);const it=EM(c,et);D2(it,d,s,I2)&&$P(it,e,i,s,a)}}function eR(c,e,i,s){let a=2*c,h=xS,d=Rw,_=Bw;if(Pw(a,d))return function(et,nt,it,lt,ut){let pt=1/0,gt=null;for(let vt=lt,Ct=lt+ut;vt<Ct;vt++){const wt=RO(et,nt,it,vt);wt&&wt.distance<pt&&(gt=wt,pt=wt.distance)}return gt}(e,i,s,yS(c,_),xM(a,d));{const et=function(vt,Ct){return Ct[vt+7]}(c,_),nt=oU[et],it=s.direction[nt]>=0;let lt,ut;it?(lt=bM(c),ut=EM(c,_)):(lt=EM(c,_),ut=bM(c));const pt=D2(lt,h,s,I2)?eR(lt,e,i,s):null;if(pt){const vt=pt.point[nt];if(it?vt<=h[ut+et]:vt>=h[ut+et+3])return pt}const gt=D2(ut,h,s,I2)?eR(ut,e,i,s):null;return pt&&gt?pt.distance<=gt.distance?pt:gt:pt||gt||null}}const aU=function(){let c,e;const i=[],s=new OO(()=>new b.ZzF);return function(...h){c=s.getPrimitive(),e=s.getPrimitive(),i.push(c,e);const d=a(...h);s.releasePrimitive(c),s.releasePrimitive(e),i.pop(),i.pop();const _=i.length;return _>0&&(e=i[_-1],c=i[_-2]),d};function a(h,d,_,et,nt=null,it=0,lt=0){function ut(xt){let _t=2*xt,Pt=Rw,Bt=Bw;for(;!Pw(_t,Pt);)_t=2*(xt=bM(xt));return yS(xt,Bt)}function pt(xt){let _t=2*xt,Pt=Rw,Bt=Bw;for(;!Pw(_t,Pt);)_t=2*(xt=EM(xt,Bt));return yS(xt,Bt)+xM(_t,Pt)}let gt=2*h,vt=xS,Ct=Rw,wt=Bw;if(Pw(gt,Ct)){const xt=yS(h,wt),_t=xM(gt,Ct);return K_(h,vt,c),et(xt,_t,!1,lt,it+h,c)}{const xt=bM(h),_t=EM(h,wt);let Pt,Bt,Ot,Lt,qt=xt,en=_t;if(nt&&(Ot=c,Lt=e,K_(qt,vt,Ot),K_(en,vt,Lt),Pt=nt(Ot),Bt=nt(Lt),Bt<Pt)){qt=_t,en=xt;const vn=Pt;Pt=Bt,Bt=vn,Ot=Lt}Ot||(Ot=c,K_(qt,vt,Ot));const cn=_(Ot,Pw(2*qt,Ct),Pt,lt+1,it+qt);let An;if(cn===2){const vn=ut(qt);An=et(vn,pt(qt)-vn,!0,lt+1,it+qt,Ot)}else An=cn&&a(qt,d,_,et,nt,it,lt+1);if(An)return!0;Lt=e,K_(en,vt,Lt);const mn=_(Lt,Pw(2*en,Ct),Bt,lt+1,it+en);let Tn;if(mn===2){const vn=ut(en);Tn=et(vn,pt(en)-vn,!0,lt+1,it+en,Lt)}else Tn=mn&&a(en,d,_,et,nt,it,lt+1);return!!Tn}}}(),lU=function(){const c=new Y_,e=new Y_,i=new b.yGw,s=new J_,a=new J_;return function h(d,_,et,nt,it=null){let lt=2*d,ut=xS,pt=Rw,gt=Bw;if(it===null&&(et.boundingBox||et.computeBoundingBox(),s.set(et.boundingBox.min,et.boundingBox.max,nt),it=s),!Pw(lt,pt)){const vt=d+8,Ct=gt[d+6];return K_(vt,ut,wS),it.intersectsBox(wS)&&h(vt,_,et,nt,it)?!0:(K_(Ct,ut,wS),!(!it.intersectsBox(wS)||!h(Ct,_,et,nt,it)))}{const vt=_,Ct=vt.index,wt=vt.attributes.position,xt=et.index,_t=et.attributes.position,Pt=yS(d,gt),Bt=xM(lt,pt);if(i.copy(nt).invert(),et.boundsTree)return K_(d,ut,a),a.matrix.copy(i),a.needsUpdate=!0,et.boundsTree.shapecast({intersectsBounds:Lt=>a.intersectsBox(Lt),intersectsTriangle:Lt=>{Lt.a.applyMatrix4(nt),Lt.b.applyMatrix4(nt),Lt.c.applyMatrix4(nt),Lt.needsUpdate=!0;for(let qt=3*Pt,en=3*(Bt+Pt);qt<en;qt+=3)if(Z_(e,qt,Ct,wt),e.needsUpdate=!0,Lt.intersectsTriangle(e))return!0;return!1}});for(let Ot=3*Pt,Lt=Bt+3*Pt;Ot<Lt;Ot+=3){Z_(c,Ot,Ct,wt),c.a.applyMatrix4(i),c.b.applyMatrix4(i),c.c.applyMatrix4(i),c.needsUpdate=!0;for(let qt=0,en=xt.count;qt<en;qt+=3)if(Z_(e,qt,xt,_t),e.needsUpdate=!0,c.intersectsTriangle(e))return!0}}}}();function D2(c,e,i,s){return K_(c,e,wS),i.intersectBox(wS,s)}const tR=[];let P2,xS,Rw,Bw;function SM(c){P2&&tR.push(P2),P2=c,xS=new Float32Array(c),Rw=new Uint16Array(c),Bw=new Uint32Array(c)}function R2(){P2=null,xS=null,Rw=null,Bw=null,tR.length&&SM(tR.pop())}const nR=Symbol("skip tree generation"),iR=new b.ZzF,rR=new b.ZzF,bS=new b.yGw,m1=new J_,CM=new J_,MM=new b.Pa4,B2=new b.Pa4,cU=new b.Pa4,uU=new b.Pa4,hU=new b.Pa4,LO=new b.ZzF,$_=new OO(()=>new Y_);class vp{static serialize(e,i={}){if(i.isBufferGeometry)return console.warn("MeshBVH.serialize: The arguments for the function have changed. See documentation for new signature."),vp.serialize(arguments[0],{cloneBuffers:arguments[2]===void 0||arguments[2]});i={cloneBuffers:!0,...i};const s=e.geometry,a=e._roots,h=s.getIndex();let d;return d=i.cloneBuffers?{roots:a.map(_=>_.slice()),index:h.array.slice()}:{roots:a,index:h.array},d}static deserialize(e,i,s={}){if(typeof s=="boolean")return console.warn("MeshBVH.deserialize: The arguments for the function have changed. See documentation for new signature."),vp.deserialize(arguments[0],arguments[1],{setIndex:arguments[2]===void 0||arguments[2]});s={setIndex:!0,...s};const{index:a,roots:h}=e,d=new vp(i,{...s,[nR]:!0});if(d._roots=h,s.setIndex){const _=i.getIndex();if(_===null){const et=new b.TlE(e.index,1,!1);i.setIndex(et)}else _.array!==a&&(_.array.set(a),_.needsUpdate=!0)}return d}constructor(e,i={}){if(!e.isBufferGeometry)throw new Error("MeshBVH: Only BufferGeometries are supported.");if(e.index&&e.index.isInterleavedBufferAttribute)throw new Error("MeshBVH: InterleavedBufferAttribute is not supported for the index attribute.");if((i=Object.assign({strategy:0,maxDepth:40,maxLeafTris:10,verbose:!0,useSharedArrayBuffer:!1,setBoundingBox:!0,onProgress:null,[nR]:!1},i)).useSharedArrayBuffer&&typeof SharedArrayBuffer>"u")throw new Error("MeshBVH: SharedArrayBuffer is not available.");this._roots=null,i[nR]||(this._roots=function(s,a){const h=function(pt,gt){function vt(vn){en&&en(vn/cn)}function Ct(vn,xn,Un,Mn=null,Gn=0){if(!An&&Gn>=Bt&&(An=!0,Ot&&(console.warn(`MeshBVH: Max depth of ${Bt} reached when generating BVH. Consider increasing maxDepth.`),console.warn(pt))),Un<=Lt||Gn>=Bt)return vt(xn+Un),vn.offset=xn,vn.count=Un,vn;const rr=function(_i,xr,Cr,Mr,Lr,ls){let mr=-1,Us=0;if(ls===0)mr=SO(xr),mr!==-1&&(Us=(xr[mr]+xr[mr+3])/2);else if(ls===1)mr=SO(_i),mr!==-1&&(Us=function(Ws,Fs,co,To){let ar=0;for(let Rr=Fs,Br=Fs+co;Rr<Br;Rr++)ar+=Ws[6*Rr+2*To];return ar/co}(Cr,Mr,Lr,mr));else if(ls===2){const Ws=wM(_i);let Fs=KP*Lr;const co=6*Mr,To=6*(Mr+Lr);for(let ar=0;ar<3;ar++){const Rr=xr[ar],Br=(xr[ar+3]-Rr)/32;if(Lr<8){const js=[...Dw];js.length=Lr;let Eo=0;for(let Nn=co;Nn<To;Nn+=6,Eo++){const on=js[Eo];on.candidate=Cr[Nn+2*ar],on.count=0;const{bounds:Qn,leftCacheBounds:Jn,rightCacheBounds:Vn}=on;for(let sr=0;sr<3;sr++)Vn[sr]=1/0,Vn[sr+3]=-1/0,Jn[sr]=1/0,Jn[sr+3]=-1/0,Qn[sr]=1/0,Qn[sr+3]=-1/0;E2(Nn,Cr,Qn)}js.sort(sU);let nn=Lr;for(let Nn=0;Nn<nn;Nn++){const on=js[Nn];for(;Nn+1<nn&&js[Nn+1].candidate===on.candidate;)js.splice(Nn+1,1),nn--}for(let Nn=co;Nn<To;Nn+=6){const on=Cr[Nn+2*ar];for(let Qn=0;Qn<nn;Qn++){const Jn=js[Qn];on>=Jn.candidate?E2(Nn,Cr,Jn.rightCacheBounds):(E2(Nn,Cr,Jn.leftCacheBounds),Jn.count++)}}for(let Nn=0;Nn<nn;Nn++){const on=js[Nn],Qn=on.count,Jn=Lr-on.count,Vn=on.leftCacheBounds,sr=on.rightCacheBounds;let jr=0;Qn!==0&&(jr=wM(Vn)/Ws);let Zr=0;Jn!==0&&(Zr=wM(sr)/Ws);const os=1+KP*(jr*Qn+Zr*Jn);os<Fs&&(mr=ar,Fs=os,Us=on.candidate)}}else{for(let nn=0;nn<32;nn++){const Nn=Dw[nn];Nn.count=0,Nn.candidate=Rr+Br+nn*Br;const on=Nn.bounds;for(let Qn=0;Qn<3;Qn++)on[Qn]=1/0,on[Qn+3]=-1/0}for(let nn=co;nn<To;nn+=6){let Nn=~~((Cr[nn+2*ar]-Rr)/Br);Nn>=32&&(Nn=31);const on=Dw[Nn];on.count++,E2(nn,Cr,on.bounds)}const js=Dw[31];CO(js.bounds,js.rightCacheBounds);for(let nn=30;nn>=0;nn--){const Nn=Dw[nn],on=Dw[nn+1];MO(Nn.bounds,on.rightCacheBounds,Nn.rightCacheBounds)}let Eo=0;for(let nn=0;nn<31;nn++){const Nn=Dw[nn],on=Nn.count,Qn=Nn.bounds,Jn=Dw[nn+1].rightCacheBounds;on!==0&&(Eo===0?CO(Qn,S2):MO(Qn,S2,S2)),Eo+=on;let Vn=0,sr=0;Eo!==0&&(Vn=wM(S2)/Ws);const jr=Lr-Eo;jr!==0&&(sr=wM(Jn)/Ws);const Zr=1+KP*(Vn*Eo+sr*jr);Zr<Fs&&(mr=ar,Fs=Zr,Us=Nn.candidate)}}}}else console.warn(`MeshBVH: Invalid build strategy value ${ls} used.`);return{axis:mr,pos:Us}}(vn.boundingData,Mn,_t,xn,Un,qt);if(rr.axis===-1)return vt(xn+Un),vn.offset=xn,vn.count=Un,vn;const dr=function(_i,xr,Cr,Mr,Lr){let ls=Cr,mr=Cr+Mr-1;const Us=Lr.pos,Ws=2*Lr.axis;for(;;){for(;ls<=mr&&xr[6*ls+Ws]<Us;)ls++;for(;ls<=mr&&xr[6*mr+Ws]>=Us;)mr--;if(!(ls<mr))return ls;for(let Fs=0;Fs<3;Fs++){let co=_i[3*ls+Fs];_i[3*ls+Fs]=_i[3*mr+Fs],_i[3*mr+Fs]=co;let To=xr[6*ls+2*Fs+0];xr[6*ls+2*Fs+0]=xr[6*mr+2*Fs+0],xr[6*mr+2*Fs+0]=To;let ar=xr[6*ls+2*Fs+1];xr[6*ls+2*Fs+1]=xr[6*mr+2*Fs+1],xr[6*mr+2*Fs+1]=ar}ls++,mr--}}(Pt,_t,xn,Un,rr);if(dr===xn||dr===xn+Un)vt(xn+Un),vn.offset=xn,vn.count=Un;else{vn.splitAxis=rr.axis;const _i=new b2,xr=xn,Cr=dr-xn;vn.left=_i,_i.boundingData=new Float32Array(6),ZP(_t,xr,Cr,_i.boundingData,xt),Ct(_i,xr,Cr,xt,Gn+1);const Mr=new b2,Lr=dr,ls=Un-Cr;vn.right=Mr,Mr.boundingData=new Float32Array(6),ZP(_t,Lr,ls,Mr.boundingData,xt),Ct(Mr,Lr,ls,xt,Gn+1)}return vn}(function(vn,xn){if(!vn.index){const Un=vn.attributes.position.count,Mn=xn.useSharedArrayBuffer?SharedArrayBuffer:ArrayBuffer;let Gn;Gn=Un>65535?new Uint32Array(new Mn(4*Un)):new Uint16Array(new Mn(2*Un)),vn.setIndex(new b.TlE(Gn,1));for(let rr=0;rr<Un;rr++)Gn[rr]=rr}})(pt,gt);const wt=new Float32Array(6),xt=new Float32Array(6),_t=function(vn,xn){const Un=vn.attributes.position,Mn=Un.array,Gn=vn.index.array,rr=Gn.length/3,dr=new Float32Array(6*rr),_i=Un.offset||0;let xr=3;Un.isInterleavedBufferAttribute&&(xr=Un.data.stride);for(let Cr=0;Cr<rr;Cr++){const Mr=3*Cr,Lr=6*Cr,ls=Gn[Mr+0]*xr+_i,mr=Gn[Mr+1]*xr+_i,Us=Gn[Mr+2]*xr+_i;for(let Ws=0;Ws<3;Ws++){const Fs=Mn[ls+Ws],co=Mn[mr+Ws],To=Mn[Us+Ws];let ar=Fs;co<ar&&(ar=co),To<ar&&(ar=To);let Rr=Fs;co>Rr&&(Rr=co),To>Rr&&(Rr=To);const Br=(Rr-ar)/2,js=2*Ws;dr[Lr+js+0]=ar+Br,dr[Lr+js+1]=Br+(Math.abs(ar)+Br)*rU,ar<xn[Ws]&&(xn[Ws]=ar),Rr>xn[Ws+3]&&(xn[Ws+3]=Rr)}}return dr}(pt,wt),Pt=pt.index.array,Bt=gt.maxDepth,Ot=gt.verbose,Lt=gt.maxLeafTris,qt=gt.strategy,en=gt.onProgress,cn=pt.index.count/3;let An=!1;const mn=[],Tn=function(vn){if(!vn.groups||!vn.groups.length)return[{offset:0,count:vn.index.count/3}];const xn=[],Un=new Set;for(const Gn of vn.groups)Un.add(Gn.start),Un.add(Gn.start+Gn.count);const Mn=Array.from(Un.values()).sort((Gn,rr)=>Gn-rr);for(let Gn=0;Gn<Mn.length-1;Gn++){const rr=Mn[Gn],dr=Mn[Gn+1];xn.push({offset:rr/3,count:(dr-rr)/3})}return xn}(pt);if(Tn.length===1){const vn=Tn[0],xn=new b2;xn.boundingData=wt,function(Un,Mn,Gn,rr){let dr=1/0,_i=1/0,xr=1/0,Cr=-1/0,Mr=-1/0,Lr=-1/0;for(let ls=6*Mn,mr=6*(Mn+Gn);ls<mr;ls+=6){const Us=Un[ls+0];Us<dr&&(dr=Us),Us>Cr&&(Cr=Us);const Ws=Un[ls+2];Ws<_i&&(_i=Ws),Ws>Mr&&(Mr=Ws);const Fs=Un[ls+4];Fs<xr&&(xr=Fs),Fs>Lr&&(Lr=Fs)}rr[0]=dr,rr[1]=_i,rr[2]=xr,rr[3]=Cr,rr[4]=Mr,rr[5]=Lr}(_t,vn.offset,vn.count,xt),Ct(xn,vn.offset,vn.count,xt),mn.push(xn)}else for(let vn of Tn){const xn=new b2;xn.boundingData=new Float32Array(6),ZP(_t,vn.offset,vn.count,xn.boundingData,xt),Ct(xn,vn.offset,vn.count,xt),mn.push(xn)}return mn}(s,a);let d,_,et;const nt=[],it=a.useSharedArrayBuffer?SharedArrayBuffer:ArrayBuffer;for(let pt=0;pt<h.length;pt++){const gt=h[pt],vt=new it(32*lt(gt));d=new Float32Array(vt),_=new Uint32Array(vt),et=new Uint16Array(vt),ut(0,gt),nt.push(vt)}return nt;function lt(pt){return pt.count?1:1+lt(pt.left)+lt(pt.right)}function ut(pt,gt){const vt=pt/4,Ct=pt/2,wt=!!gt.count,xt=gt.boundingData;for(let _t=0;_t<6;_t++)d[vt+_t]=xt[_t];if(wt){const _t=gt.offset,Pt=gt.count;return _[vt+6]=_t,et[Ct+14]=Pt,et[Ct+15]=JP,pt+32}{const _t=gt.left,Pt=gt.right,Bt=gt.splitAxis;let Ot;if(Ot=ut(pt+32,_t),Ot/4>Math.pow(2,32))throw new Error("MeshBVH: Cannot store child pointer greater than 32 bits.");return _[vt+6]=Ot/4,Ot=ut(Ot,Pt),_[vt+7]=Bt,Ot}}}(e,i),!e.boundingBox&&i.setBoundingBox&&(e.boundingBox=this.getBoundingBox(new b.ZzF))),this.geometry=e}refit(e=null){e&&Array.isArray(e)&&(e=new Set(e));const i=this.geometry,s=i.index.array,a=i.attributes.position,h=a.array,d=a.offset||0;let _,et,nt,it,lt=3;a.isInterleavedBufferAttribute&&(lt=a.data.stride);let ut=0;const pt=this._roots;for(let vt=0,Ct=pt.length;vt<Ct;vt++)_=pt[vt],et=new Uint32Array(_),nt=new Uint16Array(_),it=new Float32Array(_),gt(0,ut),ut+=_.byteLength;function gt(vt,Ct,wt=!1){const xt=2*vt;if(nt[xt+15]===JP){const _t=et[vt+6];let Pt=1/0,Bt=1/0,Ot=1/0,Lt=-1/0,qt=-1/0,en=-1/0;for(let cn=3*_t,An=3*(_t+nt[xt+14]);cn<An;cn++){const mn=s[cn]*lt+d,Tn=h[mn+0],vn=h[mn+1],xn=h[mn+2];Tn<Pt&&(Pt=Tn),Tn>Lt&&(Lt=Tn),vn<Bt&&(Bt=vn),vn>qt&&(qt=vn),xn<Ot&&(Ot=xn),xn>en&&(en=xn)}return(it[vt+0]!==Pt||it[vt+1]!==Bt||it[vt+2]!==Ot||it[vt+3]!==Lt||it[vt+4]!==qt||it[vt+5]!==en)&&(it[vt+0]=Pt,it[vt+1]=Bt,it[vt+2]=Ot,it[vt+3]=Lt,it[vt+4]=qt,it[vt+5]=en,!0)}{const _t=vt+8,Pt=et[vt+6],Bt=_t+Ct,Ot=Pt+Ct;let Lt=wt,qt=!1,en=!1;e?Lt||(qt=e.has(Bt),en=e.has(Ot),Lt=!qt&&!en):(qt=!0,en=!0);const cn=Lt||en;let An=!1;(Lt||qt)&&(An=gt(_t,Ct,Lt));let mn=!1;cn&&(mn=gt(Pt,Ct,Lt));const Tn=An||mn;if(Tn)for(let vn=0;vn<3;vn++){const xn=_t+vn,Un=Pt+vn,Mn=it[xn],Gn=it[xn+3],rr=it[Un],dr=it[Un+3];it[vt+vn]=Mn<rr?Mn:rr,it[vt+vn+3]=Gn>dr?Gn:dr}return Tn}}}traverse(e,i=0){const s=this._roots[i],a=new Uint32Array(s),h=new Uint16Array(s);(function d(_,et=0){const nt=2*_,it=h[nt+15]===JP;if(it){const lt=a[_+6],ut=h[nt+14];e(et,it,new Float32Array(s,4*_,6),lt,ut)}else{const lt=_+8,ut=a[_+6],pt=a[_+7];e(et,it,new Float32Array(s,4*_,6),pt)||(d(lt,et+1),d(ut,et+1))}})(0)}raycast(e,i=b.Wl3){const s=this._roots,a=this.geometry,h=[],d=i.isMaterial,_=Array.isArray(i),et=a.groups,nt=d?i.side:i;for(let it=0,lt=s.length;it<lt;it++){const ut=_?i[et[it].materialIndex].side:nt,pt=h.length;if(SM(s[it]),$P(0,a,ut,e,h),R2(),_){const gt=et[it].materialIndex;for(let vt=pt,Ct=h.length;vt<Ct;vt++)h[vt].face.materialIndex=gt}}return h}raycastFirst(e,i=b.Wl3){const s=this._roots,a=this.geometry,h=i.isMaterial,d=Array.isArray(i);let _=null;const et=a.groups,nt=h?i.side:i;for(let it=0,lt=s.length;it<lt;it++){const ut=d?i[et[it].materialIndex].side:nt;SM(s[it]);const pt=eR(0,a,ut,e);R2(),pt!=null&&(_==null||pt.distance<_.distance)&&(_=pt,d&&(pt.face.materialIndex=et[it].materialIndex))}return _}intersectsGeometry(e,i){const s=this.geometry;let a=!1;for(const h of this._roots)if(SM(h),a=lU(0,s,e,i),R2(),a)break;return a}shapecast(e,i,s){const a=this.geometry;if(e instanceof Function){if(i){const ut=i;i=(pt,gt,vt,Ct)=>{const wt=3*gt;return ut(pt,wt,wt+1,wt+2,vt,Ct)}}e={boundsTraverseOrder:s,intersectsBounds:e,intersectsTriangle:i,intersectsRange:null},console.warn("MeshBVH: Shapecast function signature has changed and now takes an object of callbacks as a second argument. See docs for new signature.")}const h=$_.getPrimitive();let{boundsTraverseOrder:d,intersectsBounds:_,intersectsRange:et,intersectsTriangle:nt}=e;if(et&&nt){const ut=et;et=(pt,gt,vt,Ct,wt)=>!!ut(pt,gt,vt,Ct,wt)||kO(pt,gt,a,nt,vt,Ct,h)}else et||(et=nt?(ut,pt,gt,vt)=>kO(ut,pt,a,nt,gt,vt,h):(ut,pt,gt)=>gt);let it=!1,lt=0;for(const ut of this._roots){if(SM(ut),it=aU(0,a,_,et,d,lt),R2(),it)break;lt+=ut.byteLength}return $_.releasePrimitive(h),it}bvhcast(e,i,s){let{intersectsRanges:a,intersectsTriangles:h}=s;const d=this.geometry.index,_=this.geometry.attributes.position,et=e.geometry.index,nt=e.geometry.attributes.position;bS.copy(i).invert();const it=$_.getPrimitive(),lt=$_.getPrimitive();if(h){let gt=function(vt,Ct,wt,xt,_t,Pt,Bt,Ot){for(let Lt=wt,qt=wt+xt;Lt<qt;Lt++){Z_(lt,3*Lt,et,nt),lt.a.applyMatrix4(i),lt.b.applyMatrix4(i),lt.c.applyMatrix4(i),lt.needsUpdate=!0;for(let en=vt,cn=vt+Ct;en<cn;en++)if(Z_(it,3*en,d,_),it.needsUpdate=!0,h(it,lt,en,Lt,_t,Pt,Bt,Ot))return!0}return!1};var pt=gt;if(a){const vt=a;a=function(Ct,wt,xt,_t,Pt,Bt,Ot,Lt){return!!vt(Ct,wt,xt,_t,Pt,Bt,Ot,Lt)||gt(Ct,wt,xt,_t,Pt,Bt,Ot,Lt)}}else a=gt}e.getBoundingBox(rR),rR.applyMatrix4(i);const ut=this.shapecast({intersectsBounds:gt=>rR.intersectsBox(gt),intersectsRange:(gt,vt,Ct,wt,xt,_t)=>(iR.copy(_t),iR.applyMatrix4(bS),e.shapecast({intersectsBounds:Pt=>iR.intersectsBox(Pt),intersectsRange:(Pt,Bt,Ot,Lt,qt)=>a(gt,vt,Pt,Bt,wt,xt,Lt,qt)}))});return $_.releasePrimitive(it),$_.releasePrimitive(lt),ut}intersectsBox(e,i){return m1.set(e.min,e.max,i),m1.needsUpdate=!0,this.shapecast({intersectsBounds:s=>m1.intersectsBox(s),intersectsTriangle:s=>m1.intersectsTriangle(s)})}intersectsSphere(e){return this.shapecast({intersectsBounds:i=>e.intersectsBox(i),intersectsTriangle:i=>i.intersectsSphere(e)})}closestPointToGeometry(e,i,s={},a={},h=0,d=1/0){e.boundingBox||e.computeBoundingBox(),m1.set(e.boundingBox.min,e.boundingBox.max,i),m1.needsUpdate=!0;const _=this.geometry,et=_.attributes.position,nt=_.index,it=e.attributes.position,lt=e.index,ut=$_.getPrimitive(),pt=$_.getPrimitive();let gt=B2,vt=cU,Ct=null,wt=null;a&&(Ct=uU,wt=hU);let xt=1/0,_t=null,Pt=null;return bS.copy(i).invert(),CM.matrix.copy(bS),this.shapecast({boundsTraverseOrder:Bt=>m1.distanceToBox(Bt),intersectsBounds:(Bt,Ot,Lt)=>Lt<xt&&Lt<d&&(Ot&&(CM.min.copy(Bt.min),CM.max.copy(Bt.max),CM.needsUpdate=!0),!0),intersectsRange:(Bt,Ot)=>{if(e.boundsTree)return e.boundsTree.shapecast({boundsTraverseOrder:Lt=>CM.distanceToBox(Lt),intersectsBounds:(Lt,qt,en)=>en<xt&&en<d,intersectsRange:(Lt,qt)=>{for(let en=3*Lt,cn=3*(Lt+qt);en<cn;en+=3){Z_(pt,en,lt,it),pt.a.applyMatrix4(i),pt.b.applyMatrix4(i),pt.c.applyMatrix4(i),pt.needsUpdate=!0;for(let An=3*Bt,mn=3*(Bt+Ot);An<mn;An+=3){Z_(ut,An,nt,et),ut.needsUpdate=!0;const Tn=ut.distanceToTriangle(pt,gt,Ct);if(Tn<xt&&(vt.copy(gt),wt&&wt.copy(Ct),xt=Tn,_t=An/3,Pt=en/3),Tn<h)return!0}}}});for(let Lt=0,qt=lt?lt.count:it.count;Lt<qt;Lt+=3){Z_(pt,Lt,lt,it),pt.a.applyMatrix4(i),pt.b.applyMatrix4(i),pt.c.applyMatrix4(i),pt.needsUpdate=!0;for(let en=3*Bt,cn=3*(Bt+Ot);en<cn;en+=3){Z_(ut,en,nt,et),ut.needsUpdate=!0;const An=ut.distanceToTriangle(pt,gt,Ct);if(An<xt&&(vt.copy(gt),wt&&wt.copy(Ct),xt=An,_t=en/3,Pt=Lt/3),An<h)return!0}}}}),$_.releasePrimitive(ut),$_.releasePrimitive(pt),xt===1/0?null:(s.point?s.point.copy(vt):s.point=vt.clone(),s.distance=xt,s.faceIndex=_t,a&&(a.point?a.point.copy(wt):a.point=wt.clone(),a.point.applyMatrix4(bS),vt.applyMatrix4(bS),a.distance=vt.sub(a.point).length(),a.faceIndex=Pt),s)}closestPointToPoint(e,i={},s=0,a=1/0){const h=s*s,d=a*a;let _=1/0,et=null;if(this.shapecast({boundsTraverseOrder:it=>(MM.copy(e).clamp(it.min,it.max),MM.distanceToSquared(e)),intersectsBounds:(it,lt,ut)=>ut<_&&ut<d,intersectsTriangle:(it,lt)=>{it.closestPointToPoint(e,MM);const ut=e.distanceToSquared(MM);return ut<_&&(B2.copy(MM),_=ut,et=lt),ut<h}}),_===1/0)return null;const nt=Math.sqrt(_);return i.point?i.point.copy(B2):i.point=B2.clone(),i.distance=nt,i.faceIndex=et,i}getBoundingBox(e){return e.makeEmpty(),this._roots.forEach(i=>{K_(0,new Float32Array(i),LO),e.union(LO)}),e}}const NO=vp.prototype.raycast;vp.prototype.raycast=function(...c){if(c[0].isMesh){console.warn('MeshBVH: The function signature and results frame for "raycast" has changed. See docs for new signature.');const[e,i,s,a]=c;return NO.call(this,s,e.material).forEach(h=>{(h=BO(h,e,i))&&a.push(h)}),a}return NO.apply(this,c)};const UO=vp.prototype.raycastFirst;vp.prototype.raycastFirst=function(...c){if(c[0].isMesh){console.warn('MeshBVH: The function signature and results frame for "raycastFirst" has changed. See docs for new signature.');const[e,i,s]=c;return BO(UO.call(this,s,e.material),e,i)}return UO.apply(this,c)};const FO=vp.prototype.closestPointToPoint;vp.prototype.closestPointToPoint=function(...c){if(c[0].isMesh){console.warn('MeshBVH: The function signature and results frame for "closestPointToPoint" has changed. See docs for new signature.'),c.unshift();const e=c[1],i={};return c[1]=i,FO.apply(this,c),e&&e.copy(i.point),i.distance}return FO.apply(this,c)};const jO=vp.prototype.closestPointToGeometry;vp.prototype.closestPointToGeometry=function(...c){const e=c[2],i=c[3];if(e&&e.isVector3||i&&i.isVector3){console.warn('MeshBVH: The function signature and results frame for "closestPointToGeometry" has changed. See docs for new signature.');const s={},a={},h=c[1];return c[2]=s,c[3]=a,jO.apply(this,c),e&&e.copy(s.point),i&&i.copy(a.point).applyMatrix4(h),s.distance}return jO.apply(this,c)};const zO=vp.prototype.refit;vp.prototype.refit=function(...c){const e=c[0],i=c[1];if(i&&(i instanceof Set||Array.isArray(i))){console.warn('MeshBVH: The function signature for "refit" has changed. See docs for new signature.');const s=new Set;i.forEach(a=>s.add(a)),e&&e.forEach(a=>s.add(a)),zO.call(this,s)}else zO.apply(this,c)},["intersectsGeometry","shapecast","intersectsBox","intersectsSphere"].forEach(c=>{const e=vp.prototype[c];vp.prototype[c]=function(...i){return(i[0]===null||i[0].isMesh)&&(i.shift(),console.warn(`MeshBVH: The function signature for "${c}" has changed and no longer takes Mesh. See docs for new signature.`)),e.apply(this,i)}});const sR=[new b.Pa4,new b.Pa4,new b.Pa4];function oR(c){return~~(1e4*c)}function VO(c){return`${oR(c.x)},${oR(c.y)},${oR(c.z)}`}class dU{constructor(e=null){this.data=null,this.unmatchedEdges=null,this.matchedEdges=null,this.useDrawRange=!0,e&&this.updateFrom(e)}getSiblingTriangleIndex(e,i){const s=this.data[3*e+i];return s===-1?-1:~~(s/3)}getSiblingEdgeIndex(e,i){const s=this.data[3*e+i];return s===-1?-1:s%3}updateFrom(e){const i=new Map,{attributes:s}=e,a=e.index,h=s.position;let d=a?a.count/3:h.count/3;const _=d;let et=0;this.useDrawRange&&(et=e.drawRange.start,e.drawRange.count!==1/0&&(d=~~(e.drawRange.count/3)));let nt=this.data;(!nt||nt.length<3*_)&&(nt=new Int32Array(3*_)),nt.fill(-1);let it=0,lt=0;for(let ut=0;ut<d;ut++){const pt=3*ut+et;for(let gt=0;gt<3;gt++){let vt=pt+gt;a&&(vt=a.getX(vt)),sR[gt].fromBufferAttribute(h,vt)}for(let gt=0;gt<3;gt++){const vt=(gt+1)%3,Ct=sR[gt],wt=sR[vt],xt=VO(Ct),_t=VO(wt),Pt=`${_t}_${xt}`;if(i.has(Pt)){const Bt=i.get(Pt);nt[pt+gt]=Bt,nt[Bt]=pt+gt,i.delete(Pt),it--,lt++}else{const Bt=`${xt}_${_t}`;i.set(Bt,pt+gt),it++}}}this.matchedEdges=lt,this.unmatchedEdges=it,this.data=nt}}class k2 extends b.Kj0{constructor(...e){super(...e),this.isBrush=!0,this._previousMatrix=new b.yGw,this._previousMatrix.elements.fill(0)}markUpdated(){this._previousMatrix.copy(this.matrix)}isDirty(){const{matrix:e,_previousMatrix:i}=this,s=e.elements,a=i.elements;for(let h=0;h<16;h++)if(s[h]!==a[h])return!0;return!1}prepareGeometry(){const e=this.geometry,i=e.attributes;if(yO())for(const s in i){const a=i[s];if(a.isInterleavedBufferAttribute)throw new Error("Brush: InterleavedBufferAttributes are not supported.");a.array=$N(a.array)}if(e.boundsTree||(e.boundsTree=new vp(e,{maxLeafTris:3}),e.halfEdges&&e.halfEdges.updateFrom(e)),e.halfEdges||(e.halfEdges=new dU(e)),!e.groupIndices){const s=e.index.count/3,a=new Uint16Array(s),h=e.groups;for(let d=0,_=h.length;d<_;d++){const{start:et,count:nt}=h[d];for(let it=et/3,lt=(et+nt)/3;it<lt;it++)a[it]=d}e.groupIndices=a}}disposeCacheData(){const{geometry:e}=this;e.halfEdges=null,e.boundsTree=null,e.groupIndices=null}}function QO(c,e){let i=e;return Array.isArray(e)||(i=[],c.forEach(s=>{i[s.materialIndex]=e})),i}class pU{constructor(){this.triangleSplitter=new ZN,this.attributeData=new eU,this.attributes=["position","uv","normal"],this.useGroups=!0,this.debug=new nU}evaluate(e,i,s,a=new k2){e.prepareGeometry(),i.prepareGeometry();const{triangleSplitter:h,attributeData:d,attributes:_,useGroups:et,debug:nt}=this,it=a.geometry,lt=e.geometry.attributes;for(let wt=0,xt=_.length;wt<xt;wt++){const _t=_[wt],Pt=lt[_t];d.initializeArray(_t,Pt.array.constructor)}for(const wt in d.attributes)_.includes(wt)||d.delete(wt);for(const wt in it.attributes)_.includes(wt)||(it.deleteAttribute(wt),it.dispose());d.clear(),nt.enabled&&(nt.reset(),fO(nt)),function(wt,xt,_t,Pt,Bt,Ot){const{useGroups:Lt=!0}=Ot,{aIntersections:qt,bIntersections:en}=function(An,mn){const Tn=new cO,vn=new cO;return uO.copy(An.matrixWorld).invert().multiply(mn.matrixWorld),An.geometry.boundsTree.bvhcast(mn.geometry.boundsTree,uO,{intersectsTriangles:(xn,Un,Mn,Gn)=>(xn.intersectsTriangle(Un,WP)&&WP.distance()>1e-5&&(Tn.add(Mn,Gn),vn.add(Gn,Mn),A2&&(A2.addEdge(WP),A2.addIntersectingTriangles(Mn,xn,Gn,Un))),!1)}),{aIntersections:Tn,bIntersections:vn}}(wt,xt);let cn;cn=Lt?0:-1,EO(wt,xt,qt,_t,!1,Bt,cn),bO(wt,xt,qt,_t,!1,Pt,Bt,cn),cn=Lt?wt.geometry.groups.length||1:-1,EO(xt,wt,en,_t,!0,Bt,cn),bO(xt,wt,en,_t,!0,Pt,Bt,cn)}(e,i,s,h,d,{useGroups:et}),nt.enabled&&fO(null);const ut=et&&e.geometry.groups.length!==0?e.geometry.groups.map(wt=>({...wt})):[{start:0,count:1/0,materialIndex:0}],pt=et&&i.geometry.groups.length!==0?i.geometry.groups.map(wt=>({...wt})):[{start:0,count:1/0,materialIndex:0}],gt=QO(ut,e.material),vt=QO(pt,i.material);pt.forEach(wt=>{wt.materialIndex+=gt.length}),function(wt,xt,_t,Pt){let Bt=!1,Ot=-1;const Lt=Pt.groupCount,qt=wt.attributes,en=Pt.groupAttributes[0];for(const An in en){const mn=Pt.getTotalLength(An,Lt),Tn=en[An].type;let vn=qt[An];if(!vn||vn.array.length<mn){const Un=xt.attributes[An];vn=new b.TlE(new Tn(mn),Un.itemSize,Un.normalized),wt.setAttribute(An,vn),Bt=!0}let xn=0;for(let Un=0;Un<Lt;Un++){const{array:Mn,type:Gn,length:rr}=Pt.groupAttributes[Un][An],dr=new Gn(Mn.buffer,0,rr);vn.array.set(dr,xn),xn+=dr.length}vn.needsUpdate=!0,Ot=mn/vn.itemSize}wt.setDrawRange(0,Ot),wt.clearGroups();let cn=0;for(let An=0;An<Lt;An++){const mn=Pt.getGroupArray("position",An).length/3;if(mn!==0){const Tn=_t[An];wt.addGroup(cn,mn,Tn.materialIndex),cn+=mn}}if(wt.index){const An=wt.index.array;if(An.length<Ot)wt.index=null,Bt=!0;else for(let mn=0,Tn=An.length;mn<Tn;mn++)An[mn]=mn}wt.boundsTree=null,Bt&&wt.dispose()}(it,e.geometry,[...ut,...pt],d);const Ct=it.groups;if(et){const wt=new Map,xt=[...gt,...vt];let _t=0;for(let Pt=0,Bt=xt.length;Pt<Bt;Pt++)Boolean(Ct.find(Ot=>Ot.materialIndex===Pt))?(wt.set(Pt,_t),_t++):xt[Pt]=null;for(let Pt=0,Bt=Ct.length;Pt<Bt;Pt++){const Ot=Ct[Pt];Ot.materialIndex=wt.get(Ot.materialIndex)}a.material=xt.filter(Pt=>Pt)}return a}evaluateHierarchy(e,i=new k2){e.updateMatrixWorld(!0);const s=(h,d)=>{const _=h.children;for(let et=0,nt=_.length;et<nt;et++){const it=_[et];it.isOperationGroup?s(it,d):d(it)}},a=h=>{const d=h.children;let _=!1;for(let nt=0,it=d.length;nt<it;nt++){const lt=d[nt];_=a(lt)||_}const et=h.isDirty();if(et&&h.markUpdated(),_&&!h.isOperationGroup){let nt;return s(h,it=>{nt=nt?this.evaluate(nt,it,it.operation):this.evaluate(h,it,it.operation)}),h._cachedGeometry=nt.geometry,h._cachedMaterials=nt.material,!0}return _||et};return a(e),i.geometry=e._cachedGeometry,i.material=e._cachedMaterials,i}reset(){this.triangleSplitter.reset()}}const GO={union:0,subtract:1,intersect:4,difference:3};function HO(c,e){const i=new pU;i.useGroups=!0,i.attributes=["position","normal","uv"],c.forEach(h=>{for(const d of[...i.attributes])h[0].geometry.getAttribute(d)||i.attributes.splice(i.attributes.indexOf(d),1)});let s=new k2(new b._12(.01,.01,2,2));c.forEach(([h,d])=>{if(!Object.keys(GO).includes(d))return void console.error(`Unknown operation ${d}`);h.updateMatrix(),h.updateMatrixWorld();const _=new k2;_.geometry=h.geometry,_.material=h.material,h.matrixWorld.decompose(_.position,_.quaternion,_.scale),_.updateMatrix(),_.updateMatrixWorld(),s=i.evaluate(s,_,GO[d])});const a=s;return a.userData._isCSGMesh=!0,a}let O2=class extends dy{_buildCSGMesh(c){return HO(c)}};O2.PluginType="CSGPluginBVH",O2=function(c,e,i,s){var a,h=arguments.length,d=h<3?e:s===null?s=Object.getOwnPropertyDescriptor(e,i):s;if(typeof Reflect=="object"&&typeof Reflect.decorate=="function")d=Reflect.decorate(c,e,i,s);else for(var _=c.length-1;_>=0;_--)(a=c[_])&&(d=(h<3?a(d):h>3?a(e,i,d):a(e,i))||d);return h>3&&d&&Object.defineProperty(e,i,d),d}([Ys("CSG Plugin (BVH)")],O2);class L2 extends Ls{constructor(){super(...arguments),this.enabled=!0,this.toJSON=void 0,this._cameraChanged=e=>{var i,s,a,h;(s=(i=e.lastCamera)===null||i===void 0?void 0:i.removeControlsCtor)===null||s===void 0||s.call(i,this.controlsKey),(h=(a=e.camera)===null||a===void 0?void 0:a.setControlsCtor)===null||h===void 0||h.call(a,this.controlsKey,this._controlsCtor)}}async onAdded(e){await super.onAdded(e),this._cameraChanged({camera:e.scene.activeCamera}),e.scene.addEventListener("activeCameraChange",this._cameraChanged)}async onRemove(e){return this._cameraChanged({lastCamera:e.scene.activeCamera}),e.scene.removeEventListener("activeCameraChange",this._cameraChanged),super.onRemove(e)}}var WO=function(c,e,i,s){var a,h=arguments.length,d=h<3?e:s===null?s=Object.getOwnPropertyDescriptor(e,i):s;if(typeof Reflect=="object"&&typeof Reflect.decorate=="function")d=Reflect.decorate(c,e,i,s);else for(var _=c.length-1;_>=0;_--)(a=c[_])&&(d=(h<3?a(d):h>3?a(e,i,d):a(e,i))||d);return h>3&&d&&Object.defineProperty(e,i,d),d};const fU=new b.Pa4(0,0,1),qO=new b.USm,mU=new b._fP,gU=new b._fP(-Math.sqrt(.5),0,0,Math.sqrt(.5)),ES=new b._fP,vU={type:"change"};let TM=class extends ot{constructor(c){super(),this.enabled=!1,this.lastOrder="XYZ",this.dampingFactor=.05,this.lastQuaternion=new b._fP,this.onDeviceOrientationChangeEvent=e=>{this.deviceOrientation=e},this.onScreenOrientationChangeEvent=()=>{this.screenOrientation=screen.orientation},this._initQuaternion=new b._fP,this._initQuaternionInvert=new b._fP,this._initQuaternionDest=new b._fP,this._lastTime=-1,window.isSecureContext===!1&&console.error("DeviceOrientationControls2: DeviceOrientationEvent is only available in secure contexts (https)"),this.object=c,this.lastOrder=this.object.rotation.order,this.object.rotation.reorder("YXZ"),this.connect()}connect(){this.onScreenOrientationChangeEvent(),window.DeviceOrientationEvent!==void 0&&typeof window.DeviceOrientationEvent.requestPermission=="function"?window.DeviceOrientationEvent.requestPermission().then(c=>{c=="granted"&&(window.addEventListener("orientationchange",this.onScreenOrientationChangeEvent),window.addEventListener("deviceorientation",this.onDeviceOrientationChangeEvent))}).catch(c=>{console.error("DeviceOrientationControls2: Unable to use DeviceOrientation API:",c)}):(window.addEventListener("orientationchange",this.onScreenOrientationChangeEvent),window.addEventListener("deviceorientation",this.onDeviceOrientationChangeEvent)),this.enabled=!0,this._initQuaternion.copy(this.object.quaternion),this._initQuaternionInvert.copy(this.object.quaternion).invert()}disconnect(){window.removeEventListener("orientationchange",this.onScreenOrientationChangeEvent),window.removeEventListener("deviceorientation",this.onDeviceOrientationChangeEvent),this._initQuaternion.identity(),this._initQuaternionInvert.identity(),this._initQuaternionDest=new b._fP,this.object.rotation.reorder(this.lastOrder),this.lastOrder="XYZ",this.enabled=!1}update(){if(!this.enabled)return;const c=this.deviceOrientation;if(c){const e=c.alpha!==null?b.M8C.degToRad(c.alpha):0,i=c.beta!==null?b.M8C.degToRad(c.beta):0,s=c.gamma!==null?b.M8C.degToRad(c.gamma):0,a=this.screenOrientation?b.M8C.degToRad(this.screenOrientation.angle):0;this.setObjectQuaternion(e,i,s,a),8*(1-this.lastQuaternion.dot(this.object.quaternion))>1e-6&&(this.lastQuaternion.copy(this.object.quaternion),this.dispatchEvent(vU))}}dispose(){this.disconnect()}setObjectQuaternion(c,e,i,s){const a=Yu()/1e3;qO.set(e,c,-i,"YXZ"),ES.setFromEuler(qO),ES.multiply(gU),ES.multiply(mU.setFromAxisAngle(fU,-s)),this._initQuaternionDest.__init||(this._initQuaternionDest.copy(ES).invert(),this._initQuaternionDest.__init=!0),ES.premultiply(this._initQuaternionDest),this.object.quaternion.slerp(ES,this.dampingFactor/(Math.min(1,a-this._lastTime)/(1/60))),this._lastTime=a}};WO([Fn(),ss("Damping",[0,1],.01)],TM.prototype,"dampingFactor",void 0),TM=WO([e_("Device Orientation Controls")],TM);class aR extends L2{constructor(){super(...arguments),this.controlsKey="deviceOrientation",this._controlsCtor=(e,i)=>new TM(e)}}aR.PluginType="DeviceOrientationControlsPlugin";var Op=function(c,e,i,s){var a,h=arguments.length,d=h<3?e:s===null?s=Object.getOwnPropertyDescriptor(e,i):s;if(typeof Reflect=="object"&&typeof Reflect.decorate=="function")d=Reflect.decorate(c,e,i,s);else for(var _=c.length-1;_>=0;_--)(a=c[_])&&(d=(h<3?a(d):h>3?a(e,i,d):a(e,i))||d);return h>3&&d&&Object.defineProperty(e,i,d),d};const YO=new b.Pa4,lR=new b.$V,cR=new b.Pa4,_U={type:"change"};let ju=class extends ot{constructor(c,e){super(),this.enabled=!0,this.enableKeys=!0,this.movementSpeed=1,this.lookSpeed=.005,this.lookVertical=!0,this.autoForward=!1,this.activeLook=!0,this.heightSpeed=!1,this.heightCoef=1,this.heightMin=0,this.heightMax=1,this.constrainVertical=!1,this.verticalMin=0,this.verticalMax=Math.PI,this.mouseDragOn=!1,this.autoSpeedFactor=0,this.mouseX=0,this.mouseY=0,this.moveForward=!1,this.moveBackward=!1,this.moveLeft=!1,this.moveRight=!1,this.moveUp=!1,this.moveDown=!1,this.viewHalfX=0,this.viewHalfY=0,this.lat=0,this.lon=0,this.targetPosition=new b.Pa4,this._lastTime=-1,this.object=c,this.domElement=e,this.onMouseMove=this.onMouseMove.bind(this),this.onMouseDown=this.onMouseDown.bind(this),this.onMouseUp=this.onMouseUp.bind(this),this.onKeyDown=this.onKeyDown.bind(this),this.onKeyUp=this.onKeyUp.bind(this),this.onContextMenu=this.onContextMenu.bind(this),this.domElement.addEventListener("contextmenu",this.onContextMenu),this.domElement.addEventListener("mousemove",this.onMouseMove),this.domElement.addEventListener("mousedown",this.onMouseDown),this.domElement.addEventListener("mouseup",this.onMouseUp),window.addEventListener("keydown",this.onKeyDown),window.addEventListener("keyup",this.onKeyUp),this.handleResize(),this.setOrientation()}setOrientation(){const c=this.object.quaternion;YO.set(0,0,-1).applyQuaternion(c),lR.setFromVector3(YO),this.lat=90-b.M8C.radToDeg(lR.phi),this.lon=b.M8C.radToDeg(lR.theta)}handleResize(){this.domElement===document?(this.viewHalfX=window.innerWidth/2,this.viewHalfY=window.innerHeight/2):(this.viewHalfX=this.domElement.offsetWidth/2,this.viewHalfY=this.domElement.offsetHeight/2)}onMouseDown(c){if(this.domElement!==document&&this.domElement.focus(),this.activeLook)switch(c.button){case 0:this.moveForward=!0;break;case 2:this.moveBackward=!0}this.mouseDragOn=!0}onMouseUp(c){if(this.activeLook)switch(c.button){case 0:this.moveForward=!1;break;case 2:this.moveBackward=!1}this.mouseDragOn=!1}onMouseMove(c){this.domElement===document?(this.mouseX=c.pageX-this.viewHalfX,this.mouseY=c.pageY-this.viewHalfY):(this.mouseX=c.pageX-this.domElement.offsetLeft-this.viewHalfX,this.mouseY=c.pageY-this.domElement.offsetTop-this.viewHalfY)}onKeyDown(c){if(this.enableKeys)switch(c.code){case"ArrowUp":case"KeyW":this.moveForward=!0;break;case"ArrowLeft":case"KeyA":this.moveLeft=!0;break;case"ArrowDown":case"KeyS":this.moveBackward=!0;break;case"ArrowRight":case"KeyD":this.moveRight=!0;break;case"KeyR":this.moveUp=!0;break;case"KeyF":this.moveDown=!0}}onKeyUp(c){if(this.enableKeys)switch(c.code){case"ArrowUp":case"KeyW":this.moveForward=!1;break;case"ArrowLeft":case"KeyA":this.moveLeft=!1;break;case"ArrowDown":case"KeyS":this.moveBackward=!1;break;case"ArrowRight":case"KeyD":this.moveRight=!1;break;case"KeyR":this.moveUp=!1;break;case"KeyF":this.moveDown=!1}}lookAt(c,e,i){return c.isVector3?cR.copy(c):e===void 0||i===void 0?console.error("FirstPersonControls2.lookAt: y and z parameters are required"):cR.set(c,e,i),this.object.lookAt(cR),this.setOrientation(),this}update(){const c=Yu(),e=(this._lastTime<0?16:Math.min(c-this._lastTime,1e3))/1e3;if(this._lastTime=c,!this.enabled)return;if(this.heightSpeed){const et=b.M8C.clamp(this.object.position.y,this.heightMin,this.heightMax)-this.heightMin;this.autoSpeedFactor=e*(et*this.heightCoef)}else this.autoSpeedFactor=0;const i=e*this.movementSpeed;(this.moveForward||this.autoForward&&!this.moveBackward)&&this.object.translateZ(-(i+this.autoSpeedFactor)),this.moveBackward&&this.object.translateZ(i),this.moveLeft&&this.object.translateX(-i),this.moveRight&&this.object.translateX(i),this.moveUp&&this.object.translateY(i),this.moveDown&&this.object.translateY(-i);let s=e*this.lookSpeed;this.activeLook||(s=0);let a=1;this.constrainVertical&&(a=Math.PI/(this.verticalMax-this.verticalMin)),this.lon-=this.mouseX*s,this.lookVertical&&(this.lat-=this.mouseY*s*a),this.lat=Math.max(-85,Math.min(85,this.lat));let h=b.M8C.degToRad(90-this.lat);const d=b.M8C.degToRad(this.lon);this.constrainVertical&&(h=b.M8C.mapLinear(h,0,Math.PI,this.verticalMin,this.verticalMax));const _=this.object.position;this.targetPosition.setFromSphericalCoords(1,h,d).add(_),this.object.lookAt(this.targetPosition),this.dispatchEvent(_U)}dispose(){this.domElement.removeEventListener("contextmenu",this.onContextMenu),this.domElement.removeEventListener("mousedown",this.onMouseDown),this.domElement.removeEventListener("mousemove",this.onMouseMove),this.domElement.removeEventListener("mouseup",this.onMouseUp),window.removeEventListener("keydown",this.onKeyDown),window.removeEventListener("keyup",this.onKeyUp)}onContextMenu(c){this.enableKeys&&c.preventDefault()}};Op([Fn(),ts()],ju.prototype,"enabled",void 0),Op([Fn(),ts()],ju.prototype,"enableKeys",void 0),Op([Fn(),qs()],ju.prototype,"movementSpeed",void 0),Op([Fn(),qs()],ju.prototype,"lookSpeed",void 0),Op([Fn(),ts()],ju.prototype,"lookVertical",void 0),Op([Fn(),ts()],ju.prototype,"autoForward",void 0),Op([Fn(),ts()],ju.prototype,"activeLook",void 0),Op([Fn(),ts()],ju.prototype,"heightSpeed",void 0),Op([Fn(),qs()],ju.prototype,"heightCoef",void 0),Op([Fn(),qs()],ju.prototype,"heightMin",void 0),Op([Fn(),qs()],ju.prototype,"heightMax",void 0),Op([Fn(),ts()],ju.prototype,"constrainVertical",void 0),Op([Fn(),qs()],ju.prototype,"verticalMin",void 0),Op([Fn(),qs()],ju.prototype,"verticalMax",void 0),Op([Fn(),ts()],ju.prototype,"mouseDragOn",void 0),ju=Op([Ys("First Person Controls")],ju);class uR extends L2{constructor(){super(...arguments),this.controlsKey="firstPerson",this._controlsCtor=(e,i)=>new ju(e,i)}}uR.PluginType="FirstPersonControlsPlugin";var SS=function(c,e,i,s){var a,h=arguments.length,d=h<3?e:s===null?s=Object.getOwnPropertyDescriptor(e,i):s;if(typeof Reflect=="object"&&typeof Reflect.decorate=="function")d=Reflect.decorate(c,e,i,s);else for(var _=c.length-1;_>=0;_--)(a=c[_])&&(d=(h<3?a(d):h>3?a(e,i,d):a(e,i))||d);return h>3&&d&&Object.defineProperty(e,i,d),d};const CS=new b.USm(0,0,0,"YXZ"),MS=new b.Pa4,AU={type:"change"},yU={type:"lock"},wU={type:"unlock"},XO=Math.PI/2;let fy=class extends ot{constructor(c,e){super(),this.isLocked=!1,this.enabled=!0,this.minPolarAngle=0,this.maxPolarAngle=Math.PI,this.pointerSpeed=1,this.autoLockOnClick=!0,this._movementX=0,this._movementY=0,this._forwardDirection=new b.Pa4(0,0,-1),this.domElement=e,this.object=c,this.onElementClick=this.onElementClick.bind(this),this.onMouseMove=this.onMouseMove.bind(this),this.onPointerlockChange=this.onPointerlockChange.bind(this),this.onPointerlockError=this.onPointerlockError.bind(this),this.connect()}onElementClick(c){this.isLocked||this.autoLockOnClick&&(c.preventDefault(),this.lock())}onMouseMove(c){this.isLocked&&(this._movementX+=c.movementX||c.mozMovementX||c.webkitMovementX||0,this._movementY+=c.movementY||c.mozMovementY||c.webkitMovementY||0)}onPointerlockChange(){this.domElement.ownerDocument.pointerLockElement===this.domElement?(this.dispatchEvent(yU),this.isLocked=!0):(this.dispatchEvent(wU),this.isLocked=!1)}onPointerlockError(){console.error("THREE.PointerLockControls: Unable to use Pointer Lock API")}connect(){this.domElement.ownerDocument.addEventListener("mousemove",this.onMouseMove),this.domElement.ownerDocument.addEventListener("pointerlockchange",this.onPointerlockChange),this.domElement.ownerDocument.addEventListener("pointerlockerror",this.onPointerlockError),this.domElement.addEventListener("click",this.onElementClick)}disconnect(){this.domElement.ownerDocument.removeEventListener("mousemove",this.onMouseMove),this.domElement.ownerDocument.removeEventListener("pointerlockchange",this.onPointerlockChange),this.domElement.ownerDocument.removeEventListener("pointerlockerror",this.onPointerlockError),this.domElement.removeEventListener("click",this.onElementClick)}dispose(){this.disconnect()}getDirection(c){return c.copy(this._forwardDirection).applyQuaternion(this.object.quaternion)}moveForward(c){MS.setFromMatrixColumn(this.object.matrix,0),MS.crossVectors(this.object.up,MS),this.object.position.addScaledVector(MS,c)}moveRight(c){MS.setFromMatrixColumn(this.object.matrix,0),this.object.position.addScaledVector(MS,c)}lock(){this.domElement.requestPointerLock()}unlock(){this.domElement.ownerDocument.exitPointerLock()}update(){this._movementX<1e-4||this._movementY<1e-4||(CS.setFromQuaternion(this.object.quaternion),CS.y-=.002*this._movementX*this.pointerSpeed,CS.x-=.002*this._movementY*this.pointerSpeed,this._movementX=0,this._movementY=0,CS.x=Math.max(XO-this.maxPolarAngle,Math.min(XO-this.minPolarAngle,CS.x)),this.object.quaternion.setFromEuler(CS),this.dispatchEvent(AU))}};SS([ts(),Fn()],fy.prototype,"enabled",void 0),SS([qs(),Fn()],fy.prototype,"minPolarAngle",void 0),SS([qs(),Fn()],fy.prototype,"maxPolarAngle",void 0),SS([qs(),Fn()],fy.prototype,"pointerSpeed",void 0),SS([ts(),Fn()],fy.prototype,"autoLockOnClick",void 0),fy=SS([e_("Pointer Lock Controls")],fy);class hR extends L2{constructor(){super(...arguments),this.controlsKey="pointerLock",this._controlsCtor=(e,i)=>new fy(e,i.ownerDocument?i:i.documentElement)}}hR.PluginType="PointerLockControlsPlugin";var xU=__webpackgi_require__(819);class i0{static _initialize(){this._inited=!0,r_(Wt`
          #customContextMenu {
            background: #2c2c2e99;
            backdrop-filter: blur(8px);
            border: 0.5px solid rgba(20, 20, 20, 0.3);
            width: auto;
            height: auto;
            position: absolute;
            display: flex;
            flex-direction: column;
            z-index: 9999;
            padding: 0.35rem 0.20rem;
            border-radius: 0.375rem;
            min-width: 6rem;
            pointer-events: auto;
            box-shadow: 0px 2px 10px rgba(12, 12, 12, 0.2);
          }

          .customContextMenuItems {
            color: white;
            font-size: 0.65rem;
            font-family: "Roboto Mono", "Source Code Pro", Menlo, Courier, monospace;
            background-color: transparent;
            cursor: pointer;
            padding: 0.12rem 0.35rem;
            border-radius: 0.25rem;
            line-height: 1rem;
            font-weight: 500;
          }

          .customContextMenuItems:hover {
            color: white;
            background-color: #017AFF;
          }
        `),document.addEventListener("mouseup",e=>{this.Element&&!this.Element.contains(e.target)&&this.Remove()})}static Create(e,i,s){this._inited||this._initialize(),this.Element&&this.Remove();const a=rp({id:"customContextMenu",addToBody:!1});a.style.top=s+"px",a.style.left=i+"px";for(const[h,d]of Object.entries(e)){const _=rp({classList:["customContextMenuItems"],addToBody:!1,innerHTML:h});a.appendChild(_),_.onclick=d}return this.Element=a,a}static Remove(){var e;(e=this.Element)===null||e===void 0||e.remove(),this.Element=void 0}}i0.Element=void 0,i0._inited=!1;var bU=__webpackgi_require__(665);const EU=(c,e,i)=>{var s,a,h;const d=c.controller_,_=(a=(s=d.parent)===null||s===void 0?void 0:s.children)===null||a===void 0?void 0:a.indexOf(d);return!(((nt,it)=>it.controller_.rackController.rack===nt.controller_.parent)(c,e)&&_===i||(_!==void 0&&_>=0&&((h=d.parent)===null||h===void 0||h.remove(c)),e.add(c,i),0))},KO=(c,e,i,s)=>{var a,h,d,_,et;let nt=e.uiRef;const it=nt==null?void 0:nt.expanded;if(nt||(nt=c.addFolder({title:""}),nt.on("fold",Ct=>{var wt,xt,_t;let Pt=nt.expanded;bn(e,"expanded",Pt,!0),Pt=(wt=Yt(e.expanded))!==null&&wt!==void 0?wt:Pt,Pt!==nt.expanded&&(nt.expanded=Pt),(xt=e.uiRefresh)===null||xt===void 0||xt.call(e,"postFrame",!0),Pt&&((_t=e.onExpand)===null||_t===void 0||_t.call(e,e))})),!nt)return nt;nt.expanded=(h=(a=Yt(e.expanded))!==null&&a!==void 0?a:it)!==null&&h!==void 0&&h;const lt=((d=e.children)!==null&&d!==void 0?d:[]).map(Ct=>Ct&&Yt(Ct)).flat(2).filter(Ct=>Ct);let ut=0;for(const Ct of lt){let wt=Ct.uiRef;wt&&wt.controller_.viewProps.get("disposed")&&(Ct.uiRef=void 0),wt=Ct.uiRef,wt||(i.appendUiObject({uiConfig:Ct},nt),wt=Ct.uiRef),wt&&EU(wt,nt,ut++)&&i.appendUiObject({uiConfig:Ct},nt)}let pt=nt.children;for(;pt.length>ut;){const Ct=pt[pt.length-1];nt.remove(Ct),pt=nt.children}nt.controller_.props.set("title",(_=Yt(e.label))!==null&&_!==void 0?_:"");const gt=nt.controller_.view.containerElement,vt=Yt(e.domChildren,[]);if((vt==null?void 0:vt.length)!==void 0){const Ct=[];for(let wt=0;wt<gt.children.length;wt++){const xt=gt.children[wt];!((et=xt.dataset)===null||et===void 0)&&et.tpCustomDOM&&Ct.push(xt)}for(const wt of Ct)gt.removeChild(wt);for(const wt of vt)wt.parentElement!==gt&&(gt.appendChild(wt),wt.dataset.tpCustomDOM="true");nt.controller_.foldable.cleanUpTransition()}return nt},SU=(c,e,i,s)=>{var a,h;const[d,_]=(a=e.property)!==null&&a!==void 0?a:[void 0,void 0],et=(h=Yt(e.label))!==null&&h!==void 0?h:_;let nt=e.uiRef;return nt||(nt=c.addButton({title:""}),nt.on("click",async()=>{var it;const lt=[];e.prompt&&lt.push(await i.prompt(...e.prompt));const ut=(it=d&&_?d[_]:void 0)!==null&&it!==void 0?it:e.value;if(typeof ut=="function"){const pt=()=>{i.removeEventListener("postFrame",pt),ut(...lt)};i.addEventListener("postFrame",pt)}else console.warn("Invalid action type for button")})),nt&&(nt.title=et??"click me"),nt},CU=(c,e,i,s)=>{var a;const h=Object.fromEntries(((a=Yt(e.children))!==null&&a!==void 0?a:[]).map(d=>Yt(d)).flat(2).filter(d=>d).map(d=>{var _;const et=Yt(d.label);return[et,(_=d.value)!==null&&_!==void 0?_:et]}));return eA(c,e,i,{options:h,...s??{}})},MU=(c,e,i,s)=>{var a,h;const d=Yt(e.bounds),_=((a=d==null?void 0:d.length)!==null&&a!==void 0?a:0)>=2?d[1]:1,et=((h=d==null?void 0:d.length)!==null&&h!==void 0?h:0)>=1?d[0]:0,nt=e.stepSize||void 0;return eA(c,e,i,{min:et,max:_,step:nt,...s??{}})},N2=(c,e,i,s)=>{var a,h,d;const _=Yt(e.bounds);if(!_||_.length<1)return eA(c,e,i,{...s??{}});const et=((a=_.length)!==null&&a!==void 0?a:0)>=2?_[1]:1,nt=((h=_.length)!==null&&h!==void 0?h:0)>=1?_[0]:0,it={min:nt,max:et,step:(d=e.stepSize)!==null&&d!==void 0?d:(et-nt)/100},lt={x:it,y:it};e.type!=="vec3"&&e.type!=="vec4"||(lt.z=it),e.type==="vec4"&&(lt.w=it);const ut=e.property;if(e.value===void 0&&ut&&ut[0]&&typeof ut[0]=="object"&&ut[0][ut[1]]&&Array.isArray(ut[0][ut[1]])){const[pt,gt]=ut,vt=pt[gt],Ct=vt.length,wt=new(Ct===2?b.FM8:Ct===3?b.Pa4:b.Ltg)().fromArray(vt);e.value=wt,e.property=void 0,e.onChange=[()=>{pt[gt]=wt.toArray()},...Array.isArray(e.onChange)?e.onChange:[e.onChange]].filter(xt=>xt),e.label===void 0&&(e.label=gt)}return eA(c,e,i,{...lt,...s??{}})},TU=(c,e,i,s)=>{var a;const h=e.property;if(e.value===void 0&&h&&typeof h[0]=="object"&&(!((a=h[0][h[1]])===null||a===void 0)&&a.isColor)){const[d,_]=h,et=new mo().set(d[_]).convertSRGBToLinear();Object.defineProperty(e,"value",{get:()=>{const nt=d[_];return nt?et.set(nt).convertLinearToSRGB().getHex():0},set:nt=>{const it=d[_];et.setHex(nt).convertSRGBToLinear(),it.isColor?it.copy(et):typeof it=="number"?d[_]=et.getHex():typeof it=="string"&&(d[_]="#"+et.getHexString()),typeof(d==null?void 0:d.setDirty)=="function"&&d.setDirty()}}),e.property=void 0,e.onChange=[...Array.isArray(e.onChange)?e.onChange:[e.onChange]].filter(nt=>nt),e.label===void 0&&(e.label=_)}return(s=s??{}).view="color",Yt(e.inlinePicker)&&(s.picker="inline"),eA(c,e,i,s)},eA=(c,e,i,s)=>{var a;let h=Yt(e.property);if((e.getValue||e.setValue)&&h&&console.error("specify either property or value, or getValue and setValue",e),h)e.value&&console.warn("Both property and value are defined, value will be ignored",e);else if(e.value===void 0&&(e.getValue||e.setValue)&&(Object.defineProperty(e,"value",{get:()=>{var et;return(et=e.getValue)===null||et===void 0?void 0:et.call(e)},set:et=>{var nt;return(nt=e.setValue)===null||nt===void 0?void 0:nt.call(e,et)}}),h=[e,"value"]),h||e.value===void 0||(h=[e,"value"]),!h)return void console.error("cannot determine property",e);s=s??{};const d={label:(a=Yt(e.label))!==null&&a!==void 0?a:h[1],...s};let _=e.uiRef;if(!_&&typeof h[0]=="object"&&h[0]){const[et,nt]=h;try{_=e.isMonitor?c.addMonitor(et,nt,d):c.addInput(et,nt,d).on("change",it=>{[e.onChange].flat().forEach(lt=>typeof lt=="function"&&(lt==null?void 0:lt(it))),typeof(et==null?void 0:et.setDirty)=="function"&&et.setDirty(it)})}catch(it){if(!it.message.startsWith("No matching controller for"))throw it;_=void 0}}if(_){for(const[et,nt]of Object.entries(d)){const it=_.controller_.props.value(et);it!==void 0&&it.rawValue!==nt&&_.controller_.props.set(et,nt)}e.type==="slider"&&(d.min!==void 0&&_.controller_.valueController.sliderController.props.set("minValue",d.min),d.max!==void 0&&_.controller_.valueController.sliderController.props.set("maxValue",d.max)),_.refresh()}return _};class JO extends ot{constructor(e=!1,i=!1,s=!1,a=!0,h=document.body){super(),this._refreshQueue={preRender:[],postRender:[],preFrame:[],postFrame:[]},this._lastModeTime={preRender:0,postRender:0,preFrame:0,postFrame:0},this._typeGenerators={panel:KO,folder:KO,input:eA,slider:MU,dropdown:CU,checkbox:eA,color:TU,vec:N2,vec2:N2,vec3:N2,vec4:N2,button:SU,monitor:(_,et,nt,it)=>(et.isMonitor=!0,eA(_,et,nt,it)),dummy:(_,et,nt,it)=>eA(_,et,nt,it)},this.alert=async _=>alert(_),this.confirm=async _=>confirm(_),this.prompt=async(_,et,nt=!0)=>prompt(_,et),this._expand=e,this._limitedOptions=s;const d=this._createUiContainer();h.appendChild(d),this._pane=new bU.Pane({title:"Configuration",container:d}),this._pane.expanded=this._expand,a&&(this.addEventListener("postFrame",()=>this.refreshQueue("postFrame")),setTimeout(()=>{this.dispatchEvent({type:"postFrame"})},32))}refreshQueue(e){const i=this._refreshQueue[e],s=[],a=Yu(),h=a-this._lastModeTime[e];i.forEach(d=>{d[2]>.001?(d[2]-=h,s.push(d)):this._refreshUiObject(d[0],d[1],d[2])}),this._refreshQueue[e]=s,this._lastModeTime[e]=a}addToRefreshQueue(e,i){var s;const a=(s=i[0])===null||s===void 0?void 0:s.uiConfig,h=a==null?void 0:a.uuid,d=this._refreshQueue[e],_=d.find(et=>et[3]===h);_?_[2]=Math.max(_[2],i[2]):d.push([...i,h]),this._refreshQueue[e]=d}dispose(){var e;(e=this._pane)===null||e===void 0||e.dispose(),this._pane=void 0}appendUiObject(e,i){e&&this._appendUiObject(e,i)}_appendUiObject(e,i){var s,a,h,d;const{uiConfig:_}=e??{};if(_&&(!this._limitedOptions||_.limitedUi)&&(i=i??this._pane,_.type)){_.uuid||(_.uuid=gu()),_.uiRef&&_.uiRefType!==_.type&&this.removeUiConfig(_);const et=(a=(s=this._typeGenerators)[_.type])===null||a===void 0?void 0:a.call(s,i,_,this);et&&(et.hidden=(h=Yt(_.hidden))!==null&&h!==void 0&&h,et.disabled=(d=Yt(_.disabled))!==null&&d!==void 0&&d),_.uiRef=et,_.uiRefType=et?_.type:void 0,_.uiRefresh=(nt="postFrame",it=!1,lt=0)=>{var ut;return this._uiObjectRefresh(nt,(ut=e==null?void 0:e.uiConfig)!==null&&ut!==void 0?ut:_,i,it,lt)}}}removeUiObject(e){this.removeUiConfig(e==null?void 0:e.uiConfig)}removeUiConfig(e){var i,s;e&&e.uiRef&&((s=(i=e.uiRef).dispose)===null||s===void 0||s.call(i),e.uiRef=void 0,e.uiRefType=void 0,e.uiRefresh=void 0)}_uiObjectRefresh(e,i,s,a,h){(a?dR(i,s):[{uiConfig:i,parentFolder:s}]).forEach(d=>{const _=[{uiConfig:d.uiConfig},d.parentFolder,h];e==="immediate"?this._refreshUiObject(..._):this.addToRefreshQueue(e,_)})}_refreshUiObject(e,i,s=0){this._appendUiObject(e,i),s>1e-4&&console.error("no support for immediate delay")}_createUiContainer(){const e=rp({id:"tweakpaneUiContainer",addToBody:!1});return r_(Wt`
          :root{
            --tweakpane-ui-container-width: 300px;
          }
          @media only screen and (min-width: 1500px) {
            :root{
              --tweakpane-ui-container-width: 300px;
            }
          }
          @media only screen and (min-width: 2500px) {
            :root{
              --tweakpane-ui-container-width: 500px;
            }
          }
          #tweakpaneUiContainer {
            position: fixed;
            top: 0px;
            padding-right: 4px;
            padding-bottom: 10px;
            right: 10px;
            width: var(--tweakpane-ui-container-width);
            height: auto;
            overflow-y: scroll;
            z-index: 100;
            pointer-events: auto;
            max-height: calc(100% - 6rem);
            border-radius: 0.5rem;
            font-family: Inter, ui-sans-serif, system-ui, -apple-system, "system-ui", "Segoe UI", Roboto, "Helvetica Neue", Arial, "Noto Sans", sans-serif, "Apple Color Emoji", "Segoe UI Emoji", "Segoe UI Symbol", "Noto Color Emoji";
          }
        `),e}}function dR(c,e,i){var s;return i=i??[],c&&(i.push({uiConfig:c,parentFolder:e}),(s=c.children)===null||s===void 0||s.forEach(a=>i=dR(a,c.uiRef,i))),i}class pR{constructor(){pR.prototype.isMatrix3=!0,this.elements=[1,0,0,0,1,0,0,0,1]}set(e,i,s,a,h,d,_,et,nt){const it=this.elements;return it[0]=e,it[1]=a,it[2]=_,it[3]=i,it[4]=h,it[5]=et,it[6]=s,it[7]=d,it[8]=nt,this}identity(){return this.set(1,0,0,0,1,0,0,0,1),this}copy(e){const i=this.elements,s=e.elements;return i[0]=s[0],i[1]=s[1],i[2]=s[2],i[3]=s[3],i[4]=s[4],i[5]=s[5],i[6]=s[6],i[7]=s[7],i[8]=s[8],this}extractBasis(e,i,s){return e.setFromMatrix3Column(this,0),i.setFromMatrix3Column(this,1),s.setFromMatrix3Column(this,2),this}setFromMatrix4(e){const i=e.elements;return this.set(i[0],i[4],i[8],i[1],i[5],i[9],i[2],i[6],i[10]),this}multiply(e){return this.multiplyMatrices(this,e)}premultiply(e){return this.multiplyMatrices(e,this)}multiplyMatrices(e,i){const s=e.elements,a=i.elements,h=this.elements,d=s[0],_=s[3],et=s[6],nt=s[1],it=s[4],lt=s[7],ut=s[2],pt=s[5],gt=s[8],vt=a[0],Ct=a[3],wt=a[6],xt=a[1],_t=a[4],Pt=a[7],Bt=a[2],Ot=a[5],Lt=a[8];return h[0]=d*vt+_*xt+et*Bt,h[3]=d*Ct+_*_t+et*Ot,h[6]=d*wt+_*Pt+et*Lt,h[1]=nt*vt+it*xt+lt*Bt,h[4]=nt*Ct+it*_t+lt*Ot,h[7]=nt*wt+it*Pt+lt*Lt,h[2]=ut*vt+pt*xt+gt*Bt,h[5]=ut*Ct+pt*_t+gt*Ot,h[8]=ut*wt+pt*Pt+gt*Lt,this}multiplyScalar(e){const i=this.elements;return i[0]*=e,i[3]*=e,i[6]*=e,i[1]*=e,i[4]*=e,i[7]*=e,i[2]*=e,i[5]*=e,i[8]*=e,this}determinant(){const e=this.elements,i=e[0],s=e[1],a=e[2],h=e[3],d=e[4],_=e[5],et=e[6],nt=e[7],it=e[8];return i*d*it-i*_*nt-s*h*it+s*_*et+a*h*nt-a*d*et}invert(){const e=this.elements,i=e[0],s=e[1],a=e[2],h=e[3],d=e[4],_=e[5],et=e[6],nt=e[7],it=e[8],lt=it*d-_*nt,ut=_*et-it*h,pt=nt*h-d*et,gt=i*lt+s*ut+a*pt;if(gt===0)return this.set(0,0,0,0,0,0,0,0,0);const vt=1/gt;return e[0]=lt*vt,e[1]=(a*nt-it*s)*vt,e[2]=(_*s-a*d)*vt,e[3]=ut*vt,e[4]=(it*i-a*et)*vt,e[5]=(a*h-_*i)*vt,e[6]=pt*vt,e[7]=(s*et-nt*i)*vt,e[8]=(d*i-s*h)*vt,this}transpose(){let e;const i=this.elements;return e=i[1],i[1]=i[3],i[3]=e,e=i[2],i[2]=i[6],i[6]=e,e=i[5],i[5]=i[7],i[7]=e,this}getNormalMatrix(e){return this.setFromMatrix4(e).invert().transpose()}transposeIntoArray(e){const i=this.elements;return e[0]=i[0],e[1]=i[3],e[2]=i[6],e[3]=i[1],e[4]=i[4],e[5]=i[7],e[6]=i[2],e[7]=i[5],e[8]=i[8],this}setUvTransform(e,i,s,a,h,d,_){const et=Math.cos(h),nt=Math.sin(h);return this.set(s*et,s*nt,-s*(et*d+nt*_)+d+e,-a*nt,a*et,-a*(-nt*d+et*_)+_+i,0,0,1),this}scale(e,i){const s=this.elements;return s[0]*=e,s[3]*=e,s[6]*=e,s[1]*=i,s[4]*=i,s[7]*=i,this}rotate(e){const i=Math.cos(e),s=Math.sin(e),a=this.elements,h=a[0],d=a[3],_=a[6],et=a[1],nt=a[4],it=a[7];return a[0]=i*h+s*et,a[3]=i*d+s*nt,a[6]=i*_+s*it,a[1]=-s*h+i*et,a[4]=-s*d+i*nt,a[7]=-s*_+i*it,this}translate(e,i){const s=this.elements;return s[0]+=e*s[2],s[3]+=e*s[5],s[6]+=e*s[8],s[1]+=i*s[2],s[4]+=i*s[5],s[7]+=i*s[8],this}equals(e){const i=this.elements,s=e.elements;for(let a=0;a<9;a++)if(i[a]!==s[a])return!1;return!0}fromArray(e,i=0){for(let s=0;s<9;s++)this.elements[s]=e[s+i];return this}toArray(e=[],i=0){const s=this.elements;return e[i]=s[0],e[i+1]=s[1],e[i+2]=s[2],e[i+3]=s[3],e[i+4]=s[4],e[i+5]=s[5],e[i+6]=s[6],e[i+7]=s[7],e[i+8]=s[8],e}clone(){return new this.constructor().fromArray(this.elements)}}function ZO(c){return document.createElementNS("http://www.w3.org/1999/xhtml",c)}let TS;class IU{constructor(e=null){this.isSource=!0,this.uuid=Qo(),this.data=e,this.version=0}set needsUpdate(e){e===!0&&this.version++}toJSON(e){const i=e===void 0||typeof e=="string";if(!i&&e.images[this.uuid]!==void 0)return e.images[this.uuid];const s={uuid:this.uuid,url:""},a=this.data;if(a!==null){let h;if(Array.isArray(a)){h=[];for(let d=0,_=a.length;d<_;d++)a[d].isDataTexture?h.push(fR(a[d].image)):h.push(fR(a[d]))}else h=fR(a);s.url=h}return i||(e.images[this.uuid]=s),s}}function fR(c){if(typeof HTMLImageElement<"u"&&c instanceof HTMLImageElement||typeof HTMLCanvasElement<"u"&&c instanceof HTMLCanvasElement||typeof ImageBitmap<"u"&&c instanceof ImageBitmap)return class{static getDataURL(e,i=!1){if(/^data:/i.test(e.src)||typeof HTMLCanvasElement>"u")return e.src;let s;if(e instanceof HTMLCanvasElement)s=e;else{TS===void 0&&(TS=ZO("canvas")),TS.width=e.width,TS.height=e.height;const a=TS.getContext("2d");e instanceof ImageData?a.putImageData(e,0,0):a.drawImage(e,0,0,e.width,e.height),s=TS}return!i&&(s.width>2048||s.height>2048)?(console.warn("THREE.ImageUtils.getDataURL: Image converted to jpg for performance reasons",e),s.toDataURL("image/jpeg",.6)):s.toDataURL("image/png")}static sRGBToLinear(e){if(typeof HTMLImageElement<"u"&&e instanceof HTMLImageElement||typeof HTMLCanvasElement<"u"&&e instanceof HTMLCanvasElement||typeof ImageBitmap<"u"&&e instanceof ImageBitmap){const i=ZO("canvas");i.width=e.width,i.height=e.height;const s=i.getContext("2d");s.drawImage(e,0,0,e.width,e.height);const a=s.getImageData(0,0,e.width,e.height),h=a.data;for(let d=0;d<h.length;d++)h[d]=255*Lo(h[d]/255);return s.putImageData(a,0,0),i}if(e.data){const i=e.data.slice(0);for(let s=0;s<i.length;s++)i instanceof Uint8Array||i instanceof Uint8ClampedArray?i[s]=Math.floor(255*Lo(i[s]/255)):i[s]=Lo(i[s]);return{data:i,width:e.width,height:e.height}}return console.warn("THREE.ImageUtils.sRGBToLinear(): Unsupported image type. No color space conversion applied."),e}}.getDataURL(c);if(c.data){let e=[];try{e=Array.from(c.data)}catch(i){i.message.includes("Invalid array length")?console.warn("Serializing large texture, might not be saved in JSON structure."):console.error(i),e=c.data}return{data:e,width:c.width,height:c.height,type:c.data.constructor.name}}return console.warn("THREE.Texture: Unable to serialize Texture."),{}}let DU=0;class IS extends class{addEventListener(e,i){this._listeners===void 0&&(this._listeners={});const s=this._listeners;s[e]===void 0&&(s[e]=[]),s[e].indexOf(i)===-1&&s[e].push(i)}hasEventListener(e,i){if(this._listeners===void 0)return!1;const s=this._listeners;return s[e]!==void 0&&s[e].indexOf(i)!==-1}removeEventListener(e,i){if(this._listeners===void 0)return;const s=this._listeners[e];if(s!==void 0){const a=s.indexOf(i);a!==-1&&s.splice(a,1)}}dispatchEvent(e){if(this._listeners===void 0)return;const i=this._listeners[e.type];if(i!==void 0){e.target=this;const s=i.slice(0);for(let a=0,h=s.length;a<h;a++)s[a].call(this,e);e.target=null}}}{constructor(e=IS.DEFAULT_IMAGE,i=IS.DEFAULT_MAPPING,s=1001,a=1001,h=Io,d=1008,_=1023,et=1009,nt=1,it=3e3){super(),this.isTexture=!0,Object.defineProperty(this,"id",{value:DU++}),this.uuid=Qo(),this.name="",this.source=new IU(e),this.mipmaps=[],this.mapping=i,this.wrapS=s,this.wrapT=a,this.magFilter=h,this.minFilter=d,this.anisotropy=nt,this.format=_,this.internalFormat=null,this.type=et,this.offset=new Ir(0,0),this.repeat=new Ir(1,1),this.center=new Ir(0,0),this.rotation=0,this.matrixAutoUpdate=!0,this.matrix=new pR,this.generateMipmaps=!0,this.premultiplyAlpha=!1,this.flipY=!0,this.unpackAlignment=4,this.encoding=it,this.userData={},this.version=0,this.onUpdate=null,this.isRenderTargetTexture=!1,this.needsPMREMUpdate=!1}get image(){return this.source.data}set image(e){this.source.data=e}updateMatrix(){this.matrix.setUvTransform(this.offset.x,this.offset.y,this.repeat.x,this.repeat.y,this.rotation,this.center.x,this.center.y)}clone(){return new this.constructor().copy(this)}copy(e){return this.name=e.name,this.source=e.source,this.mipmaps=e.mipmaps.slice(0),this.mapping=e.mapping,this.wrapS=e.wrapS,this.wrapT=e.wrapT,this.magFilter=e.magFilter,this.minFilter=e.minFilter,this.anisotropy=e.anisotropy,this.format=e.format,this.internalFormat=e.internalFormat,this.type=e.type,this.offset.copy(e.offset),this.repeat.copy(e.repeat),this.center.copy(e.center),this.rotation=e.rotation,this.matrixAutoUpdate=e.matrixAutoUpdate,this.matrix.copy(e.matrix),this.generateMipmaps=e.generateMipmaps,this.premultiplyAlpha=e.premultiplyAlpha,this.flipY=e.flipY,this.unpackAlignment=e.unpackAlignment,this.encoding=e.encoding,this.userData=JSON.parse(JSON.stringify(e.userData)),this.needsUpdate=!0,this}toJSON(e){const i=e===void 0||typeof e=="string";if(!i&&e.textures[this.uuid]!==void 0)return e.textures[this.uuid];const s={metadata:{version:4.5,type:"Texture",generator:"Texture.toJSON"},uuid:this.uuid,name:this.name,image:this.source.toJSON(e).uuid,mapping:this.mapping,repeat:[this.repeat.x,this.repeat.y],offset:[this.offset.x,this.offset.y],center:[this.center.x,this.center.y],rotation:this.rotation,wrap:[this.wrapS,this.wrapT],format:this.format,type:this.type,encoding:this.encoding,minFilter:this.minFilter,magFilter:this.magFilter,anisotropy:this.anisotropy,flipY:this.flipY,premultiplyAlpha:this.premultiplyAlpha,unpackAlignment:this.unpackAlignment};return JSON.stringify(this.userData)!=="{}"&&(s.userData=this.userData),i||(e.textures[this.uuid]=s),s}dispose(){this.dispatchEvent({type:"dispose"})}transformUv(e){if(this.mapping!==300)return e;if(e.applyMatrix3(this.matrix),e.x<0||e.x>1)switch(this.wrapS){case 1e3:e.x=e.x-Math.floor(e.x);break;case 1001:e.x=e.x<0?0:1;break;case 1002:Math.abs(Math.floor(e.x)%2)===1?e.x=Math.ceil(e.x)-e.x:e.x=e.x-Math.floor(e.x)}if(e.y<0||e.y>1)switch(this.wrapT){case 1e3:e.y=e.y-Math.floor(e.y);break;case 1001:e.y=e.y<0?0:1;break;case 1002:Math.abs(Math.floor(e.y)%2)===1?e.y=Math.ceil(e.y)-e.y:e.y=e.y-Math.floor(e.y)}return this.flipY&&(e.y=1-e.y),e}set needsUpdate(e){e===!0&&(this.version++,this.source.needsUpdate=!0)}}IS.DEFAULT_IMAGE=null,IS.DEFAULT_MAPPING=300;var U2=__webpackgi_require__(898),IM={};U2.Z&&U2.Z.locals&&(IM.locals=U2.Z.locals);var mR,gR=0,g1={};g1.styleTagTransform=Bx(),g1.setAttributes=Rx(),g1.insert=function(c,e){(e.target||document.head).appendChild(c)},g1.domAPI=IE(),g1.insertStyleElement=Yv(),IM.use=function(c){return g1.options=c||{},gR++||(mR=sw()(U2.Z,g1)),IM},IM.unuse=function(){gR>0&&!--gR&&(mR(),mR=null)};var PU=IM;class vR extends JO{constructor(e=!1,i=!1,s=!1,a=document.body){super(e,i,s,!1),this.dependencies=[qr],this._preRender=()=>this.refreshQueue("preRender"),this._postRender=()=>this.refreshQueue("postRender"),this._postFrame=h=>{this.dispatchEvent(h),this.refreshQueue("postFrame")},this._preFrame=()=>this.refreshQueue("preFrame"),this._plugins=[],this.alert=async h=>this._viewer?this._viewer.alert(h):super.alert(h),this.confirm=async h=>this._viewer?this._viewer.confirm(h):super.confirm(h),this.prompt=async(h,d,_=!0)=>this._viewer?this._viewer.prompt(h,d,_):super.prompt(h,d,_),this._pane.registerPlugin(xU),PU.use({target:a})}async onAdded(e){this._viewer=e,this._typeGenerators.image=(i=>(s,a,h,d)=>{const _=a.property,et="placeholder";if(a.value===void 0&&_&&typeof _[0]=="object"){const[nt,it]=_,lt=cM("Render Target"),ut=cM("Data Texture"),pt=cM("CUBE Texture"),gt=cM("Compressed Texture"),vt={},Ct={};Object.defineProperty(a,"value",{get:()=>{var wt;let xt,_t=nt[it];if(_t!=null&&_t.get&&(_t=_t.get()),!_t)return et;if(_t.isRenderTargetTexture&&!_t.image.tp_src&&(_t.image.tp_src=lt),_t.isDataTexture&&!_t.image.tp_src&&(_t.image.tp_src=ut),_t.isCompressedTexture&&!_t.image.tp_src&&(_t.image.tp_src=gt),_t.isTexture?(_t.image&&(_t.image instanceof ImageBitmap||_t.image instanceof HTMLImageElement||_t.image instanceof HTMLVideoElement)&&!_t.image.tp_src&&(_t.image.tp_src=qu(_t.image,160)),_t.image&&(xt=_t.image.tp_src_uuid,xt=xt?vt[xt]:void 0,xt||(xt=_t.image.tp_src||_t.image.src))):typeof _t=="string"?xt=_t:_t.domainMin?(xt=_t.texture,_t.texture.image&&!_t.texture.image.tp_src&&(_t.texture.image.tp_src=pt),_t.texture.image&&(xt=_t.texture.image.tp_src_uuid,xt=xt?vt[xt]:void 0,xt||(xt=_t.texture.image.tp_src||_t.texture.image.src))):_t&&console.error("unknown value",_t),xt||(xt=et),_t.image&&!_t.image.tp_src_uuid){const Pt=gu();_t.image.tp_src_uuid=Pt,Ct[xt]=Pt}return typeof xt=="string"&&(xt=(wt=vt[xt])!==null&&wt!==void 0?wt:xt),xt},set:wt=>{var xt,_t,Pt,Bt,Ot,Lt,qt,en,cn,An,mn;const Tn=nt[it],vn=Un=>{var Mn;nt[it]=Un,Un!=null&&Un.isTexture&&(Un.flipY=Un.isDataTexture?Un.flipY:(Mn=Tn==null?void 0:Tn.flipY)===null||Mn===void 0||Mn)};if(typeof wt=="string")return void(typeof Tn=="string"&&vn(wt));if(!wt)return void(a.value=et);if(wt.isPlaceholder)return void(Tn&&(vn(typeof Tn=="string"?"":null),typeof(nt==null?void 0:nt.setDirty)=="function"&&nt.setDirty()));let xn=wt.tp_src_uuid;if(xn||(xn=(xt=wt.src)!==null&&xt!==void 0?xt:wt.tp_src,xn=(_t=Ct[xn])!==null&&_t!==void 0?_t:xn,delete Ct[xn],wt.tp_src_uuid=xn),xn&&(vt[xn]=wt),typeof Tn!="string"){if(!((Tn==null?void 0:Tn.image)===wt||((Pt=Tn==null?void 0:Tn.image)===null||Pt===void 0?void 0:Pt.src)===wt.src||((Bt=Tn==null?void 0:Tn.image)===null||Bt===void 0?void 0:Bt.tp_src)===wt.tp_src&&wt.tp_src!=null||((Ot=Tn==null?void 0:Tn.image)===null||Ot===void 0?void 0:Ot.tp_src)===wt.src&&wt.src!=null||((Lt=Tn==null?void 0:Tn.image)===null||Lt===void 0?void 0:Lt.src)===wt.tp_src&&wt.tp_src!=null))if(wt instanceof File){const Un=i==null?void 0:i.getPlugin(qr);if(!Un)throw"Viewer or AssetManagerPlugin not found";(qt=Un.importer)===null||qt===void 0||qt.importSingle({file:wt,path:wt.src}).then(Mn=>{var Gn,rr,dr,_i;if(Mn){Mn.isDataTexture&&(Mn.needsUpdate=!0);const xr=(dr=(rr=(Gn=wt.src)===null||Gn===void 0?void 0:Gn.split("?"))===null||rr===void 0?void 0:rr[0])===null||dr===void 0?void 0:dr.split(".").pop();Mn.userData&&(Mn.userData.mimeType||(Mn.userData.mimeType="image/"+(["jpg","jpeg"].includes(xr)?"jpeg":"png"))),vn(Mn),[a.onChange].flat().forEach(Cr=>typeof Cr=="function"&&(Cr==null?void 0:Cr())),typeof(nt==null?void 0:nt.setDirty)=="function"&&nt.setDirty(),(_i=a.uiRefresh)===null||_i===void 0||_i.call(a,"postFrame",!1)}})}else{const Un=new IS(wt);Un.assetType="texture",Un.needsUpdate=!0;const Mn=(An=(cn=(en=wt.src)===null||en===void 0?void 0:en.split("?"))===null||cn===void 0?void 0:cn[0])===null||An===void 0?void 0:An.split(".").pop();Un.userData.mimeType||(Un.userData.mimeType="image/"+(["jpg","jpeg"].includes(Mn)?"jpeg":"png")),vn(Un);const Gn=["normalMap","aoMap","emissiveMap","roughnessMap","metalnessMap","displacementMap","bumpMap","alphaMap"].includes(it);Un.encoding=Gn?b.rnI:b.knz,Un.wrapS=b.rpg,Un.wrapT=b.rpg,[a.onChange].flat().forEach(rr=>typeof rr=="function"&&(rr==null?void 0:rr())),typeof(nt==null?void 0:nt.setDirty)=="function"&&nt.setDirty(),(mn=a.uiRefresh)===null||mn===void 0||mn.call(a,"postFrame",!1)}}else vn(xn)}}),a.property=void 0,a.label===void 0&&(a.label=it)}return(d=d??{}).extensions=[".jpg",".png",".svg",".hdr",".exr",".jpeg",".bmp",".gif",".webp",".cube"],d.imageFit===void 0&&(d.imageFit="contain"),d.clickCallback===void 0&&(d.clickCallback=(nt,it)=>{var lt;const ut=nt==null?void 0:nt.target,pt=ut==null?void 0:ut.getBoundingClientRect();if(!pt)return void it.click();const gt=a.uiRef.controller_.valueController.value.rawValue,vt=gt===et||gt!=null&&gt.isPlaceholder?{}:{"remove image":()=>{var wt;a.uiRef.controller_.valueController.value.setRawValue("");const[xt,_t]=_||[a,"value"],Pt=typeof xt[_t]=="string";xt[_t]=Pt?"":null,[a.onChange].flat().forEach(Bt=>typeof Bt=="function"&&(Bt==null?void 0:Bt())),typeof(xt==null?void 0:xt.setDirty)=="function"&&xt.setDirty(),(wt=a.uiRefresh)===null||wt===void 0||wt.call(a,"postFrame",!1),i0.Remove()},"download image":()=>{var wt,xt,_t;const[Pt,Bt]=_||[a,"value"];let Ot=(xt=(wt=Pt[Bt])===null||wt===void 0?void 0:wt.image)!==null&&xt!==void 0?xt:a.uiRef.controller_.valueController.value.rawValue;Ot&&(Ot instanceof ImageBitmap||Ot instanceof HTMLImageElement||Ot instanceof HTMLVideoElement)&&!Ot.src&&(Ot=qu(Ot));const Lt=document.createElement("a");document.body.appendChild(Lt),Lt.style.display="none",Lt.href=(_t=Ot==null?void 0:Ot.src)!==null&&_t!==void 0?_t:Ot,Lt.download="image.png",Lt.click(),document.body.removeChild(Lt),i0.Remove()}},Ct=i0.Create({...vt,"set/replace image":()=>{it.click(),i0.Remove()},"from url":async()=>{var wt,xt;let _t="";if(_t&&(_t.startsWith("http")||_t.startsWith("data:image"))||(_t=""),_t=await h.prompt("Load texture: Enter Image/Texture URL",_t,!0),!_t||!_t.startsWith("http")&&!_t.startsWith("data:image"))return _t!==null&&await h.alert("Loading Image: Invalid URL"),void i0.Remove();const[Pt,Bt]=_||[a,"value"],Ot=Pt[Bt];if(typeof Ot=="string")Pt[Bt]=_t,[a.onChange].flat().forEach(Lt=>typeof Lt=="function"&&(Lt==null?void 0:Lt())),typeof(Pt==null?void 0:Pt.setDirty)=="function"&&Pt.setDirty(),(wt=a.uiRefresh)===null||wt===void 0||wt.call(a,"postFrame",!1);else{const Lt=i==null?void 0:i.getPlugin(qr);if(!Lt)throw"Viewer or AssetManagerPlugin not found";(xt=Lt.importer)===null||xt===void 0||xt.importSinglePath(_t).then(qt=>{var en;if(qt){qt.isDataTexture?qt.needsUpdate=!0:qt&&(Ot==null?void 0:Ot.flipY)!==void 0&&(qt.flipY=Ot.flipY),Pt[Bt]=qt;const cn=["normalMap","aoMap","emissiveMap","roughnessMap","metalnessMap","displacementMap","bumpMap","alphaMap"].includes(Bt);qt.encoding=cn?b.rnI:b.knz,[a.onChange].flat().forEach(An=>typeof An=="function"&&(An==null?void 0:An())),typeof(Pt==null?void 0:Pt.setDirty)=="function"&&Pt.setDirty(),(en=a.uiRefresh)===null||en===void 0||en.call(a,"postFrame",!1)}})}i0.Remove()},cancel:()=>{i0.Remove()}},2,pt.height+8);(lt=ut.parentElement)===null||lt===void 0||lt.appendChild(Ct),pt.y>.7*document.body.clientHeight&&(Ct.style.top="auto",Ct.style.bottom=pt.height+8+"px")}),d.view="input-image",eA(s,a,h,d)})(this._viewer),e.addEventListener("preRender",this._preRender),e.addEventListener("postRender",this._postRender),e.addEventListener("preFrame",this._preFrame),e.addEventListener("postFrame",this._postFrame)}async onDispose(e){this.dispose()}async onRemove(e){this._viewer=void 0,e.removeEventListener("preRender",this._preRender),e.removeEventListener("postRender",this._postRender),e.removeEventListener("preFrame",this._preFrame),e.removeEventListener("postFrame",this._postFrame),this.dispose()}setupPluginUi(e){var i;const s=(i=this._viewer)===null||i===void 0?void 0:i.getPlugin(e);if(!s)return void console.warn("plugin not found:",e);this._plugins.push(s),s.uiConfig&&(s.uiConfig.limitedUi=!0),s.uiConfig&&s.uiConfig.hidden===void 0&&(s.uiConfig.hidden=!1),this._appendUiObject(s);const a=s.uiConfig;if(a!=null&&a.uiRef&&s.toJSON){const h=a.uiRef.controller_.view.element,d=rp({innerHTML:"&#8942;",classList:["pluginOptionsButton"],elementTag:"button"});d.onclick=_=>{const et={};typeof s.toJSON=="function"&&(et["download preset"]=async()=>{var it,lt;const ut=(lt=(it=this._viewer)===null||it===void 0?void 0:it.getPlugin(qr))===null||lt===void 0?void 0:lt.exportPluginPreset(s);await Do(new Blob([JSON.stringify(ut,null,2)],{type:"application/json"}),"preset."+s.constructor.PluginType+".json"),i0.Remove()}),typeof s.fromJSON=="function"&&(et["upload preset"]=async()=>{var it,lt;i0.Remove();const ut=await Yl(!1,!1);if(ut.length===0)return;const pt=ut[0],gt=await pt.text(),vt=JSON.parse(gt);await((lt=(it=this._viewer)===null||it===void 0?void 0:it.getPlugin(qr))===null||lt===void 0?void 0:lt.importPluginPreset(vt,s))});const nt=i0.Create(et,h.clientWidth-120,12);h.append(nt),_.preventDefault()},h.appendChild(d)}return a}setupPlugins(...e){e.forEach(i=>this.setupPluginUi(i))}refreshPluginsEnabled(){this._plugins.forEach(e=>{var i;const s=e.uiConfig;s&&(Yt(s.hidden)!==!0?(i=s.uiRefresh)===null||i===void 0||i.call(s,"postFrame",!0):s.uiRef&&(s.uiRef.hidden=!0))})}}vR.PluginType="TweakpaneUi";class F2 extends Ls{constructor(){super(...arguments),this.enabled=!0,this.toJSON=void 0,this.bgUIConfig={label:"Color",type:"color",inlinePicker:!0,srgb:!1,onChange:()=>{if(!this._viewer)return;const e=new mo(this.bgUIConfig.value||16777215).convertSRGBToLinear();this._viewer.setBackground(e.getHex())},expanded:!0,limitedUi:!0},this.uiConfig={label:"Background / Environment",type:"folder",expanded:!1,limitedUi:!0,children:[this.bgUIConfig,{label:"Image",property:[this,"sceneBackground"],type:"image",limitedUi:!0},{label:"EnvMap BG",type:"checkbox",property:[this,"envmapBg"]},()=>({type:"slider",label:"BG Intensity",property:[this._viewer,"backgroundIntensity"],bounds:[0,16]}),{label:"Set Transparent BG",type:"button",hidden:()=>!this._viewer||this._viewer.useRgbm,value:()=>{var e;(e=this._viewer)===null||e===void 0||e.setBackground(null)}},{label:"Environment",property:[this,"sceneEnvironment"],type:"image",limitedUi:!0},{type:"slider",label:"Env Rotation",property:[this,"sceneEnvironmentRotation"],bounds:[0,2*Math.PI],limitedUi:!0},{type:"slider",label:"Env Intensity",property:[this,"sceneEnvironmentIntensity"],bounds:[0,4],limitedUi:!0}]}}get sceneBackground(){var e;const i=(e=this._viewer)===null||e===void 0?void 0:e.getBackground();return i&&(i.isTexture||i.assetType==="texture")?i:null}set sceneBackground(e){var i,s;e?(i=this._viewer)===null||i===void 0||i.setBackground(e):(s=this._viewer)===null||s===void 0||s.setBackground(this.bgUIConfig.value)}get sceneEnvironment(){var e;return(e=this._viewer)===null||e===void 0?void 0:e.scene.getEnvironment()}set sceneEnvironment(e){var i;(i=this._viewer)===null||i===void 0||i.scene.setEnvironment(e)}get sceneEnvironmentRotation(){var e,i,s;return(s=(i=(e=this._viewer)===null||e===void 0?void 0:e.scene.getEnvironment())===null||i===void 0?void 0:i.rotation)!==null&&s!==void 0?s:0}set sceneEnvironmentRotation(e){var i,s;const a=(i=this._viewer)===null||i===void 0?void 0:i.scene.getEnvironment();a&&(a.rotation=e,(s=this._viewer)===null||s===void 0||s.scene.setDirty())}get sceneEnvironmentIntensity(){var e,i;return(i=(e=this._viewer)===null||e===void 0?void 0:e.scene.envMapIntensity)!==null&&i!==void 0?i:1}set sceneEnvironmentIntensity(e){var i;!((i=this._viewer)===null||i===void 0)&&i.scene&&(this._viewer.scene.envMapIntensity=e)}get envmapBg(){var e;return((e=this._viewer)===null||e===void 0?void 0:e.getBackground(!0))===zv}set envmapBg(e){if(this._viewer)if(e){const i=this._viewer.getBackground(!0);i&&i!==zv&&(this.lastBgVal=i),this._viewer.setBackground(zv)}else this._viewer.getBackground()===this._viewer.scene.getEnvironment()&&this._viewer.setBackground(this.lastBgVal||this.bgUIConfig.value)}async onAdded(e){var i;await super.onAdded(e);const s=e.getBackground();this.bgUIConfig.value=typeof s=="string"&&s!==zv||typeof s=="number"||!((i=s)===null||i===void 0)&&i.isColor?"#"+new mo(s).convertLinearToSRGB().getHexString():"#000000",this.lastBgVal=s}}F2.PluginType="SimpleBackgroundEnvUiPlugin1";class j2 extends Ls{constructor(){super(),this.enabled=!0,this.toJSON=void 0,this._uiConfig={type:"folder",label:"Scene Objects",children:[],onExpand:()=>{var e,i;(i=(e=this._uiConfig).uiRefresh)===null||i===void 0||i.call(e,"postFrame",!0)}},this._clearSceneButton={type:"button",label:"Clear Scene",value:()=>{var e;(e=this._viewer)===null||e===void 0||e.scene.disposeSceneModels()}},this._sceneUpdate=this._sceneUpdate.bind(this)}async onAdded(e){await super.onAdded(e),e.scene.addEventListener("sceneUpdate",this._sceneUpdate)}async onRemove(e){return e.scene.removeEventListener("sceneUpdate",this._sceneUpdate),super.onRemove(e)}setDirty(){var e;(e=this._viewer)===null||e===void 0||e.setDirty()}get uiConfig(){var e,i,s;return this._viewer?(this._uiConfig.children=[this._clearSceneButton],this._uiConfig.children.push(...(s=(i=(e=this._viewer)===null||e===void 0?void 0:e.scene.modelRoot.modelObject.children)===null||i===void 0?void 0:i.map(a=>a.assetType==="light"?null:a.uiConfig).filter(a=>a!=null))!==null&&s!==void 0?s:[]),this._uiConfig):this._uiConfig}_sceneUpdate(){var e,i;(i=(e=this._uiConfig)===null||e===void 0?void 0:e.uiRefresh)===null||i===void 0||i.call(e,"postFrame",!0)}}j2.PluginType="SimpleUi";var RU=__webpackgi_require__(1),BU=__webpackgi_require__.n(RU)();class z2 extends Ls{constructor(e=!0){super(),this.enabled=!0,this.toJSON=void 0,this.treeView=void 0,this.hierarchyDiv=rp({innerHTML:"",id:"tpHierarchyContainer",addToBody:!1}),this._uiConfig={type:"folder",label:"Hierarchy",children:[]},this._buildData=(i,s)=>(i.push({text:s.name||"unnamed",id:s.uuid,children:s.children.reduce(this._buildData,[])}),i),this._findVisible=(i,s)=>(s.visible&&(s.children.length<1?i.push(s.uuid):i.push(...s.children.reduce(this._findVisible,[]))),i),this._setVisible=i=>{var s,a,h;const d=(s=this._viewer)===null||s===void 0?void 0:s.scene.modelRoot;if(!d||i==null)return;const _=new Set;d.traverse(et=>{et!==d&&(et.visible=i.includes(et.uuid),et.visible&&et.traverseAncestors(nt=>_.add(nt)))}),_.forEach(et=>et.visible=!0),(h=(a=this._viewer)===null||a===void 0?void 0:a.scene)===null||h===void 0||h.setDirty({sceneUpdate:!0,fromHierarchyPlugin:!0,updateGround:!1})},this.enabled=e,this.reset=this.reset.bind(this),r_(Wt`
#tpHierarchyContainer{
  width: 100%;
  height: auto;
  background-color: transparent;
  color: #e9e9ed;
  margin-top: 0;
}
`)}reset(e){var i;if(e!=null&&e.fromHierarchyPlugin||!(e!=null&&e.hierarchyChanged))return;for(;this.hierarchyDiv.firstChild;)this.hierarchyDiv.firstChild.remove();const s=(i=this._viewer)===null||i===void 0?void 0:i.scene.modelRoot;if(!s)return;const a=s.children.reduce(this._buildData,[]),h=s.children.reduce(this._findVisible,[]);let d=!1;return new Promise((_,et)=>{this.treeView=new BU(this.hierarchyDiv,{closeDepth:1,data:a,loaded:function(){this.values=h,_()},onChange:()=>{d?Vl(200).then(()=>{this.treeView&&this._setVisible(this.treeView.values)}):d=!0},onItemLabelClick:nt=>{var it;const lt=(it=this._viewer)===null||it===void 0?void 0:it.scene.modelRoot.modelObject.getObjectByProperty("uuid",nt);lt&&s.visible&&lt.dispatchEvent({type:"select",value:lt,ui:!0})}})})}async onAdded(e){await super.onAdded(e),this.reset(),e.scene.addEventListener("sceneUpdate",this.reset)}async onRemove(e){return e.scene.removeEventListener("sceneUpdate",this.reset),super.onRemove(e)}async onDispose(e){return super.onDispose(e)}get uiConfig(){return this._uiConfig.domChildren||(this._uiConfig.domChildren=[this.hierarchyDiv]),this._uiConfig}}z2.PluginType="HierarchyUiPlugin";class V2 extends Ls{constructor(){super(),this.toJSON=void 0,this.enabled=!0,this.uiConfig={type:"folder",label:"Lights",children:[{type:"button",label:"Add Directional Light",value:()=>{if(!this._viewer)return;const e=new SA;e.position.set(0,0,0),e.target.position.set(0,0,-1).normalize(),e.intensity=2,e.shadow.mapSize.set(1024,1024),this._viewer.scene.addLight(e)}}],limitedUi:!0},this.dependencies=[qr],this._sceneUpdate=e=>{var i,s,a;if(!e.hierarchyChanged)return;const h=[];(i=this._viewer)===null||i===void 0||i.traverseSceneObjects(d=>{if(!d.lightObject)return;const _=d.uiConfig;_&&!h.includes(_)&&h.push(_)}),[...this.uiConfig.children].forEach(d=>{var _;((_=d)===null||_===void 0?void 0:_.type)==="button"||h.includes(d)||this.uiConfig.children.splice(this.uiConfig.children.indexOf(d),1)}),h.forEach(d=>{this.uiConfig.children.includes(d)||this.uiConfig.children.push(d)}),(a=(s=this.uiConfig).uiRefresh)===null||a===void 0||a.call(s,"postFrame",!0)}}async onAdded(e){await super.onAdded(e),e.scene.addEventListener("sceneUpdate",this._sceneUpdate)}async onRemove(e){return e.scene.removeEventListener("sceneUpdate",this._sceneUpdate),super.onRemove(e)}}V2.PluginType="SimpleLightsUi";class Q2 extends Ls{constructor(){super(),this.toJSON=void 0,this.enabled=!0,this.uiConfig={type:"folder",label:"Cameras (Loaded)",children:[{type:"button",label:"Add Camera",hidden:!0}],limitedUi:!0},this.dependencies=[qr],this._sceneUpdate=e=>{var i,s,a;if(!e.hierarchyChanged)return;const h=[];(i=this._viewer)===null||i===void 0||i.traverseSceneObjects(d=>{if(!d.cameraObject)return;const _=d.uiConfig;_&&!h.includes(_)&&h.push(_)}),[...this.uiConfig.children].forEach(d=>{var _;((_=d)===null||_===void 0?void 0:_.type)==="button"||h.includes(d)||this.uiConfig.children.splice(this.uiConfig.children.indexOf(d),1)}),h.forEach(d=>{this.uiConfig.children.includes(d)||this.uiConfig.children.push(d)}),(a=(s=this.uiConfig).uiRefresh)===null||a===void 0||a.call(s,"postFrame",!0)}}async onAdded(e){await super.onAdded(e),e.scene.addEventListener("sceneUpdate",this._sceneUpdate)}async onRemove(e){return e.scene.removeEventListener("sceneUpdate",this._sceneUpdate),super.onRemove(e)}}Q2.PluginType="SimpleSceneCamerasUi";var DM,G2=function(c,e,i,s){var a,h=arguments.length,d=h<3?e:s===null?s=Object.getOwnPropertyDescriptor(e,i):s;if(typeof Reflect=="object"&&typeof Reflect.decorate=="function")d=Reflect.decorate(c,e,i,s);else for(var _=c.length-1;_>=0;_--)(a=c[_])&&(d=(h<3?a(d):h>3?a(e,i,d):a(e,i))||d);return h>3&&d&&Object.defineProperty(e,i,d),d};let my=DM=class extends Ls{constructor(){super(),this.enabled=!0,this.width=0,this.height=0,this.scale=1,this._sizeChanged=this._sizeChanged.bind(this),this._refresh=this._refresh.bind(this)}refreshSize(){this._sizeChanged()}_sizeChanged(){var c;if(!this._viewer)return;const e={width:Math.round(this.width),height:Math.round(this.height)},i=this._viewer.container.getBoundingClientRect();e.width>=i.width&&delete e.width,e.height>=i.height&&delete e.height,(c=this._viewer)===null||c===void 0||c.setSize(e),this._viewer.renderer.displayCanvasScaling=this.scale}async onAdded(c){await super.onAdded(c);const e=c.canvas.clientWidth,i=c.canvas.clientHeight,s=c.renderer.displayCanvasScaling;this.width=e,this.height=i,this.scale=s,c.renderer.addEventListener("resize",this._refresh),this.addEventListener("deserialize",this._sizeChanged),this._refresh()}async onRemove(c){return this.removeEventListener("deserialize",this._sizeChanged),c.renderer.removeEventListener("resize",this._refresh),super.onRemove(c)}_refresh(){var c,e;(e=(c=this.uiConfig)===null||c===void 0?void 0:c.uiRefresh)===null||e===void 0||e.call(c,"postFrame",!0)}toJSON(c){const e=super.toJSON(c),i=this._viewer.container.getBoundingClientRect();return e.width>=i.width&&delete e.width,e.height>=i.height&&delete e.height,e}};my.PluginType="RendererParamsUiPlugin",G2([Fn(),pn(DM.prototype._sizeChanged),ss("Width",void 0,1,c=>({bounds:()=>{var e;return[10,((e=c._viewer)===null||e===void 0?void 0:e.container.getBoundingClientRect().width)||1024]}}))],my.prototype,"width",void 0),G2([Fn(),pn(DM.prototype._sizeChanged),ss("Height",void 0,1,c=>({bounds:()=>{var e;return[10,((e=c._viewer)===null||e===void 0?void 0:e.container.getBoundingClientRect().height)||1024]}}))],my.prototype,"height",void 0),G2([Fn(),pn(DM.prototype._sizeChanged),ss("Scale",[.25,4],.25,{limitedUi:!0})],my.prototype,"scale",void 0),my=DM=G2([Ys("Renderer")],my);class H2 extends Ls{constructor(){super(),this.enabled=!0,this.serializeWithViewer=!1,this._refresh=this._refresh.bind(this)}async onAdded(e){await super.onAdded(e),e.scene.addEventListener("activeCameraChange",this._refresh),e.scene.addEventListener("sceneUpdate",this._refresh)}async onRemove(e){return e.scene.removeEventListener("activeCameraChange",this._refresh),e.scene.removeEventListener("sceneUpdate",this._refresh),super.onRemove(e)}toJSON(e){var i;const s=super.toJSON(e);return s.activeCamera=(i=this._viewer)===null||i===void 0?void 0:i.scene.activeCamera.toJSON(),s}fromJSON(e,i){var s;return e.activeCamera&&((s=this._viewer)===null||s===void 0||s.scene.activeCamera.fromJSON(e.activeCamera),delete(e={...e}).activeCamera),super.fromJSON(e,i)}_refresh(){var e,i;this._viewer&&((i=(e=this.uiConfig).uiRefresh)===null||i===void 0||i.call(e,"postFrame",!0))}get uiConfig(){var e;return((e=this._viewer)===null||e===void 0?void 0:e.scene.activeCamera.uiConfig)||{}}}H2.PluginType="CameraUiPlugin";var kU={create:c=>{let e="button"+(c.type?" "+c.type:""),i=Bs.createDiv(e,c.text);return i.addEventListener("click",c.onClick),i}};let om={createElement:(c,e,i,s)=>{let a=document.createElement(c);if(e&&(a.className=e),i&&(a.innerHTML=i),s)for(let h in s)a.setAttribute(h,s[h]);return a},createDiv:(c,e,i)=>om.createElement("div",c,e,i),createDomTree:c=>{if(!c||!c.hasOwnProperty("dom"))return c;let e=c.dom;if(c.children)for(let i in c.children)c.children[i]&&e.appendChild(om.createDomTree(c.children[i]));return e},removeElement:c=>{c!=null&&c.parentNode.removeChild(c)},appendToBody:c=>{document.body.appendChild(c)},makeIconHTML:c=>{let e="";return c=="ok"&&(e="#tick"),c=="error"&&(e="#cancel"),c=="info"&&(e="#info-button"),c=="caution"&&(e="#danger"),c=="min"&&(e="#line"),c=="close"&&(e="#close"),`<svg class="icon ${c}"><use xlink:href="${e}" /></svg>`},makeNftContent:c=>{let e=null;if(c.type){let i=null;i=typeof c.content=="string"?om.createDiv("inner-content",c.content):om.createDomTree({dom:om.createDiv("inner-content"),children:[c.content]}),e=c.type=="text"?om.createDomTree({dom:om.createDiv("content text"),children:[i]}):om.createDomTree({dom:om.createDiv("content"),children:[om.createDiv("state",om.makeIconHTML(c.type)),i]})}else typeof c.content=="string"&&(e=om.createDiv("content",c.content));return e},standardizeButtons:(c,e)=>{let i=[];if(e.buttons===void 0)return e.type!="caution"&&e.type!="info"||i.push({key:27,text:"Cancel",onClick:c.close.bind(c,"cancel")}),i.push({key:13,text:"OK",type:"main",onClick:c.close.bind(c,"ok")}),i;i=e.buttons,i.constructor!==Array&&(i=[i]);for(let s in i)!i[s].onClick&&(i[s].onClick=c.close.bind(c,i[s].id));return i},makeButtons:c=>{let e=[];if(c)for(let i in c)e.push(kU.create({text:c[i].text?c[i].text:"OK",type:c[i].normal?null:"main",onClick:c[i].onClick}));return om.createDomTree({dom:om.createDiv("button-wrapper"),children:e})},bindButtonKeyEvents:c=>{let e=i=>{for(let s in c)if(c[s].key===i.keyCode)return void c[s].onClick()};return window.addEventListener("keydown",e),e},unbindButtonKeyEvents:c=>{window.removeEventListener("keydown",c)}};var Bs=om,pu=__webpackgi_require__(476),_p={"wwise-overlay-in-1":{opacity:"0"},"wwise-overlay-in-2":{opacity:"1"},"wwise-overlay-out-1":{opacity:"0"},"wwise-pop-in-1":{transform:"scale(0.5, 0.5)","margin-top":"50px",opacity:".5"},"wwise-pop-in-2":{transform:"scale(1, 1)","margin-top":"0",opacity:"1"},"wwise-pop-in-3":{transform:"scale(1.05, 1.05)"},"wwise-pop-in-4":{transform:"scale(1, 1)"},"wwise-pop-out-1":{transform:"scale(0.25, 0.25)","margin-top":"50px",opacity:"0"},"wwise-flip-in-1":{transform:"rotateX(60deg) scaleX(.5)",opacity:".2"},"wwise-flip-in-2":{transform:"none",opacity:"1"},"wwise-flip-out-1":{transform:"rotateX(60deg) scaleX(.5)",opacity:"0"},"wwise-top-in-1":{transform:"translateY(-30vh)",opacity:".5"},"wwise-top-in-2":{transform:"none",opacity:"1"},"wwise-top-out-1":{transform:"translateY(-30vh)",opacity:"0"},"wwise-bottom-in-1":{transform:"translateY(30vh)",opacity:".5"},"wwise-bottom-in-2":{transform:"none",opacity:"1"},"wwise-bottom-out-1":{transform:"translateY(30vh)",opacity:"0"},"wwise-left-in-1":{transform:"translateX(-30vw)",opacity:".5"},"wwise-left-in-2":{transform:"none",opacity:"1"},"wwise-left-out-1":{transform:"translateX(-30vw)",opacity:"0"},"wwise-right-in-1":{transform:"translateX(30vw)",opacity:".5"},"wwise-right-in-2":{transform:"none",opacity:"1"},"wwise-right-out-1":{transform:"translateX(30vw)",opacity:"0"},"wwise-min-in-1":{"margin-top":"0",transform:"rotateX(-60deg) scale(0.2, 1.8) translateY(80vh)",opacity:".2"},"wwise-min-in-2":{transform:"none",opacity:"1"},"wwise-min-out-1":{"margin-top":"30vh",transform:"rotateX(-60deg) scale(0.05, 2) translateY(30vh)",opacity:"0"}};let X0={};X0.overlay_in=[new pu.Frame(_p["wwise-overlay-in-1"],0),new pu.Frame(_p["wwise-overlay-in-2"],400)],X0.overlay_out=[new pu.Frame(_p["wwise-overlay-out-1"],300)],X0.pop_in=[new pu.Frame(_p["wwise-pop-in-1"],0),new pu.Frame(_p["wwise-pop-in-2"],{duration:200,"timing-function":"ease-in"}),new pu.Frame(_p["wwise-pop-in-3"],{duration:100,"timing-function":"linear"}),new pu.Frame(_p["wwise-pop-in-4"],{duration:100,"timing-function":"linear"})],X0.pop_out=[new pu.Frame(_p["wwise-pop-out-1"],{duration:250,"timing-function":"ease-in"})],X0.flip_in=[new pu.Frame(_p["wwise-flip-in-1"],0),new pu.Frame(_p["wwise-flip-in-2"],500)],X0.flip_out=[new pu.Frame(_p["wwise-flip-out-1"],400)],X0.min_in=[new pu.Frame(_p["wwise-min-in-1"],0),new pu.Frame(_p["wwise-min-in-2"],350)],X0.min_out=[new pu.Frame(_p["wwise-min-out-1"],400)];let $O=["top","bottom","left","right"];for(let c in $O){let e=$O[c];X0[e+"_in"]=[new pu.Frame(_p["wwise-"+e+"-in-1"],0),new pu.Frame(_p["wwise-"+e+"-in-2"],{duration:400,"timing-function":"ease-out"})],X0[e+"_out"]=[new pu.Frame(_p["wwise-"+e+"-out-1"],{duration:400,"timing-function":"ease-in"})]}var W2=X0;let OU={animation:"pop",topbar:{showClose:!0,showMin:!1},keepOverlay:!1,position:"center",overlay:!1,clickOverlayToClose:!0,removeBackground:!1,noRadius:!1,zIndex:null};class _R{static create(e,i){let s=e.getElementsByClassName("title")[0];s&&(s=s.innerHTML);let a=e.getElementsByClassName("content")[0];return a&&(a=a.innerHTML),Bs.removeElement(e),i.title=s,i.content=a,new _R(i)}constructor(e){this.options=JSON.parse(JSON.stringify(OU));for(let et in e)e[et]!=null&&(this.options[et]=e[et]);let i=this.options.position;if(i.indexOf(" ")==-1&&(i=="left"||i=="right"?i+=" center":i=i=="top"||i=="bottom"?"center "+i:i+" "+i),this.options.position=i,this.options.overlay){let et=document.getElementsByClassName("wwise-overlay");et.length?(this.overlay=et[0],this.hasOverlay=!0):(this.overlay=Bs.createDiv("wwise-overlay"),this.options.zIndex&&(this.overlay.style.zIndex=this.options.zIndex)),this.overlayClickHandler=this.close.bind(this,void 0)}else this.options.clickOverlayToClose=!1;let s="content";if(this.options.topbar){let et=[];this.options.topbar.showMin&&(et.push(Bs.createDiv(null,Bs.makeIconHTML("min"))),et[et.length-1].addEventListener("click",this.min.bind(this))),this.options.topbar.showClose&&(et.push(Bs.createDiv(null,Bs.makeIconHTML("close"))),et[et.length-1].addEventListener("click",this.close.bind(this,void 0)));let nt=null;nt=typeof this.options.title=="string"?Bs.createDiv("title",this.options.title):Bs.createDomTree({dom:Bs.createDiv("title"),children:[this.options.title]}),this.topbar=Bs.createDomTree({dom:Bs.createDiv("topbar"),children:[{dom:Bs.createDiv("control"),children:et.map(it=>({dom:it}))},{dom:nt},{dom:Bs.createDiv("clear")}]})}else s+=" no-topbar";typeof this.options.content=="string"?this.content=Bs.createDomTree({dom:Bs.createDiv(s,this.options.content)}):this.content=Bs.createDomTree({dom:Bs.createDiv(s),children:[this.options.content]}),this.options.removeBackground&&(this.content.style.background="initial"),this.window=Bs.createDomTree({dom:Bs.createDiv("wwise"+(this.options.noRadius?" no-radius":"")),children:[this.topbar,this.content]});let a=Bs.createDiv("wwise-wrapper");this.options.zIndex&&(a.style.zIndex=this.options.zIndex),this.wrapper=Bs.createDomTree({dom:a,children:[this.window]}),this.dom=Bs.createDomTree({dom:Bs.createDiv(),children:[this.wrapper]});let h=this.options.position.split(" "),d=-50,_=-50;if(h[0]=="left"?(d=0,this.wrapper.classList.add("left")):h[0]=="right"?(d=-100,this.wrapper.classList.add("right")):h[0]=="center"?this.wrapper.classList.add("h-center"):this.wrapper.style.left=h[0],h[1]=="top"?(_=0,this.wrapper.classList.add("top")):h[1]=="bottom"?(_=-100,this.wrapper.classList.add("bottom")):h[1]=="center"?this.wrapper.classList.add("v-center"):this.wrapper.style.top=i[1],this.window.style.transform=`translate(${d}%, ${_}%)`,this.options.style)for(let et in this.options.style)this.window.style[et]=this.options.style[et];this.options.margin&&(this.wrapper.style.margin=this.options.margin),this.options.draggable&&this.draggable()}open(e){if(this.opened)return;this.promise=new Promise(s=>{this.promiseResolve=s}),this.appendDoms(),this.opened=!0,this.options.clickOverlayToClose&&(this.overlay.addEventListener("click",this.overlayClickHandler),this.overlay.addEventListener("touchstart",this.overlayClickHandler));let i=e?"min":this.options.animation;if(i){i!="min"&&i!="flip"||this.dom.classList.add("wwise-perspective");let s=[new pu.Queue(this.wrapper,W2[i+"_in"],{instant:!0,applyOnEnd:!0}).getPromise()];return this.options.overlay&&!this.hasOverlay&&s.push(new pu.Queue(this.overlay,W2.overlay_in,{instant:!0,applyOnEnd:!0}).getPromise()),Promise.all(s).then(()=>{this.dom.classList.remove("wwise-perspective")})}return Promise.resolve()}close(e){if(!this.opened)return;this.opened=!1;let i=e?"min":this.options.animation;if(this.overlay&&(this.overlay.removeEventListener("click",this.overlayClickHandler),this.overlay.removeEventListener("touchstart",this.overlayClickHandler)),i){i!="min"&&i!="flip"||this.dom.classList.add("wwise-perspective");let s=[new pu.Queue(this.wrapper,W2[i+"_out"],{instant:!0,applyOnEnd:!0}).getPromise()];return this.options.overlay&&!this.options.keepOverlay&&s.push(new pu.Queue(this.overlay,W2.overlay_out,{instant:!0,applyOnEnd:!0}).getPromise()),Promise.all(s).then(()=>{this.removeDoms(),this.dom.classList.remove("wwise-perspective"),this.promiseResolve()})}return this.removeDoms(),this.promiseResolve(),Promise.resolve()}min(){return this.close(!0)}resume(){return this.open(!0)}getPromise(){return this.promise}appendDoms(){this.options.overlay&&!this.hasOverlay&&(Bs.appendToBody(this.overlay),document.body.classList.add("wwise-no-scroll"),this.overlay.addEventListener("touchstart",e=>{e.preventDefault()})),Bs.appendToBody(this.dom)}removeDoms(){Bs.removeElement(this.dom),!this.options.keepOverlay&&this.overlay&&(Bs.removeElement(this.overlay),document.body.classList.remove("wwise-no-scroll"))}draggable(e=!0){this.topbar&&(e?(this.draggableMouseMoveHandler=this.handleDraggableMouseMove.bind(this),this.draggableMouseDownHandler=this.handleDraggableMouseDown.bind(this),this.draggableMouseUpHandler=this.handleDraggableMouseUp.bind(this),this.draggableMouseOutHandler=this.handleDraggableMouseOut.bind(this),window.addEventListener("mousemove",this.draggableMouseMoveHandler),window.addEventListener("mouseout",this.draggableMouseOutHandler),this.topbar.addEventListener("mousedown",this.draggableMouseDownHandler),window.addEventListener("mouseup",this.draggableMouseUpHandler)):(window.removeEventListener("mousemove",this.draggableMouseMoveHandler),window.removeEventListener("mouseout",this.draggableMouseOutHandler),this.topbar.removeEventListener("mousedown",this.draggableMouseDownHandler),window.removeEventListener("mouseup",this.draggableMouseUpHandler)))}handleDraggableMouseMove(e){if(this.inDragging){let i={x:e.clientX-this.dragPrev.x,y:e.clientY-this.dragPrev.y},s=window.getComputedStyle(this.wrapper),a=this.options.draggable,h=parseFloat(s.left),d=parseFloat(s.top);if(s.left.indexOf("%")!=-1){h=s.left,h=h.substr(0,h.length-1),h=parseInt(h);let _=window,et=document,nt=et.documentElement,it=et.getElementsByTagName("body")[0];h=h*(_.innerWidth||nt.clientWidth||it.clientWidth)/100}if(s.top.indexOf("%")!=-1){d=s.top,d=d.substr(0,d.length-1),d=parseInt(d);let _=window,et=document,nt=et.documentElement,it=et.getElementsByTagName("body")[0];d=d*(_.innerHeight||nt.clientHeight||it.clientHeight)/100}a!=1&&a!="horizontal"||(this.wrapper.style.left=h+i.x+"px"),a!=1&&a!="vertical"||(this.wrapper.style.top=d+i.y+"px"),this.dragPrev={x:e.clientX,y:e.clientY}}}handleDraggableMouseDown(e){this.inDragging=!0,this.dragPrev={x:e.clientX,y:e.clientY}}handleDraggableMouseUp(e){this.inDragging=!1}handleDraggableMouseOut(e){let i=e.relatedTarget;i&&i.nodeName!="HTML"||(this.inDragging=!1)}}var LU=_R,AR=class{constructor(c){let e=this.options=c;!e.type&&(e.type="ok");let i={topbar:!1};i.content=this.constructContent({type:e.type,title:e.title,text:e.text,content:e.content,buttons:e.buttons}),i.overlay=!0,i.keepOverlay=e.keepOverlay,i.clickOverlayToClose=!1,i.animation=e.animation,i.zIndex=e.zIndex,this.wwise=new LU(i)}constructContent(c){let e=Bs.createDiv("modal"),i=Bs.createDomTree({dom:Bs.createDiv("main "+c.type),children:[Bs.createDiv(null,Bs.makeIconHTML(c.type)),Bs.createDiv("title",c.title),Bs.createDiv("text",c.text)]});this.buttonArr=Bs.standardizeButtons(this,c);let s=Bs.makeButtons(this.buttonArr),a=null;c.content&&(a=typeof c.content=="string"?Bs.createDiv(null,c.content):c.content);let h=null;return s.innerHTML&&(h=Bs.createDomTree({dom:Bs.createDiv("operation "+c.type),children:[s]})),a||h||i.classList.add("no-op"),Bs.createDomTree({dom:e,children:[i,a,h]})}open(){if(this.wwise.opened)return;let c=this.wwise.open();return this.value=void 0,this.promise=new Promise(e=>{this.promiseResolve=e}),this.wwise.getPromise().then(this.handlePromiseResolve.bind(this)),this.keyHandler=Bs.bindButtonKeyEvents(this.buttonArr),this.options.closeAfter&&window.setTimeout(()=>{this.close("timer")},this.options.closeAfter),c}close(c){if(this.wwise.opened)return this.value=c,Bs.unbindButtonKeyEvents(this.keyHandler),this.wwise.close()}getPromise(){return this.promise}handlePromiseResolve(){this.promiseResolve(this.value)}};let NU={showCancel:!1,okText:"OK",cancelText:"Cancel",placeholder:"",validator:null},UU={type:"info",keepOverlay:!1,title:"Input",text:"",zIndex:null};var q2=__webpackgi_require__(513),PM={};q2.Z&&q2.Z.locals&&(PM.locals=q2.Z.locals);var yR,wR=0,v1={};v1.styleTagTransform=Bx(),v1.setAttributes=Rx(),v1.insert=function(c,e){(e.target||document.head).appendChild(c)},v1.domAPI=IE(),v1.insertStyleElement=Yv(),PM.use=function(c){return v1.options=c||{},wR++||(yR=sw()(q2.Z,v1)),PM},PM.unuse=function(){wR>0&&!--wR&&(yR(),yR=null)};var FU=PM;class xR extends Ls{constructor(){super(...arguments),this.enabled=!0,this.toJSON=void 0,this._previousMappings={}}async onAdded(e){await super.onAdded(e),this._previousMappings={alert:e.alert,confirm:e.confirm,prompt:e.prompt},Bs.appendToBody=i=>{e.container.appendChild(i)},Bs.makeIconHTML=i=>"",FU.use({target:e.container}),e.alert=async i=>{const s=i==null?void 0:i.split(":")[0],a=new AR({type:"info",title:s??"&ndsp;",text:(i==null?void 0:i.replace(s+":",""))||"",buttons:[{key:13,text:"OK",type:"main",id:"ok"}],animation:"overlay"});return a.open(),a.getPromise()},e.confirm=async i=>{const s=i==null?void 0:i.split(":")[0],a=new AR({type:"info",title:s??"&ndsp;",text:(i==null?void 0:i.replace(s||"","").replace(":",""))||"",buttons:[{id:"no",key:27,text:"No",normal:!0},{id:"yes",key:13,text:"Yes"}],animation:"overlay"});return a.open(),await a.getPromise()==="yes"},e.prompt=async(i,s,a=!0)=>{const h=i==null?void 0:i.split(":")[0],d=new class{constructor(_){this.options=JSON.parse(JSON.stringify(NU));for(let lt in _)_[lt]!=null&&(this.options[lt]=_[lt]);let et=this.options,nt=JSON.parse(JSON.stringify(UU));for(let lt in nt)et.hasOwnProperty(lt)&&(nt[lt]=et[lt]);let it=[];et.showCancel&&it.push({key:27,text:et.cancelText,normal:!0,onClick:this.handleCancel.bind(this)}),it.push({key:13,text:et.okText,onClick:this.handleOk.bind(this)}),nt.buttons=it,this.input=Bs.createElement("input","input",null,{placeholder:et.placeholder}),this.error=Bs.createDiv("error"),nt.content=Bs.createDomTree({dom:Bs.createDiv("input-wrapper"),children:[this.input,this.error]}),this.modal=new AR(nt)}handleCancel(){this.close().then(this.promiseReject.bind(this))}handleOk(){this.options.validator?this.options.validator(this.input.value).then(()=>{this.close().then(this.promiseResolve.bind(this,this.input.value))},_=>{this.error.innerText=_}):this.close().then(this.promiseResolve.bind(this,this.input.value))}open(){if(this.modal.wwise.opened)return;let _=this.modal.open();return this.input.value="",this.error.innerText="",this.input.focus(),this.promise=new Promise((et,nt)=>{this.promiseResolve=et,this.promiseReject=nt}),_}close(){if(this.modal.wwise.opened)return this.modal.close()}getPromise(){return this.promise}}({type:"info",title:h??"&ndsp;",placeholder:s??"",showCancel:a,animation:"overlay",text:(i==null?void 0:i.replace(h||"","").replace(":",""))||""});return d.open(),await d.getPromise().catch(async()=>null)}}async onRemove(e){return e.alert=this._previousMappings.alert,e.confirm=this._previousMappings.confirm,e.prompt=this._previousMappings.prompt,super.onRemove(e)}}xR.PluginType="WindowiseDialogPlugin";class eL extends Ls{constructor(){super(...arguments),this.enabled=!0,this.toJSON=void 0,this.uiConfig={type:"folder",label:"Extras",limitedUi:!1,children:[()=>{var e;return{label:(!((e=this._viewer)===null||e===void 0)&&e.useRgbm?"Disable":"Enable")+" RGBM",type:"button",value:async()=>{var i,s;await((i=this._viewer)===null||i===void 0?void 0:i.confirm("Edit Extras: This will reload the webpage. Are you sure?"))&&Mv("rgbm",!((s=this._viewer)===null||s===void 0)&&s.useRgbm?"no":"yes",!0)}}},()=>{var e;return{label:(!((e=this._viewer)===null||e===void 0)&&e.getPluginByType("debug")?"Disable":"Enable")+" Debug",type:"button",value:async()=>{var i,s;await((i=this._viewer)===null||i===void 0?void 0:i.confirm("Edit Extras: This will reload the webpage. Are you sure?"))&&Mv("debug",!((s=this._viewer)===null||s===void 0)&&s.getPluginByType("debug")?null:"true",!0)}}}]}}}eL.PluginType="ExtrasUiPlugin1";var jU=o2({defaultModifiers:[EP,CP,MP,l2]}),zU=__webpackgi_require__(388),VU=__webpackgi_require__.n(zU);function QU(c){const e=[];c.traverse(a=>{a.geometry&&e.push(a)});const i={},s={};e.forEach(a=>{var h;if(!i[a.geometry.uuid]){const et=a.geometry.toJSON().data,nt=et?VU()({a:et.attributes||{},b:et.index||[]}):"";i[a.geometry.uuid]=nt}const d=i[a.geometry.uuid],_=(h=s[d])!==null&&h!==void 0?h:s[d]=[];_.includes(a)||_.push(a)}),Object.values(s).forEach(a=>{if(a.length<2)return;const h=a[0].geometry;a.forEach((d,_)=>{_<1||(d.geometry.dispose(),d.geometry=h)})})}const gy=new b.Pa4,_1=new b.Pa4,Y2=new b.Pa4,bR=new b.Pa4,X2=new b.Pa4,DS=new b.Pa4;let ER=1;const GU=new b.Pa4(0,1,0);class HU extends n_{constructor(e,i){super(e,i),this.targetOffset=new b.Pa4(0,0,0);const s=this.update;this.update=()=>this._update(s)}_update(e){this.target.add(this.targetOffset),gy.copy(this.object.position).sub(this.target),ER=gy.length(),DS.copy(this.target);const i=e();return DS.sub(this.target),gy.copy(this.object.position).sub(this.target),ER/=gy.length(),this.target.add(DS),this.object.position.copy(this.target).add(gy),gy.normalize(),_1.crossVectors(GU,gy).normalize(),Y2.crossVectors(gy,_1).normalize(),bR.crossVectors(_1,Y2).normalize().negate(),_1.length()>.1&&this.object.up.crossVectors(gy.clone().normalize(),_1),this.enablePan&&(X2.set(0,0,0).addScaledVector(_1,DS.x).addScaledVector(Y2,DS.y).addScaledVector(bR,DS.z),this.targetOffset.add(X2),this.targetOffset.multiplyScalar(1/ER)),X2.set(0,0,0).addScaledVector(_1,-this.targetOffset.x).addScaledVector(Y2,-this.targetOffset.y).addScaledVector(bR,-this.targetOffset.z),this.object.lookAt(X2.add(this.target)),this.object.updateMatrixWorld(),this.object.isCamera&&this.object.updateProjectionMatrix(),this.target.sub(this.targetOffset),i}}class WU extends nC{constructor(){super(),this.boundingScaleMultiplier=1.2,this._initGeometry(new b.cJO(1,0))}}function SR(c,e){var i,s;const a=Array.from(((i=c.access)!==null&&i!==void 0?i:"").split(".")),h=a.pop();let d=(s=c.targetObject)!==null&&s!==void 0?s:e;if(!h||h.length===0)return{key:void 0,tar:d};if(d=Ut(a,d),d&&!(h in d))throw console.error("invalid key",h,d,e,c),"";return{key:h,tar:d}}function CR(c,e,i,s){const{key:a,tar:h}=SR(c,e);return a&&h?_x(h,a,()=>{var d;i&&(!((d=c.updater)===null||d===void 0)&&d.length)&&c.updater.forEach(_=>i[_]()),s==null||s()}):d=>console.warn("Unable to set ",d,a,h,c,e)}async function K2(c,e,i){var s,a,h,d;const{key:_,tar:et}=SR(e,c),nt=e.animSet?[tL(et,e.animSet,i,(s=e.animSetParallel)!==null&&s!==void 0&&s)]:[];if(_&&et){const it=(d=e.updater)!==null&&d!==void 0?d:[],lt=async()=>mE(et,_,{...e,onUpdate:ut=>{var pt;(pt=e.onUpdate)===null||pt===void 0||pt.call(e,ut),it.forEach(gt=>{var vt;return(vt=i[gt])===null||vt===void 0?void 0:vt.call(i)})}});e.delay?nt.push(Vl(e.delay).then(lt)):nt.push(lt())}else(e.duration||e.delay)&&nt.push(Vl(((a=e.delay)!==null&&a!==void 0?a:0)+((h=e.duration)!==null&&h!==void 0?h:0)));return nt.length===1?nt[0]:Promise.all(nt)}async function tL(c,e,i,s=!1){if(s)return Promise.all(e.map(async a=>K2(c,a,i)));for(const a of e)await K2(c,a,i)}function nL(c,e,i,s){var a,h,d,_,et,nt,it;if(!c)return;e||(e=[]);const lt=s??{},ut=c;for(let pt=0,gt=e.length;pt<gt;pt++){const vt=e[pt];if(vt.uiRef){const wt=(et=ut==null?void 0:ut.indexOf(vt.uiRef))!==null&&et!==void 0?et:-1;wt!==pt&&(wt>=0&&(ut==null||ut.splice(wt,1)),ut==null||ut.splice(pt,0,vt.uiRef))}else{vt.uiRef={type:"folder",label:(a=vt.name)!==null&&a!==void 0?a:"Animation "+pt,children:[]};const wt=[{type:"button",label:"animate",value:()=>{K2(i,vt,lt).then(()=>{var xt;return console.log(((xt=vt.uiRef)===null||xt===void 0?void 0:xt.label)+" finished")})}}];vt.access!==void 0&&wt.push({type:"input",property:[vt,"access"]}),vt.from!==void 0&&wt.push({type:(h=vt.uiObjectType)!==null&&h!==void 0?h:"input",property:[vt,"from"],onChange:()=>{var xt;CR(vt,i)(vt.from),(xt=vt.updater)===null||xt===void 0||xt.forEach(_t=>_t in lt&&lt[_t]())}}),vt.to!==void 0&&wt.push({type:(d=vt.uiObjectType)!==null&&d!==void 0?d:"input",property:[vt,"to"],onChange:()=>{var xt;CR(vt,i)(vt.to),(xt=vt.updater)===null||xt===void 0||xt.forEach(_t=>_t in lt&&lt[_t]())}}),vt.duration!==void 0&&wt.push({type:"input",property:[vt,"duration"]}),vt.animSet&&(vt.animSetParallel||(vt.animSetParallel=!1),wt.push({type:"input",label:"run parallel",property:[vt,"animSetParallel"]})),vt.animSet&&wt.push({type:"folder",label:"AnimSet",expanded:!1,children:[],animSetContainer:!0}),(_=vt.uiRef.children)===null||_===void 0||_.push(...wt),ut==null||ut.splice(pt,0,vt.uiRef)}const Ct=(nt=vt.uiRef.children)===null||nt===void 0?void 0:nt.map(wt=>Yt(wt)).flat(2).find(wt=>wt==null?void 0:wt.animSetContainer);vt.animSet&&Ct&&nL(Ct.children,vt.animSet,(it=vt.targetObject)!==null&&it!==void 0?it:i,s)}}function iL(c,e){return e?c*(1e3/e):0}function qU(c){var e,i=c.from,s=i===void 0?0:i,a=c.velocity,h=a===void 0?0:a,d=c.min,_=c.max,et=c.power,nt=et===void 0?.8:et,it=c.timeConstant,lt=it===void 0?750:it,ut=c.bounceStiffness,pt=ut===void 0?500:ut,gt=c.bounceDamping,vt=gt===void 0?10:gt,Ct=c.restDelta,wt=Ct===void 0?1:Ct,xt=c.modifyTarget,_t=c.driver,Pt=c.onUpdate,Bt=c.onComplete;function Ot(xn){return d!==void 0&&xn<d||_!==void 0&&xn>_}function Lt(xn){return d===void 0?_:_===void 0||Math.abs(d-xn)<Math.abs(_-xn)?d:_}function qt(xn){e==null||e.stop(),e=Xy(lo(lo({},xn),{driver:_t,onUpdate:function(Un){var Mn;Pt==null||Pt(Un),(Mn=xn.onUpdate)===null||Mn===void 0||Mn.call(xn,Un)},onComplete:Bt}))}function en(xn){qt(lo({type:"spring",stiffness:pt,damping:vt,restDelta:wt},xn))}if(Ot(s))en({from:s,velocity:h,to:Lt(s)});else{var cn=nt*h+s;xt!==void 0&&(cn=xt(cn));var An,mn,Tn=Lt(cn),vn=Tn===d?-1:1;qt({type:"decay",from:s,velocity:h,timeConstant:lt,power:nt,restDelta:wt,modifyTarget:xt,onUpdate:Ot(cn)?function(xn){An=mn,mn=xn,h=iL(xn-An,Yy().delta),(vn===1&&xn>Tn||vn===-1&&xn<Tn)&&en({from:xn,to:Tn,velocity:h})}:void 0})}return{stop:function(){return e==null?void 0:e.stop()}}}var rL=function(c){return 180*c/Math.PI},YU=function(c,e){return e===void 0&&(e=fC),rL(Math.atan2(e.y-c.y,e.x-c.x))},XU=function(c,e){var i=!0;return e===void 0&&(e=c,i=!1),function(s){return i?s-c+e:(c=s,i=!0,e)}},KU=function(c){return c},MR=function(c){return c===void 0&&(c=KU),function(e,i,s){var a=i-s,h=-(0-e+1)*(0-c(Math.abs(a)));return a<=0?i+h:i-h}},JU=MR(),ZU=MR(Math.sqrt),sL=function(c){return c*Math.PI/180},J2=function(c){return c.hasOwnProperty("x")&&c.hasOwnProperty("y")},TR=function(c){return J2(c)&&c.hasOwnProperty("z")},Z2=function(c,e){return Math.abs(c-e)};function $U(c,e){if(Hy(c)&&Hy(e))return Z2(c,e);if(J2(c)&&J2(e)){var i=Z2(c.x,e.x),s=Z2(c.y,e.y),a=TR(c)&&TR(e)?Z2(c.z,e.z):0;return Math.sqrt(Math.pow(i,2)+Math.pow(s,2)+Math.pow(a,2))}}var eF=function(c,e,i){return e=sL(e),{x:i*Math.cos(e)+c.x,y:i*Math.sin(e)+c.y}},oL=function(c,e){return e===void 0&&(e=2),e=Math.pow(10,e),Math.round(c*e)/e},aL=function(c,e,i,s){return s===void 0&&(s=0),oL(c+i*(e-c)/Math.max(s,i))},tF=function(c){c===void 0&&(c=50);var e=0,i=0;return function(s){var a=Yy().timestamp,h=a!==i?a-i:0,d=h?aL(e,s,h,c):e;return i=a,e=d,d}},nF=function(c){if(typeof c=="number")return function(s){return Math.round(s/c)*c};var e=0,i=c.length;return function(s){var a=Math.abs(c[0]-s);for(e=1;e<i;e++){var h=c[e],d=Math.abs(h-s);if(d===0)return h;if(d>a)return c[e-1];if(e===i-1)return h;a=d}}};function iF(c,e){return c/(1e3/e)}var rF=function(c,e,i){var s=e-c;return((i-c)%s+s)%s+c},lL=function(c,e){return 1-3*e+3*c},cL=function(c,e){return 3*e-6*c},uL=function(c){return 3*c},$2=function(c,e,i){return((lL(e,i)*c+cL(e,i))*c+uL(e))*c},hL=function(c,e,i){return 3*lL(e,i)*c*c+2*cL(e,i)*c+uL(e)},eD=.1;function sF(c,e,i,s){if(c===e&&i===s)return nE;for(var a=new Float32Array(11),h=0;h<11;++h)a[h]=$2(h*eD,c,i);return function(d){return d===0||d===1?d:$2(function(_){for(var et=0,nt=1;nt!==10&&a[nt]<=_;++nt)et+=eD;--nt;var it=et+(_-a[nt])/(a[nt+1]-a[nt])*eD,lt=hL(it,c,i);return lt>=.001?function(ut,pt,gt,vt){for(var Ct=0;Ct<8;++Ct){var wt=hL(pt,gt,vt);if(wt===0)return pt;pt-=($2(pt,gt,vt)-ut)/wt}return pt}(_,it,c,i):lt===0?it:function(ut,pt,gt,vt,Ct){var wt,xt,_t=0;do(wt=$2(xt=pt+(gt-pt)/2,vt,Ct)-ut)>0?gt=xt:pt=xt;while(Math.abs(wt)>1e-7&&++_t<10);return xt}(_,et,et+eD,c,i)}(d),e,s)}}var oF=function(c,e){return e===void 0&&(e="end"),function(i){var s=(i=e==="end"?Math.min(i,.999):Math.max(i,.001))*c,a=e==="end"?Math.floor(s):Math.ceil(s);return RA(0,1,a/c)}};async function aF(c,{debug:e=!1,ground:i=!0,bloom:s=!0,depthTonemap:a=!1,importPopup:h=!0,caching:d=!0}){const _=new Xm(c);_.enabled=!1,e&&await _.addPlugin(mp),await _.addPlugin(qr,void 0,void 0,{storage:d&&window.caches?await window.caches.open("webgi-cache-storage"):void 0}),await _.addPlugin(tM),await _.addPlugin(aP),h&&await _.addPlugin(Kp),await _.addPlugin(hw),await _.addPlugin(xR),await _.addPlugin(Mm),await _.addPlugin(qx),await _.addPlugin(KC),await _.addPlugin(ZC),await _.addPlugin(Sn),await _.addPlugin(Nu),await _.addPlugin(JC),await _.addPlugin(Jw),await _.addPlugin(ro,ox,!1,!0),await FE(_,{ground:i,bloom:s,depthTonemap:a}),await _.addPlugin(JI),await _.addPlugin(f2,!1),await _.addPlugin(W0,!1),await _.addPlugin(s1,!1),await _.addPlugin(cy,!1),await _.addPlugin(aR),await _.addPlugin(uR),await _.addPlugin(hR),await _.addPlugin(uy,!1),await _.addPlugin(H_),await _.addPlugin(gv),await _.addPlugin(vv),await _.addPlugin(u1),await _.addPlugin(Cw),await _.addPlugin(Sw),await _.addPlugin(j_),await _.addPlugin(P0),await _.addPlugin(z2),await _.addPlugin(j2),await _.addPlugin(V2),await _.addPlugin(Q2),await _.addPlugin(my),await _.addPlugin(H2),await _.addPlugin(F2);const et=await _.addPlugin(new vR(!Cv()));return _.renderer.refreshPipeline(),_.scene.addEventListener("textureAdded",nt=>{nt.texture&&_.scene.setEnvironment(nt.texture)}),et.setupPluginUi(M0),et.setupPluginUi(my),et.setupPluginUi(H2),et.setupPluginUi(Jw),et.setupPluginUi(F2),et.setupPluginUi(tM),et.setupPluginUi(El),et.setupPluginUi(iv),et.setupPluginUi(Cw),et.setupPluginUi(u1),et.setupPluginUi(z2),et.setupPluginUi(Sw),et.setupPluginUi(Dl),et.setupPluginUi(ro),i&&et.setupPluginUi(gp),et.setupPluginUi(W1),et.setupPluginUi(Xo),et.setupPluginUi(j_),et.setupPluginUi(BE),et.setupPluginUi(JI),et.setupPluginUi(LE),et.setupPluginUi(ny),et.setupPluginUi(Ou),et.setupPluginUi(OE),et.setupPluginUi(XA),et.setupPluginUi(Y1),et.setupPluginUi(s1),et.setupPluginUi(cy),et.setupPluginUi(j2),et.setupPluginUi(H_),et.setupPluginUi(gv),et.setupPluginUi(Bu),et.setupPluginUi(V2),et.setupPluginUi(Q2),et.setupPluginUi($u),et.setupPluginUi(_h),s&&et.setupPluginUi(xx),et.setupPluginUi(P0),et.setupPluginUi(Wp),et.setupPluginUi(nw),et.setupPluginUi(rv),et.setupPluginUi(f2),et.setupPluginUi(vv),et.setupPluginUi(ev),et.setupPluginUi(Mx),et.setupPluginUi(ZA),et.setupPluginUi(_d),et.setupPluginUi(W0),et.setupPluginUi(Kp),et.setupPluginUi(Yp),et.setupPluginUi(uy),_.enabled=!0,_}})();__webpackgi_exports__.MWW;__webpackgi_exports__.LY2;__webpackgi_exports__.GYo;__webpackgi_exports__.HRj;__webpackgi_exports__.li4;__webpackgi_exports__.FO5;__webpackgi_exports__.Nlh;__webpackgi_exports__.QvI;__webpackgi_exports__.JHp;__webpackgi_exports__.bGH;__webpackgi_exports__.NDo;__webpackgi_exports__.gSk;__webpackgi_exports__.WMw;__webpackgi_exports__.OTo;__webpackgi_exports__.Se2;__webpackgi_exports__.cum;__webpackgi_exports__.Mig;__webpackgi_exports__.B$7;__webpackgi_exports__.i_9;__webpackgi_exports__.m7l;__webpackgi_exports__.sYA;__webpackgi_exports__.Xcj;__webpackgi_exports__.mzJ;__webpackgi_exports__.ZZA;__webpackgi_exports__.$Ph;__webpackgi_exports__.T__;__webpackgi_exports__.HkE;__webpackgi_exports__.tGC;__webpackgi_exports__.g1S;__webpackgi_exports__.I$C;__webpackgi_exports__.QIH;__webpackgi_exports__._JE;__webpackgi_exports__.SwW;var __webpackgi_exports__AssetManagerPlugin=__webpackgi_exports__.ksm;__webpackgi_exports__.jl_;__webpackgi_exports__.b7R;__webpackgi_exports__.BDV;__webpackgi_exports__.Ea_;__webpackgi_exports__.qff;__webpackgi_exports__.tmC;__webpackgi_exports__.BON;__webpackgi_exports__.P40;__webpackgi_exports__.wLL;__webpackgi_exports__.iHO;__webpackgi_exports__.BbS;__webpackgi_exports__.kqm;__webpackgi_exports__.Hmr;__webpackgi_exports__.SJI;__webpackgi_exports__.mTL;__webpackgi_exports__.y8_;__webpackgi_exports__._Li;__webpackgi_exports__.g56;__webpackgi_exports__.bj3;__webpackgi_exports__.z81;__webpackgi_exports__._MY;__webpackgi_exports__.yEv;__webpackgi_exports__.dFZ;__webpackgi_exports__.N$j;__webpackgi_exports__._YM;__webpackgi_exports__.TUj;__webpackgi_exports__.ZzF;__webpackgi_exports__.qzb;__webpackgi_exports__.GQ;__webpackgi_exports__.nvb;__webpackgi_exports__.DvJ;__webpackgi_exports__.fQA;__webpackgi_exports__.cPz;__webpackgi_exports__.TlE;__webpackgi_exports__.u9r;__webpackgi_exports__.s4_;__webpackgi_exports__.T95;__webpackgi_exports__.F5w;__webpackgi_exports__.NlP;__webpackgi_exports__.$8Z;__webpackgi_exports__.YYN;__webpackgi_exports__.CtF;__webpackgi_exports__.V1s;__webpackgi_exports__.jOv;__webpackgi_exports__.Rki;__webpackgi_exports__.pzV;__webpackgi_exports__.itZ;var __webpackgi_exports__CameraViewPlugin=__webpackgi_exports__.qKx;__webpackgi_exports__.vlJ;__webpackgi_exports__.nPO;__webpackgi_exports__.zcQ;__webpackgi_exports__.GH1;__webpackgi_exports__.ROQ;__webpackgi_exports__.YN5;__webpackgi_exports__.BVQ;__webpackgi_exports__.YT8;__webpackgi_exports__._DE;__webpackgi_exports__.YGz;__webpackgi_exports__.trn;__webpackgi_exports__.zf8;__webpackgi_exports__.uWy;__webpackgi_exports__.wYQ;__webpackgi_exports__.SUY;__webpackgi_exports__.Ilk;__webpackgi_exports__.R2R;__webpackgi_exports__.epp;__webpackgi_exports__.xmJ;__webpackgi_exports__.GD$;__webpackgi_exports__.EB7;__webpackgi_exports__.DqL;__webpackgi_exports__._3;__webpackgi_exports__.b_z;__webpackgi_exports__.OCn;__webpackgi_exports__._am;__webpackgi_exports__.kB7;__webpackgi_exports__.fY$;__webpackgi_exports__.vxC;__webpackgi_exports__.BtG;__webpackgi_exports__.cBK;__webpackgi_exports__.g8_;__webpackgi_exports__.AXT;__webpackgi_exports__.yj7;__webpackgi_exports__.dYG;__webpackgi_exports__.tm_;__webpackgi_exports__.S2y;__webpackgi_exports__.B02;__webpackgi_exports__.PeU;__webpackgi_exports__.Hyl;__webpackgi_exports__.Wqd;__webpackgi_exports__.Xaj;__webpackgi_exports__.DUb;__webpackgi_exports__.dZ3;__webpackgi_exports__.m_w;__webpackgi_exports__.fHI;__webpackgi_exports__.LBq;__webpackgi_exports__.dHf;__webpackgi_exports__.Qww;__webpackgi_exports__.CGV;__webpackgi_exports__.JUT;__webpackgi_exports__.p3g;__webpackgi_exports__.IEO;__webpackgi_exports__.CN8;__webpackgi_exports__.zob;__webpackgi_exports__.yxD;__webpackgi_exports__.CUS;__webpackgi_exports__.A5E;__webpackgi_exports__.zqG;__webpackgi_exports__.PfX;__webpackgi_exports__.Q1o;__webpackgi_exports__.jfJ;__webpackgi_exports__.T_J;__webpackgi_exports__.tEQ;__webpackgi_exports__.gb4;__webpackgi_exports__.qkB;__webpackgi_exports__.cvk;__webpackgi_exports__.HWo;__webpackgi_exports__.brP;__webpackgi_exports__.$YQ;__webpackgi_exports__.X8d;__webpackgi_exports__.Zdt;__webpackgi_exports__.yNB;__webpackgi_exports__.h7x;__webpackgi_exports__.Ox3;__webpackgi_exports__.qtn;__webpackgi_exports__.cBI;__webpackgi_exports__.cU9;__webpackgi_exports__.DT1;__webpackgi_exports__.Kgo;__webpackgi_exports__.ehD;__webpackgi_exports__.fhJ;__webpackgi_exports__.y1s;__webpackgi_exports__.fSK;__webpackgi_exports__.Vdb;__webpackgi_exports__.l8J;__webpackgi_exports__.dj0;__webpackgi_exports__.QM0;__webpackgi_exports__.OIS;var __webpackgi_exports__EasingFunctions=__webpackgi_exports__.q8b;__webpackgi_exports__.TOt;__webpackgi_exports__.xaN;__webpackgi_exports__.Ny0;__webpackgi_exports__.NeD;__webpackgi_exports__.Zof;__webpackgi_exports__.eD;__webpackgi_exports__.jwo;__webpackgi_exports__.dSO;__webpackgi_exports__.Bf4;__webpackgi_exports__.USm;__webpackgi_exports__.pBf;__webpackgi_exports__.eBg;__webpackgi_exports__.$Vf;__webpackgi_exports__.O7d;__webpackgi_exports__.ksq;__webpackgi_exports__.gXf;__webpackgi_exports__.hH6;__webpackgi_exports__.kpi;__webpackgi_exports__.DwZ;__webpackgi_exports__.kN3;__webpackgi_exports__.e62;__webpackgi_exports__.a$l;__webpackgi_exports__.OM3;__webpackgi_exports__.VzW;__webpackgi_exports__.ybr;__webpackgi_exports__.yo9;__webpackgi_exports__.$Bt;__webpackgi_exports__.Wzm;__webpackgi_exports__.Wl3;__webpackgi_exports__.iWj;__webpackgi_exports__.DNz;__webpackgi_exports__.m1M;__webpackgi_exports__.ylh;__webpackgi_exports__.v9Y;__webpackgi_exports__.LSk;__webpackgi_exports__.LHE;__webpackgi_exports__.KE0;__webpackgi_exports__.KCF;__webpackgi_exports__.a4n;__webpackgi_exports__.zIH;__webpackgi_exports__.Hfk;__webpackgi_exports__.png;__webpackgi_exports__.tAj;__webpackgi_exports__.Eb_;__webpackgi_exports__.BT2;__webpackgi_exports__._8p;__webpackgi_exports__.V5Z;__webpackgi_exports__.s5b;__webpackgi_exports__.hkn;__webpackgi_exports__.GFY;__webpackgi_exports__.w$m;__webpackgi_exports__.ksN;__webpackgi_exports__.j4z;__webpackgi_exports__.OAl;__webpackgi_exports__.VLJ;__webpackgi_exports__.C73;__webpackgi_exports__.ZAu;__webpackgi_exports__.ibP;__webpackgi_exports__._fI;__webpackgi_exports__.hUN;__webpackgi_exports__.cLu;__webpackgi_exports__.vmT;__webpackgi_exports__.Qpg;__webpackgi_exports__.So8;__webpackgi_exports__.eOv;__webpackgi_exports__.Wjw;__webpackgi_exports__.cJO;__webpackgi_exports__.QRU;__webpackgi_exports__.S3k;__webpackgi_exports__.PpQ;__webpackgi_exports__.AHu;__webpackgi_exports__.q_9;__webpackgi_exports__.ZRs;__webpackgi_exports__.oqc;__webpackgi_exports__.T_x;__webpackgi_exports__.lb7;__webpackgi_exports__.L5s;__webpackgi_exports__.$TI;__webpackgi_exports__.SPe;__webpackgi_exports__.aVm;__webpackgi_exports__.j87;__webpackgi_exports__.RNb;__webpackgi_exports__.Kz5;__webpackgi_exports__.vpT;__webpackgi_exports__.kB5;__webpackgi_exports__._C8;__webpackgi_exports__.Syv;__webpackgi_exports__.NMF;__webpackgi_exports__.pIN;__webpackgi_exports__.eMJ;__webpackgi_exports__.rN7;__webpackgi_exports__.iUp;__webpackgi_exports__.GFd;__webpackgi_exports__.x5V;__webpackgi_exports__.tUh;__webpackgi_exports__.z8B;__webpackgi_exports__.vcl;__webpackgi_exports__.GZb;__webpackgi_exports__.p7y;__webpackgi_exports__.S9g;__webpackgi_exports__.Zr5;__webpackgi_exports__.vCF;__webpackgi_exports__.yt0;__webpackgi_exports__.uXU;__webpackgi_exports__._kC;__webpackgi_exports__.lk7;__webpackgi_exports__.USc;__webpackgi_exports__.x12;__webpackgi_exports__.Zzh;__webpackgi_exports__.nls;__webpackgi_exports__.g_z;__webpackgi_exports__.U7;__webpackgi_exports__.FT0;__webpackgi_exports__.blk;__webpackgi_exports__.ejS;__webpackgi_exports__.rnI;__webpackgi_exports__.wem;__webpackgi_exports__.lfu;__webpackgi_exports__.FDw;__webpackgi_exports__.lRj;__webpackgi_exports__.D1R;__webpackgi_exports__.qyh;__webpackgi_exports__.GUF;__webpackgi_exports__.EoG;__webpackgi_exports__.aNw;__webpackgi_exports__.Zp0;__webpackgi_exports__.lLk;__webpackgi_exports__.jAl;__webpackgi_exports__.uEv;__webpackgi_exports__.YKA;__webpackgi_exports__.cRx;__webpackgi_exports__.Y8D;__webpackgi_exports__.RsA;__webpackgi_exports__.Y0m;__webpackgi_exports__.F5T;__webpackgi_exports__.EDU;__webpackgi_exports__.z$Q;__webpackgi_exports__.KA8;__webpackgi_exports__.XUj;__webpackgi_exports__.Me$;__webpackgi_exports__.u7G;__webpackgi_exports__.PEk;__webpackgi_exports__.BG4;__webpackgi_exports__.M8C;__webpackgi_exports__.Vkp;__webpackgi_exports__.yGw;__webpackgi_exports__.Sm8;__webpackgi_exports__.Kj0;__webpackgi_exports__.vBJ;__webpackgi_exports__.QfV;__webpackgi_exports__.lRF;__webpackgi_exports__.Lun;__webpackgi_exports__.YBo;__webpackgi_exports__.kaV;__webpackgi_exports__.RSm;__webpackgi_exports__.xoR;__webpackgi_exports__.EJi;__webpackgi_exports__.Wid;__webpackgi_exports__.iuj;__webpackgi_exports__.IKL;__webpackgi_exports__.r_;__webpackgi_exports__.OoA;__webpackgi_exports__.qhX;__webpackgi_exports__.qPT;__webpackgi_exports__.M5h;__webpackgi_exports__.Ns1;__webpackgi_exports__.TyD;__webpackgi_exports__.vZf;__webpackgi_exports__.HTd;__webpackgi_exports__.aH4;__webpackgi_exports__.YLQ;__webpackgi_exports__.BVF;__webpackgi_exports__.MyG;__webpackgi_exports__.jFi;__webpackgi_exports__.aCh;__webpackgi_exports__.uL9;__webpackgi_exports__.TNj;__webpackgi_exports__.IFH;__webpackgi_exports__.bdR;__webpackgi_exports__.RPs;__webpackgi_exports__.kM_;__webpackgi_exports__.M6v;__webpackgi_exports__.RvT;__webpackgi_exports__.dUE;__webpackgi_exports__.oe_;__webpackgi_exports__.BuN;__webpackgi_exports__.Tme;__webpackgi_exports__.N9P;__webpackgi_exports__.Gql;__webpackgi_exports__.$XY;__webpackgi_exports__.O9d;__webpackgi_exports__.zEO;__webpackgi_exports__.qfx;__webpackgi_exports__.PA7;__webpackgi_exports__.REq;__webpackgi_exports__.pQR;__webpackgi_exports__.ghN;__webpackgi_exports__.Hy8;__webpackgi_exports__.Wpd;__webpackgi_exports__.LgZ;__webpackgi_exports__.iWC;__webpackgi_exports__.mqn;__webpackgi_exports__.SKe;__webpackgi_exports__.iKG;__webpackgi_exports__.rCq;__webpackgi_exports__._iA;__webpackgi_exports__.ntZ;__webpackgi_exports__.anP;__webpackgi_exports__.X2e;__webpackgi_exports__.FCo;__webpackgi_exports__.y$t;__webpackgi_exports__.cPb;__webpackgi_exports__.lmx;__webpackgi_exports__.JOQ;__webpackgi_exports__.BKK;__webpackgi_exports__._12;__webpackgi_exports__.tJx;__webpackgi_exports__.cek;__webpackgi_exports__.qD0;__webpackgi_exports__.xG9;__webpackgi_exports__.wI8;__webpackgi_exports__.Sgv;__webpackgi_exports__.woe;__webpackgi_exports__.UY4;__webpackgi_exports__.aq0;__webpackgi_exports__.ujx;__webpackgi_exports__.Uol;__webpackgi_exports__.JiH;__webpackgi_exports__.VYz;__webpackgi_exports__._Pm;__webpackgi_exports__.EsW;__webpackgi_exports__.iUV;__webpackgi_exports__.tf;__webpackgi_exports__.ZQ6;__webpackgi_exports__.mXe;__webpackgi_exports__._fP;__webpackgi_exports__.iLg;__webpackgi_exports__.zbs;__webpackgi_exports__.UZH;__webpackgi_exports__.mSO;__webpackgi_exports__.wk1;__webpackgi_exports__.E2K;__webpackgi_exports__.FUD;__webpackgi_exports__.pKu;__webpackgi_exports__.GG6;__webpackgi_exports__.Gih;__webpackgi_exports__.iiP;__webpackgi_exports__.SvJ;__webpackgi_exports__.ptH;__webpackgi_exports__.jZA;__webpackgi_exports__.y2t;__webpackgi_exports__.gi4;__webpackgi_exports__.Djp;__webpackgi_exports__.BG$;__webpackgi_exports__.NYV;__webpackgi_exports__.xJs;__webpackgi_exports__.bsb;__webpackgi_exports__.ekQ;__webpackgi_exports__.CaW;__webpackgi_exports__.eaV;__webpackgi_exports__.BFQ;__webpackgi_exports__.v3W;__webpackgi_exports__.ILR;__webpackgi_exports__.UCm;__webpackgi_exports__.Inb;__webpackgi_exports__.U1$;__webpackgi_exports__.LgE;__webpackgi_exports__.fto;__webpackgi_exports__.l0P;__webpackgi_exports__.vCx;__webpackgi_exports__._AM;__webpackgi_exports__.wuA;__webpackgi_exports__.av9;__webpackgi_exports__.CtA;__webpackgi_exports__.BvQ;__webpackgi_exports__.FZJ;__webpackgi_exports__.FIo;__webpackgi_exports__.zHn;__webpackgi_exports__.iMs;__webpackgi_exports__.T_f;__webpackgi_exports__.hEm;__webpackgi_exports__.D9w;__webpackgi_exports__.sHH;__webpackgi_exports__.CdI;__webpackgi_exports__.rkc;__webpackgi_exports__.rpg;__webpackgi_exports__.ce8;__webpackgi_exports__.rOj;__webpackgi_exports__.P6m;__webpackgi_exports__.JA6;__webpackgi_exports__.V4E;__webpackgi_exports__.o8S;__webpackgi_exports__.flB;__webpackgi_exports__.DUH;__webpackgi_exports__.KI_;__webpackgi_exports__.iLN;__webpackgi_exports__.rz_;__webpackgi_exports__.jsw;__webpackgi_exports__.srG;__webpackgi_exports__.i6Z;__webpackgi_exports__.vfv;__webpackgi_exports__.xsS;__webpackgi_exports__.or;__webpackgi_exports__.EQj;__webpackgi_exports__.ov0;__webpackgi_exports__.WdD;__webpackgi_exports__.Vj0;__webpackgi_exports__.jyz;__webpackgi_exports__.mTM;__webpackgi_exports__.Mn1;__webpackgi_exports__.Hlq;__webpackgi_exports__.Fi7;__webpackgi_exports__.Tn7;__webpackgi_exports__.bnF;__webpackgi_exports__.HW6;__webpackgi_exports__.oa8;__webpackgi_exports__.T_1;__webpackgi_exports__.zHJ;__webpackgi_exports__.iDF;__webpackgi_exports__.iAb;__webpackgi_exports__.d4E;__webpackgi_exports__.lBg;__webpackgi_exports__.JeJ;__webpackgi_exports__.FKY;__webpackgi_exports__.zlZ;__webpackgi_exports__.vkg;__webpackgi_exports__.brh;__webpackgi_exports__.kZK;__webpackgi_exports__.puG;__webpackgi_exports__.OdW;__webpackgi_exports__._YX;__webpackgi_exports__.TUv;__webpackgi_exports__.Hw6;__webpackgi_exports__.aLr;__webpackgi_exports__.Aip;__webpackgi_exports__.xo$;__webpackgi_exports__.bIn;__webpackgi_exports__.$V;__webpackgi_exports__.lDi;__webpackgi_exports__.gti;__webpackgi_exports__.PMe;__webpackgi_exports__.iwP;__webpackgi_exports__.FvO;__webpackgi_exports__.jyi;__webpackgi_exports__.xeV;__webpackgi_exports__.k74;__webpackgi_exports__.RlZ;__webpackgi_exports__.KhW;__webpackgi_exports__.HgB;__webpackgi_exports__.W2J;__webpackgi_exports__.JWc;__webpackgi_exports__.u37;__webpackgi_exports__.Z6B;__webpackgi_exports__.QZ1;__webpackgi_exports__.Ir4;__webpackgi_exports__.NwF;__webpackgi_exports__.Wbm;__webpackgi_exports__.N4l;__webpackgi_exports__.ej9;__webpackgi_exports__.QmN;__webpackgi_exports__.IOt;__webpackgi_exports__.NOD;__webpackgi_exports__.L5g;__webpackgi_exports__.H$k;__webpackgi_exports__.cuP;__webpackgi_exports__.xEZ;__webpackgi_exports__.dpR;__webpackgi_exports__.wOD;__webpackgi_exports__.KNb;__webpackgi_exports__.IiN;__webpackgi_exports__.Cne;__webpackgi_exports__.XvJ;__webpackgi_exports__.XZw;__webpackgi_exports__.FE5;__webpackgi_exports__.lVp;__webpackgi_exports__.CJI;__webpackgi_exports__.z$h;__webpackgi_exports__.UlW;__webpackgi_exports__.WwZ;__webpackgi_exports__.Lcc;__webpackgi_exports__.WXh;__webpackgi_exports__.Vjr;__webpackgi_exports__.LuM;__webpackgi_exports__.LP5;__webpackgi_exports__.xfE;__webpackgi_exports__.qlB;__webpackgi_exports__.lCJ;__webpackgi_exports__.WTc;__webpackgi_exports__.rAo;__webpackgi_exports__.LZj;__webpackgi_exports__.xWb;__webpackgi_exports__.gH0;__webpackgi_exports__.rBU;__webpackgi_exports__.rDY;__webpackgi_exports__.ywz;__webpackgi_exports__.wJv;__webpackgi_exports__.JQ4;__webpackgi_exports__.k0A;__webpackgi_exports__.irR;__webpackgi_exports__.LsT;__webpackgi_exports__.q5h;__webpackgi_exports__.TKh;__webpackgi_exports__.tyg;__webpackgi_exports__.Ro5;__webpackgi_exports__.dwk;__webpackgi_exports__.FM8;__webpackgi_exports__.Pa4;__webpackgi_exports__.Ltg;__webpackgi_exports__.yC1;__webpackgi_exports__.lHq;__webpackgi_exports__.fO1;var __webpackgi_exports__ViewerApp=__webpackgi_exports__.oMA;__webpackgi_exports__.JzW;__webpackgi_exports__.QEt;__webpackgi_exports__.b5g;__webpackgi_exports__.Ywn;__webpackgi_exports__.GVz;__webpackgi_exports__.oAp;__webpackgi_exports__.kFz;__webpackgi_exports__.p7A;__webpackgi_exports__.dd2;__webpackgi_exports__.CP7;__webpackgi_exports__.fQK;__webpackgi_exports__.Wd$;__webpackgi_exports__.t1_;__webpackgi_exports__.Uk6;__webpackgi_exports__._sL;__webpackgi_exports__.Pnf;__webpackgi_exports__.c8b;__webpackgi_exports__._lf;__webpackgi_exports__.ad5;__webpackgi_exports__.sZV;__webpackgi_exports__.TfA;__webpackgi_exports__.sKX;__webpackgi_exports__.UdM;__webpackgi_exports__.P0y;__webpackgi_exports__.L_r;var __webpackgi_exports__addBasePlugins=__webpackgi_exports__.Bve;__webpackgi_exports__.UeO;__webpackgi_exports__.$nx;__webpackgi_exports__.Bk6;__webpackgi_exports__.EER;__webpackgi_exports__.y4l;__webpackgi_exports__.pQ0;__webpackgi_exports__.wXW;__webpackgi_exports__.r5x;__webpackgi_exports__.MSI;__webpackgi_exports__.EUu;__webpackgi_exports__.jtH;__webpackgi_exports__.T0T;__webpackgi_exports__.gAb;__webpackgi_exports__.iwT;__webpackgi_exports__.je_;__webpackgi_exports__.wBP;__webpackgi_exports__.LU2;__webpackgi_exports__.wQL;__webpackgi_exports__.Zs7;__webpackgi_exports__.sMc;__webpackgi_exports__.x7s;__webpackgi_exports__.Mnd;__webpackgi_exports__.A0_;__webpackgi_exports__.d73;__webpackgi_exports__.HCD;__webpackgi_exports__.RG9;__webpackgi_exports__.G2P;__webpackgi_exports__.XLf;__webpackgi_exports__.CGN;__webpackgi_exports__.RGi;__webpackgi_exports__.mvg;__webpackgi_exports__.Hiy;__webpackgi_exports__.XMc;__webpackgi_exports__.N7M;__webpackgi_exports__.iv;__webpackgi_exports__.n55;__webpackgi_exports__.IaC;__webpackgi_exports__.h9t;__webpackgi_exports__.yDW;__webpackgi_exports__.gJv;__webpackgi_exports__.l$g;__webpackgi_exports__.vQi;__webpackgi_exports__.$MY;__webpackgi_exports__.wJl;__webpackgi_exports__.Z7Y;__webpackgi_exports__.X7D;__webpackgi_exports__.BnX;__webpackgi_exports__.uZ5;__webpackgi_exports__.zVI;__webpackgi_exports__.DpF;__webpackgi_exports__.nNb;__webpackgi_exports__.cqZ;__webpackgi_exports__.pKN;__webpackgi_exports__.d_$;__webpackgi_exports__.DdI;__webpackgi_exports__.rrX;__webpackgi_exports__.KlC;__webpackgi_exports__.KVn;__webpackgi_exports__.oau;__webpackgi_exports__.aw9;__webpackgi_exports__.Aap;__webpackgi_exports__.Dxg;__webpackgi_exports__.MjT;__webpackgi_exports__.F7Q;__webpackgi_exports__.IFq;__webpackgi_exports__.IJl;__webpackgi_exports__.O5A;__webpackgi_exports__.wCn;__webpackgi_exports__.gGT;__webpackgi_exports__.pEc;__webpackgi_exports__.Bi6;__webpackgi_exports__.fi_;__webpackgi_exports__.TT;__webpackgi_exports__.q2Z;__webpackgi_exports__.NyK;__webpackgi_exports__.bgu;__webpackgi_exports__.kcS;__webpackgi_exports__.rRN;__webpackgi_exports__.ivY;__webpackgi_exports__._s1;__webpackgi_exports__._HO;__webpackgi_exports__.tpL;__webpackgi_exports__.DMK;__webpackgi_exports__.LjN;__webpackgi_exports__.iFs;__webpackgi_exports__.qTg;__webpackgi_exports__.Wtl;__webpackgi_exports__.DmK;__webpackgi_exports__.Htt;__webpackgi_exports__.Hx7;__webpackgi_exports__.imt;__webpackgi_exports__.US6;__webpackgi_exports__.vZs;__webpackgi_exports__.TE$;__webpackgi_exports__.lmu;__webpackgi_exports__.SvO;__webpackgi_exports__.YQY;__webpackgi_exports__.mZN;__webpackgi_exports__.VvG;__webpackgi_exports__.omp;__webpackgi_exports__.utz;__webpackgi_exports__.TFV;__webpackgi_exports__.hrz;__webpackgi_exports__.JKM;__webpackgi_exports__.jZf;__webpackgi_exports__.RjL;__webpackgi_exports__.RRI;__webpackgi_exports__.RUq;__webpackgi_exports__._t4;__webpackgi_exports__.YHh;__webpackgi_exports__.R8g;__webpackgi_exports__.Bbl;__webpackgi_exports__.V9r;__webpackgi_exports__.PZ2;__webpackgi_exports__.w7A;__webpackgi_exports__.N6S;__webpackgi_exports__.Uxp;__webpackgi_exports__.tAz;__webpackgi_exports__.R$F;__webpackgi_exports__.N33;__webpackgi_exports__.gw2;__webpackgi_exports__.KlU;__webpackgi_exports__.rfc;__webpackgi_exports__.wo6;__webpackgi_exports__.H4P;__webpackgi_exports__.swA;__webpackgi_exports__._Z3;__webpackgi_exports__.ivc;__webpackgi_exports__.rZ1;__webpackgi_exports__.CpZ;__webpackgi_exports__.dyc;__webpackgi_exports__.MxZ;__webpackgi_exports__.btp;__webpackgi_exports__.mXy;__webpackgi_exports__.Ej0;__webpackgi_exports__.ep4;__webpackgi_exports__.DQP;__webpackgi_exports__.VNr;__webpackgi_exports__.V7q;__webpackgi_exports__.zEk;__webpackgi_exports__.qfq;__webpackgi_exports__.piB;__webpackgi_exports__.IIc;__webpackgi_exports__.rrF;__webpackgi_exports__.naq;__webpackgi_exports__.sXR;__webpackgi_exports__.p5I;__webpackgi_exports__.wps;__webpackgi_exports__.wuo;__webpackgi_exports__.GpE;__webpackgi_exports__.F4b;__webpackgi_exports__.t$v;__webpackgi_exports__.tdn;__webpackgi_exports__.Y9t;__webpackgi_exports__.GEo;__webpackgi_exports__.DH3;__webpackgi_exports__.uxM;__webpackgi_exports__.zH3;__webpackgi_exports__.MLs;__webpackgi_exports__.xXG;__webpackgi_exports__.YM4;__webpackgi_exports__.B3r;__webpackgi_exports__.iAx;__webpackgi_exports__.lDn;__webpackgi_exports__.oaQ;__webpackgi_exports__.CD7;__webpackgi_exports__.Rc0;__webpackgi_exports__.iPG;__webpackgi_exports__.TIc;__webpackgi_exports__.xsC;__webpackgi_exports__.zOc;__webpackgi_exports__.r46;__webpackgi_exports__.z2C;__webpackgi_exports__._X$;__webpackgi_exports__._yn;__webpackgi_exports__.Dyg;__webpackgi_exports__.cUc;__webpackgi_exports__.zGw;__webpackgi_exports__.Ctq;__webpackgi_exports__.$ch;__webpackgi_exports__.k5b;__webpackgi_exports__.kZl;__webpackgi_exports__.OCg;__webpackgi_exports__.YjH;__webpackgi_exports__.Ui8;__webpackgi_exports__.YD2;__webpackgi_exports__.vi9;__webpackgi_exports__.ij3;__webpackgi_exports__.YPW;__webpackgi_exports__.Bg1;__webpackgi_exports__.kon;__webpackgi_exports__.M3g;__webpackgi_exports__.F2z;__webpackgi_exports__.pJF;__webpackgi_exports__.knz;__webpackgi_exports__.Ejo;__webpackgi_exports__.BgY;__webpackgi_exports__.qCG;__webpackgi_exports__.HD9;__webpackgi_exports__.fEB;__webpackgi_exports__.Udc;__webpackgi_exports__.ZQg;__webpackgi_exports__.ofC;__webpackgi_exports__.yRy;__webpackgi_exports__._NL;__webpackgi_exports__.LCA;__webpackgi_exports__.j1w;__webpackgi_exports__.i8J;__webpackgi_exports__.p7C;__webpackgi_exports__.ZAS;__webpackgi_exports__.ipH;__webpackgi_exports__.$TF;__webpackgi_exports__.uZI;__webpackgi_exports__.VWG;__webpackgi_exports__.pQ7;__webpackgi_exports__.STw;__webpackgi_exports__.jc8;__webpackgi_exports__.BL_;__webpackgi_exports__.S6;__webpackgi_exports__.T8U;__webpackgi_exports__.TD6;__webpackgi_exports__.akS;__webpackgi_exports__.QKE;__webpackgi_exports__.dKx;__webpackgi_exports__.OvX;var __webpackgi_exports__timeout=__webpackgi_exports__.VsW;__webpackgi_exports__.YMc;__webpackgi_exports__.aPg;__webpackgi_exports__.LFn;__webpackgi_exports__.wey;__webpackgi_exports__.MaE;__webpackgi_exports__.s4x;__webpackgi_exports__.FJA;__webpackgi_exports__.vIA;__webpackgi_exports__.Spv;__webpackgi_exports__.w8l;__webpackgi_exports__.riG;__webpackgi_exports__.Kbh;__webpackgi_exports__.BFq;__webpackgi_exports__.t8K;__webpackgi_exports__.Q7n;__webpackgi_exports__.KGF;__webpackgi_exports__.e5;__webpackgi_exports__.Rik;__webpackgi_exports__.GZo;__webpackgi_exports__.Bds;__webpackgi_exports__.HTu;__webpackgi_exports__.cTq;__webpackgi_exports__.X_Y;__webpackgi_exports__.dA8;__webpackgi_exports__.bwS;__webpackgi_exports__.Lks;__webpackgi_exports__.Rvq;__webpackgi_exports__.P4F;__webpackgi_exports__.Pd0;__webpackgi_exports__.Pjo;__webpackgi_exports__.Tum;__webpackgi_exports__.dRH;__webpackgi_exports__.RX0;__webpackgi_exports__.reQ;__webpackgi_exports__.cWm;__webpackgi_exports__.NC9;__webpackgi_exports__.$Re;__webpackgi_exports__.Xo9;__webpackgi_exports__.LNO;__webpackgi_exports__.iZP;const Header$1="",Header=()=>jsx("div",{className:"header",children:jsx("div",{className:"container",children:jsx("h1",{children:"Ring app"})})}),Sections="",Section01=()=>jsx("div",{className:"section section-01",children:jsx("div",{className:"container",children:jsxs("div",{className:"section-content",children:[jsx("h2",{children:"A Personal Touch."}),jsx("p",{children:"Cras vitae sodales mauris, eget suscipit enim. Mauris vitae vehicula elit. Proin accumsan id turpis id mattis. Aenean aliquam aliquam justo at interdum. Suspendisse potenti."})]})})}),Section02=()=>jsx("div",{className:"section section-01",children:jsx("div",{className:"container",children:jsxs("div",{className:"section-content",children:[jsx("h2",{children:"The ideal jewelry"}),jsx("p",{children:"Cras vitae sodales mauris, eget suscipit enim. Mauris vitae vehicula elit. Proin accumsan id turpis id mattis. Aenean aliquam aliquam justo at interdum. Suspendisse potenti."})]})})});function App(){async function j(){const tt=new __webpackgi_exports__ViewerApp({canvas:document.getElementById("mcanvas"),useRgbm:!0}),ot=await tt.addPlugin(__webpackgi_exports__AssetManagerPlugin);await __webpackgi_exports__addBasePlugins(tt);const b=tt.getPlugin(__webpackgi_exports__CameraViewPlugin);if(tt.renderer.refreshPipeline(),await ot.addFromPath("./assets/model/ring06.glb"),b){let yt=b==null?void 0:b.getCurrentCameraView(tt.scene.activeCamera);yt&&(b==null||b.camViews.push(yt),yt=b==null?void 0:b.getCurrentCameraView(tt.scene.activeCamera),yt==null||yt.position.set(6,4,5),b==null||b.camViews.push(yt),yt=b.getCurrentCameraView(tt.scene.activeCamera),yt.position.set(-2,4,5),yt.target.set(0,1,0),b.camViews.push(yt),b.animateOnScroll=!0,b.animDuration=2e3,b.animEase="easeInOutSine",await b.animateToView(b.camViews[2]),await __webpackgi_exports__timeout(1500),await b.animateToView(b.camViews[1],2e3,__webpackgi_exports__EasingFunctions.easeIn),await __webpackgi_exports__timeout(1500),await b.animateToView(b.camViews[0]))}}return j(),jsxs("div",{className:"App",children:[jsx(Header,{}),jsx(Section01,{}),jsx(Section02,{}),jsx("div",{className:"section",children:jsx("h1",{children:"Section 02"})}),jsx("div",{className:"section",children:jsx("h1",{children:"Section 03"})}),jsx("div",{className:"section",children:jsx("h1",{children:"Section 04"})})]})}const index="";createRoot(document.querySelector("#root")).render(jsx(App,{}));
